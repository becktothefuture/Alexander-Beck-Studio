!function(){"use strict";const e={PIT:"pit",FLIES:"flies",WEIGHTLESS:"weightless",WATER:"water",VORTEX:"vortex",PING_PONG:"ping-pong",MAGNETIC:"magnetic",BUBBLES:"bubbles"},t={DPR:Math.max(1,Math.min(2,window.devicePixelRatio||1)),CANVAS_HEIGHT_VH_PIT:1.5,CANVAS_HEIGHT_VH_DEFAULT:1,OFFSCREEN_MOUSE:-1e9,MIN_DISTANCE_EPSILON:1e-6,ACCUMULATOR_RESET_THRESHOLD:3,MAX_PHYSICS_STEPS:2,SPIN_DAMP_PER_S:2,SPIN_GAIN:.25,SPIN_GAIN_TANGENT:.18,ROLL_FRICTION_PER_S:1.5,SQUASH_MAX_BASE:.2,SQUASH_DECAY_PER_S:18,WALL_REST_VEL_THRESHOLD:70,GROUND_COUPLING_PER_S:8,SLEEP_VELOCITY_THRESHOLD:5,SLEEP_ANGULAR_THRESHOLD:.05,TIME_TO_SLEEP:.5,PHYSICS_DT:1/120},a={config:{},currentMode:e.FLIES,balls:[],canvas:null,ctx:null,container:null,mouseX:t.OFFSCREEN_MOUSE,mouseY:t.OFFSCREEN_MOUSE,mouseInCanvas:!1,GE:1960,G:0,gravityScale:1,gravityMultiplier:0,gravityMultiplierPit:1.1,REST:.69,FRICTION:.006,ballMassKg:129,MASS_BASELINE_KG:129,MASS_REST_EXP:.15,MASS_GRAVITY_EXP:.35,DPR:Math.max(1,Math.min(2,window.devicePixelRatio||1)),sizeScale:1.2,sizeVariation:0,responsiveScale:1,R_MIN_BASE:6,R_MAX_BASE:24,R_MIN:6*1.2*.75,R_MAX:36,ballSoftness:20,cornerRadius:42,vortexSwirlStrength:420,vortexRadialPull:180,vortexBallCount:180,magneticBallCount:180,magneticStrength:65e3,magneticMaxVelocity:2800,magneticExplosionInterval:5,bubblesSpawnRate:8,bubblesRiseSpeed:150,bubblesWobble:40,bubblesMaxCount:150,bubblesDeflectRadius:80,pingPongBallCount:35,pingPongSpeed:800,pingPongCursorRadius:50,currentColors:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],currentTemplate:"industrialTeal",fliesBallCount:60,attractionPower:5e3,orbitRadius:180,swarmSpeed:.4,fliesSeparation:15e3,weightlessCount:80,weightlessInitialSpeed:250,weightlessBounce:.97,gridColumns:40,gridBallCount:120,pulseInterval:.8,waterBallCount:300,waterDrag:.015,waterRippleSpeed:300,waterRippleStrength:18e3,waterDriftStrength:40,waterInitialVelocity:200,repelRadius:120,repelPower:274e3,repelSoft:3.4,repellerEnabled:!1,emitterTimer:0,autoDarkModeEnabled:!0,isDarkMode:!1,getSquashMax(){return 0===this.ballSoftness?0:t.SQUASH_MAX_BASE*(this.ballSoftness/40)}};function n(){return a}function i(){a.balls.length=0}const s={industrialTeal:{label:"Industrial Teal",light:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#6b726b","#3d453d","#8a928a","#00e6c3","#d5d5d5","#ff6b47","#5b9aff","#ffb84d"]},sunsetCoral:{label:"Sunset Coral",light:["#bdbbb8","#e8e6e3","#ffffff","#ff3b3b","#000000","#00f5d4","#1e40af","#fb923c"],dark:["#716f6b","#3f3d3a","#8e8c88","#ff6b6b","#d8d8d8","#00ffe7","#6ba3ff","#ffb570"]},violetPunch:{label:"Violet Punch",light:["#b8b7c2","#e6e5ed","#ffffff","#9333ea","#000000","#dc2626","#0ea5e9","#facc15"],dark:["#6d6c7a","#3a3845","#8b8a98","#c266ff","#dad6e8","#ff5c5c","#42d4ff","#fff066"]},citrusBlast:{label:"Citrus Blast",light:["#bfbdb5","#eae8df","#ffffff","#ea580c","#000000","#e11d48","#2563eb","#059669"],dark:["#74726a","#403e38","#918f87","#ff8c4d","#dbd9d1","#ff5c7a","#6ba3ff","#00d699"]},cobaltSpark:{label:"Cobalt Spark",light:["#b5b8be","#e3e6eb","#ffffff","#1d4ed8","#000000","#ea580c","#db2777","#d97706"],dark:["#696d75","#3a3e45","#878b93","#6b9dff","#d6dae2","#ff8c5c","#ff66b3","#ffc266"]}},o=[.5,.25,.12,.06,.03,.02,.01,.01];function l(){const e=n().currentColors;if(!e||0===e.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let a=0;for(let n=0;n<Math.min(e.length,o.length);n++)if(a+=o[n],t<=a)return e[n];return e[Math.min(e.length-1,7)]}function r(e){const t=n().currentColors;return t&&0!==t.length?t[Math.max(0,Math.min(7,Math.floor(e)))]||"#ffffff":(console.warn("No colors available, using fallback"),"#ffffff")}function d(e){const t=n();t.currentTemplate=e,t.currentColors=function(e){const t=n(),a=s[e];return a?t.isDarkMode?a.dark:a.light:s.industrialTeal.light}(e),t.cursorBallColor=t.currentColors[t.cursorBallIndex||4],function(){const e=n().balls;for(let t=0;t<e.length;t++)e[t].color=l()}(),function(e){try{const t=document.documentElement,a=(e&&e.length?e:[]).slice(0,8);for(let e=0;e<8;e++){const n=a[e]||"#ffffff";t.style.setProperty(`--ball-${e+1}`,n)}}catch(e){}}(t.currentColors),function(){const e=n().currentColors;for(let t=1;t<=8;t++){const a=document.getElementById(`color${t}`),n=document.getElementById(`color${t}Val`);a&&e[t-1]&&(a.value=e[t-1],n&&(n.textContent=e[t-1].toUpperCase()))}}()}function c(){const e=document.getElementById("colorSelect");if(!e)return;e.innerHTML="";for(const[t,a]of Object.entries(s)){const n=document.createElement("option");n.value=t,n.textContent=a.label,e.appendChild(n)}const t=n();e.value=t.currentTemplate}let u="light",h="light";const p="#cecece",m="#0a0a0a";function g(e){u=e;let t=!1;t="auto"===e?"dark"===h:"dark"===e,function(e){const t=n();t.isDarkMode=e,document.documentElement.style.colorScheme=e?"dark":"light",e?(t.container?.classList.add("dark-mode"),document.body.classList.add("dark-mode"),document.documentElement.classList.add("dark-mode")):(t.container?.classList.remove("dark-mode"),document.body.classList.remove("dark-mode"),document.documentElement.classList.remove("dark-mode")),function(e){const t=e?m:p;let a=document.querySelector('meta[name="theme-color"]');a||(a=document.createElement("meta"),a.name="theme-color",document.head.appendChild(a)),a.content=t;let n=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: light)"]');n||(n=document.createElement("meta"),n.name="theme-color",n.media="(prefers-color-scheme: light)",document.head.appendChild(n)),n.content=p;let i=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: dark)"]');i||(i=document.createElement("meta"),i.name="theme-color",i.media="(prefers-color-scheme: dark)",document.head.appendChild(i)),i.content=m}(e),d(t.currentTemplate),function(){const e=document.getElementById("themeAuto"),t=document.getElementById("themeLight"),a=document.getElementById("themeDark");if(!e||!t||!a)return;[e,t,a].forEach(e=>e.classList.remove("active")),"auto"===u?e.classList.add("active"):"light"===u?t.classList.add("active"):a.classList.add("active");const i=document.getElementById("themeStatus");if(i){const e=n();i.textContent="auto"===u?e.isDarkMode?"üåô Auto (Dark)":"‚òÄÔ∏è Auto (Light)":"light"===u?"‚òÄÔ∏è Light Mode":"üåô Dark Mode"}}()}(t);try{localStorage.setItem("theme-preference",e)}catch(e){}console.log(`üé® Theme set to: ${e} (rendering: ${t?"dark":"light"})`)}function b(){h=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",console.log(`üñ•Ô∏è System prefers: ${h}`);let e="light";try{e=localStorage.getItem("theme-preference")||"light"}catch(e){}g(e);const t=document.getElementById("themeAuto"),a=document.getElementById("themeLight"),n=document.getElementById("themeDark");t&&t.addEventListener("click",()=>g("auto")),a&&a.addEventListener("click",()=>g("light")),n&&n.addEventListener("click",()=>g("dark")),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{h=e.matches?"dark":"light",console.log(`üñ•Ô∏è System preference changed to: ${h}`),"auto"===u&&g("auto")}),console.log("‚úì Modern dark mode initialized")}let v,f;function M(){v=document.getElementById("c"),f=v?v.getContext("2d"):null,v&&f?(S(),window.addEventListener("resize",S)):console.error("Canvas not found")}function S(){if(!v)return;const a=n().currentMode===e.PIT?t.CANVAS_HEIGHT_VH_PIT:t.CANVAS_HEIGHT_VH_DEFAULT,i=window.innerHeight*a,s=t.DPR;v.width=Math.floor(window.innerWidth*s),v.height=Math.floor(i*s),v.style.width=window.innerWidth+"px",v.style.height=i+"px",function(e){const t=n();if(!t.canvasShadowEnabled)return void(e.style.filter="");const a=t.shadowOffsetX||1,i=t.shadowOffsetY||1,s=t.shadowBlur||0,o=t.shadowColor||"#000000",l=t.shadowOpacity||.29,r=t.shadow2Enabled?` drop-shadow(0 0 ${t.shadow2Blur||4}px rgba(0,0,0,${t.shadow2Opacity||.1}))`:"";e.style.filter=`drop-shadow(${a}px ${i}px ${s}px ${function(e,t){const a=e.replace("#",""),n=parseInt(a,16);return`rgba(${n>>16&255}, ${n>>8&255}, ${255&n}, ${t})`}(o,l)})${r}`}(v)}function x(){return v}function y(){return f}function w(){console.log("‚ö†Ô∏è localStorage is disabled")}function E(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(w,500)}class P{constructor(e,t,a,i){const s=n();this.x=e,this.y=t,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=a,this.rBase=a,this.m=s.ballMassKg,this.color=i,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1,this.isSleeping=!1,this.sleepTimer=0}step(a,i){const s=n(),{currentMode:o,G:l,gravityScale:r,FRICTION:d,MASS_BASELINE_KG:c}=s;if(this.t+=a,this.age+=a,this.isSleeping&&o===e.PIT){const e=s.mouseX,t=s.mouseY,a=(s.repelRadius||710)*s.DPR*1.2,n=this.x-e,i=this.y-t;n*n+i*i<a*a&&this.wake()}if(this.isSleeping)return;o!==e.WEIGHTLESS&&(this.vy+=l*r*a);const u=Math.max(.25,this.m/c),h=o===e.WEIGHTLESS?1e-4:d,p=Math.max(0,1-h/u);this.vx*=p,this.vy*=p,0!==this.driftAx&&this.age<this.driftTime?this.vx+=this.driftAx*a/u:0!==this.driftAx&&(this.driftAx=0),i&&i(this,a),this.x+=this.vx*a,this.y+=this.vy*a;const m=Math.max(0,1-t.SPIN_DAMP_PER_S*a);this.omega*=m,this.theta+=this.omega*a;const g=Math.min(1,t.SQUASH_DECAY_PER_S*a);this.squashAmount+=(0-this.squashAmount)*g,this.squash=1-this.squashAmount,o===e.PIT&&this.updateSleepState(a,s)}updateSleepState(e,a){const n=Math.sqrt(this.vx*this.vx+this.vy*this.vy),i=Math.abs(this.omega),s=a.canvas;s&&this.y+this.r>=s.height-1&&n<t.SLEEP_VELOCITY_THRESHOLD&&i<t.SLEEP_ANGULAR_THRESHOLD?(this.sleepTimer+=e,this.sleepTimer>=t.TIME_TO_SLEEP&&(this.vx=0,this.vy=0,this.omega=0,this.isSleeping=!0)):this.sleepTimer=0}wake(){this.isSleeping=!1,this.sleepTimer=0}walls(a,i,s,o){const l=n(),{REST:r,MASS_BASELINE_KG:d,MASS_REST_EXP:c,cornerRadius:u,currentMode:h,DPR:p}=l,m=void 0!==o?o:r,g=h===e.PIT?i/3:0,b=(u||42)*(p||1);let v=!1;const f=[{cx:b,cy:g+b},{cx:a-b,cy:g+b},{cx:b,cy:i-b},{cx:a-b,cy:i-b}];for(let e=0;e<f.length;e++){const t=f[e],n=e%2==0?this.x<b:this.x>a-b,s=e<2?this.y<g+b:this.y>i-b;if(n&&s){const e=this.x-t.cx,a=this.y-t.cy,n=Math.sqrt(e*e+a*a),i=b-this.r;if(n>i&&i>0){v=!0;const t=n-i,s=e/n,o=a/n;this.x-=s*t,this.y-=o*t;const l=this.vx*s+this.vy*o;l>0&&(this.vx-=(1+m)*l*s,this.vy-=(1+m)*l*o)}}}const M=a-0,S=g+0,x=i-0;if(this.y+this.r>x){v=!0,this.y=x-this.r;const e=this.vy,a=this.vx-this.omega*this.r,n=Math.max(.25,this.m/d);this.omega+=a/this.r*t.SPIN_GAIN/n;const i=Math.max(0,1-t.ROLL_FRICTION_PER_S*s/n);this.vx*=i;const o=Math.abs(e)<t.WALL_REST_VEL_THRESHOLD?0:m;this.vy=-this.vy*(o*Math.pow(d/this.m,c));const r=Math.min(1,Math.abs(e)/(90*this.r));this.squashAmount=Math.min(l.getSquashMax(),.8*r),this.squashNormalAngle=-Math.PI/2;const u=this.vx/this.r;this.omega+=(u-this.omega)*Math.min(1,t.GROUND_COUPLING_PER_S*s)}if(this.y-this.r<S){v=!0,this.y=S+this.r,this.vy=-this.vy*m;const e=Math.min(1,Math.abs(this.vy)/(90*this.r));this.squashAmount=Math.min(l.getSquashMax(),.8*e),this.squashNormalAngle=Math.PI/2}if(this.x+this.r>M){v=!0,this.x=M-this.r;const e=this.vy-this.omega*this.r,a=Math.max(.25,this.m/d);this.omega+=e/this.r*(.5*t.SPIN_GAIN)/a,this.vx=-this.vx*(r*Math.pow(d/this.m,c));const n=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(l.getSquashMax(),.8*n),this.squashNormalAngle=Math.PI}if(this.x-this.r<0){v=!0,this.x=0+this.r;const e=this.vy-this.omega*this.r,a=Math.max(.25,this.m/d);this.omega+=e/this.r*(.5*t.SPIN_GAIN)/a,this.vx=-this.vx*(r*Math.pow(d/this.m,c));const n=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(l.getSquashMax(),.8*n),this.squashNormalAngle=0}v&&this.isSleeping&&this.wake()}draw(e){if(e.save(),e.translate(this.x,this.y),e.rotate(this.theta),this.squashAmount>.001){const t=1-.3*this.squashAmount,a=1+.3*this.squashAmount;e.rotate(this.squashNormalAngle),e.scale(t,a),e.rotate(-this.squashNormalAngle)}e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI),e.fillStyle=this.color,e.globalAlpha=this.alpha,e.fill(),e.globalAlpha=1,e.restore()}}function I(e,t,a){a||(a=l());const i=n(),s=(i.R_MIN+i.R_MAX)/2;let o;if(0===i.sizeVariation)o=s;else{const e=.1*s;d=s+e,o=(r=Math.max(1,s-e))+Math.random()*(d-r)}var r,d;const c=new P(e,t,o,a),u=e<.5*i.canvas.width?1:-1,h=(g=o/(.5*(i.R_MIN+i.R_MAX)),Math.max(.6,Math.min(1.4,g))),p=140*h,m=180*h;var g;return c.vx=u*(p+Math.random()*m),c.vy=120*-Math.random(),c.driftAx=u*(360+420*Math.random())*h,c.driftTime=.22+.28*Math.random(),i.balls.push(c),c}function R(){const e=n();i();const t=.5*e.canvas.width,a=.5*e.canvas.height,s=150*e.DPR;for(let e=0;e<8;e++){const n=Math.random()*Math.PI*2,i=Math.random()*s,o=I(t+Math.cos(n)*i,a+Math.sin(n)*i,r(e)),l=.5+.5*Math.random(),d=Math.random()*Math.PI*2,c=300*l;o.vx=Math.cos(d)*c,o.vy=Math.sin(d)*c,o.driftAx=0,o.driftTime=0}for(let e=8;e<60;e++){const e=Math.random()*Math.PI*2,n=Math.random()*s,i=I(t+Math.cos(e)*n,a+Math.sin(e)*n),o=.5+.5*Math.random(),l=Math.random()*Math.PI*2,r=300*o;i.vx=Math.cos(l)*r,i.vy=Math.sin(l)*r,i.driftAx=0,i.driftTime=0}}function _(e,t){const a=n(),i=-1e9===a.mouseX?.5*a.canvas.width:a.mouseX,s=-1e9===a.mouseY?.5*a.canvas.height:a.mouseY,o=i-e.x,l=s-e.y,r=Math.sqrt(o*o+l*l+1),d=o/r,c=l/r;e.vx+=4e3*d*t,e.vy+=4e3*c*t;const u=120*a.DPR;let h=0,p=0,m=0;for(let t=0;t<a.balls.length;t++){const n=a.balls[t];if(n===e)continue;const i=e.x-n.x,s=e.y-n.y,o=i*i+s*s;if(o<u*u&&o>0){const e=Math.sqrt(o),t=1-e/u;h+=i/e*t,p+=s/e*t,m++}}if(m>0){const a=15e3;e.vx+=h/m*a*t,e.vy+=p/m*a*t}e.vx+=1e3*(Math.random()-.5)*t,e.vy+=1e3*(Math.random()-.5)*t}var C=Object.freeze({__proto__:null,applyFliesForces:_,initializeFlies:R});function B(e,t){const a=n(),i=a.repelPower,s=a.repelRadius,o=a.mouseX,l=a.mouseY;if(!a.repellerEnabled||i<=0||s<=0)return;const r=s*a.DPR,d=e.x-o,c=e.y-l,u=d*d+c*c;if(u>r*r)return;const h=Math.max(Math.sqrt(u),1e-4),p=d/h,m=c/h,g=Math.max(0,1-h/r),b=20*i*Math.pow(g,a.repelSoft||3.4),v=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=p*b*t/v,e.vy+=m*b*t/v}function A(){const e=n();i();const t=e.weightlessCount,a=e.canvas.width,s=e.canvas.height,o=40*e.DPR;for(let n=0;n<8&&n<t;n++){const t=I(o+Math.random()*(a-2*o),o+Math.random()*(s-2*o),r(n)),i=Math.random()*Math.PI*2,l=e.weightlessInitialSpeed*(.7+.3*Math.random());t.vx=Math.cos(i)*l,t.vy=Math.sin(i)*l,t.driftAx=0,t.driftTime=0}for(let n=8;n<t;n++){const t=I(o+Math.random()*(a-2*o),o+Math.random()*(s-2*o)),n=Math.random()*Math.PI*2,i=e.weightlessInitialSpeed*(.7+.3*Math.random());t.vx=Math.cos(n)*i,t.vy=Math.sin(n)*i,t.driftAx=0,t.driftTime=0}}var T=Object.freeze({__proto__:null,initializeWeightless:A});const L=[];function N(){const e=n();i(),L.length=0;const t=e.canvas;if(!t)return;const a=t.width,s=t.height,o=e.waterBallCount||100;for(let t=0;t<8&&t<o;t++){const n=Math.random()*a,i=Math.random()*s,o=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),l=r(t),d=new P(n,i,o,l),c=e.waterInitialVelocity||120;d.vx=(Math.random()-.5)*c,d.vy=(Math.random()-.5)*c,e.balls.push(d)}for(let t=8;t<o;t++){const t=Math.random()*a,n=Math.random()*s,i=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),o=l(),r=new P(t,n,i,o),d=e.waterInitialVelocity||120;r.vx=(Math.random()-.5)*d,r.vy=(Math.random()-.5)*d,e.balls.push(r)}}function V(e,t){const a=n(),i=a.waterDrag||.015;e.vx*=1-i,e.vy*=1-i,e.omega*=1-.5*i;for(let a=0;a<L.length;a++){const n=L[a],i=e.x-n.x,s=e.y-n.y,o=Math.sqrt(i*i+s*s),l=40,r=n.radius-l,d=n.radius+l;if(o>r&&o<d){const a=Math.abs(o-n.radius),r=n.strength*(1-a/l);if(o>.1){const a=i/o,n=s/o;e.vx+=a*r*t,e.vy+=n*r*t}}}const s=a.waterDriftStrength||25;e.vx+=Math.sin(.5*e.t+.01*e.x)*s*t,e.vy+=Math.cos(.7*e.t+.01*e.y)*s*t}function F(e){const t=n().waterRippleSpeed||300;for(let a=L.length-1;a>=0;a--){const n=L[a];n.radius+=t*e,n.age+=e,n.strength*=.96,(n.age>3||n.strength<10)&&L.splice(a,1)}}function G(e,t,a=1){const i=(n().waterRippleStrength||15e3)*Math.min(a,5);L.push({x:e,y:t,radius:0,strength:i,age:0})}var D=Object.freeze({__proto__:null,applyWaterForces:V,createWaterRipple:G,initializeWater:N,updateWaterRipples:F});function O(){const e=n();i();const t=e.canvas;if(!t)return;const a=t.width,s=t.height,o=Math.min(e.vortexBallCount||180,e.maxBalls||300);for(let t=0;t<8&&t<o;t++){const n=Math.random()*a,i=Math.random()*s,o=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),l=r(t),d=new P(n,i,o,l);d.vx=80*(Math.random()-.5),d.vy=80*(Math.random()-.5),e.balls.push(d)}for(let t=8;t<o;t++){const t=Math.random()*a,n=Math.random()*s,i=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),o=l(),r=new P(t,n,i,o);r.vx=80*(Math.random()-.5),r.vy=80*(Math.random()-.5),e.balls.push(r)}}function z(t,a){const i=n();if(i.currentMode!==e.VORTEX)return;const s=i.mouseX,o=i.mouseY;if(!i.mouseInCanvas)return;const l=i.vortexSwirlStrength||420,r=i.vortexRadialPull||180,d=t.x-s,c=t.y-o,u=d*d+c*c,h=Math.max(8,Math.sqrt(u)),p=1/(1+.0015*h),m=d/h,g=c/h,b=-g,v=m,f=l*p;t.vx+=b*f*a,t.vy+=v*f*a;const M=r*p;t.vx-=m*M*a,t.vy-=g*M*a,t.vx*=.995,t.vy*=.995}var k=Object.freeze({__proto__:null,applyVortexForces:z,initializeVortex:O});function q(){const e=n();i();const t=e.canvas;if(!t)return;const a=t.width,s=t.height,o=Math.min(e.pingPongBallCount||80,e.maxBalls||300),d=e.pingPongSpeed||400;for(let t=0;t<8&&t<o;t++){const n=Math.random()*a,i=.15*s+Math.random()*s*.7,o=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),l=r(t),c=new P(n,i,o,l),u=Math.random()>.5?1:-1;c.vx=u*(.8*d+Math.random()*d*.4),c.vy=0,c.isPingPong=!0,e.balls.push(c)}for(let t=8;t<o;t++){const t=Math.random()*a,n=.15*s+Math.random()*s*.7,i=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),o=l(),r=new P(t,n,i,o),c=Math.random()>.5?1:-1;r.vx=c*(.8*d+Math.random()*d*.4),r.vy=0,r.isPingPong=!0,e.balls.push(r)}}function X(t,a){const i=n();if(i.currentMode!==e.PING_PONG)return;if(!t.isPingPong)return;if(i.mouseInCanvas){const e=(i.pingPongCursorRadius||100)*i.DPR,a=i.mouseX,n=i.mouseY,s=t.x-a,o=t.y-n,l=Math.sqrt(s*s+o*o),r=e+t.r;if(l<r&&l>.1){const e=r-l,a=s/l,n=o/l;t.x+=a*e*1.1,t.y+=n*e*1.1;const i=t.vx*a+t.vy*n;i<0&&(t.vx-=2*i*a,t.vy-=2*i*n,t.omega+=.02*i)}}const s=i.pingPongSpeed||400;if(Math.abs(t.vx)<.9*s){const e=t.vx>=0?1:-1;t.vx=e*s}t.vy*=.995}var H=Object.freeze({__proto__:null,applyPingPongForces:X,initializePingPong:q});function W(){const e=n();i();const t=e.canvas;if(!t)return;const a=t.width,s=t.height,o=Math.min(e.magneticBallCount||180,e.maxBalls||300);for(let t=0;t<8&&t<o;t++){const n=Math.random()*a,i=Math.random()*s,o=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),l=r(t),d=new P(n,i,o,l);d.vx=100*(Math.random()-.5),d.vy=100*(Math.random()-.5),d.charge=Math.random()>.5?1:-1,d.baseAlpha=1,e.balls.push(d)}for(let t=8;t<o;t++){const t=Math.random()*a,n=Math.random()*s,i=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),o=l(),r=new P(t,n,i,o);r.vx=100*(Math.random()-.5),r.vy=100*(Math.random()-.5),r.charge=Math.random()>.5?1:-1,r.baseAlpha=1,e.balls.push(r)}}function U(t,a){const i=n();if(i.currentMode!==e.MAGNETIC)return;if(!i.mouseInCanvas)return;const s=i.mouseX,o=i.mouseY,l=s-t.x,r=o-t.y,d=Math.max(30,Math.sqrt(l*l+r*r)),c=(i.magneticStrength||65e3)/(d*d)*1e3,u=l/d,h=r/d,p=t.charge||1;t.vx+=u*c*p*a,t.vy+=h*c*p*a;const m=i.magneticMaxVelocity||2800,g=Math.sqrt(t.vx*t.vx+t.vy*t.vy);g>m&&(t.vx=t.vx/g*m,t.vy=t.vy/g*m),t.vx*=.998,t.vy*=.998}var Y=Object.freeze({__proto__:null,applyMagneticForces:U,initializeMagnetic:W});function $(e,t,a,i=!1){const s=n(),o=.5*s.R_MIN,l=.8*s.R_MAX,r=o+Math.random()*(l-o),d=new P(e,t,i?r:.1,a);return d.isBubble=!0,d.baseRadius=r,d.targetRadius=r,d.wobblePhase=Math.random()*Math.PI*2,d.wobbleFreq=2+3*Math.random(),d.vx=20*(Math.random()-.5),d.vy=-50-50*Math.random(),d.spawning=!i,d.spawnProgress=i?1:0,d.dissipating=!1,d.dissipateProgress=0,d.alpha=1,s.balls.push(d),d}function j(e){const t=n(),a=t.canvas;if(!a)return;const i=a.width,s=a.height;e.x=Math.random()*i,e.y=s+20+30*Math.random(),e.vx=20*(Math.random()-.5),e.vy=-50-50*Math.random(),e.wobblePhase=Math.random()*Math.PI*2,e.wobbleFreq=2+3*Math.random(),e.c=l();const o=.5*t.R_MIN,r=.8*t.R_MAX;e.targetRadius=o+Math.random()*(r-o),e.baseRadius=e.targetRadius,e.r=.1,e.spawning=!0,e.spawnProgress=0,e.dissipating=!1,e.dissipateProgress=0,e.alpha=1}function K(t,a){const i=n();if(i.currentMode!==e.BUBBLES)return;if(!t.isBubble)return;const s=i.canvas;if(!s)return;if(t.spawning){t.spawnProgress+=3*a;const e=1-Math.pow(1-Math.min(1,t.spawnProgress),3);t.r=t.targetRadius*e,t.rBase=t.r,t.spawnProgress>=1&&(t.spawning=!1,t.r=t.targetRadius,t.rBase=t.targetRadius)}if(t.dissipating){t.dissipateProgress+=3*a;const e=Math.pow(t.dissipateProgress,2);return t.r=t.targetRadius*Math.max(0,1-e),t.rBase=t.r,t.alpha=Math.max(0,1-.5*e),t.vy*=.92,t.vx*=.92,void(t.dissipateProgress>=1&&j(t))}const o=i.bubblesRiseSpeed||150,l=.01*(i.bubblesWobble||40),r=o*i.DPR;t.vy-=r*a,t.wobblePhase+=t.wobbleFreq*a;const d=Math.sin(t.wobblePhase)*l*100;if(t.vx+=d*a,t.vx*=.92,t.vy*=.96,i.mouseInCanvas){const e=t.x-i.mouseX,n=t.y-i.mouseY,s=Math.sqrt(e*e+n*n),o=(i.bubblesDeflectRadius||80)*i.DPR;if(s<o&&s>1){const i=300*(1-s/o),l=e/s,r=n/s;t.vx+=l*i*a,t.vy+=r*i*a}}const c=2*t.targetRadius;t.y<c&&!t.dissipating&&!t.spawning&&(t.dissipating=!0,t.dissipateProgress=0),(t.x<4*-t.r||t.x>s.width+4*t.r)&&j(t)}function Z(t){const s=n();if(function(e){a.currentMode=e}(t),console.log(`Switching to mode: ${t}`),function(e){const t=document.getElementById("announcer");t&&(t.textContent="",setTimeout(()=>{t.textContent=e},10))}(`Switched to ${{pit:"Ball Pit",flies:"Flies to Light",weightless:"Zero Gravity",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles"}[t]||t} mode`),s.container){const a=s.container.classList.contains("dark-mode");s.container.className="",t===e.PIT&&s.container.classList.add("mode-pit"),(a||s.isDarkMode)&&s.container.classList.add("dark-mode")}S(),t===e.PIT?(s.gravityMultiplier=s.gravityMultiplierPit,s.G=s.GE*s.gravityMultiplier,s.repellerEnabled=!0,function(){const e=n();i(),e.canvas.width;const t=e.canvas.clientHeight,a=e.DPR,s=-.5*t*a,o=s+.5*t*a,l=1*e.canvas.clientWidth,d=.5*e.canvas.clientWidth-l/2;for(let e=0;e<8;e++){const t=I((d+Math.random()*l)*a,s+Math.random()*(o-s),r(e));t.vx=100*(Math.random()-.5),t.vy=50*Math.random(),t.driftAx=0,t.driftTime=0}for(let e=8;e<300;e++){const e=I((d+Math.random()*l)*a,s+Math.random()*(o-s));e.vx=100*(Math.random()-.5),e.vy=50*Math.random(),e.driftAx=0,e.driftTime=0}}()):t===e.FLIES?(s.gravityMultiplier=0,s.G=0,s.repellerEnabled=!1,R()):t===e.WEIGHTLESS?(s.gravityMultiplier=0,s.G=0,s.repellerEnabled=!1,A()):t===e.WATER?(s.gravityMultiplier=0,s.G=0,s.repellerEnabled=!1,N()):t===e.VORTEX?(s.gravityMultiplier=0,s.G=0,s.repellerEnabled=!1,O()):t===e.PING_PONG?(s.gravityMultiplier=0,s.G=0,s.repellerEnabled=!1,q()):t===e.MAGNETIC?(s.gravityMultiplier=0,s.G=0,s.repellerEnabled=!1,W()):t===e.BUBBLES&&(s.gravityMultiplier=0,s.G=0,s.repellerEnabled=!1,function(){const e=n();e.balls.length=0;const t=e.canvas;if(!t)return;const a=t.width,i=t.height,s=e.bubblesMaxCount||150;for(let e=0;e<8&&e<s;e++)$(Math.random()*a,.3*i+Math.random()*i*.6,r(e),!0);for(let e=8;e<s;e++)$(Math.random()*a,.3*i+Math.random()*i*.6,l(),!0)}()),console.log(`Mode ${t} initialized with ${s.balls.length} balls`)}function Q(){const t=n();return t.currentMode===e.FLIES?_:t.currentMode===e.PIT?B:t.currentMode===e.WATER?V:t.currentMode===e.VORTEX?z:t.currentMode===e.PING_PONG?X:t.currentMode===e.MAGNETIC?U:t.currentMode===e.BUBBLES?K:null}var J=Object.freeze({__proto__:null,MODES:e,getForceApplicator:Q,setMode:Z});function ee(e,t){const a=document.getElementById(e);a&&a.addEventListener("input",()=>t(a))}function te(e,t){const a=document.getElementById(e);a&&(a.textContent=t)}function ae(){const e=n();document.querySelectorAll(".mode-button").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const a=e.getAttribute("data-mode");console.log("Mode button clicked:",a),Z(a),ne(a)})}),ee("sizeSliderGlobal",t=>{e.sizeScale=parseFloat(t.value),te("sizeValGlobal",e.sizeScale.toFixed(2));const a=(e.R_MIN_BASE+e.R_MAX_BASE)/2;e.R_MIN=a*e.sizeScale*.75,e.R_MAX=a*e.sizeScale*1.25;const n=(e.R_MIN+e.R_MAX)/2;for(let t=0;t<e.balls.length;t++)e.balls[t].r=n,e.balls[t].rBase=n;E()}),ee("ballSoftnessSliderGlobal",t=>{e.ballSoftness=parseInt(t.value,10),te("ballSoftnessValGlobal",String(e.ballSoftness)),E()}),ee("gravityPitSlider",t=>{e.gravityMultiplierPit=parseFloat(t.value),te("gravityPitVal",e.gravityMultiplierPit.toFixed(2)),"pit"===e.currentMode&&(e.G=e.GE*e.gravityMultiplierPit),E()}),ee("weightPitSlider",t=>{e.ballMassKg=parseFloat(t.value),te("weightPitVal",e.ballMassKg.toFixed(0));for(let t=0;t<e.balls.length;t++)e.balls[t].m=e.ballMassKg;E()}),ee("restitutionSlider",t=>{e.REST=parseFloat(t.value),te("restitutionVal",e.REST.toFixed(2)),E()}),ee("frictionSlider",t=>{e.FRICTION=parseFloat(t.value),te("frictionVal",e.FRICTION.toFixed(4)),E()});const t=document.getElementById("repellerEnabledPit");t&&t.addEventListener("change",()=>{e.repellerEnabled=!!t.checked,E()}),ee("repelSizeSlider",t=>{e.repelRadius=parseFloat(t.value),te("repelSizeVal",e.repelRadius.toFixed(0)),E()}),ee("repelPowerSlider",t=>{const a=parseFloat(t.value),n=Math.max(0,Math.min(1e4,a))/1e4,i=12e3*Math.pow(2,12*(n-.5))*2;e.repelPower=i,te("repelPowerVal",Math.round(e.repelPower).toString()),E()}),ee("repelSoftSlider",t=>{e.repelSoft=parseFloat(t.value),te("repelSoftVal",e.repelSoft.toFixed(1)),E()}),ee("fliesBallCountSlider",t=>{e.fliesBallCount=parseInt(t.value,10),te("fliesBallCountVal",String(e.fliesBallCount)),"flies"===e.currentMode&&Promise.resolve().then(function(){return C}).then(({initializeFlies:e})=>{e()})}),ee("attractPowerSlider",t=>{e.attractionPower=parseFloat(t.value),te("attractPowerVal",Math.round(e.attractionPower).toString())}),ee("swarmSpeedSlider",t=>{e.swarmSpeed=parseFloat(t.value),te("swarmSpeedVal",e.swarmSpeed.toFixed(1))}),ee("fliesSeparationSlider",t=>{e.fliesSeparation=parseFloat(t.value),te("fliesSeparationVal",Math.round(e.fliesSeparation).toString())}),ee("weightlessCountSlider",t=>{e.weightlessBallCount=parseInt(t.value,10),te("weightlessCountVal",String(e.weightlessBallCount)),"weightless"===e.currentMode&&Promise.resolve().then(function(){return T}).then(({initializeWeightless:e})=>{e()})}),ee("weightlessSpeedSlider",t=>{e.weightlessInitialSpeed=parseFloat(t.value),te("weightlessSpeedVal",e.weightlessInitialSpeed.toFixed(0)),"weightless"===e.currentMode&&Promise.resolve().then(function(){return T}).then(({initializeWeightless:e})=>{e()})}),ee("weightlessBounceSlider",t=>{e.weightlessBounce=parseFloat(t.value),te("weightlessBounceVal",e.weightlessBounce.toFixed(2))}),ee("waterBallCountSlider",t=>{e.waterBallCount=parseInt(t.value,10),te("waterBallCountVal",String(e.waterBallCount)),"water"===e.currentMode&&Promise.resolve().then(function(){return D}).then(({initializeWater:e})=>{e()}),E()}),ee("waterRippleStrengthSlider",t=>{e.waterRippleStrength=parseFloat(t.value),te("waterRippleStrengthVal",e.waterRippleStrength.toFixed(0)),E()}),ee("waterMotionSlider",t=>{const a=parseFloat(t.value);e.waterDriftStrength=a,e.waterInitialVelocity=5*a,te("waterMotionVal",a.toFixed(0)),"water"===e.currentMode&&Promise.resolve().then(function(){return D}).then(({initializeWater:e})=>{e()}),E()}),ee("vortexBallCountSlider",t=>{e.vortexBallCount=parseInt(t.value,10),te("vortexBallCountVal",String(e.vortexBallCount)),"vortex"===e.currentMode&&Promise.resolve().then(function(){return k}).then(({initializeVortex:e})=>{e()})}),ee("vortexSwirlSlider",t=>{e.vortexSwirlStrength=parseFloat(t.value),te("vortexSwirlVal",e.vortexSwirlStrength.toFixed(0))}),ee("vortexPullSlider",t=>{e.vortexRadialPull=parseFloat(t.value),te("vortexPullVal",e.vortexRadialPull.toFixed(0))}),ee("pingPongBallCountSlider",t=>{e.pingPongBallCount=parseInt(t.value,10),te("pingPongBallCountVal",String(e.pingPongBallCount)),"ping-pong"===e.currentMode&&Promise.resolve().then(function(){return H}).then(({initializePingPong:e})=>{e()})}),ee("pingPongSpeedSlider",t=>{e.pingPongSpeed=parseFloat(t.value),te("pingPongSpeedVal",e.pingPongSpeed.toFixed(0)),"ping-pong"===e.currentMode&&Promise.resolve().then(function(){return H}).then(({initializePingPong:e})=>{e()})}),ee("pingPongCursorSlider",t=>{e.pingPongCursorRadius=parseFloat(t.value),te("pingPongCursorVal",e.pingPongCursorRadius.toFixed(0))}),ee("magneticBallCountSlider",t=>{e.magneticBallCount=parseInt(t.value,10),te("magneticBallCountVal",String(e.magneticBallCount)),"magnetic"===e.currentMode&&Promise.resolve().then(function(){return Y}).then(({initializeMagnetic:e})=>{e()})}),ee("magneticStrengthSlider",t=>{e.magneticStrength=parseFloat(t.value),te("magneticStrengthVal",e.magneticStrength.toFixed(0))}),ee("magneticVelocitySlider",t=>{e.magneticMaxVelocity=parseFloat(t.value),te("magneticVelocityVal",e.magneticMaxVelocity.toFixed(0))}),ee("magneticIntervalSlider",t=>{e.magneticExplosionInterval=parseInt(t.value,10),te("magneticIntervalVal",String(e.magneticExplosionInterval))}),ee("bubblesRateSlider",t=>{e.bubblesSpawnRate=parseInt(t.value,10),te("bubblesRateVal",String(e.bubblesSpawnRate))}),ee("bubblesSpeedSlider",t=>{e.bubblesRiseSpeed=parseFloat(t.value),te("bubblesSpeedVal",e.bubblesRiseSpeed.toFixed(0))}),ee("bubblesWobbleSlider",t=>{e.bubblesWobble=parseFloat(t.value),te("bubblesWobbleVal",e.bubblesWobble.toFixed(0))}),ee("bubblesMaxSlider",t=>{e.bubblesMaxCount=parseInt(t.value,10),te("bubblesMaxVal",String(e.bubblesMaxCount))}),ee("bubblesDeflectSlider",t=>{e.bubblesDeflectRadius=parseFloat(t.value),te("bubblesDeflectVal",e.bubblesDeflectRadius.toFixed(0))}),c();const a=document.getElementById("colorSelect");a&&a.addEventListener("change",()=>{d(a.value),E()})}function ne(e){document.querySelectorAll(".mode-button").forEach(t=>{const a=t.getAttribute("data-mode")===e;t.classList.toggle("active",a)}),document.querySelectorAll(".mode-controls").forEach(e=>e.classList.remove("active"));const t=e+"Controls",a=document.getElementById(t);a&&a.classList.add("active");const n=document.getElementById("announcer");if(n){const t={pit:"Ball Pit",flies:"Flies to Light",weightless:"Zero-G",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles"};n.textContent=`Switched to ${t[e]||e} mode`}}var ie=Object.freeze({__proto__:null,setupControls:ae,updateModeButtonsUI:ne});let se=0,oe=0,le=0,re=0,de=0;const ce=[e.PIT,e.FLIES,e.WEIGHTLESS,e.WATER,e.VORTEX,e.PING_PONG,e.MAGNETIC,e.BUBBLES];function ue(){const e=n().currentMode,t=ce.indexOf(e),a=ce[(t+1)%ce.length]||ce[0];Promise.resolve().then(function(){return J}).then(({setMode:e})=>{e(a)}),Promise.resolve().then(function(){return ie}).then(({updateModeButtonsUI:e})=>{e(a)})}let he=0;const pe=new Map;function me(e=10){const a=n(),i=a.balls,s=function(){const e=n(),a=e.balls,i=e.canvas,s=e.R_MAX,o=a.length;if(o<2)return[];const l=Math.max(1,2*s),r=Math.ceil(i.width/l)+1;pe.clear();for(let e=0;e<o;e++){const t=a[e],n=t.x/l|0,i=(t.y/l|0)*r+n;let s=pe.get(i);s||(s=[],pe.set(i,s)),s.push(e)}const d=[];for(const[e,n]of pe){const i=e/r|0,s=e%r;for(let e=-1;e<=1;e++)for(let o=-1;o<=1;o++){const l=(i+e)*r+(s+o),c=pe.get(l);if(c)for(let e=0;e<n.length;e++){const i=n[e];for(let e=0;e<c.length;e++){const n=c[e];if(n<=i)continue;const s=a[i],o=a[n],l=o.x-s.x,r=o.y-s.y,u=s.r+o.r,h=l*l+r*r;if(h<u*u){const e=u-Math.sqrt(Math.max(h,t.MIN_DISTANCE_EPSILON));d.push({i:i,j:n,overlap:e})}}}}}return d.sort((e,t)=>t.overlap-e.overlap),d}(),o=a.REST,l=.5*a.DPR;for(let n=0;n<e;n++)for(let e=0;e<s.length;e++){const{i:n,j:r}=s[e],d=i[n],c=i[r];if(d.isSleeping&&c.isSleeping)continue;d.isSleeping&&d.wake(),c.isSleeping&&c.wake();const u=c.x-d.x,h=c.y-d.y,p=d.r+c.r,m=u*u+h*h;if(0===m||m>p*p)continue;const g=Math.sqrt(m),b=u/g,v=h/g,f=p-g,M=1/Math.max(d.m,.001),S=1/Math.max(c.m,.001),x=.8*Math.max(f-l,0)/(M+S),y=x*b,w=x*v;d.x-=y*M,d.y-=w*M,c.x+=y*S,c.y+=w*S;const E=c.vx-d.vx,P=c.vy-d.vy,I=E*b+P*v;if(I<0){const e=-(1+(Math.abs(I)<30?0:o))*I/(M+S),n=e*b,i=e*v;d.vx-=n*M,d.vy-=i*M,c.vx+=n*S,c.vy+=i*S;const s=E-I*b,l=P-I*v,r=Math.hypot(s,l);if(r>.001){const e=s*-v+l*b>=0?1:-1,a=t.SPIN_GAIN_TANGENT;d.omega-=e*a*r/Math.max(d.r,1),c.omega+=e*a*r/Math.max(c.r,1)}const u=Math.min(1,Math.abs(I)/(50*(d.r+c.r))),h=Math.min(a.getSquashMax(),.8*u);d.squashAmount=Math.max(d.squashAmount,.8*h),d.squashNormalAngle=Math.atan2(-v,-b),c.squashAmount=Math.max(c.squashAmount,.8*h),c.squashNormalAngle=Math.atan2(v,b)}}}const ge=t.PHYSICS_DT;let be=0;const ve=42;function fe(e,t){const a=[{x:ve,y:ve},{x:t.width-ve,y:ve},{x:ve,y:t.height-ve},{x:t.width-ve,y:t.height-ve}];for(let t=0;t<a.length;t++){const n=a[t].x,i=a[t].y,s=e.x-n,o=e.y-i,l=Math.max(1,Math.hypot(s,o));if(l<ve+e.r){const t=(ve+e.r-l)/(ve+e.r)*1800,a=s/l,n=o/l;e.vx+=a*t*ge,e.vy+=n*t*ge}}}let Me=0,Se=0,xe=0,ye=performance.now()/1e3;!async function(){try{console.log("üöÄ Initializing modular bouncy balls..."),function(e){a.config={...e},e.ballMass&&(a.ballMassKg=e.ballMass),e.gravityMultiplier&&(a.gravityMultiplier=e.gravityMultiplier),e.restitution&&(a.REST=e.restitution),e.friction&&(a.FRICTION=e.friction),e.ballScale&&(a.sizeScale=e.ballScale);const t=(a.R_MIN_BASE+a.R_MAX_BASE)/2;a.R_MIN=t*a.sizeScale*.75,a.R_MAX=t*a.sizeScale*1.25}(await async function(){try{const e=["config/default-config.json","js/config.json","../public/js/config.json"];for(const t of e)try{const e=await fetch(t,{cache:"no-cache"});if(e.ok)return await e.json()}catch(e){}throw new Error("No config found")}catch(e){return console.warn("Config load failed, using defaults"),{gravityMultiplier:1.05,ballMass:91,maxBalls:300}}}()),console.log("‚úì Config loaded"),M();const s=x(),o=y(),l=document.getElementById("bravia-balls");if(!s||!o||!l)throw new Error("Missing DOM elements");!function(e,t,n){a.canvas=e,a.ctx=t,a.container=n}(s,o,l),console.log("‚úì Canvas initialized"),n().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),function(){const a=n(),i=a.canvas;if(!i)return void console.error("Canvas not available for pointer setup");const s=a.DPR;function o(e,t){const a=i.getBoundingClientRect();return{x:(e-a.left)*s,y:(t-a.top)*s,inBounds:e>=a.left&&e<=a.right&&t>=a.top&&t<=a.bottom}}document.addEventListener("mousemove",t=>{if(t.target.closest("#controlPanel"))return;const n=o(t.clientX,t.clientY),i=performance.now(),s=i-le;if(s>0&&le>0){const e=n.x-se,t=n.y-oe;re=Math.sqrt(e*e+t*t)/s}if(a.mouseX=n.x,a.mouseY=n.y,a.mouseInCanvas=n.inBounds,"undefined"!=typeof window&&(window.mouseInCanvas=n.inBounds),a.currentMode===e.WATER&&n.inBounds&&re>.3&&i-he>80){const e=Math.min(2*re,3);G(n.x,n.y,e),he=i}se=n.x,oe=n.y,le=i},{passive:!0}),document.addEventListener("click",e=>{e.target.closest("#controlPanel")||e.target.closest("a")||e.target.closest("button")||o(e.clientX,e.clientY).inBounds&&ue()}),document.addEventListener("touchmove",t=>{if(t.touches&&t.touches[0]){const n=o(t.touches[0].clientX,t.touches[0].clientY);a.mouseX=n.x,a.mouseY=n.y,a.mouseInCanvas=n.inBounds;const i=performance.now();a.currentMode===e.WATER&&n.inBounds&&i-he>80&&(G(n.x,n.y,2),he=i)}},{passive:!0}),document.addEventListener("touchstart",e=>{if(!e.target.closest("#controlPanel")&&!e.target.closest("a")&&!e.target.closest("button")&&e.touches&&e.touches[0]){if(!o(e.touches[0].clientX,e.touches[0].clientY).inBounds)return;const t=performance.now();t-de<300&&ue(),de=t}},{passive:!0}),document.addEventListener("mouseleave",()=>{a.mouseX=t.OFFSCREEN_MOUSE,a.mouseY=t.OFFSCREEN_MOUSE,a.mouseInCanvas=!1,re=0,"undefined"!=typeof window&&(window.mouseInCanvas=!1)}),document.addEventListener("touchend",()=>{a.mouseX=t.OFFSCREEN_MOUSE,a.mouseY=t.OFFSCREEN_MOUSE,a.mouseInCanvas=!1},{passive:!0}),console.log("‚úì Unified pointer system configured (document-level)")}(),console.log("‚úì Pointer tracking configured"),console.log("‚ö†Ô∏è localStorage is disabled - using defaults"),b(),console.log("‚úì Dark mode initialized"),d(n().currentTemplate),console.log("‚úì Color system initialized"),function(){let e=document.getElementById("controlPanel");e?e.parentElement!==document.body&&(e.parentElement.removeChild(e),document.body.appendChild(e)):(e=document.createElement("div"),e.id="controlPanel",e.className="panel",document.body.appendChild(e)),e.innerHTML='\n  \x3c!-- Draggable header --\x3e\n  <div class="panel-header" id="panelHeader" role="banner">\n    <span><span class="drag-handle" aria-hidden="true">‚ãÆ‚ãÆ</span>Controls</span>\n    <button style="cursor: pointer; opacity: 0.7; background: none; border: none; color: inherit; font-size: 16px; padding: 0;" id="minimizePanel" title="Toggle panel" aria-label="Toggle control panel" aria-expanded="true">‚àí</button>\n  </div>\n  \n  \x3c!-- Screen reader announcements --\x3e\n  <div role="status" aria-live="polite" aria-atomic="true" style="position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;" id="announcer"></div>\n  \n  <div class="panel-content">\n  \n  \x3c!-- Theme Segment Control --\x3e\n  <div style="margin-bottom: 12px; padding: 8px; background: rgba(100,100,255,0.15); border-radius: 4px; border: 1px solid rgba(100,100,255,0.3);">\n    <div style="font-weight: 600; font-size: 11px; margin-bottom: 8px;">üé® Theme</div>\n    <div class="theme-segment-control" role="group" aria-label="Theme selector">\n      <button id="themeAuto" class="theme-segment-btn" aria-label="Auto theme">Auto</button>\n      <button id="themeLight" class="theme-segment-btn active" aria-label="Light theme">Light</button>\n      <button id="themeDark" class="theme-segment-btn" aria-label="Dark theme">Dark</button>\n    </div>\n    <div id="themeStatus" style="font-size: 9px; margin-top: 8px; padding: 4px; background: rgba(0,0,0,0.2); border-radius: 3px; font-family: monospace; text-align: center;">\n      ‚òÄÔ∏è Light Mode\n    </div>\n  </div>\n  \n  \x3c!-- GLOBAL SETTINGS --\x3e\n  <details open>\n    <summary>üåê Global Ball Properties</summary>\n    <div class="group">\n        <label title="Global ball size scale (0.1-6.0)">Size: <span class="val" id="sizeValGlobal">1.2</span><input type="range" id="sizeSliderGlobal" min="0.1" max="6.0" step="0.05" value="1.2"></label>\n        <label title="Ball deformation (0-100)">Softness: <span class="val" id="ballSoftnessValGlobal">20</span><input type="range" id="ballSoftnessSliderGlobal" min="0" max="100" step="1" value="20"></label>\n    </div>\n  </details>\n  \n  \x3c!-- Build Controls --\x3e\n  <div style="margin-bottom: 12px; padding: 8px; background: rgba(0,255,0,0.1); border-radius: 4px; text-align: center;">\n    <button id="saveConfigBtn" style="background: #4CAF50; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: bold;">üíæ Save Config</button>\n    <div style="font-size: 9px; opacity: 0.7; margin-top: 6px;">Save downloads current-config.json</div>\n  </div>\n  \n  <details open>\n    <summary>üé® Colors</summary>\n    <div class="group">\n        <label>Color template: <select id="colorSelect"></select></label>\n    </div>\n  </details>\n  \n  <div style="margin: 20px 0; padding: 12px 0; border-top: 1px solid rgba(255,255,255,0.15);">\n    <div style="text-align: center; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; opacity: 0.6; margin-bottom: 12px;">\n      Mode Settings\n    </div>\n    \n    \x3c!-- Mode Switcher --\x3e\n    <div class="mode-switcher" role="group" aria-label="Simulation mode selector">\n      <button class="mode-button" data-mode="pit" aria-label="Ball Pit mode">üéØ Pit</button>\n      <button class="mode-button active" data-mode="flies" aria-label="Flies mode">üïäÔ∏è Flies</button>\n      <button class="mode-button" data-mode="weightless" aria-label="Zero-G mode">üåå Zero-G</button>\n      <button class="mode-button" data-mode="water" aria-label="Water mode">üåä Water</button>\n      <button class="mode-button" data-mode="vortex" aria-label="Vortex mode">üåÄ Vortex</button>\n      <button class="mode-button" data-mode="ping-pong" aria-label="Ping Pong mode">üèì Pong</button>\n      <button class="mode-button" data-mode="magnetic" aria-label="Magnetic mode">üß≤ Magnet</button>\n      <button class="mode-button" data-mode="bubbles" aria-label="Bubbles mode">ü´ß Bubbles</button>\n    </div>\n  </div>\n  \n  <div id="pitControls" class="mode-controls">\n    <details open>\n      <summary>üéØ Ball Pit Mode</summary>\n      <div class="group">\n        <label><span>Gravity (√óEarth)</span><input type="range" id="gravityPitSlider" min="0.0" max="2.0" step="0.05" value="1.10"><span class="val" id="gravityPitVal">1.10</span></label>\n        <label><span>Weight (grams)</span><input type="range" id="weightPitSlider" min="10.0" max="200.0" step="1.0" value="129"><span class="val" id="weightPitVal">129</span></label>\n        <label><span>Bounciness</span><input type="range" id="restitutionSlider" min="0.00" max="1.00" step="0.01" value="0.69"><span class="val" id="restitutionVal">0.69</span></label>\n        <label><span>Air friction</span><input type="range" id="frictionSlider" min="0.000" max="0.010" step="0.0005" value="0.0060"><span class="val" id="frictionVal">0.0060</span></label>\n      </div>\n    </details>\n    <details open>\n      <summary>üß≤ Mouse Repeller</summary>\n      <div class="group">\n        <label><span>Repel size (px)</span><input type="range" id="repelSizeSlider" min="50" max="1000" step="5" value="120"><span class="val" id="repelSizeVal">120</span></label>\n        <label><span>Repel power</span><input type="range" id="repelPowerSlider" min="0" max="10000" step="100" value="8500"><span class="val" id="repelPowerVal">274000</span></label>\n      </div>\n    </details>\n  </div>\n  \n  <div id="fliesControls" class="mode-controls active">\n    <details open>\n      <summary>üïäÔ∏è Flies to Light Mode</summary>\n      <div class="group">\n        <label><span>Ball count</span><input type="range" id="fliesBallCountSlider" min="20" max="150" step="5" value="60"><span class="val" id="fliesBallCountVal">60</span></label>\n        <label><span>Attraction power</span><input type="range" id="attractPowerSlider" min="100" max="8000" step="50" value="5000"><span class="val" id="attractPowerVal">5000</span></label>\n        <label><span>Swarm speed (√ó)</span><input type="range" id="swarmSpeedSlider" min="0.2" max="5.0" step="0.1" value="0.4"><span class="val" id="swarmSpeedVal">0.4</span></label>\n        <label><span>Separation force</span><input type="range" id="fliesSeparationSlider" min="5000" max="30000" step="1000" value="15000"><span class="val" id="fliesSeparationVal">15000</span></label>\n      </div>\n    </details>\n  </div>\n  \n  <div id="weightlessControls" class="mode-controls">\n    <details open>\n      <summary>üåå Zero-G Mode</summary>\n      <div class="group">\n        <label><span>Ball count</span><input type="range" id="weightlessCountSlider" min="20" max="200" step="10" value="80"><span class="val" id="weightlessCountVal">80</span></label>\n        <label><span>Initial speed</span><input type="range" id="weightlessSpeedSlider" min="100" max="600" step="25" value="250"><span class="val" id="weightlessSpeedVal">250</span></label>\n        <label><span>Bounce</span><input type="range" id="weightlessBounceSlider" min="0.5" max="1.0" step="0.05" value="0.95"><span class="val" id="weightlessBounceVal">0.95</span></label>\n      </div>\n    </details>\n  </div>\n  \n  <div id="waterControls" class="mode-controls">\n    <details open>\n      <summary>üåä Water Swimming Mode</summary>\n      <div class="group">\n        <label><span>Ball count</span><input type="range" id="waterBallCountSlider" min="50" max="400" step="10" value="300"><span class="val" id="waterBallCountVal">300</span></label>\n        <label><span>Ripple strength</span><input type="range" id="waterRippleStrengthSlider" min="5000" max="30000" step="1000" value="18000"><span class="val" id="waterRippleStrengthVal">18000</span></label>\n        <label><span>Motion intensity</span><input type="range" id="waterMotionSlider" min="0" max="80" step="1" value="40"><span class="val" id="waterMotionVal">40</span></label>\n        <div style="font-size: 9px; opacity: 0.7; margin-top: 6px;">Move your cursor to create ripples</div>\n      </div>\n    </details>\n  </div>\n  \n  <div id="vortexControls" class="mode-controls">\n    <details open>\n      <summary>üåÄ Vortex Sheets Mode</summary>\n      <div class="group">\n        <label><span>Ball count</span><input type="range" id="vortexBallCountSlider" min="50" max="300" step="10" value="180"><span class="val" id="vortexBallCountVal">180</span></label>\n        <label><span>Swirl strength</span><input type="range" id="vortexSwirlSlider" min="100" max="800" step="20" value="420"><span class="val" id="vortexSwirlVal">420</span></label>\n        <label><span>Radial pull</span><input type="range" id="vortexPullSlider" min="0" max="400" step="10" value="180"><span class="val" id="vortexPullVal">180</span></label>\n        <div style="font-size: 9px; opacity: 0.7; margin-top: 6px;">Move cursor to create vortex</div>\n      </div>\n    </details>\n  </div>\n  \n  <div id="ping-pongControls" class="mode-controls">\n    <details open>\n      <summary>üèì Ping Pong Mode</summary>\n      <div class="group">\n        <label><span>Ball count</span><input type="range" id="pingPongBallCountSlider" min="10" max="100" step="5" value="35"><span class="val" id="pingPongBallCountVal">35</span></label>\n        <label><span>Ball speed</span><input type="range" id="pingPongSpeedSlider" min="200" max="1200" step="50" value="800"><span class="val" id="pingPongSpeedVal">800</span></label>\n        <label><span>Cursor obstacle size</span><input type="range" id="pingPongCursorSlider" min="20" max="200" step="10" value="50"><span class="val" id="pingPongCursorVal">50</span></label>\n        <div style="font-size: 9px; opacity: 0.7; margin-top: 6px;">Continuous motion ‚Ä¢ Cursor deflects balls</div>\n      </div>\n    </details>\n  </div>\n  \n  <div id="magneticControls" class="mode-controls">\n    <details open>\n      <summary>üß≤ Magnetic Mode</summary>\n      <div class="group">\n        <label><span>Ball count</span><input type="range" id="magneticBallCountSlider" min="50" max="300" step="10" value="180"><span class="val" id="magneticBallCountVal">180</span></label>\n        <label><span>Magnetic strength</span><input type="range" id="magneticStrengthSlider" min="10000" max="100000" step="5000" value="65000"><span class="val" id="magneticStrengthVal">65000</span></label>\n        <label><span>Max velocity</span><input type="range" id="magneticVelocitySlider" min="500" max="4000" step="100" value="2800"><span class="val" id="magneticVelocityVal">2800</span></label>\n        <div style="font-size: 9px; opacity: 0.7; margin-top: 6px;">Cursor drives magnetic swirls (no explosions)</div>\n      </div>\n    </details>\n  </div>\n  \n  <div id="bubblesControls" class="mode-controls">\n    <details open>\n      <summary>ü´ß Carbonated Bubbles Mode</summary>\n      <div class="group">\n        <label><span>Bubble rate</span><input type="range" id="bubblesRateSlider" min="1" max="20" step="1" value="8"><span class="val" id="bubblesRateVal">8</span></label>\n        <label><span>Rise speed</span><input type="range" id="bubblesSpeedSlider" min="50" max="400" step="25" value="150"><span class="val" id="bubblesSpeedVal">150</span></label>\n        <label><span>Wobble</span><input type="range" id="bubblesWobbleSlider" min="0" max="100" step="5" value="40"><span class="val" id="bubblesWobbleVal">40</span></label>\n        <label><span>Max bubbles</span><input type="range" id="bubblesMaxSlider" min="50" max="300" step="10" value="150"><span class="val" id="bubblesMaxVal">150</span></label>\n        <label><span>Cursor deflection</span><input type="range" id="bubblesDeflectSlider" min="20" max="150" step="10" value="80"><span class="val" id="bubblesDeflectVal">80</span></label>\n        <div style="font-size: 9px; opacity: 0.7; margin-top: 6px;">Bubbles rise from bottom ‚Ä¢ Pop at top ‚Ä¢ Cursor deflects</div>\n      </div>\n    </details>\n  </div>\n  \n  <div style="font-size:10px; opacity:0.5; text-align:center; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1);">\n    <code>R</code> reset ‚Ä¢ <code>/</code> panel ‚Ä¢ click/tap cycles modes\n  </div>\n  \n  </div>\n',b();const t=e.querySelector("#minimizePanel");t&&t.addEventListener("click",t=>{t.stopPropagation(),e.classList.toggle("hidden"),e.style.display=e.classList.contains("hidden")?"none":""}),function(e){const t=e.querySelector(".panel-header");if(!t)return;let a=!1,n=0,i=0;t.addEventListener("mousedown",s=>{a=!0;const o=e.getBoundingClientRect();n=s.clientX-o.left,i=s.clientY-o.top,t.style.cursor="grabbing"}),document.addEventListener("mousemove",t=>{if(!a)return;const s=t.clientX-n,o=t.clientY-i,l=window.innerWidth-e.offsetWidth-20,r=window.innerHeight-e.offsetHeight-20;e.style.left=Math.max(20,Math.min(s,l))+"px",e.style.top=Math.max(20,Math.min(o,r))+"px",e.style.right="auto"}),document.addEventListener("mouseup",()=>{a=!1,t.style.cursor="move"})}(e),ae(),function(){const e=document.getElementById("saveConfigBtn");e&&e.addEventListener("click",()=>{const e=n(),t={gravityMultiplier:e.gravityMultiplierPit,ballMass:e.ballMassKg,sizeScale:e.sizeScale,sizeVariation:e.sizeVariation,restitution:e.REST,friction:e.FRICTION,repelRadius:e.repelRadius,repelPower:e.repelPower,repelSoftness:e.repelSoft,cursorColorIndex:5,enableLOD:!1},a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),i=document.createElement("a");i.href=URL.createObjectURL(a),i.download="current-config.json",document.body.appendChild(i),i.click(),document.body.removeChild(i)})}(),e.classList.add("hidden"),console.log("‚úì Panel created")}(),c(),console.log("‚úì Panel created"),function(){const t=document.getElementById("controlPanel");window.addEventListener("keydown",a=>{const n=a.key.toLowerCase();if(("/"===n||"Slash"===a.code)&&t)return a.preventDefault(),t.classList.toggle("hidden"),void(t.style.display=t.classList.contains("hidden")?"none":"");"1"===n?(a.preventDefault(),Z(e.PIT),ne("pit")):"2"===n?(a.preventDefault(),Z(e.FLIES),ne("flies")):"3"===n?(a.preventDefault(),Z(e.WEIGHTLESS),ne("weightless")):"4"===n?(a.preventDefault(),Z(e.WATER),ne("water")):"5"===n?(a.preventDefault(),Z(e.VORTEX),ne("vortex")):"6"===n?(a.preventDefault(),Z(e.PING_PONG),ne("ping-pong")):"7"===n?(a.preventDefault(),Z(e.MAGNETIC),ne("magnetic")):"8"===n&&(a.preventDefault(),Z(e.BUBBLES),ne("bubbles"))}),console.log("‚úì Keyboard shortcuts registered")}(),console.log("‚úì Keyboard shortcuts registered"),Z(e.FLIES),console.log("‚úì Mode initialized");const r=()=>Q();i=(e,t)=>{const a=r();a&&a(e,t)},requestAnimationFrame(function a(s){const o=s/1e3;let l=Math.min(.033,o-ye);ye=o,async function(a,i){const s=n(),o=s.balls,l=s.canvas;if(!l||0===o.length)return;be+=a;let r=0;for(;be>=ge&&r<t.MAX_PHYSICS_STEPS;){const t=o.length;for(let e=0;e<t;e++)o[e].step(ge,i);s.currentMode!==e.FLIES&&me(10);const a=s.currentMode===e.WEIGHTLESS?s.weightlessBounce:s.REST,n=o.length;for(let e=0;e<n;e++)fe(o[e],l),o[e].walls(l.width,l.height,ge,a);be-=ge,r++}s.currentMode===e.WATER&&F(a),be>ge*t.ACCUMULATOR_RESET_THRESHOLD&&(be=0)}(l,i),function(){const e=n(),t=e.ctx,a=e.balls,i=e.canvas;if(t&&i){t.clearRect(0,0,i.width,i.height),e.currentMode;for(let e=0;e<a.length;e++)a[e].draw(t);!function(e){const t=n();if(!t.mouseInCanvas)return;if(!0===t.isTouchDevice)return;if(!1===t.cursorBallVisible)return;const a=Math.max(6*t.DPR,.12*(t.R_MIN+t.R_MAX));e.save(),e.beginPath(),e.arc(t.mouseX,t.mouseY,a,0,2*Math.PI),e.fillStyle=t.currentColors&&t.currentColors[4]||"#000000",e.globalAlpha=.9,e.fill(),e.globalAlpha=1,e.restore()}(t)}}(),function(e){if(Se++,e-Me>1e3){xe=Se,Se=0,Me=e;const t=document.getElementById("render-fps");t&&(t.textContent=String(xe))}}(performance.now()),requestAnimationFrame(a)}),console.log("‚úÖ Bouncy Balls running (modular)")}catch(e){console.error("‚ùå Initialization failed:",e),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${e.message}\n${e.stack}</pre>\n    </div>`}var i}()}();
