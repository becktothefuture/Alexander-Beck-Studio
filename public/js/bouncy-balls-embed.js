!(function(e){function t(e,t=""){const a=(e+"").startsWith("--")?e:"--"+e,n=(()=>{try{if("undefined"==typeof window)return null;const e=window.__TOKENS__;return e&&"object"==typeof e?e:null}catch(e){return null}})(),o=(e=>{try{return"undefined"==typeof document?"":getComputedStyle(document.documentElement).getPropertyValue(e).trim()}catch(t){return""}})(a);if(o&&!o.includes("var("))return o;if(n){const e=((e,t)=>{const a=(e||"")+"";if(!a.includes("var("))return a.trim();if(!t)return a.trim();const n=/var\((--[a-z0-9-_]+)(?:\s*,\s*([^)]+))?\)/gi;let o=a,i=0;for(;o.includes("var(")&&8>i;)o=o.replace(n,(e,a,n)=>{const o=t.resolved?.[a]??t.cssVars?.[a];return null!=o?(o+"").trim():n?(n+"").trim():""}),i+=1;return o.trim()})(n.resolved?.[a]??n.cssVars?.[a]??o,n);if(e&&!e.includes("var("))return e}return o&&!o.includes("var(")?o:t}function a(e,a){const n=t(e,""),o=parseFloat(n);return Number.isFinite(o)?o:a}function n(e,a){const n=t(e,"");if(!n)return a;const o=parseFloat((n+"").replace(/px$/i,""));return Number.isFinite(o)?o:a}function o(e,a){const n=t(e,"");if(!n)return a;const o=(n+"").trim().toLowerCase(),i=parseFloat(o);return Number.isFinite(i)?o.endsWith("ms")?i:o.endsWith("s")?1e3*i:i:a}function i(e){_n=e}function r(e,t,a,n){const o=+e;return Number.isFinite(o)?Math.min(a,Math.max(t,o)):n}function s(e,t,a,n){const o=r(e,t,a,n);return Math.round(o)}function l(){const e=+Gn.layoutViewportWidthPx;return Number.isFinite(e)&&e>0?e:Math.max(1,window.innerWidth||1)}function c(e,t){const a=Math.max(1,t||l()),n=+e;return Number.isFinite(n)?n/a*100:0}function d(e,t){const a=Math.max(1,t||l()),n=+e;return Number.isFinite(n)?n/100*a:0}function p(){const e=l(),t=Number.isFinite(Gn.wallThicknessVw)&&Gn.wallThicknessVw>0?Gn.wallThicknessVw:0,a=t>0?t:Number.isFinite(Gn.containerBorderVw)?Gn.containerBorderVw:0;Gn.containerBorderVw=a;const n=d(a,e),o=d(Gn.simulationPaddingVw,e),i=d(Gn.contentPaddingVw,e),r=d(Gn.wallRadiusVw,e),s=Math.max(0,Math.round(Gn.layoutMinContentPaddingPx||0)),c=Math.max(0,Math.round(Gn.layoutMinWallRadiusPx||0)),p=d(t>0?t:a,e),u=Gn.isMobile||Gn.isMobileViewport?Math.max(.5,Gn.mobileWallThicknessXFactor||1):1;Gn.containerBorder=Math.round(n),Gn.containerBorderX=Math.round(n*u),Gn.simulationPadding=Math.round(o),Gn.contentPadding=Math.max(s,Math.round(i));const h=Math.max(.1,Gn.contentPaddingHorizontalRatio||1);Gn.contentPaddingY=Gn.contentPadding,Gn.contentPaddingX=Math.round(Gn.contentPadding*h),Gn.wallRadius=Math.max(c,Math.round(r)),Gn.cornerRadius=Gn.wallRadius,Gn.wallThickness=Math.round(p*u);const f=Math.max(0,d(Gn.cursorInfluenceRadiusVw||0,e));Gn.cursorInfluenceRadiusPx=Math.round(f),Gn.repelRadius=Math.round(f),Gn.weightlessRepelRadius=Math.round(f),Gn.pingPongCursorRadius=Math.round(f),Gn.bubblesDeflectRadius=Math.round(f)}function u(){const e=document.documentElement,t=Gn.isMobile||Gn.isMobileViewport,a=t?Math.max(.5,Gn.mobileWallThicknessXFactor||1):1;e.style.setProperty("--container-border",Gn.containerBorder+"px"),e.style.setProperty("--container-border-x",Gn.containerBorderX+"px"),e.style.setProperty("--container-border-y",Gn.containerBorder+"px"),e.style.setProperty("--simulation-padding",Gn.simulationPadding+"px"),e.style.setProperty("--content-padding",Gn.contentPadding+"px"),e.style.setProperty("--content-padding-x",Gn.contentPaddingX+"px"),e.style.setProperty("--content-padding-y",Gn.contentPaddingY+"px"),e.style.setProperty("--wall-radius",Gn.wallRadius+"px"),e.style.setProperty("--wall-thickness",Gn.wallThickness+"px");const n=Gn.containerBorderVw||1.3;e.style.setProperty("--container-border-vw",""+n),e.style.setProperty("--container-border-x-vw",""+n*a),e.style.setProperty("--wall-thickness-vw",""+(Number.isFinite(Gn.wallThicknessVw)&&Gn.wallThicknessVw>0?Gn.wallThicknessVw:Gn.containerBorderVw)*a);const o=Gn.edgeLabelInsetAdjustPx||0;e.style.setProperty("--edge-label-inset",Gn.containerBorder+8+o+"px"),e.style.setProperty("--edge-label-inset-adjust",o+"px"),e.style.setProperty("--edge-label-mobile-display",t&&Gn.mobileEdgeLabelsVisible?"flex":"none")}function h(e){if(Gn.config={...e},void 0!==e.layoutViewportWidthPx&&(Gn.layoutViewportWidthPx=r(e.layoutViewportWidthPx,0,4096,0)),e.ballMass&&(Gn.ballMassKg=e.ballMass),void 0!==e.gravityMultiplier&&(Gn.gravityMultiplier=e.gravityMultiplier,Gn.gravityMultiplierPit=e.gravityMultiplier),e.restitution&&(Gn.REST=e.restitution),e.friction&&(Gn.FRICTION=e.friction),void 0!==e.ballScale&&(Gn.sizeScale=e.ballScale),void 0!==e.sizeScale&&(Gn.sizeScale=e.sizeScale),void 0!==e.sizeVariationGlobalMul&&(Gn.sizeVariationGlobalMul=r(e.sizeVariationGlobalMul,0,2,Gn.sizeVariationGlobalMul)),void 0!==e.sizeVariationCap&&(Gn.sizeVariationCap=r(e.sizeVariationCap,0,.2,Gn.sizeVariationCap)),void 0!==e.sizeVariationPit&&(Gn.sizeVariationPit=r(e.sizeVariationPit,0,1,Gn.sizeVariationPit)),void 0!==e.sizeVariationPitThrows&&(Gn.sizeVariationPitThrows=r(e.sizeVariationPitThrows,0,1,Gn.sizeVariationPitThrows)),void 0!==e.sizeVariationFlies&&(Gn.sizeVariationFlies=r(e.sizeVariationFlies,0,1,Gn.sizeVariationFlies)),void 0!==e.sizeVariationWeightless&&(Gn.sizeVariationWeightless=r(e.sizeVariationWeightless,0,1,Gn.sizeVariationWeightless)),void 0!==e.sizeVariationWater&&(Gn.sizeVariationWater=r(e.sizeVariationWater,0,1,Gn.sizeVariationWater)),void 0!==e.sizeVariationVortex&&(Gn.sizeVariationVortex=r(e.sizeVariationVortex,0,1,Gn.sizeVariationVortex)),void 0!==e.sizeVariationPingPong&&(Gn.sizeVariationPingPong=r(e.sizeVariationPingPong,0,1,Gn.sizeVariationPingPong)),void 0!==e.sizeVariationMagnetic&&(Gn.sizeVariationMagnetic=r(e.sizeVariationMagnetic,0,1,Gn.sizeVariationMagnetic)),void 0!==e.sizeVariationBubbles&&(Gn.sizeVariationBubbles=r(e.sizeVariationBubbles,0,1,Gn.sizeVariationBubbles)),void 0!==e.sizeVariationKaleidoscope&&(Gn.sizeVariationKaleidoscope=r(e.sizeVariationKaleidoscope,0,1,Gn.sizeVariationKaleidoscope)),void 0!==e.sizeVariationOrbit3d&&(Gn.sizeVariationOrbit3d=r(e.sizeVariationOrbit3d,0,1,Gn.sizeVariationOrbit3d)),void 0!==e.sizeVariationCritters&&(Gn.sizeVariationCritters=r(e.sizeVariationCritters,0,1,Gn.sizeVariationCritters)),void 0!==e.sizeVariationNeural&&(Gn.sizeVariationNeural=r(e.sizeVariationNeural,0,1,Gn.sizeVariationNeural)),void 0!==e.sizeVariationLattice&&(Gn.sizeVariationLattice=r(e.sizeVariationLattice,0,1,Gn.sizeVariationLattice)),void 0!==e.sizeVariationParallaxLinear&&(Gn.sizeVariationParallaxLinear=r(e.sizeVariationParallaxLinear,0,1,Gn.sizeVariationParallaxLinear)),void 0!==e.sizeVariationParallaxPerspective&&(Gn.sizeVariationParallaxPerspective=r(e.sizeVariationParallaxPerspective,0,1,Gn.sizeVariationParallaxPerspective)),void 0!==e.sizeVariation&&(Gn.sizeVariation=e.sizeVariation),Array.isArray(e.colorDistribution)){const t=e.colorDistribution,a=Array.isArray(Gn.colorDistribution)?Gn.colorDistribution:[],n=[];for(let e=0;7>e;e++){const o=a[e]||{},i=t[e]||{},r="string"==typeof i.label&&i.label.trim()?i.label.trim():"string"==typeof o.label?o.label:"Discipline "+(e+1),l=s(i.colorIndex,0,7,s(o.colorIndex,0,7,0)),c=s(i.weight,0,100,s(o.weight,0,100,0));n.push({label:r,colorIndex:l,weight:c})}Gn.colorDistribution=n}if(void 0!==e.pitWarmupFrames&&(Gn.pitWarmupFrames=s(e.pitWarmupFrames,0,240,Gn.pitWarmupFrames)),void 0!==e.pitThrowsWarmupFrames&&(Gn.pitThrowsWarmupFrames=s(e.pitThrowsWarmupFrames,0,240,Gn.pitThrowsWarmupFrames)),void 0!==e.fliesWarmupFrames&&(Gn.fliesWarmupFrames=s(e.fliesWarmupFrames,0,240,Gn.fliesWarmupFrames)),void 0!==e.weightlessWarmupFrames&&(Gn.weightlessWarmupFrames=s(e.weightlessWarmupFrames,0,240,Gn.weightlessWarmupFrames)),void 0!==e.waterWarmupFrames&&(Gn.waterWarmupFrames=s(e.waterWarmupFrames,0,240,Gn.waterWarmupFrames)),void 0!==e.vortexWarmupFrames&&(Gn.vortexWarmupFrames=s(e.vortexWarmupFrames,0,240,Gn.vortexWarmupFrames)),void 0!==e.pingPongWarmupFrames&&(Gn.pingPongWarmupFrames=s(e.pingPongWarmupFrames,0,240,Gn.pingPongWarmupFrames)),void 0!==e.magneticWarmupFrames&&(Gn.magneticWarmupFrames=s(e.magneticWarmupFrames,0,240,Gn.magneticWarmupFrames)),void 0!==e.bubblesWarmupFrames&&(Gn.bubblesWarmupFrames=s(e.bubblesWarmupFrames,0,240,Gn.bubblesWarmupFrames)),void 0!==e.kaleidoscopeWarmupFrames&&(Gn.kaleidoscopeWarmupFrames=s(e.kaleidoscopeWarmupFrames,0,240,Gn.kaleidoscopeWarmupFrames)),void 0!==e.kaleidoscope1WarmupFrames&&(Gn.kaleidoscope1WarmupFrames=s(e.kaleidoscope1WarmupFrames,0,240,Gn.kaleidoscope1WarmupFrames)),void 0!==e.kaleidoscope2WarmupFrames&&(Gn.kaleidoscope2WarmupFrames=s(e.kaleidoscope2WarmupFrames,0,240,Gn.kaleidoscope2WarmupFrames)),void 0!==e.kaleidoscope3WarmupFrames&&(Gn.kaleidoscope3WarmupFrames=s(e.kaleidoscope3WarmupFrames,0,240,Gn.kaleidoscope3WarmupFrames)),void 0!==e.orbit3dWarmupFrames&&(Gn.orbit3dWarmupFrames=s(e.orbit3dWarmupFrames,0,240,Gn.orbit3dWarmupFrames)),void 0!==e.orbit3d2WarmupFrames&&(Gn.orbit3d2WarmupFrames=s(e.orbit3d2WarmupFrames,0,240,Gn.orbit3d2WarmupFrames)),void 0!==e.crittersWarmupFrames&&(Gn.crittersWarmupFrames=s(e.crittersWarmupFrames,0,240,Gn.crittersWarmupFrames)),void 0!==e.neuralWarmupFrames&&(Gn.neuralWarmupFrames=s(e.neuralWarmupFrames,0,240,Gn.neuralWarmupFrames)),void 0!==e.latticeWarmupFrames&&(Gn.latticeWarmupFrames=s(e.latticeWarmupFrames,0,240,Gn.latticeWarmupFrames)),void 0!==e.parallaxLinearWarmupFrames&&(Gn.parallaxLinearWarmupFrames=s(e.parallaxLinearWarmupFrames,0,240,Gn.parallaxLinearWarmupFrames)),void 0!==e.parallaxPerspectiveWarmupFrames&&(Gn.parallaxPerspectiveWarmupFrames=s(e.parallaxPerspectiveWarmupFrames,0,240,Gn.parallaxPerspectiveWarmupFrames)),v(),void 0!==e.maxBalls&&(Gn.maxBalls=e.maxBalls),void 0!==e.repelRadius&&(Gn.repelRadius=e.repelRadius),void 0!==e.repelPower&&(Gn.repelPower=e.repelPower),void 0!==e.repelSoft&&(Gn.repelSoft=e.repelSoft),void 0!==e.repelSoftness&&(Gn.repelSoft=e.repelSoftness),void 0!==e.cursorInfluenceRadiusVw?Gn.cursorInfluenceRadiusVw=r(e.cursorInfluenceRadiusVw,0,80,Gn.cursorInfluenceRadiusVw):void 0!==e.repelRadius&&(Gn.cursorInfluenceRadiusVw=r(e.repelRadius/10,0,80,Gn.cursorInfluenceRadiusVw)),void 0!==e.responsiveScaleMobile&&(Gn.responsiveScaleMobile=e.responsiveScaleMobile),void 0!==e.mobileObjectReductionFactor&&(Gn.mobileObjectReductionFactor=r(e.mobileObjectReductionFactor,0,1,Gn.mobileObjectReductionFactor)),y(),void 0!==e.kaleidoscopeBallCount&&(Gn.kaleidoscopeBallCount=r(e.kaleidoscopeBallCount,10,300,Gn.kaleidoscopeBallCount)),void 0!==e.kaleidoscopeDotSizeVh&&(Gn.kaleidoscopeDotSizeVh=r(e.kaleidoscopeDotSizeVh,.1,6,Gn.kaleidoscopeDotSizeVh)),void 0!==e.kaleidoscopeDotAreaMul&&(Gn.kaleidoscopeDotAreaMul=r(e.kaleidoscopeDotAreaMul,.1,2,Gn.kaleidoscopeDotAreaMul)),void 0!==e.kaleidoscopeSpawnAreaMul&&(Gn.kaleidoscopeSpawnAreaMul=r(e.kaleidoscopeSpawnAreaMul,.2,2,Gn.kaleidoscopeSpawnAreaMul)),void 0!==e.kaleidoscopeSizeVariance&&(Gn.kaleidoscopeSizeVariance=r(e.kaleidoscopeSizeVariance,0,1,Gn.kaleidoscopeSizeVariance)),void 0!==e.kaleidoscope1BallCount&&(Gn.kaleidoscope1BallCount=r(e.kaleidoscope1BallCount,3,300,Gn.kaleidoscope1BallCount)),void 0!==e.kaleidoscope1Wedges&&(Gn.kaleidoscope1Wedges=r(e.kaleidoscope1Wedges,3,24,Gn.kaleidoscope1Wedges)),void 0!==e.kaleidoscope1Speed&&(Gn.kaleidoscope1Speed=r(e.kaleidoscope1Speed,.2,2,Gn.kaleidoscope1Speed)),void 0!==e.kaleidoscope1DotSizeVh&&(Gn.kaleidoscope1DotSizeVh=r(e.kaleidoscope1DotSizeVh,.1,6,Gn.kaleidoscope1DotSizeVh)),void 0!==e.kaleidoscope1DotAreaMul&&(Gn.kaleidoscope1DotAreaMul=r(e.kaleidoscope1DotAreaMul,.1,2,Gn.kaleidoscope1DotAreaMul)),void 0!==e.kaleidoscope1SpawnAreaMul&&(Gn.kaleidoscope1SpawnAreaMul=r(e.kaleidoscope1SpawnAreaMul,.2,2,Gn.kaleidoscope1SpawnAreaMul)),void 0!==e.kaleidoscope1SizeVariance&&(Gn.kaleidoscope1SizeVariance=r(e.kaleidoscope1SizeVariance,0,1,Gn.kaleidoscope1SizeVariance)),void 0!==e.kaleidoscope2BallCount&&(Gn.kaleidoscope2BallCount=r(e.kaleidoscope2BallCount,3,300,Gn.kaleidoscope2BallCount)),void 0!==e.kaleidoscope2Wedges&&(Gn.kaleidoscope2Wedges=r(e.kaleidoscope2Wedges,3,24,Gn.kaleidoscope2Wedges)),void 0!==e.kaleidoscope2Speed&&(Gn.kaleidoscope2Speed=r(e.kaleidoscope2Speed,.2,2,Gn.kaleidoscope2Speed)),void 0!==e.kaleidoscope2DotSizeVh&&(Gn.kaleidoscope2DotSizeVh=r(e.kaleidoscope2DotSizeVh,.1,6,Gn.kaleidoscope2DotSizeVh)),void 0!==e.kaleidoscope2DotAreaMul&&(Gn.kaleidoscope2DotAreaMul=r(e.kaleidoscope2DotAreaMul,.1,2,Gn.kaleidoscope2DotAreaMul)),void 0!==e.kaleidoscope2SpawnAreaMul&&(Gn.kaleidoscope2SpawnAreaMul=r(e.kaleidoscope2SpawnAreaMul,.2,2,Gn.kaleidoscope2SpawnAreaMul)),void 0!==e.kaleidoscope2SizeVariance&&(Gn.kaleidoscope2SizeVariance=r(e.kaleidoscope2SizeVariance,0,1,Gn.kaleidoscope2SizeVariance)),void 0!==e.kaleidoscope3BallCount&&(Gn.kaleidoscope3BallCount=r(e.kaleidoscope3BallCount,3,300,Gn.kaleidoscope3BallCount)),void 0!==e.kaleidoscope3Wedges&&(Gn.kaleidoscope3Wedges=r(e.kaleidoscope3Wedges,3,24,Gn.kaleidoscope3Wedges)),void 0!==e.kaleidoscope3Speed&&(Gn.kaleidoscope3Speed=r(e.kaleidoscope3Speed,.2,2,Gn.kaleidoscope3Speed)),void 0!==e.kaleidoscope3DotSizeVh&&(Gn.kaleidoscope3DotSizeVh=r(e.kaleidoscope3DotSizeVh,.1,6,Gn.kaleidoscope3DotSizeVh)),void 0!==e.kaleidoscope3DotAreaMul&&(Gn.kaleidoscope3DotAreaMul=r(e.kaleidoscope3DotAreaMul,.1,2,Gn.kaleidoscope3DotAreaMul)),void 0!==e.kaleidoscope3SpawnAreaMul&&(Gn.kaleidoscope3SpawnAreaMul=r(e.kaleidoscope3SpawnAreaMul,.2,2,Gn.kaleidoscope3SpawnAreaMul)),void 0!==e.kaleidoscope3SizeVariance&&(Gn.kaleidoscope3SizeVariance=r(e.kaleidoscope3SizeVariance,0,1,Gn.kaleidoscope3SizeVariance)),void 0!==e.kaleidoscopeWedges?Gn.kaleidoscopeWedges=r(e.kaleidoscopeWedges,3,24,Gn.kaleidoscopeWedges):void 0!==e.kaleidoscopeSegments&&(Gn.kaleidoscopeWedges=r(e.kaleidoscopeSegments,3,24,Gn.kaleidoscopeWedges)),void 0!==e.kaleidoscopeMirror&&(Gn.kaleidoscopeMirror=r(e.kaleidoscopeMirror,0,1,Gn.kaleidoscopeMirror)),void 0!==e.kaleidoscopeSpeed)Gn.kaleidoscopeSpeed=r(e.kaleidoscopeSpeed,.2,2,Gn.kaleidoscopeSpeed);else if(void 0!==e.kaleidoscopeSwirlStrength){const t=r(e.kaleidoscopeSwirlStrength,0,800,52);Gn.kaleidoscopeSpeed=r(.2+t/800*1.8,.2,2,Gn.kaleidoscopeSpeed)}void 0!==e.critterCount&&(Gn.critterCount=e.critterCount),void 0!==e.critterSpeed&&(Gn.critterSpeed=e.critterSpeed),void 0!==e.critterMaxSpeed&&(Gn.critterMaxSpeed=e.critterMaxSpeed),void 0!==e.critterStepHz&&(Gn.critterStepHz=e.critterStepHz),void 0!==e.critterStepSharpness&&(Gn.critterStepSharpness=e.critterStepSharpness),void 0!==e.critterTurnNoise&&(Gn.critterTurnNoise=e.critterTurnNoise),void 0!==e.critterTurnDamp&&(Gn.critterTurnDamp=e.critterTurnDamp),void 0!==e.critterTurnSeek&&(Gn.critterTurnSeek=e.critterTurnSeek),void 0!==e.critterAvoidRadius&&(Gn.critterAvoidRadius=e.critterAvoidRadius),void 0!==e.critterAvoidForce&&(Gn.critterAvoidForce=e.critterAvoidForce),void 0!==e.critterEdgeAvoid&&(Gn.critterEdgeAvoid=e.critterEdgeAvoid),void 0!==e.critterMousePull&&(Gn.critterMousePull=e.critterMousePull),Gn.layoutMinContentPaddingPx=void 0!==e.layoutMinContentPaddingPx?r(e.layoutMinContentPaddingPx,0,200,Gn.layoutMinContentPaddingPx):n("--layout-min-content-padding",Gn.layoutMinContentPaddingPx),Gn.layoutMinWallRadiusPx=void 0!==e.layoutMinWallRadiusPx?r(e.layoutMinWallRadiusPx,0,400,Gn.layoutMinWallRadiusPx):n("--layout-min-wall-radius",Gn.layoutMinWallRadiusPx),void 0!==e.critterMouseRadiusVw&&(Gn.critterMouseRadiusVw=e.critterMouseRadiusVw),void 0!==e.critterRestitution&&(Gn.critterRestitution=e.critterRestitution),void 0!==e.critterFriction&&(Gn.critterFriction=e.critterFriction),void 0!==e.neuralBallCount&&(Gn.neuralBallCount=r(e.neuralBallCount,8,260,Gn.neuralBallCount)),void 0!==e.neuralLinkDistanceVw&&(Gn.neuralLinkDistanceVw=r(e.neuralLinkDistanceVw,1,50,Gn.neuralLinkDistanceVw)),void 0!==e.neuralLineOpacity&&(Gn.neuralLineOpacity=r(e.neuralLineOpacity,0,1,Gn.neuralLineOpacity)),void 0!==e.neuralWanderStrength&&(Gn.neuralWanderStrength=r(e.neuralWanderStrength,0,4e3,Gn.neuralWanderStrength)),void 0!==e.neuralMaxLinksPerBall&&(Gn.neuralMaxLinksPerBall=r(e.neuralMaxLinksPerBall,0,16,Gn.neuralMaxLinksPerBall)),void 0!==e.neuralDamping&&(Gn.neuralDamping=r(e.neuralDamping,.8,1,Gn.neuralDamping)),void 0!==e.latticeBallCount&&(Gn.latticeBallCount=r(e.latticeBallCount,8,260,Gn.latticeBallCount)),void 0!==e.latticeSpacingVw&&(Gn.latticeSpacingVw=r(e.latticeSpacingVw,1,40,Gn.latticeSpacingVw)),void 0!==e.latticeStiffness&&(Gn.latticeStiffness=r(e.latticeStiffness,0,20,Gn.latticeStiffness)),void 0!==e.latticeDamping&&(Gn.latticeDamping=r(e.latticeDamping,.5,1,Gn.latticeDamping)),void 0!==e.latticeDisruptRadius&&(Gn.latticeDisruptRadius=r(e.latticeDisruptRadius,50,800,Gn.latticeDisruptRadius)),void 0!==e.latticeDisruptPower&&(Gn.latticeDisruptPower=r(e.latticeDisruptPower,0,20,Gn.latticeDisruptPower)),void 0!==e.latticeMeshWaveStrength&&(Gn.latticeMeshWaveStrength=r(e.latticeMeshWaveStrength,0,50,Gn.latticeMeshWaveStrength)),void 0!==e.latticeMeshWaveSpeed&&(Gn.latticeMeshWaveSpeed=r(e.latticeMeshWaveSpeed,0,3,Gn.latticeMeshWaveSpeed)),void 0!==e.latticeAlignment&&(Gn.latticeAlignment=e.latticeAlignment+""),void 0!==e.parallaxLinearDotCount&&(Gn.parallaxLinearDotCount=r(e.parallaxLinearDotCount,20,220,Gn.parallaxLinearDotCount)),void 0!==e.parallaxLinearGridJitter&&(Gn.parallaxLinearGridJitter=r(e.parallaxLinearGridJitter,0,1,Gn.parallaxLinearGridJitter)),void 0!==e.parallaxLinearFarSpeed&&(Gn.parallaxLinearFarSpeed=r(e.parallaxLinearFarSpeed,0,1.5,Gn.parallaxLinearFarSpeed)),void 0!==e.parallaxLinearMidSpeed&&(Gn.parallaxLinearMidSpeed=r(e.parallaxLinearMidSpeed,0,1.5,Gn.parallaxLinearMidSpeed)),void 0!==e.parallaxLinearNearSpeed&&(Gn.parallaxLinearNearSpeed=r(e.parallaxLinearNearSpeed,0,1.5,Gn.parallaxLinearNearSpeed)),void 0!==e.parallaxLinearGridX&&(Gn.parallaxLinearGridX=s(e.parallaxLinearGridX,3,40,Gn.parallaxLinearGridX)),void 0!==e.parallaxLinearGridY&&(Gn.parallaxLinearGridY=s(e.parallaxLinearGridY,3,40,Gn.parallaxLinearGridY)),void 0!==e.parallaxLinearGridZ&&(Gn.parallaxLinearGridZ=s(e.parallaxLinearGridZ,2,20,Gn.parallaxLinearGridZ)),void 0!==e.parallaxLinearSpanX&&(Gn.parallaxLinearSpanX=r(e.parallaxLinearSpanX,.2,3,Gn.parallaxLinearSpanX)),void 0!==e.parallaxLinearSpanY&&(Gn.parallaxLinearSpanY=r(e.parallaxLinearSpanY,.2,3,Gn.parallaxLinearSpanY)),void 0!==e.parallaxLinearZNear&&(Gn.parallaxLinearZNear=r(e.parallaxLinearZNear,10,1200,Gn.parallaxLinearZNear)),void 0!==e.parallaxLinearZFar&&(Gn.parallaxLinearZFar=r(e.parallaxLinearZFar,50,3e3,Gn.parallaxLinearZFar)),void 0!==e.parallaxLinearFocalLength&&(Gn.parallaxLinearFocalLength=r(e.parallaxLinearFocalLength,80,2e3,Gn.parallaxLinearFocalLength)),void 0!==e.parallaxLinearParallaxStrength&&(Gn.parallaxLinearParallaxStrength=r(e.parallaxLinearParallaxStrength,0,2e3,Gn.parallaxLinearParallaxStrength)),void 0!==e.parallaxLinearDotSizeMul&&(Gn.parallaxLinearDotSizeMul=r(e.parallaxLinearDotSizeMul,.1,6,Gn.parallaxLinearDotSizeMul)),void 0!==e.parallaxLinearFollowStrength&&(Gn.parallaxLinearFollowStrength=r(e.parallaxLinearFollowStrength,1,80,Gn.parallaxLinearFollowStrength)),void 0!==e.parallaxLinearDamping&&(Gn.parallaxLinearDamping=r(e.parallaxLinearDamping,1,80,Gn.parallaxLinearDamping)),void 0!==e.parallaxPerspectiveDotCount&&(Gn.parallaxPerspectiveDotCount=r(e.parallaxPerspectiveDotCount,40,420,Gn.parallaxPerspectiveDotCount)),void 0!==e.parallaxPerspectiveDepthMul&&(Gn.parallaxPerspectiveDepthMul=r(e.parallaxPerspectiveDepthMul,.5,3,Gn.parallaxPerspectiveDepthMul)),void 0!==e.parallaxPerspectiveFocalLength&&(Gn.parallaxPerspectiveFocalLength=r(e.parallaxPerspectiveFocalLength,80,1e3,Gn.parallaxPerspectiveFocalLength)),void 0!==e.parallaxPerspectiveFollowStrength&&(Gn.parallaxPerspectiveFollowStrength=r(e.parallaxPerspectiveFollowStrength,1,40,Gn.parallaxPerspectiveFollowStrength)),void 0!==e.parallaxPerspectiveDamping&&(Gn.parallaxPerspectiveDamping=r(e.parallaxPerspectiveDamping,1,40,Gn.parallaxPerspectiveDamping)),void 0!==e.parallaxPerspectiveZ1&&(Gn.parallaxPerspectiveZ1=r(e.parallaxPerspectiveZ1,200,2e3,Gn.parallaxPerspectiveZ1)),void 0!==e.parallaxPerspectiveZ2&&(Gn.parallaxPerspectiveZ2=r(e.parallaxPerspectiveZ2,150,1500,Gn.parallaxPerspectiveZ2)),void 0!==e.parallaxPerspectiveZ3&&(Gn.parallaxPerspectiveZ3=r(e.parallaxPerspectiveZ3,100,1e3,Gn.parallaxPerspectiveZ3)),void 0!==e.parallaxPerspectiveZ4&&(Gn.parallaxPerspectiveZ4=r(e.parallaxPerspectiveZ4,40,600,Gn.parallaxPerspectiveZ4)),void 0!==e.parallaxPerspectiveZ5&&(Gn.parallaxPerspectiveZ5=r(e.parallaxPerspectiveZ5,10,300,Gn.parallaxPerspectiveZ5)),void 0!==e.parallaxPerspectiveGridX&&(Gn.parallaxPerspectiveGridX=s(e.parallaxPerspectiveGridX,3,50,Gn.parallaxPerspectiveGridX)),void 0!==e.parallaxPerspectiveGridY&&(Gn.parallaxPerspectiveGridY=s(e.parallaxPerspectiveGridY,3,50,Gn.parallaxPerspectiveGridY)),void 0!==e.parallaxPerspectiveGridZ&&(Gn.parallaxPerspectiveGridZ=s(e.parallaxPerspectiveGridZ,2,25,Gn.parallaxPerspectiveGridZ)),void 0!==e.parallaxPerspectiveSpanX&&(Gn.parallaxPerspectiveSpanX=r(e.parallaxPerspectiveSpanX,.2,3,Gn.parallaxPerspectiveSpanX)),void 0!==e.parallaxPerspectiveSpanY&&(Gn.parallaxPerspectiveSpanY=r(e.parallaxPerspectiveSpanY,.2,3,Gn.parallaxPerspectiveSpanY)),void 0!==e.parallaxPerspectiveZNear&&(Gn.parallaxPerspectiveZNear=r(e.parallaxPerspectiveZNear,10,1200,Gn.parallaxPerspectiveZNear)),void 0!==e.parallaxPerspectiveZFar&&(Gn.parallaxPerspectiveZFar=r(e.parallaxPerspectiveZFar,50,4e3,Gn.parallaxPerspectiveZFar)),void 0!==e.parallaxPerspectiveParallaxStrength&&(Gn.parallaxPerspectiveParallaxStrength=r(e.parallaxPerspectiveParallaxStrength,0,2e3,Gn.parallaxPerspectiveParallaxStrength)),void 0!==e.parallaxPerspectiveRandomness&&(Gn.parallaxPerspectiveRandomness=r(e.parallaxPerspectiveRandomness,0,1,Gn.parallaxPerspectiveRandomness)),void 0!==e.parallaxPerspectiveDotSizeMul&&(Gn.parallaxPerspectiveDotSizeMul=r(e.parallaxPerspectiveDotSizeMul,.1,6,Gn.parallaxPerspectiveDotSizeMul));for(const[t,a]of Object.entries(e||{}))t in Gn&&"config"!==t&&"soundConfig"!==t&&"soundPreset"!==t&&"function"!=typeof Gn[t]&&(Array.isArray(a)||null===a||["string","number","boolean"].includes(typeof a))&&void 0!==a&&(Gn[t]=a);if(void 0!==e.sceneImpactEnabled&&(Gn.sceneImpactEnabled=!!e.sceneImpactEnabled),void 0!==e.sceneImpactMul?Gn.sceneImpactMul=r(e.sceneImpactMul,0,.05,Gn.sceneImpactMul):void 0!==e.brandLogoImpactMul&&(Gn.sceneImpactMul=r(e.brandLogoImpactMul,0,.05,Gn.sceneImpactMul)),void 0!==e.sceneImpactMobileMulFactor&&(Gn.sceneImpactMobileMulFactor=r(e.sceneImpactMobileMulFactor,.25,3,Gn.sceneImpactMobileMulFactor)),void 0!==e.sceneImpactLogoCompMul&&(Gn.sceneImpactLogoCompMul=r(e.sceneImpactLogoCompMul,.25,6,Gn.sceneImpactLogoCompMul)),void 0!==e.sceneImpactOvershoot?Gn.sceneImpactOvershoot=r(e.sceneImpactOvershoot,0,.8,Gn.sceneImpactOvershoot):void 0!==e.brandLogoOvershoot&&(Gn.sceneImpactOvershoot=r(e.brandLogoOvershoot,0,.8,Gn.sceneImpactOvershoot)),void 0!==e.sceneImpactAnticipation?Gn.sceneImpactAnticipation=r(e.sceneImpactAnticipation,0,.6,Gn.sceneImpactAnticipation):void 0!==e.brandLogoAnticipation&&(Gn.sceneImpactAnticipation=r(e.brandLogoAnticipation,0,.6,Gn.sceneImpactAnticipation)),void 0!==e.sceneImpactPressMs?Gn.sceneImpactPressMs=r(e.sceneImpactPressMs,20,300,Gn.sceneImpactPressMs):void 0!==e.brandLogoPressMs&&(Gn.sceneImpactPressMs=r(e.brandLogoPressMs,20,300,Gn.sceneImpactPressMs)),void 0!==e.sceneImpactReleaseMs?Gn.sceneImpactReleaseMs=r(e.sceneImpactReleaseMs,40,1200,Gn.sceneImpactReleaseMs):void 0!==e.brandLogoReleaseMs&&(Gn.sceneImpactReleaseMs=r(e.brandLogoReleaseMs,40,1200,Gn.sceneImpactReleaseMs)),void 0!==e.sceneChangeSoundEnabled&&(Gn.sceneChangeSoundEnabled=!!e.sceneChangeSoundEnabled),void 0!==e.sceneChangeSoundIntensity&&(Gn.sceneChangeSoundIntensity=r(e.sceneChangeSoundIntensity,0,1,Gn.sceneChangeSoundIntensity)),void 0!==e.sceneChangeSoundRadius&&(Gn.sceneChangeSoundRadius=r(e.sceneChangeSoundRadius,6,60,Gn.sceneChangeSoundRadius)),void 0!==e.containerBorder&&(Gn.containerBorder=e.containerBorder),void 0!==e.simulationPadding&&(Gn.simulationPadding=e.simulationPadding),void 0!==e.contentPadding&&(Gn.contentPadding=e.contentPadding),Gn.bgLight=void 0!==e.bgLight?e.bgLight:t("--bg-light",Gn.bgLight),Gn.bgDark=void 0!==e.bgDark?e.bgDark:t("--bg-dark",Gn.bgDark),Gn.frameColorLight=void 0!==e.frameColorLight?e.frameColorLight:t("--frame-color-light",Gn.frameColorLight),Gn.frameColorDark=void 0!==e.frameColorDark?e.frameColorDark:t("--frame-color-dark",Gn.frameColorDark),void 0!==e.frameColor?(Gn.frameColor=e.frameColor,Gn.frameColorLight=e.frameColor,Gn.frameColorDark=e.frameColor):Gn.frameColor=Gn.frameColorLight,Gn.textColorLight=void 0!==e.textColorLight?e.textColorLight:t("--text-color-light",Gn.textColorLight),Gn.textColorLightMuted=void 0!==e.textColorLightMuted?e.textColorLightMuted:t("--text-color-light-muted",Gn.textColorLightMuted),Gn.textColorDark=void 0!==e.textColorDark?e.textColorDark:t("--text-color-dark",Gn.textColorDark),Gn.textColorDarkMuted=void 0!==e.textColorDarkMuted?e.textColorDarkMuted:t("--text-color-dark-muted",Gn.textColorDarkMuted),Gn.edgeLabelColorLight=void 0!==e.edgeLabelColorLight?e.edgeLabelColorLight:t("--edge-label-color-light",Gn.edgeLabelColorLight),Gn.edgeLabelColorDark=void 0!==e.edgeLabelColorDark?e.edgeLabelColorDark:t("--edge-label-color-dark",Gn.edgeLabelColorDark),void 0!==e.edgeLabelInsetAdjustPx&&(Gn.edgeLabelInsetAdjustPx=r(e.edgeLabelInsetAdjustPx,-500,500,Gn.edgeLabelInsetAdjustPx)),Gn.linkHoverColor=void 0!==e.linkHoverColor?e.linkHoverColor:t("--link-hover-color",Gn.linkHoverColor),Gn.logoColorLight=void 0!==e.logoColorLight?e.logoColorLight:t("--logo-color-light",Gn.logoColorLight),Gn.logoColorDark=void 0!==e.logoColorDark?e.logoColorDark:t("--logo-color-dark",Gn.logoColorDark),Gn.portfolioLogoColorLight=void 0!==e.portfolioLogoColorLight?e.portfolioLogoColorLight:t("--portfolio-logo-color-light",Gn.portfolioLogoColorLight),Gn.portfolioLogoColorDark=void 0!==e.portfolioLogoColorDark?e.portfolioLogoColorDark:t("--portfolio-logo-color-dark",Gn.portfolioLogoColorDark),void 0!==e.noiseBackOpacity&&(Gn.noiseBackOpacity=r(e.noiseBackOpacity,0,.3,Gn.noiseBackOpacity)),void 0!==e.noiseFrontOpacity&&(Gn.noiseFrontOpacity=r(e.noiseFrontOpacity,0,.3,Gn.noiseFrontOpacity)),void 0!==e.noiseBackOpacityDark&&(Gn.noiseBackOpacityDark=r(e.noiseBackOpacityDark,0,.5,Gn.noiseBackOpacityDark)),void 0!==e.noiseFrontOpacityDark&&(Gn.noiseFrontOpacityDark=r(e.noiseFrontOpacityDark,0,.5,Gn.noiseFrontOpacityDark)),void 0!==e.noiseEnabled&&(Gn.noiseEnabled=!!e.noiseEnabled),void 0!==e.noiseSeed&&(Gn.noiseSeed=s(e.noiseSeed,0,999999,Gn.noiseSeed)),void 0!==e.noiseTextureSize&&(Gn.noiseTextureSize=s(e.noiseTextureSize,64,512,Gn.noiseTextureSize)),void 0!==e.noiseDistribution){const t=e.noiseDistribution+"";Gn.noiseDistribution="uniform"===t||"gaussian"===t?t:Gn.noiseDistribution}if(void 0!==e.noiseMonochrome&&(Gn.noiseMonochrome=!!e.noiseMonochrome),void 0!==e.noiseChroma&&(Gn.noiseChroma=r(e.noiseChroma,0,1,Gn.noiseChroma)),void 0!==e.noiseMotion){const t=e.noiseMotion+"";Gn.noiseMotion="jitter"===t||"drift"===t||"static"===t?t:Gn.noiseMotion}void 0!==e.noiseMotionAmount&&(Gn.noiseMotionAmount=r(e.noiseMotionAmount,0,2.5,Gn.noiseMotionAmount)),void 0!==e.noiseSpeedBackMs&&(Gn.noiseSpeedBackMs=s(e.noiseSpeedBackMs,0,1e4,Gn.noiseSpeedBackMs)),void 0!==e.noiseSpeedFrontMs&&(Gn.noiseSpeedFrontMs=s(e.noiseSpeedFrontMs,0,1e4,Gn.noiseSpeedFrontMs)),void 0!==e.noiseFlicker&&(Gn.noiseFlicker=r(e.noiseFlicker,0,1,Gn.noiseFlicker)),void 0!==e.noiseFlickerSpeedMs&&(Gn.noiseFlickerSpeedMs=s(e.noiseFlickerSpeedMs,0,5e3,Gn.noiseFlickerSpeedMs)),void 0!==e.noiseBlurPx&&(Gn.noiseBlurPx=r(e.noiseBlurPx,0,6,Gn.noiseBlurPx)),void 0!==e.noiseContrast&&(Gn.noiseContrast=r(e.noiseContrast,.25,5,Gn.noiseContrast)),void 0!==e.noiseBrightness&&(Gn.noiseBrightness=r(e.noiseBrightness,.25,3,Gn.noiseBrightness)),void 0!==e.noiseSaturation&&(Gn.noiseSaturation=r(e.noiseSaturation,0,3,Gn.noiseSaturation)),void 0!==e.noiseHue&&(Gn.noiseHue=r(e.noiseHue,0,360,Gn.noiseHue)),void 0!==e.noiseSizeBase&&(Gn.noiseSizeBase=r(e.noiseSizeBase,20,400,Gn.noiseSizeBase)),void 0!==e.noiseSizeTop&&(Gn.noiseSizeTop=r(e.noiseSizeTop,20,600,Gn.noiseSizeTop)),void 0!==e.noiseTopOpacity&&(Gn.noiseTopOpacity=r(e.noiseTopOpacity,0,.25,Gn.noiseTopOpacity)),void 0!==e.detailNoiseOpacity&&(Gn.detailNoiseOpacity=r(e.detailNoiseOpacity,0,1,Gn.detailNoiseOpacity)),void 0!==e.wallThickness&&(Gn.wallThickness=e.wallThickness),void 0!==e.wallRadius&&(Gn.wallRadius=e.wallRadius,Gn.cornerRadius=e.wallRadius),void 0!==e.wallInset&&(Gn.wallInset=e.wallInset),void 0!==e.wallInset&&(Gn.wallInset=e.wallInset),void 0!==e.ballSpacing&&(Gn.ballSpacing=e.ballSpacing),void 0!==e.wallPreset&&(Gn.wallPreset=e.wallPreset),void 0!==e.wallSoftness&&(Gn.wallSoftness=e.wallSoftness),void 0!==e.wallBounciness&&(Gn.wallBounciness=e.wallBounciness),void 0!==e.wallWobbleMaxDeform&&(Gn.wallWobbleMaxDeform=e.wallWobbleMaxDeform),void 0!==e.wallWobbleStiffness&&(Gn.wallWobbleStiffness=e.wallWobbleStiffness),void 0!==e.wallWobbleDamping&&(Gn.wallWobbleDamping=e.wallWobbleDamping),void 0!==e.wallWobbleSigma&&(Gn.wallWobbleSigma=e.wallWobbleSigma),void 0!==e.wallWobbleCornerClamp&&(Gn.wallWobbleCornerClamp=e.wallWobbleCornerClamp),void 0!==e.wallWobbleMaxVel&&(Gn.wallWobbleMaxVel=e.wallWobbleMaxVel),void 0!==e.wallWobbleMaxImpulse&&(Gn.wallWobbleMaxImpulse=e.wallWobbleMaxImpulse),void 0!==e.wallWobbleMaxEnergyPerStep&&(Gn.wallWobbleMaxEnergyPerStep=e.wallWobbleMaxEnergyPerStep),void 0!==e.wallWobbleImpactThreshold&&(Gn.wallWobbleImpactThreshold=e.wallWobbleImpactThreshold),void 0!==e.wallWobbleSettlingSpeed&&(Gn.wallWobbleSettlingSpeed=e.wallWobbleSettlingSpeed),void 0!==e.wallDeformPhysicsPrecision&&(Gn.wallDeformPhysicsPrecision=e.wallDeformPhysicsPrecision),void 0!==e.wallPhysicsSamples&&(Gn.wallPhysicsSamples=e.wallPhysicsSamples),void 0!==e.wallPhysicsSkipInactive&&(Gn.wallPhysicsSkipInactive=e.wallPhysicsSkipInactive),void 0!==e.wallPhysicsUpdateHz&&(Gn.wallPhysicsUpdateHz=e.wallPhysicsUpdateHz),void 0!==e.wallPhysicsMaxSubstepHz&&(Gn.wallPhysicsMaxSubstepHz=e.wallPhysicsMaxSubstepHz),void 0!==e.wallPhysicsInterpolation&&(Gn.wallPhysicsInterpolation=e.wallPhysicsInterpolation),void 0!==e.wallPhysicsAdaptiveSamples&&(Gn.wallPhysicsAdaptiveSamples=e.wallPhysicsAdaptiveSamples),void 0!==e.wallPhysicsMinSamples&&(Gn.wallPhysicsMinSamples=e.wallPhysicsMinSamples),void 0!==e.wallVisualDeformMul&&(Gn.wallVisualDeformMul=e.wallVisualDeformMul),void 0!==e.wallRenderDecimation&&(Gn.wallRenderDecimation=e.wallRenderDecimation),void 0!==e.wallColorLight&&(Gn.frameColorLight=e.wallColorLight,Gn.frameColor=e.wallColorLight),void 0!==e.wallColorDark&&(Gn.frameColorDark=e.wallColorDark,e.wallColorLight||(Gn.frameColor=e.wallColorDark)),void 0!==e.gateOverlayEnabled&&(Gn.gateOverlayEnabled=e.gateOverlayEnabled),void 0!==e.gateOverlayOpacity&&(Gn.gateOverlayOpacity=e.gateOverlayOpacity),void 0!==e.gateOverlayBlurPx&&(Gn.gateOverlayBlurPx=e.gateOverlayBlurPx),void 0!==e.gateOverlayTransitionMs&&(Gn.gateOverlayTransitionMs=e.gateOverlayTransitionMs),void 0!==e.gateOverlayTransitionOutMs&&(Gn.gateOverlayTransitionOutMs=e.gateOverlayTransitionOutMs),void 0!==e.orbit3dMoonCount&&(Gn.orbit3dMoonCount=r(e.orbit3dMoonCount,1,1e3,Gn.orbit3dMoonCount)),void 0!==e.orbit3dGravity&&(Gn.orbit3dGravity=r(e.orbit3dGravity,1e3,5e5,Gn.orbit3dGravity)),void 0!==e.orbit3dMoonMass&&(Gn.orbit3dMoonMass=r(e.orbit3dMoonMass,.1,100,Gn.orbit3dMoonMass)),void 0!==e.orbit3dVelocityMult&&(Gn.orbit3dVelocityMult=r(e.orbit3dVelocityMult,10,1e3,Gn.orbit3dVelocityMult)),void 0!==e.orbit3dTargetOrbit&&(Gn.orbit3dTargetOrbit=r(e.orbit3dTargetOrbit,1,100,Gn.orbit3dTargetOrbit)),void 0!==e.orbit3dMinOrbit&&(Gn.orbit3dMinOrbit=r(e.orbit3dMinOrbit,1,100,Gn.orbit3dMinOrbit)),void 0!==e.orbit3dMaxOrbit&&(Gn.orbit3dMaxOrbit=r(e.orbit3dMaxOrbit,1,200,Gn.orbit3dMaxOrbit)),void 0!==e.orbit3dDepthScale&&(Gn.orbit3dDepthScale=r(e.orbit3dDepthScale,0,1.5,Gn.orbit3dDepthScale)),void 0!==e.orbit3dDamping&&(Gn.orbit3dDamping=r(e.orbit3dDamping,.01,.2,Gn.orbit3dDamping)),void 0!==e.orbit3d2MoonCount&&(Gn.orbit3d2MoonCount=r(e.orbit3d2MoonCount,1,300,Gn.orbit3d2MoonCount)),void 0!==e.orbit3d2Gravity&&(Gn.orbit3d2Gravity=r(e.orbit3d2Gravity,1e3,5e5,Gn.orbit3d2Gravity)),void 0!==e.orbit3d2VelocityMult&&(Gn.orbit3d2VelocityMult=r(e.orbit3d2VelocityMult,.1,2,Gn.orbit3d2VelocityMult)),void 0!==e.orbit3d2MinOrbit&&(Gn.orbit3d2MinOrbit=r(e.orbit3d2MinOrbit,1,50,Gn.orbit3d2MinOrbit)),void 0!==e.orbit3d2MaxOrbit&&(Gn.orbit3d2MaxOrbit=r(e.orbit3d2MaxOrbit,1,50,Gn.orbit3d2MaxOrbit)),void 0!==e.orbit3d2DepthScale&&(Gn.orbit3d2DepthScale=r(e.orbit3d2DepthScale,0,.95,Gn.orbit3d2DepthScale)),void 0!==e.orbit3d2Damping&&(Gn.orbit3d2Damping=r(e.orbit3d2Damping,0,1,Gn.orbit3d2Damping)),void 0!==e.orbit3d2FollowSmoothing&&(Gn.orbit3d2FollowSmoothing=r(e.orbit3d2FollowSmoothing,1,200,Gn.orbit3d2FollowSmoothing)),void 0!==e.orbit3d2Softening&&(Gn.orbit3d2Softening=r(e.orbit3d2Softening,1,100,Gn.orbit3d2Softening));const o=l();if(void 0!==e.containerBorderVw&&(Gn.containerBorderVw=r(e.containerBorderVw,0,20,Gn.containerBorderVw)),void 0!==e.simulationPaddingVw&&(Gn.simulationPaddingVw=r(e.simulationPaddingVw,0,20,Gn.simulationPaddingVw)),void 0!==e.contentPaddingVw&&(Gn.contentPaddingVw=r(e.contentPaddingVw,0,40,Gn.contentPaddingVw)),void 0!==e.contentPaddingHorizontalRatio&&(Gn.contentPaddingHorizontalRatio=r(e.contentPaddingHorizontalRatio,.1,3,Gn.contentPaddingHorizontalRatio)),void 0!==e.mobileWallThicknessXFactor&&(Gn.mobileWallThicknessXFactor=r(e.mobileWallThicknessXFactor,.5,3,Gn.mobileWallThicknessXFactor)),void 0!==e.mobileEdgeLabelsVisible&&(Gn.mobileEdgeLabelsVisible=!!e.mobileEdgeLabelsVisible),void 0!==e.wallRadiusVw&&(Gn.wallRadiusVw=r(e.wallRadiusVw,0,40,Gn.wallRadiusVw)),void 0!==e.wallThicknessVw&&(Gn.wallThicknessVw=r(e.wallThicknessVw,0,20,Gn.wallThicknessVw)),!Number.isFinite(Gn.containerBorderVw)||0>=Gn.containerBorderVw){const e=a("--container-border-vw",null);Number.isFinite(e)&&e>0&&(Gn.containerBorderVw=e)}if(!Number.isFinite(Gn.wallRadiusVw)||0>=Gn.wallRadiusVw){const e=a("--wall-radius-vw",null);Number.isFinite(e)&&e>0&&(Gn.wallRadiusVw=e)}if(!Number.isFinite(Gn.wallThicknessVw)||0>=Gn.wallThicknessVw){const e=a("--wall-thickness-vw",null);Number.isFinite(e)&&e>0&&(Gn.wallThicknessVw=e)}Number.isFinite(Gn.containerBorderVw)&&Gn.containerBorderVw>0||(Gn.containerBorderVw=c(Gn.containerBorder,o)),Number.isFinite(Gn.simulationPaddingVw)&&Gn.simulationPaddingVw>=0||(Gn.simulationPaddingVw=c(Gn.simulationPadding,o)),Number.isFinite(Gn.contentPaddingVw)&&Gn.contentPaddingVw>0||(Gn.contentPaddingVw=c(Gn.contentPadding,o)),Number.isFinite(Gn.wallRadiusVw)&&Gn.wallRadiusVw>0||(Gn.wallRadiusVw=c(Gn.wallRadius,o)),Number.isFinite(Gn.wallThicknessVw)&&Gn.wallThicknessVw>0||(Gn.wallThicknessVw=c(Gn.wallThickness,o)),p()}function f(){return Gn}function m(e){const t=f(),a=Math.round(+e||0);return Math.max(0,t.isMobile?Math.round(a*Math.max(0,Math.min(1,+(t.mobileObjectReductionFactor??.7)))):a)}function g(e,t,a){Gn.canvas=e,Gn.ctx=t,Gn.container=a}function b(e){Gn.currentMode=e}function M(){Gn.balls.length=0}function y(){const e=navigator.userAgent||"",t=/iPad/.test(e)||/Mac/.test(e)&&navigator.maxTouchPoints>1,a=/iPhone/.test(e);let n=!1;try{n=!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(l){}const o=!(!t&&!a),i=n,r=o,s=o||n?Gn.responsiveScaleMobile:1;if(Gn.isMobile!==r||Gn.isMobileViewport!==i||Math.abs((Gn.responsiveScale??1)-s)>1e-6){Gn.isMobile=r,Gn.isMobileViewport=i,Gn.responsiveScale=s,(Gn.isMobile||Gn.isMobileViewport)&&console.log(`✓ Mobile scaling active - ball scale: ${Gn.responsiveScale}x (${Gn.isMobile?"device":"viewport"})`),v();try{const e=(Gn.R_MIN+Gn.R_MAX)/2;if(Number.isFinite(e)&&e>0&&Array.isArray(Gn.balls)&&Gn.balls.length)for(let t=0;Gn.balls.length>t;t++){const a=Gn.balls[t];a&&(a.r=e,a.rBase=e)}}catch(l){}}}function v(){Gn.R_MED=Math.max(1,(Gn.R_MIN_BASE+Gn.R_MAX_BASE)/2*Gn.sizeScale*Gn.responsiveScale);const e=r(Gn.sizeVariationCap,0,.2,.12),t=r(Gn.sizeVariationGlobalMul,0,2,1),a=r(e*t,0,.2,e);Gn.R_MIN=Math.max(1,Gn.R_MED*(1-a)),Gn.R_MAX=Math.max(Gn.R_MIN,Gn.R_MED*(1+a))}function x(e){const t=+e;return Number.isFinite(t)?0>t?0:t>1?1:t:0}function w(e){const t=((e||"")+"").trim();if(!t)return null;const a="#"===t[0]?t.slice(1):t;if(3!==a.length&&6!==a.length)return null;const n=parseInt(3===a.length?a[0]+a[0]+a[1]+a[1]+a[2]+a[2]:a,16);return Number.isFinite(n)?{r:n>>16&255,g:n>>8&255,b:255&n}:null}function S({r:e,g:t,b:a}){return"#"+((255&e)<<16|(255&t)<<8|255&a).toString(16).padStart(6,"0")}function k(e,t,a){return Math.round(e+(t-e)*a)}function C(e,t,a){const n=x(a),o=w(e),i=w(t);return o||i?o?i?S({r:k(o.r,i.r,n),g:k(o.g,i.g,n),b:k(o.b,i.b,n)}):e+"":t+"":"#ffffff"}function P(e){const t=+e;return Number.isFinite(t)?0>t?0:t>255?255:t:0}function F(e,t,a=1){const n=Math.max(1,+a||1),o=w(e),i=w(t);return o||i?o&&i?S({r:P(o.r+(i.r-o.r)*n),g:P(o.g+(i.g-o.g)*n),b:P(o.b+(i.b-o.b)*n)}):t+"":"#ffffff"}function T(e,t,a=.5){const n=x(a),o=[,,,,,,,,];for(let i=0;8>i;i++)o[i]=C(e?.[i],t?.[i],n);return o}function D(e,t,a=1.25){const n=[,,,,,,,,];for(let i=0;8>i;i++)n[i]=t?.[i];const o=[3,5,6,7];for(let i=0;o.length>i;i++){const r=o[i];n[r]=F(e?.[r],t?.[r],a)}return n}function L(e,t,a,n=t){const o=+e;if(!Number.isFinite(o))return n;const i=Math.floor(o);return t>i?t:i>a?a:i}function I(e,t,a){const n=+e;if(!Number.isFinite(n))return t;const o=Math.floor(n);return t>o?t:o>a?a:o}function A(e){return Array.isArray(e)&&e.every(e=>Number.isFinite(+e))}function K(e){const t=((e||"")+"").trim();if(!t)return null;const a="#"===t[0]?t.slice(1):t;if(3!==a.length&&6!==a.length)return null;const n=parseInt(3===a.length?a[0]+a[0]+a[1]+a[1]+a[2]+a[2]:a,16);return Number.isFinite(n)?{r:(n>>16&255)/255,g:(n>>8&255)/255,b:(255&n)/255}:null}function O(e){return e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92}function E(e){const t=K(e);return t?.2126*O(t.r)+.7152*O(t.g)+.0722*O(t.b):1}function B(e){const t=K(e);if(!t)return 0;const a=Math.max(t.r,t.g,t.b);return a>0?(a-Math.min(t.r,t.g,t.b))/a:0}function R(e,t){const a=t||f(),n=e&&e.length?e:[],o=Math.min(7,n.length-1);if(0>o)return[];const i=Number.isFinite(+a.cursorColorLumaMax)?+a.cursorColorLumaMax:.62,r=A(a.cursorColorAllowIndices)?a.cursorColorAllowIndices.map(e=>I(e,0,7)):[],s=A(a.cursorColorDenyIndices)?a.cursorColorDenyIndices.map(e=>I(e,0,7)):[],l=new Set(s),c=r.length?new Set(r):null,d=[];for(let u=0;o>=u;u++){if(l.has(u))continue;if(c&&!c.has(u))continue;const e=n[u];e&&(E(e)>i||.18>B(e)||d.push(u))}if(d.length)return d;const p=[];for(const u of Qn)u>o||l.has(u)||c&&!c.has(u)||p.push(u);if(p.length)return p;for(let u=0;o>=u;u++)l.has(u)||c&&!c.has(u)||p.push(u);return p}function z(e,{forceMode:t}={}){const a=f(),n=a.currentColors,o=R(n,a),i=I(e,0,7),r=o.includes(i)?i:o[0]??i,s=((e,t)=>{const a=e&&e.length?e:[];return a[I(t,0,Math.max(0,Math.min(7,a.length-1)))]||"#000000"})(n,r);return t&&(a.cursorColorMode=t),a.cursorColorIndex=r,a.cursorColorHex=s,(e=>{try{document.documentElement.style.setProperty("--cursor-color",(e+"").trim()||"#000000")}catch(t){}})(s),{index:r,hex:s}}function W(){const e=f();if("auto"!==e.cursorColorMode)return z(e.cursorColorIndex,{forceMode:e.cursorColorMode}),!1;const t=R(e.currentColors,e);if(!t.length)return!1;const a=Number.isFinite(+e.o)?+e.o:-1;let n=t[Math.random()*t.length|0];return t.length>1&&n===a&&(n=t[Math.random()*t.length|0],n===a&&(n=t[(t.indexOf(a)+1)%t.length])),e.o=n,z(n,{forceMode:"auto"}),!0}function V(e){const t=f(),a=Xn[e];return a?t.isDarkMode?a.dark:a.light:Xn.industrialTeal.light}function $(){const e=f(),t=e.currentColors;if(!t||0===t.length)return console.warn("No colors available, using fallback"),"#ffffff";const a=(e=>{const t=e?.colorDistribution;return Array.isArray(t)?t:null})(e);if(a&&a.length){let e=0;for(let t=0;a.length>t;t++){const n=+a[t]?.weight;Number.isFinite(n)&&n>0&&(e+=n)}if(e>0){let n=Math.random()*e;for(let e=0;a.length>e;e++){const o=a[e],i=+o?.weight;if(Number.isFinite(i)&&i>0&&(n-=i,0>=n))return t[L(o?.colorIndex,0,7,0)]||t[0]||"#ffffff"}const o=a[a.length-1];return t[L(o?.colorIndex,0,7,0)]||t[0]||"#ffffff"}}const n=Math.random();let o=0;const i=Math.min(t.length,8,8);for(let r=0;i>r;r++)if(o+=Jn[r],o>=n)return t[r];return t[Math.min(t.length-1,7)]||"#ffffff"}function N(e){const t=f();t.currentTemplate=e,t.currentColors=V(e);try{localStorage.setItem(Un,(e||"")+"")}catch(a){}try{const t=document.getElementById("colorSelect");t&&(t.value=e)}catch(a){}"auto"!==t.cursorColorMode&&"manual"!==t.cursorColorMode&&(t.cursorColorMode="auto"),z(t.cursorColorIndex,{forceMode:t.cursorColorMode}),(()=>{const e=f().balls;for(let t=0;e.length>t;t++)e[t].color=$()})(),(e=>{try{const t=document.documentElement,a=(e&&e.length?e:[]).slice(0,8);for(let e=0;8>e;e++)t.style.setProperty("--ball-"+(e+1),a[e]||"#ffffff")}catch(a){}})(t.currentColors),(()=>{const e=f().currentColors;for(let t=1;8>=t;t++){const a=document.getElementById("color"+t),n=document.getElementById(`color${t}Val`);a&&e[t-1]&&(a.value=e[t-1],n&&(n.textContent=e[t-1].toUpperCase()))}})();try{window.dispatchEvent(new CustomEvent("bb:paletteChanged",{detail:{template:e}}))}catch(a){}}function _(){const e=document.getElementById("colorSelect");if(!e)return;e.innerHTML="";for(const a of qn){const t=Xn[a];if(!t)continue;const n=document.createElement("option");n.value=a,n.textContent=t.label,e.appendChild(n)}const t=f();e.value=t.currentTemplate}function G(){const e=f(),t=qn.length?qn:Object.keys(Xn);if(!t.length)return null;let a=null;try{a=localStorage.getItem(Un)}catch(i){}const n="string"==typeof a?t.indexOf(a):-1,o=t[0>n?Math.random()*t.length|0:(n+1)%t.length];e.currentTemplate=o;try{localStorage.setItem(Un,o)}catch(i){}return o}function H(e,t=.15){return e*(1+2*(Math.random()-.5)*t)}function j(){try{"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent(bo,{detail:ee()}))}catch(e){}}function Z(){if(!ko&&(ko=!0,"undefined"!=typeof window&&window.matchMedia)){const e=window.matchMedia("(prefers-reduced-motion: reduce)");wo=e.matches,e.addEventListener("change",e=>{wo=e.matches})}}async function Y(){if(go)return!0;try{const e=window.AudioContext||window.webkitAudioContext;return e?(io=new e({latencyHint:"interactive",sampleRate:44100}),"suspended"===io.state&&await io.resume(),(()=>{ro=io.createGain(),ro.gain.value=ao.masterGain,po=io.createDynamicsCompressor(),po.threshold.value=-6,po.knee.value=10,po.ratio.value=16,po.attack.value=5e-4,po.release.value=.08,ho=io.createBiquadFilter(),ho.type="highshelf",ho.frequency.value=ao.highShelfFreq,ho.gain.value=ao.highShelfGain,ho.Q.value=.7,uo=io.createWaveShaper(),uo.curve=((e=.55)=>{const t=1024,a=new Float32Array(t),n=1+8*e;for(let o=0;t>o;o++)a[o]=Math.tanh(n*(2*o/(t-1)-1))/Math.tanh(n);return a})(.55),uo.oversample="2x",lo=io.createGain(),lo.gain.value=1-ao.reverbWetMix,co=io.createGain(),co.gain.value=ao.reverbWetMix,so=(()=>{const e=io.createGain(),t=io.createGain(),a=[.029,.037,.053,.067].map(e=>{const t=io.createDelay(.1);return t.delayTime.value=e*ao.reverbDecay,t}),n=a.map(()=>{const e=io.createGain();return e.gain.value=.4,e}),o=io.createBiquadFilter();return o.type="lowpass",o.frequency.value=2e3*(1-ao.reverbHighDamp),o.Q.value=.5,a.forEach((t,i)=>{e.connect(t),t.connect(n[i]),n[i].connect(o),n[i].connect(a[(i+1)%a.length])}),o.connect(t),e.connect(t),e.l=t,e})();const e=so.l;lo.connect(uo),co.connect(so),e.connect(uo),uo.connect(ho),ho.connect(po),po.connect(ro),ro.connect(io.destination),(()=>{if(io){if(fo)try{fo.disconnect()}catch(e){}else fo=io.createGain(),fo.gain.value=1;fo.connect(po||io.destination)}})(),(()=>{yo=[];for(let e=0;Mo>e;e++){const t={id:e,inUse:!1,startTime:0,filter:io.createBiquadFilter(),envelope:io.createGain(),panner:io.createStereoPanner(),reverbSend:io.createGain(),noiseFilter:io.createBiquadFilter(),noiseEnvelope:io.createGain(),osc:null,harmonicOsc:null,sparkleOsc:null,noiseSource:null};t.filter.type="lowpass",t.noiseFilter.type="bandpass",t.noiseFilter.Q.value=1.2,t.filter.connect(t.envelope),t.envelope.connect(t.panner),t.panner.connect(lo),t.panner.connect(t.reverbSend),t.reverbSend.connect(co),t.noiseFilter.connect(t.noiseEnvelope),t.noiseEnvelope.connect(t.panner),yo.push(t)}})()})(),go=!0,mo=!0,j(),console.log(`✓ Audio unlocked (${(1e3*(io.baseLatency||0)).toFixed(1)}ms base latency)`),!0):(console.warn("Web Audio API not supported"),!1)}catch(e){return console.error("Failed to unlock audio:",e),!1}}function X(e,t,a=.5,n=null){if(!mo||!go||!io||wo)return;if(ao.collisionMinImpact>t)return;const o=io.currentTime;if(.005>o-vo)return;if(null!==n){const e=xo.get(n)||0;if(ao.minTimeBetweenSounds>o-e)return;xo.set(n,o)}if(vo=o,xo.size>200){const e=o-.5;for(const[t,a]of xo)e>a&&xo.delete(t)}const i=(()=>{for(let t=0;Mo>t;t++)if(!yo[t].inUse)return yo[t];let e=yo[0];for(let t=1;Mo>t;t++)e.startTime>yo[t].startTime&&(e=yo[t]);return U(e),e})();i&&((e,t,a,n,o)=>{e.inUse=!0,e.startTime=o;const i=Math.pow(Math.max(0,Math.min(1,a)),ao.intensityExponent),r=H(t,ao.variancePitch),s=H(ao.decayTime,ao.varianceDecay)*(1-i*(1-ao.velocityDecayScale)),l=s+.02;let c=ao.minGain+(ao.maxGain-ao.minGain)*i;c*=H(1,ao.varianceGain);const d=1+(ao.velocityBrightnessScale-1)*i;let p=ao.filterBaseFreq+ao.filterVelocityRange*Math.pow(i,1.3);p*=H(1,ao.varianceFilter)*d;const u=2*(n-.5)*ao.maxPan,h=.12+.5*(1-i);({gain:c,filterFreq:p}=((e,t,a)=>{const n=J((e-ao.toneSafetyMinHz)/(ao.toneSafetyMaxHz-ao.toneSafetyMinHz),0,1),o=ao.toneSafetyExponent,i=Math.pow(n,o),r=J(1-ao.toneSafetyHighGainAtten*i-ao.toneSafetyLowGainAtten*Math.pow(1-n,o),.6,1);let s=Math.min(t*r,ao.voiceGainMax);const l=J(1-ao.toneSafetyHighBrightAtten*i,.55,1);return{gain:s,filterFreq:J(a*l,ao.filterMinHz,ao.filterMaxHz)}})(r,c,p)),e.filter.frequency.value=p,e.filter.Q.value=ao.filterQ,e.panner.pan.value=u,e.reverbSend.gain.value=h,e.noiseFilter.Q.value=J(ao.noiseTransientQ||1.2,.5,8),e.envelope.gain.cancelScheduledValues(o),e.envelope.gain.setValueAtTime(c,o),e.envelope.gain.exponentialRampToValueAtTime(.001,o+s);const f=io.createOscillator();if(f.type="sine",f.frequency.value=r,e.osc=f,f.connect(e.filter),(ao.harmonicGain||0)>.001){const t=io.createOscillator();t.type="sine",t.frequency.value=2*r;const a=io.createGain();a.gain.cancelScheduledValues(o),a.gain.setValueAtTime(c*ao.harmonicGain,o),a.gain.exponentialRampToValueAtTime(.001,o+s),e.harmonicOsc=t,t.connect(a),a.connect(e.filter),t.onended=()=>{try{a.disconnect()}catch(e){}},t.start(o),t.stop(o+l)}else e.harmonicOsc=null;if((ao.sparkleGain||0)>.001){const t=io.createOscillator();t.type="sine";const a=ao.sparkleRatioMin||2.3,n=ao.sparkleRatioMax||4.1,i=J(a+Math.random()*(n-a),1.2,10);t.frequency.value=r*H(i,.02);const d=io.createGain(),p=Math.max(.012,s*J(ao.sparkleDecayMul||.65,.25,.95));d.gain.cancelScheduledValues(o),d.gain.setValueAtTime(c*ao.sparkleGain,o),d.gain.exponentialRampToValueAtTime(.001,o+p),e.sparkleOsc=t,t.connect(d),d.connect(e.filter),t.onended=()=>{try{d.disconnect()}catch(e){}},t.start(o),t.stop(o+l)}else e.sparkleOsc=null;if(ao.noiseTransientEnabled&&i>.25){const t=(()=>{if(!So){const e=2*io.sampleRate;So=io.createBuffer(1,e,io.sampleRate);const t=So.getChannelData(0);let a=0,n=0,o=0;for(let i=0;e>i;i++){const e=2*Math.random()-1;a=.99765*a+.099046*e,n=.963*n+.2965164*e,o=.57*o+1.0526913*e,t[i]=.25*(a+n+o+.1848*e)}}const e=io.createBufferSource();return e.buffer=So,e.loopStart=1.5*Math.random(),e.loopEnd=e.loopStart+.1,e.loop=!1,e})();e.noiseSource=t;const a=Math.pow(i,1.4);e.noiseFilter.frequency.value=H(ao.noiseTransientFilterMin+(ao.noiseTransientFilterMax-ao.noiseTransientFilterMin)*a,ao.varianceNoise);const n=ao.noiseTransientGain*ao.velocityNoiseScale*a*c,r=H(ao.noiseTransientDecay,ao.varianceNoise);e.noiseEnvelope.gain.cancelScheduledValues(o),e.noiseEnvelope.gain.setValueAtTime(n,o),e.noiseEnvelope.gain.exponentialRampToValueAtTime(.001,o+r),t.connect(e.noiseFilter),t.start(o),t.stop(o+r+.01)}else e.noiseSource=null;f.start(o),f.stop(o+l),f.onended=()=>U(e)})(i,(e=>{const t=1-J((e-8)/47,0,1),a=J(ao.pitchMinHz||145,40,6e3),n=J(ao.pitchMaxHz||280,a+10,12e3),o=J(ao.pitchCurve||1,.5,2.5);return(a+Math.pow(t,o)*(n-a))*H(1,1.5*(ao.variancePitch||.06))})(e),Math.max(0,Math.min(1,t)),a,o)}function q({intensity:e=.82,radius:t=18,xPosition:a=.72}={}){X(t,e,a,null)}function U(e){if(e.osc){try{e.osc.stop(),e.osc.disconnect()}catch(t){}e.osc=null}if(e.harmonicOsc){try{e.harmonicOsc.stop(),e.harmonicOsc.disconnect()}catch(t){}e.harmonicOsc=null}if(e.sparkleOsc){try{e.sparkleOsc.stop(),e.sparkleOsc.disconnect()}catch(t){}e.sparkleOsc=null}if(e.noiseSource){try{e.noiseSource.stop(),e.noiseSource.disconnect()}catch(t){}e.noiseSource=null}e.inUse=!1}function J(e,t,a){return t>e?t:e>a?a:e}function Q(){return!!go&&(mo=!mo,j(),mo)}function ee(){return{isUnlocked:go,isEnabled:mo,activeSounds:yo.filter(e=>e.inUse).length,poolSize:Mo}}function te(){return{...ao}}function ae(e){for(const[t,a]of Object.entries(e))t in ao&&(ao[t]=a);co&&lo&&"reverbWetMix"in e&&(co.gain.value=ao.reverbWetMix,lo.gain.value=1-ao.reverbWetMix),ho&&("highShelfFreq"in e||"highShelfGain"in e)&&(ho.frequency.value=ao.highShelfFreq,ho.gain.value=ao.highShelfGain),ro&&"masterGain"in e&&(ro.gain.value=ao.masterGain)}function ne(e){const t=no[e];if(!t)return!1;oo=e;const{label:a,description:n,...o}=t;return ae(o),!0}function oe(){return oo}function ie(){const e=f(),t=e.balls,a=e.canvas,n=e.R_MAX,o=e.ballSpacing||0,i=t.length;if(Po.length=0,2>i)return Po;const r=!1!==e.physicsSpatialGridOptimization;if(r){let e=!1;for(let a=0;i>a;a++){const n=t[a];if(n&&!n.isSleeping){e=!0;break}}if(!e)return Po}const s=Math.max(1,2*n*(1+o)),l=Math.ceil(a.width/s)+1;if(r)for(const c of Co.values())c.length=0;else Co.clear();for(let c=0;i>c;c++){const e=t[c],a=(e.y/s|0)*l+(e.x/s|0);let n=Co.get(a);n||(n=[],Co.set(a,n)),n.push(c)}for(const[c,d]of Co){if(0===d.length)continue;const e=c/l|0,a=c%l;for(let n=-1;1>=n;n++)for(let i=-1;1>=i;i++){const r=Co.get((e+n)*l+(a+i));if(r&&0!==r.length)for(let e=0;d.length>e;e++){const a=d[e];for(let e=0;r.length>e;e++){const n=r[e];if(a>=n)continue;const i=t[a],s=t[n],l=s.x-i.x,c=s.y-i.y,d=i.r+s.r+(i.r+s.r)/2*o,p=l*l+c*c;if(d*d>p){const e=d-Math.sqrt(Math.max(p,Wn.MIN_DISTANCE_EPSILON)),t=Po.length;let o=Fo[t];o||(o={i:0,j:0,overlap:0},Fo[t]=o),o.i=a,o.j=n,o.overlap=e,Po.push(o)}}}}}return Po.sort((e,t)=>t.overlap-e.overlap),Po}function re(e=10){const t=f(),a=t.balls,n=ie(),o=t.REST,i=.5*t.DPR,r=t.ballSpacing||0,s=!!t.physicsSkipSleepingCollisions;for(let l=0;e>l;l++)for(let e=0;n.length>e;e++){const{i:c,j:d}=n[e],p=a[c],u=a[d],h=u.x-p.x,f=u.y-p.y,m=p.r+u.r+(p.r+u.r)/2*r,g=h*h+f*f;if(0===g||g>m*m)continue;const b=Math.sqrt(g),M=h/b,y=f/b,v=m-b,x=1/Math.max(p.m,.001),w=1/Math.max(u.m,.001),S=p.isSleeping&&u.isSleeping,k=.8*Math.max(v-i,0)/(x+w),C=k*M,P=k*y;p.x-=C*x,p.y-=P*x,u.x+=C*w,u.y+=P*w;const F="pit"===t.currentMode||"pit-throws"===t.currentMode;if(F&&-.3>y?u.hasSupport=!0:F&&y>.3&&(p.hasSupport=!0),s&&S)continue;if(S)continue;const T=u.vx-p.vx,D=u.vy-p.vy,L=T*M+D*y,I=-15*(t.DPR||1)>L;if((!p.isSleeping||I)&&(!u.isSleeping||I)&&(p.isSleeping&&p.wake(),u.isSleeping&&u.wake(),0>L)){const e=-(1+(30>Math.abs(L)?0:o))*L/(x+w),a=e*M,n=e*y;p.vx-=a*x,p.vy-=n*x,u.vx+=a*w,u.vy+=n*w;const i=T-L*M,r=D-L*y,s=Math.hypot(i,r);if(s>.001){const e=0>i*-y+r*M?-1:1,t=Wn.SPIN_GAIN_TANGENT;p.omega-=e*t*s/Math.max(p.r,1),u.omega+=e*t*s/Math.max(u.r,1)}const d=Math.min(1,Math.abs(L)/(50*(p.r+u.r))),h=Math.min(t.getSquashMax(),.8*d);p.squashAmount=Math.max(p.squashAmount,.8*h),p.squashNormalAngle=Math.atan2(-y,-M),u.squashAmount=Math.max(u.squashAmount,.8*h),u.squashNormalAngle=Math.atan2(y,M),0===l&&X((p.r+u.r)/2,d,(p.x+u.x)/2/(t.canvas?.width||1),`${c}-${e}`)}}}function se(){try{const e=document.documentElement,t=document.body,a=document.getElementById("bravia-balls"),n=(e,t)=>{if(!e)return"";try{return getComputedStyle(e).getPropertyValue(t).trim()||getComputedStyle(e).getPropertyValue(t).trim()}catch(a){return""}};let o=n(e,"--wall-color");return o||(o=e.classList.contains("dark-mode")||t.classList.contains("dark-mode")?n(e,"--wall-color-dark")||n(e,"--frame-color-dark"):n(e,"--wall-color-light")||n(e,"--frame-color-light")),o||(o=n(t,"--wall-color")||n(a,"--wall-color")),o||"#0a0a0a"}catch{return"#0a0a0a"}}function le(e,t,a){return t>e?t:e>a?a:e}function ce(e,t,a){return e+(t-e)*a}function de(e,t){switch(t){case Bn.PIT:return e.sizeVariationPit??0;case Bn.PIT_THROWS:return e.sizeVariationPitThrows??0;case Bn.FLIES:return e.sizeVariationFlies??0;case Bn.WEIGHTLESS:return e.sizeVariationWeightless??0;case Bn.WATER:return e.sizeVariationWater??0;case Bn.VORTEX:return e.sizeVariationVortex??0;case Bn.PING_PONG:return e.sizeVariationPingPong??0;case Bn.MAGNETIC:return e.sizeVariationMagnetic??0;case Bn.BUBBLES:return e.sizeVariationBubbles??0;case Bn.KALEIDOSCOPE:case Bn.KALEIDOSCOPE_1:case Bn.KALEIDOSCOPE_2:case Bn.KALEIDOSCOPE_3:return e.sizeVariationKaleidoscope??0;case Bn.ORBIT_3D:return e.sizeVariationOrbit3d??0;case Bn.ORBIT_3D_2:return e.sizeVariationOrbit3d2??0;case Bn.CRITTERS:return e.sizeVariationCritters??0;case Bn.NEURAL:return e.sizeVariationNeural??0;case Bn.LATTICE:return e.sizeVariationLattice??0;case Bn.PARALLAX_LINEAR:return e.sizeVariationParallaxLinear??0;case Bn.PARALLAX_PERSPECTIVE:return e.sizeVariationParallaxPerspective??0;default:return 0}}function pe(e,t){const a=le(+(e.sizeVariationCap??.12),0,Bo),n=le(+(e.sizeVariationGlobalMul??1),0,2),o=le(+(de(e,t)??0),0,1);return le(a*n*o,0,Bo)}function ue(e,t){const a=Number.isFinite(e?.R_MIN)?Math.max(1,e.R_MIN):0,n=Number.isFinite(e?.R_MAX)?Math.max(a||1,e.R_MAX):0;if(a>0&&n>0)return le(t,a,n);const o=Math.max(1,e?.R_MED||t||1);return le(t,.8*o,1.2*o)}function he(e,t){const{minR:a,maxR:n,medR:o}=((e,t)=>{const a=Math.max(1,e.R_MED||.5*(e.R_MIN+e.R_MAX)||10),n=le(+(e.sizeVariationCap??.12),0,Bo),o=le(+(e.sizeVariationGlobalMul??1),0,2),i=le(+(de(e,t)??0),0,1),r=le(n*o*i,0,Bo);return{minR:Math.max(1,a*(1-r)),maxR:Math.max(1,a*(1+r)),medR:a}})(e,t);return 1e-6>n-a?o:ce(a,n,Math.random())}function fe(e,t){const a=f(),n=a.waterDrag||.015;e.vx*=1-n,e.vy*=1-n,e.omega*=1-.5*n;const o=a.DPR||1;for(let r=0;Ro.length>r;r++){const a=Ro[r],n=e.x-a.x,i=e.y-a.y,s=Math.sqrt(n*n+i*i),l=40*o;if(s>a.radius-l&&a.radius+l>s){const o=a.strength*(1-Math.abs(s-a.radius)/l);if(s>.1){const a=i/s;e.vx+=n/s*o*t,e.vy+=a*o*t}}}const i=a.waterDriftStrength||25;e.vx+=Math.sin(.5*e.t+.01*e.x)*i*t,e.vy+=Math.cos(.7*e.t+.01*e.y)*i*t}function me(e){const t=f().waterRippleSpeed||300;for(let a=Ro.length-1;a>=0;a--){const n=Ro[a];n.radius+=t*e,n.age+=e,n.strength*=.96,(n.age>3||10>n.strength)&&Ro.splice(a,1)}}function ge(e,t,a=1){const n=f();Ro.push({x:e,y:t,radius:0,strength:(n.waterRippleStrength||15e3)*Math.min(a,5),age:0})}function be(e,t,a){a||(a=$());const n=f(),o=he(n,n.currentMode||Bn.PIT),i=new Eo(e,t,o,a),r=.5*n.canvas.width>e?1:-1,s=Math.max(.6,Math.min(1.4,o/(.5*(n.R_MIN+n.R_MAX)))),l=180*s;return i.vx=r*(140*s+Math.random()*l),i.vy=120*-Math.random(),i.driftAx=r*(360+420*Math.random())*s,i.driftTime=.22+.28*Math.random(),n.balls.push(i),i}function Me(e,t){const a=f(),n=(-1e9===a.mouseX?.5*a.canvas.width:a.mouseX)-e.x,o=(-1e9===a.mouseY?.5*a.canvas.height:a.mouseY)-e.y,i=Math.sqrt(n*n+o*o+1),r=o/i;e.vx+=n/i*4e3*t,e.vy+=4e3*r*t;const s=120*a.DPR;let l=0,c=0,d=0;for(let p=0;a.balls.length>p;p++){const t=a.balls[p];if(t===e)continue;const n=e.x-t.x,o=e.y-t.y,i=n*n+o*o;if(s*s>i&&i>0){const e=Math.sqrt(i),t=1-e/s;l+=n/e*t,c+=o/e*t,d++}}if(d>0){const a=15e3;e.vx+=l/d*a*t,e.vy+=c/d*a*t}e.vx+=1e3*(Math.random()-.5)*t,e.vy+=1e3*(Math.random()-.5)*t}function ye(e,t){const a=f(),n=a.repelPower,o=a.repelRadius;if(!a.repellerEnabled||0>=n||0>=o)return;const i=o*a.DPR,r=e.x-a.mouseX,s=e.y-a.mouseY,l=r*r+s*s;if(l>i*i)return;const c=Math.max(Math.sqrt(l),1e-4),d=r/c,p=s/c,u=20*n*Math.pow(Math.max(0,1-c/i),a.repelSoft||3.4),h=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=d*u*t/h,e.vy+=p*u*t/h}function ve(e,t,a){return Math.max(t,Math.min(a,e))}function xe(e,t){return e+Math.random()*(t-e)}function we(e){e.spawnedTotal=1+(0|e.spawnedTotal)}function Se(e,t,a,{speedMul:n=1,spreadMul:o=1}={}){const i=e.canvas.width,r=e.canvas.height,s=e.DPR,l=(e.wallThickness||20)*s,c=Math.max(1,i-2*l),d=.35*-r,p=.05*-r,u=ve(e.pitThrowInletInset??.06,0,.2),h=0===a?l+c*u:i-l-c*u,f=ve(e.pitThrowSpawnSpread??.02,0,.12),m=ve(f*o,0,.18),g=h+xe(-c*m,c*m),b=xe(d,p),M=ve(e.pitThrowTargetYFrac??.36,.12,.7),y=ve(e.pitThrowCrossBias??.12,0,.35),v=ve(e.pitThrowAimJitter??.04,0,.2),x=ve(v*o,0,.25),w=i*(.5+(0===a?y:-y)+xe(-x,x)),S=r*M,k=ve(e.pitThrowSpeed??650,50,4e3)*s,C=ve(e.pitThrowSpeedJitter??.22,0,.8),P=ve(e.pitThrowAngleJitter??.16,0,.8),F=be(g,b,t),T=w-g,D=S-b,L=Math.max(1e-4,Math.sqrt(T*T+D*D));let I=T/L,A=D/L;const K=xe(-Math.PI,Math.PI)*P,O=Math.cos(K),E=Math.sin(K),B=I*E+A*O;I=I*O-A*E,A=B;const R=k*n*(1+xe(-C,C));return F.vx=I*R,F.vy=A*R,F.driftAx=0,F.driftTime=0,F}function ke(e){const t=f();if(!t||"pit-throws"!==t.currentMode)return;const a=Math.max(0,m(t.maxBalls??300));if(0>=a)return;if(t.balls.length>=a)return;const n=t.p;if(!n)return;const o=ve(t.pitThrowIntervalMs??70,10,2e3)/1e3,i=ve(t.pitThrowBatchSize??12,1,100),r=ve(t.pitThrowColorPauseMs??400,0,3e3)/1e3,s=ve(t.pitThrowPairChance??.35,0,1),l=ve(t.pitThrowPairStaggerMs??18,0,300)/1e3,c=ve(t.pitThrowSpeedVar??.18,0,1),d=ve(t.pitThrowSpreadVar??.25,0,1);n.cooldown-=e,0>n.cooldown&&(n.cooldown=0);let p=0;for(0>n.queueA||(n.queueA-=e),0>n.queueB||(n.queueB-=e);6>p&&a>t.balls.length;){let e=!1;if(n.queueA>=0&&0>=n.queueA){const a=1+xe(-c,c),o=1+xe(-d,d);Se(t,n.queueColorA,n.queueSideA,{speedMul:a,spreadMul:o}),n.queueA=-1,p++,e=!0}if(p>=6||t.balls.length>=a)break;if(n.queueB>=0&&0>=n.queueB){const a=1+xe(-c,c),o=1+xe(-d,d);Se(t,n.queueColorB,n.queueSideB,{speedMul:a,spreadMul:o}),n.queueB=-1,p++,e=!0}if(!e)break}if(0>=n.cooldown)for(n.batchPaused&&(n.batchPaused=!1,n.batchCount=0,n.side=1-n.side);6>p&&a>t.balls.length;){if(r>0&&n.batchCount>=i){n.cooldown=r,n.batchPaused=!0;break}const e=n.side,u=1+xe(-c,c),h=1+xe(-d,d);if(Se(t,we(n),e,{speedMul:u,spreadMul:h}),p++,n.batchCount++,s>Math.random()&&a>t.balls.length&&i>n.batchCount){const t=we(n);0>n.queueA&&(n.queueA=l,n.queueColorA=t,n.queueSideA=e,n.batchCount++)}n.cooldown=o;break}}function Ce(e,t){const a=f();if(!a.mouseInCanvas)return;const n=a.weightlessRepelRadius??0,o=a.weightlessRepelPower??0;if(0>=n||0>=o)return;const i=n*(a.DPR||1),r=e.x-a.mouseX,s=e.y-a.mouseY,l=r*r+s*s;if(l>i*i)return;const c=Math.max(Math.sqrt(l),1e-4),d=r/c,p=s/c,u=20*o*Math.pow(Math.max(0,1-c/i),a.weightlessRepelSoft??2.2),h=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=d*u*t/h,e.vy+=p*u*t/h}function Pe(){if(zo=document.getElementById("c"),!zo)return void console.error("Canvas not found");Wo=zo.getContext("2d",{alpha:!0,desynchronized:!0,willReadFrequently:!1}),Wo||(Wo=zo.getContext("2d"),console.warn("⚠️ Desynchronized mode unavailable, using standard context")),(()=>{const e=window.devicePixelRatio||1;(navigator.connection?.saveData||4>=navigator.hardwareConcurrency||/Android|iPhone|iPad|iPod/i.test(navigator.userAgent))&&e>1.5?(Vo=1.5,console.log("⚡ Adaptive DPR: Reduced to 1.5x for performance")):Vo=Math.min(e,2),i(Vo)})(),Wo.imageSmoothingEnabled=!1;const e=()=>{_o&&cancelAnimationFrame(_o),_o=requestAnimationFrame(()=>{Fe(),_o=null})};if(window.addEventListener("resize",e),window.addEventListener("orientationchange",()=>{setTimeout(Fe,100),setTimeout(Fe,300)}),window.visualViewport&&(window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e)),"undefined"!=typeof ResizeObserver){const t=document.getElementById("bravia-balls");t&&new ResizeObserver(()=>{e()}).observe(t)}console.log(`✓ Renderer optimized (DPR: ${Vo.toFixed(2)}, desync: ${Wo.getContextAttributes?.()?.desynchronized??"unknown"})`)}function Fe(){if(!zo)return;const e=f();try{const e=window.visualViewport,t=e&&"number"==typeof e.height?e.height:window.innerHeight,a=e&&"number"==typeof e.width?e.width:window.innerWidth,n=t>0?t:window.innerHeight,o=a>0?a:window.innerWidth,i=e&&"number"==typeof e.offsetTop?e.offsetTop:0,r=e&&"number"==typeof e.offsetLeft?e.offsetLeft:0,s=Number.isFinite(i)?i:0,l=Number.isFinite(r)?r:0;let c=s+n/2,d=l+o/2;d>0||(d=window.innerWidth/2),c>0||(c=window.innerHeight/2);const p=document.documentElement?.style;p?.setProperty("--abs-viewport-h",n+"px"),p?.setProperty("--abs-vv-offset-top",s+"px"),p?.setProperty("--abs-vv-offset-left",l+"px"),p?.setProperty("--abs-vv-h",n+"px"),p?.setProperty("--abs-vv-w",o+"px"),p?.setProperty("--abs-vv-center-x",d+"px"),p?.setProperty("--abs-vv-center-y",c+"px")}catch(d){}try{p(),u()}catch(d){}try{y()}catch(d){}const t=e.container||document.getElementById("bravia-balls"),a=t?t.clientWidth:window.innerWidth,n=t?t.clientHeight:window.innerHeight;if(0>=a||0>=n)return;const o=a,i=n,r=Vo,s=Math.floor(o*r),l=Math.floor(i*r);if(0>=s||0>=l)return;if(s===$o&&l===No)return;if($o>0&&No>0&&e.balls&&e.balls.length>0){const t=s/$o,a=l/No;if(t>.1&&10>t&&a>.1&&10>a){const n=e.balls;for(let e=0;n.length>e;e++){const o=n[e];if(!o)continue;o.x*=t,o.y*=a;const i=o.r||10;o.x=Math.max(i,Math.min(s-i,o.x)),o.y=Math.max(i,Math.min(l-i,o.y)),o.isSleeping&&(o.isSleeping=!1,o.sleepTimer=0)}}}$o=s,No=l;const c=zo.width!==s||zo.height!==l;if(c&&(zo.width=s,zo.height=l,Wo&&(Wo.imageSmoothingEnabled=!1)),zo.style.width=o+"px",zo.style.height=i+"px",c&&((e=>{e.style.filter=""})(zo),Go))try{Go()}catch(d){}try{const t=0;(zo.width!==Ho||zo.height!==jo||Math.abs(t-Zo)>.001)&&(Ho=zo.width,jo=zo.height,Zo=t,e.canvasClipPath=((e,t,a)=>{const n=Math.max(0,Math.min(a,.5*Math.min(e,t)));if("undefined"==typeof Path2D)return null;const o=new Path2D;return n>0?(o.moveTo(n,0),o.lineTo(e-n,0),o.arcTo(e,0,e,n,n),o.lineTo(e,t-n),o.arcTo(e,t,e-n,t,n),o.lineTo(n,t),o.arcTo(0,t,0,t-n,n),o.lineTo(0,n),o.arcTo(0,0,n,0,n),o.closePath(),o):(o.rect(0,0,e,t),o)})(zo.width,zo.height,t))}catch(d){}}function Te(){return zo}function De(){return Wo}function Le(e,t){const a=f();if(a.currentMode!==Bn.VORTEX)return;if(!a.mouseInCanvas)return;const n=a.vortexSwirlStrength||420,o=a.vortexRadialPull||180,i=a.vortexSpeedMultiplier??1,r=a.vortexRadius??0,s=a.vortexFalloffCurve??1,l=a.vortexRotationDirection??1,c=a.vortexCoreStrength??1,d=a.vortexAccelerationZone??0,p=a.vortexOutwardPush??0,u=e.x-a.mouseX,h=e.y-a.mouseY,m=Math.max(8,Math.sqrt(u*u+h*h));if(r>0&&m>r){if(p>0){const a=h/m,n=p*((m-r)/r);e.vx+=u/m*n*t,e.vy+=a*n*t}return}let g;g=Math.pow(r>0?1-Math.min(1,m/r):1/(1+m*(a.vortexFalloffRate??.0015)),s);const b=1+(c-1)*(1-Math.min(1,m/(r||400))),M=n*g*b*i,y=o*g*b*i;let v=1;if(d>0){const e=Math.abs(m-d),t=.3*d;t>e&&(v=1+.5*(1-e/t))}const x=u/m,w=h/m,S=x*l,k=M*v;e.vx+=-w*l*k*t,e.vy+=S*k*t;const C=y*v;e.vx-=x*C*t,e.vy-=w*C*t;const P=Math.max(0,Math.min(1,a.vortexDrag??.005));e.vx*=1-P,e.vy*=1-P}function Ie(e){const t=f();if(t.currentMode!==Bn.PING_PONG)return;if(!e.isPingPong)return;if(t.mouseInCanvas){const a=Math.max(0,t.pingPongCursorRadius||0)*t.DPR,n=e.x-t.mouseX,o=e.y-t.mouseY,i=Math.sqrt(n*n+o*o),r=a+e.r;if(r>i&&i>.1){const t=r-i,a=n/i,s=o/i;e.x+=a*t*1.1,e.y+=s*t*1.1;const l=e.vx*a+e.vy*s;0>l&&(e.vx-=2*l*a,e.vy-=2*l*s,e.omega+=.02*l)}}const a=t.pingPongSpeed||400;.9*a>Math.abs(e.vx)&&(e.vx=(0>e.vx?-1:1)*a),e.vy*=Math.max(0,Math.min(1,t.pingPongVerticalDamp??.995))}function Ae(e,t){const a=f();if(a.currentMode!==Bn.MAGNETIC)return;if(!a.mouseInCanvas)return;const n=a.mouseX-e.x,o=a.mouseY-e.y,i=a.DPR||1,r=Math.max(30*i,Math.sqrt(n*n+o*o)),s=(a.magneticStrength||65e3)/(r*r)*1e3,l=o/r,c=e.charge||1;e.vx+=n/r*s*c*t,e.vy+=l*s*c*t;const d=(a.magneticMaxVelocity||2800)*i,p=Math.sqrt(e.vx*e.vx+e.vy*e.vy);p>d&&(e.vx=e.vx/p*d,e.vy=e.vy/p*d),e.vx*=.998,e.vy*=.998}function Ke(){const e=f();if(e.currentMode===Bn.MAGNETIC)for(let t=0;e.balls.length>t;t++)e.balls[t].alpha=1}function Oe(e,t,a,n=!1){const o=f(),i=o.DPR||1,r=he(o,Bn.BUBBLES),s=new Eo(e,t,n?r:.1,a);return s.isBubble=!0,s.baseRadius=r,s.targetRadius=r,s.wobblePhase=Math.random()*Math.PI*2,s.wobbleFreq=2+3*Math.random(),s.vx=20*(Math.random()-.5)*i,s.vy=(-50-50*Math.random())*i,s.spawning=!n,s.spawnProgress=n?1:0,s.dissipating=!1,s.dissipateProgress=0,s.alpha=1,o.balls.push(s),s}function Ee(e){const t=f(),a=t.canvas;if(!a)return;const n=t.DPR||1,o=a.width,i=a.height;e.x=Math.random()*o,e.y=i+(60+30*Math.random())*n,e.vx=20*(Math.random()-.5)*n,e.vy=(-50-50*Math.random())*n,e.wobblePhase=Math.random()*Math.PI*2,e.wobbleFreq=2+3*Math.random(),e.color=$(),e.targetRadius=he(t,Bn.BUBBLES),e.baseRadius=e.targetRadius,e.r=.1,e.rBase=.1,e.spawning=!0,e.spawnProgress=0,e.dissipating=!1,e.dissipateProgress=0,e.alpha=1}function Be(e,t){const a=f();if(a.currentMode!==Bn.BUBBLES)return;if(!e.isBubble)return;const n=a.canvas;if(!n)return;if(e.spawning&&(e.spawnProgress+=3*t,e.r=e.targetRadius*(1-Math.pow(1-Math.min(1,e.spawnProgress),3)),e.rBase=e.r,1>e.spawnProgress||(e.spawning=!1,e.r=e.targetRadius,e.rBase=e.targetRadius)),e.dissipating){e.dissipateProgress+=3*t;const a=Math.pow(e.dissipateProgress,2);return e.r=e.targetRadius*Math.max(0,1-a),e.rBase=e.r,e.alpha=Math.max(0,1-.5*a),e.vy*=.92,e.vx*=.92,void(1>e.dissipateProgress||Ee(e))}const o=.01*(a.bubblesWobble||40);if(e.vy-=(a.bubblesRiseSpeed||150)*a.DPR*t,e.wobblePhase+=e.wobbleFreq*t,e.vx+=Math.sin(e.wobblePhase)*o*100*t,e.vx*=.92,e.vy*=.96,a.mouseInCanvas){const n=e.x-a.mouseX,o=e.y-a.mouseY,i=Math.sqrt(n*n+o*o),r=Math.max(0,a.bubblesDeflectRadius||0)*a.DPR;if(r>i&&i>1){const a=3e3*Math.pow(1-i/r,3),s=n/i,l=o/i;if(e.vx+=s*a*t,e.vy+=l*a*t,.3*r>i){const a=500*(1-i/(.3*r));e.vx+=s*a*t,e.vy+=l*a*t}}}e.y>=2*e.targetRadius||e.dissipating||e.spawning||(e.dissipating=!0,e.dissipateProgress=0),(4*-e.r>e.x||e.x>n.width+4*e.r)&&Ee(e)}function Re(){}function ze(e,t,a){return Math.max(t,Math.min(a,e))}function We(e){const t=e.canvas;return t?ze(Math.min(t.width,t.height)/1e3,.35,3):1}function Ve(e,t,a,n){for(let o=0;e.length>o;o++){const i=e[o],r=t-i.x,s=a-i.y,l=n+i.r;if(l*l>r*r+s*s)return!0}return!1}function $e(e,t,a,n=10){const o=2*n;return e.v+=n*n*(t-e.x)*a,e.v*=Math.max(0,1-o*a),e.x+=e.v*a,e.x}function Ne(e,t,a,n){const o=f(),i=Math.max(2,o.wallInset||3)*(o.DPR||1),r=i+e.r,s=t-i-e.r,l=i+e.r,c=a-i-e.r,d=.92,p=Math.max(0,1-.15*n);r>e.x?(e.x=r,e.vx=Math.abs(e.vx)*d*p):e.x>s&&(e.x=s,e.vx=-Math.abs(e.vx)*d*p),l>e.y?(e.y=l,e.vy=Math.abs(e.vy)*d*p):e.y>c&&(e.y=c,e.vy=-Math.abs(e.vy)*d*p)}function _e(e){return e.currentMode===Bn.KALEIDOSCOPE_1?{count:e.kaleidoscope1BallCount??18,wedges:e.kaleidoscope1Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope1Speed??.8,complexity:.55,spawnAreaMul:e.kaleidoscope1SpawnAreaMul??1,sizeVariance:e.kaleidoscope1SizeVariance??.3}:e.currentMode===Bn.KALEIDOSCOPE_2?{count:e.kaleidoscope2BallCount??36,wedges:e.kaleidoscope2Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope2Speed??1.15,complexity:.95,spawnAreaMul:e.kaleidoscope2SpawnAreaMul??1,sizeVariance:e.kaleidoscope2SizeVariance??.3}:e.currentMode===Bn.KALEIDOSCOPE_3?{count:e.kaleidoscope3BallCount??54,wedges:e.kaleidoscope3Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope3Speed??1.55,complexity:1.35,spawnAreaMul:e.kaleidoscope3SpawnAreaMul??1,sizeVariance:e.kaleidoscope3SizeVariance??.3}:{count:e.kaleidoscopeBallCount??23,wedges:e.kaleidoscopeWedges??e.kaleidoscopeSegments??12,speed:e.kaleidoscopeSpeed??1,complexity:.75,spawnAreaMul:e.kaleidoscopeSpawnAreaMul??1,sizeVariance:e.kaleidoscopeSizeVariance??.3}}function Ge(e,t){function a(e){const a=((e,t)=>{const a=e?.canvas,n=a?.height||0;if(!n)return he(e,t);const o=le(t===Bn.KALEIDOSCOPE_1?+(e.kaleidoscope1DotSizeVh??e.kaleidoscopeDotSizeVh??.95):t===Bn.KALEIDOSCOPE_2?+(e.kaleidoscope2DotSizeVh??e.kaleidoscopeDotSizeVh??.95):t===Bn.KALEIDOSCOPE_3?+(e.kaleidoscope3DotSizeVh??e.kaleidoscopeDotSizeVh??.95):+(e.kaleidoscopeDotSizeVh??.95),.1,6),i=le(t===Bn.KALEIDOSCOPE_1?+(e.kaleidoscope1DotAreaMul??e.kaleidoscopeDotAreaMul??.7):t===Bn.KALEIDOSCOPE_2?+(e.kaleidoscope2DotAreaMul??e.kaleidoscopeDotAreaMul??.7):t===Bn.KALEIDOSCOPE_3?+(e.kaleidoscope3DotAreaMul??e.kaleidoscopeDotAreaMul??.7):+(e.kaleidoscopeDotAreaMul??.7),.1,2),r=Math.max(1,.01*o*n*Math.sqrt(i)),s=le(.5*(t===Bn.KALEIDOSCOPE_1?+(e.kaleidoscope1SizeVariance??e.kaleidoscopeSizeVariance??.3):t===Bn.KALEIDOSCOPE_2?+(e.kaleidoscope2SizeVariance??e.kaleidoscopeSizeVariance??.3):t===Bn.KALEIDOSCOPE_3?+(e.kaleidoscope3SizeVariance??e.kaleidoscopeSizeVariance??.3):+(e.kaleidoscopeSizeVariance??.3)),0,Bo),l=Math.max(1,r*(1-s)),c=Math.max(1,r*(1+s));return ue(e,1e-6>c-l?r:ce(l,c,Math.random()))})(n,t),o=1.2*g,i=s-o,r=s+o,d=l-o,p=l+o;for(let t=0;90>t;t++){const t=Math.random()*Yo,o=m+Math.random()*(g-m),u=ze(s+Math.cos(t)*o,i,r),h=ze(l+Math.sin(t)*o,d,p),f=a*(1+(n.ballSpacing||0));if(!Ve(b,u,h,f)){b.push({x:u,y:h,r:f});const o=new Eo(u,h,a,e);o.u=Math.random()*Yo;const i=u-s,r=h-l;o.h=Math.sqrt(i*i+r*r);const d=(12+12*Math.random())*c;return o.vx=-Math.sin(t)*d,o.vy=Math.cos(t)*d,o.driftAx=0,o.driftTime=0,void n.balls.push(o)}}const u=Math.random()*Yo,h=m+Math.random()*(g-m),f=s+Math.cos(u)*h,M=l+Math.sin(u)*h,y=new Eo(f,M,a,e);y.u=Math.random()*Yo;const v=f-s,x=M-l;y.h=Math.sqrt(v*v+x*x);const w=(12+12*Math.random())*c;y.vx=-Math.sin(u)*w,y.vy=Math.cos(u)*w,y.driftAx=0,y.driftTime=0,n.balls.push(y)}const n=f();M();const o=n.canvas;if(!o)return;const i=o.width,r=o.height,s=.5*i,l=.5*r,c=We(n),d=n.maxBalls||300,p=ze(Math.max(0,0|e),0,d);if(0>=p)return;const u=ze(_e(n).spawnAreaMul??1,.2,2),h=Math.min(i,r),m=.05*h,g=2.8*h*u,b=[],y=Math.min(8,p);for(let f=0;y>f;f++)a($());for(let f=y;p>f;f++)a($())}function He(e){return e===Bn.KALEIDOSCOPE||e===Bn.KALEIDOSCOPE_1||e===Bn.KALEIDOSCOPE_2||e===Bn.KALEIDOSCOPE_3}function je(e){return _e(e).complexity}function Ze(e,t){const a=f();if(!He(a.currentMode))return;const n=a.canvas;if(!n)return;const o=.5*n.width,i=.5*n.height,r=We(a),s=ze(_e(a).speed??1,.2,2),l=performance.now(),c=120>l-(a.lastPointerMoveMs||0);void 0===a.M&&(a.M=0);const d=c?1:0;a.M+=(d-a.M)*(1-Math.exp(-t/Math.max(1e-4,d>a.M?.45:.65)));const p=a.M,u=.008*je(a);if(.01>p){const a=(e.u??0)+.02*e.age+3e-4*l,n=Math.cos(a)*u*8,o=Math.sin(a)*u*8;return e.vx+=n*t,e.vy+=o*t,e.vx*=.96,void(e.vy*=.96)}const h=e.x-o,m=e.y-i,g=Math.max(Xo,Math.sqrt(h*h+m*m)),b=h/g,M=m/g,y=b,v=30*r*s*p,x=-2.5*(g-(void 0!==e.h?e.h:g))*s*p;e.vx+=(-M*v+b*x)*t,e.vy+=(y*v+M*x)*t,e.vx*=.992,e.vy*=.992}function Ye(e,t){const a=f(),n=(-1e9===a.mouseX?.5*a.canvas.width:a.mouseX)-e.x,o=(-1e9===a.mouseY?.5*a.canvas.height:a.mouseY)-e.y,i=Math.sqrt(n*n+o*o+1),r=n/i,s=o/i,l=-o/i,c=n/i,d=a.DPR||1,p=40*d;if(p>i){const a=100*(p-i);e.vx-=r*a*t,e.vy-=s*a*t}const u=a.orbit3dGravity??5e3,h=.015*u;e.vx+=l*h*t,e.vy+=c*h*t;const m=.003*u/(1+i/(100*d));e.vx+=r*m*t,e.vy+=s*m*t;const g=60*a.DPR;let b=0,M=0,y=0;for(let f=0;a.balls.length>f;f++){const t=a.balls[f];if(t===e)continue;const n=e.x-t.x,o=e.y-t.y,i=n*n+o*o;if(g*g>i&&i>0){const e=Math.sqrt(i),t=1-e/g;b+=n/e*t,M+=o/e*t,y++}}if(y>0){const a=8e3;e.vx+=b/y*a*t,e.vy+=M/y*a*t}const v=2*(a.orbit3dVelocityMult??150)*d,x=Math.sqrt(e.vx*e.vx+e.vy*e.vy);x>v&&(e.vx=e.vx/x*v,e.vy=e.vy/x*v);const w=1-(a.orbit3dDamping??.02);e.vx*=w,e.vy*=w;const S=a.orbit3dDepthScale??.8;e.z=e.orbitDepth+.2*Math.sin(2*Math.atan2(o,n)),e.z=Math.max(0,Math.min(1,e.z)),e.r=ue(a,Math.max(2,e.rBase*(.5+e.z*S)))}function Xe(e,t){const a=f(),n=(-1e9===a.mouseX?.5*a.canvas.width:a.mouseX)-e.x,o=(-1e9===a.mouseY?.5*a.canvas.height:a.mouseY)-e.y,i=Math.sqrt(n*n+o*o+1),r=n/i,s=o/i,l=-o/i,c=n/i,d=a.DPR||1,p=80*d;if(p>i){const a=100*(p-i);e.vx-=r*a*t,e.vy-=s*a*t}const u=a.orbit3d2Gravity??8e4,h=.015*u;e.vx+=l*h*t,e.vy+=c*h*t;const m=.003*u/(1+i/(100*d));e.vx+=r*m*t,e.vy+=s*m*t;const g=100*a.DPR;let b=0,M=0,y=0;for(let f=0;a.balls.length>f;f++){const t=a.balls[f];if(t===e)continue;const n=e.x-t.x,o=e.y-t.y,i=n*n+o*o;if(g*g>i&&i>0){const e=Math.sqrt(i),t=1-e/g;b+=n/e*t,M+=o/e*t,y++}}if(y>0){const a=8e3;e.vx+=b/y*a*t,e.vy+=M/y*a*t}const v=300*d,x=Math.sqrt(e.vx*e.vx+e.vy*e.vy);x>v&&(e.vx=e.vx/x*v,e.vy=e.vy/x*v);const w=1-(a.orbit3d2Damping??.02);e.vx*=w,e.vy*=w;const S=a.orbit3d2DepthScale??.6;e.z=e.orbitDepth+.2*Math.sin(2*Math.atan2(o,n)),e.z=Math.max(0,Math.min(1,e.z)),e.r=ue(a,Math.max(2,e.rBase*(.5+e.z*S)))}function qe(e,t,a){return t>e?t:e>a?a:e}function Ue(e){return e>Math.PI?e-=2*Math.PI:-Math.PI>e&&(e+=2*Math.PI),e}function Je(e,t){const a=f(),n=a.canvas;if(!n)return;const o=a.DPR||1,i=Math.max(0,a.critterSpeed||0),r=Math.max(50,a.critterMaxSpeed||0)*o,s=Math.max(0,a.critterStepHz||0),l=a.critterStepSharpness??2.4,c=Math.max(0,a.critterTurnNoise||0),d=Math.max(.1,a.critterTurnDamp||0),p=Math.max(0,a.critterTurnSeek||0),u=Math.max(0,(a.critterAvoidRadius||0)*(a.DPR||1)),h=Math.max(0,a.critterAvoidForce||0),m=Math.max(0,a.critterEdgeAvoid||0),g=Math.max(0,a.critterMousePull||0),b=Math.max(0,a.critterMouseRadiusVw||0);let M=e.S||0,y=e.k||0,v=e.C||0,x=e.P??v,w=e.F||0;const S=e.T||0;w>0?w=Math.max(0,w-t):.25*t>Math.random()&&(w=.03+.09*Math.random());let k=0,C=0;if(m>0){const t=n.width,o=n.height,i=Math.max(24*(a.DPR||1),.08*Math.min(t,o)),r=e.x,s=e.y;i>r?k+=1-r/i:r>t-i&&(k-=1-(t-r)/i),i>s?C+=1-s/i:s>o-i&&(C-=1-(o-s)/i);const l=1.35*m;k*=l,C*=l}let P=0;if(g>0&&-1e9!==a.mouseX){const t=(window.innerWidth||n.width)/100,o=Math.max(1,b*t)*(a.DPR||1),i=e.x-a.mouseX,r=e.y-a.mouseY,s=i*i+r*r;if(o*o>s){const e=Math.sqrt(s)+1e-6,t=1-e/o;P=t;const a=g*(.85+.65*t);k+=i/e*a,C+=r/e*a;const n=.25*t*a;k+=-r/e*n,C+=i/e*n,w=0}}if(u>0&&h>0){const n=a.balls,o=u*u;let i=0,r=0,s=0;for(let t=0;n.length>t;t++){const a=n[t];if(a===e)continue;const l=e.x-a.x,c=e.y-a.y,d=l*l+c*c;if(d>0&&o>d){const e=Math.sqrt(d),t=1-e/u,a=t*t,n=1/(e+1e-6);i+=l*n*a,r+=c*n*a,s++}}if(s>0){const a=1/s;k+=i*a*1.15,C+=r*a*1.15,e.vx+=i*a*.65*h*t,e.vy+=r*a*.65*h*t}}y+=(c*(1+1.35*P*g)*(2*Math.random()-1)+.35*S*c)*t,k*k+C*C>1e-6&&(y+=Ue(Math.atan2(C,k)-M)*p*t),y*=Math.exp(-d*t),M=Ue(M+y*t),s>0&&(x=v,v+=s*t,v-=0|v);const F=w>0?0:((e,t)=>{const a=(n=qe(n=.5>e?2*e:2-2*e,0,1))*n*(3-2*n);var n;const o=qe(t,.5,6);return Math.pow(a,o)})(v,l),T=1+.95*P*g;if(0>=w&&v>.82){const t=(v-.82)/.18*.1*(.65+.35*T);t>e.squashAmount&&(e.squashAmount=t,e.squashNormalAngle=-Math.PI/2)}if(0>=w&&s>0&&x>v){const t=Math.max(.25,e.m/(a.MASS_BASELINE_KG||129)),n=i*(.55+.55*F)*T*(.85+.3*Math.random()),o=Math.cos(M),r=Math.sin(M),s=-r,l=o,c=.18*(2*Math.random()-1)*(.35+.65*P)*n;e.vx+=(o*n+s*c)/t,e.vy+=(r*n+l*c)/t,e.squashAmount=Math.max(e.squashAmount,.2+.15*P),e.squashNormalAngle=Math.PI/2}const D=i*(.08+.25*F)*T;e.vx+=Math.cos(M)*D*t,e.vy+=Math.sin(M)*D*t;const L=e.vx,I=e.vy,A=L*L+I*I;if(A>r*r){const t=r/(Math.sqrt(A)+1e-6);e.vx=L*t,e.vy=I*t}e.S=M,e.k=y,e.C=v,e.P=x,e.F=w,e.theta=M}function Qe(e,t){const a=f(),n=Math.max(.25,e.m/a.MASS_BASELINE_KG),o=Math.max(0,a.neuralWanderStrength??420),i=(e.D??0)+1.35*t;e.D=i;const r=Math.sin(1.7*i+.3)*o,s=Math.cos(1.1*i+1.2)*o;e.vx+=r*t/n,e.vy+=s*t/n,Uo+=t;const l=a.balls,c=l.length;if(c>1){const o=Uo>.18;if(o&&(Uo=0),o||void 0===a.L){let e=0,t=0;for(let a=0;c>a;a++)e+=l[a].x,t+=l[a].y;a.L=e/c,a.I=t/c}const i=a.L,r=a.I,s=Math.max(0,Math.min(1,a.neuralCohesion??.18)),d=r-e.y;e.vx+=(i-e.x)*s*t/n,e.vy+=d*s*t/n}const d=Math.pow(Math.max(0,Math.min(1,a.neuralDamping??.985)),60*t);e.vx*=d,e.vy*=d}function et(){}function tt(e,t){const a=f(),n=a.canvas;if(!n)return;const o=a.mouseX;if(!1!==a.repellerEnabled&&-1e9!==o&&a.mouseInCanvas){const n=(a.latticeDisruptRadius??600)*a.DPR,i=a.latticeDisruptPower??25,r=e.x-o,s=e.y-a.mouseY,l=r*r+s*s;if(n*n>l){const o=Math.max(Math.sqrt(l),1e-4),c=r/o,d=s/o,p=80*i*Math.pow(Math.max(0,1-o/n),1.8),u=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=c*p*t/u,e.vy+=d*p*t/u}}void 0!==e.latticeHomeX&&void 0!==e.latticeHomeY||(e.latticeHomeX=e.x,e.latticeHomeY=e.y);const i=.001*performance.now(),r=a.latticeMeshWaveStrength??12,s=a.latticeMeshWaveSpeed??.8,l=Math.sin(i*s+.004*e.latticeHomeX)*r,c=Math.cos(i*s*.7+.004*e.latticeHomeY)*r,d=.015*Math.sin(i*s*.5),p=e.latticeHomeX+l+(e.latticeHomeX-.5*n.width)*d-e.x,u=e.latticeHomeY+c+(e.latticeHomeY-.5*n.height)*d-e.y,h=Math.max(0,a.latticeStiffness??2.2),m=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=p*h*t/m,e.vy+=u*h*t/m;const g=Math.pow(Math.max(0,Math.min(1,a.latticeDamping??.92)),60*t);e.vx*=g,e.vy*=g}function at(e){if(!e.A)return;const t=f(),a=t.canvas;if(!a)return;const n=.5*a.width,o=.5*a.height;let i=0,r=0;t.mouseInCanvas&&(i=Math.max(-1,Math.min(1,(t.mouseX-n)/(.5*a.width))),r=Math.max(-1,Math.min(1,(t.mouseY-o)/(.5*a.height))));const s=Math.max(100,t.parallaxLinearFocalLength??400),l=Math.max(0,t.parallaxLinearParallaxStrength??120),{x:c,y:d,z:p}=e.A,u=s/(s+p),h=n+(c+i*l)*u,m=o+(d+r*l)*u;e.r=ue(t,.768*(t.R_MED||20)*(t.DPR||1)*Math.max(.1,Math.min(6,t.parallaxLinearDotSizeMul??1.8))*(Number.isFinite(e.K)?e.K:1)*u),e.x=h,e.y=m,e.vx=0,e.vy=0}function nt(e){if(!e.A)return;const t=f(),a=t.canvas;if(!a)return;const n=.5*a.width,o=.5*a.height;let i=0,r=0;t.mouseInCanvas&&(i=Math.max(-1,Math.min(1,(t.mouseX-n)/(.5*a.width))),r=Math.max(-1,Math.min(1,(t.mouseY-o)/(.5*a.height))));const s=Math.max(100,t.parallaxPerspectiveFocalLength??400),l=Math.max(0,t.parallaxPerspectiveParallaxStrength??150),{x:c,y:d,z:p}=e.A,u=s/(s+p),h=n+(c+i*l)*u,m=o+(d+r*l)*u;e.r=ue(t,.6*(t.R_MED||20)*(t.DPR||1)*Math.max(.1,Math.min(6,t.parallaxPerspectiveDotSizeMul??1.8))*(Number.isFinite(e.K)?e.K:1)*u),e.x=h,e.y=m,e.vx=0,e.vy=0}function ot(e){const t=f(),a=t.currentMode;if(t.currentMode===Bn.CRITTERS&&e!==Bn.CRITTERS&&(void 0!==t.O&&(t.REST=t.O,delete t.O),void 0!==t.B&&(t.FRICTION=t.B,delete t.B),void 0!==t.R&&(t.ballSpacing=t.R,delete t.R)),b(e),e!==a)try{W?.()}catch(o){}if(console.log("Switching to mode: "+e),(e=>{const t=document.getElementById("announcer");t&&(t.textContent="",setTimeout(()=>{t.textContent=e},10))})(`Switched to ${{pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero Gravity",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope","kaleidoscope-1":"Kaleidoscope I","kaleidoscope-2":"Kaleidoscope II","kaleidoscope-3":"Kaleidoscope III","orbit-3d":"Orbit 3D","orbit-3d-2":"Orbit 3D (Tight Swarm)",critters:"Critters",neural:"Neural Network",lattice:"Crystal Lattice","parallax-linear":"Parallax (Linear)","parallax-perspective":"Parallax (Perspective)"}[e]||e} mode`),t.container){const a=t.container.classList.contains("dark-mode");t.container.className="",e!==Bn.PIT&&e!==Bn.PIT_THROWS||t.container.classList.add("mode-pit"),(a||t.isDarkMode)&&t.container.classList.add("dark-mode")}Fe(),e===Bn.PIT?(t.gravityMultiplier=t.gravityMultiplierPit,t.G=t.GE*t.gravityMultiplier,t.repellerEnabled=!0,(()=>{const e=f();M(),((e,t)=>{const a=e.DPR,n=-.65*e.canvas.height,o=(e.wallThickness||20)*a,i=o,r=e.canvas.width-o,s=r-i,l=Math.max(1,.22*s),c=i+s*(2/3),d=Math.max(i,c-.5*l),p=Math.min(r,c+.5*l),u=Math.max(0,0|t),h=100*a,f=50*a;for(let m=0;u>m;m++){const e=be(d+Math.random()*(p-d),n+Math.random()*(0-n));e.vx=(Math.random()-.5)*h,e.vy=Math.random()*f+f,e.driftAx=0,e.driftTime=0}})(e,m(e.maxBalls??300))})()):e===Bn.PIT_THROWS?(t.gravityMultiplier=t.gravityMultiplierPit,t.G=t.GE*t.gravityMultiplier,t.repellerEnabled=!0,(()=>{const e=f();M(),m(e.maxBalls??300)>0&&(e.p={spawnedTotal:0,side:0,cooldown:0,batchCount:0,batchPaused:!1,queueA:-1,queueB:-1,queueColorA:void 0,queueColorB:void 0,queueSideA:0,queueSideB:1},Se(e,we(e.p),e.p.side),e.p.side=1-e.p.side)})()):e===Bn.FLIES?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M();const t=m(e.fliesBallCount??60);if(0>=t)return;const a=.5*e.canvas.width,n=.5*e.canvas.height,o=150*e.DPR,i=300*e.DPR;for(let r=0;8>r;r++){const e=Math.random()*Math.PI*2,t=Math.random()*o,r=be(a+Math.cos(e)*t,n+Math.sin(e)*t,$()),s=.5+.5*Math.random(),l=Math.random()*Math.PI*2,c=i*s;r.vx=Math.cos(l)*c,r.vy=Math.sin(l)*c,r.driftAx=0,r.driftTime=0}for(let r=8;t>r;r++){const e=Math.random()*Math.PI*2,t=Math.random()*o,r=be(a+Math.cos(e)*t,n+Math.sin(e)*t),s=.5+.5*Math.random(),l=Math.random()*Math.PI*2,c=i*s;r.vx=Math.cos(l)*c,r.vy=Math.sin(l)*c,r.driftAx=0,r.driftTime=0}})()):e===Bn.WEIGHTLESS?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M();const t=m(e.weightlessCount);if(0>=t)return;const a=e.canvas.width,n=e.canvas.height,o=e.DPR||1,i=40*o,r=e.weightlessInitialSpeed*o;for(let s=0;t>s;s++){const e=be(i+Math.random()*(a-2*i),i+Math.random()*(n-2*i)),t=Math.random()*Math.PI*2,o=r*(.7+.3*Math.random());e.vx=Math.cos(t)*o,e.vy=Math.sin(t)*o,e.driftAx=0,e.driftTime=0}})()):e===Bn.WATER?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M(),Ro.length=0;const t=e.canvas;if(!t)return;const a=t.width,n=t.height,o=m(e.waterBallCount||100);if(0>=o)return;const i=(e.waterInitialVelocity||120)*(e.DPR||1);for(let r=0;8>r&&o>r;r++){const t=Math.random()*a,o=Math.random()*n,r=he(e,Bn.WATER),s=$(),l=new Eo(t,o,r,s);l.vx=(Math.random()-.5)*i,l.vy=(Math.random()-.5)*i,e.balls.push(l)}for(let r=8;o>r;r++){const t=Math.random()*a,o=Math.random()*n,r=he(e,Bn.WATER),s=$(),l=new Eo(t,o,r,s);l.vx=(Math.random()-.5)*i,l.vy=(Math.random()-.5)*i,e.balls.push(l)}})()):e===Bn.VORTEX?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M();const t=e.canvas;if(!t)return;const a=t.width,n=t.height,o=m(Math.min(e.vortexBallCount||180,e.maxBalls||500));if(0>=o)return;const i=80*(e.vortexSpeedMultiplier??1)*(e.DPR||1);for(let r=0;8>r&&o>r;r++){const t=Math.random()*a,o=Math.random()*n,r=he(e,Bn.VORTEX),s=$(),l=new Eo(t,o,r,s);l.vx=(Math.random()-.5)*i,l.vy=(Math.random()-.5)*i,e.balls.push(l)}for(let r=8;o>r;r++){const t=Math.random()*a,o=Math.random()*n,r=he(e,Bn.VORTEX),s=$(),l=new Eo(t,o,r,s);l.vx=(Math.random()-.5)*i,l.vy=(Math.random()-.5)*i,e.balls.push(l)}})()):e===Bn.PING_PONG?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M();const t=e.canvas;if(!t)return;const a=t.width,n=t.height,o=m(Math.min(e.pingPongBallCount||80,e.maxBalls||300));if(0>=o)return;const i=e.pingPongSpeed||400;for(let r=0;8>r&&o>r;r++){const t=Math.random()*a,o=.15*n+Math.random()*n*.7,r=he(e,Bn.PING_PONG),s=$(),l=new Eo(t,o,r,s);l.vx=(Math.random()>.5?1:-1)*(.8*i+Math.random()*i*.4),l.vy=0,l.isPingPong=!0,e.balls.push(l)}for(let r=8;o>r;r++){const t=Math.random()*a,o=.15*n+Math.random()*n*.7,r=he(e,Bn.PING_PONG),s=$(),l=new Eo(t,o,r,s);l.vx=(Math.random()>.5?1:-1)*(.8*i+Math.random()*i*.4),l.vy=0,l.isPingPong=!0,e.balls.push(l)}})()):e===Bn.MAGNETIC?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M();const t=e.canvas;if(!t)return;const a=t.width,n=t.height,o=m(Math.min(e.magneticBallCount||180,e.maxBalls||300));if(0>=o)return;const i=100*(e.DPR||1);for(let r=0;8>r&&o>r;r++){const t=Math.random()*a,o=Math.random()*n,r=he(e,Bn.MAGNETIC),s=$(),l=new Eo(t,o,r,s);l.vx=(Math.random()-.5)*i,l.vy=(Math.random()-.5)*i,l.charge=Math.random()>.5?1:-1,l.baseAlpha=1,e.balls.push(l)}for(let r=8;o>r;r++){const t=Math.random()*a,o=Math.random()*n,r=he(e,Bn.MAGNETIC),s=$(),l=new Eo(t,o,r,s);l.vx=(Math.random()-.5)*i,l.vy=(Math.random()-.5)*i,l.charge=Math.random()>.5?1:-1,l.baseAlpha=1,e.balls.push(l)}})()):e===Bn.BUBBLES?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();e.balls.length=0;const t=e.canvas;if(!t)return;const a=t.width,n=t.height,o=m(e.bubblesMaxCount||200);if(o>0){for(let e=0;8>e&&o>e;e++)Oe(Math.random()*a,Math.random()*n,$(),!0);for(let e=8;o>e;e++)Oe(Math.random()*a,Math.random()*n,$(),!0)}})()):e===Bn.KALEIDOSCOPE?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Ge(m(f().kaleidoscopeBallCount??23),Bn.KALEIDOSCOPE)):e===Bn.KALEIDOSCOPE_1?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Ge(m(f().kaleidoscope1BallCount??18),Bn.KALEIDOSCOPE_1)):e===Bn.KALEIDOSCOPE_2?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Ge(m(f().kaleidoscope2BallCount??36),Bn.KALEIDOSCOPE_2)):e===Bn.KALEIDOSCOPE_3?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Ge(m(f().kaleidoscope3BallCount??54),Bn.KALEIDOSCOPE_3)):e===Bn.ORBIT_3D?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M();const t=m(Math.max(0,0|(e.orbit3dMoonCount??80)));if(0>=t)return;const a=e.canvas.width,n=e.canvas.height;for(let o=0;t>o;o++){const t=Math.random()*Math.PI*2,o=.15*Math.min(a,n)+Math.random()*Math.min(a,n)*.1,i=be(.5*a+Math.cos(t)*o,.5*n+Math.sin(t)*o,$());if(!i)continue;const r=e.DPR||1,s=(e.orbit3dVelocityMult??150)*(.9+.2*Math.random())*r;i.vx=-Math.sin(t)*s,i.vy=Math.cos(t)*s,i.orbitDepth=Math.random()}})()):e===Bn.ORBIT_3D_2?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M();const t=m(Math.max(0,0|(e.orbit3d2MoonCount??100)));if(0>=t)return;const a=e.canvas.width,n=e.canvas.height;for(let o=0;t>o;o++){const t=Math.random()*Math.PI*2,o=.35*Math.min(a,n)+Math.random()*Math.min(a,n)*.15,i=be(.5*a+Math.cos(t)*o,.5*n+Math.sin(t)*o,$());if(!i)continue;const r=150*(e.orbit3d2VelocityMult??1.1)*(e.DPR||1);i.vx=-Math.sin(t)*r,i.vy=Math.cos(t)*r,i.orbitDepth=Math.random()}})()):e===Bn.CRITTERS?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,void 0===t.O&&(t.O=t.REST),void 0===t.B&&(t.B=t.FRICTION),t.REST=t.critterRestitution??t.REST,t.FRICTION=t.critterFriction??t.FRICTION,void 0===t.R&&(t.R=t.ballSpacing),t.ballSpacing=Math.min(t.ballSpacing||0,1),(()=>{const e=f();M();const t=e.canvas.width,a=e.canvas.height,n=m(Math.max(10,Math.min(260,0|e.critterCount)));if(n>0){for(let o=0;8>o&&n>o;o++){const n=be(Math.random()*t|0,Math.random()*a|0,$()),o=he(e,Bn.CRITTERS);n.r=o,n.rBase=o,n.m=Math.max(1,o*o*.12),n.vx=0,n.vy=0,n.S=Math.random()*Math.PI*2,n.k=0,n.C=Math.random(),n.P=n.C,n.T=2*Math.random()-1,n.F=0}for(let o=8;n>o;o++){const n=be(Math.random()*t|0,Math.random()*a|0,$()),o=he(e,Bn.CRITTERS);n.r=o,n.rBase=o,n.m=Math.max(1,o*o*.12),n.vx=0,n.vy=0,n.S=Math.random()*Math.PI*2,n.k=0,n.C=Math.random(),n.P=n.C,n.T=2*Math.random()-1,n.F=0}}})()):e===Bn.NEURAL?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!0,(()=>{const e=f(),t=e.canvas;if(!t)return;M();const a=m(Math.max(8,Math.min(e.neuralBallCount??80,260)));if(0>=a)return;const n=t.width,o=t.height,i=40*(e.DPR||1),r=Math.min(8,a);for(let s=0;r>s;s++){const t=be(i+Math.random()*(n-2*i),i+Math.random()*(o-2*i),$()),a=he(e,Bn.NEURAL);t.r=a,t.rBase=a,t.m=Math.max(1,a*a*.12),t.vx=0,t.vy=0,t.driftAx=0,t.driftTime=0,t.D=Math.random()*Math.PI*2}for(let s=r;a>s;s++){const t=be(i+Math.random()*(n-2*i),i+Math.random()*(o-2*i),$()),a=he(e,Bn.NEURAL);t.r=a,t.rBase=a,t.m=Math.max(1,a*a*.12),t.vx=0,t.vy=0,t.driftAx=0,t.driftTime=0,t.D=Math.random()*Math.PI*2}})()):e===Bn.LATTICE?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!0,(()=>{const e=f();M();const t=e.canvas,a=t.width,n=t.height,o=Math.max(8,((e,t)=>.01*t*Math.max(1,Math.min(e.width,e.height)))(t,e.latticeSpacingVw??8.5)),i=.8660254037844386*o,r=Math.ceil(a/o)+2,s=Math.ceil(n/i)+2,l=e.isMobile?Math.max(0,Math.min(1,+(e.mobileObjectReductionFactor??.7))):1;if(e.isMobile&&0>=l)return;const c=Math.sqrt(l),d=Math.max(0,Math.round(r*c)),p=Math.max(0,Math.round(s*c));if(0>=d||0>=p)return;const u=e.latticeAlignment??"center",h=(d-1)*o,m=(p-1)*i;let g,b;"center"===u?(g=.5*(a-h),b=.5*(n-m)):"top-left"===u?(g=.5*-o,b=.5*-i):"top-center"===u?(g=.5*(a-h),b=.5*-i):"top-right"===u?(g=a-h+.5*o,b=.5*-i):(g=.5*(a-h),b=.5*(n-m));const y=.25*o;for(let f=0;p>f;f++){const e=1&f?.5*o:0,t=b+f*i;for(let i=0;d>i;i++){const r=g+i*o+e;if(!(-y>r||r>a+y||-y>t||t>n+y)){const e=be(r,t,$());e.latticeHomeX=r,e.latticeHomeY=t,e.latticeRow=f,e.latticeCol=i,e.vx=0,e.vy=0,e.driftAx=0,e.driftTime=0}}}})()):e===Bn.PARALLAX_LINEAR?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f(),t=e.canvas;if(!t)return;M();const a=t.width,n=t.height,o=m(Math.max(0,Math.min(40,Math.round(e.parallaxLinearGridX??14)))),i=m(Math.max(0,Math.min(40,Math.round(e.parallaxLinearGridY??10)))),r=m(Math.max(0,Math.min(20,Math.round(e.parallaxLinearGridZ??7))));if(0>=o||0>=i||0>=r)return;const s=Math.max(.2,Math.min(3,e.parallaxLinearSpanX??1.35)),l=Math.max(.2,Math.min(3,e.parallaxLinearSpanY??1.35)),c=-.5*a*s,d=-.5*n*l,p=a*s/Math.max(1,o-1),u=n*l/Math.max(1,i-1),h=Math.max(10,e.parallaxLinearZNear??50),g=(Math.max(h+100,e.parallaxLinearZFar??800)-h)/Math.max(1,r-1),b=Math.max(80,e.parallaxLinearFocalLength??420),y=.768*(e.R_MED||20)*(e.DPR||1)*Math.max(.1,Math.min(6,e.parallaxLinearDotSizeMul??1.8)),v=pe(e,Bn.PARALLAX_LINEAR),x=.5*a,w=.5*n;for(let f=r-1;f>=0;f--){const t=h+f*g;for(let a=0;i>a;a++)for(let n=0;o>n;n++){const o=c+n*p,i=d+a*u,r=t,s=b/(b+r),l=y*s,h=1,f=be(x+o*s,w+i*s,$());f.r=ue(e,l),f.vx=0,f.vy=0,f.alpha=h,f.A={x:o,y:i,z:r,baseScale:s},f.K=v>1e-6?1+(2*Math.random()-1)*v:1,f.W=!0}}})()):e===Bn.PARALLAX_PERSPECTIVE&&(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f(),t=e.canvas;if(!t)return;M();const a=t.width,n=t.height,o=m(Math.max(0,Math.min(50,Math.round(e.parallaxPerspectiveGridX??16)))),i=m(Math.max(0,Math.min(50,Math.round(e.parallaxPerspectiveGridY??12)))),r=m(Math.max(0,Math.min(25,Math.round(e.parallaxPerspectiveGridZ??8))));if(0>=o||0>=i||0>=r)return;const s=Math.max(.2,Math.min(3,e.parallaxPerspectiveSpanX??1.45)),l=Math.max(.2,Math.min(3,e.parallaxPerspectiveSpanY??1.45)),c=-.5*a*s,d=-.5*n*l,p=a*s/Math.max(1,o-1),u=n*l/Math.max(1,i-1),h=Math.max(10,e.parallaxPerspectiveZNear??40),g=(Math.max(h+100,e.parallaxPerspectiveZFar??1200)-h)/Math.max(1,r-1),b=Math.max(0,Math.min(1,e.parallaxPerspectiveRandomness??.6)),y=Math.max(80,e.parallaxPerspectiveFocalLength??420),v=.6*(e.R_MED||20)*(e.DPR||1)*Math.max(.1,Math.min(6,e.parallaxPerspectiveDotSizeMul??1.8)),x=pe(e,Bn.PARALLAX_PERSPECTIVE),w=.5*a,S=.5*n;for(let f=r-1;f>=0;f--){const t=h+f*g;for(let a=0;i>a;a++)for(let n=0;o>n;n++){const o=d+a*u,i=t,r=c+n*p+(Math.random()-.5)*p*b,s=o+(Math.random()-.5)*u*b,l=i+(Math.random()-.5)*g*b*.5,h=y/(y+l),f=v*h,m=1,M=be(w+r*h,S+s*h,$());M.r=ue(e,f),M.vx=0,M.vy=0,M.alpha=m,M.A={x:r,y:s,z:l,baseScale:h},M.K=x>1e-6?1+(2*Math.random()-1)*x:1,M.W=!0}}})()),console.log(`Mode ${e} initialized with ${t.balls.length} balls`);const n=Math.max(0,Math.round(((e,t)=>{switch(e){case Bn.PIT:return t.pitWarmupFrames??10;case Bn.PIT_THROWS:return t.pitThrowsWarmupFrames??10;case Bn.FLIES:return t.fliesWarmupFrames??10;case Bn.WEIGHTLESS:return t.weightlessWarmupFrames??10;case Bn.WATER:return t.waterWarmupFrames??10;case Bn.VORTEX:return t.vortexWarmupFrames??10;case Bn.PING_PONG:return t.pingPongWarmupFrames??10;case Bn.MAGNETIC:return t.magneticWarmupFrames??10;case Bn.BUBBLES:return t.bubblesWarmupFrames??10;case Bn.KALEIDOSCOPE:return t.kaleidoscopeWarmupFrames??10;case Bn.KALEIDOSCOPE_1:return t.kaleidoscope1WarmupFrames??10;case Bn.KALEIDOSCOPE_2:return t.kaleidoscope2WarmupFrames??10;case Bn.KALEIDOSCOPE_3:return t.kaleidoscope3WarmupFrames??10;case Bn.ORBIT_3D:return t.orbit3dWarmupFrames??10;case Bn.ORBIT_3D_2:return t.orbit3d2WarmupFrames??10;case Bn.CRITTERS:return t.crittersWarmupFrames??10;case Bn.NEURAL:return t.neuralWarmupFrames??10;case Bn.LATTICE:return t.latticeWarmupFrames??10;case Bn.PARALLAX_LINEAR:return t.parallaxLinearWarmupFrames??10;case Bn.PARALLAX_PERSPECTIVE:return t.parallaxPerspectiveWarmupFrames??10;default:return 10}})(e,t)||0));if(t.warmupFramesRemaining=n,"undefined"!=typeof window&&e!==a)try{window.dispatchEvent(new CustomEvent("bb:modeChanged",{detail:{prevMode:a,mode:e}}))}catch(o){}}function it(){const e=f();try{W?.()}catch(t){}ot(e.currentMode)}function rt(){const e=f();return e.currentMode===Bn.FLIES?Me:e.currentMode===Bn.PIT||e.currentMode===Bn.PIT_THROWS?ye:e.currentMode===Bn.WEIGHTLESS?Ce:e.currentMode===Bn.WATER?fe:e.currentMode===Bn.VORTEX?Le:e.currentMode===Bn.PING_PONG?Ie:e.currentMode===Bn.MAGNETIC?Ae:e.currentMode===Bn.BUBBLES?Be:e.currentMode===Bn.KALEIDOSCOPE||e.currentMode===Bn.KALEIDOSCOPE_1||e.currentMode===Bn.KALEIDOSCOPE_2||e.currentMode===Bn.KALEIDOSCOPE_3?Ze:e.currentMode===Bn.ORBIT_3D?Ye:e.currentMode===Bn.ORBIT_3D_2?Xe:e.currentMode===Bn.CRITTERS?Je:e.currentMode===Bn.NEURAL?Qe:e.currentMode===Bn.LATTICE?tt:e.currentMode===Bn.PARALLAX_LINEAR?at:e.currentMode===Bn.PARALLAX_PERSPECTIVE?nt:null}function st(){const e=f();return e.currentMode===Bn.WATER?me:e.currentMode===Bn.PIT_THROWS?ke:e.currentMode===Bn.MAGNETIC?Ke:e.currentMode===Bn.BUBBLES?Re:null}function lt(){return f().currentMode===Bn.NEURAL?{preRender:et}:null}function ct(){null!==si&&(cancelAnimationFrame(si),si=null)}function dt(){const e=Math.max(0,Math.min(ri,ci));return li>e?0:Math.max(0,Math.min(1,(e-li)/.85))}function pt(){const e=f();return((e,t)=>{function a(e,t){return.5>e?2*e*t:1-2*(1-e)*(1-t)}if(!e||"string"!=typeof e)return"#000000";if(0>=t)return e;const n=e.trim(),o="#"===n[0]?n.slice(1):n;if(3!==o.length&&6!==o.length)return e;const i=parseInt(3===o.length?o[0]+o[0]+o[1]+o[1]+o[2]+o[2]:o,16);if(!Number.isFinite(i))return e;let r=i>>16&255,s=i>>8&255,l=255&i;const c=r/255,d=s/255,p=l/255,u=1.15*t,h=c+(a(c,1)-c)*u,f=d+(a(d,1)-d)*u,m=p+(a(p,1)-p)*u,g=.299*h+.587*f+.114*m,b=.2*t,M=f+(f-g)*b,y=m+(m-g)*b,v=Math.max(0,Math.min(1,h+(h-g)*b)),x=Math.max(0,Math.min(1,M)),w=Math.max(0,Math.min(1,y));return r=Math.max(0,Math.min(255,Math.round(255*v))),s=Math.max(0,Math.min(255,Math.round(255*x))),l=Math.max(0,Math.min(255,Math.round(255*w))),"#"+(r<<16|s<<8|l).toString(16).padStart(6,"0")})(e&&"string"==typeof e.cursorColorHex&&e.cursorColorHex?e.cursorColorHex:"#000000",0+.85*dt())}function ut(){if(!Qo||!ei||!ai)return;if(.001>=ri){ei.style.opacity="0";const e=f();return void(Qo.style.backgroundColor=e&&"string"==typeof e.cursorColorHex&&e.cursorColorHex?e.cursorColorHex:"#000000")}const e=dt();ei.style.opacity=""+(0+.85*e);const t=f();Qo.style.backgroundColor=t&&"string"==typeof t.cursorColorHex&&t.cursorColorHex?t.cursorColorHex:"#000000"}function ht(){ti||(Qo=document.createElement("div"),Qo.id="custom-cursor",Qo.setAttribute("aria-hidden","true"),document.body.appendChild(Qo),ei=document.createElement("div"),ei.setAttribute("aria-hidden","true"),ei.style.position="absolute",ei.style.inset="0",ei.style.borderRadius="inherit",ei.style.backgroundColor="#ffffff",ei.style.pointerEvents="none",ei.style.mixBlendMode="overlay",ei.style.opacity="0",ei.style.transition="opacity 0.12s ease-out",Qo.appendChild(ei),Qo.style.display="none",ti=!0,ft(),ii=performance.now())}function ft(){if(!Qo)return;const e=f();ni=(e.R_MIN+e.R_MAX)/2*e.cursorSize*2,Qo.style.width=ni+"px",Qo.style.height=ni+"px",Qo.style.borderRadius="50%",Qo.style.marginLeft="0",Qo.style.marginTop="0",ei&&(ei.style.borderRadius="inherit"),ai||(Qo.style.transform="translate(-50%, -50%) scale(1)",Qo.style.opacity="1")}function mt(e,t,a=0){if(!Qo)return;const n=ai;ai=((e,t)=>{const a=document.getElementById("bravia-balls");if(!a)return!1;const n=a.getBoundingClientRect();return!(n.left>e||e>n.right||n.top>t||t>n.bottom)})(e,t),Qo.style.left=e+"px",Qo.style.top=t+"px",oi=a,ii=performance.now();const o=Math.max(0,Math.min(oi,1.7999999999999998));li>o?(ri*=.6,.001>ri&&(ri=0,ei&&ai&&(ei.style.opacity="0"))):(ri+=.25*(o-ri),ri=Math.min(ri,ci)),document.body.style.cursor="none",ai?(Qo.style.display="block",ut(),null===si&&null===si&&(si=requestAnimationFrame(function e(){if(!Qo||!ai)return ei&&(ei.style.opacity="0"),ri=0,void(si=null);performance.now()-ii>100&&(ri>.001?(ri*=.91,.001>ri&&(ri=0),ri=Math.max(0,ri)):ri=0,ut(),.001>=ri&&ei&&(ei.style.opacity="0")),si=requestAnimationFrame(e)})),n?(Qo.style.opacity="1",Qo.style.transform.includes("scale(0.25)")||(Qo.style.transform="translate(-50%, -50%) scale(0.25)")):(Qo.style.transform="translate(-50%, -50%) scale(1)",Qo.style.opacity="1",requestAnimationFrame(()=>{Qo.style.transform="translate(-50%, -50%) scale(0.25)",Qo.style.opacity="1"}))):(Qo.style.display="none",ct(),n&&(Qo.style.transform="translate(-50%, -50%) scale(1)",Qo.style.opacity="1",Qo.style.backgroundColor="",Qo.style.filter="",ei&&(ei.style.opacity="0"),ri=0))}function gt(){if(!Qo)return;ri=0,ei&&(ei.style.opacity="0");const e=f();Qo.style.backgroundColor=e&&"string"==typeof e.cursorColorHex&&e.cursorColorHex?e.cursorColorHex:"#000000",Qo.style.display="none",document.body.style.cursor="none",ai=!1,ct()}function bt(){Qo&&(ai=!1)}function Mt(){const e=(()=>{try{return!!document?.body?.classList?.contains?.("abs-link-hovering")}catch(e){return!1}})();return e&&!bi&&(mi=0,gi=0),bi=e,e}function yt(){try{return!!window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches}catch(e){return!1}}function vt(e,t,a){return t>e?t:e>a?a:e}function xt(e,t){const a=[{x:vi,y:vi},{x:t.width-vi,y:vi},{x:vi,y:t.height-vi},{x:t.width-vi,y:t.height-vi}];for(let n=0;a.length>n;n++){const t=e.x-a[n].x,o=e.y-a[n].y,i=Math.max(1,Math.hypot(t,o));if(vi+e.r>i){const a=(vi+e.r-i)/(vi+e.r)*1800,n=o/i;e.vx+=t/i*a*Mi,e.vy+=n*a*Mi}}}function wt(e,t){const a=f(),n=a.balls,o=a.canvas;if(!o)return;if(0===n.length)return;if(a.currentMode===Bn.KALEIDOSCOPE||a.currentMode===Bn.KALEIDOSCOPE_1||a.currentMode===Bn.KALEIDOSCOPE_2||a.currentMode===Bn.KALEIDOSCOPE_3){const i=Math.min(.033,Math.max(0,e)),r=n.length;for(let e=0;r>e;e++)n[e].step(i,t);(({iterations:e=4,positionalCorrectionPercent:t=.25,positionalCorrectionSlopPx:a=null,maxCorrectionPx:n=null,enableSound:o=!0}={})=>{const i=f(),r=i.balls,s=ie(),l=i.REST,c=t,d=a??.5*i.DPR,p=i.ballSpacing||0,u=n??2*(i.DPR||1);for(let h=0;e>h;h++)for(let e=0;s.length>e;e++){const{i:t,j:a}=s[e],n=r[t],f=r[a];if(n.isSleeping&&f.isSleeping)continue;n.isSleeping&&n.wake(),f.isSleeping&&f.wake();const m=f.x-n.x,g=f.y-n.y,b=n.r+f.r+(n.r+f.r)/2*p,M=m*m+g*g;if(0===M||M>b*b)continue;const y=Math.sqrt(M),v=m/y,x=g/y,w=b-y,S=1/Math.max(n.m,.001),k=1/Math.max(f.m,.001);let C=c*Math.max(w-d,0)/(S+k);C>u&&(C=u);const P=C*v,F=C*x;n.x-=P*S,n.y-=F*S,f.x+=P*k,f.y+=F*k;const T=(f.vx-n.vx)*v+(f.vy-n.vy)*x;if(0>T){const e=-(1+(30>Math.abs(T)?0:l))*T/(S+k),r=e*v,s=e*x;if(n.vx-=r*S,n.vy-=s*S,f.vx+=r*k,f.vy+=s*k,o&&0===h){const e=(n.r+f.r)/2,o=(n.x+f.x)/2/(i.canvas?.width||1);X(e,Math.min(1,Math.abs(T)/(50*(n.r+f.r))),o,`${t}-${a}`)}}}})({iterations:3,positionalCorrectionPercent:.22,maxCorrectionPx:1.25*(a.DPR||1),enableSound:!1});for(let e=0;r>e;e++)Ne(n[e],o.width,o.height,i);return void(yi=0)}yi+=e;let i=0;for(Ko.clearPressureFrame();yi>=Mi&&Wn.MAX_PHYSICS_STEPS>i;){const e=n.length;for(let a=0;e>a;a++)n[a].step(Mi,t);const r=Math.max(1,Math.min(20,Math.round(+(a.physicsCollisionIterations??10)||10)));if(a.currentMode===Bn.KALEIDOSCOPE||a.currentMode===Bn.KALEIDOSCOPE_1||a.currentMode===Bn.KALEIDOSCOPE_2||a.currentMode===Bn.KALEIDOSCOPE_3?re(6):a.currentMode!==Bn.FLIES&&a.currentMode!==Bn.ORBIT_3D&&a.currentMode!==Bn.PARALLAX_LINEAR&&a.currentMode!==Bn.PARALLAX_PERSPECTIVE&&re(r),Ko.resetStepBudgets(),a.currentMode!==Bn.ORBIT_3D&&a.currentMode!==Bn.ORBIT_3D_2&&a.currentMode!==Bn.PARALLAX_LINEAR&&a.currentMode!==Bn.PARALLAX_PERSPECTIVE&&a.currentMode!==Bn.LATTICE){const e=a.currentMode===Bn.WEIGHTLESS?a.weightlessBounce:a.REST,t=a.currentMode===Bn.PIT||a.currentMode===Bn.PIT_THROWS,i=n.length;for(let a=0;i>a;a++)t||xt(n[a],o),n[a].walls(o.width,o.height,Mi,e)}if(a.currentMode===Bn.PIT||a.currentMode===Bn.PIT_THROWS){re(3);const e=a.REST,t=n.length;for(let a=0;t>a;a++)n[a].walls(o.width,o.height,Mi,e,{registerEffects:!1});const i=a.DPR||1,r=(Number.isFinite(a.sleepVelocityThreshold)?a.sleepVelocityThreshold:12)*i,s=Number.isFinite(a.sleepAngularThreshold)?a.sleepAngularThreshold:.18,l=a.timeToSleep??.25;for(let a=0;t>a;a++){const e=n[a];if(!e||e.isSleeping)continue;const t=Math.sqrt(e.vx*e.vx+e.vy*e.vy),o=Math.abs(e.omega);(e.isGrounded||e.hasSupport)&&r>t&&s>o?(e.vx*=.5,e.vy*=.5,e.omega*=.5,2*i>t&&(e.vx=0,e.vy=0),.02>o&&(e.omega=0),e.sleepTimer+=Mi,l>e.sleepTimer||(e.vx=0,e.vy=0,e.omega=0,e.isSleeping=!0)):e.sleepTimer=0}}if(!1!==a.physicsSkipSleepingSteps){const e=a.currentMode;if(e!==Bn.FLIES&&e!==Bn.ORBIT_3D&&e!==Bn.ORBIT_3D_2&&e!==Bn.PARALLAX_LINEAR&&e!==Bn.PARALLAX_PERSPECTIVE&&e!==Bn.KALEIDOSCOPE&&e!==Bn.KALEIDOSCOPE_1&&e!==Bn.KALEIDOSCOPE_2&&e!==Bn.KALEIDOSCOPE_3&&e!==Bn.PIT&&e!==Bn.PIT_THROWS){const e=a.DPR||1,t=Math.max(0,+(a.physicsSleepThreshold??12)||0)*e,o=Math.max(0,+(a.physicsSleepTime??.25)||0),i=Number.isFinite(a.sleepAngularThreshold)?a.sleepAngularThreshold:.18;if(t>0&&o>0){const e=n.length;for(let a=0;e>a;a++){const e=n[a];e&&!e.isSleeping&&(t>Math.sqrt(e.vx*e.vx+e.vy*e.vy)&&i>Math.abs(e.omega)?(e.sleepTimer+=Mi,o>e.sleepTimer||(e.vx=0,e.vy=0,e.omega=0,e.isSleeping=!0)):e.sleepTimer=0)}}}}yi-=Mi,i++}const r=st();r&&r(e),Ko.step(e),yi>Mi*Wn.ACCUMULATOR_RESET_THRESHOLD&&(yi=0)}async function St(e,t){const a=f(),n=a.balls;if(!a.canvas)return;if(!n||0===n.length)return;const o=Math.max(0,Math.round(a.warmupFramesRemaining||0));if(o>0){a.warmupFramesRemaining=0,yi=0;for(let e=0;o>e;e++)wt(xi,t)}else wt(e,t)}function kt(){const e=f(),t=e.ctx,a=e.balls,n=e.canvas;if(!t||!n)return;t.clearRect(0,0,n.width,n.height);const o=e.canvasClipPath;if(o){t.save();try{t.clip(o)}catch(r){}}const i=lt();if(i&&i.preRender&&i.preRender(t),e.currentMode===Bn.KALEIDOSCOPE||e.currentMode===Bn.KALEIDOSCOPE_1||e.currentMode===Bn.KALEIDOSCOPE_2||e.currentMode===Bn.KALEIDOSCOPE_3)(e=>{const t=f();if(!He(t.currentMode))return;const a=t.canvas;if(!a)return;const n=(()=>{const e=performance.now(),t=qo||e;return qo=e,ze((e-t)/1e3,0,.05)})(),o=t.balls,i=a.width,r=a.height,s=We(t),l=_e(t).wedges??12,c=ze(Math.round(l),3,24),d=!!(t.kaleidoscopeMirror??1),p=(e=>.5*e.width)(a),u=(e=>.5*e.height)(a),h=Yo/c,m=Math.max(1e-5,1e-4*h),g=t.mouseInCanvas?t.mouseX:p,b=t.mouseInCanvas?t.mouseY:u,M=g-p,y=b-u,v=Math.atan2(y,M),x=ze(Math.hypot(M,y)/Math.max(1,.5*Math.min(i,r)),0,1);t.V||(t.V={phase:{x:0,v:0},panX:{x:0,v:0},panY:{x:0,v:0},lastMouseX:g,lastMouseY:b,lastInCanvas:!!t.mouseInCanvas});const w=t.V,S=!!t.mouseInCanvas,k=Math.hypot(g-w.lastMouseX,b-w.lastMouseY)>.5||S!==w.lastInCanvas,C=ze(_e(t).speed??1,.2,2),P=je(t),F=.65*C*P,T=M*F*(t.mouseInCanvas?1:0),D=y*F*(t.mouseInCanvas?1:0),L=.7*v*P*(t.mouseInCanvas?1:0);k?(w.lastMouseX=g,w.lastMouseY=b,w.lastInCanvas=S,$e(w.phase,L,n,4.5),$e(w.panX,T,n,5),$e(w.panY,D,n,5)):(w.phase.v=0,w.panX.v=0,w.panY.v=0);const I=w.phase.x,A=w.panX.x,K=w.panY.x,O=.22+.18*ze((C-.2)/1.8,0,1),E=1-O+2*O*(1-x);for(let f=0;o.length>f;f++){const t=o[f],a=t.x-p+A,n=t.y-u+K,i=3.5*s,r=Math.hypot(a,n)*i*E;if(Xo>r)continue;const l=d?2*h:h;let g=Math.atan2(n,a)+I;g=(g%l+l)%l,d&&g>h&&(g=l-g),g=ze(g,m,h-m);for(let o=0;c>o;o++){const a=o*h+g,n=p+Math.cos(a)*r,i=u+Math.sin(a)*r;1>t.alpha&&(e.globalAlpha=t.alpha),e.fillStyle=t.color,e.beginPath(),e.arc(n,i,t.r,0,Yo),e.fill(),1>t.alpha&&(e.globalAlpha=1)}}})(t);else for(let s=0;a.length>s;s++)a[s].draw(t);i&&i.postRender&&i.postRender(t),(e=>{if(Mt())return;const t=f();if(!t?.mouseTrailEnabled)return;if(yt())return;if(!e||!gi||!pi)return;const a=performance.now(),n=vt(+(t.mouseTrailFadeMs??220),40,2e3),o=vt(+(t.mouseTrailOpacity??.35),0,1);if(0>=o)return;const i=t.DPR||1,r=vt(+(t.mouseTrailSize??1.3),.5,10)*i;for(;gi>0&&a-fi[(mi-gi+pi)%pi]>n;)gi--;if(!gi)return;if(2>gi)return;const s=pt(),l=e.globalAlpha,c=e.globalCompositeOperation,d=e.lineCap,p=e.lineJoin,u=e.strokeStyle,h=e.lineWidth;e.globalCompositeOperation="source-over",e.lineCap="round",e.lineJoin="round",e.strokeStyle=s,e.lineWidth=r,e.globalAlpha=o;const m=gi,g=(mi-m+pi)%pi;if(e.beginPath(),e.moveTo(ui[g],hi[g]),2===m)e.lineTo(ui[(g+1)%pi],hi[(g+1)%pi]);else{for(let a=1;m-1>a;a++){const t=(g+a)%pi,n=(g+a+1)%pi,o=ui[t],i=hi[t];e.quadraticCurveTo(o,i,.5*(o+ui[n]),.5*(i+hi[n]))}const t=(g+m-1)%pi;e.lineTo(ui[t],hi[t])}e.stroke(),e.globalAlpha=l,e.globalCompositeOperation=c,e.lineCap=d,e.lineJoin=p,e.strokeStyle=u,e.lineWidth=h})(t),o&&t.restore(),((e,t,a)=>{const n=f();if(!e)return;const o=Io||se(),i=n.DPR||1,s=Math.max(0,Math.min(10,+(n.wallVisualDeformMul??1)||1)),l="function"==typeof n.getCanvasCornerRadius?n.getCanvasCornerRadius():n.cornerRadius??n.wallRadius??0,c=Math.max(0,(+l||0)*i),d=Math.max(0,(+n.wallThickness||0)*i),p=Math.max(1,t-2*d),u=Math.max(1,a-2*d),h=Math.max(0,Math.min(c,.5*p,.5*u));Ko.ringPhysics.ensureGeometry(p,u,h),Ko.ringRender.ensureGeometry(p,u,h);const m=Math.max(2,2*i);e.save(),e.fillStyle=o,e.beginPath(),e.moveTo(-m,-m),e.lineTo(t+m,-m),e.lineTo(t+m,a+m),e.lineTo(-m,a+m),e.closePath();const g=Ko.ringPhysics,b=Ko.ringRender,M=g.n,y=b.n;if(y>0&&M>0){const o=!1!==n.wallPhysicsInterpolation?Math.max(0,Math.min(1,Ko.$||0)):1,r=b.renderDeformations,l=Ko.N,c=Ko._;if(l&&c&&l.length===y&&c.length===y)for(let e=0;y>e;e++){const t=l[e];r[e]=t+(c[e]-t)*o}else{const e=g.deformations,t=b.deformations;for(let a=0;y>a;a++){const n=a/y*M,o=Math.floor(n)%M,i=n-o;t[a]=(1-i)*e[o]+i*e[(o+1)%M]}for(let a=0;y>a;a++)r[a]=(t[(a-2+y)%y]+4*t[(a-1+y)%y]+6*t[a]+4*t[(a+1)%y]+t[(a+2)%y])*(1/16)}const p=b.baseX,u=b.baseY,h=b.normX,f=b.normY,m=Math.min(Math.max(0,.18*Math.max(1,Math.min(t,a))),Math.max(0,+(n.wallWobbleMaxDeform??45)||45)*i*1*s),v=e=>{const t=r[e]*i*1*s;return t>0?t>m?m:t:0},x=e=>p[e]+h[e]*v(e)+d,w=e=>u[e]+f[e]*v(e)+d,S=e=>y-1-e,k=S(0),C=S(y-1),P=x(k),F=w(k),T=x(C),D=w(C);e.moveTo(.5*(T+P),.5*(D+F));for(let t=0;y>t;t++){const a=S(t),n=S((t+1)%y),o=x(a),i=w(a),r=x(n),s=w(n);e.quadraticCurveTo(o,i,.5*(o+r),.5*(i+s))}e.closePath()}try{e.fill("evenodd")}catch(r){e.fill()}e.restore()})(t,n.width,n.height)}function Ct(){Io=se()}function Pt(){return null===ki&&(ki=(()=>{try{return!1}catch(e){}try{if("8001"==(globalThis?.location?.port??"")+"")return!0}catch(e){}try{if(Array.from(document.scripts||[]).some(e=>{if("module"!==(e.getAttribute("type")||"").toLowerCase())return!1;const t=e.getAttribute("src")||"";return/(^|\/)main\.js(\?|#|$)/.test(t)}))return!0}catch(e){}return!1})()),ki}function Ft(e){const t=Math.random();let a=0;for(let n=0;8>n;n++)if(a+=Di[n],a>=t)return e[n];return e[0]}function Tt({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"],silence:a=!1}={}){if(!Fi){Fi=!0;try{Si.log("%c"+e,"color: #888; font-style: italic;"),Si.log("");try{const e=((e,t=3)=>{const{colorAssignments:a}=((e,t=3)=>{let a;try{a=(()=>{try{const e=f(),t=e?.currentColors;if(Array.isArray(t)&&t.length>=8)return t.slice(0,8)}catch(e){}return Ti})(),Array.isArray(a)&&a.length>=8||(a=Ti)}catch(s){a=Ti}const n=[];for(let l=0;e.length>l;l++){const a=e[l];for(let e=0;a.length>e;e+=t){const o=a.slice(e,e+t);n.push({row:l,col:e,visible:o.trim().length>0})}}const o=n.map((e,t)=>e.visible?t:-1).filter(e=>e>=0),i=Array(n.length).fill(null),r=(e=>{for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e})([...o]);for(let l=0;Math.min(8,r.length)>l;l++){const e=Math.min(l,a.length-1);i[r[l]]=a[e]||Ti[e]}for(const l of o)null===i[l]&&(i[l]=Ft(a));for(let l=0;n.length>l;l++)null===i[l]&&(i[l]="transparent");return{clusters:n,colorAssignments:i}})(e,t),n=[];let o=0;for(const i of e){let e="";const r=[];for(let n=0;i.length>n;n+=t)e+="%c"+i.slice(n,n+t),r.push(`color: ${a[o]}; font-family: monospace; font-weight: bold; font-size: 12px; letter-spacing: 0;`),o++;n.push([e,...r])}return n})(t,3);for(const t of e)Si.log(...t)}catch(n){for(const e of t)Si.log(e)}Si.log("");const a=(new Date).getFullYear();Si.log("%c© "+a+" Alexander Beck Studio. All rights reserved. Unauthorized reproduction prohibited.","color: #555; font-size: 10px;")}catch(o){}if(a)try{console.log=()=>{},console.info=()=>{},console.warn=()=>{},console.debug=()=>{},console.table=()=>{},console.group=()=>{},console.groupCollapsed=()=>{},console.groupEnd=()=>{}}catch(o){}}}function Dt(e){if(!Pt())return;const t=("undefined"!=typeof performance&&performance.now?performance.now():Date.now())-Pi;Ci+=1,Si.log(`[${(Ci+"").padStart(2,"0")}] +${t.toFixed(1)}ms ${e}`)}function Lt(e){if(Pt())try{performance.mark(e)}catch(t){}}function It(e,t,a){if(!Pt())return null;try{performance.measure(e,t,a);const n=performance.getEntriesByName(e),o=n&&n.length?n[n.length-1]:null;return o?o.duration:null}catch(n){return null}}function At(){const e=navigator.userAgent||"",t=/Android/.test(e),a=/iPhone|iPad|iPod/.test(e)||/Mac/.test(e)&&navigator.maxTouchPoints>1,n=t||a,o=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||window.matchMedia&&window.matchMedia("(display-mode: minimal-ui)").matches||!0===navigator.standalone;return n||o}function Kt(){if(Li&&Ii){const e=document.documentElement;return e.style.setProperty("--frame-color-light",Li),void e.style.setProperty("--frame-color-dark",Ii)}const e=f(),a=document.documentElement,n=e?.frameColorLight||e?.frameColor||t("--frame-color-light","#0a0a0a"),o=e?.frameColorDark||e?.frameColor||t("--frame-color-dark","#0a0a0a");a.style.setProperty("--frame-color-light",n),a.style.setProperty("--frame-color-dark",o)}function Ot(e){(()=>{if(Li&&Ii)return;const e=f();Li=e?.frameColorLight||e?.frameColor||t("--frame-color-light","#0a0a0a"),Ii=e?.frameColorDark||e?.frameColor||t("--frame-color-dark","#0a0a0a")})(),(e=>{const t=document.documentElement;t.style.setProperty("--frame-color-light",e),t.style.setProperty("--frame-color-dark",e)})(t(e?"--wall-color-browser-dark":"--wall-color-browser-light",e?"#202124":"#f1f3f4"))}function Et(e){Ai=e;let a=!1;a="auto"===e?"dark"===Ki||(()=>{const e=f();if(!e.autoDarkModeEnabled)return!1;const t=Number.isFinite(e.autoDarkNightStartHour)?e.autoDarkNightStartHour:18,a=Number.isFinite(e.autoDarkNightEndHour)?e.autoDarkNightEndHour:6,n=(new Date).getHours();return t!==a&&(a>t?n>=t&&a>n:n>=t||a>n)})():"dark"===e,(e=>{const a=f();a.isDarkMode=e,document.documentElement.style.colorScheme=e?"dark":"light",e?(a.container?.classList.add("dark-mode"),document.body.classList.add("dark-mode"),document.documentElement.classList.add("dark-mode")):(a.container?.classList.remove("dark-mode"),document.body.classList.remove("dark-mode"),document.documentElement.classList.remove("dark-mode")),(e=>{const t=(f().chromeHarmonyMode||"auto")+"",a=(()=>{const e=navigator.userAgent||"",t=navigator.vendor||"";return{isFirefox:/Firefox\//.test(e),isSafari:/Safari\//.test(e)&&/Apple/.test(t)&&!/Chrome\//.test(e)&&!/Chromium\//.test(e),isChromium:/Chrome\//.test(e)||/Chromium\//.test(e)||/Edg\//.test(e),ua:e}})();if("site"===t)return Kt(),{mode:t,family:a,themeColorLikelyApplied:At()};if("browser"===t)return Ot(e),{mode:t,family:a,themeColorLikelyApplied:At()};const n=At();a.isSafari?Kt():a.isChromium&&!n?Ot(e):Kt()})(e),(e=>{const a=f(),n=a?.frameColorLight||t("--frame-color-light","#0a0a0a"),o=a?.frameColorDark||t("--frame-color-dark","#0a0a0a"),i=e?o:n;let r=document.querySelector('meta[name="theme-color"]');r||(r=document.createElement("meta"),r.name="theme-color",document.head.appendChild(r)),r.content=i;let s=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: light)"]');s||(s=document.createElement("meta"),s.name="theme-color",s.media="(prefers-color-scheme: light)",document.head.appendChild(s)),s.content=n;let l=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: dark)"]');l||(l=document.createElement("meta"),l.name="theme-color",l.media="(prefers-color-scheme: dark)",document.head.appendChild(l)),l.content=o})(e),Ct(),N(a.currentTemplate),(()=>{const e=document.getElementById("themeAuto"),t=document.getElementById("themeLight"),a=document.getElementById("themeDark");if(!e||!t||!a)return;[e,t,a].forEach(e=>e.classList.remove("active")),"auto"===Ai?e.classList.add("active"):"light"===Ai?t.classList.add("active"):a.classList.add("active");const n=document.getElementById("themeStatus");if(n){const e=f();n.textContent="auto"===Ai?e.isDarkMode?"🌙 Auto (Dark)":"☀️ Auto (Light)":"light"===Ai?"☀️ Light Mode":"🌙 Dark Mode"}})()})(a);try{localStorage.setItem("theme-preference",e)}catch(n){}Dt(`🎨 Theme set to: ${e} (rendering: ${a?"dark":"light"})`)}function Bt(){if(Oi)return;Oi=!0,(()=>{const e=f(),t=document.documentElement;e?.bgLight&&(t.style.setProperty("--bg-light",e.bgLight),t.style.setProperty("--chrome-bg-light",e.bgLight)),e?.bgDark&&(t.style.setProperty("--bg-dark",e.bgDark),t.style.setProperty("--chrome-bg-dark",e.bgDark)),e?.frameColorLight&&t.style.setProperty("--frame-color-light",e.frameColorLight),e?.frameColorDark&&t.style.setProperty("--frame-color-dark",e.frameColorDark);const a=e.isDarkMode?e?.frameColorDark:e?.frameColorLight;if(a){const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=a),t.style.setProperty("--chrome-bg",a)}e?.textColorLight&&t.style.setProperty("--text-color-light",e.textColorLight),e?.textColorLightMuted&&t.style.setProperty("--text-color-light-muted",e.textColorLightMuted),e?.textColorDark&&t.style.setProperty("--text-color-dark",e.textColorDark),e?.textColorDarkMuted&&t.style.setProperty("--text-color-dark-muted",e.textColorDarkMuted),e?.edgeLabelColorLight&&t.style.setProperty("--edge-label-color-light",e.edgeLabelColorLight),e?.edgeLabelColorDark&&t.style.setProperty("--edge-label-color-dark",e.edgeLabelColorDark),Number.isFinite(e?.edgeLabelInsetAdjustPx)&&t.style.setProperty("--edge-label-inset-adjust",e.edgeLabelInsetAdjustPx+"px"),e?.linkHoverColor&&t.style.setProperty("--link-hover-color",e.linkHoverColor),e?.logoColorLight&&t.style.setProperty("--logo-color-light",e.logoColorLight),e?.logoColorDark&&t.style.setProperty("--logo-color-dark",e.logoColorDark),e?.portfolioLogoColorLight&&t.style.setProperty("--portfolio-logo-color-light",e.portfolioLogoColorLight),e?.portfolioLogoColorDark&&t.style.setProperty("--portfolio-logo-color-dark",e.portfolioLogoColorDark)})(),Ki=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",Dt("🖥️ System prefers: "+Ki);let e="auto";try{const t=localStorage.getItem("theme-preference");"auto"!==t&&"light"!==t&&"dark"!==t||(e=t)}catch(o){}Et(e);const t=document.getElementById("themeAuto"),a=document.getElementById("themeLight"),n=document.getElementById("themeDark");t&&t.addEventListener("click",()=>Et("auto")),a&&a.addEventListener("click",()=>Et("light")),n&&n.addEventListener("click",()=>Et("dark")),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{Ki=e.matches?"dark":"light",Dt("🖥️ System preference changed to: "+Ki),"auto"===Ai&&Et("auto")}),window.setInterval(()=>{"auto"===Ai&&Et("auto")},6e4),Dt("✓ Modern dark mode initialized")}function Rt(){Et("light"===Ai?"dark":"light")}function zt(e){const t={};if(!e||"object"!=typeof e)return t;for(const a of Zi)({}).hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}function Wt(e,t,a,n){const o="number"==typeof e?e:+e;return Number.isFinite(o)?Math.min(a,Math.max(t,o)):n}function Vt(e,t,a,n){const o="number"==typeof e?e:+e;return Number.isFinite(o)?Math.min(a,Math.max(t,Math.round(o))):n}function $t(e,t=0){return Wt(e,0,1,t)}function Nt(e,t,a){return t.includes(e)?e:a}function _t(e,t){try{const a=getComputedStyle(document.documentElement).getPropertyValue(e).trim(),n=Number.parseFloat(a);return Number.isFinite(n)?n:t}catch{return t}}function Gt(e){let t=e>>>0;return()=>{t+=1831565813;let e=t;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}function Ht(e){const t=(e()+e()+e())/3;return Math.max(0,Math.min(1,.5+1.15*(t-.5)))}function jt(e){const t=document.documentElement;t.style.setProperty("--abs-noise-enabled",e.noiseEnabled?"1":"0");const a=e.noiseMotion,n="drift"===a?"linear":"steps(1, end)";t.style.setProperty("--abs-noise-keyframes","static"===a?"none":"drift"===a?"abs-noise-drift":"abs-noise-jitter"),t.style.setProperty("--abs-noise-timing",n),t.style.setProperty("--abs-noise-speed-back",Math.max(0,Math.round(e.noiseSpeedBackMs))+"ms"),t.style.setProperty("--abs-noise-speed-front",Math.max(0,Math.round(e.noiseSpeedFrontMs))+"ms"),t.style.setProperty("--abs-noise-motion-amount",e.noiseMotionAmount+""),t.style.setProperty("--abs-noise-flicker",e.noiseFlicker+""),t.style.setProperty("--abs-noise-flicker-speed",Math.max(0,Math.round(e.noiseFlickerSpeedMs))+"ms");const o=Wt(e.noiseBlurPx,0,6,0);t.style.setProperty("--abs-noise-blur",o.toFixed(2)+"px"),t.style.setProperty("--abs-noise-filter",o>0?`blur(${o.toFixed(2)}px)`:"none");const i=Wt(e.noiseMotionAmount,0,2.5,1),r="static"!==e.noiseMotion&&i>0,s=Wt(.55*Wt(e.noiseSizeTop,20,600,150),24,120,82),l=r?s*i:0;t.style.setProperty("--abs-noise-overscan",`-${Math.ceil(l+(o>0?6*o:0)+32)}px`);const c=Gt((2772082231^e.noiseSeed)>>>0);for(let p=1;40>=p;p++){const e=.9*(2*c()-1)*l,a=.9*(2*c()-1)*l;t.style.setProperty(`--abs-noise-j${p}-x`,Math.round(e)+"px"),t.style.setProperty(`--abs-noise-j${p}-y`,Math.round(a)+"px")}const d=c()*Math.PI*2;t.style.setProperty("--abs-noise-drift-x",Math.round(Math.cos(d)*l)+"px"),t.style.setProperty("--abs-noise-drift-y",Math.round(Math.sin(d)*l)+"px"),t.style.setProperty("--noise-size-base",Math.round(e.noiseSizeBase)+"px"),t.style.setProperty("--noise-size-top",Math.round(e.noiseSizeTop)+"px"),t.style.setProperty("--noise-back-opacity-light",e.noiseBackOpacity+""),t.style.setProperty("--noise-front-opacity-light",e.noiseFrontOpacity+""),t.style.setProperty("--noise-back-opacity-dark",e.noiseBackOpacityDark+""),t.style.setProperty("--noise-front-opacity-dark",e.noiseFrontOpacityDark+""),t.style.setProperty("--noise-top-opacity",e.noiseTopOpacity+""),t.style.setProperty("--detail-noise-opacity",(e.detailNoiseOpacity??1)+"")}function Zt(e={}){const t=_t("--noise-size-base",100),a=_t("--noise-size-top",150),n=_t("--noise-back-opacity-light",.025),o=_t("--noise-front-opacity-light",.055),i=_t("--noise-back-opacity-dark",.12),r=_t("--noise-front-opacity-dark",.08),s=_t("--noise-top-opacity",.01),l={noiseSeed:Vt(e.noiseSeed,0,999999,1337),noiseTextureSize:Vt(e.noiseTextureSize,64,512,256),noiseDistribution:Nt(e.noiseDistribution,["uniform","gaussian"],"gaussian"),noiseMonochrome:void 0===e.noiseMonochrome||!!e.noiseMonochrome,noiseChroma:$t(e.noiseChroma,.35),noiseEnabled:void 0===e.noiseEnabled||!!e.noiseEnabled,noiseMotion:Nt(e.noiseMotion,["jitter","drift","static"],"jitter"),noiseMotionAmount:Wt(e.noiseMotionAmount,0,2.5,1),noiseSpeedBackMs:Vt(e.noiseSpeedBackMs,0,1e4,1800),noiseSpeedFrontMs:Vt(e.noiseSpeedFrontMs,0,1e4,1100),noiseFlicker:Wt(e.noiseFlicker,0,1,.12),noiseFlickerSpeedMs:Vt(e.noiseFlickerSpeedMs,0,5e3,220),noiseBlurPx:Wt(e.noiseBlurPx,0,6,0),noiseContrast:Wt(e.noiseContrast,.25,5,1.35),noiseBrightness:Wt(e.noiseBrightness,.25,3,1),noiseSaturation:Wt(e.noiseSaturation,0,3,1),noiseHue:Wt(e.noiseHue,0,360,0),noiseSizeBase:Wt(e.noiseSizeBase,20,400,t),noiseSizeTop:Wt(e.noiseSizeTop,20,600,a),noiseBackOpacity:Wt(e.noiseBackOpacity,0,.3,n),noiseFrontOpacity:Wt(e.noiseFrontOpacity,0,.3,o),noiseBackOpacityDark:Wt(e.noiseBackOpacityDark,0,.5,i),noiseFrontOpacityDark:Wt(e.noiseFrontOpacityDark,0,.5,r),noiseTopOpacity:Wt(e.noiseTopOpacity,0,.25,s),detailNoiseOpacity:Wt(e.detailNoiseOpacity,0,1,1)};return l.noiseMonochrome&&(l.noiseChroma=$t(l.noiseChroma,.35)),l}function Yt(e,{force:t=!1}={}){const a=JSON.stringify({seed:e.noiseSeed,size:e.noiseTextureSize,distribution:e.noiseDistribution,monochrome:e.noiseMonochrome,chroma:e.noiseChroma,contrast:(+e.noiseContrast).toFixed(3),brightness:(+e.noiseBrightness).toFixed(3),saturation:(+e.noiseSaturation).toFixed(3),hue:(+e.noiseHue).toFixed(1)});if(e.noiseEnabled)(t||a!==ji)&&(ji=a,Hi&&window.clearTimeout(Hi),Hi=window.setTimeout(async()=>{Hi=null;const t=++Gi,a=await(async({size:e,seed:t,distribution:a,monochrome:n,chroma:o,contrast:i,brightness:r,saturation:s,hue:l})=>{const c=(e=>(zi||(zi=document.createElement("canvas"),Wi=zi.getContext("2d",{willReadFrequently:!0})),Wi?(zi.width!==e&&(zi.width=e),zi.height!==e&&(zi.height=e),Ni!==e&&(Ni=e,Vi=null,$i=null),Wi):null))(e);if(!c)return null;Vi||(Vi=c.createImageData(e,e),$i=new Uint32Array(Vi.data.buffer));const d=$i,p=Gt(t),u="gaussian"===a,h=$t(o,0),f=1-h,m=Wt(i,.25,5,1),g=Wt(r,.25,3,1),b=Wt(s,0,3,1),M=Wt(l,0,360,0),y=1!==m||1!==g,v=1!==b,x=0!==M,w=.213,S=.715,k=.072;let C=1,P=0,F=0,T=0,D=1,L=0,I=0,A=0,K=1;if(x){const e=M*Math.PI/180,t=Math.cos(e),a=Math.sin(e);C=w+.787*t-a*w,P=S-t*S-a*S,F=k-t*k+.928*a,T=w-t*w+.143*a,D=S+t*(1-S)+.14*a,L=k-t*k-.283*a,I=w-t*w-.787*a,A=S-t*S+a*S,K=k+.928*t+a*k}for(let E=0;d.length>E;E++){const e=u?Ht(p):p();let t=e,a=e,o=e;if(n||(t=e*f+(u?Ht(p):p())*h,a=e*f+(u?Ht(p):p())*h,o=e*f+(u?Ht(p):p())*h),y&&(t=(t-.5)*m+.5,a=(a-.5)*m+.5,o=(o-.5)*m+.5,t*=g,a*=g,o*=g),v){const e=t*w+a*S+o*k;t=e*(1-b)+t*b,a=e*(1-b)+a*b,o=e*(1-b)+o*b}if(x){const e=t*T+a*D+o*L,n=t*I+a*A+o*K;t=t*C+a*P+o*F,a=e,o=n}const i=Math.max(0,Math.min(255,Math.round(255*t))),r=Math.max(0,Math.min(255,Math.round(255*a)));d[E]=255<<24|Math.max(0,Math.min(255,Math.round(255*o)))<<16|r<<8|i}c.putImageData(Vi,0,0);const O=await(async e=>await new Promise(t=>{try{e.toBlob(e=>t(e),"image/png")}catch(a){t(null)}}))(zi);return O?URL.createObjectURL(O):null})({size:e.noiseTextureSize,seed:e.noiseSeed,distribution:e.noiseDistribution,monochrome:e.noiseMonochrome,chroma:e.noiseChroma,contrast:e.noiseContrast,brightness:e.noiseBrightness,saturation:e.noiseSaturation,hue:e.noiseHue});if(t===Gi){if(a)try{document.documentElement.style.setProperty("--abs-noise-texture",`url("${a}")`),_i&&URL.revokeObjectURL(_i),_i=a}catch(n){URL.revokeObjectURL(a)}}else a&&URL.revokeObjectURL(a)},140));else{Hi&&window.clearTimeout(Hi),Hi=null,Gi++,ji="";try{document.documentElement.style.setProperty("--abs-noise-texture","none")}catch(n){}if(_i)try{URL.revokeObjectURL(_i)}catch(n){}_i=null}}function Xt(e={}){const t=Ri||Zt({});return Zt({...t,...zt(e)})}function qt(e={}){Ri=Xt(e),Bi=!0,jt(Ri),Yt(Ri,{force:!0})}function Ut(e={}){Bi||qt(e),Ri=Xt(e),jt(Ri),Yt(Ri)}function Jt(){console.log("⚠️ localStorage is disabled")}function Qt(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(Jt,500)}function ea(e){return!1!==Xi[e]}function ta(e,t=!0){const a=$n[e];if(!a)return;const n=f();for(const[i,r]of Object.entries(a))"label"!==i&&void 0!==n[i]&&(n[i]=r);n.parallaxLinearPreset=e,t&&Promise.resolve().then(()=>Jo).then(({resetCurrentMode:e})=>e());try{fa()}catch(o){}console.log("Applied parallax linear preset: "+a.label)}function aa(e,t=!0){const a=Nn[e];if(!a)return;const n=f();for(const[i,r]of Object.entries(a))"label"!==i&&void 0!==n[i]&&(n[i]=r);n.parallaxPerspectivePreset=e,t&&Promise.resolve().then(()=>Jo).then(({resetCurrentMode:e})=>e());try{fa()}catch(o){}console.log("Applied parallax perspective preset: "+a.label)}function na(e){return{id:e,label:"Warmup Frames",stateKey:e,type:"range",min:0,max:240,step:1,default:10,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0,hint:"Pre-runs physics before first render to avoid visible settling on mode start."}}function oa(e,t){try{if("function"==typeof e?.format)return e.format(t)}catch(a){}return(t??"")+""}function ia(){const e=[];for(const t of Object.values(Ji))for(const a of t.controls)e.push({...a,section:t.title});return e}function ra(e){if("divider"===e.type)return`<div class="control-divider"><span class="control-divider-label">${e.label||""}</span></div>`;if(!ea(e.id))return"";const t=e.id+"Slider",a=e.id+"Val",n=e.id+"Picker";if("colorDistribution"===e.type){const t=(Array.isArray(e.labels)?e.labels:[]).map((e,t)=>{const a=((e||"")+"").trim();return`\n        <div class="color-dist-row" data-color-dist-row="${t}">\n          <div class="color-dist-row-label">${a}</div>\n          <div class="color-dist-row-controls">\n            <span class="color-dist-swatch" id="${"colorDistSwatch"+t}" aria-hidden="true"></span>\n            <select id="${"colorDistColor"+t}" class="control-select color-dist-select" aria-label="${a} color"></select>\n            <input type="range" id="${"colorDistWeight"+t}" min="0" max="100" step="1" value="0" aria-label="${a} weight">\n            <span class="color-dist-weight" id="${"colorDistWeightVal"+t}">0%</span>\n          </div>\n        </div>`}).join("");return`\n      <div class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="colorDistTotalVal">100%</span>\n        </div>\n        <div class="color-dist-grid" id="colorDistGrid">\n          ${t}\n        </div>\n        <div class="color-dist-actions">\n          <button type="button" class="secondary" id="colorDistResetBtn" aria-label="Reset color distribution to defaults">Reset Defaults</button>\n        </div>\n      </div>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`}if("color"===e.type)return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${e.default}</span>\n        </div>\n        <input type="color" id="${n}" value="${e.default}" aria-label="${e.label}" />\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`;if("select"===e.type){const n=(Array.isArray(e.options)?e.options:[]).map(t=>{const a=t.value+"";return`<option value="${a}" ${e.default+""===a?"selected":""}>${(t.label??t.value)+""}</option>`}).join(""),o=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${oa(e,e.default)}</span>\n        </div>\n        <select id="${t}" class="control-select" aria-label="${e.label}">\n          ${n}\n        </select>\n      </label>\n      ${o}`}if("checkbox"===e.type)return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${e.default?"On":"Off"}</span>\n        </div>\n        <input type="checkbox" id="${t}" ${e.default?"checked":""} aria-label="${e.label}">\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`;const o=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${oa(e,e.default)}</span>\n        </div>\n        <input type="range" id="${t}" min="${e.min}" max="${e.max}" step="${e.step}" value="${e.default}">\n      </label>\n      ${o}`}function sa(e,t){const a=t.controls.filter(e=>ea(e.id));if(0===a.length)return"";let n=null,o="";for(const l of a)l.group&&l.group!==n?(null!==n&&(o+="</div>"),o+=`<div class="section-title" style="margin-top: 12px;">${l.group}</div><div class="group">`,n=l.group):l.group||null===n||(o+="</div>",n=null),o+=ra(l);null!==n&&(o+="</div>");const i=t.defaultOpen?"open":"",r=`\n    <summary class="panel-section-header">\n      ${t.icon?`<span class="section-icon">${t.icon}</span>`:""}\n      <span class="section-label">${t.title}</span>\n    </summary>`,s=`<div class="panel-section-content">${o}</div>`;return t.mode?`\n      <div id="${t.mode}Controls" class="mode-controls">\n        <details class="panel-section-accordion" ${i}>\n          ${r}\n          ${s}\n        </details>\n      </div>`:`\n    <details class="panel-section-accordion" ${i}>\n      ${r}\n      ${s}\n    </details>`}function la({open:e=!0}={}){return`\n    <details class="panel-section-accordion" ${e?"open":""}>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎨</span>\n        <span class="section-label">Theme</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="theme-segment-control" role="group" aria-label="Theme selector">\n          <button id="themeAuto" class="theme-segment-btn" aria-label="Auto theme">Auto</button>\n          <button id="themeLight" class="theme-segment-btn active" aria-label="Light theme">Light</button>\n          <button id="themeDark" class="theme-segment-btn" aria-label="Dark theme">Dark</button>\n        </div>\n        <div id="themeStatus" class="panel-status">☀️ Light Mode</div>\n      </div>\n    </details>`}function ca({open:e=!1}={}){return`\n    <details class="panel-section-accordion" ${e?"open":""}>\n      <summary class="panel-section-header">\n        <span class="section-icon">🌈</span>\n        <span class="section-label">Palette</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Color Template</span>\n            <span class="control-value"></span>\n          </div>\n          <select id="colorSelect"></select>\n        </label>\n      </div>\n    </details>`}function da(){let e="",t=null;for(const a of qi){if(!Ji[a])continue;const n=Ui[a]||null;n&&n!==t?(null!==t&&(e+="</div>"),e+=`\n        <div class="panel-category-group">\n          <div class="panel-category-label">${n}</div>`,t=n):n||null===t||(e+="</div>",t=null),e+=sa(0,Ji[a])}return null!==t&&(e+="</div>"),e}function pa(){let e=`\n    <div role="status" aria-live="polite" aria-atomic="true" class="sr-only" id="announcer"></div>\n    ${(()=>{const e=Object.entries(Ji).filter(([,e])=>e?.mode).map(([e,t])=>sa(0,t)).join("");return`\n    <details class="panel-section-accordion" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎛️</span>\n        <span class="section-label">Mode</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="mode-switcher" role="group" aria-label="Simulation mode selector">\n          ${(()=>{const e={pit:"🎯",bubbles:"🫧",critters:"🪲",flies:"🕊️","pit-throws":"🎯",water:"🌊",vortex:"🌀",magnetic:"🧲","ping-pong":"🏓",weightless:"🌌",kaleidoscope:"🪞","kaleidoscope-1":"🪞","kaleidoscope-2":"🪞","kaleidoscope-3":"🪞","orbit-3d":"🌪️","orbit-3d-2":"🌪️",lattice:"💎",neural:"🧠"},t={pit:"Pit",bubbles:"Bubbles",critters:"Critters",flies:"Flies","pit-throws":"Throws",water:"Water",vortex:"Vortex",magnetic:"Magnet","ping-pong":"Pong",weightless:"Zero-G",kaleidoscope:"Kalei","kaleidoscope-1":"Kalei I","kaleidoscope-2":"Kalei II","kaleidoscope-3":"Kalei III","orbit-3d":"Orbit","orbit-3d-2":"Swarm",lattice:"Lattice",neural:"Neural"};let a="";return Rn.forEach(n=>{const o=t[n]||n;a+=`<button class="mode-button" data-mode="${n}" aria-label="${zn[n]||o} mode">${e[n]||"⚪"} ${o}</button>`}),a})()}\n        </div>\n        ${e}\n      </div>\n    </details>`})()}\n  `;for(const[t,a]of Object.entries(Ji))a?.mode||qi.includes(t)||(e+=sa(0,a));return e}function ua(){try{for(const[,e]of Object.entries(Ji)){if(!e?.mode)continue;const t=Array.isArray(e.controls)?e.controls.length:0;4>t&&console.warn(`[panel] Mode "${e.mode}" has only ${t} controls; add at least 4 parameters.`)}}catch(e){}return`\n    ${la({open:!0})}\n    ${da()}\n    ${pa()}\n    ${ca({open:!1})}\n    <div class="panel-section panel-section--action">\n      <button id="saveRuntimeConfigBtn" class="primary">💾 Save Config</button>\n    </div>\n    <div class="panel-footer">\n      <kbd>R</kbd> reset · <kbd>/</kbd> panel · <kbd>9</kbd> kalei · Critters + Throws have no key (yet)\n    </div>\n  `}function ha(){const e=f();for(const[a,n]of Object.entries(Ji))for(const o of n.controls){const i=document.getElementById(o.id+"Val");if("colorDistribution"===o.type){const s=Array.isArray(o.labels)?o.labels:[],l=document.getElementById("colorDistResetBtn");function c(e){return((e||"")+"").trim().toLowerCase()}function d(e,t,a,n=t){const o=+e;if(!Number.isFinite(o))return n;const i=Math.floor(o);return t>i?t:i>a?a:i}function p(e){const t=[];for(let a=0;8>a;a++)t.push({value:a+"",label:`Ball ${a+1}${e[a]?" — "+e[a]:""}`});return t}function u(t){const a=Array.isArray(e.colorDistribution)?e.colorDistribution:[],n=new Map;for(const e of a)n.set(c(e?.label),e);const o=Array.isArray(t)?t:a,i=[],r=new Set;for(let e=0;s.length>e;e++){const t=((s[e]||"")+"").trim(),a=c(t),l=o.find(e=>c(e?.label)===a)||n.get(a)||{};let p=d(l?.colorIndex,0,7,d(n.get(a)?.colorIndex,0,7,0));if(r.has(p))for(let e=0;8>e;e++)if(!r.has(e)){p=e;break}r.add(p);const u=d(l?.weight,0,100,d(n.get(a)?.weight,0,100,0));i.push({label:t,colorIndex:p,weight:u})}return i}function h(e,t=0){const a=e.map(e=>d(e,0,100,0));let n=0;for(let s=0;a.length>s;s++)n+=a[s];if(100===n)return a;if(0===n)return a[t]=100,a;const o=Array(a.length).fill(0);let i=0;for(let s=0;a.length>s;s++){const e=Math.round(a[s]/n*100);o[s]=e,i+=e}let r=100-i;for(;0!==r;)if(r>0){let e=0;for(let t=1;o.length>t;t++)o[t]>o[e]&&(e=t);o[e]+=1,r-=1}else{let e=-1;for(let t=0;o.length>t;t++)o[t]>0&&(-1===e||o[t]>o[e])&&(e=t);if(-1===e)break;o[e]-=1,r+=1}return o.map(e=>d(e,0,100,0))}function m(e,t,a){const n=e.map(e=>d(e?.weight,0,100,0));return n[t]=d(a,0,100,n[t]),100===n.reduce((e,t)=>e+t,0)?n:h(n,t)}function g(){const t={pit:null,"pit-throws":null,flies:e.fliesBallCount,weightless:e.weightlessCount,water:e.waterBallCount,vortex:e.vortexBallCount,"ping-pong":e.pingPongBallCount,magnetic:e.magneticBallCount,bubbles:e.bubblesMaxCount,kaleidoscope:e.kaleidoscopeBallCount,"kaleidoscope-1":e.kaleidoscope1BallCount,"kaleidoscope-2":e.kaleidoscope2BallCount,"kaleidoscope-3":e.kaleidoscope3BallCount,critters:e.critterCount,neural:e.neuralBallCount,lattice:e.latticeBallCount,orbit3d:e.orbit3dMoonCount,orbit3d2:e.orbit3d2MoonCount}[e.currentMode];return Number.isFinite(+t)?+t:null}function b(){Promise.resolve().then(()=>ns).then(({applyExpertiseLegendColors:e})=>e?.()).catch(()=>{}),Promise.resolve().then(()=>eo).then(({pickRandomColor:t})=>{if("function"!=typeof t)return;const a=e.balls||[];for(let e=0;a.length>e;e++)a[e].color=t()}).catch(()=>{})}function M(){const t=u(e.colorDistribution),a=h(t.map(e=>e.weight),0);for(let e=0;t.length>e;e++)t[e].weight=a[e];e.colorDistribution=t;const n={};for(let e=0;t.length>e;e++)n[t[e].colorIndex]=t[e].label;const o=p(n),i=g();for(let e=0;s.length>e;e++){const a=t[e]||{colorIndex:0,weight:0},r=document.getElementById("colorDistSwatch"+e),s=document.getElementById("colorDistColor"+e),l=document.getElementById("colorDistWeight"+e),c=document.getElementById("colorDistWeightVal"+e);if(s){s.innerHTML="";for(const e of o){const t=document.createElement("option");t.value=e.value,t.textContent=e.label;const o=d(e.value,0,7,0);n[o]&&!(o===a.colorIndex)&&(t.disabled=!0),s.appendChild(t)}s.value=a.colorIndex+""}if(l&&(l.value=d(a.weight,0,100,0)+""),c){const e=d(a.weight,0,100,0),t=null!=i?Math.round(e/100*i):null;c.textContent=null!=t?`${e}% (≈${t})`:e+"%"}if(r){const e=d(a.colorIndex,0,7,0);r.style.backgroundColor=`var(--ball-${e+1})`}}const r=document.getElementById("colorDistTotalVal");if(r){let e=0;for(let a=0;t.length>a;a++)e+=t[a].weight;r.textContent=e+"%"}}try{M()}catch(t){}l&&l.addEventListener("click",()=>{const t=e?.config?.colorDistribution;e.colorDistribution=u(t);const a=h(e.colorDistribution.map(e=>e.weight),0);for(let n=0;e.colorDistribution.length>n;n++)e.colorDistribution[n].weight=a[n];M(),b(),Qt()});for(let y=0;s.length>y;y++){const v=document.getElementById("colorDistColor"+y),x=document.getElementById("colorDistWeight"+y);v&&v.addEventListener("change",()=>{const t=d(v.value,0,7,0),a=u(e.colorDistribution);a[y].colorIndex=t,e.colorDistribution=a,M(),b(),Qt()}),x&&x.addEventListener("input",()=>{const t=d(x.value,0,100,0),a=u(e.colorDistribution),n=m(a,y,t);for(let e=0;a.length>e;e++)a[e].weight=n[e];e.colorDistribution=a,M(),b(),Qt()})}continue}if("color"===o.type){const w=document.getElementById(o.id+"Picker");if(!w)continue;w.addEventListener("input",()=>{const t=w.value;o.stateKey&&(e[o.stateKey]=t),o.onChange&&o.onChange(e,t),i&&(i.textContent=t),Qt()});continue}if("select"===o.type){const S=document.getElementById(o.id+"Slider");if(!S)continue;S.addEventListener("change",()=>{const t=o.parse?o.parse(S.value):S.value;if(o.stateKey&&(e[o.stateKey]=t),o.onChange&&o.onChange(e,t),i){const a=o.stateKey?e[o.stateKey]:t;i.textContent=o.format?o.format(a):a+""}Qt()});continue}if("checkbox"===o.type){const k=document.getElementById(o.id+"Slider");if(!k)continue;k.addEventListener("change",()=>{const t=!!k.checked;o.stateKey&&(e[o.stateKey]=t),o.onChange&&o.onChange(e,t),i&&(i.textContent=t?"On":"Off"),o.reinitMode&&e.currentMode===n.mode&&Promise.resolve().then(()=>Jo).then(({resetCurrentMode:e})=>e?.()).catch(()=>{}),Qt()});continue}const r=document.getElementById(o.id+"Slider");r&&r.addEventListener("input",()=>{const t=o.parse(r.value);if(o.stateKey&&(e[o.stateKey]=t),o.onChange&&o.onChange(e,t),i&&(i.textContent=o.format(o.stateKey?e[o.stateKey]:t)),o.cssVar&&Yi){const e={};e[o.cssVar.replace("--","").replace(/-([a-z])/g,(e,t)=>t.toUpperCase())]=t,Yi(e)}o.reinitMode&&e.currentMode===n.mode&&Promise.resolve().then(()=>Jo).then(({resetCurrentMode:e})=>e?.()).catch(()=>{}),Qt()})}}function fa(){const e=f();for(const t of Object.values(Ji))for(const a of t.controls){if("colorDistribution"===a.type)continue;const t=a.id+"Val",n=document.getElementById("color"===a.type?a.id+"Picker":a.id+"Slider"),o=document.getElementById(t);if(!n||!a.stateKey)continue;const i=e[a.stateKey];void 0!==i&&("checkbox"===a.type?(n.checked=!!i,o&&(o.textContent=i?"On":"Off")):"color"===a.type?(n.value=i,o&&(o.textContent=i)):(n.value=i,o&&(o.textContent=a.format?a.format(i):i+"")),a.onChange&&a.onChange(e,i))}}function ma(){ha(),_();const e=document.getElementById("colorSelect");e&&e.addEventListener("change",()=>{N(e.value),Qt()});const t=document.getElementById("themeAuto"),a=document.getElementById("themeLight"),n=document.getElementById("themeDark");[t,a,n].forEach(e=>{e&&e.addEventListener("click",()=>{[t,a,n].forEach(e=>e?.classList.remove("active")),e.classList.add("active")})})}function ga(){ma(),document.querySelectorAll(".mode-button").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const a=e.getAttribute("data-mode");console.log("Mode button clicked:",a),Promise.resolve().then(()=>Jo).then(({setMode:e})=>{e(a),ba(a)}).catch(()=>{})})})}function ba(e){document.querySelectorAll(".mode-button").forEach(t=>{const a=t.getAttribute("data-mode")===e;t.classList.toggle("active",a)}),document.querySelectorAll(".mode-controls").forEach(e=>e.classList.remove("active"));const t=document.getElementById(e+"Controls");t&&t.classList.add("active");const a=document.getElementById("announcer");a&&(a.textContent=`Switched to ${{critters:"Critters",pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero-G",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope","kaleidoscope-1":"Kaleidoscope I","kaleidoscope-2":"Kaleidoscope II","kaleidoscope-3":"Kaleidoscope III","orbit-3d":"Orbit 3D","orbit-3d-2":"Orbit 3D (Tight Swarm)",lattice:"Crystal Lattice",neural:"Neural Network"}[e]||e} mode`);try{const t=document.getElementById("edge-chapter-text");t&&(t.textContent=zn?.[e]||"—")}catch(n){}}function Ma(e,t){const a=t();for(const n of Object.values(ar))for(const t of n.controls){const n=e.querySelector("#sound_"+t.id),o=e.querySelector(`#sound_${t.id}_val`);if(!n||void 0===a[t.id])continue;const i=t.fromConfig(a[t.id]);n.value=i,o&&(o.textContent=t.format(i))}}function ya(e){try{localStorage.setItem(rr,e+"")}catch(t){}}function va(e={}){const t=e.page||"home",a=e.pageLabel||("portfolio"===t?"Portfolio":"Home"),n=e.pageHTML||tr,o=!!e.includePageSaveButton,i=e.pageSaveButtonId||"savePortfolioConfigBtn",r=e.footerHint||("portfolio"===t?"<kbd>/</kbd> panel":"<kbd>R</kbd> reset · <kbd>/</kbd> panel · <kbd>9</kbd> kalei · Critters + Throws have no key (yet)"),s=e.panelTitle||"Settings",c=e.modeLabel||(Pt()?"DEV MODE":"BUILD MODE"),d=!!e.bindShortcut,h="function"==typeof e.setupPageControls?e.setupPageControls:null;try{const e=document.getElementById("controlPanel");e&&e.remove();const t=document.getElementById("soundPanel");t&&t.remove()}catch(g){}nr=document.createElement("div"),nr.className="panel-dock",nr.id="panelDock";let m=(({defaultHidden:e=!0}={})=>{try{const t=localStorage.getItem(rr);return null===t?!!e:"true"===t}catch(g){return!!e}})({defaultHidden:"portfolio"===t||!Pt()});try{m=!0}catch(g){}return nr.classList.toggle("hidden",!!m),ya(!!m),or=(({page:e,panelTitle:t,modeLabel:a,pageLabel:n,pageHTML:o,includePageSaveButton:i,pageSaveButtonId:r,footerHint:s,setupPageControls:c}={})=>{const d=document.createElement("div");d.id="masterPanel",d.className=(()=>{try{const e=localStorage.getItem(sr);return null===e||"true"===e}catch(g){return!0}})()?"panel collapsed":"panel",d.setAttribute("role","region"),d.setAttribute("aria-label","Settings");const h=document.createElement("div");h.className="panel-header",h.innerHTML=`\n    <div class="mac-titlebar">\n      <div class="mac-traffic" aria-hidden="true">\n        <span class="mac-dot mac-dot--red"></span>\n        <span class="mac-dot mac-dot--yellow"></span>\n        <span class="mac-dot mac-dot--green"></span>\n      </div>\n      <div class="panel-title mac-title">${t}</div>\n      <div class="mac-right">\n        <span class="panel-mode-pill" role="status" aria-label="Runtime mode">${a}</span>\n        <button class="collapse-btn mac-collapse" aria-label="Collapse panel" title="Collapse">▾</button>\n      </div>\n    </div>\n  `;const m=document.createElement("div");m.className="panel-content",m.innerHTML=(({pageLabel:e="Home",pageHTML:t=tr,includePageSaveButton:a=!1,pageSaveButtonId:n="savePortfolioConfigBtn",footerHint:o="<kbd>R</kbd> reset · <kbd>/</kbd> panel · <kbd>9</kbd> kalei · Critters + Throws have no key (yet)"}={})=>{const i=f(),r=+(i.contentPaddingVw||0),s=l(),c=i.layoutViewportWidthPx>0?Math.round(i.layoutViewportWidthPx)+"px":`Auto (${Math.round(s)}px)`,d=Math.max(0,Math.round(i.contentPadding??0)),p=Math.max(0,Math.round(i.wallInset??3)),u=Math.max(0,Math.round(i.layoutMinContentPaddingPx??0)),h=+(i.contentPaddingHorizontalRatio||1),m=`\n    <details class="panel-section-accordion" id="layoutSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">📐</span>\n        <span class="section-label">Layout</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Content Padding</span>\n            <span class="control-value" id="contentPadValue">${r.toFixed(2)}vw · ${d}px (min ${u}px)</span>\n          </div>\n          <input type="range" id="contentPadding" min="0" max="12" step="0.05" value="${r||0}" />\n          <div class="control-hint">Layout-only spacing between wall and content</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Horizontal Ratio</span>\n            <span class="control-value" id="contentPadHorizRatioValue">${h.toFixed(2)}× → ${Math.round(d*h)}px</span>\n          </div>\n          <input type="range" id="contentPadHorizRatio" min="0.5" max="2.5" step="0.05" value="${h}" />\n          <div class="control-hint">Horizontal padding = base × ratio</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Min Content Padding</span>\n            <span class="control-value" id="minContentPadValue">${u}px</span>\n          </div>\n          <input type="range" id="layoutMinContentPaddingPx" min="0" max="64" step="1" value="${u}" />\n          <div class="control-hint">Clamp target on smallest viewports (px).</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Viewport Width</span>\n            <span class="control-value" id="viewportWidthValue">${c}</span>\n          </div>\n          <input type="range" id="layoutViewportWidth" min="0" max="2400" step="10" value="${Math.round(i.layoutViewportWidthPx||0)}" />\n          <div class="control-hint">0 = Auto (uses current window width)</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Wall Inset</span>\n            <span class="control-value" id="wallInsetValue">${p}px</span>\n          </div>\n          <input type="range" id="layoutWallInset" min="0" max="20" value="${p}" />\n        </label>\n      </div>\n    </details>\n  `,g=`\n    <details class="panel-section-accordion" id="soundSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">🔊</span>\n        <span class="section-label">Sound</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="sound-enable-row">\n          <button id="soundEnableBtn" class="sound-enable-btn" aria-label="Enable sound" title="Enable sound">🔇</button>\n        </div>\n        <div id="soundControlsWrapper" class="sound-controls" style="display: none;">\n          <div class="sound-perf" aria-label="Sound performance controls">\n            <button type="button" id="soundTapBtn" class="sound-perf__btn" aria-label="Play test hit">▶︎</button>\n            <button type="button" id="soundResetBtn" class="sound-perf__btn" aria-label="Reset to preset">↺</button>\n            <button type="button" id="soundShuffleBtn" class="sound-perf__btn" aria-label="Shuffle (subtle) sound">🎲</button>\n            <span class="sound-perf__hint">wheel adjusts · shift/alt = fine</span>\n          </div>\n          <label class="control-row">\n            <span class="control-label">Preset</span>\n            <select id="soundPresetSelect" class="control-select"></select>\n          </label>\n          <p id="presetDescription" class="control-hint"></p>\n          ${(()=>{let e="";for(const[t,a]of Object.entries(ar)){e+='<div class="sound-dock__section">',e+=`<div class="sound-dock__section-title">${a.title}</div>`,e+='<div class="sound-dock__group">';for(const t of a.controls)e+=`\n        <label class="sound-dock__row">\n          <span class="sound-dock__label">${t.label}</span>\n          <input type="range" \n            id="sound_${t.id}" \n            class="sound-dock__slider" \n            min="${t.min}" \n            max="${t.max}" \n            step="${t.step}">\n          <span class="sound-dock__val" id="sound_${t.id}_val">${t.format(t.fromConfig(0))}</span>\n        </label>`;e+="</div></div>"}return e})()}\n        </div>\n      </div>\n    </details>\n  `,b=`\n    <details class="panel-section-accordion" id="pageSection" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">⚙️</span>\n        <span class="section-label">${e}</span>\n      </summary>\n      <div class="panel-section-content">\n        ${t}\n      </div>\n    </details>\n  `,M=`\n    <div class="panel-section panel-section--action">\n      <button id="saveRuntimeConfigBtn" class="primary">💾 Save Config</button>\n      ${a?`<button id="${n}" class="primary">💾 Save ${e} Config</button>`:""}\n    </div>\n    <div class="panel-footer">${o}</div>\n  `;return`\n    ${la({open:!0})}\n    ${da()}\n    ${m}\n    ${g}\n    ${ca({open:!1})}\n    ${b}\n    ${M}\n  `})({pageLabel:n,pageHTML:o,includePageSaveButton:i,pageSaveButtonId:r,footerHint:s}),d.appendChild(h),d.appendChild(m);const b=(()=>{try{const e=localStorage.getItem(lr);if(!e)return null;const t=JSON.parse(e);if(!t||"object"!=typeof t)return null;const a=+t.width,n=+t.height;return Number.isFinite(a)&&Number.isFinite(n)?{width:Math.round(a),height:Math.round(n)}:null}catch(g){return null}})();if(b){const e=.8*window.innerHeight;(Math.abs(b.width-368)>5||Math.abs(b.height-e)>5)&&(d.style.width=b.width+"px",d.style.height=b.height+"px",d.style.maxHeight="none")}const M=h.querySelector(".collapse-btn");return M&&M.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),(t=>{t.classList.toggle("collapsed"),(t=>{try{localStorage.setItem(sr,t+"")}catch(e){}})(t.classList.contains("collapsed"))})(d)}),setTimeout(()=>{"home"===e?ga():ma(),(()=>{const e=document.getElementById("saveRuntimeConfigBtn");e&&e.addEventListener("click",()=>{const e=f(),t={};try{const a=ia();for(const n of a){if(!n||!n.stateKey)continue;const a=e[n.stateKey];void 0!==a&&(t[n.stateKey]=a)}}catch(g){}t.gravityMultiplier=e.gravityMultiplierPit,t.restitution=e.REST,t.friction=e.FRICTION,t.ballMass=e.ballMassKg,t.ballScale=e.sizeScale,t.sizeScale=e.sizeScale,t.sizeVariation=e.sizeVariation,t.repelSoft=e.repelSoft,t.repelSoftness=e.repelSoft,t.layoutViewportWidthPx=e.layoutViewportWidthPx||0,t.containerBorderVw=e.containerBorderVw,t.simulationPaddingVw=e.simulationPaddingVw,t.contentPaddingVw=e.contentPaddingVw,t.contentPaddingHorizontalRatio=e.contentPaddingHorizontalRatio,t.wallRadiusVw=e.wallRadiusVw,t.wallThicknessVw=e.wallThicknessVw,t.layoutMinContentPaddingPx=Math.max(0,Math.round(e.layoutMinContentPaddingPx??0)),t.layoutMinWallRadiusPx=Math.max(0,Math.round(e.layoutMinWallRadiusPx??0)),t.wallInset=e.wallInset;try{t.soundPreset=oe(),t.soundConfig=te()}catch(g){}t.chromeHarmonyMode=e.chromeHarmonyMode,t.autoDarkModeEnabled=e.autoDarkModeEnabled,t.autoDarkNightStartHour=e.autoDarkNightStartHour,t.autoDarkNightEndHour=e.autoDarkNightEndHour,t.enableLOD=!1;const a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(a),n.download="default-config.json",document.body.appendChild(n),n.click(),document.body.removeChild(n)})})(),(e=>{const t=e.querySelector("#soundEnableBtn"),a=e.querySelector("#soundControlsWrapper"),n=e.querySelector("#soundPresetSelect"),o=e.querySelector("#presetDescription"),i=e.querySelector("#soundSection"),r=e.querySelector("#soundTapBtn"),s=e.querySelector("#soundResetBtn"),l=e.querySelector("#soundShuffleBtn"),c=(e,t,a)=>t>e?t:e>a?a:e,d=(e,t)=>e+2*(Math.random()-.5)*t,p=(e,{openIfEnabled:n=!1}={})=>{if(!t)return;const o=e||ee(),r=!(!o.isUnlocked||!o.isEnabled),s=!!o.isUnlocked;t.innerHTML=s&&r?'<i class="ti ti-volume-2" aria-hidden="true"></i>':'<i class="ti ti-volume-off" aria-hidden="true"></i>',t.setAttribute("aria-label",s?r?"Sound on":"Sound off":"Enable sound"),t.title=s?r?"Sound on":"Sound off":"Enable sound",t.classList.toggle("enabled",r),a&&(a.style.display=r?"":"none"),n&&r&&i&&!i.open&&(i.open=!0)};if(r&&r.addEventListener("click",()=>{q({intensity:.86,radius:18,xPosition:.72})}),s&&s.addEventListener("click",()=>{const t=oe();ne(t),o&&no[t]&&(o.textContent=no[t].description),Ma(e,te)}),l&&l.addEventListener("click",()=>{const t=te();ae({filterBaseFreq:c(d(t.filterBaseFreq,120),300,8e3),filterQ:c(d(t.filterQ,.04),.05,.9),pitchCurve:c(d(t.pitchCurve,.06),.6,1.8),sparkleGain:c(d(t.sparkleGain,.03),0,.35),sparkleDecayMul:c(d(t.sparkleDecayMul,.05),.25,.95),noiseTransientQ:c(d(t.noiseTransientQ,.25),.6,6),reverbWetMix:c(d(t.reverbWetMix,.02),0,.35),reverbDecay:c(d(t.reverbDecay,.03),.05,.4),collisionMinImpact:c(d(t.collisionMinImpact,.03),.45,.9),variancePitch:c(d(t.variancePitch,.01),0,.2),varianceGain:c(d(t.varianceGain,.02),0,.35)}),Ma(e,te),q({intensity:.86,radius:18,xPosition:.72})}),t&&t.addEventListener("click",async()=>{const e=ee();if(e.isUnlocked){const t=Q();p({...e,isEnabled:t})}else await Y()&&p(null,{openIfEnabled:!0})}),n){for(const[e,t]of Object.entries(no)){const a=document.createElement("option");a.value=e,a.textContent=t.label,n.appendChild(a)}n.value=oe(),o&&no[oe()]&&(o.textContent=no[oe()].description),n.addEventListener("change",()=>{ne(n.value),o&&no[n.value]&&(o.textContent=no[n.value].description),Ma(e,te)})}((e,t,a)=>{for(const n of Object.values(ar))for(const t of n.controls){const n=e.querySelector("#sound_"+t.id),o=e.querySelector(`#sound_${t.id}_val`);if(!n)continue;const i=e=>{const i=(r=e,s=parseFloat(n.min),l=parseFloat(n.max),s>r?s:r>l?l:r);var r,s,l;n.value=i+"";const c=t.toConfig(i);o&&(o.textContent=t.format(i)),a({[t.id]:c})};n.addEventListener("input",()=>{i(parseFloat(n.value))}),n.addEventListener("wheel",e=>{if(e.ctrlKey)return;const t=(parseFloat(n.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),a=0>e.deltaY?1:-1,o=parseFloat(n.value);e.preventDefault(),i(o+a*t)},{passive:!1}),o&&o.addEventListener("wheel",e=>{if(e.ctrlKey)return;const t=(parseFloat(n.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),a=0>e.deltaY?1:-1,o=parseFloat(n.value);e.preventDefault(),i(o+a*t)},{passive:!1})}})(e,0,ae),Ma(e,te),p(),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(bo,e=>{p(e&&e.detail?e.detail:null)})})(d),(e=>{const t=e.querySelector("#contentPadding"),a=e.querySelector("#contentPadValue"),n=e.querySelector("#contentPadHorizRatio"),o=e.querySelector("#contentPadHorizRatioValue"),i=e.querySelector("#layoutMinContentPaddingPx"),r=e.querySelector("#minContentPadValue"),s=e.querySelector("#layoutViewportWidth"),c=e.querySelector("#viewportWidthValue"),d=e.querySelector("#layoutWallInset"),h=e.querySelector("#wallInsetValue"),m=f(),b=({triggerResize:e=!1}={})=>{if(p(),u(),a){const e=Math.max(0,Math.round(m.layoutMinContentPaddingPx??0));a.textContent=`${(m.contentPaddingVw||0).toFixed(2)}vw · ${Math.round(m.contentPadding||0)}px (min ${e}px)`}if(o&&(o.textContent=`${(m.contentPaddingHorizontalRatio||1).toFixed(2)}× → ${Math.round(m.contentPaddingX||m.contentPadding)}px`),r&&(r.textContent=Math.max(0,Math.round(m.layoutMinContentPaddingPx??0))+"px"),c){const e=l();c.textContent=m.layoutViewportWidthPx>0?Math.round(m.layoutViewportWidthPx)+"px":`Auto (${Math.round(e)}px)`}if(e)try{Fe()}catch(g){}document.dispatchEvent(new CustomEvent("layout-updated"))};t&&a&&t.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(m.contentPaddingVw=t,b({triggerResize:!0}))}),n&&o&&n.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(m.contentPaddingHorizontalRatio=Math.max(.1,t),b())}),i&&r&&i.addEventListener("input",e=>{const t=parseInt(e.target.value,10);Number.isFinite(t)&&(m.layoutMinContentPaddingPx=Math.max(0,t),b({triggerResize:!0}))}),s&&c&&s.addEventListener("input",e=>{const t=parseInt(e.target.value,10);m.layoutViewportWidthPx=Number.isFinite(t)?Math.max(0,t):0,b({triggerResize:!0})}),d&&h&&d.addEventListener("input",e=>{const t=parseInt(e.target.value,10);h.textContent=t+"px",m.wallInset=t})})(d);try{c?.(d)}catch(g){}},0),d})({page:t,panelTitle:s,modeLabel:c,pageLabel:a,pageHTML:n,includePageSaveButton:o,pageSaveButtonId:i,footerHint:r,setupPageControls:h}),nr.appendChild(or),document.body.insertBefore(nr,document.body.firstChild),or&&(or.addEventListener("mousedown",e=>{const t=or.getBoundingClientRect();e.clientY-t.top>12||e.target.closest("button")||e.target.closest("input")||e.target.closest("select")||xa(e)}),or.addEventListener("touchstart",e=>{const t=or.getBoundingClientRect();e.touches[0].clientY-t.top>12||e.target.closest("button")||e.target.closest("input")||e.target.closest("select")||xa(e)},{passive:!1}),document.addEventListener("mousemove",wa),document.addEventListener("mouseup",Sa),document.addEventListener("touchmove",wa,{passive:!1}),document.addEventListener("touchend",Sa),(()=>{try{if(!nr)return;const e=JSON.parse(localStorage.getItem(ir)||"{}");e.custom&&(nr.style.position="fixed",nr.style.left=e.left,nr.style.top=e.top,nr.style.right="auto")}catch(g){}})()),(()=>{if(!or)return;if("undefined"==typeof ResizeObserver)return;let e=0;const t=new ResizeObserver(()=>{or&&(or.classList.contains("collapsed")||(window.clearTimeout(e),e=window.setTimeout(()=>{(e=>{try{if(!e)return;if(e.classList.contains("collapsed"))return;const t=e.getBoundingClientRect();localStorage.setItem(lr,JSON.stringify({width:Math.round(t.width),height:Math.round(t.height)}))}catch(g){}})(or)},150)))});try{t.observe(or)}catch(g){}})(),d&&(fr||(fr=!0,window.addEventListener("keydown",e=>{try{const t=e.target?.tagName,a=["INPUT","TEXTAREA","SELECT"].includes(t),n=!!e.target?.closest?.(".panel-dock");if(a&&!n)return}catch(g){}"/"!==(e.key?.toLowerCase?.()||"")&&"Slash"!==e.code||(e.preventDefault(),Pa())}))),nr}function xa(e){if(e.target.closest("button")||e.target.closest("input")||e.target.closest("select"))return;if(!nr)return;const t=e.touches?e.touches[0].clientX:e.clientX,a=e.touches?e.touches[0].clientY:e.clientY,n=nr.getBoundingClientRect();dr=t,pr=a,ur=n.left,hr=n.top,cr=!1}function wa(e){if(0===dr&&0===pr)return;if(!nr)return;const t=(e.touches?e.touches[0].clientX:e.clientX)-dr,a=(e.touches?e.touches[0].clientY:e.clientY)-pr;if(cr||5>=Math.abs(t)&&5>=Math.abs(a)||(cr=!0,nr.classList.add("dragging"),nr.style.position="fixed",nr.style.top=hr+"px",nr.style.left=ur+"px",nr.style.right="auto"),cr){let n=ur+t,o=hr+a;const i=nr.getBoundingClientRect();n=Math.max(0,Math.min(window.innerWidth-i.width,n)),o=Math.max(0,Math.min(window.innerHeight-i.height,o)),nr.style.left=n+"px",nr.style.top=o+"px",e.preventDefault()}}function Sa(){cr&&(cr=!1,nr&&nr.classList.remove("dragging"),ka()),dr=0,pr=0,setTimeout(()=>{},10)}function ka(){try{if(!nr)return;localStorage.setItem(ir,JSON.stringify({left:nr.style.left,top:nr.style.top,custom:!0}))}catch(e){}}function Ca(){if(nr){nr.style.position="",nr.style.left="",nr.style.top="",nr.style.right="";try{localStorage.removeItem(ir)}catch(e){}}}function Pa(){if(!nr)try{va()}catch(t){return}const e=nr.classList.toggle("hidden");if(ya(e),!e)try{(()=>{if(!nr)return;if(!nr.style.left&&!nr.style.top)return;const e=nr.getBoundingClientRect(),t=window.innerWidth||0,a=window.innerHeight||0;if(!t||!a)return;const n=10;if(n>e.right||e.left>t-n||n>e.bottom||e.top>a-n)return void Ca();const o=(e,t,a)=>t>e?t:e>a?a:e,i=o(e.left,n,Math.max(n,t-e.width-n)),r=o(e.top,n,Math.max(n,a-e.height-n));nr.style.position="fixed",nr.style.left=Math.round(i)+"px",nr.style.top=Math.round(r)+"px",nr.style.right="auto",ka()})()}catch(t){}}function Fa(e){const t=f(),a=Rn;if(!a||!a.length)return;const n=a.indexOf(t?.currentMode||Bn.PIT_THROWS),o=a[((0>n?0:n)+e+a.length)%a.length];ot(o),ba(o)}function Ta(){if(!br)return null;if(yr&&yr.isConnected)return yr;let e=document.getElementById("gate-modal-host");return e||(e=document.createElement("div"),e.id="gate-modal-host",e.className="gate-modal-host",br.appendChild(e)),yr=e,yr}function Da(e){if(!br||!e)return;const t=Ta();t&&(vr.has(e)||vr.set(e,{parent:e.parentNode,nextSibling:e.nextSibling}),t.appendChild(e))}function La(e){if(!e)return;const t=vr.get(e);if(t&&t.parent)try{t.nextSibling&&t.nextSibling.parentNode===t.parent?t.parent.insertBefore(e,t.nextSibling):t.parent.appendChild(e)}catch(a){}}function Ia(){const e=t("--wall-thickness","");if(e&&!/calc\(|vw|vh|vmin|vmax|%/i.test(e)){const t=parseFloat(e);if(Number.isFinite(t)&&t>0)return t}const a=f();return a?.wallThickness||12}function Aa(){if(!br)return;const e=Ia();br.style.setProperty("--gate-overlay-blur",e/2+"px")}function Ka(e){if(br=document.getElementById("gate-overlay"),!br)return void console.warn("Gate Overlay: #gate-overlay element not found");if(Mr=!1!==e.gateOverlayEnabled,!Mr)return console.log("Gate Overlay: Disabled by config"),void(br.style.display="none");br.style.display="",Ta();const t=e.gateOverlayOpacity??a("--gate-overlay-opacity",.01),i=e.gateOverlayTransitionMs??o("--gate-overlay-transition-duration",800),r=e.gateOverlayTransitionOutMs??o("--gate-overlay-transition-out-duration",600),s=e.gateOverlayContentDelayMs??o("--gate-content-delay",200),l=e.gateDepthScale??a("--gate-depth-scale",.96),c=e.gateDepthTranslateY??n("--gate-depth-translate-y",8),d=e.logoOpacityInactive??a("--logo-opacity-inactive",1),p=e.logoOpacityActive??a("--logo-opacity-active-target",.2),u=e.logoBlurInactive??n("--logo-blur-inactive",0),h=e.logoBlurActive??n("--logo-blur-active-target",12),f=document.documentElement;f.style.setProperty("--gate-depth-scale",l),f.style.setProperty("--gate-depth-translate-y",c+"px"),f.style.setProperty("--gate-depth-duration",i+"ms"),f.style.setProperty("--gate-depth-out-duration",r+"ms"),f.style.setProperty("--gate-content-delay",s+"ms"),f.style.setProperty("--logo-opacity-inactive",d),f.style.setProperty("--logo-opacity-active-target",p),f.style.setProperty("--logo-opacity-active",d),f.style.setProperty("--logo-blur-inactive",u+"px"),f.style.setProperty("--logo-blur-active-target",h+"px"),f.style.setProperty("--logo-blur-active",u+"px"),Aa(),br.style.setProperty("--gate-overlay-opacity",t),br.style.setProperty("--gate-overlay-transition-duration",i+"ms"),br.style.setProperty("--gate-overlay-transition-out-duration",r+"ms"),br.classList.remove("active"),br.setAttribute("aria-hidden","true"),br.addEventListener("click",Oa),window.addEventListener("resize",Aa),document.addEventListener("layout-updated",Aa);const m=Ia()/2;console.log(`Gate Overlay: Initialized (opacity: ${t}, blur: ${m}px [auto from wall thickness], transition: ${i}ms, logo: opacity ${d}→${p}, blur ${u}px→${h}px)`)}function Oa(e){if(e.target.closest("button"))return;if(e.target.closest("input"))return;if(e.target.closest("a"))return;if(e.target.closest("select"))return;if(e.target.closest("textarea"))return;const t="cv-gate"===e.target.id||"portfolio-gate"===e.target.id||"contact-gate"===e.target.id||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description");(e.target===br||"gate-modal-host"===e.target?.id||t)&&document.dispatchEvent(new CustomEvent("gate-overlay-dismiss",{detail:{instant:!0}}))}function Ea(e){const t=document.documentElement,a=document.getElementById("abs-scene");if(e){const e=getComputedStyle(t).getPropertyValue("--gate-depth-scale").trim()||"0.96",n=getComputedStyle(t).getPropertyValue("--gate-depth-translate-y").trim()||"8px",o=getComputedStyle(t).getPropertyValue("--logo-opacity-active-target").trim()||t.style.getPropertyValue("--logo-opacity-active-target")||"0.2",i=getComputedStyle(t).getPropertyValue("--logo-blur-active-target").trim()||t.style.getPropertyValue("--logo-blur-active-target")||"12px";t.style.setProperty("--gate-depth-scale-active",e),t.style.setProperty("--gate-depth-ty-active",n),t.style.setProperty("--logo-opacity-active",o),t.style.setProperty("--logo-blur-active",i),a&&a.classList.add("gate-depth-active")}else{const e=getComputedStyle(t).getPropertyValue("--logo-opacity-inactive").trim()||"1",n=getComputedStyle(t).getPropertyValue("--logo-blur-inactive").trim()||"0px";t.style.setProperty("--gate-depth-scale-active","1"),t.style.setProperty("--gate-depth-ty-active","0px"),t.style.setProperty("--logo-opacity-active",e),t.style.setProperty("--logo-blur-active",n),a&&a.classList.remove("gate-depth-active")}}function Ba(){if(!br||!Mr)return;Aa(),br.setAttribute("aria-hidden","false"),br.classList.add("active");const e=document.getElementById("custom-cursor");if(e){let a=!1;try{a=!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(t){}a?(e.classList.remove("gate-active"),e.style.display="none"):(e.classList.add("gate-active"),e.style.display="block")}Ea(!0)}function Ra(){if(!br||!Mr)return;br.classList.remove("active"),br.setAttribute("aria-hidden","true");const e=document.getElementById("custom-cursor");e&&e.classList.remove("gate-active"),Ea(!1)}function za(){return!!br&&br.classList.contains("active")}function Wa(e){const t=+e?.sceneImpactMul,a=Number.isFinite(t)?t:0,n=+e?.sceneImpactMobileMulFactor,o=Number.isFinite(n)&&n>0?n:1;return a*((e=>{if(e?.isMobile||e?.isMobileViewport)return!0;try{return!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(t){return!1}})(e)?o:1)}function Va(){if(!Cr)return;let e=null;try{e=f()}catch(n){}if(!e)return;const t=Wa(e);Cr.style.setProperty("--abs-scene-impact-mul",t+"");const a=+e.sceneImpactLogoCompMul;Number.isFinite(a)&&a>0&&Cr.style.setProperty("--abs-scene-impact-logo-comp-mul",a+"")}function $a(e,t){const a=Wa(t),n=Math.max(0,+e||0)*a,o=1/Math.max(.001,1-n),i=+t?.sceneImpactLogoCompMul;return Math.max(.5,Math.min(4,o*(1+((Number.isFinite(i)&&i>0?i:1)-1)*n)))}function Na(){Tr&&(window.clearTimeout(Tr),Tr=0),Dr&&(window.clearTimeout(Dr),Dr=0)}function _a(e=1,t={}){if(!Pr||!Cr)return;const a=f();if(!1===a?.sceneImpactEnabled)return;const n=!1!==t?.scheduleRelease,o=Math.max(0,Math.min(1,+e||0)),i=++Fr;Na(),Cr.classList.add("abs-scene--animating"),t?.armManual&&(Lr=!0);const r=a?.sceneImpactPressMs??75,s=a?.sceneImpactReleaseMs??220,l=Math.max(1,Math.round(.8*(+r||0))),c=Math.max(1,Math.round(1.2*(+s||0)));Cr.style.setProperty(Sr,Math.round(l)+"ms"),window.requestAnimationFrame(()=>{Pr&&Cr&&i===Fr&&(Cr.style.setProperty(wr,o+""),Cr.style.setProperty(kr,$a(o,a)+""))}),n&&(Tr=window.setTimeout(()=>{Ha({token:i,releaseMs:c})},0),Dr=window.setTimeout(()=>{Dr=0,Cr&&Cr.classList.remove("abs-scene--animating")},Math.max(0,Math.round(c)+80)))}function Ga(){if(!Pr||!Cr)return;const e=f();return!1!==e?.sceneImpactEnabled?Ha({token:Fr,releaseMs:Math.max(1,Math.round(1.2*(+(e?.sceneImpactReleaseMs??220)||0)))}):void 0}function Ha({token:e,releaseMs:t}){Na(),Pr&&Cr&&e===Fr&&(Cr.style.setProperty(Sr,Math.round(t)+"ms"),window.requestAnimationFrame(()=>{Pr&&Cr&&e===Fr&&(Cr.style.setProperty(wr,"0"),Cr.style.setProperty(kr,"1"))}),Dr=window.setTimeout(()=>{Dr=0,Cr&&Cr.classList.remove("abs-scene--animating")},Math.max(0,Math.round(t)+80)))}function ja(){const e=f(),t=Rn,a=t.indexOf(e.currentMode),n=t[((0>a?0:a)+1)%t.length];Promise.resolve().then(()=>Jo).then(({setMode:e})=>{e(n)}),Promise.resolve().then(()=>er).then(({updateModeButtonsUI:e})=>{e(n)})}function Za(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function Ya(){try{const e="undefined"!=typeof window?window.__TEXT__:null;return Za(e)?e:null}catch(e){return null}}function Xa(e,t=""){const a=Qr||Ya();if(!a)return t;if(!e)return t;const n=(e+"").split(".").filter(Boolean);let o=a;for(const i of n){if(!Za(o)&&!Array.isArray(o))return t;if(o=o?.[i],null==o)return t}return o}function qa(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.classList.add("page-flash--"+t),setTimeout(()=>{e.classList.remove("page-flash--"+t)},"success"===t?600:300)}function Ua(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.classList.add("page-flash--"+t),setTimeout(()=>{e.classList.remove("page-flash--"+t)},"success"===t?600:300)}async function Ja(){ee().isUnlocked?Qa(Q()):await Y()?Qa(!0):(ts&&(ts.innerHTML=es,ts.setAttribute("aria-label","Audio unavailable"),ts.title="Audio unavailable"),setTimeout(()=>{Qa(!1)},2e3))}function Qa(e){ts&&(ts.setAttribute("data-enabled",e?"true":"false"),ts.setAttribute("aria-pressed",e?"true":"false"),ts.setAttribute("aria-label",e?"Sound on":"Sound off"),ts.title=e?"Sound on":"Sound off",ts.innerHTML=e?'<i class="ti ti-volume-2" aria-hidden="true"></i>':es)}function en(e){return((e||"")+"").trim().toLowerCase()}function tn(e,t,a,n=t){const o=+e;if(!Number.isFinite(o))return n;const i=Math.floor(o);return t>i?t:i>a?a:i}function an(e){const t=f(),a=en(e),n=Array.isArray(t.colorDistribution)?t.colorDistribution:null;if(!n)return null;for(let o=0;n.length>o;o++){const e=n[o];if(en(e?.label)===a)return"bg-ball-"+(tn(e?.colorIndex,0,7,0)+1)}return null}function nn(){const e=document.getElementById("expertise-legend");if(!e)return;const t=Array.from(e.querySelectorAll(".legend__item"));for(const a of t){const e=a.querySelector("span"),t=a.querySelector(".circle");if(!e||!t)continue;const n=an(en(e.textContent));if(n){for(const e of Array.from(t.classList))(e.startsWith("bg-ball-")||e.startsWith("bg-story-"))&&t.classList.remove(e);t.classList.add(n)}}}function on(e){const t=Number.parseFloat(((e||"")+"").trim());return Number.isFinite(t)?t:0}function rn(e){return 0>e?0:e>1?1:e}function sn(e){const t=Number.parseInt(e,16);return Number.isFinite(t)?t:0}function ln(e){const t=((e||"")+"").trim();if(!t)return null;if("#"===t[0]){const e=t.slice(1).trim();return 3===e.length?{r:sn(e[0]+e[0]),g:sn(e[1]+e[1]),b:sn(e[2]+e[2])}:6===e.length?{r:sn(e.slice(0,2)),g:sn(e.slice(2,4)),b:sn(e.slice(4,6))}:null}const a=t.match(/rgba?\(([^)]+)\)/i);if(a){const e=a[1].split(",").map(e=>on(e));if(e.length>=3)return{r:Math.round(e[0]),g:Math.round(e[1]),b:Math.round(e[2])}}return null}function cn(e){const t=rn(e/255);return t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92}function dn({r:e,g:t,b:a}){return.2126*cn(e)+.7152*cn(t)+.0722*cn(a)}function pn(e,t){const a=dn(e),n=dn(t);return(Math.max(a,n)+.05)/(Math.min(a,n)+.05)}function un(e,t,a){const n=rn(a);return{r:Math.round(e.r+(t.r-e.r)*n),g:Math.round(e.g+(t.g-e.g)*n),b:Math.round(e.b+(t.b-e.b)*n)}}function hn({r:e,g:t,b:a},n){return`rgb(${e} ${t} ${a} / ${rn(n)})`}function fn(e){return!(!e||!e.closest||!(e.closest("#panelDock")||e.closest("#masterPanel")||e.closest("#dockToggle")||e.closest(".panel-dock")||e.closest(".panel")))}function mn(e){if(!e||!e.closest)return null;const t=e.closest('a, button, [role="button"]');if(!t)return null;try{if(t.classList?.contains?.("slide"))return null;if(t.closest?.(".slide"))return null}catch(a){}return t}function gn(e){try{e?.style?.removeProperty?.(ds),e?.style?.removeProperty?.(ms),e?.style?.removeProperty?.(gs)}catch(t){}}function bn(e){const t=(()=>{const e=document.getElementById("custom-cursor");if(!e)return 0;const t=e.getBoundingClientRect?.(),a=t?Math.max(t.width,t.height):0;if(a>.5)return a;const n=window.getComputedStyle(e),o=Math.max(on(n.width),on(n.height));return o>0?o*((e=>{const t=((e||"")+"").trim();if(!t||"none"===t)return 1;const a=t.match(/scale\(([^)]+)\)/);if(a)return a[1].split(",").map(e=>on(e))[0]||1;const n=t.match(/matrix\(([^)]+)\)/);if(n){const e=n[1].split(",").map(e=>on(e));if(e.length>=4){const t=e[2],a=e[3];return Math.max(Math.hypot(e[0],e[1])||1,Math.hypot(t,a)||1)}return 1}const o=t.match(/matrix3d\(([^)]+)\)/);if(o){const e=o[1].split(",").map(e=>on(e));return 16>e.length?1:Math.max(Math.hypot(e[0],e[1],e[2])||1,Math.hypot(e[4],e[5],e[6])||1)}return 1})(n.transform||e.style.transform)||1):0})();if(t>0)try{e.style.setProperty(ds,t+"px")}catch(a){}else gn(e)}function Mn(e){try{if(document.body.classList.contains("portfolio-page"))return"ui";if(document.body.classList.contains("detail-open"))return"ui"}catch(t){}if((()=>{try{const e=document.getElementById("gate-overlay");return!!e&&(e.classList.contains("active")||"false"===e.getAttribute("aria-hidden"))}catch(t){return!1}})())return"ui";try{if(e?.closest?.(".project-detail"))return"ui";if(e?.closest?.("#gate-overlay"))return"ui";if(e?.closest?.(".gate-modal-host"))return"ui";if(e?.closest?.("#cv-gate")||e?.closest?.("#portfolio-gate")||e?.closest?.("#contact-gate"))return"ui"}catch(t){}return"index"}function yn(){try{const e=ln(getComputedStyle(document.documentElement).getPropertyValue("--cursor-color").trim());if(e)return e}catch(e){}return null}function vn(){try{document.body.classList.remove(ss)}catch(e){}if(is){try{is.classList.remove(us),is.classList.remove(hs),is.classList.remove(fs),is.classList.remove("abs-cursor-pulse"),is.querySelectorAll?.("."+ps)?.forEach?.(e=>e.remove())}catch(e){}gn(is)}is=null;try{document.body.classList.remove(ls),document.body.classList.remove(cs)}catch(e){}}function xn(){rs||(rs=!0,requestAnimationFrame(()=>{rs=!1,is&&bn(is)}))}function wn(e){const t=mn(e.target);t&&(fn(t)||(t=>{if(!t)return;is&&is!==t&&gn(is),is=t;const a=Mn(is);(t=>{try{document.body.classList.toggle(ls,"index"===t),document.body.classList.toggle(cs,"ui"===t)}catch(e){}})(a);try{is.classList.add(us),is.classList.toggle(hs,"index"===a),is.classList.toggle(fs,"ui"===a)}catch(e){}bn(is);try{is.getBoundingClientRect?.()}catch(e){}if("index"===a){const t=yn(),a=(()=>{const t=[document.querySelector(".wall-frame"),document.getElementById("bravia-balls"),document.getElementById("fade-content"),document.body,document.documentElement].filter(Boolean);for(const a of t)try{const e=getComputedStyle(a).backgroundColor,t=ln(e);if(!t)continue;if(0===t.r&&0===t.g&&0===t.b&&e.includes("rgba")&&/,\s*0(\.0+)?\s*\)/.test(e))continue;return t}catch(e){}return{r:245,g:245,b:245}})();if(t){const n=.12,o=((e,t)=>{const a={r:255,g:255,b:255},n={r:0,g:0,b:0},o=a=>{let n=null;for(let o=0;20>=o;o+=1){const i=o/20,r=un(e,a,i),s=pn(r,t);if(s>=4.5){n={rgb:r,t:i,cr:s};break}}return n},i=o(a),r=o(n);if(i&&r)return i.t>r.t?r.rgb:i.rgb;if(i)return i.rgb;if(r)return r.rgb;const s=pn(e,t),l=pn(a,t),c=pn(n,t);return 4.5>s?c>l?n:a:e})(t,un(a,t,n));try{is.style.setProperty(ms,hn(t,n)),is.style.setProperty(gs,(({r:e,g:t,b:a})=>`rgb(${e} ${t} ${a})`)(o))}catch(e){}}else gn(is)}else try{is.style.removeProperty(ms),is.style.removeProperty(gs)}catch(e){}try{document.body.classList.add(ss)}catch(e){}})(t))}function Sn(e){const t=mn(e.target);if(!t||t!==is)return;const a=e.relatedTarget;a&&t.contains(a)||vn()}function kn(){is&&xn()}function Cn(e){const t=mn(e.target);if(!t)return;if(fn(t))return;if(is&&t!==is)return;if(!is)return;xn();const a=Mn(is);((t,a)=>{if(t)try{const n=document.createElement("span");n.className=ps,n.setAttribute("aria-hidden","true");const o=yn(),i="index"===a?.22:.18,r=o?hn(o,i):`rgb(var(--abs-rgb-black) / ${i})`;n.style.setProperty("--abs-pulse-color",r),n.style.setProperty("--abs-pulse-ms","520ms"),n.style.setProperty("--abs-pulse-size",`var(${ds}, 24px)`),n.style.setProperty("--abs-pulse-mode",a),t.appendChild(n);const s=()=>{try{n.remove()}catch(e){}};n.addEventListener("animationend",s,{once:!0}),window.setTimeout(s,640)}catch(e){}})(is,a)}function Pn(e,t){e&&(e.textContent=(t??"")+"")}function Fn(e,t,a){if(e&&null!=a)try{e.setAttribute(t,a+"")}catch(n){}}async function Tn({timeoutMs:e=4e3,fontFaces:t=Ms}={}){const a=document.documentElement;if(a&&a.classList.add("fonts-loading"),!document.fonts||!document.fonts.ready)return a&&a.classList.remove("fonts-loading"),!1;let n;const o=new Promise(t=>{n=window.setTimeout(()=>t(!1),e)}),i=Promise.all(t.map(e=>document.fonts.load(e).catch(()=>null))).then(()=>document.fonts.ready).then(()=>!0).catch(()=>!1),r=await Promise.race([i,o]);return n&&window.clearTimeout(n),a&&a.classList.remove("fonts-loading"),r}function Dn(e){const t=document.documentElement;void 0!==e.topLogoWidthVw&&t.style.setProperty("--top-logo-width-vw",e.topLogoWidthVw+""),void 0!==e.noiseSizeBase&&t.style.setProperty("--noise-size-base",e.noiseSizeBase+"px"),void 0!==e.noiseSizeTop&&t.style.setProperty("--noise-size-top",e.noiseSizeTop+"px"),void 0!==e.noiseBackOpacity&&(t.style.setProperty("--noise-back-opacity",e.noiseBackOpacity+""),t.style.setProperty("--noise-back-opacity-light",e.noiseBackOpacity+"")),void 0!==e.noiseFrontOpacity&&(t.style.setProperty("--noise-front-opacity",e.noiseFrontOpacity+""),t.style.setProperty("--noise-front-opacity-light",e.noiseFrontOpacity+"")),void 0!==e.noiseBackOpacityDark&&t.style.setProperty("--noise-back-opacity-dark",e.noiseBackOpacityDark+""),void 0!==e.noiseFrontOpacityDark&&t.style.setProperty("--noise-front-opacity-dark",e.noiseFrontOpacityDark+"")}function Ln(){const e=window.innerWidth/window.innerHeight;return e>1.1?"landscape":.9>e?"portrait":"square"}function In(){const e=Ln();let t;document.documentElement.classList.remove("aspect-landscape","aspect-square","aspect-portrait"),document.documentElement.classList.add("aspect-"+e),window.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>{const t=Ln();t!==e&&(document.documentElement.classList.remove("aspect-landscape","aspect-square","aspect-portrait"),document.documentElement.classList.add("aspect-"+t))},150)})}function An(){const e=(()=>{const e=f();switch(Ln()){case"landscape":return e.entrancePerspectiveLandscape||1200;case"portrait":return e.entrancePerspectivePortrait||800;default:return e.entrancePerspectiveSquare||1e3}})();document.documentElement.style.setProperty("--entrance-perspective",e+"px")}function Kn(){const e=document.documentElement,t=f();let a=getComputedStyle(e).getPropertyValue("--wall-color").trim();a&&"#ffffff"!==a||(a=t.frameColor||"#0a0a0a"),e.dataset.originalWallColor=a,e.style.setProperty("--wall-color","#ffffff","important"),e.style.setProperty("background","#ffffff","important"),e.style.setProperty("background-color","#ffffff","important"),e.classList.add("entrance-pre-transition")}function On(){const e=f(),t=document.documentElement,a=e.entranceWallTransitionDelay||300,n=e.entranceWallTransitionDuration||800,o=document.getElementById("bravia-balls");if(!o)return console.warn("⚠️ #bravia-balls not found, falling back to simple transition"),void setTimeout(()=>{t.classList.remove("entrance-pre-transition"),t.classList.add("entrance-transitioning");const a=t.dataset.originalWallColor||e.frameColor||"#0a0a0a";t.style.setProperty("--wall-color",a),t.style.setProperty("background",a),t.style.setProperty("background-color",a),setTimeout(()=>{t.classList.remove("entrance-transitioning"),t.classList.add("entrance-complete"),t.style.removeProperty("--wall-color")},n)},a);const i=document.body.classList.contains("portfolio-page")?e.wallRadius&&"number"==typeof e.wallRadius&&e.wallRadius>0?e.wallRadius+"px":"42px":"0px",r=e.entranceWallInitialScale||1.1,s=e.entranceWallEasing||"cubic-bezier(0.16, 1, 0.3, 1)",l=o.style.transition;setTimeout(()=>{t.classList.remove("entrance-pre-transition"),t.classList.add("entrance-transitioning");const a=t.dataset.originalWallColor||e.frameColor||"#0a0a0a";if(t.style.setProperty("--wall-color",a),t.style.setProperty("background",a),t.style.setProperty("background-color",a),o.style.transition="none",o.style.transform=`scale(${r})`,o.style.transformOrigin="center center",o.style.borderRadius="0px",o.style.opacity="1",o.style.visibility="visible","function"==typeof o.animate){const e=o.animate([{transform:`scale(${r})`},{transform:"scale(1)"}],{duration:n,easing:s,fill:"forwards"}),a=o.animate([{borderRadius:"0px"},{borderRadius:i}],{duration:n,easing:s,fill:"forwards"});let c=!1,d=!1;const p=()=>{c&&d&&(o.style.transform="scale(1)",o.style.borderRadius=i,o.style.opacity="1",setTimeout(()=>{o.style.transition=l||"",t.classList.remove("entrance-transitioning"),t.classList.add("entrance-complete"),t.style.removeProperty("--wall-color")},50))};e.addEventListener("finish",()=>{c=!0,p()}),e.addEventListener("cancel",()=>{c=!0,p()}),a.addEventListener("finish",()=>{d=!0,p()}),a.addEventListener("cancel",()=>{d=!0,p()})}else requestAnimationFrame(()=>{o.style.transition=`transform ${n}ms ${s}, border-radius ${n}ms ${s}`,requestAnimationFrame(()=>{o.style.transform="scale(1)",o.style.borderRadius=i})}),setTimeout(()=>{o.style.transition=l||"",t.classList.remove("entrance-transitioning"),t.classList.add("entrance-complete"),t.style.removeProperty("--wall-color")},n+50)},a)}function En(e,t={}){const a=f();if(!e||"function"!=typeof e.animate)return e.style.opacity="1",null;const n=t.delay||0,o=t.duration||a.entranceElementDuration||200,i=t.scaleStart||a.entranceElementScaleStart||.95,r=t.scaleEnd||1,s=t.translateZStart||a.entranceElementTranslateZStart||-20,l=t.translateZEnd||0,c=t.easing||a.entranceElementEasing||"ease-out";e.style.opacity="0",e.style.transform=`translateZ(${s}px) scale(${i})`,e.style.willChange="opacity, transform",setTimeout(()=>{const t=e.animate([{opacity:0,transform:`translateZ(${s}px) scale(${i})`},{opacity:1,transform:`translateZ(${l}px) scale(${r})`}],{duration:o,easing:c,fill:"forwards"});return t.addEventListener("finish",()=>{e.style.opacity="1",e.style.transform=`translateZ(${l}px) scale(${r})`,e.style.willChange="auto"}),t.addEventListener("cancel",()=>{e.style.opacity="1",e.style.transform=`translateZ(${l}px) scale(${r})`,e.style.willChange="auto"}),t},n)}const Bn={PIT:"pit",PIT_THROWS:"pit-throws",FLIES:"flies",WEIGHTLESS:"weightless",WATER:"water",VORTEX:"vortex",PING_PONG:"ping-pong",MAGNETIC:"magnetic",BUBBLES:"bubbles",KALEIDOSCOPE:"kaleidoscope",KALEIDOSCOPE_1:"kaleidoscope-1",KALEIDOSCOPE_2:"kaleidoscope-2",KALEIDOSCOPE_3:"kaleidoscope-3",CRITTERS:"critters",ORBIT_3D:"orbit-3d",ORBIT_3D_2:"orbit-3d-2",NEURAL:"neural",LATTICE:"lattice",PARALLAX_LINEAR:"parallax-linear",PARALLAX_PERSPECTIVE:"parallax-perspective"},Rn=[Bn.PIT,Bn.FLIES,Bn.LATTICE,Bn.BUBBLES,Bn.PIT_THROWS,Bn.MAGNETIC,Bn.WATER,Bn.PING_PONG,Bn.NEURAL,Bn.VORTEX,Bn.ORBIT_3D,Bn.WEIGHTLESS,Bn.PARALLAX_LINEAR,Bn.CRITTERS,Bn.ORBIT_3D_2,Bn.PARALLAX_PERSPECTIVE,Bn.KALEIDOSCOPE_1,Bn.KALEIDOSCOPE_2,Bn.KALEIDOSCOPE_3,Bn.KALEIDOSCOPE],zn={[Bn.PIT]:"SOURCE MATERIAL",[Bn.FLIES]:"IDEA SPARK",[Bn.LATTICE]:"SYSTEM FRAME",[Bn.BUBBLES]:"NOISE SIGNAL",[Bn.PIT_THROWS]:"PROTOTYPE LOOP",[Bn.MAGNETIC]:"DESIGN FORCES",[Bn.WATER]:"USER FLOW",[Bn.PING_PONG]:"FEEDBACK CYCLE",[Bn.NEURAL]:"CONNECTION MAP",[Bn.VORTEX]:"EMERGENT ORDER",[Bn.ORBIT_3D]:"SYSTEM DYNAMICS",[Bn.WEIGHTLESS]:"OPEN SPACE",[Bn.PARALLAX_LINEAR]:"PERSPECTIVE SHIFT",[Bn.CRITTERS]:"BEHAVIOR MODEL",[Bn.ORBIT_3D_2]:"EDGE CASES",[Bn.PARALLAX_PERSPECTIVE]:"CONTEXT FIELD",[Bn.KALEIDOSCOPE_1]:"VOCAB SEED",[Bn.KALEIDOSCOPE_2]:"VOCAB FLOW",[Bn.KALEIDOSCOPE_3]:"VOCAB BLOOM",[Bn.KALEIDOSCOPE]:"VISUAL LANGUAGE"},Wn={DPR:Math.max(1,Math.min(2,window.devicePixelRatio||1)),OFFSCREEN_MOUSE:-1e9,MIN_DISTANCE_EPSILON:1e-6,ACCUMULATOR_RESET_THRESHOLD:3,MAX_PHYSICS_STEPS:4,SPIN_DAMP_PER_S:3,SPIN_GAIN:.25,SPIN_GAIN_TANGENT:.18,ROLL_FRICTION_PER_S:2.5,SQUASH_MAX_BASE:.2,SQUASH_DECAY_PER_S:18,WALL_REST_VEL_THRESHOLD:70,GROUND_COUPLING_PER_S:12,SLEEP_VELOCITY_THRESHOLD:12,SLEEP_ANGULAR_THRESHOLD:.18,TIME_TO_SLEEP:.25,PHYSICS_DT:1/120},Vn={rubber:{wallWobbleMaxDeform:45,wallWobbleStiffness:2200,wallWobbleDamping:35,wallWobbleImpactThreshold:140,wallWobbleSettlingSpeed:75,wallWobbleSigma:2,wallWobbleCornerClamp:.6},pudding:{wallWobbleMaxDeform:70,wallWobbleStiffness:520,wallWobbleDamping:78,wallWobbleImpactThreshold:60,wallWobbleSettlingSpeed:92,wallWobbleSigma:5,wallWobbleCornerClamp:.25},trampoline:{wallWobbleMaxDeform:55,wallWobbleStiffness:2800,wallWobbleDamping:15,wallWobbleImpactThreshold:100,wallWobbleSettlingSpeed:40,wallWobbleSigma:2.5,wallWobbleCornerClamp:.5},jelly:{wallWobbleMaxDeform:80,wallWobbleStiffness:800,wallWobbleDamping:12,wallWobbleImpactThreshold:80,wallWobbleSettlingSpeed:30,wallWobbleSigma:3.5,wallWobbleCornerClamp:.4},stiff:{wallWobbleMaxDeform:20,wallWobbleStiffness:3e3,wallWobbleDamping:60,wallWobbleImpactThreshold:180,wallWobbleSettlingSpeed:90,wallWobbleSigma:1.5,wallWobbleCornerClamp:.8}},$n={default:{label:"Default (Full View Grid)",parallaxLinearDotSizeMul:1.8,sizeVariationParallaxLinear:0,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:7,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:50,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:260},dense:{label:"Dense (More Vertices)",parallaxLinearDotSizeMul:1.6,sizeVariationParallaxLinear:.1,parallaxLinearGridX:18,parallaxLinearGridY:13,parallaxLinearGridZ:9,parallaxLinearSpanX:1.25,parallaxLinearSpanY:1.25,parallaxLinearZNear:45,parallaxLinearZFar:1e3,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:240},deep:{label:"Deep Field (Stronger Depth)",parallaxLinearDotSizeMul:1.7,sizeVariationParallaxLinear:.08,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:10,parallaxLinearSpanX:1.45,parallaxLinearSpanY:1.45,parallaxLinearZNear:30,parallaxLinearZFar:1500,parallaxLinearFocalLength:520,parallaxLinearParallaxStrength:320},calm:{label:"Calm (Slow Camera)",parallaxLinearDotSizeMul:1.8,sizeVariationParallaxLinear:.05,parallaxLinearGridX:12,parallaxLinearGridY:9,parallaxLinearGridZ:6,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:60,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:160},minimal:{label:"Minimal (Big Dots)",parallaxLinearDotSizeMul:2.4,sizeVariationParallaxLinear:.15,parallaxLinearGridX:10,parallaxLinearGridY:7,parallaxLinearGridZ:4,parallaxLinearSpanX:1.6,parallaxLinearSpanY:1.6,parallaxLinearZNear:70,parallaxLinearZFar:800,parallaxLinearFocalLength:380,parallaxLinearParallaxStrength:220}},Nn={default:{label:"Default (Nebula Grid)",parallaxPerspectiveDotSizeMul:1.8,sizeVariationParallaxPerspective:0,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:8,parallaxPerspectiveSpanX:1.45,parallaxPerspectiveSpanY:1.45,parallaxPerspectiveZNear:40,parallaxPerspectiveZFar:1200,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:280,parallaxPerspectiveRandomness:.6},calm:{label:"Calm Mist",parallaxPerspectiveDotSizeMul:1.9,sizeVariationParallaxPerspective:.08,parallaxPerspectiveGridX:14,parallaxPerspectiveGridY:10,parallaxPerspectiveGridZ:6,parallaxPerspectiveSpanX:1.4,parallaxPerspectiveSpanY:1.4,parallaxPerspectiveZNear:60,parallaxPerspectiveZFar:900,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:180,parallaxPerspectiveRandomness:.25},deep:{label:"Deep Space",parallaxPerspectiveDotSizeMul:1.6,sizeVariationParallaxPerspective:.06,parallaxPerspectiveGridX:18,parallaxPerspectiveGridY:13,parallaxPerspectiveGridZ:12,parallaxPerspectiveSpanX:1.55,parallaxPerspectiveSpanY:1.55,parallaxPerspectiveZNear:30,parallaxPerspectiveZFar:2200,parallaxPerspectiveFocalLength:520,parallaxPerspectiveParallaxStrength:340,parallaxPerspectiveRandomness:.55},wild:{label:"Wild Nebula",parallaxPerspectiveDotSizeMul:1.7,sizeVariationParallaxPerspective:.18,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:10,parallaxPerspectiveSpanX:1.6,parallaxPerspectiveSpanY:1.6,parallaxPerspectiveZNear:20,parallaxPerspectiveZFar:1600,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:360,parallaxPerspectiveRandomness:.9},minimal:{label:"Minimal Stars",parallaxPerspectiveDotSizeMul:2.6,sizeVariationParallaxPerspective:.22,parallaxPerspectiveGridX:10,parallaxPerspectiveGridY:7,parallaxPerspectiveGridZ:5,parallaxPerspectiveSpanX:1.75,parallaxPerspectiveSpanY:1.75,parallaxPerspectiveZNear:70,parallaxPerspectiveZFar:1100,parallaxPerspectiveFocalLength:380,parallaxPerspectiveParallaxStrength:220,parallaxPerspectiveRandomness:.35}};let _n=Math.max(1,Math.min(2,window.devicePixelRatio||1));const Gn={config:{},currentMode:Bn.CRITTERS,warmupFramesRemaining:0,balls:[],canvas:null,ctx:null,container:null,mouseX:Wn.OFFSCREEN_MOUSE,mouseY:Wn.OFFSCREEN_MOUSE,mouseInCanvas:!1,lastPointerMoveMs:0,lastPointerMoveX:Wn.OFFSCREEN_MOUSE,lastPointerMoveY:Wn.OFFSCREEN_MOUSE,GE:1960,G:0,gravityScale:1,gravityMultiplier:0,gravityMultiplierPit:1.1,pitThrowSpeed:650,pitThrowSpeedJitter:.22,pitThrowAngleJitter:.16,pitThrowBatchSize:18,pitThrowIntervalMs:70,pitThrowColorPauseMs:180,pitThrowTargetYFrac:.36,pitThrowInletInset:.06,pitThrowCrossBias:.12,pitThrowSpawnSpread:.02,pitThrowAimJitter:.04,pitThrowPairChance:.35,pitThrowPairStaggerMs:18,pitThrowSpeedVar:.18,pitThrowSpreadVar:.25,REST:.31,FRICTION:.011,ballMassKg:240,MASS_BASELINE_KG:240,MASS_REST_EXP:.15,MASS_GRAVITY_EXP:.35,get DPR(){return _n},sizeScale:1.2,sizeVariationGlobalMul:1,sizeVariationCap:.12,sizeVariationPit:0,sizeVariationPitThrows:0,sizeVariationFlies:0,sizeVariationWeightless:0,sizeVariationWater:0,sizeVariationVortex:.2,sizeVariationPingPong:0,sizeVariationMagnetic:0,sizeVariationBubbles:.2,sizeVariationKaleidoscope:0,sizeVariationOrbit3d:0,sizeVariationCritters:.2,sizeVariationNeural:0,sizeVariationLattice:0,sizeVariationParallaxLinear:0,sizeVariationParallaxPerspective:0,pitWarmupFrames:10,pitThrowsWarmupFrames:10,fliesWarmupFrames:10,weightlessWarmupFrames:10,waterWarmupFrames:10,vortexWarmupFrames:10,pingPongWarmupFrames:10,magneticWarmupFrames:10,bubblesWarmupFrames:10,kaleidoscopeWarmupFrames:10,kaleidoscope1WarmupFrames:10,kaleidoscope2WarmupFrames:10,kaleidoscope3WarmupFrames:10,orbit3dWarmupFrames:10,orbit3d2WarmupFrames:10,crittersWarmupFrames:10,neuralWarmupFrames:10,latticeWarmupFrames:10,parallaxLinearWarmupFrames:10,parallaxPerspectiveWarmupFrames:10,sizeVariation:0,responsiveScale:1,responsiveScaleMobile:.75,isMobile:!1,isMobileViewport:!1,mobileObjectReductionFactor:.7,R_MIN_BASE:6,R_MAX_BASE:24,R_MED:0,R_MIN:0,R_MAX:0,cursorSize:1,cursorColorMode:"auto",cursorColorIndex:5,cursorColorHex:"#ff4013",cursorColorLumaMax:.62,cursorColorAllowIndices:[],cursorColorDenyIndices:[],mouseTrailEnabled:!0,mouseTrailLength:18,mouseTrailSize:1.3,mouseTrailFadeMs:220,mouseTrailOpacity:.35,ballSoftness:20,ballSpacing:.08,sleepVelocityThreshold:12,sleepAngularThreshold:.18,timeToSleep:.25,physicsCollisionIterations:10,physicsSkipSleepingCollisions:!0,physicsSleepThreshold:12,physicsSleepTime:.25,physicsSkipSleepingSteps:!0,physicsSpatialGridOptimization:!0,wallPhysicsSamples:48,wallPhysicsSkipInactive:!0,wallPhysicsUpdateHz:30,wallPhysicsMaxSubstepHz:60,wallPhysicsInterpolation:!0,wallPhysicsAdaptiveSamples:!0,wallPhysicsMinSamples:24,wallVisualDeformMul:1,wallRenderDecimation:2,critterCount:90,critterSpeed:680,critterMaxSpeed:1400,critterStepHz:5,critterStepSharpness:2.4,critterTurnNoise:2.2,critterTurnDamp:10,critterTurnSeek:10,critterAvoidRadius:90,critterAvoidForce:9500,critterEdgeAvoid:1,critterMousePull:1,critterMouseRadiusVw:30,critterRestitution:.18,critterFriction:.018,cornerRadius:42,layoutViewportWidthPx:0,containerBorderVw:0,simulationPaddingVw:0,contentPaddingVw:0,contentPaddingHorizontalRatio:1,mobileWallThicknessXFactor:1.4,mobileEdgeLabelsVisible:!0,wallRadiusVw:0,wallThicknessVw:0,noiseBackOpacity:.015,noiseFrontOpacity:.045,noiseBackOpacityDark:.06,noiseFrontOpacityDark:.08,noiseEnabled:!0,noiseSeed:1337,noiseTextureSize:256,noiseDistribution:"gaussian",noiseMonochrome:!0,noiseChroma:.35,noiseMotion:"jitter",noiseMotionAmount:1.2,noiseSpeedBackMs:1400,noiseSpeedFrontMs:900,noiseFlicker:.08,noiseFlickerSpeedMs:180,noiseBlurPx:0,noiseContrast:1.2,noiseBrightness:1.15,noiseSaturation:1,noiseHue:0,noiseSizeBase:65,noiseSizeTop:85,noiseTopOpacity:0,detailNoiseOpacity:1,layoutMinContentPaddingPx:16,layoutMinWallRadiusPx:28,wallInset:3,vortexSwirlStrength:420,vortexRadialPull:180,vortexBallCount:180,vortexSpeedMultiplier:1,vortexRadius:0,vortexFalloffCurve:1,vortexRotationDirection:1,vortexCoreStrength:1,vortexAccelerationZone:0,vortexOutwardPush:0,vortexFalloffRate:.0015,magneticBallCount:180,magneticStrength:65e3,magneticMaxVelocity:2800,magneticExplosionInterval:5,bubblesSpawnRate:8,bubblesRiseSpeed:150,bubblesWobble:40,bubblesMaxCount:200,bubblesDeflectRadius:0,pingPongBallCount:35,pingPongSpeed:800,pingPongCursorRadius:0,currentColors:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],currentTemplate:"industrialTeal",colorDistribution:[{label:"AI Integration",colorIndex:0,weight:30},{label:"UI/UX Design",colorIndex:4,weight:18},{label:"Creative Strategy",colorIndex:3,weight:15},{label:"Frontend Development",colorIndex:2,weight:12},{label:"Brand Identity",colorIndex:5,weight:10},{label:"3D Design",colorIndex:6,weight:10},{label:"Art Direction",colorIndex:7,weight:5}],fliesBallCount:60,attractionPower:5e3,orbitRadius:180,swarmSpeed:.4,fliesSeparation:15e3,weightlessCount:80,weightlessInitialSpeed:250,weightlessBounce:.97,weightlessRepelRadius:220,weightlessRepelPower:22e4,weightlessRepelSoft:2.2,kaleidoscopeBallCount:23,kaleidoscopeWedges:12,kaleidoscopeMirror:1,kaleidoscopeSpeed:1,kaleidoscopeDotSizeVh:.95,kaleidoscopeDotAreaMul:.7,kaleidoscopeSpawnAreaMul:1,kaleidoscopeSizeVariance:.3,kaleidoscope1BallCount:18,kaleidoscope1Wedges:8,kaleidoscope1Speed:.8,kaleidoscope1DotSizeVh:.95,kaleidoscope1DotAreaMul:.7,kaleidoscope1SpawnAreaMul:1,kaleidoscope1SizeVariance:.3,kaleidoscope2BallCount:36,kaleidoscope2Wedges:8,kaleidoscope2Speed:1.15,kaleidoscope2DotSizeVh:.95,kaleidoscope2DotAreaMul:.7,kaleidoscope2SpawnAreaMul:1,kaleidoscope2SizeVariance:.3,kaleidoscope3BallCount:54,kaleidoscope3Wedges:8,kaleidoscope3Speed:1.55,kaleidoscope3DotSizeVh:.95,kaleidoscope3DotAreaMul:.7,kaleidoscope3SpawnAreaMul:1,kaleidoscope3SizeVariance:.3,orbit3dPreset:"serene",orbit3dMoonCount:80,orbit3dGravity:5e3,orbit3dMoonMass:1,orbit3dVelocityMult:150,orbit3dTargetOrbit:12,orbit3dMinOrbit:3,orbit3dMaxOrbit:3,orbit3dDepthScale:.8,orbit3dDamping:.02,orbit3d2MoonCount:60,orbit3d2Gravity:3e3,orbit3d2VelocityMult:200,orbit3d2MinOrbit:5,orbit3d2MaxOrbit:30,orbit3d2DepthScale:.5,orbit3d2Damping:.98,orbit3d2MoonMass:1,orbit3d2MaxSpeed:800,neuralBallCount:80,neuralLinkDistanceVw:14,neuralLineOpacity:.22,neuralWanderStrength:420,neuralMaxLinksPerBall:4,neuralDamping:.985,latticeBallCount:90,latticeSpacingVw:8.5,latticeStiffness:2.2,latticeDamping:.92,latticeDisruptRadius:600,latticeDisruptPower:25,latticeMeshWaveStrength:12,latticeMeshWaveSpeed:.8,latticeAlignment:"center",parallaxLinearDotCount:95,parallaxLinearRowPattern:"thirds",parallaxLinearSpacingPattern:"even",parallaxLinearFarPct:.42,parallaxLinearMidPct:.32,parallaxLinearFarSpeed:.15,parallaxLinearMidSpeed:.5,parallaxLinearNearSpeed:1,parallaxLinearFollowStrength:16,parallaxLinearDamping:12,parallaxPerspectiveDotCount:240,parallaxPerspectiveDepthMul:1.6,parallaxPerspectiveFocalLength:400,parallaxPerspectiveFollowStrength:16,parallaxPerspectiveDamping:12,parallaxPerspectiveZ1:1200,parallaxPerspectiveZ2:700,parallaxPerspectiveZ3:350,parallaxPerspectiveZ4:120,parallaxPerspectiveZ5:35,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:7,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:50,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:260,parallaxLinearDotSizeMul:1.8,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:8,parallaxPerspectiveSpanX:1.45,parallaxPerspectiveSpanY:1.45,parallaxPerspectiveZNear:40,parallaxPerspectiveZFar:1200,parallaxPerspectiveParallaxStrength:280,parallaxPerspectiveRandomness:.6,parallaxPerspectiveDotSizeMul:1.8,waterBallCount:300,waterDrag:.015,waterRippleSpeed:300,waterRippleStrength:18e3,waterDriftStrength:40,waterInitialVelocity:200,vortexDrag:.005,pingPongVerticalDamp:.995,magneticDamping:.98,repelRadius:120,repelPower:274e3,repelSoft:3.4,repellerEnabled:!1,cursorInfluenceRadiusVw:14,cursorInfluenceRadiusPx:140,emitterTimer:0,autoDarkModeEnabled:!0,isDarkMode:!1,chromeHarmonyMode:"site",autoDarkNightStartHour:18,autoDarkNightEndHour:6,clickCycleEnabled:!0,sceneImpactEnabled:!0,sceneImpactMul:.005,sceneImpactMobileMulFactor:1,sceneImpactLogoCompMul:1.8,sceneImpactOvershoot:.22,sceneImpactAnticipation:0,sceneImpactPressMs:0,sceneImpactReleaseMs:620,sceneChangeSoundEnabled:!0,sceneChangeSoundIntensity:.35,sceneChangeSoundRadius:18,brandLogoImpactMul:.014,brandLogoSquashMul:1,brandLogoOvershoot:.22,brandLogoAnticipation:0,brandLogoTiltDeg:0,brandLogoSkewDeg:0,brandLogoPressMs:75,brandLogoHoldMs:55,brandLogoReleaseMs:220,containerBorder:20,containerBorderX:20,simulationPadding:0,contentPadding:40,contentPaddingX:40,contentPaddingY:40,bgLight:"#f5f5f5",bgDark:"#0a0a0a",frameColor:"#0a0a0a",frameColorLight:"#0a0a0a",frameColorDark:"#0a0a0a",textColorLight:"#161616",textColorLightMuted:"#2f2f2f",textColorDark:"#7a8fa3",textColorDarkMuted:"#9db0c4",edgeLabelColorLight:"#2f2f2f",edgeLabelColorDark:"#8a9ba8",edgeLabelInsetAdjustPx:0,linkHoverColor:"#ff4013",logoColorLight:"#161616",logoColorDark:"#b8c5d3",portfolioLogoColorLight:"#161616",portfolioLogoColorDark:"#374862",topLogoWidthVw:35,homeMainLinksBelowLogoPx:40,wallThickness:12,wallRadius:42,wallInset:3,wallPreset:"pudding",wallSoftness:50,wallBounciness:50,wallWobbleMaxDeform:70,wallWobbleStiffness:420,wallWobbleDamping:92,wallWobbleSigma:5.5,wallWobbleCornerClamp:.25,wallWobbleMaxVel:620,wallWobbleMaxImpulse:160,wallWobbleMaxEnergyPerStep:2e4,wallWobbleImpactThreshold:60,wallWobbleSettlingSpeed:94,wallDeformPhysicsPrecision:50,gateOverlayEnabled:!0,gateOverlayOpacity:.01,gateOverlayBlurPx:16,gateOverlayTransitionMs:800,gateOverlayTransitionOutMs:600,gateOverlayContentDelayMs:200,gateDepthScale:.96,gateDepthTranslateY:8,logoOpacityInactive:1,logoOpacityActive:.2,logoBlurInactive:0,logoBlurActive:12,entranceEnabled:!0,entranceWallTransitionDelay:300,entranceWallTransitionDuration:800,entranceWallInitialScale:1.1,entranceWallEasing:"cubic-bezier(0.16, 1, 0.3, 1)",entranceElementDuration:200,entranceElementScaleStart:.95,entranceElementTranslateZStart:-20,entranceElementEasing:"ease-out",entrancePerspectiveLandscape:1200,entrancePerspectiveSquare:1e3,entrancePerspectivePortrait:800,linkTextPadding:30,linkIconPadding:24,linkColorInfluence:1,linkImpactScale:.95,linkImpactBlur:10,linkImpactDuration:150,getSquashMax(){return 0===this.ballSoftness?0:Wn.SQUASH_MAX_BASE*(this.ballSoftness/40)},getCanvasCornerRadius(){return Math.max(0,this.cornerRadius-this.simulationPadding)}};var Hn=Object.freeze({__proto__:null,applyLayoutCSSVars:u,applyLayoutFromVwToPx:p,clearBalls:M,detectResponsiveScale:y,getBalls:()=>Gn.balls,getConfig:()=>Gn.config,getEffectiveDPR:()=>_n,getGlobals:f,getLayoutViewportWidthPx:l,getMobileAdjustedCount:m,getState:()=>Gn,initState:h,pxToVw:c,setCanvas:g,setEffectiveDPR:i,setMode:b,updateBallSizes:v,vwToPx:d});const jn=.6,Zn={label:"Industrial Teal",light:["#9cb0a9","#b1c1bf","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#5b8378","#345d51","#8a928a","#00e6c3","#d5d5d5","#ff6b47","#5b9aff","#ffb84d"]},Yn=1.2,Xn={industrialTeal:Zn,industrialRust:{label:"Industrial Rust",light:T(Zn.light,D(Zn.light,["#b0a49b","#c6bbb4","#ffffff","#8B4513","#000000","#00695c","#FF8C42","#D4A574"],Yn),jn),dark:T(Zn.dark,D(Zn.dark,["#81695f","#5a4238","#8a8886","#FF6B35","#d5d5d5","#00e6c3","#FFA366","#E8C4A0"],Yn),jn)},industrialSlate:{label:"Industrial Slate",light:T(Zn.light,D(Zn.light,["#a5a8ae","#bcbec0","#ffffff","#4A5568","#000000","#00A8CC","#718096","#2D3748"],Yn),jn),dark:T(Zn.dark,D(Zn.dark,["#6d7880","#46525a","#86888b","#90CDF4","#d5d5d5","#00D4FF","#A0AEC0","#4A5568"],Yn),jn)},industrialAmber:{label:"Industrial Amber",light:T(Zn.light,D(Zn.light,["#bcab96","#d1c3b2","#ffffff","#D97706","#000000","#00695c","#F59E0B","#FCD34D"],Yn),jn),dark:T(Zn.dark,D(Zn.dark,["#80755a","#594e33","#8a8883","#FBBF24","#d5d5d5","#00e6c3","#FCD34D","#FDE68A"],Yn),jn)},industrialViolet:{label:"Industrial Violet",light:T(Zn.light,D(Zn.light,["#aba4bb","#c0bbcd","#ffffff","#6B46C1","#000000","#00A8CC","#9333EA","#A78BFA"],Yn),jn),dark:T(Zn.dark,D(Zn.dark,["#776d85","#50465d","#8a888f","#C084FC","#d5d5d5","#00D4FF","#A78BFA","#C4B5FD"],Yn),jn)},industrialForest:{label:"Industrial Forest",light:T(Zn.light,D(Zn.light,["#9daba0","#b4c0b8","#ffffff","#166534","#000000","#00695c","#22C55E","#4ADE80"],Yn),jn),dark:T(Zn.dark,D(Zn.dark,["#627a68","#3c5441","#868883","#4ADE80","#d5d5d5","#00e6c3","#86EFAC","#BBF7D0"],Yn),jn)},industrialSteel:{label:"Industrial Steel",light:T(Zn.light,D(Zn.light,["#a4a8ad","#bbbdc0","#ffffff","#475569","#000000","#0EA5E9","#64748B","#334155"],Yn),jn),dark:T(Zn.dark,D(Zn.dark,["#6d7177","#474b51","#86888b","#94A3B8","#d5d5d5","#38BDF8","#94A3B8","#CBD5E1"],Yn),jn)}},qn=["industrialTeal","industrialRust","industrialSlate","industrialAmber","industrialViolet","industrialForest","industrialSteel"],Un="abs_palette_chapter",Jn=[.5,.25,.12,.06,.03,.02,.01,.01],Qn=[3,5,6,7];var eo=Object.freeze({__proto__:null,COLOR_TEMPLATES:Xn,PALETTE_CHAPTER_ORDER:qn,applyColorTemplate:N,applyCursorColorIndex:z,getCurrentPalette:V,getCursorCandidateIndices:R,maybeAutoPickCursorColor:W,pickRandomColor:$,populateColorSelect:_,rotatePaletteChapterOnReload:G});const to={attackTime:.005,decayTime:.075,harmonicGain:0,filterBaseFreq:580,filterVelocityRange:400,filterQ:.18,filterMinHz:350,filterMaxHz:2800,pitchMinHz:145,pitchMaxHz:280,pitchCurve:1,reverbDecay:.14,reverbWetMix:.08,reverbHighDamp:.8,minGain:.008,maxGain:.09,masterGain:.28,voiceGainMax:.14,minTimeBetweenSounds:.012,maxPan:.15,noiseTransientEnabled:!0,noiseTransientGain:.045,noiseTransientDecay:.008,noiseTransientFilterMin:500,noiseTransientFilterMax:1800,noiseTransientQ:1.2,sparkleGain:0,sparkleRatioMin:2.3,sparkleRatioMax:4.1,sparkleDecayMul:.65,variancePitch:.06,varianceDecay:.2,varianceGain:.15,varianceFilter:.18,varianceNoise:.25,velocityNoiseScale:1.8,velocityBrightnessScale:1.4,velocityDecayScale:.65,intensityExponent:1.5,toneSafetyMinHz:130,toneSafetyMaxHz:480,toneSafetyExponent:2.2,toneSafetyHighGainAtten:.25,toneSafetyLowGainAtten:.06,toneSafetyHighBrightAtten:.45,collisionMinImpact:.58,highShelfFreq:2200,highShelfGain:-6};let ao=null;const no={organicImpact:{label:"Organic Impact",description:"Warm, natural thuds with intensity dynamics",...to},glassMarbles:{label:"Glass Marbles",description:"Clear, glassy impacts with more presence",...to,pitchMinHz:260,pitchMaxHz:780,pitchCurve:1.05,filterBaseFreq:850,filterVelocityRange:600,noiseTransientGain:.065,noiseTransientFilterMin:650,noiseTransientFilterMax:2200,noiseTransientQ:1.6,decayTime:.055,intensityExponent:1.3,highShelfGain:-4.5},crystalPebbles:{label:"Crystal Pebbles ★",description:"Crisp, close, soothing micro-chimes (non-repetitive)",...to,pitchMinHz:420,pitchMaxHz:1600,pitchCurve:1.15,filterBaseFreq:1300,filterVelocityRange:1700,filterQ:.22,filterMaxHz:6200,decayTime:.04,intensityExponent:1.65,collisionMinImpact:.7,minTimeBetweenSounds:.018,noiseTransientGain:.02,noiseTransientDecay:.006,noiseTransientFilterMin:1200,noiseTransientFilterMax:7e3,noiseTransientQ:2.8,sparkleGain:.12,sparkleRatioMin:2.6,sparkleRatioMax:4.4,sparkleDecayMul:.55,reverbWetMix:.04,reverbDecay:.1,highShelfGain:-4,masterGain:.24},woodenBeads:{label:"Wooden Beads ★",description:"Ultra-soft, muted thuds (recommended)",...to,filterBaseFreq:420,filterVelocityRange:200,noiseTransientGain:.025,noiseTransientFilterMin:380,noiseTransientFilterMax:1400,noiseTransientQ:1.1,decayTime:.095,intensityExponent:1.7,collisionMinImpact:.62,highShelfGain:-7.5,reverbWetMix:.12},rubberBalls:{label:"Rubber Balls",description:"Bouncy, playful with longer decay",...to,pitchMinHz:160,pitchMaxHz:360,filterBaseFreq:520,filterVelocityRange:350,noiseTransientGain:.035,noiseTransientFilterMin:450,noiseTransientFilterMax:1600,noiseTransientQ:1.2,decayTime:.12,intensityExponent:1.4,reverbWetMix:.14,highShelfGain:-5},metallicClick:{label:"Metallic Click",description:"Crisp, percussive impacts",...to,pitchMinHz:220,pitchMaxHz:620,pitchCurve:1.1,filterBaseFreq:720,filterVelocityRange:550,noiseTransientGain:.08,noiseTransientFilterMin:700,noiseTransientFilterMax:2400,noiseTransientQ:1.8,noiseTransientDecay:.006,decayTime:.045,intensityExponent:1.2,highShelfGain:-3.5,collisionMinImpact:.5}};let oo="crystalPebbles";ao={...no[oo]},delete ao.label,delete ao.description;let io=null,ro=null,so=null,lo=null,co=null,po=null,uo=null,ho=null,fo=null,mo=!1,go=!1;const bo="bravia-balls:sound-state",Mo=8;let yo=[],vo=0,xo=new Map,wo=!1,So=null,ko=!1;const Co=new Map,Po=[],Fo=[],To=96,Do=1/30,Lo=.25;let Io=null;class Ao{constructor(e){const t=Math.max(8,Math.round(e||To));this.n=t,this.deformations=new Float32Array(t),this.velocities=new Float32Array(t),this.pressure=new Float32Array(t),this.renderDeformations=new Float32Array(t),this.H=0,this.Z=0,this.Y=0,this.X=0,this.q=0,this.U=0,this.J=0,this.ee=0,this.te=0,this.ae=0,this.ne=0,this.oe=0,this.ie=0,this.re=0,this.se=0,this.baseX=new Float32Array(t),this.baseY=new Float32Array(t),this.normX=new Float32Array(t),this.normY=new Float32Array(t),this.cornerMask=new Float32Array(t),this.le=0,this.ce=0,this.de=!1,this.pe=0}ensureSampleCount(e){const t=Math.max(8,Math.round(+e||To));if(t===this.n)return;const a=this.n,n=this.deformations,o=this.velocities,i=this.pressure,r=new Float32Array(t),s=new Float32Array(t),l=new Float32Array(t),c=new Float32Array(t);if(a>0){let e=0,c=0;for(let d=0;t>d;d++){const p=d/t*a,u=Math.floor(p)%a,h=p-u,f=(u+1)%a,m=(1-h)*n[u]+h*n[f],g=(1-h)*o[u]+h*o[f],b=(1-h)*i[u]+h*i[f];r[d]=m,s[d]=g,l[d]=b,m>e&&(e=m);const M=Math.abs(g);M>c&&(c=M)}this.le=e,this.ce=c,this.de=e>0||c>0}else this.le=0,this.ce=0,this.de=!1;this.n=t,this.deformations=r,this.velocities=s,this.pressure=l,this.renderDeformations=c,this.baseX=new Float32Array(t),this.baseY=new Float32Array(t),this.normX=new Float32Array(t),this.normY=new Float32Array(t),this.cornerMask=new Float32Array(t),this.H=0,this.Z=0,this.Y=0,this.X=0,this.q=0,this.U=0,this.J=0,this.ee=0,this.te=0,this.ae=0,this.ne=0,this.oe=0,this.ie=0,this.re=0,this.se=0}clearPressure(){this.pressure.fill(0)}reset(){this.deformations.fill(0),this.velocities.fill(0),this.pressure.fill(0),this.renderDeformations.fill(0),this.le=0,this.ce=0,this.de=!1,this.pe=0}hasDeformation(){return this.le>2}ensureGeometry(e,t,a){const n=Math.max(1,0|e),o=Math.max(1,0|t),i=Math.max(0,Math.min(+a||0,.5*Math.min(n,o)));if(n===this.H&&o===this.Z&&.001>Math.abs(i-this.Y))return;if(this.H=n,this.Z=o,this.Y=i,0>=i){const e=n,t=o,a=2*(e+t);this.X=e,this.q=t,this.U=0,this.J=a,this.ae=0,this.te=e/2,this.ee=e/2+t,this.ne=e/2+t+e,this.oe=0,this.ie=0,this.re=0,this.se=0;for(let i=0;this.n>i;i++){const r=(i/this.n*a+e/2)%a;if(e/2>r)this.baseX[i]=n/2+r,this.baseY[i]=o,this.normX[i]=0,this.normY[i]=-1;else if(e/2+t>r){const t=r-e/2;this.baseX[i]=n,this.baseY[i]=t,this.normX[i]=-1,this.normY[i]=0}else if(e/2+t+e>r)this.baseX[i]=n-(r-(e/2+t)),this.baseY[i]=0,this.normX[i]=0,this.normY[i]=1;else if(e/2+t+e+t>r){const a=r-(e/2+t+e);this.baseX[i]=0,this.baseY[i]=o-a,this.normX[i]=1,this.normY[i]=0}else this.baseX[i]=r-(e/2+t+e+t),this.baseY[i]=o,this.normX[i]=0,this.normY[i]=-1;this.cornerMask[i]=0}return}const r=Math.max(0,n-2*i),s=Math.max(0,o-2*i),l=.5*Math.PI*i,c=2*(r+s)+4*l;this.X=r,this.q=s,this.U=l,this.J=c,this.ae=0,this.se=r/2,this.te=r/2+l,this.ie=r/2+l+s,this.ee=r/2+l+s+l,this.oe=r/2+l+s+l+r,this.ne=r/2+l+s+l+r+l,this.re=r/2+l+s+l+r+l+s;const d=n,p=o,u=i,h=this.n,f=(e,t,a,n,o,i)=>{const r=n+(o-n)*i,s=Math.cos(r),l=Math.sin(r);return{x:e+a*s,y:t+a*l,nx:-s,ny:-l}},m=r/2,g=m+l,b=g+s,M=b+l,y=M+r,v=y+l,x=v+s,w=x+l,S=u+r/2,k=d-u,C=u;for(let P=0;h>P;P++){let e=(P/h*c+r/2)%c,t=0,a=0,n=0,o=0,i=0;if(m>e)t=S+e,a=p,n=0,o=-1;else if(g>e){const r=f(d-u,p-u,u,Math.PI/2,0,(e-m)/l);t=r.x,a=r.y,n=r.nx,o=r.ny,i=1}else if(b>e)t=d,a=p-u-(e-g),n=-1,o=0;else if(M>e){const r=f(d-u,u,u,0,-Math.PI/2,(e-b)/l);t=r.x,a=r.y,n=r.nx,o=r.ny,i=1}else if(y>e)t=k-(e-M),a=0,n=0,o=1;else if(v>e){const r=f(u,u,u,3*Math.PI/2,Math.PI,(e-y)/l);t=r.x,a=r.y,n=r.nx,o=r.ny,i=1}else if(x>e)t=0,a=u+(e-v),n=1,o=0;else if(w>e){const r=f(u,p-u,u,Math.PI,Math.PI/2,(e-x)/l);t=r.x,a=r.y,n=r.nx,o=r.ny,i=1}else t=C+(e-w),a=p,n=0,o=-1;this.baseX[P]=t,this.baseY[P]=a,this.normX[P]=n,this.normY[P]=o,this.cornerMask[P]=i?1:0}}getDeformationAtPoint(e,t){const a=this.H,n=this.Z,o=this.n;if(0===o||0>=a||0>=n)return 0;const i=a,r=n,s=this.Y,l=e>i-s&&s>t,c=s>e&&t>r-s,d=e>i-s&&t>r-s;let p=0;if(s>e&&s>t){const a=e-s,n=t-s;if(Math.sqrt(a*a+n*n)>0){const e=this.oe/this.J,t=(this.oe+this.U)/this.J;p=e+Math.max(0,Math.min(1,(Math.atan2(n,a)-Math.PI)/(Math.PI/2)))*(t-e)}else p=this.oe/this.J}else if(l){const a=e-(i-s),n=t-s;if(Math.sqrt(a*a+n*n)>0){const e=this.ie/this.J,t=(this.ie+this.U)/this.J;p=e+Math.max(0,Math.min(1,(Math.atan2(n,a)+Math.PI/2)/(Math.PI/2)))*(t-e)}else p=this.ie/this.J}else if(d){const a=e-(i-s),n=t-(r-s);if(Math.sqrt(a*a+n*n)>0){const e=this.se/this.J,t=(this.se+this.U)/this.J;p=e+Math.max(0,Math.min(1,Math.atan2(n,a)/(Math.PI/2)))*(t-e)}else p=this.se/this.J}else if(c){const a=e-s,n=t-(r-s);if(Math.sqrt(a*a+n*n)>0){const e=this.re/this.J,t=1;p=e+Math.max(0,Math.min(1,(Math.atan2(n,a)-Math.PI/2)/(Math.PI/2)))*(t-e),1>p||(p-=1)}else p=this.re/this.J}else if(s>t)p=(this.ee+Math.max(0,Math.min(this.X,e-s)))/this.J;else if(e>i-s)p=(this.te+Math.max(0,Math.min(this.q,t-s)))/this.J;else if(t>r-s){const t=i-s-e;t>this.X/2?(p=(this.ae+(this.X/2+(this.X/2-(e-s))))/this.J,1>p||(p-=1)):p=(this.ae+(this.X/2-t))/this.J}else s>e&&(p=(this.ne+Math.max(0,Math.min(this.q,r-s-t)))/this.J);const u=(p%1+1)%1*o,h=Math.floor(u)%o,f=u-h;return(1-f)*this.deformations[h]+f*this.deformations[(h+1)%o]}tFromWall(e,t){const a=this.H,n=this.Z,o=this.Y,i=this.X,r=this.q,s=this.J;if(0>=s)return 0;const l=Math.max(0,Math.min(1,+t||0));return"top"===e?(this.ee+Math.max(0,Math.min(i,l*a-o)))/s:"right"===e?(this.te+Math.max(0,Math.min(r,l*n-o)))/s:"bottom"===e?(this.ae+Math.max(0,Math.min(i,a-o-l*a)))/s:"left"===e?(this.ne+Math.max(0,Math.min(r,n-o-l*n)))/s:0}impactAtT(e,t){const a=f(),n=this.n;if(0>=n)return;const o=Math.max(0,a.wallWobbleMaxDeform??45)*Math.max(0,Math.min(1,+t||0));if(0>=o)return;const i=Math.max(.25,Math.min(6,a.wallWobbleSigma??2)),r=((+e||0)%1+1)%1*n,s=Math.max(0,+(a.wallWobbleMaxImpulse??220)||0),l=Math.max(0,+(a.wallWobbleMaxVel??800)||0),c=Math.max(0,+(a.wallWobbleMaxEnergyPerStep??2e4)||0),d=Math.max(2,Math.min(n,Math.min(24,Math.ceil(3*i))));for(let p=-d;d>=p;p++){const e=((Math.round(r)+p)%n+n)%n,t=Math.abs(r-e),a=Math.min(t,n-t);let d=o*Math.exp(-a*a/(2*i*i));s>0&&d>s&&(d=s);const u=this.pressure[e]||0;if(u>0&&(d*=Math.max(Lo,1-.65*u)),c>0){const e=c-this.pe;if(0>=e)break;d>e&&(d=e)}let h=this.velocities[e]+d;if(l>0){const t=this.pressure[e]||0,a=t>0?l*Math.max(Lo,1-.55*t):l;h>a?h=a:-a>h&&(h=-a)}this.velocities[e]=h,c>0&&(this.pe+=Math.abs(d))}this.de=!0}addPressureAtT(e,t,a={}){const n=this.n;if(0>=n)return;const o=Math.max(0,Math.min(1,+t||0));if(0>=o)return;const i=Math.round(((+e||0)%1+1)%1*n)%n,r=a.fast?1:3;for(let s=-r;r>=s;s++){const e=((i+s)%n+n)%n,t=this.pressure[e]+o*Math.max(0,1-Math.abs(s)/(r+1));this.pressure[e]=t>1?1:t}this.de=!0}step(e){const t=f(),a=this.n;if(0>=a)return;const n=Math.min(Do,Math.max(0,+e||0));if(0>=n)return;if(!this.de){let e=!1;const t=200,o=3,i=5;for(let r=0;a>r;r++)if(this.deformations[r]>.001||Math.abs(this.velocities[r])>.001){e=!0;const a=1>this.baseY[r]&&!this.cornerMask[r]&&this.normY[r]>.7,s=!this.cornerMask[r]&&this.Y+2>this.baseX[r]&&this.Y+2>this.baseY[r],l=s||!this.cornerMask[r]&&this.baseX[r]>this.H-this.Y-1&&this.Y+1>this.baseY[r],c=this.cornerMask[r]&&this.Y+3>this.baseX[r]&&this.Y+3>this.baseY[r],d=c||this.cornerMask[r]&&this.baseX[r]>this.H-this.Y-2&&this.Y+2>this.baseY[r];this.velocities[r]+=(-(c||s?t*o*i:a||l||d?t*o:t)*this.deformations[r]-20*this.velocities[r])*n,this.deformations[r]+=this.velocities[r]*n,0>this.deformations[r]&&(this.deformations[r]=0,this.velocities[r]=0);const p=a||l||d,u=c||s;(u?.01:p?.02:.1)>this.deformations[r]&&(u?.2:p?.3:1)>Math.abs(this.velocities[r])&&(this.deformations[r]=0,this.velocities[r]=0)}return this.de=e,void(e||(this.le=0,this.ce=0))}const o=Math.max(1,t.wallWobbleStiffness??2200),i=Math.max(0,t.wallWobbleDamping??35),r=Math.max(0,t.wallWobbleMaxDeform??45),s=Math.max(0,+(t.wallWobbleMaxVel??800)||0),l=1+5*Math.max(0,Math.min(1,+t.wallWobbleCornerClamp||0)),c=.18*o,d=Math.max(0,Math.min(100,t.wallWobbleSettlingSpeed??50))/100,p=5+30*d,u=.5+1.5*d;let h=0,m=0;for(let f=0;a>f;f++){const e=0===f?a-1:f-1,t=f===a-1?0:f+1,d=this.deformations[f],g=this.velocities[f],b=this.cornerMask[f]?1:0,M=b&&this.Y+3>this.baseX[f]&&this.Y+3>this.baseY[f]?3:b&&this.baseX[f]>this.H-this.Y-2&&this.Y+2>this.baseY[f]?2:1,y=o*(b?l*M:b?M:!b&&1>this.baseY[f]&&this.normY[f]>.7||!b&&this.Y+2>this.baseX[f]&&this.Y+2>this.baseY[f]||!b&&this.baseX[f]>this.H-this.Y-1&&this.Y+1>this.baseY[f]?4:2),v=Math.abs(d),x=Math.abs(g),w=this.pressure[f];let S=g+(-y*d+c*(this.deformations[e]+this.deformations[t]-2*d)-Math.min(i*(1+1*Math.max(0,Math.min(1,1-v/20)))*(1+w*p),1.9*Math.sqrt(y+2*c))*g)*n;if(s>0){const e=this.pressure[f]||0,t=e>0?s*Math.max(Lo,1-.55*e):s;S>t?S=t:-t>S&&(S=-t)}let k=d+S*n,C=!1,P=!1;0>k&&(k=0,C=!0),k>r&&(k=r,P=!0),C&&0>S&&(S=0),P&&S>0&&(S=0);const F=!b&&1>this.baseY[f]&&this.normY[f]>.7||!b&&this.Y+2>this.baseX[f]&&this.Y+2>this.baseY[f]||!b&&this.baseX[f]>this.H-this.Y-1&&this.Y+1>this.baseY[f]||b&&this.Y+3>this.baseX[f]&&this.Y+3>this.baseY[f]||b&&this.baseX[f]>this.H-this.Y-2&&this.Y+2>this.baseY[f]?5:this.cornerMask[f]?1:3,T=(w>.5?.5:w>.1?3:10)*u*F;(w>.5?.3:w>.1?.8:2)*u*F>Math.abs(k)&&T>x?(this.deformations[f]=0,this.velocities[f]=0):(this.deformations[f]=k,this.velocities[f]=S),this.deformations[f]>h&&(h=this.deformations[f]);const D=Math.abs(this.velocities[f]);D>m&&(m=D)}Number.isFinite(h)&&Number.isFinite(m)?(this.le=h,this.ce=m,this.de=h>0||m>0):this.reset()}}const Ko={ringPhysics:new Ao(To),ringRender:new Ao(To),ue:0,he:0,fe:1/30,me:0,$:0,ge:null,N:null,_:null,be:null,resetStepBudgets(){this.ue=0,this.he=0,this.ringPhysics.pe=0},clearPressureFrame(){this.ringPhysics.clearPressure()},step(e){const t=f(),a=!1!==t.wallPhysicsAdaptiveSamples,n=Math.max(8,Math.min(48,Math.round(+(t.wallPhysicsMinSamples??24)||24))),o=Math.min(To,Math.round(+(t.wallPhysicsSamples??To)||To));if(!1!==t.wallPhysicsSkipInactive&&!this.ringPhysics.de)return this.ringPhysics.step(e),this.ringRender.step(e),void(this.$=1);const i=1/Math.max(10,Math.min(60,+(t.wallPhysicsUpdateHz??30)||30)),r=!1!==t.wallPhysicsInterpolation;if(this.me+=e,i>this.me)this.$=r?Math.max(0,Math.min(1,this.me/i)):1;else{if(a){const e=this.ringPhysics.n;let t=e;t=this.ringPhysics.de?5>(this.ringPhysics.le||0)&&2>(this.ringPhysics.ce||0)?Math.max(n,Math.min(o,e-1)):Math.min(o,Math.max(n,e+1)):Math.max(n,Math.min(o,e-1)),t!==e&&this.ringPhysics.ensureSampleCount(t)}else{const e=Math.max(8,Math.min(To,o));this.ringPhysics.n!==e&&this.ringPhysics.ensureSampleCount(e)}if(r&&this.ringPhysics.n>0){const e=this.ringPhysics.n;this.ge&&this.ge.length===e||(this.ge=new Float32Array(e)),this.ge.set(this.ringPhysics.deformations)}let e=i;this.me-=i;const l=1/Math.max(30,Math.min(240,+(t.wallPhysicsMaxSubstepHz??60)||60));let c=0;const d=6;for(;e>1e-6&&d>c;){const t=e>l?l:e;this.ringPhysics.step(t),e-=t,c++}try{const e=this.ringPhysics,t=0|e.n,a=0|this.ringRender.n;if(t>0&&a>0){this.N&&this.N.length===a?this.N.set(this._):(this.N=new Float32Array(a),this._=new Float32Array(a),this.be=new Float32Array(a));const n=e.deformations,o=this.be,i=this._;for(let e=0;a>e;e++){const i=e/a*t,r=Math.floor(i)%t,s=i-r;o[e]=(1-s)*n[r]+s*n[(r+1)%t]}for(let e=0;a>e;e++)i[e]=(o[(e-2+a)%a]+4*o[(e-1+a)%a]+6*o[e]+4*o[(e+1)%a]+o[(e+2)%a])*(1/16)}}catch(s){}this.$=r?Math.max(0,Math.min(1,this.me/i)):1}},reset(){this.ringPhysics.reset(),this.ringRender.reset(),this.me=0,this.$=0,this.ge=null,this.N=null,this._=null,this.be=null},hasAnyDeformation(){return this.ringPhysics.hasDeformation()},getDeformationAtPoint(e,t){const a=this.ringPhysics;if(!a||0===a.n)return 0;const n=f();if(!n.canvas)return 0;const o=Math.max(0,(+n.wallThickness||0)*(n.DPR||1));return a.getDeformationAtPoint(e-o,t-o)}};let Oo=0;class Eo{constructor(e,t,a,n){const o=f();this.x=e,this.y=t,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=a,this.rBase=a,this.m=o.ballMassKg,this.color=n,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1,this.isSleeping=!1,this.sleepTimer=0,this.isGrounded=!1,this.hasSupport=!1,this.Me="ball-"+Oo++}step(e,t){const a=f(),{currentMode:n,G:o,gravityScale:i,FRICTION:r,MASS_BASELINE_KG:s}=a;if(this.t+=e,this.age+=e,this.isSleeping){const e=(a.repelRadius||710)*a.DPR*1.2,t=this.x-a.mouseX,n=this.y-a.mouseY;e*e>t*t+n*n&&this.wake()}if(this.isSleeping&&!1!==a.physicsSkipSleepingSteps)return;const l=a.DPR||1,c=this.isGrounded,d=this.hasSupport;this.isGrounded=!1,this.hasSupport=!1,n!==Bn.WEIGHTLESS&&(!c&&!d||-8*l>this.vy)&&(this.vy+=o*i*e);const p=Math.max(.25,this.m/s),u=Math.max(0,1-(n===Bn.WEIGHTLESS||n===Bn.ORBIT_3D||n===Bn.ORBIT_3D_2?0:r)*(1+1*Math.max(0,Math.min(1,1-Math.sqrt(this.vx*this.vx+this.vy*this.vy)/(100*l))))/p);if(this.vx*=u,this.vy*=u,n!==Bn.ORBIT_3D&&n!==Bn.ORBIT_3D_2){const e=2*l;e>Math.abs(this.vx)&&(this.vx=0),e>Math.abs(this.vy)&&n===Bn.WEIGHTLESS&&(this.vy=0)}0!==this.driftAx&&this.driftTime>this.age?this.vx+=this.driftAx*e/p:0!==this.driftAx&&(this.driftAx=0),t&&t(this,e),this.x+=this.vx*e,this.y+=this.vy*e,this.omega*=Math.max(0,1-Wn.SPIN_DAMP_PER_S*(1+.5*Math.max(0,Math.min(1,1-Math.abs(this.omega)/2)))*e),this.theta+=this.omega*e,.01>Math.abs(this.omega)&&(this.omega=0),this.squashAmount+=(0-this.squashAmount)*Math.min(1,Wn.SQUASH_DECAY_PER_S*e),this.squash=1-this.squashAmount}updateSleepState(e,t){const a=Math.sqrt(this.vx*this.vx+this.vy*this.vy),n=Math.abs(this.omega),o=t.DPR||1,i=(Number.isFinite(t.sleepVelocityThreshold)?t.sleepVelocityThreshold:Wn.SLEEP_VELOCITY_THRESHOLD)*o,r=Number.isFinite(t.sleepAngularThreshold)?t.sleepAngularThreshold:Wn.SLEEP_ANGULAR_THRESHOLD,s=Number.isFinite(t.timeToSleep)?t.timeToSleep:Wn.TIME_TO_SLEEP;(this.isGrounded||this.hasSupport)&&i>a&&r>n?(this.sleepTimer+=e,s>this.sleepTimer||(this.vx=0,this.vy=0,this.omega=0,this.isSleeping=!0)):this.sleepTimer=0}wake(){this.isSleeping=!1,this.sleepTimer=0}walls(e,t,a,n,o={}){const i=!1!==o.registerEffects,r=f(),{REST:s,MASS_BASELINE_KG:l,currentMode:c,DPR:d}=r,p=void 0!==n?n:s,u=r.wallWobbleImpactThreshold??Wn.WALL_REST_VEL_THRESHOLD,h=this.r*(1+(r.ballSpacing||0)),m="function"==typeof r.getCanvasCornerRadius?r.getCanvasCornerRadius():r.cornerRadius??r.wallRadius??0,g=Math.max(0,+m||0)*(d||1),b=Math.max(0,(r.wallThickness??0)*(d||1)),M=Math.max(0,r.wallInset??3)*(d||1),y=Math.max(1,e-2*b),v=Math.max(1,t-2*b);let x=!1;const w=c===Bn.PIT||c===Bn.PIT_THROWS,S=.5*y,k=.5*v,C=Math.max(0,Math.min(g,.5*y,.5*v)),P=b+S,F=b+k,T=Math.max(0,Math.min(100,r.wallDeformPhysicsPrecision??50))>0&&"function"==typeof Ko?.getDeformationAtPoint,{dist:D,nx:L,ny:I}=(()=>{const e=this.x-P,t=this.y-F,a=Math.abs(e)-(S-C),n=Math.abs(t)-(k-C),o=Math.hypot(Math.max(a,0),Math.max(n,0))+Math.min(Math.max(a,n),0)-C;let i=0,r=0;if(a>0&&n>0){const e=Math.hypot(a,n);e>1e-6&&(i=a/e,r=n/e)}else a>n?(i=1,r=0):(i=0,r=1);return i*=0>e?-1:1,r*=0>t?-1:1,{dist:o,nx:i,ny:r}})(),A=w&&-.5>I;let K=0;T&&!A&&(K=Ko.getDeformationAtPoint(this.x-L*D,this.y-I*D));const O=D+(h+M+K);if(O>0&&!A){x=!0;const t=this.vx*L+this.vy*I;this.x-=L*O,this.y-=I*O,t>0&&(this.vx-=(1+p)*t*L,this.vy-=(1+p)*t*I);const n=I>.7,o=-.7>I,s=-.7>L,c=L>.7,h=Math.abs(t),m=Math.min(1,h/(80*this.r));if(n){this.isGrounded=!0;const e=Math.max(.25,this.m/l);this.vx*=Math.max(0,1-Wn.ROLL_FRICTION_PER_S*(1+Math.max(0,Math.min(1,1-Math.abs(this.vx)/(80*d))))*a/e),3*d>Math.abs(this.vx)&&(this.vx=0),this.omega+=(this.vx-this.omega*this.r)/this.r*Wn.SPIN_GAIN/e,this.omega+=(this.vx/this.r-this.omega)*Math.min(1,Wn.GROUND_COUPLING_PER_S*a),.05>Math.abs(this.omega)&&(this.omega=0)}if(this.squashAmount=Math.min(r.getSquashMax(),.8*m),this.squashNormalAngle=Math.atan2(-I,-L),i){if(X(this.r,.65*m,this.x/Math.max(1,e),this.Me),!this.isSleeping&&h>=u){let e=null,t=0;n?(e="bottom",t=y>1?(this.x-b)/y:.5):o&&!w?(e="top",t=y>1?(this.x-b)/y:.5):s?(e="left",t=v>1?(this.y-b)/v:.5):c&&(e="right",t=v>1?(this.y-b)/v:.5),e&&((e,t,a)=>{if(!e||e.startsWith("corner"))return;if("top"!==e&&"bottom"!==e&&"left"!==e&&"right"!==e)return;const n=f(),o=n.canvas;if(!o)return;const i="function"==typeof n.getCanvasCornerRadius?n.getCanvasCornerRadius():n.cornerRadius??n.wallRadius??0,r=Math.max(0,(+i||0)*(n.DPR||1)),s=Math.max(0,(+n.wallThickness||0)*(n.DPR||1)),l=Math.max(1,o.width-2*s),c=Math.max(1,o.height-2*s);Ko.ringPhysics.ensureGeometry(l,c,Math.max(0,Math.min(r,.5*l,.5*c)));const d=Math.max(0,Math.min(.45,+n.wallWobbleCornerClamp||0)),p=Ko.ringPhysics.tFromWall(e,Math.max(d,Math.min(1-d,+t||0)));if(64>Ko.ue)Ko.ringPhysics.impactAtT(p,a);else{const e=Ko.ringPhysics.n;e>0&&(Ko.ringPhysics.velocities[Math.round(((+p||0)%1+1)%1*e)%e]+=Math.max(0,n.wallWobbleMaxDeform??45)*Math.max(0,Math.min(1,+a||0)),Ko.ringPhysics.de=!0)}Ko.ue++})(e,Math.max(0,Math.min(1,t)),m)}const t=this.isSleeping?1:Math.max(0,(u-h)/u);if(t>.1){let e=null,a=0;n?(e="bottom",a=y>1?(this.x-b)/y:.5):o&&!w?(e="top",a=y>1?(this.x-b)/y:.5):s?(e="left",a=v>1?(this.y-b)/v:.5):c&&(e="right",a=v>1?(this.y-b)/v:.5),e&&((e,t,a=1)=>{if(!e||e.startsWith("corner"))return;if("top"!==e&&"bottom"!==e&&"left"!==e&&"right"!==e)return;const n=f(),o=n.canvas;if(!o)return;const i="function"==typeof n.getCanvasCornerRadius?n.getCanvasCornerRadius():n.cornerRadius??n.wallRadius??0,r=Math.max(0,(+i||0)*(n.DPR||1)),s=Math.max(0,(+n.wallThickness||0)*(n.DPR||1)),l=Math.max(1,o.width-2*s),c=Math.max(1,o.height-2*s);Ko.ringPhysics.ensureGeometry(l,c,Math.max(0,Math.min(r,.5*l,.5*c)));const d=Ko.ringPhysics.tFromWall(e,Math.max(.1,Math.min(.9,+t||0)));Ko.ringPhysics.addPressureAtT(d,a,{fast:Ko.he>=256}),Ko.he++})(e,Math.max(0,Math.min(1,a)),t)}}}x&&this.isSleeping&&this.wake()}draw(e){const t=this.squashAmount>.001,a=1>this.alpha;t||a?(e.save(),e.translate(this.x,this.y),t?(e.rotate(this.theta+this.squashNormalAngle),e.scale(1-.3*this.squashAmount,1+.3*this.squashAmount),e.rotate(-this.squashNormalAngle)):e.rotate(this.theta),a&&(e.globalAlpha=this.alpha),e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI),e.fillStyle=this.color,e.fill(),e.restore()):(e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.r,0,2*Math.PI),e.fill())}}const Bo=.2,Ro=[];let zo,Wo,Vo=Wn.DPR,$o=0,No=0,_o=null,Go=null,Ho=0,jo=0,Zo=0;const Yo=2*Math.PI,Xo=1e-6;let qo=0,Uo=0;var Jo=Object.freeze({__proto__:null,MODES:Bn,getForceApplicator:rt,getModeRenderer:lt,getModeUpdater:st,resetCurrentMode:it,setMode:ot});let Qo=null,ei=null,ti=!1,ai=!1,ni=0,oi=0,ii=0,ri=0,si=null;const li=.35,ci=1.2;var di=Object.freeze({__proto__:null,getCursorBrightenedColor:pt,hideCursor:gt,setupCustomCursor:ht,showCursor:bt,updateCursorPosition:mt,updateCursorSize:ft});let pi=0,ui=null,hi=null,fi=null,mi=0,gi=0,bi=!1;const Mi=Wn.PHYSICS_DT;let yi=0;const vi=42,xi=1/60;var wi=Object.freeze({__proto__:null,getBalls:()=>f().balls||[],render:kt,syncChromeColor:Ct,updatePhysics:St});const Si=(()=>{try{return{log:console.log?.bind(console)??(()=>{}),info:console.info?.bind(console)??(()=>{}),warn:console.warn?.bind(console)??(()=>{}),error:console.error?.bind(console)??(()=>{}),debug:console.debug?.bind(console)??(()=>{}),groupCollapsed:console.groupCollapsed?.bind(console)??(()=>{}),groupEnd:console.groupEnd?.bind(console)??(()=>{}),table:console.table?.bind(console)??(()=>{})}}catch(e){return{log(){},info(){},warn(){},error(){},debug(){},groupCollapsed(){},groupEnd(){},table(){}}}})();let ki=null,Ci=0,Pi="undefined"!=typeof performance&&performance.now?performance.now():Date.now(),Fi=!1;const Ti=["#b7bcb7","#d0d0d0","#ffffff","#00695c","#1a1a1a","#ff4013","#0d5cb6","#ffa000"],Di=[.5,.25,.12,.06,.03,.02,.01,.01];let Li=null,Ii=null,Ai="auto",Ki="light",Oi=!1;var Ei=Object.freeze({__proto__:null,getCurrentTheme:()=>Ai,initializeDarkMode:Bt,setTheme:Et,toggleDarkMode:Rt});let Bi=!1,Ri=null,zi=null,Wi=null,Vi=null,$i=null,Ni=0,_i=null,Gi=0,Hi=null,ji="";const Zi=["noiseEnabled","noiseSeed","noiseTextureSize","noiseDistribution","noiseMonochrome","noiseChroma","noiseMotion","noiseMotionAmount","noiseSpeedBackMs","noiseSpeedFrontMs","noiseFlicker","noiseFlickerSpeedMs","noiseBlurPx","noiseContrast","noiseBrightness","noiseSaturation","noiseHue","noiseSizeBase","noiseSizeTop","noiseBackOpacity","noiseFrontOpacity","noiseBackOpacityDark","noiseFrontOpacityDark","noiseTopOpacity","detailNoiseOpacity"];let Yi=null,Xi={};(()=>{try{const e=localStorage.getItem("panel_control_visibility");e&&(Xi=JSON.parse(e))}catch(e){Xi={}}})();const qi=["physics","wall","balls","colorDistribution","colors","noise","cursor","trail","links","scene","overlay","entrance","environment"],Ui={physics:"MATERIAL WORLD",wall:"MATERIAL WORLD",balls:"MATERIAL WORLD",colorDistribution:"LOOK & PALETTE",colors:"LOOK & PALETTE",noise:"LOOK & PALETTE",cursor:"INTERACTION",trail:"INTERACTION",links:"INTERACTION",scene:"MOTION",entrance:"MOTION",overlay:"DEPTH & LAYOUT",layout:"DEPTH & LAYOUT",sound:"SOUND",environment:"ENVIRONMENT"},Ji={environment:{title:"Browser",icon:"🧭",defaultOpen:!1,controls:[{id:"chromeHarmonyMode",label:"Chrome Harmony",stateKey:"chromeHarmonyMode",type:"select",options:[{value:"auto",label:"Auto (adapt only when needed)"},{value:"site",label:"Site (benchmark)"},{value:"browser",label:"Browser (force adapt)"}],default:"site",format:e=>e+"",parse:e=>e+"",hint:"If desktop browsers ignore theme-color, the wall adapts to match the browser UI palette.",onChange(){Promise.resolve().then(()=>Ei).then(({getCurrentTheme:e,setTheme:t})=>{t(e())}).catch(()=>{})}},{id:"autoDarkModeEnabled",label:"Auto Dark (Night)",stateKey:"autoDarkModeEnabled",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,hint:"In Auto theme, prefer Dark during the night window (privacy-first: local clock only).",onChange(){Promise.resolve().then(()=>Ei).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}},{id:"autoDarkNightStartHour",label:"Night Starts",stateKey:"autoDarkNightStartHour",type:"range",min:0,max:23,step:1,default:18,format:e=>Math.round(e)+":00",parse:e=>parseInt(e,10),onChange(){Promise.resolve().then(()=>Ei).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}},{id:"autoDarkNightEndHour",label:"Night Ends",stateKey:"autoDarkNightEndHour",type:"range",min:0,max:23,step:1,default:6,format:e=>Math.round(e)+":00",parse:e=>parseInt(e,10),onChange(){Promise.resolve().then(()=>Ei).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}}]},physics:{title:"Material World",icon:"⚖️",defaultOpen:!1,controls:[{id:"ballMassKg",label:"Ball Mass",stateKey:"ballMassKg",type:"range",min:20,max:400,step:1,default:91,format:e=>Math.round(e)+" kg",parse:e=>parseInt(e,10),hint:"Heavier = snooker feel (more inertia, less jitter).",onChange(e,t){const a=+t;if(Number.isFinite(a)&&Array.isArray(e.balls))for(let n=0;e.balls.length>n;n++){const t=e.balls[n];t&&(t.m=a)}}},{id:"REST",label:"Restitution",stateKey:"REST",type:"range",min:0,max:.95,step:.01,default:.42,format:e=>e.toFixed(2),parse:parseFloat,hint:"Global bounciness for collisions (modes may override)."},{id:"FRICTION",label:"Friction",stateKey:"FRICTION",type:"range",min:0,max:.06,step:.001,default:.018,format:e=>e.toFixed(3),parse:parseFloat,hint:"Global drag/energy loss (modes may override)."},{id:"physicsCollisionIterations",label:"Collision Iterations",stateKey:"physicsCollisionIterations",type:"range",min:3,max:20,step:1,default:10,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Performance",groupCollapsed:!0,hint:"Lower = faster, higher = tighter stacks."},{id:"physicsSkipSleepingCollisions",label:"Skip Sleeping Pairs",stateKey:"physicsSkipSleepingCollisions",type:"toggle",default:!0,group:"Performance"},{id:"physicsSpatialGridOptimization",label:"Grid Reuse",stateKey:"physicsSpatialGridOptimization",type:"toggle",default:!0,group:"Performance"},{id:"physicsSleepThreshold",label:"Sleep Threshold",stateKey:"physicsSleepThreshold",type:"range",min:0,max:30,step:1,default:12,format:e=>Math.round(e)+" px/s",parse:e=>parseInt(e,10),group:"Performance",hint:"Global sleep threshold for non-Pit physics modes. 0 disables."},{id:"physicsSleepTime",label:"Sleep Time",stateKey:"physicsSleepTime",type:"range",min:0,max:1,step:.05,default:.25,format:e=>e.toFixed(2)+"s",parse:parseFloat,group:"Performance"},{id:"physicsSkipSleepingSteps",label:"Skip Sleeping Steps",stateKey:"physicsSkipSleepingSteps",type:"toggle",default:!0,group:"Performance"}]},balls:{title:"Balls",icon:"🎱",defaultOpen:!1,controls:[{id:"sizeGlobal",label:"Size",stateKey:"sizeScale",type:"range",min:.1,max:6,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat,onChange(e){Promise.resolve().then(()=>Hn).then(({updateBallSizes:t})=>{t();const a=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=a,e.rBase=a})}),Promise.resolve().then(()=>di).then(({updateCursorSize:e})=>{e()})}},{id:"responsiveScaleMobile",label:"Mobile Scale",stateKey:"responsiveScaleMobile",type:"range",min:.5,max:1.5,step:.05,default:.75,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Ball size multiplier for iPad/iPhone (requires reload)",onChange(e){Promise.resolve().then(()=>Hn).then(({detectResponsiveScale:t})=>{t();const a=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=a,e.rBase=a})})}},{id:"mobileObjectReductionFactor",label:"Mobile Density",stateKey:"mobileObjectReductionFactor",type:"range",min:0,max:1,step:.05,default:.7,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Scales object counts on mobile (0% = none). Resets the current mode.",onChange(e){Promise.resolve().then(()=>Jo).then(({setMode:t})=>{t(e.currentMode)}).catch(()=>{})}},{id:"ballSoftnessGlobal",label:"Softness",stateKey:"ballSoftness",type:"range",min:0,max:100,step:1,default:20,format:e=>e+"",parse:e=>parseInt(e,10)},{id:"ballSpacing",label:"Spacing",stateKey:"ballSpacing",type:"range",min:0,max:.5,step:.01,default:.08,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Collision gap as % of ball radius (affects physics)"},{id:"sizeVariationGlobalMul",label:"Variation Scale",stateKey:"sizeVariationGlobalMul",type:"range",min:0,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Global multiplier for per-mode size variation",onChange(){Promise.resolve().then(()=>Hn).then(({updateBallSizes:e})=>{e()})}},{id:"sizeVariationCap",label:"Variation Cap",stateKey:"sizeVariationCap",type:"range",min:0,max:.2,step:.01,default:.2,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Max radius deviation from medium (20% = ±20%)",onChange(){Promise.resolve().then(()=>Hn).then(({updateBallSizes:e})=>{e()})}}]},cursor:{title:"Hand",icon:"🖐️",defaultOpen:!1,controls:[{id:"cursorSize",label:"Size",stateKey:"cursorSize",type:"range",min:.1,max:3,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,onChange(){Promise.resolve().then(()=>di).then(({updateCursorSize:e})=>{e()})}},{id:"cursorInfluenceRadiusVw",label:"Influence Radius",stateKey:"cursorInfluenceRadiusVw",type:"range",min:0,max:80,step:.5,default:14,format:e=>e.toFixed(1)+"vw",parse:parseFloat,hint:"Universal cursor interaction zone (scales with viewport width)."}]},trail:{title:"Motion Trail",icon:"💨",defaultOpen:!1,controls:[{id:"mouseTrailEnabled",label:"Enabled",stateKey:"mouseTrailEnabled",type:"checkbox",default:!0},{id:"mouseTrailLength",label:"Length",stateKey:"mouseTrailLength",type:"range",min:4,max:96,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),hint:"Max samples kept (higher = smoother, slightly more work)"},{id:"mouseTrailSize",label:"Size",stateKey:"mouseTrailSize",type:"range",min:.5,max:10,step:.1,default:1.3,format:e=>e.toFixed(1)+"px",parse:parseFloat},{id:"mouseTrailFadeMs",label:"Fade",stateKey:"mouseTrailFadeMs",type:"range",min:40,max:1200,step:10,default:220,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10)},{id:"mouseTrailOpacity",label:"Opacity",stateKey:"mouseTrailOpacity",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat}]},links:{title:"Links",icon:"🔗",defaultOpen:!1,controls:[{id:"linkTextPadding",label:"Text Link Padding",stateKey:"linkTextPadding",type:"range",min:4,max:40,step:1,default:30,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Padding for text links (footer links, CV links)",onChange(e,t){document.documentElement.style.setProperty("--link-text-padding",t+"px"),document.documentElement.style.setProperty("--link-text-margin",-t+"px")}},{id:"linkIconPadding",label:"Icon Link Padding",stateKey:"linkIconPadding",type:"range",min:4,max:40,step:1,default:24,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Padding for icon links (social media icons)",onChange(e,t){document.documentElement.style.setProperty("--link-icon-padding",t+"px"),document.documentElement.style.setProperty("--link-icon-margin",-t+"px")}},{id:"linkColorInfluence",label:"Color Influence",stateKey:"linkColorInfluence",type:"range",min:0,max:1,step:.01,default:1,format:e=>e.toFixed(2),parse:parseFloat,hint:"How much cursor color affects link colors (0 = none, 1 = full)",onChange(e,t){document.documentElement.style.setProperty("--link-color-influence",t+"")}},{id:"linkImpactScale",label:"Impact Scale",stateKey:"linkImpactScale",type:"range",min:.7,max:1,step:.01,default:.95,format:e=>e.toFixed(2),parse:parseFloat,hint:"Scale when link is pressed (lower = more dramatic press)",onChange(e,t){document.documentElement.style.setProperty("--link-impact-scale",t+"")}},{id:"linkImpactBlur",label:"Impact Blur",stateKey:"linkImpactBlur",type:"range",min:0,max:20,step:.5,default:10,format:e=>e.toFixed(1)+"px",parse:parseFloat,hint:"Blur amount when link is pressed (creates depth effect)",onChange(e,t){document.documentElement.style.setProperty("--link-impact-blur",t+"px")}},{id:"linkImpactDuration",label:"Impact Duration",stateKey:"linkImpactDuration",type:"range",min:50,max:300,step:10,default:150,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration of press animation (fast and subtle)",onChange(e,t){document.documentElement.style.setProperty("--link-impact-duration",t+"ms")}}]},scene:{title:"Scene Impact",icon:"🎬",defaultOpen:!1,controls:[{id:"sceneImpactEnabled",label:"Enabled",stateKey:"sceneImpactEnabled",type:"checkbox",default:!0,hint:"If disabled, mode changes will not animate the scene."},{id:"sceneImpactMul",label:"Click Depth",stateKey:"sceneImpactMul",type:"range",min:0,max:.05,step:.001,default:.01,format:e=>e.toFixed(3),parse:parseFloat,hint:"How far the entire scene “presses in” on simulation change.",onChange(e,t){const a=document.getElementById("abs-scene");if(!a)return;const n=e||{},o=+n.sceneImpactMobileMulFactor;a.style.setProperty("--abs-scene-impact-mul",+t*((n.isMobile||n.isMobileViewport)&&Number.isFinite(o)&&o>0?o:1)+"")}},{id:"sceneImpactLogoCompMul",label:"Logo Comp",stateKey:"sceneImpactLogoCompMul",type:"range",min:.25,max:6,step:.05,default:3.6,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"How strongly the logo counter-scales against the scene press (higher = logo feels more “anchored”).",onChange(e,t){const a=document.getElementById("abs-scene");if(!a)return;const n=+t;a.style.setProperty("--abs-scene-impact-logo-comp-mul",(Number.isFinite(n)&&n>0?n:1)+"")}},{id:"sceneImpactMobileMulFactor",label:"Mobile Depth ×",stateKey:"sceneImpactMobileMulFactor",type:"range",min:.25,max:3,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Multiplier applied to Click Depth on mobile-sized viewports.",onChange(e,t){const a=document.getElementById("abs-scene");if(!a)return;const n=e||{},o=+n.sceneImpactMul,i=+t;a.style.setProperty("--abs-scene-impact-mul",(Number.isFinite(o)?o:0)*((n.isMobile||n.isMobileViewport)&&Number.isFinite(i)&&i>0?i:1)+"")}},{id:"sceneImpactPressMs",label:"Press",stateKey:"sceneImpactPressMs",type:"range",min:20,max:300,step:5,default:90,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Press-in duration."},{id:"sceneImpactReleaseMs",label:"Release",stateKey:"sceneImpactReleaseMs",type:"range",min:40,max:1200,step:10,default:310,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Release duration (“bounce out” length)."},{id:"sceneImpactAnticipation",label:"Anticipation",stateKey:"sceneImpactAnticipation",type:"range",min:0,max:.6,step:.01,default:0,format:e=>e.toFixed(2),parse:parseFloat,hint:"Micro pre-pop before the click-in (0 = off)."},{id:"sceneChangeSoundEnabled",label:"Scene Sound",stateKey:"sceneChangeSoundEnabled",type:"checkbox",default:!0,hint:"Plays a soft “pebble-like” tick when switching simulations (only if sound is enabled)."},{id:"sceneChangeSoundIntensity",label:"Scene Sound Intensity",stateKey:"sceneChangeSoundIntensity",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat},{id:"sceneChangeSoundRadius",label:"Scene Sound Pitch",stateKey:"sceneChangeSoundRadius",type:"range",min:6,max:60,step:1,default:18,format:e=>""+Math.round(e),parse:e=>parseInt(e,10),hint:"Higher = lower pitch (maps like “ball size”)."}]},overlay:{title:"Depth & Blur",icon:"🌫️",defaultOpen:!1,controls:[{id:"gateOverlayEnabled",label:"Enabled",stateKey:"gateOverlayEnabled",type:"checkbox",default:!0},{id:"gateOverlayOpacity",label:"White Wash",stateKey:"gateOverlayOpacity",type:"range",min:0,max:.1,step:.001,default:.01,format:e=>e.toFixed(3),parse:parseFloat,onChange(e,t){Promise.resolve().then(()=>xr).then(({updateOverlayOpacity:e})=>{e(t)})}},{id:"gateOverlayTransitionMs",label:"Anim In Speed",stateKey:"gateOverlayTransitionMs",type:"range",min:200,max:1500,step:50,default:800,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration for blur & depth zoom when opening",onChange(e,t){Promise.resolve().then(()=>xr).then(({updateOverlayTransition:e})=>{e(t)})}},{id:"gateOverlayTransitionOutMs",label:"Anim Out Speed",stateKey:"gateOverlayTransitionOutMs",type:"range",min:200,max:1200,step:50,default:600,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration for blur & depth zoom when closing",onChange(e,t){Promise.resolve().then(()=>xr).then(({updateOverlayTransitionOut:e})=>{e(t)})}},{id:"gateOverlayContentDelayMs",label:"Content Delay",stateKey:"gateOverlayContentDelayMs",type:"range",min:0,max:1e3,step:50,default:200,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Wait before showing dialog content",onChange(e,t){Promise.resolve().then(()=>xr).then(({updateGateContentDelay:e})=>{e(t)})}},{id:"gateDepthScale",label:"Depth Scale",stateKey:"gateDepthScale",type:"range",min:.9,max:1,step:.001,default:.96,format:e=>e.toFixed(3),parse:parseFloat,hint:"Scene scale when gate opens (0.9-1.0)",onChange(e,t){Promise.resolve().then(()=>xr).then(({updateGateDepthScale:e})=>{e(t)})}},{id:"gateDepthTranslateY",label:"Depth Shift",stateKey:"gateDepthTranslateY",type:"range",min:0,max:30,step:1,default:8,format:e=>Math.round(e)+"px",parse:parseInt,hint:"Vertical shift when gate opens",onChange(e,t){Promise.resolve().then(()=>xr).then(({updateGateDepthTranslateY:e})=>{e(t)})}},{id:"logoOpacityInactive",label:"Logo Opacity Closed",stateKey:"logoOpacityInactive",type:"range",min:0,max:1,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,hint:"Logo opacity when gate is closed (1 = fully visible)",onChange(e,t){Promise.resolve().then(()=>xr).then(({updateLogoOpacityInactive:e})=>{e(t)})}},{id:"logoOpacityActive",label:"Logo Opacity Open",stateKey:"logoOpacityActive",type:"range",min:0,max:1,step:.05,default:.2,format:e=>e.toFixed(2),parse:parseFloat,hint:"Logo opacity when gate is active (0.2 = more faded)",onChange(e,t){Promise.resolve().then(()=>xr).then(({updateLogoOpacityActive:e})=>{e(t)})}},{id:"logoBlurInactive",label:"Logo Blur Closed",stateKey:"logoBlurInactive",type:"range",min:0,max:20,step:.5,default:0,format:e=>e.toFixed(1)+"px",parse:parseFloat,hint:"Logo blur when gate is closed (0 = sharp)",onChange(e,t){Promise.resolve().then(()=>xr).then(({updateLogoBlurInactive:e})=>{e(t)})}},{id:"logoBlurActive",label:"Logo Blur Open",stateKey:"logoBlurActive",type:"range",min:0,max:30,step:.5,default:12,format:e=>e.toFixed(1)+"px",parse:parseFloat,hint:"Logo blur when gate is active (12px = soft blur)",onChange(e,t){Promise.resolve().then(()=>xr).then(({updateLogoBlurActive:e})=>{e(t)})}}]},colors:{title:"Color & Surface",icon:"🎨",defaultOpen:!1,controls:[{type:"divider",label:"Backgrounds"},{id:"bgLight",label:"Light Mode",stateKey:"bgLight",type:"color",default:"#f5f5f5",hint:"Background color for light mode",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--bg-light",t),!e.isDarkMode){a.style.setProperty("--chrome-bg",t);const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t)}}},{id:"bgDark",label:"Dark Mode",stateKey:"bgDark",type:"color",default:"#0a0a0a",hint:"Background color for dark mode",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--bg-dark",t),e.isDarkMode){a.style.setProperty("--chrome-bg",t);const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t)}}},{type:"divider",label:"Text · Light Mode"},{id:"textColorLight",label:"Primary",stateKey:"textColorLight",type:"color",default:"#161616",hint:"Main text color in light mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-light",t)}},{id:"textColorLightMuted",label:"Muted",stateKey:"textColorLightMuted",type:"color",default:"#2f2f2f",hint:"Secondary/muted text in light mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-light-muted",t)}},{type:"divider",label:"Text · Dark Mode"},{id:"textColorDark",label:"Primary",stateKey:"textColorDark",type:"color",default:"#b3b3b3",hint:"Main text color in dark mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-dark",t)}},{id:"textColorDarkMuted",label:"Muted",stateKey:"textColorDarkMuted",type:"color",default:"#808080",hint:"Secondary/muted text in dark mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-dark-muted",t)}},{type:"divider",label:"Edge Labels"},{id:"edgeLabelColorLight",label:"Light Mode",stateKey:"edgeLabelColorLight",type:"color",default:"#2f2f2f",hint:"Color for the vertical edge labels in light mode",onChange(e,t){document.documentElement.style.setProperty("--edge-label-color-light",t)}},{id:"edgeLabelColorDark",label:"Dark Mode",stateKey:"edgeLabelColorDark",type:"color",default:"#b3b3b3",hint:"Color for the vertical edge labels in dark mode",onChange(e,t){document.documentElement.style.setProperty("--edge-label-color-dark",t)}},{id:"edgeLabelInsetAdjustPx",label:"Inset",stateKey:"edgeLabelInsetAdjustPx",type:"range",min:-120,max:240,step:1,default:0,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Adjusts edge label inset relative to wall. Higher = inward; lower = outward.",onChange(){Promise.resolve().then(()=>Hn).then(e=>{e.applyLayoutCSSVars()})}},{type:"divider",label:"Links"},{id:"linkHoverColor",label:"Hover Accent",stateKey:"linkHoverColor",type:"color",default:"#ff4013",hint:"Link hover color (accent)",onChange(e,t){document.documentElement.style.setProperty("--link-hover-color",t)}},{type:"divider",label:"Logo"},{id:"logoColorLight",label:"Light Mode",stateKey:"logoColorLight",type:"color",default:"#161616",hint:"Logo color in light mode",onChange(e,t){document.documentElement.style.setProperty("--logo-color-light",t)}},{id:"logoColorDark",label:"Dark Mode",stateKey:"logoColorDark",type:"color",default:"#d5d5d5",hint:"Logo color in dark mode",onChange(e,t){document.documentElement.style.setProperty("--logo-color-dark",t)}},{id:"topLogoWidthVw",label:"Logo Size",stateKey:"topLogoWidthVw",type:"range",min:15,max:45,step:.25,default:35,format:e=>parseFloat(e).toFixed(2)+"vw",parse:parseFloat,hint:"Top-center logo width (clamped by min/max tokens).",onChange(e,t){document.documentElement.style.setProperty("--top-logo-width-vw",t+"")}},{id:"homeMainLinksBelowLogoPx",label:"Links Offset",stateKey:"homeMainLinksBelowLogoPx",type:"range",min:-120,max:240,step:1,default:40,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Index: move the main links up/down below the logo.",onChange(e,t){document.documentElement.style.setProperty("--home-main-links-below-logo-px",t+"")}},{type:"divider",label:"Portfolio Logo"},{id:"portfolioLogoColorLight",label:"Light Mode",stateKey:"portfolioLogoColorLight",type:"color",default:"#161616",hint:"Portfolio logo color in light mode (separate from index)",onChange(e,t){document.documentElement.style.setProperty("--portfolio-logo-color-light",t)}},{id:"portfolioLogoColorDark",label:"Dark Mode",stateKey:"portfolioLogoColorDark",type:"color",default:"#d5d5d5",hint:"Portfolio logo color in dark mode (separate from index)",onChange(e,t){document.documentElement.style.setProperty("--portfolio-logo-color-dark",t)}}]},colorDistribution:{title:"Palette Mix",icon:"🧩",defaultOpen:!1,controls:[{id:"colorDistribution",label:"Disciplines",stateKey:"colorDistribution",type:"colorDistribution",labels:["AI Integration","UI/UX Design","Creative Strategy","Frontend Development","Brand Identity","3D Design","Art Direction"],hint:"Assign each discipline to a palette color, then set weights that sum to 100%. Used for all ball spawns across modes."}]},wall:{title:"WALL",icon:"🫧",defaultOpen:!1,controls:[{id:"frameColorLight",label:"Color · Light Mode",stateKey:"frameColorLight",type:"color",default:"#0a0a0a",hint:"Wall color in light mode (also used for browser chrome)",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--frame-color-light",t),!e.isDarkMode){const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t),a.style.setProperty("--chrome-bg",t)}Promise.resolve().then(()=>wi).then(e=>{e.syncChromeColor()})}},{id:"frameColorDark",label:"Color · Dark Mode",stateKey:"frameColorDark",type:"color",default:"#0a0a0a",hint:"Wall color in dark mode (also used for browser chrome)",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--frame-color-dark",t),e.isDarkMode){const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t),a.style.setProperty("--chrome-bg",t)}Promise.resolve().then(()=>wi).then(e=>{e.syncChromeColor()})}},{id:"wallPreset",label:"Material",stateKey:"wallPreset",type:"select",options:[{value:"pudding",label:"Pudding (thick, soft)"},{value:"rubber",label:"Rubber (balanced)"},{value:"jelly",label:"Jelly (soft, wobbly)"},{value:"trampoline",label:"Trampoline (bouncy)"},{value:"stiff",label:"Stiff (rigid)"}],default:"pudding",format:e=>e+"",onChange(e,t){((e,t)=>{Vn[e]&&(t.wallPreset=e)})(t,e),fa()}},{id:"wallThicknessVw",label:"Wall Thickness",stateKey:"wallThicknessVw",type:"range",min:0,max:8,step:.1,default:1.3,format:e=>e.toFixed(1)+"vw",parse:parseFloat,hint:"Wall tube thickness (content padding is layout-only)",onChange(){Promise.resolve().then(()=>Hn).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars(),Promise.resolve().then(()=>xr).then(({updateBlurFromWallThickness:e})=>{e()})})}},{id:"wallRadiusVw",label:"Corner Radius",stateKey:"wallRadiusVw",type:"range",min:0,max:12,step:.1,default:3.7,format:e=>e.toFixed(1)+"vw",parse:parseFloat,onChange(){Promise.resolve().then(()=>Hn).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars()})}},{id:"wallInset",label:"Collision Inset",stateKey:"wallInset",type:"range",min:0,max:20,step:1,default:2,format:e=>e+"px",parse:e=>parseInt(e,10),hint:"Physics padding inside the visual wall"},{id:"mobileWallThicknessXFactor",label:"Mobile L/R Thickness",stateKey:"mobileWallThicknessXFactor",type:"range",min:.5,max:3,step:.05,default:1.4,format:e=>e.toFixed(2)+"×",parse:parseFloat,hint:"Wall thickness multiplier for LEFT/RIGHT sides on mobile",onChange(){Promise.resolve().then(()=>Hn).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars()})}},{id:"mobileEdgeLabelsVisible",label:"Mobile Edge Labels",stateKey:"mobileEdgeLabelsVisible",type:"toggle",default:!0,hint:"Show side edge labels on mobile (chapter/copyright)",onChange(){Promise.resolve().then(()=>Hn).then(e=>{e.applyLayoutCSSVars()})}},{id:"mobileEdgeLabelSizeFactor",label:"Mobile Label Size",stateKey:"mobileEdgeLabelSizeFactor",type:"range",min:.3,max:2,step:.05,default:.85,format:e=>e.toFixed(2)+"×",parse:parseFloat,hint:"Font size multiplier for edge labels on mobile",onChange(){Promise.resolve().then(()=>Hn).then(e=>{e.applyLayoutCSSVars()})}},{id:"mobileEdgeLabelOpacity",label:"Mobile Label Opacity",stateKey:"mobileEdgeLabelOpacity",type:"range",min:0,max:1,step:.05,default:.5,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,hint:"Opacity for edge labels on mobile",onChange(){Promise.resolve().then(()=>Hn).then(e=>{e.applyLayoutCSSVars()})}},{id:"wallWobbleMaxDeform",label:"Softness (Max Deform)",stateKey:"wallWobbleMaxDeform",type:"range",min:0,max:150,step:1,default:45,format:e=>e+"px",parse:e=>parseInt(e,10),group:"Material (Advanced)",groupCollapsed:!0},{id:"wallWobbleStiffness",label:"Elasticity (Stiffness)",stateKey:"wallWobbleStiffness",type:"range",min:50,max:3e3,step:10,default:2200,format:e=>e+"",parse:e=>parseInt(e,10),group:"Material (Advanced)"},{id:"wallWobbleDamping",label:"Damping (Viscosity)",stateKey:"wallWobbleDamping",type:"range",min:0,max:80,step:1,default:35,format:e=>e+"",parse:e=>parseInt(e,10),group:"Material (Advanced)"},{id:"wallWobbleSigma",label:"Blob Size (Spread)",stateKey:"wallWobbleSigma",type:"range",min:.5,max:6,step:.1,default:2,format:e=>e.toFixed(1),parse:parseFloat,group:"Material (Advanced)",hint:"Higher = larger, slower blobs (pudding/cloth). Lower = sharp ripples (rubber)."},{id:"wallWobbleCornerClamp",label:"Corner Grip",stateKey:"wallWobbleCornerClamp",type:"range",min:0,max:1,step:.01,default:.6,format:e=>e.toFixed(2),parse:parseFloat,group:"Material (Advanced)"},{id:"wallWobbleImpactThreshold",label:"Impact Gate",stateKey:"wallWobbleImpactThreshold",type:"range",min:20,max:200,step:1,default:140,format:e=>e+" px/s",parse:e=>parseInt(e,10),group:"Material (Advanced)",hint:"Minimum impact speed to move the wall."},{id:"wallWobbleSettlingSpeed",label:"Settle Speed",stateKey:"wallWobbleSettlingSpeed",type:"range",min:0,max:100,step:1,default:75,format:e=>e+"%",parse:e=>parseInt(e,10),group:"Material (Advanced)",hint:'How quickly the wall comes to rest (higher = more "thick").'},{id:"wallDeformPhysicsPrecision",label:"Deformation Physics",stateKey:"wallDeformPhysicsPrecision",type:"range",min:0,max:100,step:5,default:50,format:e=>e+"%",parse:e=>parseInt(e,10),group:"Material (Advanced)",hint:"How precisely balls interact with deformed wall (0=off, 100=most accurate but slower)."},{id:"wallWobbleMaxVel",label:"Max Wall Speed (Clamp)",stateKey:"wallWobbleMaxVel",type:"range",min:100,max:2e3,step:10,default:800,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Material (Advanced)",hint:"Caps wobble velocity to prevent erratic spikes (lower = heavier goo)."},{id:"wallWobbleMaxImpulse",label:"Max Impulse (Clamp)",stateKey:"wallWobbleMaxImpulse",type:"range",min:20,max:600,step:5,default:220,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Material (Advanced)",hint:"Caps per-sample impact injection (lower = smoother, less bottom chaos)."},{id:"wallWobbleMaxEnergyPerStep",label:"Max Energy / Tick",stateKey:"wallWobbleMaxEnergyPerStep",type:"range",min:1e3,max:8e4,step:500,default:2e4,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Material (Advanced)",hint:"Last-resort safety budget to prevent rare runaway spikes (higher = less limiting)."},{id:"wallPhysicsSamples",label:"Physics Samples",stateKey:"wallPhysicsSamples",type:"range",min:8,max:96,step:1,default:48,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Performance",groupCollapsed:!0,hint:"Visual-only. Lower = faster, higher = smoother blobs."},{id:"wallPhysicsSkipInactive",label:"Skip When Still",stateKey:"wallPhysicsSkipInactive",type:"toggle",default:!0,group:"Performance",hint:"Stops integrating the wall when it's already at rest."},{id:"wallRenderDecimation",label:"Render Detail",stateKey:"wallRenderDecimation",type:"range",min:1,max:12,step:1,default:2,format:e=>""+Math.round(e),parse:e=>parseInt(e,10),group:"Performance",hint:"1=ultra smooth, 2=default, 4=faster, 12=very fast/polygonal (rendering only)."}]},noise:{title:"Grain",icon:"🧂",defaultOpen:!1,controls:[{id:"noiseEnabled",label:"Enabled",stateKey:"noiseEnabled",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,group:"Render",hint:"Procedural noise texture (no GIF).",onChange:(e,t)=>Ut({noiseEnabled:t})},{id:"noiseSeed",label:"Seed",stateKey:"noiseSeed",type:"range",min:0,max:999999,step:1,default:1337,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Texture",hint:"Changes the generated grain pattern.",onChange:(e,t)=>Ut({noiseSeed:t})},{id:"noiseTextureSize",label:"Tile Size",stateKey:"noiseTextureSize",type:"range",min:64,max:512,step:32,default:256,format:e=>Math.round(e)+" px",parse:e=>parseInt(e,10),group:"Texture",hint:"Bigger tiles reduce repetition but cost more memory.",onChange:(e,t)=>Ut({noiseTextureSize:t})},{id:"noiseDistribution",label:"Distribution",stateKey:"noiseDistribution",type:"select",options:[{value:"gaussian",label:"Gaussian (filmic)"},{value:"uniform",label:"Uniform (flat)"}],default:"gaussian",format:e=>e+"",parse:e=>e+"",group:"Texture",onChange:(e,t)=>Ut({noiseDistribution:t})},{id:"noiseMonochrome",label:"Monochrome",stateKey:"noiseMonochrome",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,group:"Texture",hint:"Off = subtle RGB grain.",onChange:(e,t)=>Ut({noiseMonochrome:t})},{id:"noiseChroma",label:"Chroma",stateKey:"noiseChroma",type:"range",min:0,max:1,step:.01,default:.35,format:e=>Math.round(100*e)+"%",parse:parseFloat,group:"Texture",hint:"How different R/G/B channels are (ignored when Monochrome is on).",onChange:(e,t)=>Ut({noiseChroma:t})},{id:"noiseSizeBase",label:"Back Scale",stateKey:"noiseSizeBase",type:"range",min:20,max:400,step:5,default:100,format:e=>Math.round(e)+" px",parse:e=>parseInt(e,10),group:"Layers",onChange:(e,t)=>Ut({noiseSizeBase:t})},{id:"noiseSizeTop",label:"Front Scale",stateKey:"noiseSizeTop",type:"range",min:20,max:600,step:5,default:150,format:e=>Math.round(e)+" px",parse:e=>parseInt(e,10),group:"Layers",onChange:(e,t)=>Ut({noiseSizeTop:t})},{id:"noiseTopOpacity",label:"Top Opacity",stateKey:"noiseTopOpacity",type:"range",min:0,max:.25,step:.005,default:.01,format:e=>e.toFixed(3),parse:parseFloat,group:"Layers",hint:"Extra subtle layer (used by .noise-3).",onChange:(e,t)=>Ut({noiseTopOpacity:t})},{id:"noiseBackOpacity",label:"Back Opacity (Light)",stateKey:"noiseBackOpacity",type:"range",min:0,max:.3,step:.005,default:.025,format:e=>e.toFixed(3),parse:parseFloat,group:"Layers",onChange:(e,t)=>Ut({noiseBackOpacity:t})},{id:"noiseFrontOpacity",label:"Front Opacity (Light)",stateKey:"noiseFrontOpacity",type:"range",min:0,max:.3,step:.005,default:.055,format:e=>e.toFixed(3),parse:parseFloat,group:"Layers",onChange:(e,t)=>Ut({noiseFrontOpacity:t})},{id:"noiseBackOpacityDark",label:"Back Opacity (Dark)",stateKey:"noiseBackOpacityDark",type:"range",min:0,max:.5,step:.005,default:.12,format:e=>e.toFixed(3),parse:parseFloat,group:"Layers",onChange:(e,t)=>Ut({noiseBackOpacityDark:t})},{id:"noiseFrontOpacityDark",label:"Front Opacity (Dark)",stateKey:"noiseFrontOpacityDark",type:"range",min:0,max:.5,step:.005,default:.08,format:e=>e.toFixed(3),parse:parseFloat,group:"Layers",onChange:(e,t)=>Ut({noiseFrontOpacityDark:t})},{id:"noiseMotion",label:"Motion",stateKey:"noiseMotion",type:"select",options:[{value:"jitter",label:"Jitter (film grain)"},{value:"drift",label:"Drift (slow pan)"},{value:"static",label:"Static"}],default:"jitter",format:e=>e+"",parse:e=>e+"",group:"Motion",onChange:(e,t)=>Ut({noiseMotion:t})},{id:"noiseMotionAmount",label:"Motion Amount",stateKey:"noiseMotionAmount",type:"range",min:0,max:2.5,step:.01,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,group:"Motion",onChange:(e,t)=>Ut({noiseMotionAmount:t})},{id:"noiseSpeedBackMs",label:"Back Speed",stateKey:"noiseSpeedBackMs",type:"range",min:0,max:1e4,step:50,default:1800,format:e=>Math.round(e)+" ms",parse:e=>parseInt(e,10),group:"Motion",onChange:(e,t)=>Ut({noiseSpeedBackMs:t})},{id:"noiseSpeedFrontMs",label:"Front Speed",stateKey:"noiseSpeedFrontMs",type:"range",min:0,max:1e4,step:50,default:1100,format:e=>Math.round(e)+" ms",parse:e=>parseInt(e,10),group:"Motion",onChange:(e,t)=>Ut({noiseSpeedFrontMs:t})},{id:"noiseFlicker",label:"Flicker",stateKey:"noiseFlicker",type:"range",min:0,max:1,step:.01,default:.12,format:e=>Math.round(100*e)+"%",parse:parseFloat,group:"Motion",onChange:(e,t)=>Ut({noiseFlicker:t})},{id:"noiseFlickerSpeedMs",label:"Flicker Speed",stateKey:"noiseFlickerSpeedMs",type:"range",min:0,max:5e3,step:20,default:220,format:e=>Math.round(e)+" ms",parse:e=>parseInt(e,10),group:"Motion",onChange:(e,t)=>Ut({noiseFlickerSpeedMs:t})},{id:"noiseBlurPx",label:"Blur",stateKey:"noiseBlurPx",type:"range",min:0,max:6,step:.05,default:0,format:e=>e.toFixed(2)+" px",parse:parseFloat,group:"Look",onChange:(e,t)=>Ut({noiseBlurPx:t})},{id:"noiseContrast",label:"Contrast",stateKey:"noiseContrast",type:"range",min:.25,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"x",parse:parseFloat,group:"Look",onChange:(e,t)=>Ut({noiseContrast:t})},{id:"noiseBrightness",label:"Brightness",stateKey:"noiseBrightness",type:"range",min:.25,max:2,step:.01,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,group:"Look",onChange:(e,t)=>Ut({noiseBrightness:t})},{id:"noiseSaturation",label:"Saturation",stateKey:"noiseSaturation",type:"range",min:0,max:3,step:.01,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,group:"Look",onChange:(e,t)=>Ut({noiseSaturation:t})},{id:"noiseHue",label:"Hue Rotate",stateKey:"noiseHue",type:"range",min:0,max:360,step:1,default:0,format:e=>Math.round(e)+"°",parse:e=>parseInt(e,10),group:"Look",onChange:(e,t)=>Ut({noiseHue:t})}]},critters:{title:"Critters",icon:"🪲",mode:"critters",defaultOpen:!1,controls:[{id:"critterCount",label:"Count",stateKey:"critterCount",type:"range",min:10,max:260,step:5,default:90,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"critterSpeed",label:"Speed",stateKey:"critterSpeed",type:"range",min:0,max:1800,step:10,default:680,format:e=>""+Math.round(e),parse:parseFloat},{id:"critterMaxSpeed",label:"Max Speed",stateKey:"critterMaxSpeed",type:"range",min:200,max:4e3,step:25,default:1400,format:e=>""+Math.round(e),parse:parseFloat},{id:"critterStepHz",label:"Step Rate",stateKey:"critterStepHz",type:"range",min:0,max:16,step:.1,default:5,format:e=>e.toFixed(1)+" Hz",parse:parseFloat},{id:"critterStepSharpness",label:"Step Sharpness",stateKey:"critterStepSharpness",type:"range",min:.5,max:6,step:.1,default:2.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnNoise",label:"Wander",stateKey:"critterTurnNoise",type:"range",min:0,max:8,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnDamp",label:"Turn Inertia",stateKey:"critterTurnDamp",type:"range",min:.5,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnSeek",label:"Steering",stateKey:"critterTurnSeek",type:"range",min:0,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterAvoidRadius",label:"Avoid Radius",stateKey:"critterAvoidRadius",type:"range",min:0,max:260,step:5,default:90,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"critterAvoidForce",label:"Avoid Force",stateKey:"critterAvoidForce",type:"range",min:0,max:25e3,step:250,default:9500,format:e=>Math.round(e)+"",parse:parseFloat},{id:"critterEdgeAvoid",label:"Edge Avoid",stateKey:"critterEdgeAvoid",type:"range",min:0,max:3,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat},{id:"critterMousePull",label:"Mouse Fear",stateKey:"critterMousePull",type:"range",min:0,max:4,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Flee strength inside the mouse zone"},{id:"critterMouseRadiusVw",label:"Mouse Zone",stateKey:"critterMouseRadiusVw",type:"range",min:0,max:80,step:1,default:30,format:e=>Math.round(e)+"vw",parse:parseFloat},{id:"critterRestitution",label:"Bounciness",stateKey:"critterRestitution",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat,hint:"Mode-only override",onChange(e,t){"critters"===e.currentMode&&(e.REST=t)}},{id:"critterFriction",label:"Friction",stateKey:"critterFriction",type:"range",min:0,max:.06,step:.001,default:.018,format:e=>e.toFixed(3),parse:parseFloat,hint:"Mode-only override",onChange(e,t){"critters"===e.currentMode&&(e.FRICTION=t)}},na("crittersWarmupFrames")]},pit:{title:"Ball Pit",icon:"🎯",mode:"pit",defaultOpen:!1,controls:[{id:"gravityPit",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange(e,t){"pit"===e.currentMode&&(e.G=e.GE*t)}},{id:"repelPower",label:"Repel Power",stateKey:"repelPower",type:"range",min:0,max:1e4,step:100,default:8500,format:e=>""+Math.round(e),parse:parseFloat,onChange(e,t){e.repelPower=24e3*Math.pow(2,12*(Math.max(0,Math.min(1e4,t))/1e4-.5))}},{id:"sleepVelocityThreshold",label:"Sleep Speed",stateKey:"sleepVelocityThreshold",type:"range",min:0,max:40,step:.5,default:12,format:e=>(+e).toFixed(1)+" px/s",parse:parseFloat,hint:"Pit modes only. Higher = settles sooner."},{id:"sleepAngularThreshold",label:"Sleep Spin",stateKey:"sleepAngularThreshold",type:"range",min:0,max:1,step:.01,default:.18,format:e=>(+e).toFixed(2)+" rad/s",parse:parseFloat,hint:"Pit modes only. Higher = stops spinning sooner."},{id:"timeToSleep",label:"Sleep Time",stateKey:"timeToSleep",type:"range",min:.05,max:2,step:.05,default:.25,format:e=>(+e).toFixed(2)+"s",parse:parseFloat,hint:"Pit modes only. Lower = sleeps faster."},na("pitWarmupFrames")]},pitThrows:{title:"Ball Pit (Throws)",icon:"🎯",mode:"pit-throws",defaultOpen:!1,controls:[{id:"gravityPitThrows",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange(e,t){"pit-throws"===e.currentMode&&(e.G=e.GE*t)}},{id:"pitThrowsSpeed",label:"Throw Speed",stateKey:"pitThrowSpeed",type:"range",min:100,max:2e3,step:25,default:650,format:e=>Math.round(e)+"",parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpeedVar",label:"Speed Variance",stateKey:"pitThrowSpeedVar",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},{id:"sleepVelocityThresholdThrows",label:"Sleep Speed",stateKey:"sleepVelocityThreshold",type:"range",min:0,max:40,step:.5,default:12,format:e=>(+e).toFixed(1)+" px/s",parse:parseFloat,hint:"Pit modes only. Higher = settles sooner."},{id:"sleepAngularThresholdThrows",label:"Sleep Spin",stateKey:"sleepAngularThreshold",type:"range",min:0,max:1,step:.01,default:.18,format:e=>(+e).toFixed(2)+" rad/s",parse:parseFloat,hint:"Pit modes only. Higher = stops spinning sooner."},{id:"timeToSleepThrows",label:"Sleep Time",stateKey:"timeToSleep",type:"range",min:.05,max:2,step:.05,default:.25,format:e=>(+e).toFixed(2)+"s",parse:parseFloat,hint:"Pit modes only. Lower = sleeps faster."},{id:"pitThrowsInterval",label:"Throw Interval",stateKey:"pitThrowIntervalMs",type:"range",min:10,max:500,step:5,default:70,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsColorPause",label:"Color Pause",stateKey:"pitThrowColorPauseMs",type:"range",min:0,max:1200,step:10,default:180,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsPairChance",label:"Pair Chance",stateKey:"pitThrowPairChance",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsPairStagger",label:"Pair Stagger",stateKey:"pitThrowPairStaggerMs",type:"range",min:0,max:120,step:1,default:18,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsBatchSize",label:"Batch Size",stateKey:"pitThrowBatchSize",type:"range",min:1,max:60,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"pitThrowsTargetYFrac",label:"Throw Aim (Y)",stateKey:"pitThrowTargetYFrac",type:"range",min:.12,max:.7,step:.01,default:.36,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAngleJitter",label:"Angle Jitter",stateKey:"pitThrowAngleJitter",type:"range",min:0,max:.6,step:.01,default:.16,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpreadVar",label:"Spread Variance",stateKey:"pitThrowSpreadVar",type:"range",min:0,max:.8,step:.01,default:.25,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsSpeedJitter",label:"Speed Jitter",stateKey:"pitThrowSpeedJitter",type:"range",min:0,max:.8,step:.01,default:.22,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsInletInset",label:"Inlet Inset",stateKey:"pitThrowInletInset",type:"range",min:0,max:.2,step:.005,default:.06,format:e=>e.toFixed(3),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpawnSpread",label:"Spawn Spread",stateKey:"pitThrowSpawnSpread",type:"range",min:0,max:.12,step:.0025,default:.02,format:e=>e.toFixed(4),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAimJitter",label:"Aim Jitter",stateKey:"pitThrowAimJitter",type:"range",min:0,max:.2,step:.005,default:.04,format:e=>e.toFixed(3),parse:parseFloat},{id:"pitThrowsCrossBias",label:"Cross Aim",stateKey:"pitThrowCrossBias",type:"range",min:0,max:.3,step:.005,default:.12,format:e=>e.toFixed(3),parse:parseFloat},na("pitThrowsWarmupFrames")]},flies:{title:"Flies",icon:"🕊️",mode:"flies",defaultOpen:!1,controls:[{id:"fliesBallCount",label:"Ball Count",stateKey:"fliesBallCount",type:"range",min:20,max:150,step:5,default:60,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"attractPower",label:"Attraction",stateKey:"attractionPower",type:"range",min:100,max:8e3,step:50,default:5e3,format:e=>""+Math.round(e),parse:parseFloat},{id:"swarmSpeed",label:"Swarm Speed",stateKey:"swarmSpeed",type:"range",min:.2,max:5,step:.1,default:.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"fliesSeparation",label:"Separation",stateKey:"fliesSeparation",type:"range",min:5e3,max:3e4,step:1e3,default:15e3,format:e=>""+Math.round(e),parse:parseFloat},na("fliesWarmupFrames")]},weightless:{title:"Zero-G",icon:"🌌",mode:"weightless",defaultOpen:!1,controls:[{id:"weightlessCount",label:"Ball Count",stateKey:"weightlessCount",type:"range",min:20,max:200,step:10,default:80,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"weightlessSpeed",label:"Initial Speed",stateKey:"weightlessInitialSpeed",type:"range",min:100,max:600,step:25,default:250,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"weightlessBounce",label:"Bounce",stateKey:"weightlessBounce",type:"range",min:.5,max:1,step:.05,default:.95,format:e=>e.toFixed(2),parse:parseFloat},{id:"weightlessRepelPower",label:"Cursor Blast Power",stateKey:"weightlessRepelPower",type:"range",min:0,max:6e5,step:1e4,default:22e4,format:e=>""+Math.round(e),parse:parseFloat},{id:"weightlessRepelSoft",label:"Cursor Blast Falloff",stateKey:"weightlessRepelSoft",type:"range",min:.5,max:6,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},na("weightlessWarmupFrames")]},water:{title:"Water",icon:"🌊",mode:"water",defaultOpen:!1,controls:[{id:"waterBallCount",label:"Ball Count",stateKey:"waterBallCount",type:"range",min:50,max:400,step:10,default:300,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"waterDrag",label:"Water Resistance",stateKey:"waterDrag",type:"range",min:.001,max:.05,step:.001,default:.015,format:e=>e.toFixed(3),parse:parseFloat},{id:"waterRippleStrength",label:"Ripple Strength",stateKey:"waterRippleStrength",type:"range",min:5e3,max:3e4,step:1e3,default:18e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"waterMotion",label:"Drift Strength",stateKey:"waterDriftStrength",type:"range",min:0,max:80,step:1,default:40,format:e=>e.toFixed(0),parse:parseFloat,onChange(e,t){e.waterInitialVelocity=5*t},reinitMode:!0},na("waterWarmupFrames")]},vortex:{title:"Vortex",icon:"🌀",mode:"vortex",defaultOpen:!1,controls:[{id:"vortexBallCount",label:"Ball Count",stateKey:"vortexBallCount",type:"range",min:50,max:500,step:10,default:180,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"vortexSwirl",label:"Swirl Strength",stateKey:"vortexSwirlStrength",type:"range",min:100,max:3e3,step:50,default:420,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexPull",label:"Radial Pull",stateKey:"vortexRadialPull",type:"range",min:0,max:2e3,step:20,default:180,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexSpeedMultiplier",label:"Speed Multiplier",stateKey:"vortexSpeedMultiplier",type:"range",min:.1,max:3,step:.1,default:1,format:e=>e.toFixed(1),parse:parseFloat},{id:"vortexRadius",label:"Vortex Radius",stateKey:"vortexRadius",type:"range",min:0,max:800,step:20,default:0,format:e=>0===e?"Unlimited":e.toFixed(0)+"px",parse:parseFloat,tooltip:"Maximum effective radius (0 = unlimited, uses distance falloff)"},{id:"vortexFalloffCurve",label:"Falloff Curve",stateKey:"vortexFalloffCurve",type:"range",min:.3,max:3,step:.1,default:1,format:e=>e.toFixed(1),parse:parseFloat,tooltip:"Falloff shape: 1.0 = linear, 2.0 = quadratic (sharper), 0.5 = gentle"},{id:"vortexRotationDirection",label:"Rotation Direction",stateKey:"vortexRotationDirection",type:"range",min:-1,max:1,step:2,default:1,format:e=>1===e?"Counterclockwise":"Clockwise",parse:parseFloat},{id:"vortexCoreStrength",label:"Core Strength",stateKey:"vortexCoreStrength",type:"range",min:.5,max:3,step:.1,default:1,format:e=>e.toFixed(1)+"x",parse:parseFloat,tooltip:"Strength multiplier at vortex center"},{id:"vortexAccelerationZone",label:"Acceleration Zone",stateKey:"vortexAccelerationZone",type:"range",min:0,max:400,step:20,default:0,format:e=>0===e?"Disabled":e.toFixed(0)+"px",parse:parseFloat,tooltip:"Radius where extra acceleration occurs (0 = disabled)"},{id:"vortexOutwardPush",label:"Outward Push",stateKey:"vortexOutwardPush",type:"range",min:0,max:1e3,step:20,default:0,format:e=>0===e?"Disabled":e.toFixed(0),parse:parseFloat,tooltip:"Outward force at edges (only when radius is set)"},{id:"vortexDrag",label:"Drag",stateKey:"vortexDrag",type:"range",min:.001,max:.05,step:.001,default:.005,format:e=>e.toFixed(3),parse:parseFloat},na("vortexWarmupFrames")]},"ping-pong":{title:"Ping Pong",icon:"🏓",mode:"ping-pong",defaultOpen:!1,controls:[{id:"pingPongBallCount",label:"Ball Count",stateKey:"pingPongBallCount",type:"range",min:10,max:100,step:5,default:35,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"pingPongSpeed",label:"Ball Speed",stateKey:"pingPongSpeed",type:"range",min:200,max:1600,step:50,default:800,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"pingPongVerticalDamp",label:"Vertical Damping",stateKey:"pingPongVerticalDamp",type:"range",min:.8,max:.999,step:.001,default:.995,format:e=>e.toFixed(3),parse:parseFloat},na("pingPongWarmupFrames")]},magnetic:{title:"Magnetic",icon:"🧲",mode:"magnetic",defaultOpen:!1,controls:[{id:"magneticBallCount",label:"Ball Count",stateKey:"magneticBallCount",type:"range",min:50,max:300,step:10,default:180,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"magneticStrength",label:"Strength",stateKey:"magneticStrength",type:"range",min:1e4,max:1e5,step:5e3,default:65e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticVelocity",label:"Max Velocity",stateKey:"magneticMaxVelocity",type:"range",min:500,max:4e3,step:100,default:2800,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticDamping",label:"Damping",stateKey:"magneticDamping",type:"range",min:.8,max:.999,step:.001,default:.98,format:e=>e.toFixed(3),parse:parseFloat},na("magneticWarmupFrames")]},bubbles:{title:"Bubbles",icon:"🫧",mode:"bubbles",defaultOpen:!1,controls:[{id:"bubblesRate",label:"Bubble Rate",stateKey:"bubblesSpawnRate",type:"range",min:1,max:20,step:1,default:8,format:e=>e+"",parse:e=>parseInt(e,10)},{id:"bubblesSpeed",label:"Rise Speed",stateKey:"bubblesRiseSpeed",type:"range",min:50,max:400,step:25,default:150,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesWobble",label:"Wobble",stateKey:"bubblesWobble",type:"range",min:0,max:100,step:5,default:40,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesMax",label:"Max Bubbles",stateKey:"bubblesMaxCount",type:"range",min:50,max:300,step:10,default:150,format:e=>e+"",parse:e=>parseInt(e,10)},na("bubblesWarmupFrames")]},tilt:{title:"Tilt",icon:"⚖️",mode:"tilt",defaultOpen:!1,controls:[{id:"tiltBallCount",label:"Particle Count",stateKey:"tiltBallCount",type:"range",min:100,max:500,step:10,default:300,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"tiltMaxAngle",label:"Max Angle",stateKey:"tiltMaxAngle",type:"range",min:.5,max:10,step:.5,default:2,format:e=>e.toFixed(1)+"°",parse:parseFloat},{id:"tiltLerpSpeed",label:"Smoothness",stateKey:"tiltLerpSpeed",type:"range",min:.01,max:.5,step:.01,default:.08,format:e=>e.toFixed(2),parse:parseFloat},{id:"tiltGlassMass",label:"Particle Mass",stateKey:"tiltGlassBallMass",type:"range",min:.02,max:.3,step:.01,default:.08,format:e=>e.toFixed(2)+"x",parse:parseFloat,reinitMode:!0},{id:"tiltFriction",label:"Friction",stateKey:"tiltFriction",type:"range",min:.002,max:.02,step:.001,default:.008,format:e=>e.toFixed(3),parse:parseFloat}]},kaleidoscope:{title:"Kaleidoscope",icon:"🪞",mode:"kaleidoscope",defaultOpen:!1,controls:[{id:"kaleiBallCount",label:"Ball Count",stateKey:"kaleidoscopeBallCount",type:"range",min:15,max:120,step:1,default:23,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kaleiWedges",label:"Wedges",stateKey:"kaleidoscopeWedges",type:"range",min:4,max:16,step:1,default:12,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kaleiMirror",label:"Mirror",type:"range",min:0,max:1,step:1,default:1,format:e=>e?"On":"Off",parse:e=>parseInt(e,10)},{id:"kaleiSpeed",label:"Speed",stateKey:"kaleidoscopeSpeed",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat},{id:"kaleiDotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscopeDotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kaleiDotAreaMul",label:"Dot Area",stateKey:"kaleidoscopeDotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kaleiSpawnArea",label:"Spawn Density",stateKey:"kaleidoscopeSpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kaleiSizeVar",label:"Size Variance",stateKey:"kaleidoscopeSizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},na("kaleidoscopeWarmupFrames")]},kaleidoscope1:{title:"Kaleidoscope I (Variant)",icon:"🪞",mode:"kaleidoscope-1",defaultOpen:!1,controls:[{id:"kalei1BallCount",label:"Ball Count",stateKey:"kaleidoscope1BallCount",type:"range",min:6,max:180,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei1Wedges",label:"Wedges",stateKey:"kaleidoscope1Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei1Speed",label:"Speed",stateKey:"kaleidoscope1Speed",type:"range",min:.2,max:2,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei1DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope1DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei1DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope1DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei1SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope1SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei1SizeVar",label:"Size Variance",stateKey:"kaleidoscope1SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},na("kaleidoscope1WarmupFrames")]},kaleidoscope2:{title:"Kaleidoscope II (Variant)",icon:"🪞",mode:"kaleidoscope-2",defaultOpen:!1,controls:[{id:"kalei2BallCount",label:"Ball Count",stateKey:"kaleidoscope2BallCount",type:"range",min:10,max:260,step:2,default:36,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei2Wedges",label:"Wedges",stateKey:"kaleidoscope2Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei2Speed",label:"Speed",stateKey:"kaleidoscope2Speed",type:"range",min:.2,max:2,step:.05,default:1.15,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei2DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope2DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei2DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope2DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei2SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope2SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei2SizeVar",label:"Size Variance",stateKey:"kaleidoscope2SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},na("kaleidoscope2WarmupFrames")]},kaleidoscope3:{title:"Kaleidoscope III (Variant)",icon:"🪞",mode:"kaleidoscope-3",defaultOpen:!1,controls:[{id:"kalei3BallCount",label:"Ball Count",stateKey:"kaleidoscope3BallCount",type:"range",min:12,max:300,step:3,default:54,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei3Wedges",label:"Wedges",stateKey:"kaleidoscope3Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei3Speed",label:"Speed",stateKey:"kaleidoscope3Speed",type:"range",min:.2,max:2,step:.05,default:1.55,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei3DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope3DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei3DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope3DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei3SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope3SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei3SizeVar",label:"Size Variance",stateKey:"kaleidoscope3SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},na("kaleidoscope3WarmupFrames")]},orbit3d:{title:"Orbit 3D: Zero Gravity",icon:"🌪️",mode:"orbit-3d",defaultOpen:!1,controls:[{id:"orbit3dMoonCount",label:"Body Count",stateKey:"orbit3dMoonCount",type:"range",min:10,max:200,step:10,default:80,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"orbit3dGravity",label:"Gravity Pull",stateKey:"orbit3dGravity",type:"range",min:1e3,max:1e4,step:500,default:5e3,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3dVelocityMult",label:"Orbital Speed",stateKey:"orbit3dVelocityMult",type:"range",min:50,max:300,step:10,default:150,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3dDepthScale",label:"Depth Effect",stateKey:"orbit3dDepthScale",type:"range",min:0,max:1.5,step:.1,default:.8,format:e=>e.toFixed(1),parse:parseFloat},{id:"orbit3dDamping",label:"Stability",stateKey:"orbit3dDamping",type:"range",min:.005,max:.05,step:.005,default:.02,format:e=>e.toFixed(3),parse:parseFloat},{id:"sizeVariationOrbit3d",label:"Size Variation",stateKey:"sizeVariationOrbit3d",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},na("orbit3dWarmupFrames")]},orbit3d2:{title:"Orbit 3D (Tight Swarm)",icon:"🌪️",mode:"orbit-3d-2",defaultOpen:!1,controls:[{id:"orbit3d2MoonCount",label:"Moon Count",stateKey:"orbit3d2MoonCount",type:"range",min:20,max:200,step:10,default:100,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"orbit3d2Gravity",label:"Gravity (G×M)",stateKey:"orbit3d2Gravity",type:"range",min:1e4,max:3e5,step:1e4,default:8e4,format:e=>Math.round(e/1e3)+"k",parse:parseFloat,reinitMode:!0},{id:"orbit3d2VelocityMult",label:"Initial Velocity",stateKey:"orbit3d2VelocityMult",type:"range",min:.5,max:1.5,step:.05,default:1.1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"orbit3d2MinOrbit",label:"Min Orbit (vw)",stateKey:"orbit3d2MinOrbit",type:"range",min:2,max:15,step:1,default:4,format:e=>e+"vw",parse:parseFloat,reinitMode:!0},{id:"orbit3d2MaxOrbit",label:"Max Orbit (vw)",stateKey:"orbit3d2MaxOrbit",type:"range",min:3,max:25,step:1,default:12,format:e=>e+"vw",parse:parseFloat,reinitMode:!0},{id:"orbit3d2DepthScale",label:"Depth Effect",stateKey:"orbit3d2DepthScale",type:"range",min:0,max:.8,step:.05,default:.6,format:e=>e.toFixed(2),parse:parseFloat},{id:"orbit3d2Damping",label:"Damping",stateKey:"orbit3d2Damping",type:"range",min:0,max:.2,step:.005,default:.01,format:e=>e.toFixed(3),parse:parseFloat},{id:"orbit3d2FollowSmoothing",label:"Cursor Follow Speed",stateKey:"orbit3d2FollowSmoothing",type:"range",min:1,max:200,step:1,default:40,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3d2Softening",label:"Gravity Softening",stateKey:"orbit3d2Softening",type:"range",min:1,max:100,step:1,default:15,format:e=>Math.round(e),parse:parseFloat},{id:"sizeVariationOrbit3d2",label:"Size Variation",stateKey:"sizeVariationOrbit3d2",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},na("orbit3d2WarmupFrames")]},lattice:{title:"Crystal Lattice",icon:"💎",mode:"lattice",defaultOpen:!1,controls:[{id:"sizeVariationLattice",label:"Size Variation",stateKey:"sizeVariationLattice",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"latticeSpacingVw",label:"Spacing (vw)",stateKey:"latticeSpacingVw",type:"range",min:1,max:20,step:.25,default:8.5,format:e=>e.toFixed(2)+"vw",parse:parseFloat,reinitMode:!0},{id:"latticeStiffness",label:"Stiffness",stateKey:"latticeStiffness",type:"range",min:0,max:10,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},{id:"latticeDamping",label:"Damping",stateKey:"latticeDamping",type:"range",min:.5,max:1,step:.01,default:.92,format:e=>e.toFixed(2),parse:parseFloat},{id:"latticeDisruptRadius",label:"Mesh Stretch Radius",stateKey:"latticeDisruptRadius",type:"range",min:50,max:1e3,step:25,default:600,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"latticeDisruptPower",label:"Mesh Stretch Power",stateKey:"latticeDisruptPower",type:"range",min:0,max:50,step:1,default:25,format:e=>e.toFixed(1),parse:parseFloat},{id:"latticeMeshWaveStrength",label:"Wave Amplitude",stateKey:"latticeMeshWaveStrength",type:"range",min:0,max:50,step:1,default:12,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"latticeMeshWaveSpeed",label:"Wave Speed",stateKey:"latticeMeshWaveSpeed",type:"range",min:0,max:3,step:.1,default:.8,format:e=>e.toFixed(1)+"x",parse:parseFloat},{id:"latticeAlignment",label:"Grid Alignment",stateKey:"latticeAlignment",type:"select",options:[{value:"center",label:"Center (Fill)"},{value:"top-left",label:"Top-Left"},{value:"top-center",label:"Top-Center"},{value:"top-right",label:"Top-Right"}],default:"center",format:e=>e+"",parse:e=>e+"",reinitMode:!0},na("latticeWarmupFrames")]},neural:{title:"Neural Network",icon:"🧠",mode:"neural",defaultOpen:!1,controls:[{id:"neuralBallCount",label:"Ball Count",stateKey:"neuralBallCount",type:"range",min:8,max:260,step:1,default:80,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"sizeVariationNeural",label:"Size Variation",stateKey:"sizeVariationNeural",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"neuralWanderStrength",label:"Wander Strength",stateKey:"neuralWanderStrength",type:"range",min:0,max:2e3,step:10,default:420,format:e=>Math.round(e)+"",parse:parseFloat},{id:"neuralDamping",label:"Damping",stateKey:"neuralDamping",type:"range",min:.8,max:1,step:.005,default:.985,format:e=>e.toFixed(3),parse:parseFloat},{id:"neuralCohesion",label:"Cohesion",stateKey:"neuralCohesion",type:"range",min:0,max:1,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},na("neuralWarmupFrames")]},parallaxLinear:{title:"Parallax (Linear)",icon:"🫧",mode:"parallax-linear",defaultOpen:!1,controls:[{id:"parallaxLinearPreset",label:"Preset",stateKey:"parallaxLinearPreset",type:"select",options:Object.keys($n).map(e=>({value:e,label:$n[e].label})),default:"default",format:e=>$n[e]?.label||e,onChange(e){ta(e,!0)}},{id:"parallaxLinearDotSizeMul",label:"Dot Size",stateKey:"parallaxLinearDotSizeMul",type:"range",min:.2,max:6,step:.1,default:1.8,format:e=>e.toFixed(1)+"×",parse:parseFloat,reinitMode:!0},{id:"sizeVariationParallaxLinear",label:"Size Variation",stateKey:"sizeVariationParallaxLinear",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"parallaxLinearGridX",label:"Grid X (Cols)",stateKey:"parallaxLinearGridX",type:"range",min:3,max:40,step:1,default:14,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearGridY",label:"Grid Y (Rows)",stateKey:"parallaxLinearGridY",type:"range",min:3,max:40,step:1,default:10,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearGridZ",label:"Grid Z (Layers)",stateKey:"parallaxLinearGridZ",type:"range",min:2,max:20,step:1,default:7,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearSpanX",label:"Span X",stateKey:"parallaxLinearSpanX",type:"range",min:.2,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0,hint:"World-space width as a multiple of the viewport width. Use >1 to fill edge-to-edge."},{id:"parallaxLinearSpanY",label:"Span Y",stateKey:"parallaxLinearSpanY",type:"range",min:.2,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0,hint:"World-space height as a multiple of the viewport height."},{id:"parallaxLinearZNear",label:"Z Near",stateKey:"parallaxLinearZNear",type:"range",min:10,max:1200,step:10,default:50,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearZFar",label:"Z Far",stateKey:"parallaxLinearZFar",type:"range",min:50,max:3e3,step:25,default:900,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearFocalLength",label:"Focal Length",stateKey:"parallaxLinearFocalLength",type:"range",min:80,max:2e3,step:10,default:420,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10)},{id:"parallaxLinearParallaxStrength",label:"Parallax Strength",stateKey:"parallaxLinearParallaxStrength",type:"range",min:0,max:2e3,step:10,default:260,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},na("parallaxLinearWarmupFrames")]},parallaxPerspective:{title:"Parallax (Perspective)",icon:"🫧",mode:"parallax-perspective",defaultOpen:!1,controls:[{id:"parallaxPerspectivePreset",label:"Preset",stateKey:"parallaxPerspectivePreset",type:"select",options:Object.keys(Nn).map(e=>({value:e,label:Nn[e].label})),default:"default",format:e=>Nn[e]?.label||e,onChange(e){aa(e,!0)}},{id:"parallaxPerspectiveRandomness",label:"Randomness",stateKey:"parallaxPerspectiveRandomness",type:"range",min:0,max:1,step:.05,default:.6,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0,hint:"0 = perfect grid. 1 = full jitter from grid vertices."},{id:"parallaxPerspectiveDotSizeMul",label:"Dot Size",stateKey:"parallaxPerspectiveDotSizeMul",type:"range",min:.2,max:6,step:.1,default:1.8,format:e=>e.toFixed(1)+"×",parse:parseFloat,reinitMode:!0},{id:"sizeVariationParallaxPerspective",label:"Size Variation",stateKey:"sizeVariationParallaxPerspective",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveGridX",label:"Grid X (Cols)",stateKey:"parallaxPerspectiveGridX",type:"range",min:3,max:50,step:1,default:16,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveGridY",label:"Grid Y (Rows)",stateKey:"parallaxPerspectiveGridY",type:"range",min:3,max:50,step:1,default:12,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveGridZ",label:"Grid Z (Layers)",stateKey:"parallaxPerspectiveGridZ",type:"range",min:2,max:25,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveSpanX",label:"Span X",stateKey:"parallaxPerspectiveSpanX",type:"range",min:.2,max:3,step:.05,default:1.45,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveSpanY",label:"Span Y",stateKey:"parallaxPerspectiveSpanY",type:"range",min:.2,max:3,step:.05,default:1.45,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveZNear",label:"Z Near",stateKey:"parallaxPerspectiveZNear",type:"range",min:10,max:1200,step:10,default:40,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveZFar",label:"Z Far",stateKey:"parallaxPerspectiveZFar",type:"range",min:50,max:4e3,step:50,default:1200,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveFocalLength",label:"Focal Length",stateKey:"parallaxPerspectiveFocalLength",type:"range",min:80,max:2e3,step:10,default:420,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10)},{id:"parallaxPerspectiveParallaxStrength",label:"Parallax Strength",stateKey:"parallaxPerspectiveParallaxStrength",type:"range",min:0,max:2e3,step:10,default:280,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},na("parallaxPerspectiveWarmupFrames")]},entrance:{title:"Entrance",icon:"🎭",defaultOpen:!1,controls:[{id:"entranceEnabled",label:"Enabled",stateKey:"entranceEnabled",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,hint:"Enable dramatic entrance animation (browser default → wall-state)",onChange(){"undefined"!=typeof window&&setTimeout(()=>window.location.reload(),300)}},{id:"entranceWallTransitionDelay",label:"Wall Transition Delay",stateKey:"entranceWallTransitionDelay",type:"range",min:0,max:2e3,step:50,default:300,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Delay before wall background transition starts"},{id:"entranceWallTransitionDuration",label:"Wall Growth Duration",stateKey:"entranceWallTransitionDuration",type:"range",min:200,max:2e3,step:50,default:800,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration of wall scaling down into viewport animation"},{id:"entranceWallInitialScale",label:"Initial Scale",stateKey:"entranceWallInitialScale",type:"range",min:1.05,max:1.5,step:.05,default:1.1,format:e=>e.toFixed(2),parse:e=>parseFloat(e),hint:"Starting scale (wall starts slightly larger, scales down to 1.0)"},{id:"entranceWallEasing",label:"Wall Growth Easing",stateKey:"entranceWallEasing",type:"select",options:[{value:"cubic-bezier(0.16, 1, 0.3, 1)",label:"Organic (default)"},{value:"ease-out",label:"Ease Out"},{value:"ease-in-out",label:"Ease In Out"},{value:"cubic-bezier(0.34, 1.56, 0.64, 1)",label:"Bounce"},{value:"cubic-bezier(0.68, -0.55, 0.265, 1.55)",label:"Overshoot"}],default:"cubic-bezier(0.16, 1, 0.3, 1)",format:e=>e+"",parse:e=>e+"",hint:"Easing function for wall growth animation"},{id:"entranceElementDuration",label:"Element Duration",stateKey:"entranceElementDuration",type:"range",min:100,max:1e3,step:50,default:200,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration for individual element animations"},{id:"entranceElementScaleStart",label:"Element Scale Start",stateKey:"entranceElementScaleStart",type:"range",min:.5,max:1,step:.01,default:.95,format:e=>e.toFixed(2),parse:e=>parseFloat(e),hint:"Initial scale for elements (0-1)"},{id:"entranceElementTranslateZStart",label:"Element Z Start",stateKey:"entranceElementTranslateZStart",type:"range",min:-100,max:0,step:5,default:-20,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Initial z-axis position (negative = back in 3D space)"},{id:"entrancePerspectiveLandscape",label:"Perspective (Landscape)",stateKey:"entrancePerspectiveLandscape",type:"range",min:500,max:3e3,step:50,default:1200,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"3D perspective for landscape aspect ratio",onChange(){Promise.resolve().then(()=>ys).then(({applyPerspectiveCSS:e})=>{e()}).catch(()=>{})}},{id:"entrancePerspectiveSquare",label:"Perspective (Square)",stateKey:"entrancePerspectiveSquare",type:"range",min:500,max:3e3,step:50,default:1e3,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"3D perspective for square aspect ratio",onChange(){Promise.resolve().then(()=>ys).then(({applyPerspectiveCSS:e})=>{e()}).catch(()=>{})}},{id:"entrancePerspectivePortrait",label:"Perspective (Portrait)",stateKey:"entrancePerspectivePortrait",type:"range",min:500,max:3e3,step:50,default:800,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"3D perspective for portrait aspect ratio",onChange(){Promise.resolve().then(()=>ys).then(({applyPerspectiveCSS:e})=>{e()}).catch(()=>{})}}]}};var Qi=Object.freeze({__proto__:null,CONTROL_SECTIONS:Ji,MASTER_SECTION_KEYS:qi,applyParallaxLinearPreset:ta,applyParallaxPerspectivePreset:aa,bindRegisteredControls:ha,generateColorTemplateSectionHTML:ca,generateHomePanelHTML:pa,generateMasterSectionsHTML:da,generatePanelHTML:ua,generateThemeSectionHTML:la,getAllControls:ia,isControlVisible:ea,setApplyVisualCSSVars(e){Yi=e},syncSlidersToState:fa}),er=Object.freeze({__proto__:null,setupIndexControls:ga,setupMasterControls:ma,updateModeButtonsUI:ba});ua();const tr=pa(),ar={core:{title:"Core",controls:[{id:"masterGain",label:"Master Volume",min:10,max:100,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"collisionMinImpact",label:"Silence Threshold",min:20,max:85,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e}]},envelope:{title:"Envelope",controls:[{id:"decayTime",label:"Click Length",min:20,max:180,step:1,format:e=>Math.round(e)+"ms",toConfig:e=>e/1e3,fromConfig:e=>1e3*e}]},tone:{title:"Tone",controls:[{id:"filterBaseFreq",label:"Brightness",min:300,max:6e3,step:50,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"harmonicGain",label:"Warmth",min:0,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"filterQ",label:"Resonance",min:10,max:200,step:5,format:e=>""+(e/100).toFixed(2),toConfig:e=>e/100,fromConfig:e=>100*e}]},crystal:{title:"Crystal",controls:[{id:"pitchMinHz",label:"Pitch Low",min:80,max:1200,step:10,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"pitchMaxHz",label:"Pitch High",min:200,max:4e3,step:20,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"pitchCurve",label:"Pitch Curve",min:70,max:160,step:1,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleGain",label:"Sparkle",min:0,max:35,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMin",label:"Sparkle Min",min:120,max:600,step:10,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMax",label:"Sparkle Max",min:160,max:800,step:10,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleDecayMul",label:"Sparkle Decay",min:20,max:95,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"noiseTransientQ",label:"Sparkle Q",min:60,max:600,step:5,format:e=>""+(e/100).toFixed(2),toConfig:e=>e/100,fromConfig:e=>100*e}]},space:{title:"Space",controls:[{id:"reverbWetMix",label:"Reverb Mix",min:0,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"reverbDecay",label:"Room Size",min:5,max:80,step:1,format:e=>(e/100).toFixed(2)+"s",toConfig:e=>e/100,fromConfig:e=>100*e}]},dynamics:{title:"Dynamics",controls:[{id:"minGain",label:"Min Hit Volume",min:0,max:20,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"maxGain",label:"Max Hit Volume",min:5,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e}]},realism:{title:"Realism",controls:[{id:"noiseTransientGain",label:"Impact Snap",min:0,max:80,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"varianceGain",label:"Volume Variance",min:0,max:50,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"variancePitch",label:"Pitch Variance",min:0,max:25,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"velocityNoiseScale",label:"Hard Hit Crack",min:100,max:500,step:10,format:e=>(e/100).toFixed(1)+"×",toConfig:e=>e/100,fromConfig:e=>100*e}]}};let nr=null,or=null;const ir="panel_dock_position_v2",rr="panel_dock_hidden",sr="master_panel_collapsed",lr="panel_dock_size";let cr=!1,dr=0,pr=0,ur=0,hr=0,fr=!1;var mr=Object.freeze({__proto__:null,createPanelDock:va,resetPanelPositions:Ca,toggleDock:Pa});let gr=!1,br=null,Mr=!0,yr=null;const vr=new WeakMap;var xr=Object.freeze({__proto__:null,hideOverlay:Ra,initGateOverlay:Ka,isOverlayActive:za,mountGateIntoOverlay:Da,showOverlay:Ba,unmountGateFromOverlay:La,updateGateContentDelay(e){document.documentElement.style.setProperty("--gate-content-delay",e+"ms")},updateGateDepthScale(e){document.documentElement.style.setProperty("--gate-depth-scale",e)},updateGateDepthTranslateY(e){document.documentElement.style.setProperty("--gate-depth-translate-y",e+"px")},updateLogoBlurActive(e){const t=document.documentElement;t.style.setProperty("--logo-blur-active-target",e+"px"),za()&&t.style.setProperty("--logo-blur-active",e+"px")},updateLogoBlurInactive(e){const t=document.documentElement;t.style.setProperty("--logo-blur-inactive",e+"px"),za()||t.style.setProperty("--logo-blur-active",e+"px")},updateLogoOpacityActive(e){const t=document.documentElement,a=e;t.style.setProperty("--logo-opacity-active-target",a),za()&&t.style.setProperty("--logo-opacity-active",a)},updateLogoOpacityInactive(e){const t=document.documentElement;t.style.setProperty("--logo-opacity-inactive",e),za()||t.style.setProperty("--logo-opacity-active",e)},updateOverlayOpacity(e){br&&br.style.setProperty("--gate-overlay-opacity",e)},updateOverlayTransition(e){br&&(br.style.setProperty("--gate-overlay-transition-duration",e+"ms"),document.documentElement.style.setProperty("--gate-depth-duration",e+"ms"))},updateOverlayTransitionOut(e){br&&(br.style.setProperty("--gate-overlay-transition-out-duration",e+"ms"),document.documentElement.style.setProperty("--gate-depth-out-duration",e+"ms"))}});const wr="--abs-scene-impact",Sr="--abs-scene-impact-dur",kr="--abs-scene-impact-logo-scale";let Cr=null,Pr=!1,Fr=0,Tr=0,Dr=0,Lr=!1,Ir=0,Ar=0,Kr=0,Or=0,Er=!1,Br=null,Rr=0,zr=0,Wr=0,Vr=!1,$r=0,Nr=0,_r=0,Gr=0,Hr=0,jr=performance.now()/1e3,Zr=0,Yr=!0,Xr=null;const qr=1e3/60;let Ur=[],Jr=0,Qr=null;const es='<i class="ti ti-volume-off" aria-hidden="true"></i>';let ts=null;const as=new Map([["apple music",'<i class="ti ti-brand-apple" aria-hidden="true"></i>'],["instagram",'<i class="ti ti-brand-instagram" aria-hidden="true"></i>'],["linkedin",'<i class="ti ti-brand-linkedin" aria-hidden="true"></i>'],["x",'<i class="ti ti-brand-x" aria-hidden="true"></i>']]);var ns=Object.freeze({__proto__:null,applyExpertiseLegendColors:nn});let os=!1,is=null,rs=!1;const ss="abs-link-hovering",ls="abs-hover-mode-index",cs="abs-hover-mode-ui",ds="--abs-cursor-hop-dot-size",ps="abs-hover-pulse-ring",us="abs-hover-target",hs="abs-hover-target--index",fs="abs-hover-target--ui",ms="--abs-hover-index-bg",gs="--abs-hover-index-fg";let bs=!1;const Ms=['1em "Geist"','1em "Geist Mono"','1em "Sarina"','1em "tabler-icons"'];(async()=>{document.documentElement.classList.add("js-enabled");try{await(async()=>{if(Qr)return Qr;const e=Ya();if(e)return Qr=e,Qr;const t=await(async()=>{const e=["config/contents-home.json","js/contents-home.json","../public/js/contents-home.json","config/text.json","js/text.json","../public/js/text.json"];for(const a of e)try{const e=await fetch(a,{cache:"no-cache"});if(!e.ok)continue;const t=await e.json();if(Za(t))return t}catch(t){}throw Error("No contents-home.json found")})();Qr=t;try{"undefined"!=typeof window&&(window.__TEXT__=t)}catch(a){}return Qr})(),(()=>{try{(()=>{const e=Xa("meta.title","");e&&(document.title=e);const t=Xa("meta.description","");if(t){const e=document.querySelector('meta[name="description"]');e&&e.setAttribute("content",t)}})(),Pn(document.getElementById("edge-chapter-text"),Xa("edge.chapterText","")),Pn(document.querySelector(".edge-copyright__text"),Xa("edge.copyright","")),(()=>{const e=document.getElementById("expertise-legend");Fn(e,"aria-label",Xa("legend.ariaLabel",""));const t=Xa("legend.items",null);if(!Array.isArray(t)||!e)return;const a=e.querySelectorAll(".legend__item span");for(let n=0;a.length>n&&t.length>n;n++){const e=t?.[n]?.label;e&&(a[n].textContent=e)}})(),(()=>{const e=document.querySelector(".decorative-script p");if(!e)return;const t=Xa("philosophy.textBeforeLink",""),a=Xa("philosophy.link.id","contact-email-inline")||"contact-email-inline",n=Xa("philosophy.link.href","#")||"#",o=Xa("philosophy.link.text","")||"";let i=document.getElementById(a);if(i||(i=e.querySelector("a")),!i)return;i.id=a,i.setAttribute("href",n),i.textContent=o;const r=i.previousSibling;r&&r.nodeType===Node.TEXT_NODE?r.nodeValue=t:e.insertBefore(document.createTextNode(t),i);const s=i.nextSibling;s&&s.nodeType===Node.TEXT_NODE&&(s.nodeValue="")})(),(()=>{Fn(document.getElementById("footer-links-container"),"aria-label",Xa("footer.navAriaLabel",""));const e=Xa("footer.links",null);if(e&&"object"==typeof e)for(const t of["contact","portfolio","cv"]){const a=e?.[t];if(!a)continue;const n=document.getElementById(a.id||"");n&&(a.href&&n.setAttribute("href",a.href),a.text&&(n.textContent=a.text))}})(),(()=>{const e=document.getElementById("social-links");Fn(e,"aria-label",Xa("socials.ariaLabel",""));const t=Xa("socials.items",null);if(!e||!t||"object"!=typeof t)return;const a=["appleMusic","x","linkedin"],n=e.querySelectorAll("a.footer_icon-link");for(let o=0;n.length>o&&3>o;o++){const e=n[o],i=t?.[a[o]];if(!i)continue;i.url&&e.setAttribute("href",i.url),i.ariaLabel&&e.setAttribute("aria-label",i.ariaLabel);const r=e.querySelector(".screen-reader");r&&i.screenReaderText&&(r.textContent=i.screenReaderText)}})(),(()=>{const e=document.getElementById("header-cv-link");if(!e)return;const t=Xa("footer.links.cv",null);t&&"object"==typeof t&&(t.href&&e.setAttribute("href",t.href),t.text&&(e.textContent=t.text))})(),(()=>{const e=document.querySelector("[data-portfolio-ui] .decorative-script p");if(!e)return;const t=Xa("portfolio.blurb","");t&&(e.textContent=t)})()}catch(e){}})()}catch(e){}if(Pt())try{const e=await Promise.resolve().then(()=>Qi);e.setApplyVisualCSSVars?.(Dn)}catch(e){}try{Pt()&&Si.groupCollapsed("BouncyBalls bootstrap"),Lt("bb:start"),Dt("🚀 Initializing modular bouncy balls...");const a=await(async()=>{try{try{if("undefined"!=typeof window&&window.__RUNTIME_CONFIG__&&"object"==typeof window.__RUNTIME_CONFIG__)return window.__RUNTIME_CONFIG__}catch(e){}const t=["config/default-config.json","js/config.json","../public/js/config.json"];for(const a of t)try{const e=await fetch(a,{cache:"no-cache"});if(e.ok)return await e.json()}catch(e){}throw Error("No config found")}catch(e){return console.warn("Config load failed, using defaults"),{gravityMultiplier:1.05,ballMass:91,maxBalls:300}}})();h(a),Lt("bb:config"),Dt("✓ Config loaded");try{const e=f();"undefined"!=typeof window&&(window.REST=e.REST,window.FRICTION=e.FRICTION,window.MAX_BALLS=e.maxBalls,window.repelRadius=e.repelRadius,window.repelPower=e.repelPower)}catch(e){}u(),Dt("✓ Layout applied"),Dn(a),Dt("✓ Visual effects configured");try{const e=f(),t=document.documentElement;Number.isFinite(e?.topLogoWidthVw)&&t.style.setProperty("--top-logo-width-vw",e.topLogoWidthVw+""),Number.isFinite(e?.homeMainLinksBelowLogoPx)&&t.style.setProperty("--home-main-links-below-logo-px",e.homeMainLinksBelowLogoPx+"")}catch(e){}(()=>{const e=document.querySelector(".noise");if(!e)return;const t=e.closest("#bravia-balls")||document.getElementById("bravia-balls")||e.parentElement||document.body,a=getComputedStyle(e),n=a.backgroundImage&&"none"!==a.backgroundImage?a.backgroundImage:null;if(!document.querySelector(".noise-2")){const e=document.createElement("div");e.className="noise-2",n&&(e.style.backgroundImage=n),t.appendChild(e),console.log("✓ Created .noise-2 element")}if(!document.querySelector(".noise-3")){const e=document.createElement("div");e.className="noise-3",n&&(e.style.backgroundImage=n),t.appendChild(e),console.log("✓ Created .noise-3 element")}})();try{qt(f())}catch(e){}Pe();const n=Te(),o=De(),i=document.getElementById("bravia-balls");if(!n||!o||!i)throw Error("Missing DOM elements");try{const e=document.getElementById("brand-logo");e&&e.parentElement!==i&&i.prepend(e)}catch(e){}try{n.setAttribute("role","application"),n.getAttribute("aria-label")||n.setAttribute("aria-label","Interactive bouncy balls physics simulation")}catch(e){}g(n,o,i),Fe(),Lt("bb:renderer"),Dt("✓ Canvas initialized (container-relative sizing)"),f().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),(()=>{function t(e=1200){m=!0;const t=performance.now();b=Math.max(b,t+e)}function a(e){return!(!e||!e.closest||!(e.closest("#panelDock")||e.closest("#masterPanel")||e.closest("#dockToggle")||e.closest(".panel-dock")||e.closest(".panel")))}function n(e,t){if(g>0||performance.now()<b){const a=p.getBoundingClientRect();return{x:(e-a.left)*u,y:(t-a.top)*u,inBounds:!(a.left>e||e>a.right||a.top>t||t>a.bottom)}}return!m&&h||(h=p.getBoundingClientRect(),m=!1),{x:(e-h.left)*u,y:(t-h.top)*u,inBounds:!(h.left>e||e>h.right||h.top>t||t>h.bottom)}}function o(e,t,o,{isMouseLike:i}={isMouseLike:!0}){const r=n(e,t),s=performance.now(),l=s-Kr;let c=0;if(l>0&&Kr>0){const e=r.x-Ir,t=r.y-Ar;c=Math.sqrt(e*e+t*t)/l,Or=c}if(i?mt(e,t,c):gt(),d.currentMode!==Bn.ORBIT_3D&&d.currentMode!==Bn.ORBIT_3D_2&&a(o))return;if(za())return;d.mouseX=r.x,d.mouseY=r.y,d.mouseInCanvas=r.inBounds,"undefined"!=typeof window&&(window.mouseInCanvas=r.inBounds);const p=Math.hypot(r.x-(d.lastPointerMoveX??r.x),r.y-(d.lastPointerMoveY??r.y));p>.5&&(d.lastPointerMoveMs=s,d.lastPointerMoveX=r.x,d.lastPointerMoveY=r.y),i&&p>.5&&((e,t,a,n)=>{if(Mt())return;const o=f();if(!o?.mouseTrailEnabled)return;if(!n)return;if(yt())return;if((e=>{const t=Math.max(0,0|e);t>0&&(pi===t&&ui&&hi&&fi||(pi=t,ui=new Float32Array(pi),hi=new Float32Array(pi),fi=new Float64Array(pi),mi=0,gi=0))})(vt(0|(o.mouseTrailLength??18),4,96)),!pi)return;const i=o.DPR||1,r=vt(+(o.mouseTrailSize??1.3),.5,10)*i,s=Math.max(.35,.55*r),l=s*s;if(gi>0){const n=(mi-1+pi)%pi;if(((e,t,a,n)=>{const o=e-a,i=t-n;return o*o+i*i})(e,t,ui[n],hi[n])<l)return void(fi[n]=a)}ui[mi]=e,hi[mi]=t,fi[mi]=a,mi=(mi+1)%pi,pi>gi&&gi++})(r.x,r.y,s,r.inBounds),d.currentMode===Bn.WATER&&r.inBounds&&Or>.3&&s-Nr>80&&(ge(r.x,r.y,Math.min(2*Or,3)),Nr=s),Ir=r.x,Ar=r.y,Kr=s}function i(){if(d?.isMobile||d?.isMobileViewport)return!0;try{return!(!window.matchMedia||!window.matchMedia("(max-width: 768px)").matches)}catch(e){return!1}}function r(){if($r){try{window.clearTimeout($r)}catch(e){}$r=0}}function s(e,t,o,s=null){Er||a(o)||(e=>!(!e||!e.closest||!(e.closest("a")||e.closest("button")||e.closest("input")||e.closest("select")||e.closest("textarea"))))(o)||za()||d.clickCycleEnabled&&n(e,t).inBounds&&(Er=!0,Br=s,Rr=e,zr=t,Wr=0,Vr=!1,r(),i()||(Vr=!0,_a(1,{armManual:!0,scheduleRelease:!1})))}function l(e=null,t="mouse"){if(!Er)return;if(null!==Br&&null!==e&&e!==Br)return;const a=Wr;Er=!1,Br=null,Wr=0;const n=Vr;if(Vr=!1,"touch"!==t&&"pen"!==t||15>=a){if(i()){_a(1,{armManual:!0,scheduleRelease:!1});const e=Math.max(1,Math.round(.8*(+(d.sceneImpactPressMs??75)||0))),t=Math.round(Math.min(80,Math.max(0,.4*(+e||0))));return r(),void($r=window.setTimeout(()=>{$r=0,ja(),Ga()},Math.max(0,Math.round(e)+t)))}ja(),Ga()}else n&&Ga()}function c(e=null){Er&&(null!==Br&&null!==e&&e!==Br||(Er=!1,Br=null,Wr=0,r(),Vr&&Ga(),Vr=!1))}const d=f(),p=d.canvas;if(void 0===d.clickCycleEnabled&&(d.clickCycleEnabled=!1),!p)return void console.error("Canvas not available for pointer setup");const u=d.DPR;let h=null,m=!0,g=0,b=0;try{window.addEventListener("resize",()=>{m=!0},{passive:!0})}catch(e){}try{const e=e=>!e||"transform"===e||"top"===e||"left"===e||"right"===e||"bottom"===e||"width"===e||"height"===e,a=(a,n)=>{if(!a||!a.addEventListener)return;a.addEventListener("transitionrun",a=>{e(a?.propertyName)&&(g++,t(n))});const o=a=>{e(a?.propertyName)&&(g=Math.max(0,g-1),t(120))};a.addEventListener("transitionend",o),a.addEventListener("transitioncancel",o)};a(document.getElementById("abs-scene"),600),a(document.getElementById("bravia-balls"),1200)}catch(e){}document.addEventListener("mousemove",e=>{window.PointerEvent||o(e.clientX,e.clientY,e.target,{isMouseLike:!0})},{passive:!0}),document.addEventListener("pointermove",e=>{o(e.clientX,e.clientY,e.target,{isMouseLike:"mouse"===e.pointerType||"pen"===e.pointerType})},{passive:!0}),window.PointerEvent?(document.addEventListener("pointerdown",e=>{s(e.clientX,e.clientY,e.target,e.pointerId)},{passive:!0}),document.addEventListener("pointermove",e=>{Er&&Br===e.pointerId&&(Wr=Math.max(Wr,Math.hypot(e.clientX-Rr,e.clientY-zr)))},{passive:!0}),document.addEventListener("pointerup",e=>{l(e.pointerId,e.pointerType)},{passive:!0}),document.addEventListener("pointercancel",e=>{c(e.pointerId)},{passive:!0})):(document.addEventListener("mousedown",e=>{s(e.clientX,e.clientY,e.target,null)},{passive:!0}),document.addEventListener("mouseup",()=>{l(null,"mouse")},{passive:!0})),document.addEventListener("touchmove",e=>{if(!za()&&e.touches&&e.touches[0]){const t=n(e.touches[0].clientX,e.touches[0].clientY);d.mouseX=t.x,d.mouseY=t.y,d.mouseInCanvas=t.inBounds;const a=performance.now();Math.hypot(t.x-(d.lastPointerMoveX??t.x),t.y-(d.lastPointerMoveY??t.y))>.5&&(d.lastPointerMoveMs=a,d.lastPointerMoveX=t.x,d.lastPointerMoveY=t.y),d.currentMode===Bn.WATER&&t.inBounds&&a-Nr>80&&(ge(t.x,t.y,2),Nr=a)}},{passive:!0}),document.addEventListener("touchstart",e=>{if(!window.PointerEvent&&!a(e.target)&&!za()&&(gt(),!e.target.closest("a")&&!e.target.closest("button")&&!e.target.closest("input")&&!e.target.closest("select")&&!e.target.closest("textarea")&&e.touches&&e.touches[0])){const t=e.touches[0];if(!n(t.clientX,t.clientY).inBounds)return;d.clickCycleEnabled&&(Er=!0,Br=null,Rr=t.clientX,zr=t.clientY,Wr=0)}},{passive:!0}),document.addEventListener("touchmove",e=>{if(!window.PointerEvent&&Er&&e.touches&&e.touches[0]){const t=e.touches[0];Wr=Math.max(Wr,Math.hypot(t.clientX-Rr,t.clientY-zr))}},{passive:!0}),document.addEventListener("touchend",()=>{window.PointerEvent||l(null,"touch")},{passive:!0}),document.addEventListener("touchcancel",()=>{window.PointerEvent||c(null)},{passive:!0}),document.addEventListener("mouseleave",()=>{d.mouseX=Wn.OFFSCREEN_MOUSE,d.mouseY=Wn.OFFSCREEN_MOUSE,d.mouseInCanvas=!1,Or=0,"undefined"!=typeof window&&(window.mouseInCanvas=!1),gt()}),document.addEventListener("mouseenter",()=>{bt()}),document.addEventListener("touchend",()=>{d.mouseX=Wn.OFFSCREEN_MOUSE,d.mouseY=Wn.OFFSCREEN_MOUSE,d.mouseInCanvas=!1},{passive:!0}),console.log("✓ Unified pointer system configured (document-level)"),d.ye=!0,"undefined"!=typeof window&&(window.ye=!0)})(),Dt("✓ Pointer tracking configured"),"undefined"!=typeof document&&document.addEventListener("touchmove",e=>{var t;(t=e.target)instanceof Element&&(t.closest(".panel-dock .panel .panel-content")||t.closest("#controlPanel"))||e.preventDefault()},{passive:!1,capture:!0}),Dt("✓ Overscroll lock configured"),ht(),Lt("bb:input"),Dt("✓ Custom cursor initialized"),os||(os=!0,vn(),document.addEventListener("pointerover",wn,!0),document.addEventListener("pointerout",Sn,!0),document.addEventListener("pointermove",kn,{passive:!0}),document.addEventListener("pointerdown",Cn,!0),window.PointerEvent||(document.addEventListener("mouseover",wn,!0),document.addEventListener("mouseout",Sn,!0),document.addEventListener("mousemove",kn,{passive:!0}),document.addEventListener("mousedown",Cn,!0)),window.addEventListener("blur",vn,{passive:!0}),window.addEventListener("mouseout",e=>{e.relatedTarget||e.toElement||vn()},{passive:!0}),window.addEventListener("resize",()=>{if(is){try{is.getBoundingClientRect?.()}catch(e){}xn()}},{passive:!0}),window.addEventListener("scroll",()=>{if(is){try{is.getBoundingClientRect?.()}catch(e){}xn()}},{passive:!0,capture:!0})),(()=>{if("undefined"!=typeof window&&"undefined"!=typeof document&&(Cr=document.querySelector("#abs-scene")||null,Cr&&(Cr.style.setProperty(wr,"0"),Cr.style.setProperty(Sr,"100ms"),Cr.style.setProperty(kr,"1"),Va(),!(()=>{try{return!(!window.matchMedia||!window.matchMedia("(prefers-reduced-motion: reduce)").matches)}catch(e){return!1}})()))){Pr=!0,Cr.classList.add("abs-scene--impact");try{window.addEventListener("resize",Va,{passive:!0})}catch(e){}window.addEventListener("bb:modeChanged",e=>{const t=f();if(!1===t?.sceneImpactEnabled)return;if(Lr)return void(Lr=!1);const a=e?.detail||{};((e=1,t={})=>{if(!Pr||!Cr)return;const a=f();if(!1===a?.sceneImpactEnabled)return;const n=Math.max(0,Math.min(1,+e||0)),o=++Fr;Na(),Cr.classList.add("abs-scene--animating"),t?.armManual&&(Lr=!0);const i=a?.sceneImpactPressMs??75,r=a?.sceneImpactReleaseMs??220,s=Math.max(1,Math.round(.8*(+i||0))),l=Math.max(1,Math.round(1.2*(+r||0))),c=Math.round(Math.min(80,Math.max(0,.4*(+s||0))));Cr.style.setProperty(Sr,Math.round(s)+"ms"),window.requestAnimationFrame(()=>{Pr&&Cr&&o===Fr&&(Cr.style.setProperty(wr,n+""),Cr.style.setProperty(kr,$a(n,a)+""))}),Tr=window.setTimeout(()=>{Ha({token:o,releaseMs:l})},Math.max(0,Math.round(s)+c)),Dr=window.setTimeout(()=>{Dr=0,Cr&&Cr.classList.remove("abs-scene--animating")},Math.max(0,Math.round(s)+c+Math.round(l)+80))})(a.prevMode&&a.mode&&a.prevMode!==a.mode?1:.75,{armManual:!1})},{passive:!0})}})(),console.log("⚠️ localStorage is disabled - using defaults"),G(),Z();try{(e=>{const t=e&&"object"==typeof e?e:null;if(!t)return;if("string"==typeof t.soundPreset&&ne(t.soundPreset),t.soundConfig&&"object"==typeof t.soundConfig)return void ae(t.soundConfig);const a={};let n=!1;for(const[o,i]of Object.entries(t))o in ao&&(a[o]=i,n=!0);n&&ae(a)})(a)}catch(e){}if(Dt("✓ Sound engine primed (awaiting user unlock)"),"undefined"!=typeof window&&(bs||(bs=!0,window.addEventListener("bb:modeChanged",e=>{const t=f();if(!1===t?.sceneChangeSoundEnabled)return;const a=e?.detail||{};a.prevMode&&a.mode&&a.prevMode!==a.mode&&X(+(t?.sceneChangeSoundRadius??18),+(t?.sceneChangeSoundIntensity??.35),.5,null)},{passive:!0}))),Pt())try{const e=await Promise.resolve().then(()=>mr);e.createPanelDock?.();const t=await Promise.resolve().then(()=>eo);t.populateColorSelect?.()}catch(e){}Lt("bb:ui"),Dt(Pt()?"✓ Panel dock created (Sound + Controls)":"✓ UI initialized (panel disabled in production)"),Bt(),Lt("bb:theme"),nn(),gr||(gr=!0,window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName))return;const t=e.key.toLowerCase();if("/"===t||"Slash"===e.code)return e.preventDefault(),void Pa();if("r"!==t)return"ArrowRight"===e.key?(e.preventDefault(),void Fa(1)):"ArrowLeft"===e.key?(e.preventDefault(),void Fa(-1)):void 0;e.preventDefault(),it();try{ba(f().currentMode)}catch(e){}})),Dt("✓ Keyboard shortcuts registered"),Ka(a),Dt("✓ Gate overlay system initialized"),(()=>{const t=document.getElementById("cv-gate-trigger"),a=document.getElementById("brand-logo"),n=document.getElementById("cv-gate"),o=document.getElementById("portfolio-gate"),i=document.getElementById("contact-gate"),r=Array.from(document.querySelectorAll(".cv-digit")),s=document.getElementById("page-flash"),l=document.getElementById("cv-gate-label");if(!t||!a||!n||0===r.length)return void console.warn("CV Gate: Missing required elements");const c=Xa("gates.common.backText","BACK"),d=Xa("gates.common.backAriaLabel","Back"),p=Xa("gates.cv.title","Bio/CV"),u=Xa("gates.cv.description","Because spam bots don't deserve nice things—and neither do recruiters who don't read portfolios. This keeps my inbox slightly more civilized.");l&&(l.innerHTML=`\n            <div class="gate-nav">\n                <button type="button" class="gate-back" data-gate-back aria-label="${d}">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>${c}</span>\n                </button>\n            </div>\n            <h2 class="gate-title">${p}</h2>\n            <p class="gate-description">${u}</p>\n        `);const h=s||(()=>{const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e})();let f=!1;const m=()=>n&&n.classList.contains("active")||o&&o.classList.contains("active")||i&&i.classList.contains("active"),g=e=>{e?.preventDefault?.();const t=m();o&&o.classList.contains("active")&&(o.classList.remove("active"),o.setAttribute("aria-hidden","true"),setTimeout(()=>{o.classList.add("hidden"),La(o)},400)),i&&i.classList.contains("active")&&(i.classList.remove("active"),i.setAttribute("aria-hidden","true"),setTimeout(()=>{i.classList.add("hidden"),La(i)},400)),f=!0,t||Ba(),a.classList.add("fade-out-up"),Da(n),n.classList.remove("hidden"),n.setAttribute("aria-hidden","false"),n.classList.add("active"),r[0].focus()},b=(e=!1)=>{f=!1,r.forEach(e=>e.value=""),e?(n.style.transition="none",a.style.transition="none",n.classList.remove("active"),n.setAttribute("aria-hidden","true"),n.classList.add("hidden"),La(n),a.classList.remove("fade-out-up"),m()||Ra(),requestAnimationFrame(()=>{n.style.removeProperty("transition"),a.style.removeProperty("transition")})):(n.classList.remove("active"),n.setAttribute("aria-hidden","true"),a.classList.remove("fade-out-up"),setTimeout(()=>{f||(n.classList.add("hidden"),La(n)),m()||Ra()},400))};try{const e=l?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",b)}catch(e){}n.addEventListener("click",e=>{(e.target===n||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&b(!0)});const M=()=>{const e=r.map(e=>e.value).join("");4===e.length&&("1111"===e?(qa(h,"success"),setTimeout(()=>{window.location.href="cv.html"},500)):(qa(h,"error"),setTimeout(()=>{r.forEach(e=>e.value=""),r[0].focus()},350)))};t.addEventListener("click",g);try{sessionStorage.getItem("abs_open_cv_gate")&&(sessionStorage.removeItem("abs_open_cv_gate"),setTimeout(()=>g(),300))}catch(e){}document.addEventListener("keydown",e=>{"Escape"===e.key&&f&&b()}),document.addEventListener("gate-overlay-dismiss",e=>{f&&b(e.detail?.instant||!1)}),r.forEach((e,t)=>{e.addEventListener("keydown",a=>{"Backspace"===a.key&&""===e.value&&(t>0?r[t-1].focus():b())}),e.addEventListener("input",e=>{const a=e.target.value;if(/^\d*$/.test(a)){if(1===a.length)r.length-1>t?r[t+1].focus():M();else if(a.length>1){const n=a.split("");e.target.value=n[0];let o=t+1;for(let e=1;n.length>e&&r.length>o;e++)r[o].value=n[e],o++;r.length>o?r[o].focus():M()}}else e.target.value=a.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})})(),Dt("✓ CV password gate initialized"),(()=>{const t=document.getElementById("portfolio-gate-trigger"),a=document.getElementById("portfolio-gate"),n=document.getElementById("brand-logo"),o=document.getElementById("cv-gate"),i=document.getElementById("contact-gate"),r=Array.from(document.querySelectorAll(".portfolio-digit")),s=document.getElementById("page-flash"),l=document.getElementById("portfolio-gate-label");if(!t||!a||0===r.length)return void console.warn("Portfolio Gate: Missing required elements");const c=Xa("gates.common.backText","BACK"),d=Xa("gates.common.backAriaLabel","Back"),p=Xa("gates.portfolio.title","View Portfolio"),u=Xa("gates.portfolio.description","Good work deserves good context. This small step ensures you're here with intention, not just browsing. Quality takes time—yours and mine.");l&&(l.innerHTML=`\n            <div class="gate-nav">\n                <button type="button" class="gate-back" data-gate-back aria-label="${d}">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>${c}</span>\n                </button>\n            </div>\n            <h2 class="gate-title">${p}</h2>\n            <p class="gate-description">${u}</p>\n        `);const h=s||(()=>{const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e})();let f=!1;const m=()=>a&&a.classList.contains("active")||o&&o.classList.contains("active")||i&&i.classList.contains("active"),g=e=>{e&&e.preventDefault();const t=m(),s=(()=>{try{const e=window.PORTFOLIO_BASE||"";return e&&!e.endsWith("/")?e+"/":e}catch(e){return""}})(),l=document.createElement("link");l.rel="prefetch",l.href=s+"js/portfolio-bundle.js",document.head.appendChild(l);const c=document.createElement("link");c.rel="preload",c.as="image",c.href=s+"images/portfolio/pages/chapter-0-1.webp",document.head.appendChild(c),o&&o.classList.contains("active")&&(o.classList.remove("active"),o.setAttribute("aria-hidden","true"),setTimeout(()=>{o.classList.add("hidden"),La(o)},400)),i&&i.classList.contains("active")&&(i.classList.remove("active"),i.setAttribute("aria-hidden","true"),setTimeout(()=>{i.classList.add("hidden"),La(i)},400)),f=!0,t||Ba(),n&&n.classList.add("fade-out-up"),Da(a),a.classList.remove("hidden"),a.setAttribute("aria-hidden","false"),a.classList.add("active"),r[0].focus()},b=(e=!1)=>{f=!1,r.forEach(e=>e.value=""),e?(a.style.transition="none",n&&(n.style.transition="none"),a.classList.remove("active"),a.setAttribute("aria-hidden","true"),a.classList.add("hidden"),La(a),n&&n.classList.remove("fade-out-up"),m()||Ra(),requestAnimationFrame(()=>{a.style.removeProperty("transition"),n&&n.style.removeProperty("transition")})):(a.classList.remove("active"),a.setAttribute("aria-hidden","true"),n&&n.classList.remove("fade-out-up"),setTimeout(()=>{f||(a.classList.add("hidden"),La(a)),m()||Ra()},400))};try{const e=l?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",b)}catch(e){}a.addEventListener("click",e=>{(e.target===a||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&b(!0)});const M=()=>{const e=r.map(e=>e.value).join("");4===e.length&&("1234"===e?(Ua(h,"success"),sessionStorage.setItem("abs_portfolio_ok",Date.now()),setTimeout(()=>{window.location.href="portfolio.html"},500)):(Ua(h,"error"),setTimeout(()=>{r.forEach(e=>e.value=""),r[0].focus()},350)))};sessionStorage.getItem("abs_open_portfolio_gate")&&(sessionStorage.removeItem("abs_open_portfolio_gate"),setTimeout(()=>g(),300)),t.addEventListener("click",g),document.addEventListener("keydown",e=>{"Escape"===e.key&&f&&b()}),document.addEventListener("gate-overlay-dismiss",e=>{f&&b(e.detail?.instant||!1)}),r.forEach((e,t)=>{e.addEventListener("keydown",a=>{"Backspace"===a.key&&""===e.value&&(t>0?r[t-1].focus():b())}),e.addEventListener("input",e=>{const a=e.target.value;if(/^\d*$/.test(a)){if(1===a.length)r.length-1>t?r[t+1].focus():M();else if(a.length>1){const n=a.split("");e.target.value=n[0];let o=t+1;for(let e=1;n.length>e&&r.length>o;e++)r[o].value=n[e],o++;r.length>o?r[o].focus():M()}}else e.target.value=a.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})})(),Dt("✓ Portfolio password gate initialized"),(()=>{const t=Xa("contact.email","alexander@beck.fyi"),a=Xa("gates.common.backText","BACK"),n=Xa("gates.common.backAriaLabel","Back"),o=Xa("gates.contact.title","Contact"),i=Xa("gates.contact.description","For collaborations, product design work, AI prototyping, or anything that needs a crisp creative + technical brain."),r=Xa("contact.copy.buttonAriaLabel","Copy email address"),s=Xa("contact.copy.statusCopied","Copied"),l=Xa("contact.copy.statusError","Copy failed"),c=[document.getElementById("contact-email"),document.getElementById("contact-email-inline")].filter(Boolean),d=document.getElementById("brand-logo"),p=document.getElementById("contact-gate"),u=document.getElementById("contact-gate-label"),h=document.getElementById("contact-gate-inputs"),f=document.getElementById("cv-gate"),m=document.getElementById("portfolio-gate");if(!(c.length&&d&&p&&u&&h))return void console.warn("Contact Gate: Missing required elements");u.innerHTML=`\n    <div class="gate-nav">\n      <button type="button" class="gate-back" data-gate-back aria-label="${n}">\n        <i class="ti ti-arrow-left" aria-hidden="true"></i>\n        <span>${a}</span>\n      </button>\n    </div>\n    <h2 class="gate-title">${o}</h2>\n    <p class="gate-description">\n      ${i}\n    </p>\n  `,h.innerHTML=`\n    <div class="contact-email-row" data-email-row>\n      <button type="button" class="contact-email-value" data-copy-email aria-label="${r}">\n        <span class="contact-email-text">${t}</span>\n      </button>\n      <button type="button" class="contact-email-copy" data-copy-email-icon aria-label="${r}">\n        <i class="ti ti-copy" aria-hidden="true"></i>\n      </button>\n    </div>\n    <div class="contact-copy-status" data-copy-status aria-live="polite"></div>\n  `;const g=u.querySelector("[data-gate-back]"),b=h.querySelector("[data-copy-email]"),M=h.querySelector("[data-copy-email-icon]"),y=h.querySelector("[data-email-row]"),v=h.querySelector("[data-copy-status]"),x=h.querySelector(".contact-email-copy i");let w=!1,S=null;const k=()=>p&&p.classList.contains("active")||f&&f.classList.contains("active")||m&&m.classList.contains("active"),C=e=>{if(b&&M&&v){if(S&&window.clearTimeout(S),"copied"===e)return y?.classList?.add?.("is-copied"),y?.classList?.remove?.("is-error"),v.textContent=s,x&&(x.className="ti ti-check"),void(S=window.setTimeout(()=>C("idle"),1200));if("error"===e)return y?.classList?.add?.("is-error"),y?.classList?.remove?.("is-copied"),v.textContent=l,x&&(x.className="ti ti-alert-triangle"),void(S=window.setTimeout(()=>C("idle"),1200));y?.classList?.remove?.("is-copied","is-error"),v.textContent="",x&&(x.className="ti ti-copy")}},P=e=>{e?.preventDefault?.();const t=k();f&&f.classList.contains("active")&&(f.classList.remove("active"),f.setAttribute("aria-hidden","true"),setTimeout(()=>{f.classList.add("hidden"),La(f)},400)),m&&m.classList.contains("active")&&(m.classList.remove("active"),m.setAttribute("aria-hidden","true"),setTimeout(()=>{m.classList.add("hidden"),La(m)},400)),w=!0,t||Ba(),C("idle"),d.classList.add("fade-out-up"),Da(p),p.classList.remove("hidden"),p.setAttribute("aria-hidden","false"),p.classList.add("active"),b?.focus?.()},F=(e=!1)=>{w=!1,C("idle"),e?(p.style.transition="none",d.style.transition="none",p.classList.remove("active"),p.setAttribute("aria-hidden","true"),p.classList.add("hidden"),La(p),d.classList.remove("fade-out-up"),k()||Ra(),requestAnimationFrame(()=>{p.style.removeProperty("transition"),d.style.removeProperty("transition")})):(p.classList.remove("active"),p.setAttribute("aria-hidden","true"),d.classList.remove("fade-out-up"),setTimeout(()=>{w||(p.classList.add("hidden"),La(p)),k()||Ra()},400))};c.forEach(e=>e.addEventListener("click",P,{capture:!0})),g?.addEventListener("click",F),p.addEventListener("click",e=>{(e.target===p||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&F(!0)});const T=async()=>{const a=await(async t=>{try{if(navigator?.clipboard?.writeText)return await navigator.clipboard.writeText(t),!0}catch(e){}try{const e=document.createElement("textarea");e.value=t,e.setAttribute("readonly","true"),e.style.position="fixed",e.style.left="-9999px",e.style.top="0",document.body.appendChild(e),e.select();const a=!0===document.execCommand?.("copy");return document.body.removeChild(e),a}catch(e){return!1}})(t);C(a?"copied":"error")};b?.addEventListener("click",T),M?.addEventListener("click",T),document.addEventListener("keydown",e=>{"Escape"===e.key&&w&&F()}),document.addEventListener("gate-overlay-dismiss",e=>{w&&F(e.detail?.instant||!1)});try{sessionStorage.getItem("abs_open_contact_gate")&&(sessionStorage.removeItem("abs_open_contact_gate"),requestAnimationFrame(()=>P()))}catch(e){}})(),Dt("✓ Contact gate initialized"),(()=>{const e=document.getElementById("social-links");if(!e)return;if(e.querySelector("i.ti"))return;const t=Array.from(e.querySelectorAll("a.footer_icon-link[aria-label]"));for(const a of t){const e=(a.getAttribute("aria-label")||"").trim().toLowerCase(),t=as.get(e);if(!t)continue;const n=a.querySelector("svg");n?(a.insertAdjacentHTML("afterbegin",t),n.remove()):a.insertAdjacentHTML("afterbegin",t)}})(),(()=>{function e(){t.textContent=n.format(new Date).toUpperCase()}const t=document.getElementById("time-display"),a=document.getElementById("site-year");if(!t)return;const n=new Intl.DateTimeFormat("en-GB",{timeZone:"Europe/London",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});e(),setInterval(e,1e3),a&&(a.style.cursor="pointer",a.addEventListener("click",Rt))})(),(()=>{try{const e=document.getElementById("cv-gate-trigger");if(e&&!e.querySelector(".footer-link-nowrap")){const t=((Xa("footer.links.cv.text","")||"")+"").trim(),a=(e.textContent||"").trim().replace(/\s+/g," "),n=t||a;n&&n.includes("/")&&a===n&&(e.innerHTML=`<span class="footer-link-nowrap">${n}</span>`)}}catch(e){}})(),(()=>{if(Z(),"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return console.log("⏸ Sound toggle hidden (prefers-reduced-motion)"),null;ts=document.createElement("button"),ts.className="sound-toggle",ts.id="sound-toggle",ts.type="button",ts.setAttribute("aria-label","Toggle collision sounds"),ts.setAttribute("aria-pressed","false"),ts.setAttribute("data-enabled","false"),ts.innerHTML=es,ts.title="Sound off",ts.addEventListener("click",Ja);const t=document.getElementById("fade-content"),a=document.getElementById("sound-toggle-slot"),n=document.getElementById("top-elements-soundRow"),o=document.getElementById("social-links"),i=document.querySelector(".ui-meta-right"),r=!!a,s=o&&(!t||t.contains(o)),l="undefined"!=typeof window&&"function"==typeof window.matchMedia&&window.matchMedia("(max-width: 600px)").matches,c=t=>{if(!t)return!1;try{ts.parentElement&&ts.parentElement!==t&&ts.parentElement.removeChild(ts)}catch(e){}if(t.classList.contains("ui-meta-right")){const e=t.querySelector("time");if(e)return t.insertBefore(ts,e),!0}return t.appendChild(ts),!0};if(l&&n)ts.classList.add("sound-toggle--top"),ts.classList.add("sound-toggle--topwide"),c(n);else if(r)ts.classList.add("sound-toggle--top"),c(a);else if(i)c(i);else if(s){const e=document.createElement("li");e.className="margin-bottom_none sound-toggle-item",ts.classList.add("sound-toggle--social"),e.appendChild(ts),o.appendChild(e)}else t?t.appendChild(ts):document.body.appendChild(ts);try{if("undefined"!=typeof window&&"function"==typeof window.matchMedia){const e=window.matchMedia("(max-width: 600px)"),t=()=>{const t=document.getElementById("top-elements-soundRow"),a=document.getElementById("sound-toggle-slot"),n=e.matches&&!!t;ts.classList.toggle("sound-toggle--topwide",n),n?c(t):a&&c(a)};"function"==typeof e.addEventListener?e.addEventListener("change",t):"function"==typeof e.addListener&&e.addListener(t)}}catch(e){}console.log("✓ Sound toggle created");try{const e=ee();Qa(!(!e.isUnlocked||!e.isEnabled))}catch(e){}"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(bo,e=>{const t=e&&e.detail?e.detail:null;t&&Qa(!(!t.isUnlocked||!t.isEnabled))})})(),Dt("✓ Sound toggle button created"),Dt("✓ Theme toggle button created");const r=Bn.PIT;W?.(),ot(r);try{const e=await Promise.resolve().then(()=>er);e.updateModeButtonsUI?.(r)}catch(e){}Lt("bb:mode"),Dt("✓ Mode initialized"),Go=kt;const s=()=>rt();(e=>{function t(a){if(!Yr)return void(Xr=null);const n=a-Zr;if(qr>n)return void(Xr=requestAnimationFrame(t));Zr=a-n%qr,(e=>{if(Ur.push(e),Ur.length>30&&Ur.shift(),30===Ur.length){const e=1e3/(Ur.reduce((e,t)=>e+t,0)/30);30>e&&2>Jr?(Jr++,console.log(`⚡ Adaptive throttle increased to level ${Jr} (avg FPS: ${e.toFixed(1)})`)):e>55&&Jr>0&&(Jr--,console.log(`⚡ Adaptive throttle decreased to level ${Jr} (avg FPS: ${e.toFixed(1)})`))}})(n);const o=a/1e3;let i=Math.min(.033,o-jr);jr=o,(2>Jr||Math.random()>.5)&&St(i,e),kt(),(e=>{if(Gr++,e-_r>1e3){Hr=Gr,Gr=0,_r=e;const t=document.getElementById("render-fps");t&&(t.textContent=Hr+"")}})(performance.now()),Xr=requestAnimationFrame(t)}document.addEventListener("visibilitychange",()=>{Yr=!document.hidden,Yr?(jr=performance.now()/1e3,Zr=performance.now(),console.log("▶️ Animation resumed"),Xr||(Xr=requestAnimationFrame(t))):(console.log("⏸️ Animation paused (tab hidden)"),Xr&&(cancelAnimationFrame(Xr),Xr=null))}),Xr=requestAnimationFrame(t),console.log("✓ Render loop started (60fps throttle, visibility-aware)")})((e,t)=>{const a=s();a&&a(e,t)}),Lt("bb:end"),Dt("✅ Bouncy Balls running (modular)");const l=[{phase:"config",ms:It("bb:m:config","bb:start","bb:config")},{phase:"renderer",ms:It("bb:m:renderer","bb:config","bb:renderer")},{phase:"input",ms:It("bb:m:input","bb:renderer","bb:input")},{phase:"ui",ms:It("bb:m:ui","bb:input","bb:ui")},{phase:"theme",ms:It("bb:m:theme","bb:ui","bb:theme")},{phase:"mode+loop",ms:It("bb:m:mode","bb:theme","bb:mode")},{phase:"total",ms:It("bb:m:total","bb:start","bb:end")}].filter(e=>"number"==typeof e.ms);l.length&&(t=>{if(Pt())try{Si.table(t)}catch(e){}})(l.map(e=>({...e,ms:+e.ms.toFixed(2)}))),Pt()&&Si.groupEnd();try{Pt()?Tt():(({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"]}={})=>{Pt()||Tt({sentence:e,ascii:t,silence:!0})})()}catch(t){try{console.error("Banner print error:",t),console.log("%cCurious mind detected. Design meets engineering at 60fps.","color: #888; font-style: italic;")}catch(e){}}try{const{orchestrateEntrance:t}=await Promise.resolve().then(()=>ys);if(!f().entranceEnabled||window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches){try{await Tn()}catch(e){}const t=document.getElementById("fade-content");t&&(t.style.opacity="1",t.style.transform="translateZ(0)"),console.log("✓ Entrance animation skipped (disabled or reduced motion)")}else await t({async waitForFonts(){try{await Tn()}catch(e){}}}),console.log("✓ Dramatic entrance animation orchestrated")}catch(e){console.warn("⚠️ Entrance animation failed, falling back to simple fade:",e);try{await Tn()}catch(e){}const t=document.getElementById("fade-content");t&&(t.style.opacity="1",t.style.transform="translateZ(0)")}}catch(a){console.error("❌ Initialization failed:",a),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${a.message}\n${a.stack}</pre>\n    </div>`}})();var ys=Object.freeze({__proto__:null,animateElementEntrance:En,applyAspectRatioClass:In,applyPerspectiveCSS:An,detectAspectRatioCategory:Ln,async orchestrateEntrance(e={}){const t=f();In(),An(),Kn(),e.waitForFonts&&await e.waitForFonts(),On();const a=document.getElementById("fade-content");a&&En(a,{delay:(t.entranceWallTransitionDelay||300)+.3*(t.entranceWallTransitionDuration||800),duration:t.entranceElementDuration||200,scaleStart:t.entranceElementScaleStart||.95,translateZStart:t.entranceElementTranslateZStart||-20})},setInitialBrowserDefaultState:Kn,transitionToWallState:On});e.applyFramePaddingCSSVars=()=>{u()},e.applyVisualCSSVars=Dn})({});