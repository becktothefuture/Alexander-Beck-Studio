var e=function(e){"use strict";const t={PIT:"pit",PIT_THROWS:"pit-throws",FLIES:"flies",WEIGHTLESS:"weightless",WATER:"water",VORTEX:"vortex",PING_PONG:"ping-pong",MAGNETIC:"magnetic",BUBBLES:"bubbles",KALEIDOSCOPE:"kaleidoscope",CRITTERS:"critters"},n={DPR:Math.max(1,Math.min(2,window.devicePixelRatio||1)),OFFSCREEN_MOUSE:-1e9,MIN_DISTANCE_EPSILON:1e-6,ACCUMULATOR_RESET_THRESHOLD:3,MAX_PHYSICS_STEPS:2,SPIN_DAMP_PER_S:3,SPIN_GAIN:.25,SPIN_GAIN_TANGENT:.18,ROLL_FRICTION_PER_S:2.5,SQUASH_MAX_BASE:.2,SQUASH_DECAY_PER_S:18,WALL_REST_VEL_THRESHOLD:70,GROUND_COUPLING_PER_S:12,SLEEP_VELOCITY_THRESHOLD:8,SLEEP_ANGULAR_THRESHOLD:.1,TIME_TO_SLEEP:.25,PHYSICS_DT:1/120};let a=Math.max(1,Math.min(2,window.devicePixelRatio||1));function o(e){a=e}const i={config:{},currentMode:t.CRITTERS,balls:[],canvas:null,ctx:null,container:null,mouseX:n.OFFSCREEN_MOUSE,mouseY:n.OFFSCREEN_MOUSE,mouseInCanvas:!1,lastPointerMoveMs:0,lastPointerMoveX:n.OFFSCREEN_MOUSE,lastPointerMoveY:n.OFFSCREEN_MOUSE,GE:1960,G:0,gravityScale:1,gravityMultiplier:0,gravityMultiplierPit:1.1,pitThrowSpeed:650,pitThrowSpeedJitter:.22,pitThrowAngleJitter:.16,pitThrowBatchSize:18,pitThrowIntervalMs:70,pitThrowColorPauseMs:180,pitThrowTargetYFrac:.36,pitThrowInletInset:.06,pitThrowCrossBias:.12,pitThrowSpawnSpread:.02,pitThrowAimJitter:.04,pitThrowPairChance:.35,pitThrowPairStaggerMs:18,pitThrowSpeedVar:.18,pitThrowSpreadVar:.25,REST:.69,FRICTION:.006,ballMassKg:129,MASS_BASELINE_KG:129,MASS_REST_EXP:.15,MASS_GRAVITY_EXP:.35,get DPR(){return a},sizeScale:1.2,sizeVariation:0,responsiveScale:1,responsiveScaleMobile:.75,isMobile:!1,R_MIN_BASE:6,R_MAX_BASE:24,R_MIN:6*1.2*.75,R_MAX:36,cursorSize:1,mouseTrailEnabled:!0,mouseTrailLength:18,mouseTrailSize:1.3,mouseTrailFadeMs:220,mouseTrailOpacity:.35,ballSoftness:20,ballSpacing:2.5,critterCount:90,critterSpeed:680,critterMaxSpeed:1400,critterStepHz:5,critterStepSharpness:2.4,critterTurnNoise:2.2,critterTurnDamp:10,critterTurnSeek:10,critterAvoidRadius:90,critterAvoidForce:9500,critterEdgeAvoid:1,critterMousePull:1,critterMouseRadiusVw:30,critterRestitution:.18,critterFriction:.018,cornerRadius:42,layoutViewportWidthPx:0,containerBorderVw:0,simulationPaddingVw:0,contentPaddingVw:0,wallRadiusVw:0,wallThicknessVw:0,wallInset:3,vortexSwirlStrength:420,vortexRadialPull:180,vortexBallCount:180,magneticBallCount:180,magneticStrength:65e3,magneticMaxVelocity:2800,magneticExplosionInterval:5,bubblesSpawnRate:8,bubblesRiseSpeed:150,bubblesWobble:40,bubblesMaxCount:200,bubblesDeflectRadius:200,pingPongBallCount:35,pingPongSpeed:800,pingPongCursorRadius:50,currentColors:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],currentTemplate:"industrialTeal",fliesBallCount:60,attractionPower:5e3,orbitRadius:180,swarmSpeed:.4,fliesSeparation:15e3,weightlessCount:80,weightlessInitialSpeed:250,weightlessBounce:.97,weightlessRepelRadius:220,weightlessRepelPower:22e4,weightlessRepelSoft:2.2,kaleidoscopeBallCount:23,kaleidoscopeSegments:12,kaleidoscopeMirror:1,kaleidoscopeBallSpacing:9,kaleidoscopeSwirlStrength:52,kaleidoscopeRadialPull:260,kaleidoscopeRotationFollow:1,kaleidoscopePanStrength:.75,kaleidoscopeMaxSpeed:2600,kaleidoscopeIdleMotion:.03,kaleidoscopeEase:.18,kaleidoscopeWander:.25,waterBallCount:300,waterDrag:.015,waterRippleSpeed:300,waterRippleStrength:18e3,waterDriftStrength:40,waterInitialVelocity:200,repelRadius:120,repelPower:274e3,repelSoft:3.4,repellerEnabled:!1,emitterTimer:0,autoDarkModeEnabled:!0,isDarkMode:!1,clickCycleEnabled:!0,containerBorder:20,simulationPadding:0,contentPadding:40,containerInnerShadowOpacity:.12,containerInnerShadowBlur:80,containerInnerShadowSpread:-10,containerInnerShadowOffsetY:0,frameColor:"#0a0a0a",wallThickness:12,wallRadius:42,wallInset:3,wallWobbleMaxDeform:148,wallWobbleStiffness:1300,wallWobbleDamping:34,wallWobbleSigma:4,wallWobbleCornerClamp:1,getSquashMax(){return 0===this.ballSoftness?0:n.SQUASH_MAX_BASE*(this.ballSoftness/40)},getCanvasCornerRadius(){return Math.max(0,this.cornerRadius-this.simulationPadding)}};function s(e,t,n,a){const o=Number(e);return Number.isFinite(o)?Math.min(n,Math.max(t,o)):a}function r(){const e=Number(i.layoutViewportWidthPx);return Number.isFinite(e)&&e>0?e:Math.max(1,window.innerWidth||1)}function l(e,t){const n=Math.max(1,t||r()),a=Number(e);return Number.isFinite(a)?a/n*100:0}function c(e,t){const n=Math.max(1,t||r()),a=Number(e);return Number.isFinite(a)?a/100*n:0}function d(){const e=r(),t=c(i.containerBorderVw,e),n=c(i.simulationPaddingVw,e),a=c(i.contentPaddingVw,e),o=c(i.wallRadiusVw,e),s=c(Number.isFinite(i.wallThicknessVw)&&i.wallThicknessVw>0?i.wallThicknessVw:i.containerBorderVw,e);i.containerBorder=Math.round(t),i.simulationPadding=Math.round(n),i.contentPadding=Math.round(a),i.wallRadius=Math.round(o),i.cornerRadius=i.wallRadius,i.wallThickness=Math.round(s)}function u(){const e=document.documentElement;e.style.setProperty("--container-border",`${i.containerBorder}px`),e.style.setProperty("--simulation-padding",`${i.simulationPadding}px`),e.style.setProperty("--content-padding",`${i.contentPadding}px`),e.style.setProperty("--wall-radius",`${i.wallRadius}px`),e.style.setProperty("--wall-thickness",`${i.wallThickness}px`)}function p(e){i.config={...e},void 0!==e.layoutViewportWidthPx&&(i.layoutViewportWidthPx=s(e.layoutViewportWidthPx,0,4096,0)),e.ballMass&&(i.ballMassKg=e.ballMass),void 0!==e.gravityMultiplier&&(i.gravityMultiplier=e.gravityMultiplier,i.gravityMultiplierPit=e.gravityMultiplier),e.restitution&&(i.REST=e.restitution),e.friction&&(i.FRICTION=e.friction),void 0!==e.ballScale&&(i.sizeScale=e.ballScale),void 0!==e.sizeScale&&(i.sizeScale=e.sizeScale),void 0!==e.sizeVariation&&(i.sizeVariation=e.sizeVariation),void 0!==e.maxBalls&&(i.maxBalls=e.maxBalls),void 0!==e.repelRadius&&(i.repelRadius=e.repelRadius),void 0!==e.repelPower&&(i.repelPower=e.repelPower),void 0!==e.repelSoft&&(i.repelSoft=e.repelSoft),void 0!==e.repelSoftness&&(i.repelSoft=e.repelSoftness),void 0!==e.responsiveScaleMobile&&(i.responsiveScaleMobile=e.responsiveScaleMobile),y(),void 0!==e.kaleidoscopeBallCount&&(i.kaleidoscopeBallCount=e.kaleidoscopeBallCount),void 0!==e.kaleidoscopeSegments&&(i.kaleidoscopeSegments=e.kaleidoscopeSegments),void 0!==e.kaleidoscopeMirror&&(i.kaleidoscopeMirror=e.kaleidoscopeMirror),void 0!==e.kaleidoscopeBallSpacing&&(i.kaleidoscopeBallSpacing=e.kaleidoscopeBallSpacing),void 0!==e.kaleidoscopeSwirlStrength&&(i.kaleidoscopeSwirlStrength=e.kaleidoscopeSwirlStrength),void 0!==e.kaleidoscopeRadialPull&&(i.kaleidoscopeRadialPull=e.kaleidoscopeRadialPull),void 0!==e.kaleidoscopeRotationFollow&&(i.kaleidoscopeRotationFollow=e.kaleidoscopeRotationFollow),void 0!==e.kaleidoscopePanStrength&&(i.kaleidoscopePanStrength=e.kaleidoscopePanStrength),void 0!==e.kaleidoscopeMaxSpeed&&(i.kaleidoscopeMaxSpeed=e.kaleidoscopeMaxSpeed),void 0!==e.kaleidoscopeEase&&(i.kaleidoscopeEase=e.kaleidoscopeEase),void 0!==e.kaleidoscopeWander&&(i.kaleidoscopeWander=e.kaleidoscopeWander),void 0!==e.critterCount&&(i.critterCount=e.critterCount),void 0!==e.critterSpeed&&(i.critterSpeed=e.critterSpeed),void 0!==e.critterMaxSpeed&&(i.critterMaxSpeed=e.critterMaxSpeed),void 0!==e.critterStepHz&&(i.critterStepHz=e.critterStepHz),void 0!==e.critterStepSharpness&&(i.critterStepSharpness=e.critterStepSharpness),void 0!==e.critterTurnNoise&&(i.critterTurnNoise=e.critterTurnNoise),void 0!==e.critterTurnDamp&&(i.critterTurnDamp=e.critterTurnDamp),void 0!==e.critterTurnSeek&&(i.critterTurnSeek=e.critterTurnSeek),void 0!==e.critterAvoidRadius&&(i.critterAvoidRadius=e.critterAvoidRadius),void 0!==e.critterAvoidForce&&(i.critterAvoidForce=e.critterAvoidForce),void 0!==e.critterEdgeAvoid&&(i.critterEdgeAvoid=e.critterEdgeAvoid),void 0!==e.critterMousePull&&(i.critterMousePull=e.critterMousePull),void 0!==e.critterMouseRadiusVw&&(i.critterMouseRadiusVw=e.critterMouseRadiusVw),void 0!==e.critterRestitution&&(i.critterRestitution=e.critterRestitution),void 0!==e.critterFriction&&(i.critterFriction=e.critterFriction);for(const[t,n]of Object.entries(e||{})){if(!(t in i))continue;if("config"===t)continue;if("soundConfig"===t||"soundPreset"===t)continue;if("function"==typeof i[t])continue;const e=Array.isArray(n),a=null===n||["string","number","boolean"].includes(typeof n);(e||a)&&void 0!==n&&(i[t]=n)}void 0!==e.containerBorder&&(i.containerBorder=e.containerBorder),void 0!==e.simulationPadding&&(i.simulationPadding=e.simulationPadding),void 0!==e.contentPadding&&(i.contentPadding=e.contentPadding),void 0!==e.containerInnerShadowOpacity&&(i.containerInnerShadowOpacity=e.containerInnerShadowOpacity),void 0!==e.containerInnerShadowBlur&&(i.containerInnerShadowBlur=e.containerInnerShadowBlur),void 0!==e.containerInnerShadowSpread&&(i.containerInnerShadowSpread=e.containerInnerShadowSpread),void 0!==e.containerInnerShadowOffsetY&&(i.containerInnerShadowOffsetY=e.containerInnerShadowOffsetY),void 0!==e.frameColor&&(i.frameColor=e.frameColor),void 0!==e.wallThickness&&(i.wallThickness=e.wallThickness),void 0!==e.wallRadius&&(i.wallRadius=e.wallRadius,i.cornerRadius=e.wallRadius),void 0!==e.wallInset&&(i.wallInset=e.wallInset),void 0!==e.wallInset&&(i.wallInset=e.wallInset),void 0!==e.ballSpacing&&(i.ballSpacing=e.ballSpacing),void 0!==e.wallWobbleMaxDeform&&(i.wallWobbleMaxDeform=e.wallWobbleMaxDeform),void 0!==e.wallWobbleStiffness&&(i.wallWobbleStiffness=e.wallWobbleStiffness),void 0!==e.wallWobbleDamping&&(i.wallWobbleDamping=e.wallWobbleDamping),void 0!==e.wallWobbleSigma&&(i.wallWobbleSigma=e.wallWobbleSigma),void 0!==e.wallWobbleCornerClamp&&(i.wallWobbleCornerClamp=e.wallWobbleCornerClamp);const t=r();void 0!==e.containerBorderVw&&(i.containerBorderVw=s(e.containerBorderVw,0,20,i.containerBorderVw)),void 0!==e.simulationPaddingVw&&(i.simulationPaddingVw=s(e.simulationPaddingVw,0,20,i.simulationPaddingVw)),void 0!==e.contentPaddingVw&&(i.contentPaddingVw=s(e.contentPaddingVw,0,40,i.contentPaddingVw)),void 0!==e.wallRadiusVw&&(i.wallRadiusVw=s(e.wallRadiusVw,0,40,i.wallRadiusVw)),void 0!==e.wallThicknessVw&&(i.wallThicknessVw=s(e.wallThicknessVw,0,20,i.wallThicknessVw)),Number.isFinite(i.containerBorderVw)&&i.containerBorderVw>0||(i.containerBorderVw=l(i.containerBorder,t)),Number.isFinite(i.simulationPaddingVw)&&i.simulationPaddingVw>=0||(i.simulationPaddingVw=l(i.simulationPadding,t)),Number.isFinite(i.contentPaddingVw)&&i.contentPaddingVw>0||(i.contentPaddingVw=l(i.contentPadding,t)),Number.isFinite(i.wallRadiusVw)&&i.wallRadiusVw>0||(i.wallRadiusVw=l(i.wallRadius,t)),Number.isFinite(i.wallThicknessVw)&&i.wallThicknessVw>0||(i.wallThicknessVw=l(i.wallThickness,t)),d()}function h(){return i}function m(e,t,n){i.canvas=e,i.ctx=t,i.container=n}function f(e){i.currentMode=e}function g(){i.balls.length=0}function y(){const e=navigator.userAgent||"",t=/iPad/.test(e)||/Mac/.test(e)&&navigator.maxTouchPoints>1,n=/iPhone/.test(e);t||n?(i.isMobile=!0,i.responsiveScale=i.responsiveScaleMobile,console.log(`✓ Mobile device detected - ball scale: ${i.responsiveScale}x`)):(i.isMobile=!1,i.responsiveScale=1),b()}function b(){const e=(i.R_MIN_BASE+i.R_MAX_BASE)/2,t=i.sizeScale*i.responsiveScale;i.R_MIN=e*t*.75,i.R_MAX=e*t*1.25}var v=Object.freeze({__proto__:null,applyLayoutCSSVars:u,applyLayoutFromVwToPx:d,clearBalls:g,detectResponsiveScale:y,getGlobals:h,getLayoutViewportWidthPx:r,initState:p,pxToVw:l,setCanvas:m,setEffectiveDPR:o,setMode:f,updateBallSizes:b,vwToPx:c});const M={industrialTeal:{label:"Industrial Teal",light:["#b7bcb7","#d0d0d0","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#6b726b","#3d453d","#8a928a","#00e6c3","#d5d5d5","#ff6b47","#5b9aff","#ffb84d"]},sunsetCoral:{label:"Sunset Coral",light:["#bdbbb8","#e8e6e3","#ffffff","#ff3b3b","#000000","#00f5d4","#1e40af","#fb923c"],dark:["#716f6b","#3f3d3a","#8e8c88","#ff6b6b","#d8d8d8","#00ffe7","#6ba3ff","#ffb570"]},violetPunch:{label:"Violet Punch",light:["#b8b7c2","#e6e5ed","#ffffff","#9333ea","#000000","#dc2626","#0ea5e9","#facc15"],dark:["#6d6c7a","#3a3845","#8b8a98","#c266ff","#dad6e8","#ff5c5c","#42d4ff","#fff066"]},citrusBlast:{label:"Citrus Blast",light:["#bfbdb5","#eae8df","#ffffff","#ea580c","#000000","#e11d48","#2563eb","#059669"],dark:["#74726a","#403e38","#918f87","#ff8c4d","#dbd9d1","#ff5c7a","#6ba3ff","#00d699"]},cobaltSpark:{label:"Cobalt Spark",light:["#b5b8be","#e3e6eb","#ffffff","#1d4ed8","#000000","#ea580c","#db2777","#d97706"],dark:["#696d75","#3a3e45","#878b93","#6b9dff","#d6dae2","#ff8c5c","#ff66b3","#ffc266"]}},w=[.5,.25,.12,.06,.03,.02,.01,.01];function S(e){const t=h(),n=M[e];return n?t.isDarkMode?n.dark:n.light:M.industrialTeal.light}function x(){const e=h().currentColors;if(!e||0===e.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let n=0;for(let a=0;a<Math.min(e.length,w.length);a++)if(n+=w[a],t<=n)return e[a];return e[Math.min(e.length-1,7)]}function E(e){const t=h().currentColors;return t&&0!==t.length?t[Math.max(0,Math.min(7,Math.floor(e)))]||"#ffffff":(console.warn("No colors available, using fallback"),"#ffffff")}function T(e){const t=h();t.currentTemplate=e,t.currentColors=S(e),t.cursorBallColor=t.currentColors[t.cursorBallIndex||4],function(){const e=h(),t=e.balls,n=e.currentColors;if(t.length>0&&n&&n.length>0){const e=Math.min(8,n.length,t.length),a=Math.floor(Math.random()*e);for(let o=0;o<e;o++)t[o].color=n[(a+o)%e];for(let n=e;n<t.length;n++)t[n].color=x();return}for(let e=0;e<t.length;e++)t[e].color=x()}(),function(e){try{const t=document.documentElement,n=(e&&e.length?e:[]).slice(0,8);for(let e=0;e<8;e++){const a=n[e]||"#ffffff";t.style.setProperty(`--ball-${e+1}`,a)}}catch(e){}}(t.currentColors),function(){const e=h().currentColors;for(let t=1;t<=8;t++){const n=document.getElementById(`color${t}`),a=document.getElementById(`color${t}Val`);n&&e[t-1]&&(n.value=e[t-1],a&&(a.textContent=e[t-1].toUpperCase()))}}()}function C(){const e=document.getElementById("colorSelect");if(!e)return;e.innerHTML="";for(const[t,n]of Object.entries(M)){const a=document.createElement("option");a.value=t,a.textContent=n.label,e.appendChild(a)}const t=h();e.value=t.currentTemplate}var P=Object.freeze({__proto__:null,COLOR_TEMPLATES:M,applyColorTemplate:T,getColorByIndex:E,getCurrentPalette:S,pickRandomColor:x,populateColorSelect:C});function I(e,t=.15){return e*(1+2*(Math.random()-.5)*t)}const R={attackTime:.005,decayTime:.075,harmonicGain:0,filterBaseFreq:580,filterVelocityRange:400,filterQ:.18,filterMinHz:350,filterMaxHz:2800,pitchMinHz:145,pitchMaxHz:280,pitchCurve:1,reverbDecay:.14,reverbWetMix:.08,reverbHighDamp:.8,minGain:.008,maxGain:.09,masterGain:.28,voiceGainMax:.14,minTimeBetweenSounds:.012,maxPan:.15,noiseTransientEnabled:!0,noiseTransientGain:.045,noiseTransientDecay:.008,noiseTransientFilterMin:500,noiseTransientFilterMax:1800,noiseTransientQ:1.2,sparkleGain:0,sparkleRatioMin:2.3,sparkleRatioMax:4.1,sparkleDecayMul:.65,variancePitch:.06,varianceDecay:.2,varianceGain:.15,varianceFilter:.18,varianceNoise:.25,velocityNoiseScale:1.8,velocityBrightnessScale:1.4,velocityDecayScale:.65,intensityExponent:1.5,toneSafetyMinHz:130,toneSafetyMaxHz:480,toneSafetyExponent:2.2,toneSafetyHighGainAtten:.25,toneSafetyLowGainAtten:.06,toneSafetyHighBrightAtten:.45,collisionMinImpact:.58,highShelfFreq:2200,highShelfGain:-6};let k=null;const B={organicImpact:{label:"Organic Impact",description:"Warm, natural thuds with intensity dynamics",...R},glassMarbles:{label:"Glass Marbles",description:"Clear, glassy impacts with more presence",...R,pitchMinHz:260,pitchMaxHz:780,pitchCurve:1.05,filterBaseFreq:850,filterVelocityRange:600,noiseTransientGain:.065,noiseTransientFilterMin:650,noiseTransientFilterMax:2200,noiseTransientQ:1.6,decayTime:.055,intensityExponent:1.3,highShelfGain:-4.5},crystalPebbles:{label:"Crystal Pebbles ★",description:"Crisp, close, soothing micro-chimes (non-repetitive)",...R,pitchMinHz:420,pitchMaxHz:1600,pitchCurve:1.15,filterBaseFreq:1300,filterVelocityRange:1700,filterQ:.22,filterMaxHz:6200,decayTime:.04,intensityExponent:1.65,collisionMinImpact:.7,minTimeBetweenSounds:.018,noiseTransientGain:.02,noiseTransientDecay:.006,noiseTransientFilterMin:1200,noiseTransientFilterMax:7e3,noiseTransientQ:2.8,sparkleGain:.12,sparkleRatioMin:2.6,sparkleRatioMax:4.4,sparkleDecayMul:.55,reverbWetMix:.04,reverbDecay:.1,highShelfGain:-4,masterGain:.24},woodenBeads:{label:"Wooden Beads ★",description:"Ultra-soft, muted thuds (recommended)",...R,filterBaseFreq:420,filterVelocityRange:200,noiseTransientGain:.025,noiseTransientFilterMin:380,noiseTransientFilterMax:1400,noiseTransientQ:1.1,decayTime:.095,intensityExponent:1.7,collisionMinImpact:.62,highShelfGain:-7.5,reverbWetMix:.12},rubberBalls:{label:"Rubber Balls",description:"Bouncy, playful with longer decay",...R,pitchMinHz:160,pitchMaxHz:360,filterBaseFreq:520,filterVelocityRange:350,noiseTransientGain:.035,noiseTransientFilterMin:450,noiseTransientFilterMax:1600,noiseTransientQ:1.2,decayTime:.12,intensityExponent:1.4,reverbWetMix:.14,highShelfGain:-5},metallicClick:{label:"Metallic Click",description:"Crisp, percussive impacts",...R,pitchMinHz:220,pitchMaxHz:620,pitchCurve:1.1,filterBaseFreq:720,filterVelocityRange:550,noiseTransientGain:.08,noiseTransientFilterMin:700,noiseTransientFilterMax:2400,noiseTransientQ:1.8,noiseTransientDecay:.006,decayTime:.045,intensityExponent:1.2,highShelfGain:-3.5,collisionMinImpact:.5}};let _="crystalPebbles";k={...B[_]},delete k.label,delete k.description;let A=null,L=null,F=null,O=null,D=null,V=null,N=null,$=null,q=!1,W=!1;const G="bravia-balls:sound-state";function K(){try{"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent(G,{detail:ie()}))}catch(e){}}const H=8;let z=[],X=0,Y=new Map,U=!1,j=null,Q=!1;function J(){if(!Q&&(Q=!0,"undefined"!=typeof window&&window.matchMedia)){const e=window.matchMedia("(prefers-reduced-motion: reduce)");U=e.matches,e.addEventListener("change",e=>{U=e.matches})}}async function Z(){if(W)return!0;try{const e=window.AudioContext||window.webkitAudioContext;if(!e)return console.warn("Web Audio API not supported"),!1;A=new e({latencyHint:"interactive",sampleRate:44100}),"suspended"===A.state&&await A.resume(),function(){L=A.createGain(),L.gain.value=k.masterGain,V=A.createDynamicsCompressor(),V.threshold.value=-6,V.knee.value=10,V.ratio.value=16,V.attack.value=5e-4,V.release.value=.08,$=A.createBiquadFilter(),$.type="highshelf",$.frequency.value=k.highShelfFreq,$.gain.value=k.highShelfGain,$.Q.value=.7,N=A.createWaveShaper(),N.curve=function(e=.55){const t=1024,n=new Float32Array(t),a=1+8*e;for(let e=0;e<t;e++){const o=2*e/(t-1)-1;n[e]=Math.tanh(a*o)/Math.tanh(a)}return n}(.55),N.oversample="2x",O=A.createGain(),O.gain.value=1-k.reverbWetMix,D=A.createGain(),D.gain.value=k.reverbWetMix,F=function(){const e=A.createGain(),t=A.createGain(),n=[.029,.037,.053,.067].map(e=>{const t=A.createDelay(.1);return t.delayTime.value=e*k.reverbDecay,t}),a=n.map(()=>{const e=A.createGain();return e.gain.value=.4,e}),o=A.createBiquadFilter();return o.type="lowpass",o.frequency.value=2e3*(1-k.reverbHighDamp),o.Q.value=.5,n.forEach((t,i)=>{e.connect(t),t.connect(a[i]),a[i].connect(o),a[i].connect(n[(i+1)%n.length])}),o.connect(t),e.connect(t),e._output=t,e}();const e=F._output;O.connect(N),D.connect(F),e.connect(N),N.connect($),$.connect(V),V.connect(L),L.connect(A.destination),function(){z=[];for(let e=0;e<H;e++){const t={id:e,inUse:!1,startTime:0,filter:A.createBiquadFilter(),envelope:A.createGain(),panner:A.createStereoPanner(),reverbSend:A.createGain(),noiseFilter:A.createBiquadFilter(),noiseEnvelope:A.createGain(),osc:null,harmonicOsc:null,sparkleOsc:null,noiseSource:null};t.filter.type="lowpass",t.noiseFilter.type="bandpass",t.noiseFilter.Q.value=1.2,t.filter.connect(t.envelope),t.envelope.connect(t.panner),t.panner.connect(O),t.panner.connect(t.reverbSend),t.reverbSend.connect(D),t.noiseFilter.connect(t.noiseEnvelope),t.noiseEnvelope.connect(t.panner),z.push(t)}}()}(),W=!0,q=!0,K();const t=1e3*(A.baseLatency||0);return console.log(`✓ Audio unlocked (${t.toFixed(1)}ms base latency)`),!0}catch(e){return console.error("Failed to unlock audio:",e),!1}}function ee(e,t,n=.5,a=null){if(!q||!W||!A||U)return;if(t<k.collisionMinImpact)return;const o=A.currentTime;if(o-X<.005)return;if(null!==a){if(o-(Y.get(a)||0)<k.minTimeBetweenSounds)return;Y.set(a,o)}if(X=o,Y.size>200){const e=o-.5;for(const[t,n]of Y)n<e&&Y.delete(t)}const i=function(){for(let e=0;e<H;e++)if(!z[e].inUse)return z[e];let e=z[0];for(let t=1;t<H;t++)z[t].startTime<e.startTime&&(e=z[t]);return ne(e),e}();i&&function(e,t,n,a,o){e.inUse=!0,e.startTime=o;const i=Math.max(0,Math.min(1,n)),s=Math.pow(i,k.intensityExponent),r=I(t,k.variancePitch),l=I(k.decayTime,k.varianceDecay)*(1-s*(1-k.velocityDecayScale)),c=l+.02;let d=k.minGain+(k.maxGain-k.minGain)*s;d*=I(1,k.varianceGain);const u=1+(k.velocityBrightnessScale-1)*s;let p=k.filterBaseFreq+k.filterVelocityRange*Math.pow(s,1.3);p*=I(1,k.varianceFilter)*u;const h=2*(a-.5)*k.maxPan,m=.12+.5*(1-s);({gain:d,filterFreq:p}=function(e,t,n){const a=ae((e-k.toneSafetyMinHz)/(k.toneSafetyMaxHz-k.toneSafetyMinHz),0,1),o=k.toneSafetyExponent,i=Math.pow(a,o),s=Math.pow(1-a,o),r=ae(1-k.toneSafetyHighGainAtten*i-k.toneSafetyLowGainAtten*s,.6,1);let l=Math.min(t*r,k.voiceGainMax);const c=ae(1-k.toneSafetyHighBrightAtten*i,.55,1);return{gain:l,filterFreq:ae(n*c,k.filterMinHz,k.filterMaxHz)}}(r,d,p)),e.filter.frequency.value=p,e.filter.Q.value=k.filterQ,e.panner.pan.value=h,e.reverbSend.gain.value=m,e.noiseFilter.Q.value=ae(k.noiseTransientQ||1.2,.5,8),e.envelope.gain.cancelScheduledValues(o),e.envelope.gain.setValueAtTime(d,o),e.envelope.gain.exponentialRampToValueAtTime(.001,o+l);const f=A.createOscillator();if(f.type="sine",f.frequency.value=r,e.osc=f,f.connect(e.filter),(k.harmonicGain||0)>.001){const t=A.createOscillator();t.type="sine",t.frequency.value=2*r;const n=A.createGain();n.gain.cancelScheduledValues(o),n.gain.setValueAtTime(d*k.harmonicGain,o),n.gain.exponentialRampToValueAtTime(.001,o+l),e.harmonicOsc=t,t.connect(n),n.connect(e.filter),t.onended=()=>{try{n.disconnect()}catch(e){}},t.start(o),t.stop(o+c)}else e.harmonicOsc=null;if((k.sparkleGain||0)>.001){const t=A.createOscillator();t.type="sine";const n=k.sparkleRatioMin||2.3,a=k.sparkleRatioMax||4.1,i=ae(n+Math.random()*(a-n),1.2,10);t.frequency.value=r*I(i,.02);const s=A.createGain(),u=Math.max(.012,l*ae(k.sparkleDecayMul||.65,.25,.95));s.gain.cancelScheduledValues(o),s.gain.setValueAtTime(d*k.sparkleGain,o),s.gain.exponentialRampToValueAtTime(.001,o+u),e.sparkleOsc=t,t.connect(s),s.connect(e.filter),t.onended=()=>{try{s.disconnect()}catch(e){}},t.start(o),t.stop(o+c)}else e.sparkleOsc=null;if(k.noiseTransientEnabled&&s>.25){const t=function(){if(!j){const e=2*A.sampleRate;j=A.createBuffer(1,e,A.sampleRate);const t=j.getChannelData(0);let n=0,a=0,o=0;for(let i=0;i<e;i++){const e=2*Math.random()-1;n=.99765*n+.099046*e,a=.963*a+.2965164*e,o=.57*o+1.0526913*e,t[i]=.25*(n+a+o+.1848*e)}}const e=A.createBufferSource();return e.buffer=j,e.loopStart=1.5*Math.random(),e.loopEnd=e.loopStart+.1,e.loop=!1,e}();e.noiseSource=t;const n=Math.pow(s,1.4),a=k.noiseTransientFilterMin+(k.noiseTransientFilterMax-k.noiseTransientFilterMin)*n;e.noiseFilter.frequency.value=I(a,k.varianceNoise);const i=k.noiseTransientGain*k.velocityNoiseScale*n*d,r=I(k.noiseTransientDecay,k.varianceNoise);e.noiseEnvelope.gain.cancelScheduledValues(o),e.noiseEnvelope.gain.setValueAtTime(i,o),e.noiseEnvelope.gain.exponentialRampToValueAtTime(.001,o+r),t.connect(e.noiseFilter),t.start(o),t.stop(o+r+.01)}else e.noiseSource=null;f.start(o),f.stop(o+c),f.onended=()=>ne(e)}(i,function(e){const t=1-ae((e-8)/47,0,1),n=ae(k.pitchMinHz||145,40,6e3),a=ae(k.pitchMaxHz||280,n+10,12e3),o=ae(k.pitchCurve||1,.5,2.5);return(n+Math.pow(t,o)*(a-n))*I(1,1.5*(k.variancePitch||.06))}(e),Math.max(0,Math.min(1,t)),n,o)}function te({intensity:e=.82,radius:t=18,xPosition:n=.72}={}){ee(t,e,n,null)}function ne(e){if(e.osc){try{e.osc.stop(),e.osc.disconnect()}catch(e){}e.osc=null}if(e.harmonicOsc){try{e.harmonicOsc.stop(),e.harmonicOsc.disconnect()}catch(e){}e.harmonicOsc=null}if(e.sparkleOsc){try{e.sparkleOsc.stop(),e.sparkleOsc.disconnect()}catch(e){}e.sparkleOsc=null}if(e.noiseSource){try{e.noiseSource.stop(),e.noiseSource.disconnect()}catch(e){}e.noiseSource=null}e.inUse=!1}function ae(e,t,n){return e<t?t:e>n?n:e}function oe(){return!!W&&(q=!q,K(),q)}function ie(){return{isUnlocked:W,isEnabled:q,activeSounds:z.filter(e=>e.inUse).length,poolSize:H}}function se(){return{...k}}function re(e){for(const[t,n]of Object.entries(e))t in k&&(k[t]=n);D&&O&&"reverbWetMix"in e&&(D.gain.value=k.reverbWetMix,O.gain.value=1-k.reverbWetMix),$&&("highShelfFreq"in e||"highShelfGain"in e)&&($.frequency.value=k.highShelfFreq,$.gain.value=k.highShelfGain),L&&"masterGain"in e&&(L.gain.value=k.masterGain)}function le(e){const t=B[e];if(!t)return!1;_=e;const{label:n,description:a,...o}=t;return re(o),!0}function ce(){return _}const de=new Map;function ue(){const e=h(),t=e.balls,a=e.canvas,o=e.R_MAX,i=(e.ballSpacing||0)*(e.DPR||1),s=t.length;if(s<2)return[];const r=Math.max(1,2*o),l=Math.ceil(a.width/r)+1;de.clear();for(let e=0;e<s;e++){const n=t[e],a=n.x/r|0,o=(n.y/r|0)*l+a;let i=de.get(o);i||(i=[],de.set(o,i)),i.push(e)}const c=[];for(const[e,a]of de){const o=e/l|0,s=e%l;for(let e=-1;e<=1;e++)for(let r=-1;r<=1;r++){const d=(o+e)*l+(s+r),u=de.get(d);if(u)for(let e=0;e<a.length;e++){const o=a[e];for(let e=0;e<u.length;e++){const a=u[e];if(a<=o)continue;const s=t[o],r=t[a],l=r.x-s.x,d=r.y-s.y,p=s.r+r.r+i,h=l*l+d*d;if(h<p*p){const e=p-Math.sqrt(Math.max(h,n.MIN_DISTANCE_EPSILON));c.push({i:o,j:a,overlap:e})}}}}}return c.sort((e,t)=>t.overlap-e.overlap),c}function pe(e=10){const t=h(),a=t.balls,o=ue(),i=t.REST,s=.5*t.DPR,r=(t.ballSpacing||0)*(t.DPR||1);for(let l=0;l<e;l++)for(let e=0;e<o.length;e++){const{i:c,j:d}=o[e],u=a[c],p=a[d];if(u.isSleeping&&p.isSleeping)continue;u.isSleeping&&u.wake(),p.isSleeping&&p.wake();const h=p.x-u.x,m=p.y-u.y,f=u.r+p.r+r,g=h*h+m*m;if(0===g||g>f*f)continue;const y=Math.sqrt(g),b=h/y,v=m/y,M=f-y,w=1/Math.max(u.m,.001),S=1/Math.max(p.m,.001),x=.8*Math.max(M-s,0)/(w+S),E=x*b,T=x*v;u.x-=E*w,u.y-=T*w,p.x+=E*S,p.y+=T*S;const C=p.vx-u.vx,P=p.vy-u.vy,I=C*b+P*v;if(I<0){const e=-(1+(Math.abs(I)<30?0:i))*I/(w+S),a=e*b,o=e*v;u.vx-=a*w,u.vy-=o*w,p.vx+=a*S,p.vy+=o*S;const s=C-I*b,r=P-I*v,d=Math.hypot(s,r);if(d>.001){const e=s*-v+r*b>=0?1:-1,t=n.SPIN_GAIN_TANGENT;u.omega-=e*t*d/Math.max(u.r,1),p.omega+=e*t*d/Math.max(p.r,1)}const h=Math.min(1,Math.abs(I)/(50*(u.r+p.r))),m=Math.min(t.getSquashMax(),.8*h);u.squashAmount=Math.max(u.squashAmount,.8*m),u.squashNormalAngle=Math.atan2(-v,-b),p.squashAmount=Math.max(p.squashAmount,.8*m),p.squashNormalAngle=Math.atan2(v,b),0===l&&ee((u.r+p.r)/2,h,(u.x+p.x)/2/(t.canvas?.width||1),`${c}-${e}`)}}}const he=12;class me{constructor(){this.deformations=new Float32Array(he),this.velocities=new Float32Array(he),this.pressure=new Float32Array(he)}impact(e,t){const n=h(),a=Math.max(0,Math.min(.45,n.wallWobbleCornerClamp??.1)),o=11*Math.max(a,Math.min(1-a,e)),i=(n.wallWobbleMaxDeform??30)*t,s=Math.max(.25,n.wallWobbleSigma??2);for(let e=1;e<11;e++){const t=Math.abs(e-o),n=Math.exp(-t*t/(2*s*s)),a=Math.min(e,11-e),r=Math.min(1,a/2);this.velocities[e]+=i*n*r}}addPressure(e,t){const n=Math.max(0,Math.min(.45,.1)),a=11*Math.max(n,Math.min(1-n,e)),o=Math.max(1,Math.floor(a-2)),i=Math.min(10,Math.ceil(a+2));for(let e=o;e<=i;e++){const n=Math.abs(e-a),o=Math.max(0,1-n/3);this.pressure[e]=Math.min(1,this.pressure[e]+t*o)}}clearPressure(){this.pressure.fill(0)}step(e){const t=h(),n=Math.max(1,t.wallWobbleStiffness??400),a=Math.max(0,t.wallWobbleDamping??18),o=Math.max(0,t.wallWobbleMaxDeform??30),i=2*Math.sqrt(n);this.deformations[0]=0,this.deformations[11]=0,this.velocities[0]=0,this.velocities[11]=0,this.pressure[0]=0,this.pressure[11]=0;for(let t=1;t<11;t++){const s=Math.abs(this.velocities[t]),r=Math.abs(this.deformations[t]),l=a*(1+1*Math.max(0,Math.min(1,1-r/20)))*(1+15*this.pressure[t]),c=Math.min(l,.95*i),d=-n*this.deformations[t]-c*this.velocities[t];this.velocities[t]+=d*e,this.deformations[t]+=this.velocities[t]*e,this.deformations[t]=Math.max(0,Math.min(o,this.deformations[t]));const u=this.pressure[t]>.5?.3:this.pressure[t]>.1?.8:2,p=this.pressure[t]>.5?.5:this.pressure[t]>.1?3:10;r<u&&s<p&&(this.deformations[t]=0,this.velocities[t]=0)}}getDeformAt(e){const t=11*Math.max(0,Math.min(1,e)),n=Math.floor(t),a=Math.min(n+1,11),o=t-n,i=o*o*(3-2*o);return this.deformations[n]*(1-i)+this.deformations[a]*i}getMaxDeformation(){let e=0;for(let t=0;t<he;t++)this.deformations[t]>e&&(e=this.deformations[t]);return e}hasDeformation(){return this.getMaxDeformation()>2}reset(){this.deformations.fill(0),this.velocities.fill(0),this.pressure.fill(0)}}const fe={top:new me,bottom:new me,left:new me,right:new me,clearAllPressure(){this.top.clearPressure(),this.bottom.clearPressure(),this.left.clearPressure(),this.right.clearPressure()},step(e){this.top.step(e),this.bottom.step(e),this.left.step(e),this.right.step(e)},reset(){this.top.reset(),this.bottom.reset(),this.left.reset(),this.right.reset()},hasAnyDeformation(){return this.top.hasDeformation()||this.bottom.hasDeformation()||this.left.hasDeformation()||this.right.hasDeformation()}};function ge(e,t,n){e.startsWith("corner")||("top"===e?fe.top.impact(t,n):"bottom"===e?fe.bottom.impact(t,n):"left"===e?fe.left.impact(t,n):"right"===e&&fe.right.impact(t,n))}function ye(e,t,n=1){e.startsWith("corner")||("top"===e?fe.top.addPressure(t,n):"bottom"===e?fe.bottom.addPressure(t,n):"left"===e?fe.left.addPressure(t,n):"right"===e&&fe.right.addPressure(t,n))}let be=0;class ve{constructor(e,t,n,a){const o=h();this.x=e,this.y=t,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=n,this.rBase=n,this.m=o.ballMassKg,this.color=a,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1,this.isSleeping=!1,this.sleepTimer=0,this._soundId="ball-"+be++}step(e,a){const o=h(),{currentMode:i,G:s,gravityScale:r,FRICTION:l,MASS_BASELINE_KG:c}=o;this.t+=e,this.age+=e;const d=i===t.PIT||i===t.PIT_THROWS;if(this.isSleeping&&d){const e=o.mouseX,t=o.mouseY,n=(o.repelRadius||710)*o.DPR*1.2,a=this.x-e,i=this.y-t;a*a+i*i<n*n&&this.wake()}if(this.isSleeping)return;i!==t.WEIGHTLESS&&(this.vy+=s*r*e);const u=Math.max(.25,this.m/c),p=Math.sqrt(this.vx*this.vx+this.vy*this.vy),m=(i===t.WEIGHTLESS?1e-4:l)*(1+1*Math.max(0,Math.min(1,1-p/100))),f=Math.max(0,1-m/u);this.vx*=f,this.vy*=f,Math.abs(this.vx)<2&&(this.vx=0),Math.abs(this.vy)<2&&i===t.WEIGHTLESS&&(this.vy=0),0!==this.driftAx&&this.age<this.driftTime?this.vx+=this.driftAx*e/u:0!==this.driftAx&&(this.driftAx=0),a&&a(this,e),this.x+=this.vx*e,this.y+=this.vy*e;const g=Math.abs(this.omega),y=Math.max(0,Math.min(1,1-g/2)),b=n.SPIN_DAMP_PER_S*(1+.5*y),v=Math.max(0,1-b*e);this.omega*=v,this.theta+=this.omega*e,Math.abs(this.omega)<.01&&(this.omega=0);const M=Math.min(1,n.SQUASH_DECAY_PER_S*e);this.squashAmount+=(0-this.squashAmount)*M,this.squash=1-this.squashAmount,d&&this.updateSleepState(e,o)}updateSleepState(e,t){const a=Math.sqrt(this.vx*this.vx+this.vy*this.vy),o=Math.abs(this.omega),i=t.canvas;i&&this.y+this.r>=i.height-1&&a<n.SLEEP_VELOCITY_THRESHOLD&&o<n.SLEEP_ANGULAR_THRESHOLD?(this.sleepTimer+=e,this.sleepTimer>=n.TIME_TO_SLEEP&&(this.vx=0,this.vy=0,this.omega=0,this.isSleeping=!0)):this.sleepTimer=0}wake(){this.isSleeping=!1,this.sleepTimer=0}walls(e,a,o,i){const s=h(),{REST:r,MASS_BASELINE_KG:l,MASS_REST_EXP:c,currentMode:d,DPR:u}=s,p=void 0!==i?i:r,m="function"==typeof s.getCanvasCornerRadius?s.getCanvasCornerRadius():s.cornerRadius??s.wallRadius??42,f=Math.max(0,m)*(u||1),g=Math.max(0,s.wallInset??3)*(u||1),y=Math.max(0,f-g);let b=!1;const v=[{cx:f,cy:f},{cx:e-f,cy:f},{cx:f,cy:a-f},{cx:e-f,cy:a-f}];for(let n=0;n<v.length;n++){if((d===t.PIT||d===t.PIT_THROWS)&&n<2)continue;const o=v[n],i=n%2==0?this.x<f:this.x>e-f,s=n<2?this.y<f:this.y>a-f;if(i&&s){const e=this.x-o.cx,t=this.y-o.cy,n=Math.sqrt(e*e+t*t),a=y-this.r;if(n>a&&a>0){b=!0;const o=n-a,i=e/n,s=t/n;this.x-=i*o,this.y-=s*o;const r=this.vx*i+this.vy*s;r>0&&(this.vx-=(1+p)*r*i,this.vy-=(1+p)*r*s)}}}const M=g,w=e-g,S=g,x=a-g;if(this.y+this.r>x){b=!0,this.y=x-this.r;const t=this.vy,a=this.vx-this.omega*this.r,i=Math.max(.25,this.m/l);this.omega+=a/this.r*n.SPIN_GAIN/i;const r=Math.abs(this.vx),d=Math.max(0,Math.min(1,1-r/80)),u=n.ROLL_FRICTION_PER_S*(1+1*d),h=Math.max(0,1-u*o/i);this.vx*=h,Math.abs(this.vx)<3&&(this.vx=0);const m=Math.abs(t)<n.WALL_REST_VEL_THRESHOLD?0:p;this.vy=-this.vy*(m*Math.pow(l/this.m,c));const f=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(s.getSquashMax(),.8*f),this.squashNormalAngle=-Math.PI/2;const g=this.vx/this.r;this.omega+=(g-this.omega)*Math.min(1,n.GROUND_COUPLING_PER_S*o),Math.abs(this.omega)<.05&&(this.omega=0),ee(this.r,.7*f,this.x/e,this._soundId),!this.isSleeping&&t>0&&t>=n.WALL_REST_VEL_THRESHOLD&&ge("bottom",this.x/e,f);const y=this.isSleeping?1:Math.min(1,(n.WALL_REST_VEL_THRESHOLD-Math.abs(t))/n.WALL_REST_VEL_THRESHOLD);y>.1&&ye("bottom",this.x/e,y)}if(d!==t.PIT&&d!==t.PIT_THROWS&&this.y-this.r<S){b=!0,this.y=S+this.r;const t=this.vy;this.vy=-this.vy*p;const a=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(s.getSquashMax(),.8*a),this.squashNormalAngle=Math.PI/2,ee(this.r,.7*a,this.x/e,this._soundId),!this.isSleeping&&t<0&&Math.abs(t)>=n.WALL_REST_VEL_THRESHOLD&&ge("top",this.x/e,a);const o=this.isSleeping?1:Math.min(1,(n.WALL_REST_VEL_THRESHOLD-Math.abs(t))/n.WALL_REST_VEL_THRESHOLD);o>.1&&ye("top",this.x/e,o)}if(this.x+this.r>w){b=!0,this.x=w-this.r;const e=this.vx,t=this.vy-this.omega*this.r,o=Math.max(.25,this.m/l);this.omega+=t/this.r*(.5*n.SPIN_GAIN)/o,this.vx=-this.vx*(r*Math.pow(l/this.m,c));const i=Math.min(1,Math.abs(e)/(70*this.r));this.squashAmount=Math.min(s.getSquashMax(),.8*i),this.squashNormalAngle=Math.PI,ee(this.r,.6*i,1,this._soundId),!this.isSleeping&&e>0&&e>=n.WALL_REST_VEL_THRESHOLD&&ge("right",this.y/a,i);const d=this.isSleeping?1:Math.min(1,(n.WALL_REST_VEL_THRESHOLD-Math.abs(e))/n.WALL_REST_VEL_THRESHOLD);d>.1&&ye("right",this.y/a,d)}if(this.x-this.r<M){b=!0,this.x=M+this.r;const e=this.vx,t=this.vy-this.omega*this.r,o=Math.max(.25,this.m/l);this.omega+=t/this.r*(.5*n.SPIN_GAIN)/o,this.vx=-this.vx*(r*Math.pow(l/this.m,c));const i=Math.min(1,Math.abs(e)/(70*this.r));this.squashAmount=Math.min(s.getSquashMax(),.8*i),this.squashNormalAngle=0,ee(this.r,.6*i,0,this._soundId),!this.isSleeping&&e<0&&Math.abs(e)>=n.WALL_REST_VEL_THRESHOLD&&ge("left",this.y/a,i);const d=this.isSleeping?1:Math.min(1,(n.WALL_REST_VEL_THRESHOLD-Math.abs(e))/n.WALL_REST_VEL_THRESHOLD);d>.1&&ye("left",this.y/a,d)}b&&this.isSleeping&&this.wake()}draw(e){const t=this.squashAmount>.001,n=this.alpha<1;if(t||n){if(e.save(),e.translate(this.x,this.y),t){e.rotate(this.theta+this.squashNormalAngle);const t=1-.3*this.squashAmount,n=1+.3*this.squashAmount;e.scale(t,n),e.rotate(-this.squashNormalAngle)}else e.rotate(this.theta);n&&(e.globalAlpha=this.alpha),e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI),e.fillStyle=this.color,e.fill(),e.restore()}else e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.r,0,2*Math.PI),e.fill()}}const Me=[];function we(e,t){const n=h(),a=n.waterDrag||.015;e.vx*=1-a,e.vy*=1-a,e.omega*=1-.5*a;for(let n=0;n<Me.length;n++){const a=Me[n],o=e.x-a.x,i=e.y-a.y,s=Math.sqrt(o*o+i*i),r=40,l=a.radius-r,c=a.radius+r;if(s>l&&s<c){const n=Math.abs(s-a.radius),l=a.strength*(1-n/r);if(s>.1){const n=o/s,a=i/s;e.vx+=n*l*t,e.vy+=a*l*t}}}const o=n.waterDriftStrength||25;e.vx+=Math.sin(.5*e.t+.01*e.x)*o*t,e.vy+=Math.cos(.7*e.t+.01*e.y)*o*t}function Se(e){const t=h().waterRippleSpeed||300;for(let n=Me.length-1;n>=0;n--){const a=Me[n];a.radius+=t*e,a.age+=e,a.strength*=.96,(a.age>3||a.strength<10)&&Me.splice(n,1)}}function xe(e,t,n=1){const a=(h().waterRippleStrength||15e3)*Math.min(n,5);Me.push({x:e,y:t,radius:0,strength:a,age:0})}function Ee(e,t,n){n||(n=x());const a=h(),o=(a.R_MIN+a.R_MAX)/2;let i;if(0===a.sizeVariation)i=o;else{const e=.1*o;r=o+e,i=(s=Math.max(1,o-e))+Math.random()*(r-s)}var s,r;const l=new ve(e,t,i,n),c=e<.5*a.canvas.width?1:-1,d=(m=i/(.5*(a.R_MIN+a.R_MAX)),Math.max(.6,Math.min(1.4,m))),u=140*d,p=180*d;var m;return l.vx=c*(u+Math.random()*p),l.vy=120*-Math.random(),l.driftAx=c*(360+420*Math.random())*d,l.driftTime=.22+.28*Math.random(),a.balls.push(l),l}function Te(e,t){const n=h(),a=-1e9===n.mouseX?.5*n.canvas.width:n.mouseX,o=-1e9===n.mouseY?.5*n.canvas.height:n.mouseY,i=a-e.x,s=o-e.y,r=Math.sqrt(i*i+s*s+1),l=i/r,c=s/r;e.vx+=4e3*l*t,e.vy+=4e3*c*t;const d=120*n.DPR;let u=0,p=0,m=0;for(let t=0;t<n.balls.length;t++){const a=n.balls[t];if(a===e)continue;const o=e.x-a.x,i=e.y-a.y,s=o*o+i*i;if(s<d*d&&s>0){const e=Math.sqrt(s),t=1-e/d;u+=o/e*t,p+=i/e*t,m++}}if(m>0){const n=15e3;e.vx+=u/m*n*t,e.vy+=p/m*n*t}e.vx+=1e3*(Math.random()-.5)*t,e.vy+=1e3*(Math.random()-.5)*t}function Ce(e,t){const n=h(),a=n.repelPower,o=n.repelRadius,i=n.mouseX,s=n.mouseY;if(!n.repellerEnabled||a<=0||o<=0)return;const r=o*n.DPR,l=e.x-i,c=e.y-s,d=l*l+c*c;if(d>r*r)return;const u=Math.max(Math.sqrt(d),1e-4),p=l/u,m=c/u,f=Math.max(0,1-u/r),g=20*a*Math.pow(f,n.repelSoft||3.4),y=Math.max(.25,e.m/n.MASS_BASELINE_KG);e.vx+=p*g*t/y,e.vy+=m*g*t/y}function Pe(e,t,n){return Math.max(t,Math.min(n,e))}function Ie(e,t){return e+Math.random()*(t-e)}function Re(e){for(let t=7;t>0;t--){const n=Math.random()*(t+1)|0,a=e[t];e[t]=e[n],e[n]=a}}function ke(e){const t=e.colorBag;if(!t)return 0;e.colorBagIdx>=8&&(Re(t),e.colorBagIdx=0);const n=0|t[e.colorBagIdx];return e.colorBagIdx++,n}function Be(e,t,n,{speedMul:a=1,spreadMul:o=1}={}){const i=e.canvas.width,s=e.canvas.height,r=e.DPR,l=(e.wallThickness||20)*r,c=Math.max(1,i-2*l),d=.35*-s,u=.05*-s,p=Pe(e.pitThrowInletInset??.06,0,.2),h=0===n?l+c*p:i-l-c*p,m=Pe(e.pitThrowSpawnSpread??.02,0,.12),f=Pe(m*o,0,.18),g=h+Ie(-c*f,c*f),y=Ie(d,u),b=Pe(e.pitThrowTargetYFrac??.36,.12,.7),v=Pe(e.pitThrowCrossBias??.12,0,.35),M=Pe(e.pitThrowAimJitter??.04,0,.2),w=Pe(M*o,0,.25),S=i*(.5+(0===n?v:-v)+Ie(-w,w)),x=s*b,T=Pe(e.pitThrowSpeed??650,50,4e3),C=Pe(e.pitThrowSpeedJitter??.22,0,.8),P=Pe(e.pitThrowAngleJitter??.16,0,.8),I=Ee(g,y,E(t)),R=S-g,k=x-y,B=Math.max(1e-4,Math.sqrt(R*R+k*k));let _=R/B,A=k/B;const L=Ie(-Math.PI,Math.PI)*P,F=Math.cos(L),O=Math.sin(L),D=_*O+A*F;_=_*F-A*O,A=D;const V=T*a*(1+Ie(-C,C));return I.vx=_*V,I.vy=A*V,I.driftAx=0,I.driftTime=0,I}function _e(e){const t=h();if(!t||"pit-throws"!==t.currentMode)return;const n=Math.max(0,0|(t.maxBalls??300));if(n<=0)return;if(t.balls.length>=n)return;const a=t._pitThrows;if(!a)return;const o=Pe(t.pitThrowIntervalMs??70,10,2e3)/1e3,i=Pe(t.pitThrowColorPauseMs??180,0,5e3)/1e3,s=Pe(t.pitThrowPairChance??.35,0,1),r=Pe(t.pitThrowPairStaggerMs??18,0,300)/1e3,l=Pe(t.pitThrowSpeedVar??.18,0,1),c=Pe(t.pitThrowSpreadVar??.25,0,1);a.cooldown-=e,a.cooldown<0&&(a.cooldown=0);let d=0;for(a.queueA>=0&&(a.queueA-=e),a.queueB>=0&&(a.queueB-=e);d<6&&t.balls.length<n;){let e=!1;if(a.queueA>=0&&a.queueA<=0){const n=1+Ie(-l,l),o=1+Ie(-c,c);Be(t,a.queueColorA,a.queueSideA,{speedMul:n,spreadMul:o}),a.queueA=-1,d++,e=!0}if(d>=6||t.balls.length>=n)break;if(a.queueB>=0&&a.queueB<=0){const n=1+Ie(-l,l),o=1+Ie(-c,c);Be(t,a.queueColorB,a.queueSideB,{speedMul:n,spreadMul:o}),a.queueB=-1,d++,e=!0}if(!e)break}if(!(a.cooldown>0))for(;d<6&&t.balls.length<n;){if("pause"===a.phase&&(a.phase="throw",a.colorIndex=ke(a),a.side=1-a.side,a.inColorRemaining=0|Pe(t.pitThrowBatchSize??13,1,120)),a.inColorRemaining>0){const e=a.side;a.side=1-a.side;const u=1+Ie(-l,l),p=1+Ie(-c,c);if(Be(t,a.colorIndex,e,{speedMul:u,spreadMul:p}),a.inColorRemaining--,d++,r>0&&Math.random()<s&&t.balls.length<n){const t=1-e;a.queueA<0?(a.queueA=r,a.queueColorA=a.colorIndex,a.queueSideA=t):a.queueB<0&&(a.queueB=r,a.queueColorB=a.colorIndex,a.queueSideB=t)}if(a.inColorRemaining<=0){a.phase="pause",a.cooldown=i;break}a.cooldown=o;break}a.phase="pause",a.cooldown=i;break}}function Ae(e,t){const n=h();if(!n.mouseInCanvas)return;const a=n.weightlessRepelRadius??0,o=n.weightlessRepelPower??0;if(a<=0||o<=0)return;const i=a*(n.DPR||1),s=e.x-n.mouseX,r=e.y-n.mouseY,l=s*s+r*r;if(l>i*i)return;const c=Math.max(Math.sqrt(l),1e-4),d=s/c,u=r/c,p=Math.max(0,1-c/i),m=n.weightlessRepelSoft??2.2,f=20*o*Math.pow(p,m),g=Math.max(.25,e.m/n.MASS_BASELINE_KG);e.vx+=d*f*t/g,e.vy+=u*f*t/g}let Le,Fe,Oe=n.DPR;function De(){Le=document.getElementById("c"),Le?(Fe=Le.getContext("2d",{alpha:!0,desynchronized:!0,willReadFrequently:!1}),Fe||(Fe=Le.getContext("2d"),console.warn("⚠️ Desynchronized mode unavailable, using standard context")),function(){const e=window.devicePixelRatio||1;(navigator.connection?.saveData||navigator.hardwareConcurrency<=4||/Android|iPhone|iPad|iPod/i.test(navigator.userAgent))&&e>1.5?(Oe=1.5,console.log("⚡ Adaptive DPR: Reduced to 1.5x for performance")):Oe=Math.min(e,2),o(Oe)}(),Fe.imageSmoothingEnabled=!1,window.addEventListener("resize",Ve),console.log(`✓ Renderer optimized (DPR: ${Oe.toFixed(2)}, desync: ${Fe.getContextAttributes?.()?.desynchronized??"unknown"})`)):console.error("Canvas not found")}function Ve(){if(!Le)return;const e=h();try{d(),u()}catch(e){}const t=e.container||document.getElementById("bravia-balls"),n=t?t.clientWidth:window.innerWidth,a=t?t.clientHeight:window.innerHeight,o=Oe;Le.width=Math.floor(n*o),Le.height=Math.floor(a*o),Le.style.width=n+"px",Le.style.height=a+"px",Fe&&(Fe.imageSmoothingEnabled=!1),function(e){const t=h();if(!t.canvasShadowEnabled)return void(e.style.filter="");const n=t.shadowOffsetX||1,a=t.shadowOffsetY||1,o=t.shadowBlur||0,i=t.shadowColor||"#000000",s=t.shadowOpacity||.29,r=t.shadow2Enabled?` drop-shadow(0 0 ${t.shadow2Blur||4}px rgba(0,0,0,${t.shadow2Opacity||.1}))`:"";e.style.filter=`drop-shadow(${n}px ${a}px ${o}px ${function(e,t){const n=e.replace("#",""),a=parseInt(n,16);return`rgba(${a>>16&255}, ${a>>8&255}, ${255&a}, ${t})`}(i,s)})${r}`}(Le)}function Ne(){return Le}function $e(){return Fe}function qe(e,n){const a=h();if(a.currentMode!==t.VORTEX)return;const o=a.mouseX,i=a.mouseY;if(!a.mouseInCanvas)return;const s=a.vortexSwirlStrength||420,r=a.vortexRadialPull||180,l=e.x-o,c=e.y-i,d=l*l+c*c,u=Math.max(8,Math.sqrt(d)),p=1/(1+.0015*u),m=l/u,f=c/u,g=-f,y=m,b=s*p;e.vx+=g*b*n,e.vy+=y*b*n;const v=r*p;e.vx-=m*v*n,e.vy-=f*v*n,e.vx*=.995,e.vy*=.995}function We(e,n){const a=h();if(a.currentMode!==t.PING_PONG)return;if(!e.isPingPong)return;if(a.mouseInCanvas){const t=(a.pingPongCursorRadius||100)*a.DPR,n=a.mouseX,o=a.mouseY,i=e.x-n,s=e.y-o,r=Math.sqrt(i*i+s*s),l=t+e.r;if(r<l&&r>.1){const t=l-r,n=i/r,a=s/r;e.x+=n*t*1.1,e.y+=a*t*1.1;const o=e.vx*n+e.vy*a;o<0&&(e.vx-=2*o*n,e.vy-=2*o*a,e.omega+=.02*o)}}const o=a.pingPongSpeed||400;if(Math.abs(e.vx)<.9*o){const t=e.vx>=0?1:-1;e.vx=t*o}e.vy*=.995}function Ge(e,n){const a=h();if(a.currentMode!==t.MAGNETIC)return;if(!a.mouseInCanvas)return;const o=a.mouseX,i=a.mouseY,s=o-e.x,r=i-e.y,l=Math.max(30,Math.sqrt(s*s+r*r)),c=(a.magneticStrength||65e3)/(l*l)*1e3,d=s/l,u=r/l,p=e.charge||1;e.vx+=d*c*p*n,e.vy+=u*c*p*n;const m=a.magneticMaxVelocity||2800,f=Math.sqrt(e.vx*e.vx+e.vy*e.vy);f>m&&(e.vx=e.vx/f*m,e.vy=e.vy/f*m),e.vx*=.998,e.vy*=.998}function Ke(e){const n=h();if(n.currentMode===t.MAGNETIC)for(let e=0;e<n.balls.length;e++)n.balls[e].alpha=1}function He(e,t,n,a=!1){const o=h(),i=.5*o.R_MIN,s=.8*o.R_MAX,r=i+Math.random()*(s-i),l=new ve(e,t,a?r:.1,n);return l.isBubble=!0,l.baseRadius=r,l.targetRadius=r,l.wobblePhase=Math.random()*Math.PI*2,l.wobbleFreq=2+3*Math.random(),l.vx=20*(Math.random()-.5),l.vy=-50-50*Math.random(),l.spawning=!a,l.spawnProgress=a?1:0,l.dissipating=!1,l.dissipateProgress=0,l.alpha=1,o.balls.push(l),l}function ze(e){const t=h(),n=t.canvas;if(!n)return;const a=n.width,o=n.height;e.x=Math.random()*a,e.y=o+60+30*Math.random(),e.vx=20*(Math.random()-.5),e.vy=-50-50*Math.random(),e.wobblePhase=Math.random()*Math.PI*2,e.wobbleFreq=2+3*Math.random(),e.c=x();const i=.5*t.R_MIN,s=.8*t.R_MAX;e.targetRadius=i+Math.random()*(s-i),e.baseRadius=e.targetRadius,e.r=.1,e.rBase=.1,e.spawning=!0,e.spawnProgress=0,e.dissipating=!1,e.dissipateProgress=0,e.alpha=1}function Xe(e,n){const a=h();if(a.currentMode!==t.BUBBLES)return;if(!e.isBubble)return;const o=a.canvas;if(!o)return;if(e.spawning){e.spawnProgress+=3*n;const t=1-Math.pow(1-Math.min(1,e.spawnProgress),3);e.r=e.targetRadius*t,e.rBase=e.r,e.spawnProgress>=1&&(e.spawning=!1,e.r=e.targetRadius,e.rBase=e.targetRadius)}if(e.dissipating){e.dissipateProgress+=3*n;const t=Math.pow(e.dissipateProgress,2);return e.r=e.targetRadius*Math.max(0,1-t),e.rBase=e.r,e.alpha=Math.max(0,1-.5*t),e.vy*=.92,e.vx*=.92,void(e.dissipateProgress>=1&&ze(e))}const i=a.bubblesRiseSpeed||150,s=.01*(a.bubblesWobble||40),r=i*a.DPR;e.vy-=r*n,e.wobblePhase+=e.wobbleFreq*n;const l=Math.sin(e.wobblePhase)*s*100;if(e.vx+=l*n,e.vx*=.92,e.vy*=.96,a.mouseInCanvas){const t=e.x-a.mouseX,o=e.y-a.mouseY,i=Math.sqrt(t*t+o*o),s=(a.bubblesDeflectRadius||200)*a.DPR;if(i<s&&i>1){const a=i/s,r=3e3*Math.pow(1-a,3),l=t/i,c=o/i;if(e.vx+=l*r*n,e.vy+=c*r*n,i<.3*s){const t=500*(1-i/(.3*s));e.vx+=l*t*n,e.vy+=c*t*n}}}const c=2*e.targetRadius;e.y<c&&!e.dissipating&&!e.spawning&&(e.dissipating=!0,e.dissipateProgress=0),(e.x<4*-e.r||e.x>o.width+4*e.r)&&ze(e)}function Ye(e){}const Ue=2*Math.PI,je=1e-6;let Qe=0;function Je(e,t,n){return Math.max(t,Math.min(n,e))}function Ze(e){const t=e.canvas;return{x:.5*t.width,y:.5*t.height}}function et(e){const t=e.canvas;return t?Je(Math.min(t.width,t.height)/1e3,.35,3):1}function tt(e,t,n,a){for(let o=0;o<e.length;o++){const i=e[o],s=t-i.x,r=n-i.y,l=a+i.r;if(s*s+r*r<l*l)return!0}return!1}function nt(e,t,n,a=10){const o=a*a,i=2*a;return e.v+=(t-e.x)*o*n,e.v*=Math.max(0,1-i*n),e.x+=e.v*n,e.x}function at(e,t,n,a){const o=h(),i=Math.max(2,o.wallInset||3)*(o.DPR||1),s=i+e.r,r=t-i-e.r,l=i+e.r,c=n-i-e.r,d=.92,u=Math.max(0,1-.15*a);e.x<s?(e.x=s,e.vx=Math.abs(e.vx)*d*u):e.x>r&&(e.x=r,e.vx=-Math.abs(e.vx)*d*u),e.y<l?(e.y=l,e.vy=Math.abs(e.vy)*d*u):e.y>c&&(e.y=c,e.vy=-Math.abs(e.vy)*d*u)}function ot(e,n){const a=h();if(a.currentMode!==t.KALEIDOSCOPE)return;const o=a.canvas;if(!o)return;const{x:i,y:s}=Ze(a),r=et(a),l=performance.now(),c=l-(a.lastPointerMoveMs||0)<90;void 0===a._kaleiActivity&&(a._kaleiActivity=0);const d=c?1:0,u=d>a._kaleiActivity?.08:.22,p=1-Math.exp(-n/Math.max(1e-4,u));a._kaleiActivity+=(d-a._kaleiActivity)*p;const m=Je(a.kaleidoscopeIdleMotion??.03,0,1),f=m+a._kaleiActivity*(1-m),g=e.x-i,y=e.y-s,b=Math.max(je,Math.hypot(g,y)),v=g/b,M=y/b,w=-M,S=v,x=1/(1+b*(1/Math.max(240,.65*Math.min(o.width,o.height)))),E=(a.kaleidoscopeSwirlStrength??52)*r*x*f,T=(a.kaleidoscopeRadialPull??260)*r*x*f,C=.001*l,P=(e._kaleiSeed??0)+.07*e.age,I=Je(a.kaleidoscopeWander??.25,0,1)*x*f,R=Math.sin(.35*C+P)*(.55*I),k=Math.cos(R),B=Math.sin(R),_=((w*k-v*B)*E-v*T)*n,A=((S*k-M*B)*E-M*T)*n,L=Je(a.kaleidoscopeEase??.18,0,1),F=1-Math.pow(1-L,60*n);e.vx+=_*F,e.vy+=A*F;const O=a._kaleiActivity<.05?.9985:.996;e.vx*=O,e.vy*=O;const D=Je((a.kaleidoscopeMaxSpeed??2600)*r,300,12e3),V=e.vx*e.vx+e.vy*e.vy;if(V>D*D){const t=Math.sqrt(V),n=D/Math.max(je,t);e.vx*=n,e.vy*=n}}function it(e,t,n){return e<t?t:e>n?n:e}function st(e){return e>Math.PI?e-=2*Math.PI:e<-Math.PI&&(e+=2*Math.PI),e}function rt(e,t){const n=h(),a=n.canvas;if(!a)return;const o=Math.max(0,n.critterSpeed||0),i=Math.max(50,n.critterMaxSpeed||0),s=Math.max(0,n.critterStepHz||0),r=n.critterStepSharpness??2.4,l=Math.max(0,n.critterTurnNoise||0),c=Math.max(.1,n.critterTurnDamp||0),d=Math.max(0,n.critterTurnSeek||0),u=Math.max(0,(n.critterAvoidRadius||0)*(n.DPR||1)),p=Math.max(0,n.critterAvoidForce||0),m=Math.max(0,n.critterEdgeAvoid||0),f=Math.max(0,n.critterMousePull||0),g=Math.max(0,n.critterMouseRadiusVw||0);let y=e._critterHeading||0,b=e._critterTurn||0,v=e._critterPhase||0,M=e._critterLastPhase??v,w=e._critterPause||0;const S=e._critterWander||0;w>0?w=Math.max(0,w-t):Math.random()<.25*t&&(w=.03+.09*Math.random());let x=0,E=0;if(m>0){const t=a.width,o=a.height,i=Math.max(24*(n.DPR||1),.08*Math.min(t,o)),s=e.x,r=e.y;s<i?x+=1-s/i:s>t-i&&(x-=1-(t-s)/i),r<i?E+=1-r/i:r>o-i&&(E-=1-(o-r)/i);const l=1.35*m;x*=l,E*=l}let T=0;if(f>0&&-1e9!==n.mouseX){const t=(window.innerWidth||a.width)/100,o=Math.max(1,g*t)*(n.DPR||1),i=e.x-n.mouseX,s=e.y-n.mouseY,r=i*i+s*s;if(r<o*o){const e=Math.sqrt(r)+1e-6,t=1-e/o;T=t;const n=f*(.85+.65*t);x+=i/e*n,E+=s/e*n;const a=.25*t*n;x+=-s/e*a,E+=i/e*a,w=0}}if(u>0&&p>0){const a=n.balls,o=u*u;let i=0,s=0,r=0;for(let t=0;t<a.length;t++){const n=a[t];if(n===e)continue;const l=e.x-n.x,c=e.y-n.y,d=l*l+c*c;if(d>0&&d<o){const e=Math.sqrt(d),t=1-e/u,n=t*t,a=1/(e+1e-6);i+=l*a*n,s+=c*a*n,r++}}if(r>0){const n=1/r;x+=i*n*1.15,E+=s*n*1.15,e.vx+=i*n*(.65*p)*t,e.vy+=s*n*(.65*p)*t}}const C=1+1.35*T*f;b+=((2*Math.random()-1)*(l*C)+.35*S*l)*t,x*x+E*E>1e-6&&(b+=st(Math.atan2(E,x)-y)*(d*t)),b*=Math.exp(-c*t),y=st(y+b*t),s>0&&(M=v,v+=s*t,v-=0|v);const P=w>0?0:function(e,t){const n=(a=it(a=e<.5?2*e:2-2*e,0,1))*a*(3-2*a);var a;const o=it(t,.5,6);return Math.pow(n,o)}(v,r),I=1+.95*T*f;if(w<=0&&v>.82){const t=(v-.82)/.18*.1*(.65+.35*I);t>e.squashAmount&&(e.squashAmount=t,e.squashNormalAngle=-Math.PI/2)}if(w<=0&&s>0&&v<M){const t=Math.max(.25,e.m/(n.MASS_BASELINE_KG||129)),a=o*(.55+.55*P)*I*(.85+.3*Math.random()),i=Math.cos(y),s=Math.sin(y),r=-s,l=i,c=.18*(2*Math.random()-1)*(.35+.65*T)*a;e.vx+=(i*a+r*c)/t,e.vy+=(s*a+l*c)/t,e.squashAmount=Math.max(e.squashAmount,.2+.15*T),e.squashNormalAngle=Math.PI/2}const R=o*(.08+.25*P)*I;e.vx+=Math.cos(y)*R*t,e.vy+=Math.sin(y)*R*t;const k=e.vx,B=e.vy,_=k*k+B*B;if(_>i*i){const t=i/(Math.sqrt(_)+1e-6);e.vx=k*t,e.vy=B*t}e._critterHeading=y,e._critterTurn=b,e._critterPhase=v,e._critterLastPhase=M,e._critterPause=w,e.theta=y}function lt(e){const n=h();if(n.currentMode===t.CRITTERS&&e!==t.CRITTERS&&(void 0!==n._restBeforeCritters&&(n.REST=n._restBeforeCritters,delete n._restBeforeCritters),void 0!==n._frictionBeforeCritters&&(n.FRICTION=n._frictionBeforeCritters,delete n._frictionBeforeCritters),void 0!==n._ballSpacingBeforeCritters&&(n.ballSpacing=n._ballSpacingBeforeCritters,delete n._ballSpacingBeforeCritters)),n.currentMode===t.KALEIDOSCOPE&&e!==t.KALEIDOSCOPE&&void 0!==n._ballSpacingBeforeKaleidoscope&&(n.ballSpacing=n._ballSpacingBeforeKaleidoscope,delete n._ballSpacingBeforeKaleidoscope),f(e),console.log(`Switching to mode: ${e}`),function(e){const t=document.getElementById("announcer");t&&(t.textContent="",setTimeout(()=>{t.textContent=e},10))}(`Switched to ${{pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero Gravity",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope",critters:"Critters"}[e]||e} mode`),n.container){const a=n.container.classList.contains("dark-mode");n.container.className="",e!==t.PIT&&e!==t.PIT_THROWS||n.container.classList.add("mode-pit"),(a||n.isDarkMode)&&n.container.classList.add("dark-mode")}if(Ve(),e===t.PIT)n.gravityMultiplier=n.gravityMultiplierPit,n.G=n.GE*n.gravityMultiplier,n.repellerEnabled=!0,function(){const e=h();g(),function(e,t){const n=e.canvas.width,a=e.canvas.height,o=e.DPR,i=-.5*a,s=(e.wallThickness||20)*o,r=s,l=n-s,c=l-r,d=Math.max(1,.22*c),u=r+c*(2/3),p=Math.max(r,u-.5*d),h=Math.min(l,u+.5*d),m=Math.max(0,0|t);for(let e=0;e<8&&e<m;e++){const t=Ee(p+Math.random()*(h-p),i+Math.random()*(0-i),E(e));t.vx=100*(Math.random()-.5),t.vy=50*Math.random()+50,t.driftAx=0,t.driftTime=0}for(let e=8;e<m;e++){const e=Ee(p+Math.random()*(h-p),i+Math.random()*(0-i));e.vx=100*(Math.random()-.5),e.vy=50*Math.random()+50,e.driftAx=0,e.driftTime=0}}(e,e.maxBalls??300)}();else if(e===t.PIT_THROWS)n.gravityMultiplier=n.gravityMultiplierPit,n.G=n.GE*n.gravityMultiplier,n.repellerEnabled=!0,function(){const e=h();g(),e._pitThrows={colorIndex:0,side:0,inColorRemaining:0|Pe(e.pitThrowBatchSize??13,1,120),cooldown:0,phase:"throw",queueA:-1,queueB:-1,queueColorA:0,queueColorB:0,queueSideA:0,queueSideB:1,colorBag:[0,1,2,3,4,5,6,7],colorBagIdx:8},Re(e._pitThrows.colorBag),e._pitThrows.colorBagIdx=0,e._pitThrows.colorIndex=ke(e._pitThrows),Be(e,e._pitThrows.colorIndex,e._pitThrows.side),e._pitThrows.inColorRemaining=Math.max(0,e._pitThrows.inColorRemaining-1)}();else if(e===t.FLIES)n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,function(){const e=h();g();const t=.5*e.canvas.width,n=.5*e.canvas.height,a=150*e.DPR;for(let e=0;e<8;e++){const o=Math.random()*Math.PI*2,i=Math.random()*a,s=Ee(t+Math.cos(o)*i,n+Math.sin(o)*i,E(e)),r=.5+.5*Math.random(),l=Math.random()*Math.PI*2,c=300*r;s.vx=Math.cos(l)*c,s.vy=Math.sin(l)*c,s.driftAx=0,s.driftTime=0}for(let e=8;e<60;e++){const e=Math.random()*Math.PI*2,o=Math.random()*a,i=Ee(t+Math.cos(e)*o,n+Math.sin(e)*o),s=.5+.5*Math.random(),r=Math.random()*Math.PI*2,l=300*s;i.vx=Math.cos(r)*l,i.vy=Math.sin(r)*l,i.driftAx=0,i.driftTime=0}}();else if(e===t.WEIGHTLESS)n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,function(){const e=h();g();const t=e.weightlessCount,n=e.canvas.width,a=e.canvas.height,o=40*e.DPR;for(let i=0;i<8&&i<t;i++){const t=Ee(o+Math.random()*(n-2*o),o+Math.random()*(a-2*o),E(i)),s=Math.random()*Math.PI*2,r=e.weightlessInitialSpeed*(.7+.3*Math.random());t.vx=Math.cos(s)*r,t.vy=Math.sin(s)*r,t.driftAx=0,t.driftTime=0}for(let i=8;i<t;i++){const t=Ee(o+Math.random()*(n-2*o),o+Math.random()*(a-2*o)),i=Math.random()*Math.PI*2,s=e.weightlessInitialSpeed*(.7+.3*Math.random());t.vx=Math.cos(i)*s,t.vy=Math.sin(i)*s,t.driftAx=0,t.driftTime=0}}();else if(e===t.WATER)n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,function(){const e=h();g(),Me.length=0;const t=e.canvas;if(!t)return;const n=t.width,a=t.height,o=e.waterBallCount||100;for(let t=0;t<8&&t<o;t++){const o=Math.random()*n,i=Math.random()*a,s=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),r=E(t),l=new ve(o,i,s,r),c=e.waterInitialVelocity||120;l.vx=(Math.random()-.5)*c,l.vy=(Math.random()-.5)*c,e.balls.push(l)}for(let t=8;t<o;t++){const t=Math.random()*n,o=Math.random()*a,i=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),s=x(),r=new ve(t,o,i,s),l=e.waterInitialVelocity||120;r.vx=(Math.random()-.5)*l,r.vy=(Math.random()-.5)*l,e.balls.push(r)}}();else if(e===t.VORTEX)n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,function(){const e=h();g();const t=e.canvas;if(!t)return;const n=t.width,a=t.height,o=Math.min(e.vortexBallCount||180,e.maxBalls||300);for(let t=0;t<8&&t<o;t++){const o=Math.random()*n,i=Math.random()*a,s=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),r=E(t),l=new ve(o,i,s,r);l.vx=80*(Math.random()-.5),l.vy=80*(Math.random()-.5),e.balls.push(l)}for(let t=8;t<o;t++){const t=Math.random()*n,o=Math.random()*a,i=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),s=x(),r=new ve(t,o,i,s);r.vx=80*(Math.random()-.5),r.vy=80*(Math.random()-.5),e.balls.push(r)}}();else if(e===t.PING_PONG)n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,function(){const e=h();g();const t=e.canvas;if(!t)return;const n=t.width,a=t.height,o=Math.min(e.pingPongBallCount||80,e.maxBalls||300),i=e.pingPongSpeed||400;for(let t=0;t<8&&t<o;t++){const o=Math.random()*n,s=.15*a+Math.random()*a*.7,r=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),l=E(t),c=new ve(o,s,r,l),d=Math.random()>.5?1:-1;c.vx=d*(.8*i+Math.random()*i*.4),c.vy=0,c.isPingPong=!0,e.balls.push(c)}for(let t=8;t<o;t++){const t=Math.random()*n,o=.15*a+Math.random()*a*.7,s=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),r=x(),l=new ve(t,o,s,r),c=Math.random()>.5?1:-1;l.vx=c*(.8*i+Math.random()*i*.4),l.vy=0,l.isPingPong=!0,e.balls.push(l)}}();else if(e===t.MAGNETIC)n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,function(){const e=h();g();const t=e.canvas;if(!t)return;const n=t.width,a=t.height,o=Math.min(e.magneticBallCount||180,e.maxBalls||300);for(let t=0;t<8&&t<o;t++){const o=Math.random()*n,i=Math.random()*a,s=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),r=E(t),l=new ve(o,i,s,r);l.vx=100*(Math.random()-.5),l.vy=100*(Math.random()-.5),l.charge=Math.random()>.5?1:-1,l.baseAlpha=1,e.balls.push(l)}for(let t=8;t<o;t++){const t=Math.random()*n,o=Math.random()*a,i=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),s=x(),r=new ve(t,o,i,s);r.vx=100*(Math.random()-.5),r.vy=100*(Math.random()-.5),r.charge=Math.random()>.5?1:-1,r.baseAlpha=1,e.balls.push(r)}}();else if(e===t.BUBBLES)n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,function(){const e=h();e.balls.length=0;const t=e.canvas;if(!t)return;const n=t.width,a=t.height,o=e.bubblesMaxCount||200;for(let e=0;e<8&&e<o;e++)He(Math.random()*n,Math.random()*a,E(e),!0);for(let e=8;e<o;e++)He(Math.random()*n,Math.random()*a,x(),!0)}();else if(e===t.KALEIDOSCOPE){n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,void 0===n._ballSpacingBeforeKaleidoscope&&(n._ballSpacingBeforeKaleidoscope=n.ballSpacing);const e=n.canvas,t=e?Math.max(.35,Math.min(3,Math.min(e.width,e.height)/1e3)):1,a=n.kaleidoscopeBallSpacing??n.ballSpacing;n.ballSpacing=a*t,function(){const e=h();g();const t=e.canvas;if(!t)return;const n=t.width,a=t.height,o=.5*n,i=.5*a,s=et(e),r=e.maxBalls||300,l=Je(e.kaleidoscopeBallCount??23,10,r),c=.1*Math.min(n,a),d=.95*Math.min(n,a),u=[],p=Math.max(2,e.wallInset||3)*e.DPR;function m(t){const r=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),l=p+r,h=n-p-r,m=p+r,f=a-p-r;for(let n=0;n<90;n++){const n=Math.random()*Ue,a=c+Math.random()*(d-c),p=Je(o+Math.cos(n)*a,l,h),g=Je(i+Math.sin(n)*a,m,f);if(!tt(u,p,g,r+e.ballSpacing*e.DPR)){u.push({x:p,y:g,r:r+e.ballSpacing*e.DPR});const a=new ve(p,g,r,t);a._kaleiSeed=Math.random()*Ue;const o=(12+12*Math.random())*s;return a.vx=-Math.sin(n)*o,a.vy=Math.cos(n)*o,a.driftAx=0,a.driftTime=0,void e.balls.push(a)}}const g=Math.random()*Ue,y=c+Math.random()*(d-c),b=o+Math.cos(g)*y,v=i+Math.sin(g)*y,M=new ve(b,v,r,t);M._kaleiSeed=Math.random()*Ue;const w=(12+12*Math.random())*s;M.vx=-Math.sin(g)*w,M.vy=Math.cos(g)*w,M.driftAx=0,M.driftTime=0,e.balls.push(M)}for(let e=0;e<8&&e<l;e++)m(E(e));for(let e=8;e<l;e++)m(x())}()}else e===t.CRITTERS&&(n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,void 0===n._restBeforeCritters&&(n._restBeforeCritters=n.REST),void 0===n._frictionBeforeCritters&&(n._frictionBeforeCritters=n.FRICTION),n.REST=n.critterRestitution??n.REST,n.FRICTION=n.critterFriction??n.FRICTION,void 0===n._ballSpacingBeforeCritters&&(n._ballSpacingBeforeCritters=n.ballSpacing),n.ballSpacing=Math.min(n.ballSpacing||0,1),function(){const e=h();g();const t=e.canvas.width,n=e.canvas.height,a=e.DPR||1,o=Math.max(10,Math.min(260,0|e.critterCount)),i=Math.max(4*a,.7*e.R_MIN),s=Math.max(i+1,Math.min(.9*e.R_MAX,16*a));for(let e=0;e<o;e++){const a=Ee(Math.random()*t|0,Math.random()*n|0,E(e%8)),o=i+Math.random()*(s-i);a.r=o,a.m=Math.max(1,o*o*.12),a.vx=0,a.vy=0,a._critterHeading=Math.random()*Math.PI*2,a._critterTurn=0,a._critterPhase=Math.random(),a._critterLastPhase=a._critterPhase,a._critterWander=2*Math.random()-1,a._critterPause=0}}());console.log(`Mode ${e} initialized with ${n.balls.length} balls`)}function ct(){const e=h();return e.currentMode===t.FLIES?Te:e.currentMode===t.PIT||e.currentMode===t.PIT_THROWS?Ce:e.currentMode===t.WEIGHTLESS?Ae:e.currentMode===t.WATER?we:e.currentMode===t.VORTEX?qe:e.currentMode===t.PING_PONG?We:e.currentMode===t.MAGNETIC?Ge:e.currentMode===t.BUBBLES?Xe:e.currentMode===t.KALEIDOSCOPE?ot:e.currentMode===t.CRITTERS?rt:null}function dt(){const e=h();return e.currentMode===t.WATER?Se:e.currentMode===t.PIT_THROWS?_e:e.currentMode===t.MAGNETIC?Ke:e.currentMode===t.BUBBLES?Ye:null}var ut=Object.freeze({__proto__:null,MODES:t,getForceApplicator:ct,getModeUpdater:dt,setMode:lt});let pt=0,ht=null,mt=null,ft=null,gt=0,yt=0;function bt(){try{return!!window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches}catch(e){return!1}}function vt(e,t,n){return e<t?t:e>n?n:e}const Mt=n.PHYSICS_DT;let wt=0;const St=42;function xt(e,t){const n=[{x:St,y:St},{x:t.width-St,y:St},{x:St,y:t.height-St},{x:t.width-St,y:t.height-St}];for(let t=0;t<n.length;t++){const a=n[t].x,o=n[t].y,i=e.x-a,s=e.y-o,r=Math.max(1,Math.hypot(i,s));if(r<St+e.r){const t=(St+e.r-r)/(St+e.r)*1800,n=i/r,a=s/r;e.vx+=n*t*Mt,e.vy+=a*t*Mt}}}const Et=(()=>{try{return{log:console.log?.bind(console)??(()=>{}),info:console.info?.bind(console)??(()=>{}),warn:console.warn?.bind(console)??(()=>{}),error:console.error?.bind(console)??(()=>{}),debug:console.debug?.bind(console)??(()=>{}),groupCollapsed:console.groupCollapsed?.bind(console)??(()=>{}),groupEnd:console.groupEnd?.bind(console)??(()=>{}),table:console.table?.bind(console)??(()=>{})}}catch(e){return{log:()=>{},info:()=>{},warn:()=>{},error:()=>{},debug:()=>{},groupCollapsed:()=>{},groupEnd:()=>{},table:()=>{}}}})();let Tt=null,Ct=0,Pt="undefined"!=typeof performance&&performance.now?performance.now():Date.now(),It=!1;function Rt(){return null===Tt&&(Tt=function(){try{return!1}catch(e){}try{if("8001"===String(globalThis?.location?.port??""))return!0}catch(e){}try{if(Array.from(document.scripts||[]).some(e=>{if("module"!==(e.getAttribute("type")||"").toLowerCase())return!1;const t=e.getAttribute("src")||"";return/(^|\/)main\.js(\?|#|$)/.test(t)}))return!0}catch(e){}return!1}()),Tt}const kt=["#b7bcb7","#d0d0d0","#ffffff","#00695c","#1a1a1a","#ff4013","#0d5cb6","#ffa000"],Bt=[.5,.25,.12,.06,.03,.02,.01,.01];function _t(){const e=Math.random();let t=0;for(let n=0;n<Bt.length;n++)if(t+=Bt[n],e<=t)return kt[n];return kt[0]}function At({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"],silence:n=!1}={}){if(!It){It=!0;try{Et.log("%c"+e,"color: #888; font-style: italic;"),Et.log("");const n=function(e,t=3){const{colorAssignments:n}=function(e,t=3){const n=[];for(let a=0;a<e.length;a++){const o=e[a];for(let e=0;e<o.length;e+=t){const i=o.slice(e,e+t);n.push({row:a,col:e,visible:i.trim().length>0})}}const a=n.map((e,t)=>e.visible?t:-1).filter(e=>e>=0),o=new Array(n.length).fill(null),i=function(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}([...a]);for(let e=0;e<Math.min(8,i.length);e++)o[i[e]]=kt[e];for(const e of a)null===o[e]&&(o[e]=_t());for(let e=0;e<n.length;e++)null===o[e]&&(o[e]="transparent");return{clusters:n,colorAssignments:o}}(e,t),a=[];let o=0;for(const i of e){let e="";const s=[];for(let a=0;a<i.length;a+=t){e+="%c"+i.slice(a,a+t);const r=n[o];s.push(`color: ${r}; font-family: monospace; font-weight: bold;`),o++}a.push([e,...s])}return a}(t,3);for(const e of n)Et.log(...e);Et.log("");const a=(new Date).getFullYear();Et.log("%c© "+a+" Alexander Beck Studio. All rights reserved. Unauthorized reproduction prohibited.","color: #555; font-size: 10px;")}catch(e){}if(n)try{console.log=()=>{},console.info=()=>{},console.warn=()=>{},console.debug=()=>{},console.table=()=>{},console.group=()=>{},console.groupCollapsed=()=>{},console.groupEnd=()=>{}}catch(e){}}}function Lt(e,t){if(!Rt())return;const n=("undefined"!=typeof performance&&performance.now?performance.now():Date.now())-Pt;Ct+=1,Et.log(`[${String(Ct).padStart(2,"0")}] +${n.toFixed(1)}ms ${e}`)}function Ft(e){if(Rt())try{performance.mark(e)}catch(e){}}function Ot(e,t,n){if(!Rt())return null;try{performance.measure(e,t,n);const a=performance.getEntriesByName(e),o=a&&a.length?a[a.length-1]:null;return o?o.duration:null}catch(e){return null}}let Dt="light",Vt="light",Nt=!1;function $t(e,t){return getComputedStyle(document.documentElement).getPropertyValue(e).trim()||t}function qt(e){Dt=e;let t=!1;t="auto"===e?"dark"===Vt:"dark"===e,function(e){const t=h();t.isDarkMode=e,document.documentElement.style.colorScheme=e?"dark":"light",e?(t.container?.classList.add("dark-mode"),document.body.classList.add("dark-mode"),document.documentElement.classList.add("dark-mode")):(t.container?.classList.remove("dark-mode"),document.body.classList.remove("dark-mode"),document.documentElement.classList.remove("dark-mode")),function(e){const t=$t("--chrome-bg-light","#0a0a0a"),n=$t("--chrome-bg-dark","#0a0a0a"),a=e?n:t;let o=document.querySelector('meta[name="theme-color"]');o||(o=document.createElement("meta"),o.name="theme-color",document.head.appendChild(o)),o.content=a;let i=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: light)"]');i||(i=document.createElement("meta"),i.name="theme-color",i.media="(prefers-color-scheme: light)",document.head.appendChild(i)),i.content=t;let s=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: dark)"]');s||(s=document.createElement("meta"),s.name="theme-color",s.media="(prefers-color-scheme: dark)",document.head.appendChild(s)),s.content=n}(e),T(t.currentTemplate),function(){const e=document.getElementById("themeAuto"),t=document.getElementById("themeLight"),n=document.getElementById("themeDark");if(!e||!t||!n)return;[e,t,n].forEach(e=>e.classList.remove("active")),"auto"===Dt?e.classList.add("active"):"light"===Dt?t.classList.add("active"):n.classList.add("active");const a=document.getElementById("themeStatus");if(a){const e=h();a.textContent="auto"===Dt?e.isDarkMode?"🌙 Auto (Dark)":"☀️ Auto (Light)":"light"===Dt?"☀️ Light Mode":"🌙 Dark Mode"}}()}(t);try{localStorage.setItem("theme-preference",e)}catch(e){}Lt(`🎨 Theme set to: ${e} (rendering: ${t?"dark":"light"})`)}function Wt(){console.log("⚠️ localStorage is disabled")}function Gt(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(Wt,500)}let Kt=null;const Ht="panel_control_visibility";let zt={};function Xt(){try{localStorage.setItem(Ht,JSON.stringify(zt))}catch(e){}}function Yt(e){return!1!==zt[e]}!function(){try{const e=localStorage.getItem(Ht);e&&(zt=JSON.parse(e))}catch(e){zt={}}}();const Ut={balls:{title:"Balls",icon:"🎱",defaultOpen:!1,controls:[{id:"sizeGlobal",label:"Size",stateKey:"sizeScale",type:"range",min:.1,max:6,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat,onChange:(e,t)=>{Promise.resolve().then(function(){return v}).then(({updateBallSizes:t})=>{t();const n=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=n,e.rBase=n})}),Promise.resolve().then(function(){return Zn}).then(({updateCursorSize:e})=>{e()})}},{id:"responsiveScaleMobile",label:"Mobile Scale",stateKey:"responsiveScaleMobile",type:"range",min:.5,max:1.5,step:.05,default:.75,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Ball size multiplier for iPad/iPhone (requires reload)",onChange:(e,t)=>{Promise.resolve().then(function(){return v}).then(({detectResponsiveScale:t})=>{t();const n=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=n,e.rBase=n})})}},{id:"ballSoftnessGlobal",label:"Softness",stateKey:"ballSoftness",type:"range",min:0,max:100,step:1,default:20,format:e=>String(e),parse:e=>parseInt(e,10)},{id:"ballSpacing",label:"Spacing",stateKey:"ballSpacing",type:"range",min:0,max:10,step:.5,default:2.5,format:e=>e.toFixed(1)+"px",parse:parseFloat}]},cursor:{title:"Cursor",icon:"👆",defaultOpen:!1,controls:[{id:"cursorSize",label:"Size",stateKey:"cursorSize",type:"range",min:.1,max:3,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,onChange:(e,t)=>{Promise.resolve().then(function(){return Zn}).then(({updateCursorSize:e})=>{e()})}}]},trail:{title:"Trail",icon:"✨",defaultOpen:!1,controls:[{id:"mouseTrailEnabled",label:"Enabled",stateKey:"mouseTrailEnabled",type:"checkbox",default:!0},{id:"mouseTrailLength",label:"Length",stateKey:"mouseTrailLength",type:"range",min:4,max:96,step:1,default:18,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),hint:"Max samples kept (higher = smoother, slightly more work)"},{id:"mouseTrailSize",label:"Size",stateKey:"mouseTrailSize",type:"range",min:.5,max:10,step:.1,default:1.3,format:e=>e.toFixed(1)+"px",parse:parseFloat},{id:"mouseTrailFadeMs",label:"Fade",stateKey:"mouseTrailFadeMs",type:"range",min:40,max:1200,step:10,default:220,format:e=>`${Math.round(e)}ms`,parse:e=>parseInt(e,10)},{id:"mouseTrailOpacity",label:"Opacity",stateKey:"mouseTrailOpacity",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat}]},frame:{title:"Frame",icon:"🖼️",defaultOpen:!1,controls:[{id:"frameColor",label:"Color",stateKey:"frameColor",type:"color",default:"#0a0a0a",onChange:(e,t)=>{const n=document.documentElement;n.style.setProperty("--frame-color-light",t),n.style.setProperty("--frame-color-dark",t),n.style.setProperty("--wall-color",t),n.style.setProperty("--chrome-bg",t),n.style.setProperty("--chrome-bg-light",t),n.style.setProperty("--chrome-bg-dark",t);const a=document.querySelector('meta[name="theme-color"]');a&&(a.content=t)}}]},shadow:{title:"Inner Shadow",icon:"🌑",defaultOpen:!1,controls:[{id:"containerInnerShadowOpacity",label:"Strength",stateKey:"containerInnerShadowOpacity",type:"range",min:0,max:.4,step:.01,default:.12,format:e=>e.toFixed(2),parse:parseFloat,cssVar:"--container-inner-shadow-opacity"},{id:"containerInnerShadowBlur",label:"Blur",stateKey:"containerInnerShadowBlur",type:"range",min:0,max:250,step:5,default:80,format:e=>`${Math.round(e)}px`,parse:e=>parseInt(e,10),cssVar:"--container-inner-shadow-blur"},{id:"containerInnerShadowSpread",label:"Spread",stateKey:"containerInnerShadowSpread",type:"range",min:-50,max:50,step:1,default:-10,format:e=>`${Math.round(e)}px`,parse:e=>parseInt(e,10),cssVar:"--container-inner-shadow-spread"},{id:"containerInnerShadowOffsetY",label:"Offset Y",stateKey:"containerInnerShadowOffsetY",type:"range",min:-60,max:60,step:1,default:0,format:e=>`${Math.round(e)}px`,parse:e=>parseInt(e,10),cssVar:"--container-inner-shadow-offset-y"}]},wobble:{title:"Wall Wobble",icon:"〰️",defaultOpen:!1,controls:[{id:"wallWobbleMaxDeform",label:"Strength",stateKey:"wallWobbleMaxDeform",type:"range",min:0,max:150,step:1,default:148,format:e=>`${e}px`,parse:e=>parseInt(e,10)},{id:"wallWobbleStiffness",label:"Return Speed",stateKey:"wallWobbleStiffness",type:"range",min:50,max:3e3,step:10,default:1300,format:e=>String(e),parse:e=>parseInt(e,10)},{id:"wallWobbleDamping",label:"Damping",stateKey:"wallWobbleDamping",type:"range",min:0,max:80,step:1,default:34,format:e=>String(e),parse:e=>parseInt(e,10)},{id:"wallWobbleSigma",label:"Impact Spread",stateKey:"wallWobbleSigma",type:"range",min:.5,max:4,step:.1,default:4,format:e=>e.toFixed(1),parse:parseFloat},{id:"wallWobbleCornerClamp",label:"Corner Stickiness",stateKey:"wallWobbleCornerClamp",type:"range",min:0,max:1,step:.01,default:1,format:e=>e.toFixed(2),parse:parseFloat}]},noise:{title:"Noise",icon:"📺",defaultOpen:!1,controls:[{id:"noiseSizeBase",label:"Back Size",stateKey:"noiseSizeBase",type:"range",min:50,max:200,step:5,default:100,format:e=>String(e),parse:e=>parseInt(e,10),cssVar:"--noise-size-base"},{id:"noiseSizeTop",label:"Front Size",stateKey:"noiseSizeTop",type:"range",min:40,max:150,step:5,default:80,format:e=>String(e),parse:e=>parseInt(e,10),cssVar:"--noise-size-top"},{id:"noiseBackOpacity",label:"Back Opacity (Light)",stateKey:"noiseBackOpacity",type:"range",min:0,max:.15,step:.001,default:.02,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-back-opacity"},{id:"noiseFrontOpacity",label:"Front Opacity (Light)",stateKey:"noiseFrontOpacity",type:"range",min:0,max:.15,step:.001,default:.05,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-front-opacity"},{id:"noiseBackOpacityDark",label:"Back Opacity (Dark)",stateKey:"noiseBackOpacityDark",type:"range",min:0,max:.15,step:.001,default:.06,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-back-opacity-dark"},{id:"noiseFrontOpacityDark",label:"Front Opacity (Dark)",stateKey:"noiseFrontOpacityDark",type:"range",min:0,max:.15,step:.001,default:.04,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-front-opacity-dark"}]},critters:{title:"Critters",icon:"🪲",mode:"critters",defaultOpen:!1,controls:[{id:"critterCount",label:"Count",stateKey:"critterCount",type:"range",min:10,max:260,step:5,default:90,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"critterSpeed",label:"Speed",stateKey:"critterSpeed",type:"range",min:0,max:1800,step:10,default:680,format:e=>`${Math.round(e)}`,parse:parseFloat},{id:"critterMaxSpeed",label:"Max Speed",stateKey:"critterMaxSpeed",type:"range",min:200,max:4e3,step:25,default:1400,format:e=>`${Math.round(e)}`,parse:parseFloat},{id:"critterStepHz",label:"Step Rate",stateKey:"critterStepHz",type:"range",min:0,max:16,step:.1,default:5,format:e=>e.toFixed(1)+" Hz",parse:parseFloat},{id:"critterStepSharpness",label:"Step Sharpness",stateKey:"critterStepSharpness",type:"range",min:.5,max:6,step:.1,default:2.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnNoise",label:"Wander",stateKey:"critterTurnNoise",type:"range",min:0,max:8,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnDamp",label:"Turn Inertia",stateKey:"critterTurnDamp",type:"range",min:.5,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnSeek",label:"Steering",stateKey:"critterTurnSeek",type:"range",min:0,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterAvoidRadius",label:"Avoid Radius",stateKey:"critterAvoidRadius",type:"range",min:0,max:260,step:5,default:90,format:e=>`${Math.round(e)}px`,parse:parseFloat},{id:"critterAvoidForce",label:"Avoid Force",stateKey:"critterAvoidForce",type:"range",min:0,max:25e3,step:250,default:9500,format:e=>String(Math.round(e)),parse:parseFloat},{id:"critterEdgeAvoid",label:"Edge Avoid",stateKey:"critterEdgeAvoid",type:"range",min:0,max:3,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat},{id:"critterMousePull",label:"Mouse Fear",stateKey:"critterMousePull",type:"range",min:0,max:4,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Flee strength inside the mouse zone"},{id:"critterMouseRadiusVw",label:"Mouse Zone",stateKey:"critterMouseRadiusVw",type:"range",min:0,max:80,step:1,default:30,format:e=>`${Math.round(e)}vw`,parse:parseFloat},{id:"critterRestitution",label:"Bounciness",stateKey:"critterRestitution",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat,hint:"Mode-only override",onChange:(e,t)=>{"critters"===e.currentMode&&(e.REST=t)}},{id:"critterFriction",label:"Friction",stateKey:"critterFriction",type:"range",min:0,max:.06,step:.001,default:.018,format:e=>e.toFixed(3),parse:parseFloat,hint:"Mode-only override",onChange:(e,t)=>{"critters"===e.currentMode&&(e.FRICTION=t)}}]},pit:{title:"Ball Pit",icon:"🎯",mode:"pit",defaultOpen:!1,controls:[{id:"gravityPit",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange:(e,t)=>{"pit"===e.currentMode&&(e.G=e.GE*t)}},{id:"weightPit",label:"Weight",stateKey:"ballMassKg",type:"range",min:10,max:200,step:1,default:129,format:e=>e.toFixed(0),parse:parseFloat,onChange:(e,t)=>{e.balls.forEach(e=>{e.m=t})}},{id:"restitution",label:"Bounciness",stateKey:"REST",type:"range",min:0,max:1,step:.01,default:.69,format:e=>e.toFixed(2),parse:parseFloat},{id:"friction",label:"Air Friction",stateKey:"FRICTION",type:"range",min:0,max:.01,step:5e-4,default:.006,format:e=>e.toFixed(4),parse:parseFloat},{id:"repelSize",label:"Repel Size",stateKey:"repelRadius",type:"range",min:50,max:1e3,step:5,default:120,format:e=>e.toFixed(0),parse:parseFloat},{id:"repelPower",label:"Repel Power",stateKey:"repelPower",type:"range",min:0,max:1e4,step:100,default:8500,format:e=>Math.round(e).toString(),parse:parseFloat,onChange:(e,t)=>{const n=Math.max(0,Math.min(1e4,t))/1e4;e.repelPower=12e3*Math.pow(2,12*(n-.5))*2}}]},pitThrows:{title:"Ball Pit (Throws)",icon:"🎯",mode:"pit-throws",defaultOpen:!1,controls:[{id:"gravityPitThrows",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange:(e,t)=>{"pit-throws"===e.currentMode&&(e.G=e.GE*t)}},{id:"pitThrowsSpeed",label:"Throw Speed",stateKey:"pitThrowSpeed",type:"range",min:100,max:2e3,step:25,default:650,format:e=>String(Math.round(e)),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpeedVar",label:"Speed Variance",stateKey:"pitThrowSpeedVar",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsInterval",label:"Throw Interval",stateKey:"pitThrowIntervalMs",type:"range",min:10,max:500,step:5,default:70,format:e=>`${Math.round(e)}ms`,parse:parseFloat},{id:"pitThrowsColorPause",label:"Color Pause",stateKey:"pitThrowColorPauseMs",type:"range",min:0,max:1200,step:10,default:180,format:e=>`${Math.round(e)}ms`,parse:parseFloat},{id:"pitThrowsPairChance",label:"Pair Chance",stateKey:"pitThrowPairChance",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsPairStagger",label:"Pair Stagger",stateKey:"pitThrowPairStaggerMs",type:"range",min:0,max:120,step:1,default:18,format:e=>`${Math.round(e)}ms`,parse:parseFloat},{id:"pitThrowsBatchSize",label:"Batch Size",stateKey:"pitThrowBatchSize",type:"range",min:1,max:60,step:1,default:18,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"pitThrowsTargetYFrac",label:"Throw Aim (Y)",stateKey:"pitThrowTargetYFrac",type:"range",min:.12,max:.7,step:.01,default:.36,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAngleJitter",label:"Angle Jitter",stateKey:"pitThrowAngleJitter",type:"range",min:0,max:.6,step:.01,default:.16,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpreadVar",label:"Spread Variance",stateKey:"pitThrowSpreadVar",type:"range",min:0,max:.8,step:.01,default:.25,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsSpeedJitter",label:"Speed Jitter",stateKey:"pitThrowSpeedJitter",type:"range",min:0,max:.8,step:.01,default:.22,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsInletInset",label:"Inlet Inset",stateKey:"pitThrowInletInset",type:"range",min:0,max:.2,step:.005,default:.06,format:e=>e.toFixed(3),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpawnSpread",label:"Spawn Spread",stateKey:"pitThrowSpawnSpread",type:"range",min:0,max:.12,step:.0025,default:.02,format:e=>e.toFixed(4),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAimJitter",label:"Aim Jitter",stateKey:"pitThrowAimJitter",type:"range",min:0,max:.2,step:.005,default:.04,format:e=>e.toFixed(3),parse:parseFloat},{id:"pitThrowsCrossBias",label:"Cross Aim",stateKey:"pitThrowCrossBias",type:"range",min:0,max:.3,step:.005,default:.12,format:e=>e.toFixed(3),parse:parseFloat}]},flies:{title:"Flies",icon:"🕊️",mode:"flies",defaultOpen:!1,controls:[{id:"fliesBallCount",label:"Ball Count",stateKey:"fliesBallCount",type:"range",min:20,max:150,step:5,default:60,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"attractPower",label:"Attraction",stateKey:"attractionPower",type:"range",min:100,max:8e3,step:50,default:5e3,format:e=>Math.round(e).toString(),parse:parseFloat},{id:"swarmSpeed",label:"Swarm Speed",stateKey:"swarmSpeed",type:"range",min:.2,max:5,step:.1,default:.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"fliesSeparation",label:"Separation",stateKey:"fliesSeparation",type:"range",min:5e3,max:3e4,step:1e3,default:15e3,format:e=>Math.round(e).toString(),parse:parseFloat}]},weightless:{title:"Zero-G",icon:"🌌",mode:"weightless",defaultOpen:!1,controls:[{id:"weightlessCount",label:"Ball Count",stateKey:"weightlessCount",type:"range",min:20,max:200,step:10,default:80,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"weightlessSpeed",label:"Initial Speed",stateKey:"weightlessInitialSpeed",type:"range",min:100,max:600,step:25,default:250,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"weightlessBounce",label:"Bounce",stateKey:"weightlessBounce",type:"range",min:.5,max:1,step:.05,default:.95,format:e=>e.toFixed(2),parse:parseFloat},{id:"weightlessRepelRadius",label:"Cursor Blast Radius",stateKey:"weightlessRepelRadius",type:"range",min:50,max:450,step:10,default:220,format:e=>`${Math.round(e)}px`,parse:e=>parseInt(e,10)},{id:"weightlessRepelPower",label:"Cursor Blast Power",stateKey:"weightlessRepelPower",type:"range",min:0,max:6e5,step:1e4,default:22e4,format:e=>Math.round(e).toString(),parse:parseFloat},{id:"weightlessRepelSoft",label:"Cursor Blast Falloff",stateKey:"weightlessRepelSoft",type:"range",min:.5,max:6,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat}]},water:{title:"Water",icon:"🌊",mode:"water",defaultOpen:!1,controls:[{id:"waterBallCount",label:"Ball Count",stateKey:"waterBallCount",type:"range",min:50,max:400,step:10,default:300,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"waterRippleStrength",label:"Ripple Strength",stateKey:"waterRippleStrength",type:"range",min:5e3,max:3e4,step:1e3,default:18e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"waterMotion",label:"Motion",stateKey:"waterDriftStrength",type:"range",min:0,max:80,step:1,default:40,format:e=>e.toFixed(0),parse:parseFloat,onChange:(e,t)=>{e.waterInitialVelocity=5*t},reinitMode:!0}]},vortex:{title:"Vortex",icon:"🌀",mode:"vortex",defaultOpen:!1,controls:[{id:"vortexBallCount",label:"Ball Count",stateKey:"vortexBallCount",type:"range",min:50,max:300,step:10,default:180,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"vortexSwirl",label:"Swirl Strength",stateKey:"vortexSwirlStrength",type:"range",min:100,max:800,step:20,default:420,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexPull",label:"Radial Pull",stateKey:"vortexRadialPull",type:"range",min:0,max:400,step:10,default:180,format:e=>e.toFixed(0),parse:parseFloat}]},"ping-pong":{title:"Ping Pong",icon:"🏓",mode:"ping-pong",defaultOpen:!1,controls:[{id:"pingPongBallCount",label:"Ball Count",stateKey:"pingPongBallCount",type:"range",min:10,max:100,step:5,default:35,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"pingPongSpeed",label:"Ball Speed",stateKey:"pingPongSpeed",type:"range",min:200,max:1200,step:50,default:800,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"pingPongCursor",label:"Cursor Size",stateKey:"pingPongCursorRadius",type:"range",min:20,max:200,step:10,default:50,format:e=>e.toFixed(0),parse:parseFloat}]},magnetic:{title:"Magnetic",icon:"🧲",mode:"magnetic",defaultOpen:!1,controls:[{id:"magneticBallCount",label:"Ball Count",stateKey:"magneticBallCount",type:"range",min:50,max:300,step:10,default:180,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"magneticStrength",label:"Strength",stateKey:"magneticStrength",type:"range",min:1e4,max:1e5,step:5e3,default:65e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticVelocity",label:"Max Velocity",stateKey:"magneticMaxVelocity",type:"range",min:500,max:4e3,step:100,default:2800,format:e=>e.toFixed(0),parse:parseFloat}]},bubbles:{title:"Bubbles",icon:"🫧",mode:"bubbles",defaultOpen:!1,controls:[{id:"bubblesRate",label:"Bubble Rate",stateKey:"bubblesSpawnRate",type:"range",min:1,max:20,step:1,default:8,format:e=>String(e),parse:e=>parseInt(e,10)},{id:"bubblesSpeed",label:"Rise Speed",stateKey:"bubblesRiseSpeed",type:"range",min:50,max:400,step:25,default:150,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesWobble",label:"Wobble",stateKey:"bubblesWobble",type:"range",min:0,max:100,step:5,default:40,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesMax",label:"Max Bubbles",stateKey:"bubblesMaxCount",type:"range",min:50,max:300,step:10,default:150,format:e=>String(e),parse:e=>parseInt(e,10)},{id:"bubblesDeflect",label:"Cursor Deflection",stateKey:"bubblesDeflectRadius",type:"range",min:20,max:150,step:10,default:80,format:e=>e.toFixed(0),parse:parseFloat}]},tilt:{title:"Tilt",icon:"⚖️",mode:"tilt",defaultOpen:!1,controls:[{id:"tiltBallCount",label:"Particle Count",stateKey:"tiltBallCount",type:"range",min:100,max:500,step:10,default:300,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"tiltMaxAngle",label:"Max Angle",stateKey:"tiltMaxAngle",type:"range",min:.5,max:10,step:.5,default:2,format:e=>e.toFixed(1)+"°",parse:parseFloat},{id:"tiltLerpSpeed",label:"Smoothness",stateKey:"tiltLerpSpeed",type:"range",min:.01,max:.5,step:.01,default:.08,format:e=>e.toFixed(2),parse:parseFloat},{id:"tiltGlassMass",label:"Particle Mass",stateKey:"tiltGlassBallMass",type:"range",min:.02,max:.3,step:.01,default:.08,format:e=>e.toFixed(2)+"x",parse:parseFloat,reinitMode:!0},{id:"tiltFriction",label:"Friction",stateKey:"tiltFriction",type:"range",min:.002,max:.02,step:.001,default:.008,format:e=>e.toFixed(3),parse:parseFloat}]},kaleidoscope:{title:"Kaleidoscope",icon:"🪞",mode:"kaleidoscope",defaultOpen:!1,controls:[{id:"kaleiBallCount",label:"Ball Count",stateKey:"kaleidoscopeBallCount",type:"range",min:10,max:200,step:1,default:23,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"kaleiSegments",label:"Wedges",stateKey:"kaleidoscopeSegments",type:"range",min:3,max:24,step:1,default:12,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10)},{id:"kaleiMirror",label:"Mirror",stateKey:"kaleidoscopeMirror",type:"range",min:0,max:1,step:1,default:1,format:e=>e?"On":"Off",parse:e=>parseInt(e,10)},{id:"kaleiSpacing",label:"Spacing",stateKey:"kaleidoscopeBallSpacing",type:"range",min:0,max:20,step:.5,default:9,format:e=>e.toFixed(1)+"px",parse:parseFloat,onChange:(e,t)=>{if("kaleidoscope"===e.currentMode){const n=e.canvas,a=n?Math.max(.35,Math.min(3,Math.min(n.width,n.height)/1e3)):1;e.ballSpacing=t*a}}},{id:"kaleiSwirl",label:"Swirl",stateKey:"kaleidoscopeSwirlStrength",type:"range",min:0,max:800,step:5,default:52,format:e=>String(Math.round(e)),parse:parseFloat},{id:"kaleiPull",label:"Pull",stateKey:"kaleidoscopeRadialPull",type:"range",min:0,max:800,step:10,default:260,format:e=>String(Math.round(e)),parse:parseFloat},{id:"kaleiRotFollow",label:"Rotation Follow",stateKey:"kaleidoscopeRotationFollow",type:"range",min:0,max:3,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat},{id:"kaleiPan",label:"Pan",stateKey:"kaleidoscopePanStrength",type:"range",min:0,max:2,step:.05,default:.75,format:e=>e.toFixed(2),parse:parseFloat},{id:"kaleiEase",label:"Easing",stateKey:"kaleidoscopeEase",type:"range",min:0,max:1,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},{id:"kaleiWander",label:"Organic",stateKey:"kaleidoscopeWander",type:"range",min:0,max:1,step:.01,default:.25,format:e=>e.toFixed(2),parse:parseFloat},{id:"kaleiMaxSpeed",label:"Speed Clamp",stateKey:"kaleidoscopeMaxSpeed",type:"range",min:300,max:8e3,step:100,default:2600,format:e=>String(Math.round(e)),parse:parseFloat}]}};function jt(){const e=[];for(const t of Object.values(Ut))for(const n of t.controls)e.push({...n,section:t.title});return e}function Qt(e){if(!Yt(e.id))return"";const t=e.id+"Slider",n=e.id+"Val",a=e.id+"Picker";if("color"===e.type)return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${n}">${e.default}</span>\n        </div>\n        <input type="color" id="${a}" value="${e.default}" aria-label="${e.label}" />\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`;if("checkbox"===e.type){const a=e.default?"checked":"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${n}">${e.default?"On":"Off"}</span>\n        </div>\n        <input type="checkbox" id="${t}" ${a} aria-label="${e.label}">\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`}const o=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${n}">${e.format(e.default)}</span>\n        </div>\n        <input type="range" id="${t}" min="${e.min}" max="${e.max}" step="${e.step}" value="${e.default}">\n      </label>\n      ${o}`}function Jt(e,t){const n=t.controls.filter(e=>Yt(e.id));if(0===n.length)return"";let a=null,o="";for(const e of n)e.group&&e.group!==a?(null!==a&&(o+="</div>"),o+=`<div class="section-title" style="margin-top: 12px;">${e.group}</div><div class="group">`,a=e.group):e.group||null===a||(o+="</div>",a=null),o+=Qt(e);null!==a&&(o+="</div>");const i=t.defaultOpen?"open":"",s=`\n    <summary class="panel-section-header">\n      ${t.icon?`<span class="section-icon">${t.icon}</span>`:""}\n      <span class="section-label">${t.title}</span>\n    </summary>`,r=`<div class="panel-section-content">${o}</div>`;return t.mode?`\n      <div id="${t.mode}Controls" class="mode-controls">\n        <details class="panel-section-accordion" ${i}>\n          ${s}\n          ${r}\n        </details>\n      </div>`:`\n    <details class="panel-section-accordion" ${i}>\n      ${s}\n      ${r}\n    </details>`}function Zt(){let e='\n    \x3c!-- Screen reader announcements --\x3e\n    <div role="status" aria-live="polite" aria-atomic="true" class="sr-only" id="announcer"></div>\n\n    \x3c!-- Theme --\x3e\n    <details class="panel-section-accordion" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎨</span>\n        <span class="section-label">Theme</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="theme-segment-control" role="group" aria-label="Theme selector">\n          <button id="themeAuto" class="theme-segment-btn" aria-label="Auto theme">Auto</button>\n          <button id="themeLight" class="theme-segment-btn active" aria-label="Light theme">Light</button>\n          <button id="themeDark" class="theme-segment-btn" aria-label="Dark theme">Dark</button>\n        </div>\n        <div id="themeStatus" class="panel-status">☀️ Light Mode</div>\n      </div>\n    </details>\n\n    \x3c!-- Mode --\x3e\n    <details class="panel-section-accordion" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎛️</span>\n        <span class="section-label">Mode</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="mode-switcher" role="group" aria-label="Simulation mode selector">\n          <button class="mode-button active" data-mode="critters" aria-label="Critters mode">🪲 Critters</button>\n          <button class="mode-button" data-mode="pit" aria-label="Ball Pit mode">🎯 Pit</button>\n          <button class="mode-button" data-mode="pit-throws" aria-label="Ball Pit throws mode">🎯 Throws</button>\n          <button class="mode-button" data-mode="flies" aria-label="Flies mode">🕊️ Flies</button>\n          <button class="mode-button" data-mode="weightless" aria-label="Zero-G mode">🌌 Zero-G</button>\n          <button class="mode-button" data-mode="water" aria-label="Water mode">🌊 Water</button>\n          <button class="mode-button" data-mode="vortex" aria-label="Vortex mode">🌀 Vortex</button>\n          <button class="mode-button" data-mode="ping-pong" aria-label="Ping Pong mode">🏓 Pong</button>\n          <button class="mode-button" data-mode="magnetic" aria-label="Magnetic mode">🧲 Magnet</button>\n          <button class="mode-button" data-mode="bubbles" aria-label="Bubbles mode">🫧 Bubbles</button>\n          <button class="mode-button" data-mode="kaleidoscope" aria-label="Kaleidoscope mode">🪞 Kalei</button>\n        </div>\n      </div>\n    </details>';for(const[t,n]of Object.entries(Ut))n.mode||(e+=Jt(0,n));e+='\n    <details class="panel-section-accordion">\n      <summary class="panel-section-header">\n        <span class="section-icon">🌈</span>\n        <span class="section-label">Colors</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Color Template</span>\n            <span class="control-value"></span>\n          </div>\n          <select id="colorSelect"></select>\n        </label>\n      </div>\n    </details>';for(const[t,n]of Object.entries(Ut))n.mode&&(e+=Jt(0,n));return e+='\n    <div class="panel-section panel-section--action">\n      <button id="saveConfigBtn" class="primary">💾 Save Config</button>\n    </div>\n    <div class="panel-footer">\n      <kbd>R</kbd> reset · <kbd>/</kbd> panel · <kbd>9</kbd> kalei · Critters + Throws have no key (yet)\n    </div>',e}function en(){const e=h();for(const[t,n]of Object.entries(Ut))for(const t of n.controls){const a=t.id+"Val",o=document.getElementById(a);if("color"===t.type){const n=t.id+"Picker",a=document.getElementById(n);if(!a)continue;a.addEventListener("input",()=>{const n=a.value;t.stateKey&&(e[t.stateKey]=n),t.onChange&&t.onChange(e,n),o&&(o.textContent=n),Gt()});continue}if("checkbox"===t.type){const a=t.id+"Slider",i=document.getElementById(a);if(!i)continue;i.addEventListener("change",()=>{const a=!!i.checked;t.stateKey&&(e[t.stateKey]=a),t.onChange&&t.onChange(e,a),o&&(o.textContent=a?"On":"Off"),t.reinitMode&&e.currentMode===n.mode&&import(`../modes/${n.mode}.js`).then(e=>{const t=Object.values(e).find(e=>"function"==typeof e&&e.name.toLowerCase().includes("initialize"));t&&t()}).catch(()=>{}),Gt()});continue}const i=t.id+"Slider",s=document.getElementById(i);s&&s.addEventListener("input",()=>{const a=t.parse(s.value);if(t.stateKey&&(e[t.stateKey]=a),t.onChange&&t.onChange(e,a),o){const n=t.stateKey?e[t.stateKey]:a;o.textContent=t.format(n)}if(t.cssVar&&Kt){const e={};e[t.cssVar.replace("--","").replace(/-([a-z])/g,(e,t)=>t.toUpperCase())]=a,Kt(e)}t.reinitMode&&e.currentMode===n.mode&&(n.mode.replace("-",""),import(`../modes/${n.mode}.js`).then(e=>{const t=Object.values(e).find(e=>"function"==typeof e&&e.name.toLowerCase().includes("initialize"));t&&t()}).catch(()=>{})),Gt()})}}var tn=Object.freeze({__proto__:null,CONTROL_SECTIONS:Ut,bindRegisteredControls:en,generatePanelHTML:Zt,getAllControls:jt,getControlById:function(e){for(const t of Object.values(Ut)){const n=t.controls.find(t=>t.id===e);if(n)return n}return null},getVisibilityState:function(){return{...zt}},isControlVisible:Yt,resetVisibility:function(){zt={},Xt()},setApplyVisualCSSVars:function(e){Kt=e},setControlVisible:function(e,t){zt[e]=t,Xt()},syncSlidersToState:function(){const e=h();for(const t of Object.values(Ut))for(const n of t.controls){const t=n.id+"Slider",a=n.id+"Val",o=document.getElementById(t),i=document.getElementById(a);if(!o||!n.stateKey)continue;const s=e[n.stateKey];void 0!==s&&("checkbox"===n.type?(o.checked=!!s,i&&(i.textContent=s?"On":"Off")):(o.value=s,i&&(i.textContent=n.format(s))))}}});function nn(){en(),document.querySelectorAll(".mode-button").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.getAttribute("data-mode");console.log("Mode button clicked:",n),lt(n),an(n)})}),C();const e=document.getElementById("colorSelect");e&&e.addEventListener("change",()=>{T(e.value),Gt()});const t=document.getElementById("themeAuto"),n=document.getElementById("themeLight"),a=document.getElementById("themeDark");[t,n,a].forEach(e=>{e&&e.addEventListener("click",()=>{[t,n,a].forEach(e=>e?.classList.remove("active")),e.classList.add("active")})})}function an(e){document.querySelectorAll(".mode-button").forEach(t=>{const n=t.getAttribute("data-mode")===e;t.classList.toggle("active",n)}),document.querySelectorAll(".mode-controls").forEach(e=>e.classList.remove("active"));const t=e+"Controls",n=document.getElementById(t);n&&n.classList.add("active");const a=document.getElementById("announcer");if(a){const t={critters:"Critters",pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero-G",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope"};a.textContent=`Switched to ${t[e]||e} mode`}}var on=Object.freeze({__proto__:null,setupControls:nn,updateModeButtonsUI:an});const sn=Zt(),rn={core:{title:"Core",controls:[{id:"masterGain",label:"Master Volume",min:10,max:100,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"collisionMinImpact",label:"Silence Threshold",min:20,max:85,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e}]},envelope:{title:"Envelope",controls:[{id:"decayTime",label:"Click Length",min:20,max:180,step:1,format:e=>`${Math.round(e)}ms`,toConfig:e=>e/1e3,fromConfig:e=>1e3*e}]},tone:{title:"Tone",controls:[{id:"filterBaseFreq",label:"Brightness",min:300,max:6e3,step:50,format:e=>`${Math.round(e)}Hz`,toConfig:e=>e,fromConfig:e=>e},{id:"harmonicGain",label:"Warmth",min:0,max:50,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"filterQ",label:"Resonance",min:10,max:200,step:5,format:e=>`${(e/100).toFixed(2)}`,toConfig:e=>e/100,fromConfig:e=>100*e}]},crystal:{title:"Crystal",controls:[{id:"pitchMinHz",label:"Pitch Low",min:80,max:1200,step:10,format:e=>`${Math.round(e)}Hz`,toConfig:e=>e,fromConfig:e=>e},{id:"pitchMaxHz",label:"Pitch High",min:200,max:4e3,step:20,format:e=>`${Math.round(e)}Hz`,toConfig:e=>e,fromConfig:e=>e},{id:"pitchCurve",label:"Pitch Curve",min:70,max:160,step:1,format:e=>`${(e/100).toFixed(2)}×`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleGain",label:"Sparkle",min:0,max:35,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMin",label:"Sparkle Min",min:120,max:600,step:10,format:e=>`${(e/100).toFixed(2)}×`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMax",label:"Sparkle Max",min:160,max:800,step:10,format:e=>`${(e/100).toFixed(2)}×`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleDecayMul",label:"Sparkle Decay",min:20,max:95,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"noiseTransientQ",label:"Sparkle Q",min:60,max:600,step:5,format:e=>`${(e/100).toFixed(2)}`,toConfig:e=>e/100,fromConfig:e=>100*e}]},space:{title:"Space",controls:[{id:"reverbWetMix",label:"Reverb Mix",min:0,max:50,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"reverbDecay",label:"Room Size",min:5,max:80,step:1,format:e=>`${(e/100).toFixed(2)}s`,toConfig:e=>e/100,fromConfig:e=>100*e}]},dynamics:{title:"Dynamics",controls:[{id:"minGain",label:"Min Hit Volume",min:0,max:20,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"maxGain",label:"Max Hit Volume",min:5,max:50,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e}]},realism:{title:"Realism",controls:[{id:"noiseTransientGain",label:"Impact Snap",min:0,max:80,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"varianceGain",label:"Volume Variance",min:0,max:50,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"variancePitch",label:"Pitch Variance",min:0,max:25,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"velocityNoiseScale",label:"Hard Hit Crack",min:100,max:500,step:10,format:e=>`${(e/100).toFixed(1)}×`,toConfig:e=>e/100,fromConfig:e=>100*e}]}};function ln(e,t){const n=t();for(const t of Object.values(rn))for(const a of t.controls){const t=e.querySelector(`#sound_${a.id}`),o=e.querySelector(`#sound_${a.id}_val`);if(!t||void 0===n[a.id])continue;const i=a.fromConfig(n[a.id]);t.value=i,o&&(o.textContent=a.format(i))}}let cn=null,dn=null;const un="panel_dock_position_v2",pn="master_panel_collapsed",hn="panel_dock_size";function mn(e){try{localStorage.setItem("panel_dock_hidden",String(e))}catch(e){}}let fn=!1,gn=0,yn=0,bn=0,vn=0;function Mn(){try{const e=document.getElementById("controlPanel");e&&e.remove();const t=document.getElementById("soundPanel");t&&t.remove()}catch(e){}return cn=document.createElement("div"),cn.className="panel-dock",cn.id="panelDock",cn.classList.add("hidden"),mn(!0),dn=function(){const e=document.createElement("div");e.id="masterPanel",e.className=function(){try{const e=localStorage.getItem(pn);return null===e||"true"===e}catch(e){return!0}}()?"panel collapsed":"panel",e.setAttribute("role","region"),e.setAttribute("aria-label","Settings");const t=document.createElement("div");t.className="panel-header";const n=Rt()?"DEV MODE":"BUILD MODE";t.innerHTML=`\n    <div class="mac-titlebar">\n      <div class="mac-traffic" aria-hidden="true">\n        <span class="mac-dot mac-dot--red"></span>\n        <span class="mac-dot mac-dot--yellow"></span>\n        <span class="mac-dot mac-dot--green"></span>\n      </div>\n      <div class="panel-title mac-title">Settings</div>\n      <div class="mac-right">\n        <span class="panel-mode-pill" role="status" aria-label="Runtime mode">${n}</span>\n        <button class="collapse-btn mac-collapse" aria-label="Collapse panel" title="Collapse">▾</button>\n      </div>\n    </div>\n  `;const a=document.createElement("div");a.className="panel-content",a.innerHTML=function(){const e=h(),t=Number(e.containerBorderVw||0),n=Number(e.wallRadiusVw||0),a=Number(e.contentPaddingVw||0),o=r(),i=e.layoutViewportWidthPx>0?`${Math.round(e.layoutViewportWidthPx)}px`:`Auto (${Math.round(o)}px)`,s=Math.max(0,Math.round(e.containerBorder??0)),l=Math.max(0,Math.round(e.wallRadius??e.cornerRadius??0)),c=Math.max(0,Math.round(e.contentPadding??0)),d=Math.max(0,Math.round(e.wallInset??3));return`\n    \x3c!-- ═══════════════════════════════════════════════════════════════════════\n         LAYOUT SECTION - Frame & Content Spacing\n         ═══════════════════════════════════════════════════════════════════════ --\x3e\n    <details class="panel-section-accordion" id="layoutSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">📐</span>\n        <span class="section-label">Layout</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Frame</span>\n            <span class="control-value" id="frameValue">${t.toFixed(2)}vw · ${s}px</span>\n          </div>\n          <input type="range" id="layoutFrame" min="0" max="8" step="0.05" value="${t||0}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Content Padding</span>\n            <span class="control-value" id="contentPadValue">${a.toFixed(2)}vw · ${c}px</span>\n          </div>\n          <input type="range" id="contentPadding" min="0" max="12" step="0.05" value="${a||0}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Radius</span>\n            <span class="control-value" id="radiusValue">${n.toFixed(2)}vw · ${l}px</span>\n          </div>\n          <input type="range" id="layoutRadius" min="0" max="20" step="0.05" value="${n||0}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Viewport Width</span>\n            <span class="control-value" id="viewportWidthValue">${i}</span>\n          </div>\n          <input type="range" id="layoutViewportWidth" min="0" max="2400" step="10" value="${Math.round(e.layoutViewportWidthPx||0)}" />\n          <div class="control-hint">0 = Auto (uses current window width)</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Wall Inset</span>\n            <span class="control-value" id="wallInsetValue">${d}px</span>\n          </div>\n          <input type="range" id="layoutWallInset" min="0" max="20" value="${d}" />\n        </label>\n      </div>\n    </details>\n\n    \x3c!-- ═══════════════════════════════════════════════════════════════════════\n         SOUND SECTION\n         ═══════════════════════════════════════════════════════════════════════ --\x3e\n    <details class="panel-section-accordion" id="soundSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">🔊</span>\n        <span class="section-label">Sound</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="sound-enable-row">\n          <button id="soundEnableBtn" class="sound-enable-btn" aria-label="Enable sound" title="Enable sound">🔇</button>\n        </div>\n        <div id="soundControlsWrapper" class="sound-controls" style="display: none;">\n          <div class="sound-perf" aria-label="Sound performance controls">\n            <button type="button" id="soundTapBtn" class="sound-perf__btn" aria-label="Play test hit">▶︎</button>\n            <button type="button" id="soundResetBtn" class="sound-perf__btn" aria-label="Reset to preset">↺</button>\n            <button type="button" id="soundShuffleBtn" class="sound-perf__btn" aria-label="Shuffle (subtle) sound">🎲</button>\n            <span class="sound-perf__hint">wheel adjusts · shift/alt = fine</span>\n          </div>\n          <label class="control-row">\n            <span class="control-label">Preset</span>\n            <select id="soundPresetSelect" class="control-select"></select>\n          </label>\n          <p id="presetDescription" class="control-hint"></p>\n          ${function(){let e="";for(const[t,n]of Object.entries(rn)){e+='<div class="sound-dock__section">',e+=`<div class="sound-dock__section-title">${n.title}</div>`,e+='<div class="sound-dock__group">';for(const t of n.controls)e+=`\n        <label class="sound-dock__row">\n          <span class="sound-dock__label">${t.label}</span>\n          <input type="range" \n            id="sound_${t.id}" \n            class="sound-dock__slider" \n            min="${t.min}" \n            max="${t.max}" \n            step="${t.step}">\n          <span class="sound-dock__val" id="sound_${t.id}_val">${t.format(t.fromConfig(0))}</span>\n        </label>`;e+="</div></div>"}return e}()}\n        </div>\n      </div>\n    </details>\n\n    \x3c!-- ═══════════════════════════════════════════════════════════════════════\n         CONTROLS SECTION - Theme & Mode\n         ═══════════════════════════════════════════════════════════════════════ --\x3e\n    <details class="panel-section-accordion" id="controlsSection" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">⚙️</span>\n        <span class="section-label">Controls</span>\n      </summary>\n      <div class="panel-section-content">\n        ${sn}\n      </div>\n    </details>\n  `}(),e.appendChild(t),e.appendChild(a);const o=function(){try{const e=localStorage.getItem(hn);if(!e)return null;const t=JSON.parse(e);if(!t||"object"!=typeof t)return null;const n=Number(t.width),a=Number(t.height);return Number.isFinite(n)&&Number.isFinite(a)?{width:Math.round(n),height:Math.round(a)}:null}catch(e){return null}}();o&&(e.style.width=`${o.width}px`,e.style.height=`${o.height}px`,e.style.maxHeight="none");const i=t.querySelector(".collapse-btn");return i&&i.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),function(e){e.classList.toggle("collapsed"),function(e){try{localStorage.setItem(pn,String(e))}catch(e){}}(e.classList.contains("collapsed"))}(e)}),setTimeout(()=>{nn(),function(){const e=document.getElementById("saveConfigBtn");e&&e.addEventListener("click",()=>{const e=h(),t={};try{const n=jt();for(const a of n){if(!a||!a.stateKey)continue;const n=e[a.stateKey];void 0!==n&&(t[a.stateKey]=n)}}catch(e){}t.gravityMultiplier=e.gravityMultiplierPit,t.restitution=e.REST,t.friction=e.FRICTION,t.ballMass=e.ballMassKg,t.ballScale=e.sizeScale,t.sizeScale=e.sizeScale,t.sizeVariation=e.sizeVariation,t.repelSoft=e.repelSoft,t.repelSoftness=e.repelSoft,t.layoutViewportWidthPx=e.layoutViewportWidthPx||0,t.containerBorderVw=e.containerBorderVw,t.simulationPaddingVw=e.simulationPaddingVw,t.contentPaddingVw=e.contentPaddingVw,t.wallRadiusVw=e.wallRadiusVw,t.wallThicknessVw=e.wallThicknessVw,t.wallInset=e.wallInset;try{t.soundPreset=ce(),t.soundConfig=se()}catch(e){}t.cursorColorIndex=5,t.enableLOD=!1;const n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(n),a.download="default-config.json",document.body.appendChild(a),a.click(),document.body.removeChild(a)})}(),function(e){const t=e.querySelector("#soundEnableBtn"),n=e.querySelector("#soundControlsWrapper"),a=e.querySelector("#soundPresetSelect"),o=e.querySelector("#presetDescription"),i=e.querySelector("#soundSection"),s=e.querySelector("#soundTapBtn"),r=e.querySelector("#soundResetBtn"),l=e.querySelector("#soundShuffleBtn"),c=(e,t,n)=>e<t?t:e>n?n:e,d=(e,t)=>e+2*(Math.random()-.5)*t,u=(e,{openIfEnabled:a=!1}={})=>{if(!t)return;const o=e||ie(),s=!(!o.isUnlocked||!o.isEnabled),r=!!o.isUnlocked;t.innerHTML=r&&s?'<i class="ti ti-volume-2" aria-hidden="true"></i>':'<i class="ti ti-volume-off" aria-hidden="true"></i>',t.setAttribute("aria-label",r?s?"Sound on":"Sound off":"Enable sound"),t.title=r?s?"Sound on":"Sound off":"Enable sound",t.classList.toggle("enabled",s),n&&(n.style.display=s?"":"none"),a&&s&&i&&!i.open&&(i.open=!0)};if(s&&s.addEventListener("click",()=>{te({intensity:.86,radius:18,xPosition:.72})}),r&&r.addEventListener("click",()=>{const t=ce();le(t),o&&B[t]&&(o.textContent=B[t].description),ln(e,se)}),l&&l.addEventListener("click",()=>{const t=se();re({filterBaseFreq:c(d(t.filterBaseFreq,120),300,8e3),filterQ:c(d(t.filterQ,.04),.05,.9),pitchCurve:c(d(t.pitchCurve,.06),.6,1.8),sparkleGain:c(d(t.sparkleGain,.03),0,.35),sparkleDecayMul:c(d(t.sparkleDecayMul,.05),.25,.95),noiseTransientQ:c(d(t.noiseTransientQ,.25),.6,6),reverbWetMix:c(d(t.reverbWetMix,.02),0,.35),reverbDecay:c(d(t.reverbDecay,.03),.05,.4),collisionMinImpact:c(d(t.collisionMinImpact,.03),.45,.9),variancePitch:c(d(t.variancePitch,.01),0,.2),varianceGain:c(d(t.varianceGain,.02),0,.35)}),ln(e,se),te({intensity:.86,radius:18,xPosition:.72})}),t&&t.addEventListener("click",async()=>{const e=ie();if(e.isUnlocked){const t=oe();u({...e,isEnabled:t})}else await Z()&&u(null,{openIfEnabled:!0})}),a){for(const[e,t]of Object.entries(B)){const n=document.createElement("option");n.value=e,n.textContent=t.label,a.appendChild(n)}a.value=ce(),o&&B[ce()]&&(o.textContent=B[ce()].description),a.addEventListener("change",()=>{le(a.value),o&&B[a.value]&&(o.textContent=B[a.value].description),ln(e,se)})}(function(e,t,n){const a=(e,t,n)=>e<t?t:e>n?n:e;for(const t of Object.values(rn))for(const o of t.controls){const t=e.querySelector(`#sound_${o.id}`),i=e.querySelector(`#sound_${o.id}_val`);if(!t)continue;const s=e=>{const s=parseFloat(t.min),r=parseFloat(t.max),l=a(e,s,r);t.value=String(l);const c=o.toConfig(l);i&&(i.textContent=o.format(l)),n({[o.id]:c})};t.addEventListener("input",()=>{s(parseFloat(t.value))}),t.addEventListener("wheel",e=>{if(e.ctrlKey)return;const n=(parseFloat(t.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),a=e.deltaY<0?1:-1,o=parseFloat(t.value);e.preventDefault(),s(o+a*n)},{passive:!1}),i&&i.addEventListener("wheel",e=>{if(e.ctrlKey)return;const n=(parseFloat(t.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),a=e.deltaY<0?1:-1,o=parseFloat(t.value);e.preventDefault(),s(o+a*n)},{passive:!1})}})(e,0,re),ln(e,se),u(),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(G,e=>{u(e&&e.detail?e.detail:null)})}(e),function(e){const t=e.querySelector("#layoutFrame"),n=e.querySelector("#frameValue"),a=e.querySelector("#contentPadding"),o=e.querySelector("#contentPadValue"),i=e.querySelector("#layoutRadius"),s=e.querySelector("#radiusValue"),l=e.querySelector("#layoutViewportWidth"),c=e.querySelector("#viewportWidthValue"),p=e.querySelector("#layoutWallInset"),m=e.querySelector("#wallInsetValue"),f=h(),g=({triggerResize:e=!1}={})=>{if(d(),u(),n&&(n.textContent=`${(f.containerBorderVw||0).toFixed(2)}vw · ${Math.round(f.containerBorder||0)}px`),o&&(o.textContent=`${(f.contentPaddingVw||0).toFixed(2)}vw · ${Math.round(f.contentPadding||0)}px`),s&&(s.textContent=`${(f.wallRadiusVw||0).toFixed(2)}vw · ${Math.round(f.wallRadius||0)}px`),c){const e=r();c.textContent=f.layoutViewportWidthPx>0?`${Math.round(f.layoutViewportWidthPx)}px`:`Auto (${Math.round(e)}px)`}e&&Ve()};t&&n&&t.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(f.containerBorderVw=t,f.wallThicknessVw=t,g({triggerResize:!0}))}),a&&o&&a.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(f.contentPaddingVw=t,g())}),i&&s&&i.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(f.wallRadiusVw=t,g())}),l&&c&&l.addEventListener("input",e=>{const t=parseInt(e.target.value,10);f.layoutViewportWidthPx=Number.isFinite(t)?Math.max(0,t):0,g({triggerResize:!0})}),p&&m&&p.addEventListener("input",e=>{const t=parseInt(e.target.value,10);m.textContent=`${t}px`,f.wallInset=t})}(e)},0),e}(),cn.appendChild(dn),document.body.insertBefore(cn,document.body.firstChild),function(){if(!dn)return;const e=dn.querySelector(".panel-header");e&&(e.addEventListener("mousedown",wn),e.addEventListener("touchstart",wn,{passive:!1}),document.addEventListener("mousemove",Sn),document.addEventListener("mouseup",xn),document.addEventListener("touchmove",Sn,{passive:!1}),document.addEventListener("touchend",xn),function(){try{if(!cn)return;const e=JSON.parse(localStorage.getItem(un)||"{}");e.custom&&(cn.style.position="fixed",cn.style.left=e.left,cn.style.top=e.top,cn.style.right="auto")}catch(e){}}())}(),function(){if(!dn)return;if("undefined"==typeof ResizeObserver)return;let e=0;const t=new ResizeObserver(()=>{dn&&(dn.classList.contains("collapsed")||(window.clearTimeout(e),e=window.setTimeout(()=>{!function(e){try{if(!e)return;if(e.classList.contains("collapsed"))return;const t=e.getBoundingClientRect(),n={width:Math.round(t.width),height:Math.round(t.height)};localStorage.setItem(hn,JSON.stringify(n))}catch(e){}}(dn)},150)))});try{t.observe(dn)}catch(e){}}(),cn}function wn(e){if(e.target.closest("button")||e.target.closest("input")||e.target.closest("select"))return;if(!cn)return;const t=e.touches?e.touches[0].clientX:e.clientX,n=e.touches?e.touches[0].clientY:e.clientY,a=cn.getBoundingClientRect();gn=t,yn=n,bn=a.left,vn=a.top,fn=!1}function Sn(e){if(0===gn&&0===yn)return;if(!cn)return;const t=e.touches?e.touches[0].clientX:e.clientX,n=e.touches?e.touches[0].clientY:e.clientY,a=t-gn,o=n-yn;if(!fn&&(Math.abs(a)>5||Math.abs(o)>5)&&(fn=!0,cn.classList.add("dragging"),cn.style.position="fixed",cn.style.top=`${vn}px`,cn.style.left=`${bn}px`,cn.style.right="auto"),fn){let t=bn+a,n=vn+o;const i=cn.getBoundingClientRect();t=Math.max(0,Math.min(window.innerWidth-i.width,t)),n=Math.max(0,Math.min(window.innerHeight-i.height,n)),cn.style.left=`${t}px`,cn.style.top=`${n}px`,e.preventDefault()}}function xn(){fn&&(fn=!1,cn&&cn.classList.remove("dragging"),En()),gn=0,yn=0,setTimeout(()=>{},10)}function En(){try{if(!cn)return;const e={left:cn.style.left,top:cn.style.top,custom:!0};localStorage.setItem(un,JSON.stringify(e))}catch(e){}}function Tn(){if(cn){cn.style.position="",cn.style.left="",cn.style.top="",cn.style.right="";try{localStorage.removeItem(un)}catch(e){}}}const Cn=Tn;function Pn(){if(!cn)try{Mn()}catch(e){return}const e=cn.classList.toggle("hidden");if(mn(e),!e)try{!function(){if(!cn)return;const e=!!cn.style.left,t=!!cn.style.top;if(!e&&!t)return;const n=cn.getBoundingClientRect(),a=window.innerWidth||0,o=window.innerHeight||0;if(!a||!o)return;const i=10;if(n.right<i||n.left>a-i||n.bottom<i||n.top>o-i)return void Tn();const s=(e,t,n)=>e<t?t:e>n?n:e,r=s(n.left,i,Math.max(i,a-n.width-i)),l=s(n.top,i,Math.max(i,o-n.height-i));cn.style.position="fixed",cn.style.left=`${Math.round(r)}px`,cn.style.top=`${Math.round(l)}px`,cn.style.right="auto",En()}()}catch(e){}}var In=Object.freeze({__proto__:null,collapsePanel:function(){dn&&dn.classList.add("collapsed")},createPanelDock:Mn,expandPanel:function(){dn&&dn.classList.remove("collapsed")},getControlPanel:function(){return dn},getDock:function(){return cn},getSoundPanel:function(){return dn},resetDockPosition:Cn,resetPanelPositions:Tn,toggleDock:Pn});let Rn=!1;const kn="--abs-brand-logo-scale";let Bn=null,_n=!1,An=0,Ln=0,Fn=1,On=1,Dn=1,Vn=null,Nn=null,$n=0,qn=null;function Wn(){An=window.innerWidth||0,Ln=window.innerHeight||0,Fn=Math.max(1,.5*Math.min(An,Ln)),On=Math.max(1,.25*An),Dn=Math.max(1,.25*Ln)}function Gn(){if($n=0,!_n||!Bn)return;if(null==Vn||null==Nn)return;const e=Vn-.5*An,t=Nn-.5*Ln,n=Math.hypot(e,t);let a=0;if(n>0){const n=Math.sqrt(e*e/(On*On)+t*t/(Dn*Dn));a=n>0?1/n:0}let o=0;var i;o=n<=a?0:n>=Fn?1:(i=(n-a)/Math.max(1e-6,Fn-a))<0?0:i>1?1:i;const s=.98+(1.02-.98)*o;null!=qn&&Math.abs(s-qn)<.001||(Bn.style.setProperty(kn,s.toFixed(4)),qn=s)}let Kn=null,Hn=!1,zn=!1,Xn=0;function Yn(){Hn||(Kn=document.createElement("div"),Kn.id="custom-cursor",Kn.setAttribute("aria-hidden","true"),document.body.appendChild(Kn),Kn.style.display="none",Hn=!0,Un())}function Un(){if(!Kn)return;const e=h(),t=(e.R_MIN+e.R_MAX)/2*e.cursorSize;Xn=2*t,Kn.style.width=`${Xn}px`,Kn.style.height=`${Xn}px`,Kn.style.borderRadius="50%",Kn.style.marginLeft="0",Kn.style.marginTop="0",zn||(Kn.style.transform="translate(-50%, -50%) scale(1)",Kn.style.opacity="1")}function jn(e,t){if(!Kn)return;const n=zn;zn=function(e,t){const n=document.getElementById("bravia-balls");if(!n)return!1;const a=n.getBoundingClientRect();return e>=a.left&&e<=a.right&&t>=a.top&&t<=a.bottom}(e,t),Kn.style.left=`${e}px`,Kn.style.top=`${t}px`,document.body.style.cursor="none",zn?(Kn.style.display="block",n?Kn.style.transform.includes("scale(0.25)")||(Kn.style.transform="translate(-50%, -50%) scale(0.25)",Kn.style.opacity="1"):(Kn.style.transform="translate(-50%, -50%) scale(1)",Kn.style.opacity="1",Kn.offsetHeight,requestAnimationFrame(()=>{Kn.style.transform="translate(-50%, -50%) scale(0.25)",Kn.style.opacity="1"}))):(Kn.style.display="none",n&&(Kn.style.transform="translate(-50%, -50%) scale(1)",Kn.style.opacity="1"))}function Qn(){Kn&&(Kn.style.display="none",document.body.style.cursor="none",zn=!1)}function Jn(){Kn&&(zn=!1)}var Zn=Object.freeze({__proto__:null,hideCursor:Qn,setupCustomCursor:Yn,showCursor:Jn,updateCursorPosition:jn,updateCursorSize:Un});let ea=0,ta=0,na=0,aa=0,oa=0;const ia=[t.CRITTERS,t.PIT,t.PIT_THROWS,t.FLIES,t.WEIGHTLESS,t.WATER,t.VORTEX,t.PING_PONG,t.MAGNETIC,t.BUBBLES,t.KALEIDOSCOPE];function sa(e){const t=ia.filter(t=>t!==e);return t.length?t[Math.random()*t.length|0]:e||ia[0]}function ra(){const e=h().currentMode;let t=null;try{t=sessionStorage.getItem("bb:last_click_mode")}catch(e){}let n=sa(e);if(t&&ia.length>2)for(let a=0;a<3&&n===t;a++)n=sa(e);try{sessionStorage.setItem("bb:last_click_mode",n)}catch(e){}Promise.resolve().then(function(){return ut}).then(({setMode:e})=>{e(n)}),Promise.resolve().then(function(){return on}).then(({updateModeButtonsUI:e})=>{e(n)})}let la=0;let ca=0,da=0,ua=0;const pa="--abs-brand-logo-retreat";let ha=null,ma=!1,fa=0,ga=null,ya=0,ba=0,va=1;function Ma(){if(!ha)return;const e=ha.getBoundingClientRect();ya=e.left+.5*e.width,ba=e.top+.5*e.height,va=Math.max(1,.6*Math.min(e.width,e.height))}let wa=performance.now()/1e3,Sa=0,xa=!0,Ea=null;const Ta=1e3/60;let Ca=[],Pa=0;function Ia(e){function a(o){if(!xa)return void(Ea=null);const i=o-Sa;if(i<Ta)return void(Ea=requestAnimationFrame(a));Sa=o-i%Ta,function(e){if(Ca.push(e),Ca.length>30&&Ca.shift(),30===Ca.length){const e=1e3/(Ca.reduce((e,t)=>e+t,0)/30);e<30&&Pa<2?(Pa++,console.log(`⚡ Adaptive throttle increased to level ${Pa} (avg FPS: ${e.toFixed(1)})`)):e>55&&Pa>0&&(Pa--,console.log(`⚡ Adaptive throttle decreased to level ${Pa} (avg FPS: ${e.toFixed(1)})`))}}(i);const s=o/1e3;let r=Math.min(.033,s-wa);wa=s,(Pa<2||Math.random()>.5)&&async function(e,a){const o=h(),i=o.balls,s=o.canvas;if(!s)return;if(0===i.length)return;if(o.currentMode===t.KALEIDOSCOPE){const t=Math.min(.033,Math.max(0,e)),n=i.length;for(let e=0;e<n;e++)i[e].step(t,a);!function({iterations:e=4,positionalCorrectionPercent:t=.25,positionalCorrectionSlopPx:n=null,maxCorrectionPx:a=null,enableSound:o=!0}={}){const i=h(),s=i.balls,r=ue(),l=i.REST,c=t,d=n??.5*i.DPR,u=(i.ballSpacing||0)*(i.DPR||1),p=a??2*(i.DPR||1);for(let t=0;t<e;t++)for(let e=0;e<r.length;e++){const{i:n,j:a}=r[e],h=s[n],m=s[a];if(h.isSleeping&&m.isSleeping)continue;h.isSleeping&&h.wake(),m.isSleeping&&m.wake();const f=m.x-h.x,g=m.y-h.y,y=h.r+m.r+u,b=f*f+g*g;if(0===b||b>y*y)continue;const v=Math.sqrt(b),M=f/v,w=g/v,S=y-v,x=1/Math.max(h.m,.001),E=1/Math.max(m.m,.001);let T=c*Math.max(S-d,0)/(x+E);T>p&&(T=p);const C=T*M,P=T*w;h.x-=C*x,h.y-=P*x,m.x+=C*E,m.y+=P*E;const I=(m.vx-h.vx)*M+(m.vy-h.vy)*w;if(I<0){const e=-(1+(Math.abs(I)<30?0:l))*I/(x+E),s=e*M,r=e*w;if(h.vx-=s*x,h.vy-=r*x,m.vx+=s*E,m.vy+=r*E,o&&0===t){const e=(h.r+m.r)/2,t=(h.x+m.x)/2/(i.canvas?.width||1);ee(e,Math.min(1,Math.abs(I)/(50*(h.r+m.r))),t,`${n}-${a}`)}}}}({iterations:3,positionalCorrectionPercent:.22,maxCorrectionPx:1.25*(o.DPR||1),enableSound:!1});for(let e=0;e<n;e++)at(i[e],s.width,s.height,t);return void(wt=0)}wt+=e;let r=0;for(;wt>=Mt&&r<n.MAX_PHYSICS_STEPS;){const e=i.length;for(let t=0;t<e;t++)i[t].step(Mt,a);o.currentMode===t.KALEIDOSCOPE?pe(6):o.currentMode!==t.FLIES&&pe(10),fe.clearAllPressure();const n=o.currentMode===t.WEIGHTLESS?o.weightlessBounce:o.REST,l=i.length;for(let e=0;e<l;e++)xt(i[e],s),i[e].walls(s.width,s.height,Mt,n);wt-=Mt,r++}const l=dt();l&&l(e),fe.step(e),wt>Mt*n.ACCUMULATOR_RESET_THRESHOLD&&(wt=0)}(r,e),function(){const e=h(),n=e.ctx,a=e.balls,o=e.canvas;if(n&&o){if(n.clearRect(0,0,o.width,o.height),e.currentMode,e.currentMode===t.KALEIDOSCOPE)!function(e){const n=h();if(n.currentMode!==t.KALEIDOSCOPE)return;const a=n.canvas;if(!a)return;const o=function(){const e=performance.now(),t=Qe||e;return Qe=e,Je((e-t)/1e3,0,.05)}(),i=n.balls,s=a.width,r=a.height,l=et(n),c=n.kaleidoscopeSegments??12,d=Je(Math.round(c),3,24),u=Boolean(n.kaleidoscopeMirror??!0),{x:p,y:m}=Ze(n),f=Ue/d,g=Je(n.kaleidoscopeRotationFollow??1,0,3),y=Math.max(1e-5,1e-4*f),b=n.mouseInCanvas?n.mouseX:p,v=n.mouseInCanvas?n.mouseY:m,M=b-p,w=v-m,S=Math.atan2(w,M),x=Je(Math.hypot(M,w)/Math.max(1,.5*Math.min(s,r)),0,1),E=n.mouseInCanvas?1-x:0,T=(.6*S*E+1.2*E)*g,C=Je(n.kaleidoscopePanStrength??.75,0,2),P=M*C*E,I=w*C*E;n._kaleiEase||(n._kaleiEase={panX:{x:0,v:0},panY:{x:0,v:0},phase:{x:0,v:0},lastMouseX:b,lastMouseY:v,lastInCanvas:Boolean(n.mouseInCanvas)});const R=n._kaleiEase,k=Boolean(n.mouseInCanvas),B=Math.hypot(b-R.lastMouseX,v-R.lastMouseY)>.5||k!==R.lastInCanvas;let _=R.panX.x,A=R.panY.x,L=R.phase.x;B?(R.lastMouseX=b,R.lastMouseY=v,R.lastInCanvas=k,_=nt(R.panX,P,o,9),A=nt(R.panY,I,o,9),L=nt(R.phase,T,o,11)):(R.panX.v=0,R.panY.v=0,R.phase.v=0);for(let t=0;t<i.length;t++){const n=i[t],a=n.x-p+_,o=n.y-m+A,s=1.8*l,r=Math.hypot(a,o)*s;if(r<je)continue;const c=u?2*f:f;let h=Math.atan2(o,a)+L;h=(h%c+c)%c,u&&h>f&&(h=c-h),h=Je(h,y,f-y);for(let t=0;t<d;t++){const a=t*f+h,o=p+Math.cos(a)*r,i=m+Math.sin(a)*r;n.alpha<1&&(e.globalAlpha=n.alpha),e.fillStyle=n.color,e.beginPath(),e.arc(o,i,n.r,0,Ue),e.fill(),n.alpha<1&&(e.globalAlpha=1)}}}(n);else for(let e=0;e<a.length;e++)a[e].draw(n);!function(e){const t=h();if(!t?.mouseTrailEnabled)return;if(bt())return;if(!e||!yt||!pt)return;const n=performance.now(),a=vt(Number(t.mouseTrailFadeMs??220),40,2e3),o=vt(Number(t.mouseTrailOpacity??.35),0,1);if(o<=0)return;const i=t.DPR||1,s=vt(Number(t.mouseTrailSize??1.3),.5,10)*i;for(;yt>0&&!(n-ft[(gt-yt+pt)%pt]<=a);)yt--;if(!yt)return;if(yt<2)return;const r=e.globalAlpha,l=e.globalCompositeOperation,c=e.lineCap,d=e.lineJoin,u=e.strokeStyle,p=e.lineWidth;e.globalCompositeOperation="source-over",e.lineCap="round",e.lineJoin="round",e.strokeStyle="#000000",e.lineWidth=s,e.globalAlpha=o;const m=yt,f=(gt-m+pt)%pt;e.beginPath();const g=ht[f],y=mt[f];if(e.moveTo(g,y),2===m){const t=ht[(f+1)%pt],n=mt[(f+1)%pt];e.lineTo(t,n)}else{for(let t=1;t<m-1;t++){const n=(f+t)%pt,a=(f+t+1)%pt,o=ht[n],i=mt[n],s=.5*(o+ht[a]),r=.5*(i+mt[a]);e.quadraticCurveTo(o,i,s,r)}const t=(f+m-1)%pt;e.lineTo(ht[t],mt[t])}e.stroke(),e.globalAlpha=r,e.globalCompositeOperation=l,e.lineCap=c,e.lineJoin=d,e.strokeStyle=u,e.lineWidth=p}(n),function(e,t,n){const a=h(),o=function(){try{return getComputedStyle(document.documentElement).getPropertyValue("--wall-color").trim()||"#0a0a0a"}catch{return"#0a0a0a"}}(),i=(a.wallThickness||12)*(a.DPR||1);if(e.save(),e.fillStyle=o,fe.bottom.hasDeformation()){e.beginPath(),e.moveTo(0,n+i);for(let a=0;a<=he;a++){const o=a/he,i=o*t,s=fe.bottom.getDeformAt(o);e.lineTo(i,n-s)}e.lineTo(t,n+i),e.closePath(),e.fill()}if(fe.top.hasDeformation()){e.beginPath(),e.moveTo(0,-i);for(let n=0;n<=he;n++){const a=n/he,o=a*t,i=fe.top.getDeformAt(a);e.lineTo(o,i)}e.lineTo(t,-i),e.closePath(),e.fill()}if(fe.left.hasDeformation()){e.beginPath(),e.moveTo(-i,0);for(let t=0;t<=he;t++){const a=t/he,o=a*n,i=fe.left.getDeformAt(a);e.lineTo(i,o)}e.lineTo(-i,n),e.closePath(),e.fill()}if(fe.right.hasDeformation()){e.beginPath(),e.moveTo(t+i,0);for(let a=0;a<=he;a++){const o=a/he,i=o*n,s=fe.right.getDeformAt(o);e.lineTo(t-s,i)}e.lineTo(t+i,n),e.closePath(),e.fill()}e.restore()}(n,o.width,o.height)}}(),Pa<2&&function(e){if(!ma||!ha)return;if(e-fa<90)return;fa=e;const t=h(),n=t.balls||[],a=t.canvas;if(!a||0===n.length)return void(0!==ga&&(ha.style.setProperty(pa,"0"),ga=0));const o=a.getBoundingClientRect(),i=t.DPR||1,s=(ya-o.left)*i,r=(ba-o.top)*i,l=Math.max(1,.5*Math.min(window.innerWidth,window.innerHeight)*i),c=(va+18)*i;let d=1/0;for(let e=0;e<n.length;e++){const t=n[e],a=t.x-s,o=t.y-r,i=Math.hypot(a,o),l=Math.max(0,i-(t.r||0));if(l<d&&(d=l),d<=c)break}let u=0;var p;u=d<=c?1:d>=l?0:1-((p=(d-c)/Math.max(1e-6,l-c))<0?0:p>1?1:p);const m=Number(u.toFixed(3));null!=ga&&Math.abs(m-ga)<.001||(ha.style.setProperty(pa,String(m)),ga=m)}(o),function(e){if(da++,e-ca>1e3){ua=da,da=0,ca=e;const t=document.getElementById("render-fps");t&&(t.textContent=String(ua))}}(performance.now()),Ea=requestAnimationFrame(a)}document.addEventListener("visibilitychange",()=>{xa=!document.hidden,xa?(wa=performance.now()/1e3,Sa=performance.now(),console.log("▶️ Animation resumed"),Ea||(Ea=requestAnimationFrame(a))):(console.log("⏸️ Animation paused (tab hidden)"),Ea&&(cancelAnimationFrame(Ea),Ea=null))}),Ea=requestAnimationFrame(a),console.log("✓ Render loop started (60fps throttle, visibility-aware)")}let Ra=null,ka=!0;function Ba(){Ra&&ka&&(Ra.setAttribute("aria-hidden","false"),Ra.offsetWidth,Ra.classList.add("active"))}function _a(){Ra&&ka&&(Ra.classList.remove("active"),Ra.setAttribute("aria-hidden","true"))}function Aa(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.offsetWidth,e.classList.add(`page-flash--${t}`),setTimeout(()=>{e.classList.remove(`page-flash--${t}`)},"success"===t?600:300)}function La(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.offsetWidth,e.classList.add(`page-flash--${t}`),setTimeout(()=>{e.classList.remove(`page-flash--${t}`)},"success"===t?600:300)}const Fa="info@beck.fyi",Oa='<i class="ti ti-volume-off" aria-hidden="true"></i>';let Da=null;async function Va(){ie().isUnlocked?Na(oe()):await Z()?Na(!0):(Da&&(Da.innerHTML=Oa,Da.setAttribute("aria-label","Audio unavailable"),Da.title="Audio unavailable"),setTimeout(()=>{Na(!1)},2e3))}function Na(e){Da&&(Da.setAttribute("data-enabled",e?"true":"false"),Da.setAttribute("aria-pressed",e?"true":"false"),Da.setAttribute("aria-label",e?"Sound on":"Sound off"),Da.title=e?"Sound on":"Sound off",Da.innerHTML=e?'<i class="ti ti-volume-2" aria-hidden="true"></i>':Oa)}const $a=new Map([["apple music",'<i class="ti ti-brand-apple" aria-hidden="true"></i>'],["instagram",'<i class="ti ti-brand-instagram" aria-hidden="true"></i>'],["linkedin",'<i class="ti ti-brand-linkedin" aria-hidden="true"></i>']]);function qa(e){const t=document.documentElement;void 0!==e.containerInnerShadowOpacity&&t.style.setProperty("--container-inner-shadow-opacity",String(e.containerInnerShadowOpacity)),void 0!==e.containerInnerShadowBlur&&t.style.setProperty("--container-inner-shadow-blur",`${e.containerInnerShadowBlur}px`),void 0!==e.containerInnerShadowSpread&&t.style.setProperty("--container-inner-shadow-spread",`${e.containerInnerShadowSpread}px`),void 0!==e.containerInnerShadowOffsetY&&t.style.setProperty("--container-inner-shadow-offset-y",`${e.containerInnerShadowOffsetY}px`),void 0!==e.noiseSizeBase&&t.style.setProperty("--noise-size-base",`${e.noiseSizeBase}px`),void 0!==e.noiseSizeTop&&t.style.setProperty("--noise-size-top",`${e.noiseSizeTop}px`),void 0!==e.noiseBackOpacity&&(t.style.setProperty("--noise-back-opacity",String(e.noiseBackOpacity)),t.style.setProperty("--noise-back-opacity-light",String(e.noiseBackOpacity))),void 0!==e.noiseFrontOpacity&&(t.style.setProperty("--noise-front-opacity",String(e.noiseFrontOpacity)),t.style.setProperty("--noise-front-opacity-light",String(e.noiseFrontOpacity))),void 0!==e.noiseBackOpacityDark&&t.style.setProperty("--noise-back-opacity-dark",String(e.noiseBackOpacityDark)),void 0!==e.noiseFrontOpacityDark&&t.style.setProperty("--noise-front-opacity-dark",String(e.noiseFrontOpacityDark))}return async function(){if(document.documentElement.classList.add("js-enabled"),Rt()?At():function({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"]}={}){Rt()||At({sentence:e,ascii:t,silence:!0})}(),Rt())try{const e=await Promise.resolve().then(function(){return tn});e.setApplyVisualCSSVars?.(qa)}catch(e){}try{Rt()&&Et.groupCollapsed("BouncyBalls bootstrap"),Ft("bb:start"),Lt("🚀 Initializing modular bouncy balls...");const e=await async function(){try{try{if("undefined"!=typeof window&&window.__RUNTIME_CONFIG__&&"object"==typeof window.__RUNTIME_CONFIG__)return window.__RUNTIME_CONFIG__}catch(e){}const e=["config/default-config.json","js/config.json","../public/js/config.json"];for(const t of e)try{const e=await fetch(t,{cache:"no-cache"});if(e.ok)return await e.json()}catch(e){}throw new Error("No config found")}catch(e){return console.warn("Config load failed, using defaults"),{gravityMultiplier:1.05,ballMass:91,maxBalls:300}}}();p(e),Ft("bb:config"),Lt("✓ Config loaded");try{const e=h();"undefined"!=typeof window&&(window.REST=e.REST,window.FRICTION=e.FRICTION,window.MAX_BALLS=e.maxBalls,window.repelRadius=e.repelRadius,window.repelPower=e.repelPower)}catch(e){}u(),Lt("✓ Layout applied"),qa(e),Lt("✓ Visual effects configured"),function(){const e=document.querySelector(".noise");if(!e)return;const t=e.closest("#bravia-balls")||document.getElementById("bravia-balls")||e.parentElement||document.body,n=getComputedStyle(e),a=n.backgroundImage&&"none"!==n.backgroundImage?n.backgroundImage:null;if(!document.querySelector(".noise-2")){const e=document.createElement("div");e.className="noise-2",a&&(e.style.backgroundImage=a),t.appendChild(e),console.log("✓ Created .noise-2 element")}if(!document.querySelector(".noise-3")){const e=document.createElement("div");e.className="noise-3",a&&(e.style.backgroundImage=a),t.appendChild(e),console.log("✓ Created .noise-3 element")}}(),De();const a=Ne(),o=$e(),i=document.getElementById("bravia-balls");if(!a||!o||!i)throw new Error("Missing DOM elements");try{a.setAttribute("role","application"),a.getAttribute("aria-label")||a.setAttribute("aria-label","Interactive bouncy balls physics simulation")}catch(e){}m(a,o,i),Ve(),Ft("bb:renderer"),Lt("✓ Canvas initialized (container-relative sizing)"),h().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),function(){const e=h(),a=e.canvas;if(void 0===e.clickCycleEnabled&&(e.clickCycleEnabled=!1),!a)return void console.error("Canvas not available for pointer setup");const o=e.DPR;function i(e){return!(!e||!e.closest)&&Boolean(e.closest("#panelDock")||e.closest("#masterPanel")||e.closest("#dockToggle")||e.closest(".panel-dock")||e.closest(".panel"))}function s(e,t){const n=a.getBoundingClientRect();return{x:(e-n.left)*o,y:(t-n.top)*o,inBounds:e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom}}function r(n,a,o,{isMouseLike:r}={isMouseLike:!0}){if(function(e,t){_n&&Bn&&(Vn=e,Nn=t,$n||($n=window.requestAnimationFrame(Gn)))}(n,a),r?jn(n,a):Qn(),i(o))return;const l=s(n,a),c=performance.now(),d=c-na;if(d>0&&na>0){const e=l.x-ea,t=l.y-ta;aa=Math.sqrt(e*e+t*t)/d}e.mouseX=l.x,e.mouseY=l.y,e.mouseInCanvas=l.inBounds,"undefined"!=typeof window&&(window.mouseInCanvas=l.inBounds);const u=Math.hypot(l.x-(e.lastPointerMoveX??l.x),l.y-(e.lastPointerMoveY??l.y));if(u>.5&&(e.lastPointerMoveMs=c,e.lastPointerMoveX=l.x,e.lastPointerMoveY=l.y),r&&u>.5&&function(e,t,n,a){const o=h();if(!o?.mouseTrailEnabled)return;if(!a)return;if(bt())return;if(function(e){const t=Math.max(0,0|e);t<=0||pt===t&&ht&&mt&&ft||(pt=t,ht=new Float32Array(pt),mt=new Float32Array(pt),ft=new Float64Array(pt),gt=0,yt=0)}(vt(0|(o.mouseTrailLength??18),4,96)),!pt)return;const i=o.DPR||1,s=vt(Number(o.mouseTrailSize??1.3),.5,10)*i,r=Math.max(.35,.55*s),l=r*r;if(yt>0){const a=(gt-1+pt)%pt;if(function(e,t,n,a){const o=e-n,i=t-a;return o*o+i*i}(e,t,ht[a],mt[a])<l)return void(ft[a]=n)}ht[gt]=e,mt[gt]=t,ft[gt]=n,gt=(gt+1)%pt,yt<pt&&yt++}(l.x,l.y,c,l.inBounds),e.currentMode===t.WATER&&l.inBounds&&aa>.3&&c-la>80){const e=Math.min(2*aa,3);xe(l.x,l.y,e),la=c}ea=l.x,ta=l.y,na=c}document.addEventListener("mousemove",e=>{window.PointerEvent||r(e.clientX,e.clientY,e.target,{isMouseLike:!0})},{passive:!0}),document.addEventListener("pointermove",e=>{const t="mouse"===e.pointerType||"pen"===e.pointerType;r(e.clientX,e.clientY,e.target,{isMouseLike:t})},{passive:!0}),document.addEventListener("click",t=>{i(t.target)||t.target.closest("a")||t.target.closest("button")||t.target.closest("input")||t.target.closest("select")||t.target.closest("textarea")||s(t.clientX,t.clientY).inBounds&&e.clickCycleEnabled&&ra()}),document.addEventListener("touchmove",n=>{if(n.touches&&n.touches[0]){const a=s(n.touches[0].clientX,n.touches[0].clientY);e.mouseX=a.x,e.mouseY=a.y,e.mouseInCanvas=a.inBounds;const o=performance.now();Math.hypot(a.x-(e.lastPointerMoveX??a.x),a.y-(e.lastPointerMoveY??a.y))>.5&&(e.lastPointerMoveMs=o,e.lastPointerMoveX=a.x,e.lastPointerMoveY=a.y),e.currentMode===t.WATER&&a.inBounds&&o-la>80&&(xe(a.x,a.y,2),la=o)}},{passive:!0}),document.addEventListener("touchstart",t=>{if(!i(t.target)&&(Qn(),!t.target.closest("a")&&!t.target.closest("button")&&!t.target.closest("input")&&!t.target.closest("select")&&!t.target.closest("textarea")&&t.touches&&t.touches[0])){if(!s(t.touches[0].clientX,t.touches[0].clientY).inBounds)return;const n=performance.now();n-oa<300&&e.clickCycleEnabled&&ra(),oa=n}},{passive:!0}),document.addEventListener("mouseleave",()=>{e.mouseX=n.OFFSCREEN_MOUSE,e.mouseY=n.OFFSCREEN_MOUSE,e.mouseInCanvas=!1,aa=0,"undefined"!=typeof window&&(window.mouseInCanvas=!1),Qn()}),document.addEventListener("mouseenter",()=>{Jn()}),document.addEventListener("touchend",()=>{e.mouseX=n.OFFSCREEN_MOUSE,e.mouseY=n.OFFSCREEN_MOUSE,e.mouseInCanvas=!1},{passive:!0}),console.log("✓ Unified pointer system configured (document-level)"),e.__pointerReady=!0,"undefined"!=typeof window&&(window.__pointerReady=!0)}(),Lt("✓ Pointer tracking configured"),Yn(),Ft("bb:input"),Lt("✓ Custom cursor initialized"),"undefined"!=typeof window&&"undefined"!=typeof document&&(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches||(Bn=document.querySelector("#brand-logo .hero__text")||document.querySelector("#brand-logo")||null,Bn&&(Wn(),_n=!0,Bn.style.setProperty(kn,String(1)),window.addEventListener("resize",Wn,{passive:!0})))),"undefined"!=typeof window&&"undefined"!=typeof document&&(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches||(ha=document.querySelector("#brand-logo .hero__text")||document.querySelector("#brand-logo")||null,ha&&(Ma(),window.addEventListener("resize",Ma,{passive:!0}),ha.style.setProperty(pa,"0"),ma=!0))),console.log("⚠️ localStorage is disabled - using defaults"),J();try{!function(e){const t=e&&"object"==typeof e?e:null;if(!t)return;if("string"==typeof t.soundPreset&&le(t.soundPreset),t.soundConfig&&"object"==typeof t.soundConfig)return void re(t.soundConfig);const n={};let a=!1;for(const[e,o]of Object.entries(t))e in k&&(n[e]=o,a=!0);a&&re(n)}(e)}catch(e){}if(Lt("✓ Sound engine primed (awaiting user unlock)"),Rt())try{const e=await Promise.resolve().then(function(){return In});e.createPanelDock?.();const t=await Promise.resolve().then(function(){return P});t.populateColorSelect?.()}catch(e){}Ft("bb:ui"),Lt(Rt()?"✓ Panel dock created (Sound + Controls)":"✓ UI initialized (panel disabled in production)"),function(){if(Nt)return;Nt=!0,Vt=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",Lt(`🖥️ System prefers: ${Vt}`),qt("light");const e=document.getElementById("themeAuto"),t=document.getElementById("themeLight"),n=document.getElementById("themeDark");e&&e.addEventListener("click",()=>qt("auto")),t&&t.addEventListener("click",()=>qt("light")),n&&n.addEventListener("click",()=>qt("dark")),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{Vt=e.matches?"dark":"light",Lt(`🖥️ System preference changed to: ${Vt}`),"auto"===Dt&&qt("auto")}),Lt("✓ Modern dark mode initialized")}(),Ft("bb:theme"),Rn||(Rn=!0,window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName))return;const n=e.key.toLowerCase();if("/"===n||"Slash"===e.code)return e.preventDefault(),void Pn();"1"===n?(e.preventDefault(),lt(t.PIT),an("pit")):"2"===n?(e.preventDefault(),lt(t.FLIES),an("flies")):"3"===n?(e.preventDefault(),lt(t.WEIGHTLESS),an("weightless")):"4"===n?(e.preventDefault(),lt(t.WATER),an("water")):"5"===n?(e.preventDefault(),lt(t.VORTEX),an("vortex")):"6"===n?(e.preventDefault(),lt(t.PING_PONG),an("ping-pong")):"7"===n?(e.preventDefault(),lt(t.MAGNETIC),an("magnetic")):"8"===n?(e.preventDefault(),lt(t.BUBBLES),an("bubbles")):"9"===n&&(e.preventDefault(),lt(t.KALEIDOSCOPE),an("kaleidoscope"))})),Lt("✓ Keyboard shortcuts registered"),function(e){if(Ra=document.getElementById("gate-overlay"),!Ra)return void console.warn("Gate Overlay: #gate-overlay element not found");if(ka=!1!==e.gateOverlayEnabled,!ka)return console.log("Gate Overlay: Disabled by config"),void(Ra.style.display="none");const t=e.gateOverlayOpacity??.1,n=e.gateOverlayBlurPx??10,a=e.gateOverlayTransitionMs??400;Ra.style.setProperty("--gate-overlay-opacity",t),Ra.style.setProperty("--gate-overlay-blur",`${n}px`),Ra.style.setProperty("--gate-overlay-transition-duration",`${a}ms`),console.log(`Gate Overlay: Initialized (opacity: ${t}, blur: ${n}px, transition: ${a}ms)`)}(e),Lt("✓ Gate overlay system initialized"),function(){const e=document.getElementById("cv-gate-trigger"),t=document.getElementById("brand-logo"),n=document.getElementById("cv-gate"),a=document.getElementById("portfolio-gate"),o=document.getElementById("contact-gate"),i=Array.from(document.querySelectorAll(".cv-digit")),s=document.getElementById("page-flash"),r=document.getElementById("cv-gate-label");if(!e||!t||!n||0===i.length)return void console.warn("CV Gate: Missing required elements");r&&(r.innerHTML='\n            <div class="gate-nav">\n                <button type="button" class="gate-back" data-gate-back aria-label="Back">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>BACK</span>\n                </button>\n            </div>\n            <h2 class="gate-title">Download Bio/CV</h2>\n            <p class="gate-description">Because spam bots don\'t deserve nice things—and neither do recruiters who don\'t read portfolios. This keeps my inbox slightly more civilized.</p>\n        ');const l=s||function(){const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e}();let c=!1;const d=()=>n&&n.classList.contains("active")||a&&a.classList.contains("active")||o&&o.classList.contains("active"),u=()=>{c=!1,i.forEach(e=>e.value=""),n.classList.remove("active"),n.setAttribute("aria-hidden","true"),t.classList.remove("fade-out-up"),setTimeout(()=>{c||n.classList.add("hidden"),setTimeout(()=>{d()||_a()},50)},400)};try{const e=r?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",u)}catch(e){}const p=()=>{const e=i.map(e=>e.value).join("");4===e.length&&("1111"===e?(Aa(l,"success"),setTimeout(()=>{window.location.href="cv.html"},500)):(Aa(l,"error"),setTimeout(()=>{i.forEach(e=>e.value=""),i[0].focus()},350)))};e.addEventListener("click",e=>{e.preventDefault();const s=d();a&&a.classList.contains("active")&&(a.classList.remove("active"),a.setAttribute("aria-hidden","true"),setTimeout(()=>{a.classList.add("hidden")},400)),o&&o.classList.contains("active")&&(o.classList.remove("active"),o.setAttribute("aria-hidden","true"),setTimeout(()=>{o.classList.add("hidden")},400)),c=!0,s||Ba(),t.classList.add("fade-out-up"),n.classList.remove("hidden"),n.setAttribute("aria-hidden","false"),n.offsetWidth,n.classList.add("active"),i[0].focus()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&c&&u()}),i.forEach((e,t)=>{e.addEventListener("keydown",n=>{"Backspace"===n.key&&""===e.value&&(t>0?i[t-1].focus():u())}),e.addEventListener("input",e=>{const n=e.target.value;if(/^\d*$/.test(n)){if(1===n.length)t<i.length-1?i[t+1].focus():p();else if(n.length>1){const a=n.split("");e.target.value=a[0];let o=t+1;for(let e=1;e<a.length&&o<i.length;e++)i[o].value=a[e],o++;o<i.length?i[o].focus():p()}}else e.target.value=n.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})}(),Lt("✓ CV password gate initialized"),function(){const e=document.getElementById("portfolio-gate-trigger"),t=document.getElementById("brand-logo"),n=document.getElementById("portfolio-gate"),a=document.getElementById("cv-gate"),o=document.getElementById("contact-gate"),i=Array.from(document.querySelectorAll(".portfolio-digit")),s=document.getElementById("page-flash"),r=document.getElementById("portfolio-gate-label");if(!e||!t||!n||0===i.length)return void console.warn("Portfolio Gate: Missing required elements");r&&(r.innerHTML='\n            <div class="gate-nav">\n                <button type="button" class="gate-back" data-gate-back aria-label="Back">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>BACK</span>\n                </button>\n            </div>\n            <h2 class="gate-title">View Portfolio</h2>\n            <p class="gate-description">Good work deserves good context. This small step ensures you\'re here with intention, not just browsing. Quality takes time—yours and mine.</p>\n        ');const l=s||function(){const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e}();let c=!1;const d=()=>n&&n.classList.contains("active")||a&&a.classList.contains("active")||o&&o.classList.contains("active"),u=()=>{c=!1,i.forEach(e=>e.value=""),n.classList.remove("active"),n.setAttribute("aria-hidden","true"),t.classList.remove("fade-out-up"),setTimeout(()=>{c||n.classList.add("hidden"),setTimeout(()=>{d()||_a()},50)},400)};try{const e=r?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",u)}catch(e){}const p=()=>{const e=i.map(e=>e.value).join("");4===e.length&&("1234"===e?(La(l,"success"),setTimeout(()=>{window.location.href="portfolio.html"},500)):(La(l,"error"),setTimeout(()=>{i.forEach(e=>e.value=""),i[0].focus()},350)))};e.addEventListener("click",e=>{e.preventDefault();const s=d();a&&a.classList.contains("active")&&(a.classList.remove("active"),a.setAttribute("aria-hidden","true"),setTimeout(()=>{a.classList.add("hidden")},400)),o&&o.classList.contains("active")&&(o.classList.remove("active"),o.setAttribute("aria-hidden","true"),setTimeout(()=>{o.classList.add("hidden")},400)),c=!0,s||Ba(),t.classList.add("fade-out-up"),n.classList.remove("hidden"),n.setAttribute("aria-hidden","false"),n.offsetWidth,n.classList.add("active"),i[0].focus()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&c&&u()}),i.forEach((e,t)=>{e.addEventListener("keydown",n=>{"Backspace"===n.key&&""===e.value&&(t>0?i[t-1].focus():u())}),e.addEventListener("input",e=>{const n=e.target.value;if(/^\d*$/.test(n)){if(1===n.length)t<i.length-1?i[t+1].focus():p();else if(n.length>1){const a=n.split("");e.target.value=a[0];let o=t+1;for(let e=1;e<a.length&&o<i.length;e++)i[o].value=a[e],o++;o<i.length?i[o].focus():p()}}else e.target.value=n.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})}(),Lt("✓ Portfolio password gate initialized"),function(){const e=[document.getElementById("contact-email"),document.getElementById("contact-email-inline")].filter(Boolean),t=document.getElementById("brand-logo"),n=document.getElementById("contact-gate"),a=document.getElementById("contact-gate-label"),o=document.getElementById("contact-gate-inputs"),i=document.getElementById("cv-gate"),s=document.getElementById("portfolio-gate");if(!(e.length&&t&&n&&a&&o))return void console.warn("Contact Gate: Missing required elements");a.innerHTML='\n    <div class="gate-nav">\n      <button type="button" class="gate-back" data-gate-back aria-label="Back">\n        <i class="ti ti-arrow-left" aria-hidden="true"></i>\n        <span>BACK</span>\n      </button>\n    </div>\n    <h2 class="gate-title">Get in touch</h2>\n    <p class="gate-description">\n      For collaborations, product design work, AI prototyping, or anything that needs a crisp creative + technical brain.\n    </p>\n  ',o.innerHTML=`\n    <div class="contact-email-row" data-email-row>\n      <button type="button" class="contact-email-value" data-copy-email aria-label="Copy email address">\n        <span class="contact-email-text">${Fa}</span>\n      </button>\n      <button type="button" class="contact-email-copy" data-copy-email-icon aria-label="Copy email address">\n        <i class="ti ti-copy" aria-hidden="true"></i>\n      </button>\n    </div>\n    <div class="contact-copy-status" data-copy-status aria-live="polite"></div>\n  `;const r=a.querySelector("[data-gate-back]"),l=o.querySelector("[data-copy-email]"),c=o.querySelector("[data-copy-email-icon]"),d=o.querySelector("[data-email-row]"),u=o.querySelector("[data-copy-status]"),p=o.querySelector(".contact-email-copy i");let h=!1,m=null;const f=()=>n&&n.classList.contains("active")||i&&i.classList.contains("active")||s&&s.classList.contains("active"),g=e=>{if(l&&c&&u){if(m&&window.clearTimeout(m),"copied"===e)return d?.classList?.add?.("is-copied"),d?.classList?.remove?.("is-error"),u.textContent="Copied",p&&(p.className="ti ti-check"),void(m=window.setTimeout(()=>g("idle"),1200));if("error"===e)return d?.classList?.add?.("is-error"),d?.classList?.remove?.("is-copied"),u.textContent="Copy failed",p&&(p.className="ti ti-alert-triangle"),void(m=window.setTimeout(()=>g("idle"),1200));d?.classList?.remove?.("is-copied","is-error"),u.textContent="",p&&(p.className="ti ti-copy")}},y=e=>{e?.preventDefault?.();const a=f();i&&i.classList.contains("active")&&(i.classList.remove("active"),i.setAttribute("aria-hidden","true"),setTimeout(()=>i.classList.add("hidden"),400)),s&&s.classList.contains("active")&&(s.classList.remove("active"),s.setAttribute("aria-hidden","true"),setTimeout(()=>s.classList.add("hidden"),400)),h=!0,a||Ba(),g("idle"),t.classList.add("fade-out-up"),n.classList.remove("hidden"),n.setAttribute("aria-hidden","false"),n.offsetWidth,n.classList.add("active"),l?.focus?.()},b=()=>{h=!1,g("idle"),n.classList.remove("active"),n.setAttribute("aria-hidden","true"),t.classList.remove("fade-out-up"),setTimeout(()=>{h||n.classList.add("hidden"),setTimeout(()=>{f()||_a()},50)},400)};e.forEach(e=>e.addEventListener("click",y,{capture:!0})),r?.addEventListener("click",b);const v=async e=>{const t=await async function(e){try{if(navigator?.clipboard?.writeText)return await navigator.clipboard.writeText(e),!0}catch(e){}try{const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly","true"),t.style.position="fixed",t.style.left="-9999px",t.style.top="0",document.body.appendChild(t),t.select();const n=!0===document.execCommand?.("copy");return document.body.removeChild(t),n}catch(e){return!1}}(Fa);g(t?"copied":"error")};l?.addEventListener("click",v),c?.addEventListener("click",v),document.addEventListener("keydown",e=>{"Escape"===e.key&&h&&b()})}(),Lt("✓ Contact gate initialized"),function(){const e=document.getElementById("social-links");if(!e)return;if(e.querySelector("i.ti"))return;const t=Array.from(e.querySelectorAll("a.footer_icon-link[aria-label]"));for(const e of t){const t=(e.getAttribute("aria-label")||"").trim().toLowerCase(),n=$a.get(t);if(!n)continue;const a=e.querySelector("svg");a?(e.insertAdjacentHTML("afterbegin",n),a.remove()):e.insertAdjacentHTML("afterbegin",n)}}(),function(){const e=document.getElementById("time-display");function t(){const t=(new Date).toLocaleTimeString("en-GB",{timeZone:"Europe/London",hour:"numeric",minute:"2-digit",hour12:!0}).toUpperCase();e.textContent=t}e&&(t(),setInterval(t,1e3))}(),function(){try{const e=document.getElementById("cv-gate-trigger");e&&!e.querySelector(".footer-link-nowrap")&&"download bio/cv"===(e.textContent||"").trim().replace(/\s+/g," ").toLowerCase()&&(e.innerHTML='Download <span class="footer-link-nowrap">Bio/CV</span>')}catch(e){}}(),function(){if(J(),"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return console.log("⏸ Sound toggle hidden (prefers-reduced-motion)"),null;Da=document.createElement("button"),Da.className="sound-toggle",Da.id="sound-toggle",Da.type="button",Da.setAttribute("aria-label","Toggle collision sounds"),Da.setAttribute("aria-pressed","false"),Da.setAttribute("data-enabled","false"),Da.innerHTML=Oa,Da.title="Sound off",Da.addEventListener("click",Va);const e=document.getElementById("fade-content"),t=document.getElementById("sound-toggle-slot"),n=document.getElementById("top-elements-soundRow"),a=document.getElementById("social-links"),o=document.querySelector(".ui-meta-right"),i=!!t,s=a&&(!e||e.contains(a)),r="undefined"!=typeof window&&"function"==typeof window.matchMedia&&window.matchMedia("(max-width: 600px)").matches,l=e=>{if(!e)return!1;try{Da.parentElement&&Da.parentElement!==e&&Da.parentElement.removeChild(Da)}catch(e){}if(e.classList.contains("ui-meta-right")){const t=e.querySelector("time");if(t)return e.insertBefore(Da,t),!0}return e.appendChild(Da),!0};if(r&&n)Da.classList.add("sound-toggle--top"),Da.classList.add("sound-toggle--topwide"),l(n);else if(i)Da.classList.add("sound-toggle--top"),l(t);else if(o)l(o);else if(s){const e=document.createElement("li");e.className="margin-bottom_none sound-toggle-item",Da.classList.add("sound-toggle--social"),e.appendChild(Da),a.appendChild(e)}else e?e.appendChild(Da):document.body.appendChild(Da);try{if("undefined"!=typeof window&&"function"==typeof window.matchMedia){const e=window.matchMedia("(max-width: 600px)"),t=()=>{const t=document.getElementById("top-elements-soundRow"),n=document.getElementById("sound-toggle-slot"),a=e.matches&&!!t;Da.classList.toggle("sound-toggle--topwide",a),a?l(t):n&&l(n)};"function"==typeof e.addEventListener?e.addEventListener("change",t):"function"==typeof e.addListener&&e.addListener(t)}}catch(e){}console.log("✓ Sound toggle created");try{const e=ie();Na(!(!e.isUnlocked||!e.isEnabled))}catch(e){}"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(G,e=>{const t=e&&e.detail?e.detail:null;t&&Na(!(!t.isUnlocked||!t.isEnabled))})}(),Lt("✓ Sound toggle button created"),Lt("✓ Theme toggle button created");const s=function(){const e=[t.CRITTERS,t.PIT,t.PIT_THROWS,t.FLIES,t.WEIGHTLESS,t.WATER,t.VORTEX,t.PING_PONG,t.MAGNETIC,t.BUBBLES,t.KALEIDOSCOPE];let n=null;try{n=sessionStorage.getItem("bb:last_start_mode")}catch(e){}const a=n&&e.length>1?e.filter(e=>e!==n):e,o=a[Math.floor(Math.random()*a.length)]||t.CRITTERS;try{sessionStorage.setItem("bb:last_start_mode",o)}catch(e){}return o}();lt(s);try{const e=await Promise.resolve().then(function(){return on});e.updateModeButtonsUI?.(s)}catch(e){}Ft("bb:mode"),Lt("✓ Mode initialized");const r=()=>ct();Ia((e,t)=>{const n=r();n&&n(e,t)}),Ft("bb:end"),Lt("✅ Bouncy Balls running (modular)");const l=[{phase:"config",ms:Ot("bb:m:config","bb:start","bb:config")},{phase:"renderer",ms:Ot("bb:m:renderer","bb:config","bb:renderer")},{phase:"input",ms:Ot("bb:m:input","bb:renderer","bb:input")},{phase:"ui",ms:Ot("bb:m:ui","bb:input","bb:ui")},{phase:"theme",ms:Ot("bb:m:theme","bb:ui","bb:theme")},{phase:"mode+loop",ms:Ot("bb:m:mode","bb:theme","bb:mode")},{phase:"total",ms:Ot("bb:m:total","bb:start","bb:end")}].filter(e=>"number"==typeof e.ms);l.length&&function(e){if(Rt())try{Et.table(e)}catch(e){}}(l.map(e=>({...e,ms:Number(e.ms.toFixed(2))}))),Rt()&&Et.groupEnd();const c=400,d=3e3,f="cubic-bezier(0.16, 1, 0.3, 1)",g=c+d+750,y=(e,t)=>{e.style.opacity="1",console.warn(`⚠️ Fade failsafe: forcing #fade-content visible (${t})`)};setTimeout(()=>{const e=document.getElementById("fade-content");if(!e)return void console.warn("⚠️ #fade-content not found (fade skipped)");if(window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches)return e&&(e.style.opacity="1"),void console.log("✓ Page fade-in skipped (prefers-reduced-motion)");if(e&&"function"!=typeof e.animate)return void y(e,"WAAPI unsupported");const t=(e=>e&&"function"==typeof e.animate?e.animate([{opacity:0},{opacity:1}],{duration:d,easing:f,fill:"forwards"}):null)(e);t?.addEventListener?.("finish",()=>{e&&(e.style.opacity="1"),console.log("✓ Page fade-in finished")}),t?.addEventListener?.("cancel",()=>{e&&y(e,"animation canceled")}),console.log("✓ Page fade-in started (WAAPI)"),setTimeout(()=>{e&&"0"===window.getComputedStyle(e).opacity&&y(e,"opacity still 0 after failsafe window")},g)},c)}catch(e){console.error("❌ Initialization failed:",e),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${e.message}\n${e.stack}</pre>\n    </div>`}}(),e.applyFramePaddingCSSVars=function(){u()},e.applyVisualCSSVars=qa,e}({});
