!(function(e){function t(e){Pa=e}function a(e,t,a,o){const n=+e;return Number.isFinite(n)?Math.min(a,Math.max(t,n)):o}function o(e,t,o,n){const i=a(e,t,o,n);return Math.round(i)}function n(){const e=+ka.layoutViewportWidthPx;return Number.isFinite(e)&&e>0?e:Math.max(1,window.innerWidth||1)}function i(e,t){const a=Math.max(1,t||n()),o=+e;return Number.isFinite(o)?o/a*100:0}function r(e,t){const a=Math.max(1,t||n()),o=+e;return Number.isFinite(o)?o/100*a:0}function l(){const e=n(),t=r(ka.containerBorderVw,e),a=r(ka.simulationPaddingVw,e),o=r(ka.contentPaddingVw,e),i=r(ka.wallRadiusVw,e),l=Math.max(0,Math.round(ka.layoutMinContentPaddingPx||0)),s=Math.max(0,Math.round(ka.layoutMinWallRadiusPx||0)),c=r(Number.isFinite(ka.wallThicknessVw)&&ka.wallThicknessVw>0?ka.wallThicknessVw:ka.containerBorderVw,e),d=ka.isMobile||ka.isMobileViewport?Math.max(.5,ka.mobileWallThicknessXFactor||1):1;ka.containerBorder=Math.round(t),ka.containerBorderX=Math.round(t*d),ka.simulationPadding=Math.round(a),ka.contentPadding=Math.max(l,Math.round(o));const p=Math.max(.1,ka.contentPaddingHorizontalRatio||1);ka.contentPaddingY=ka.contentPadding,ka.contentPaddingX=Math.round(ka.contentPadding*p),ka.wallRadius=Math.max(s,Math.round(i)),ka.cornerRadius=ka.wallRadius,ka.wallThickness=Math.round(c*d);const u=Math.max(0,r(ka.cursorInfluenceRadiusVw||0,e));ka.cursorInfluenceRadiusPx=Math.round(u),ka.repelRadius=Math.round(u),ka.weightlessRepelRadius=Math.round(u),ka.pingPongCursorRadius=Math.round(u),ka.bubblesDeflectRadius=Math.round(u)}function s(){const e=document.documentElement,t=ka.isMobile||ka.isMobileViewport,a=t?Math.max(.5,ka.mobileWallThicknessXFactor||1):1;e.style.setProperty("--container-border",ka.containerBorder+"px"),e.style.setProperty("--container-border-x",ka.containerBorderX+"px"),e.style.setProperty("--container-border-y",ka.containerBorder+"px"),e.style.setProperty("--simulation-padding",ka.simulationPadding+"px"),e.style.setProperty("--content-padding",ka.contentPadding+"px"),e.style.setProperty("--content-padding-x",ka.contentPaddingX+"px"),e.style.setProperty("--content-padding-y",ka.contentPaddingY+"px"),e.style.setProperty("--wall-radius",ka.wallRadius+"px"),e.style.setProperty("--wall-thickness",ka.wallThickness+"px");const o=ka.containerBorderVw||1.3;e.style.setProperty("--container-border-vw",""+o),e.style.setProperty("--container-border-x-vw",""+o*a),e.style.setProperty("--wall-thickness-vw",""+(Number.isFinite(ka.wallThicknessVw)&&ka.wallThicknessVw>0?ka.wallThicknessVw:ka.containerBorderVw)*a);const n=ka.edgeLabelInsetAdjustPx||0;e.style.setProperty("--edge-label-inset",ka.containerBorder+8+n+"px"),e.style.setProperty("--edge-label-inset-adjust",n+"px"),e.style.setProperty("--edge-label-mobile-display",t&&ka.mobileEdgeLabelsVisible?"flex":"none")}function c(e){if(ka.config={...e},void 0!==e.layoutViewportWidthPx&&(ka.layoutViewportWidthPx=a(e.layoutViewportWidthPx,0,4096,0)),e.ballMass&&(ka.ballMassKg=e.ballMass),void 0!==e.gravityMultiplier&&(ka.gravityMultiplier=e.gravityMultiplier,ka.gravityMultiplierPit=e.gravityMultiplier),e.restitution&&(ka.REST=e.restitution),e.friction&&(ka.FRICTION=e.friction),void 0!==e.ballScale&&(ka.sizeScale=e.ballScale),void 0!==e.sizeScale&&(ka.sizeScale=e.sizeScale),void 0!==e.sizeVariationGlobalMul&&(ka.sizeVariationGlobalMul=a(e.sizeVariationGlobalMul,0,2,ka.sizeVariationGlobalMul)),void 0!==e.sizeVariationPit&&(ka.sizeVariationPit=a(e.sizeVariationPit,0,1,ka.sizeVariationPit)),void 0!==e.sizeVariationPitThrows&&(ka.sizeVariationPitThrows=a(e.sizeVariationPitThrows,0,1,ka.sizeVariationPitThrows)),void 0!==e.sizeVariationFlies&&(ka.sizeVariationFlies=a(e.sizeVariationFlies,0,1,ka.sizeVariationFlies)),void 0!==e.sizeVariationWeightless&&(ka.sizeVariationWeightless=a(e.sizeVariationWeightless,0,1,ka.sizeVariationWeightless)),void 0!==e.sizeVariationWater&&(ka.sizeVariationWater=a(e.sizeVariationWater,0,1,ka.sizeVariationWater)),void 0!==e.sizeVariationVortex&&(ka.sizeVariationVortex=a(e.sizeVariationVortex,0,1,ka.sizeVariationVortex)),void 0!==e.sizeVariationPingPong&&(ka.sizeVariationPingPong=a(e.sizeVariationPingPong,0,1,ka.sizeVariationPingPong)),void 0!==e.sizeVariationMagnetic&&(ka.sizeVariationMagnetic=a(e.sizeVariationMagnetic,0,1,ka.sizeVariationMagnetic)),void 0!==e.sizeVariationBubbles&&(ka.sizeVariationBubbles=a(e.sizeVariationBubbles,0,1,ka.sizeVariationBubbles)),void 0!==e.sizeVariationKaleidoscope&&(ka.sizeVariationKaleidoscope=a(e.sizeVariationKaleidoscope,0,1,ka.sizeVariationKaleidoscope)),void 0!==e.sizeVariationOrbit3d&&(ka.sizeVariationOrbit3d=a(e.sizeVariationOrbit3d,0,1,ka.sizeVariationOrbit3d)),void 0!==e.sizeVariationCritters&&(ka.sizeVariationCritters=a(e.sizeVariationCritters,0,1,ka.sizeVariationCritters)),void 0!==e.sizeVariationNeural&&(ka.sizeVariationNeural=a(e.sizeVariationNeural,0,1,ka.sizeVariationNeural)),void 0!==e.sizeVariationLattice&&(ka.sizeVariationLattice=a(e.sizeVariationLattice,0,1,ka.sizeVariationLattice)),void 0!==e.sizeVariationParallaxLinear&&(ka.sizeVariationParallaxLinear=a(e.sizeVariationParallaxLinear,0,1,ka.sizeVariationParallaxLinear)),void 0!==e.sizeVariationParallaxPerspective&&(ka.sizeVariationParallaxPerspective=a(e.sizeVariationParallaxPerspective,0,1,ka.sizeVariationParallaxPerspective)),void 0!==e.sizeVariation&&(ka.sizeVariation=e.sizeVariation),void 0!==e.pitWarmupFrames&&(ka.pitWarmupFrames=o(e.pitWarmupFrames,0,240,ka.pitWarmupFrames)),void 0!==e.pitThrowsWarmupFrames&&(ka.pitThrowsWarmupFrames=o(e.pitThrowsWarmupFrames,0,240,ka.pitThrowsWarmupFrames)),void 0!==e.fliesWarmupFrames&&(ka.fliesWarmupFrames=o(e.fliesWarmupFrames,0,240,ka.fliesWarmupFrames)),void 0!==e.weightlessWarmupFrames&&(ka.weightlessWarmupFrames=o(e.weightlessWarmupFrames,0,240,ka.weightlessWarmupFrames)),void 0!==e.waterWarmupFrames&&(ka.waterWarmupFrames=o(e.waterWarmupFrames,0,240,ka.waterWarmupFrames)),void 0!==e.vortexWarmupFrames&&(ka.vortexWarmupFrames=o(e.vortexWarmupFrames,0,240,ka.vortexWarmupFrames)),void 0!==e.pingPongWarmupFrames&&(ka.pingPongWarmupFrames=o(e.pingPongWarmupFrames,0,240,ka.pingPongWarmupFrames)),void 0!==e.magneticWarmupFrames&&(ka.magneticWarmupFrames=o(e.magneticWarmupFrames,0,240,ka.magneticWarmupFrames)),void 0!==e.bubblesWarmupFrames&&(ka.bubblesWarmupFrames=o(e.bubblesWarmupFrames,0,240,ka.bubblesWarmupFrames)),void 0!==e.kaleidoscopeWarmupFrames&&(ka.kaleidoscopeWarmupFrames=o(e.kaleidoscopeWarmupFrames,0,240,ka.kaleidoscopeWarmupFrames)),void 0!==e.kaleidoscope1WarmupFrames&&(ka.kaleidoscope1WarmupFrames=o(e.kaleidoscope1WarmupFrames,0,240,ka.kaleidoscope1WarmupFrames)),void 0!==e.kaleidoscope2WarmupFrames&&(ka.kaleidoscope2WarmupFrames=o(e.kaleidoscope2WarmupFrames,0,240,ka.kaleidoscope2WarmupFrames)),void 0!==e.kaleidoscope3WarmupFrames&&(ka.kaleidoscope3WarmupFrames=o(e.kaleidoscope3WarmupFrames,0,240,ka.kaleidoscope3WarmupFrames)),void 0!==e.orbit3dWarmupFrames&&(ka.orbit3dWarmupFrames=o(e.orbit3dWarmupFrames,0,240,ka.orbit3dWarmupFrames)),void 0!==e.orbit3d2WarmupFrames&&(ka.orbit3d2WarmupFrames=o(e.orbit3d2WarmupFrames,0,240,ka.orbit3d2WarmupFrames)),void 0!==e.crittersWarmupFrames&&(ka.crittersWarmupFrames=o(e.crittersWarmupFrames,0,240,ka.crittersWarmupFrames)),void 0!==e.neuralWarmupFrames&&(ka.neuralWarmupFrames=o(e.neuralWarmupFrames,0,240,ka.neuralWarmupFrames)),void 0!==e.latticeWarmupFrames&&(ka.latticeWarmupFrames=o(e.latticeWarmupFrames,0,240,ka.latticeWarmupFrames)),void 0!==e.parallaxLinearWarmupFrames&&(ka.parallaxLinearWarmupFrames=o(e.parallaxLinearWarmupFrames,0,240,ka.parallaxLinearWarmupFrames)),void 0!==e.parallaxPerspectiveWarmupFrames&&(ka.parallaxPerspectiveWarmupFrames=o(e.parallaxPerspectiveWarmupFrames,0,240,ka.parallaxPerspectiveWarmupFrames)),g(),void 0!==e.maxBalls&&(ka.maxBalls=e.maxBalls),void 0!==e.repelRadius&&(ka.repelRadius=e.repelRadius),void 0!==e.repelPower&&(ka.repelPower=e.repelPower),void 0!==e.repelSoft&&(ka.repelSoft=e.repelSoft),void 0!==e.repelSoftness&&(ka.repelSoft=e.repelSoftness),void 0!==e.cursorInfluenceRadiusVw?ka.cursorInfluenceRadiusVw=a(e.cursorInfluenceRadiusVw,0,80,ka.cursorInfluenceRadiusVw):void 0!==e.repelRadius&&(ka.cursorInfluenceRadiusVw=a(e.repelRadius/10,0,80,ka.cursorInfluenceRadiusVw)),void 0!==e.responsiveScaleMobile&&(ka.responsiveScaleMobile=e.responsiveScaleMobile),void 0!==e.mobileObjectReductionFactor&&(ka.mobileObjectReductionFactor=a(e.mobileObjectReductionFactor,0,1,ka.mobileObjectReductionFactor)),m(),void 0!==e.kaleidoscopeBallCount&&(ka.kaleidoscopeBallCount=a(e.kaleidoscopeBallCount,10,300,ka.kaleidoscopeBallCount)),void 0!==e.kaleidoscopeDotSizeVh&&(ka.kaleidoscopeDotSizeVh=a(e.kaleidoscopeDotSizeVh,.1,6,ka.kaleidoscopeDotSizeVh)),void 0!==e.kaleidoscopeDotAreaMul&&(ka.kaleidoscopeDotAreaMul=a(e.kaleidoscopeDotAreaMul,.1,2,ka.kaleidoscopeDotAreaMul)),void 0!==e.kaleidoscopeSpawnAreaMul&&(ka.kaleidoscopeSpawnAreaMul=a(e.kaleidoscopeSpawnAreaMul,.2,2,ka.kaleidoscopeSpawnAreaMul)),void 0!==e.kaleidoscopeSizeVariance&&(ka.kaleidoscopeSizeVariance=a(e.kaleidoscopeSizeVariance,0,1,ka.kaleidoscopeSizeVariance)),void 0!==e.kaleidoscope1BallCount&&(ka.kaleidoscope1BallCount=a(e.kaleidoscope1BallCount,3,300,ka.kaleidoscope1BallCount)),void 0!==e.kaleidoscope1Wedges&&(ka.kaleidoscope1Wedges=a(e.kaleidoscope1Wedges,3,24,ka.kaleidoscope1Wedges)),void 0!==e.kaleidoscope1Speed&&(ka.kaleidoscope1Speed=a(e.kaleidoscope1Speed,.2,2,ka.kaleidoscope1Speed)),void 0!==e.kaleidoscope1DotSizeVh&&(ka.kaleidoscope1DotSizeVh=a(e.kaleidoscope1DotSizeVh,.1,6,ka.kaleidoscope1DotSizeVh)),void 0!==e.kaleidoscope1DotAreaMul&&(ka.kaleidoscope1DotAreaMul=a(e.kaleidoscope1DotAreaMul,.1,2,ka.kaleidoscope1DotAreaMul)),void 0!==e.kaleidoscope1SpawnAreaMul&&(ka.kaleidoscope1SpawnAreaMul=a(e.kaleidoscope1SpawnAreaMul,.2,2,ka.kaleidoscope1SpawnAreaMul)),void 0!==e.kaleidoscope1SizeVariance&&(ka.kaleidoscope1SizeVariance=a(e.kaleidoscope1SizeVariance,0,1,ka.kaleidoscope1SizeVariance)),void 0!==e.kaleidoscope2BallCount&&(ka.kaleidoscope2BallCount=a(e.kaleidoscope2BallCount,3,300,ka.kaleidoscope2BallCount)),void 0!==e.kaleidoscope2Wedges&&(ka.kaleidoscope2Wedges=a(e.kaleidoscope2Wedges,3,24,ka.kaleidoscope2Wedges)),void 0!==e.kaleidoscope2Speed&&(ka.kaleidoscope2Speed=a(e.kaleidoscope2Speed,.2,2,ka.kaleidoscope2Speed)),void 0!==e.kaleidoscope2DotSizeVh&&(ka.kaleidoscope2DotSizeVh=a(e.kaleidoscope2DotSizeVh,.1,6,ka.kaleidoscope2DotSizeVh)),void 0!==e.kaleidoscope2DotAreaMul&&(ka.kaleidoscope2DotAreaMul=a(e.kaleidoscope2DotAreaMul,.1,2,ka.kaleidoscope2DotAreaMul)),void 0!==e.kaleidoscope2SpawnAreaMul&&(ka.kaleidoscope2SpawnAreaMul=a(e.kaleidoscope2SpawnAreaMul,.2,2,ka.kaleidoscope2SpawnAreaMul)),void 0!==e.kaleidoscope2SizeVariance&&(ka.kaleidoscope2SizeVariance=a(e.kaleidoscope2SizeVariance,0,1,ka.kaleidoscope2SizeVariance)),void 0!==e.kaleidoscope3BallCount&&(ka.kaleidoscope3BallCount=a(e.kaleidoscope3BallCount,3,300,ka.kaleidoscope3BallCount)),void 0!==e.kaleidoscope3Wedges&&(ka.kaleidoscope3Wedges=a(e.kaleidoscope3Wedges,3,24,ka.kaleidoscope3Wedges)),void 0!==e.kaleidoscope3Speed&&(ka.kaleidoscope3Speed=a(e.kaleidoscope3Speed,.2,2,ka.kaleidoscope3Speed)),void 0!==e.kaleidoscope3DotSizeVh&&(ka.kaleidoscope3DotSizeVh=a(e.kaleidoscope3DotSizeVh,.1,6,ka.kaleidoscope3DotSizeVh)),void 0!==e.kaleidoscope3DotAreaMul&&(ka.kaleidoscope3DotAreaMul=a(e.kaleidoscope3DotAreaMul,.1,2,ka.kaleidoscope3DotAreaMul)),void 0!==e.kaleidoscope3SpawnAreaMul&&(ka.kaleidoscope3SpawnAreaMul=a(e.kaleidoscope3SpawnAreaMul,.2,2,ka.kaleidoscope3SpawnAreaMul)),void 0!==e.kaleidoscope3SizeVariance&&(ka.kaleidoscope3SizeVariance=a(e.kaleidoscope3SizeVariance,0,1,ka.kaleidoscope3SizeVariance)),void 0!==e.kaleidoscopeWedges?ka.kaleidoscopeWedges=a(e.kaleidoscopeWedges,3,24,ka.kaleidoscopeWedges):void 0!==e.kaleidoscopeSegments&&(ka.kaleidoscopeWedges=a(e.kaleidoscopeSegments,3,24,ka.kaleidoscopeWedges)),void 0!==e.kaleidoscopeMirror&&(ka.kaleidoscopeMirror=a(e.kaleidoscopeMirror,0,1,ka.kaleidoscopeMirror)),void 0!==e.kaleidoscopeSpeed)ka.kaleidoscopeSpeed=a(e.kaleidoscopeSpeed,.2,2,ka.kaleidoscopeSpeed);else if(void 0!==e.kaleidoscopeSwirlStrength){const t=a(e.kaleidoscopeSwirlStrength,0,800,52);ka.kaleidoscopeSpeed=a(.2+t/800*1.8,.2,2,ka.kaleidoscopeSpeed)}void 0!==e.critterCount&&(ka.critterCount=e.critterCount),void 0!==e.critterSpeed&&(ka.critterSpeed=e.critterSpeed),void 0!==e.critterMaxSpeed&&(ka.critterMaxSpeed=e.critterMaxSpeed),void 0!==e.critterStepHz&&(ka.critterStepHz=e.critterStepHz),void 0!==e.critterStepSharpness&&(ka.critterStepSharpness=e.critterStepSharpness),void 0!==e.critterTurnNoise&&(ka.critterTurnNoise=e.critterTurnNoise),void 0!==e.critterTurnDamp&&(ka.critterTurnDamp=e.critterTurnDamp),void 0!==e.critterTurnSeek&&(ka.critterTurnSeek=e.critterTurnSeek),void 0!==e.critterAvoidRadius&&(ka.critterAvoidRadius=e.critterAvoidRadius),void 0!==e.critterAvoidForce&&(ka.critterAvoidForce=e.critterAvoidForce),void 0!==e.critterEdgeAvoid&&(ka.critterEdgeAvoid=e.critterEdgeAvoid),void 0!==e.critterMousePull&&(ka.critterMousePull=e.critterMousePull),void 0!==e.layoutMinContentPaddingPx&&(ka.layoutMinContentPaddingPx=a(e.layoutMinContentPaddingPx,0,200,ka.layoutMinContentPaddingPx)),void 0!==e.layoutMinWallRadiusPx&&(ka.layoutMinWallRadiusPx=a(e.layoutMinWallRadiusPx,0,400,ka.layoutMinWallRadiusPx)),void 0!==e.critterMouseRadiusVw&&(ka.critterMouseRadiusVw=e.critterMouseRadiusVw),void 0!==e.critterRestitution&&(ka.critterRestitution=e.critterRestitution),void 0!==e.critterFriction&&(ka.critterFriction=e.critterFriction),void 0!==e.neuralBallCount&&(ka.neuralBallCount=a(e.neuralBallCount,8,260,ka.neuralBallCount)),void 0!==e.neuralLinkDistanceVw&&(ka.neuralLinkDistanceVw=a(e.neuralLinkDistanceVw,1,50,ka.neuralLinkDistanceVw)),void 0!==e.neuralLineOpacity&&(ka.neuralLineOpacity=a(e.neuralLineOpacity,0,1,ka.neuralLineOpacity)),void 0!==e.neuralWanderStrength&&(ka.neuralWanderStrength=a(e.neuralWanderStrength,0,4e3,ka.neuralWanderStrength)),void 0!==e.neuralMaxLinksPerBall&&(ka.neuralMaxLinksPerBall=a(e.neuralMaxLinksPerBall,0,16,ka.neuralMaxLinksPerBall)),void 0!==e.neuralDamping&&(ka.neuralDamping=a(e.neuralDamping,.8,1,ka.neuralDamping)),void 0!==e.latticeBallCount&&(ka.latticeBallCount=a(e.latticeBallCount,8,260,ka.latticeBallCount)),void 0!==e.latticeSpacingVw&&(ka.latticeSpacingVw=a(e.latticeSpacingVw,1,40,ka.latticeSpacingVw)),void 0!==e.latticeStiffness&&(ka.latticeStiffness=a(e.latticeStiffness,0,20,ka.latticeStiffness)),void 0!==e.latticeDamping&&(ka.latticeDamping=a(e.latticeDamping,.5,1,ka.latticeDamping)),void 0!==e.latticeDisruptRadius&&(ka.latticeDisruptRadius=a(e.latticeDisruptRadius,50,800,ka.latticeDisruptRadius)),void 0!==e.latticeDisruptPower&&(ka.latticeDisruptPower=a(e.latticeDisruptPower,0,20,ka.latticeDisruptPower)),void 0!==e.latticeMeshWaveStrength&&(ka.latticeMeshWaveStrength=a(e.latticeMeshWaveStrength,0,50,ka.latticeMeshWaveStrength)),void 0!==e.latticeMeshWaveSpeed&&(ka.latticeMeshWaveSpeed=a(e.latticeMeshWaveSpeed,0,3,ka.latticeMeshWaveSpeed)),void 0!==e.latticeAlignment&&(ka.latticeAlignment=e.latticeAlignment+""),void 0!==e.parallaxLinearDotCount&&(ka.parallaxLinearDotCount=a(e.parallaxLinearDotCount,20,220,ka.parallaxLinearDotCount)),void 0!==e.parallaxLinearGridJitter&&(ka.parallaxLinearGridJitter=a(e.parallaxLinearGridJitter,0,1,ka.parallaxLinearGridJitter)),void 0!==e.parallaxLinearFarSpeed&&(ka.parallaxLinearFarSpeed=a(e.parallaxLinearFarSpeed,0,1.5,ka.parallaxLinearFarSpeed)),void 0!==e.parallaxLinearMidSpeed&&(ka.parallaxLinearMidSpeed=a(e.parallaxLinearMidSpeed,0,1.5,ka.parallaxLinearMidSpeed)),void 0!==e.parallaxLinearNearSpeed&&(ka.parallaxLinearNearSpeed=a(e.parallaxLinearNearSpeed,0,1.5,ka.parallaxLinearNearSpeed)),void 0!==e.parallaxLinearGridX&&(ka.parallaxLinearGridX=o(e.parallaxLinearGridX,3,40,ka.parallaxLinearGridX)),void 0!==e.parallaxLinearGridY&&(ka.parallaxLinearGridY=o(e.parallaxLinearGridY,3,40,ka.parallaxLinearGridY)),void 0!==e.parallaxLinearGridZ&&(ka.parallaxLinearGridZ=o(e.parallaxLinearGridZ,2,20,ka.parallaxLinearGridZ)),void 0!==e.parallaxLinearSpanX&&(ka.parallaxLinearSpanX=a(e.parallaxLinearSpanX,.2,3,ka.parallaxLinearSpanX)),void 0!==e.parallaxLinearSpanY&&(ka.parallaxLinearSpanY=a(e.parallaxLinearSpanY,.2,3,ka.parallaxLinearSpanY)),void 0!==e.parallaxLinearZNear&&(ka.parallaxLinearZNear=a(e.parallaxLinearZNear,10,1200,ka.parallaxLinearZNear)),void 0!==e.parallaxLinearZFar&&(ka.parallaxLinearZFar=a(e.parallaxLinearZFar,50,3e3,ka.parallaxLinearZFar)),void 0!==e.parallaxLinearFocalLength&&(ka.parallaxLinearFocalLength=a(e.parallaxLinearFocalLength,80,2e3,ka.parallaxLinearFocalLength)),void 0!==e.parallaxLinearParallaxStrength&&(ka.parallaxLinearParallaxStrength=a(e.parallaxLinearParallaxStrength,0,2e3,ka.parallaxLinearParallaxStrength)),void 0!==e.parallaxLinearDotSizeMul&&(ka.parallaxLinearDotSizeMul=a(e.parallaxLinearDotSizeMul,.1,6,ka.parallaxLinearDotSizeMul)),void 0!==e.parallaxLinearFollowStrength&&(ka.parallaxLinearFollowStrength=a(e.parallaxLinearFollowStrength,1,80,ka.parallaxLinearFollowStrength)),void 0!==e.parallaxLinearDamping&&(ka.parallaxLinearDamping=a(e.parallaxLinearDamping,1,80,ka.parallaxLinearDamping)),void 0!==e.parallaxPerspectiveDotCount&&(ka.parallaxPerspectiveDotCount=a(e.parallaxPerspectiveDotCount,40,420,ka.parallaxPerspectiveDotCount)),void 0!==e.parallaxPerspectiveDepthMul&&(ka.parallaxPerspectiveDepthMul=a(e.parallaxPerspectiveDepthMul,.5,3,ka.parallaxPerspectiveDepthMul)),void 0!==e.parallaxPerspectiveFocalLength&&(ka.parallaxPerspectiveFocalLength=a(e.parallaxPerspectiveFocalLength,80,1e3,ka.parallaxPerspectiveFocalLength)),void 0!==e.parallaxPerspectiveFollowStrength&&(ka.parallaxPerspectiveFollowStrength=a(e.parallaxPerspectiveFollowStrength,1,40,ka.parallaxPerspectiveFollowStrength)),void 0!==e.parallaxPerspectiveDamping&&(ka.parallaxPerspectiveDamping=a(e.parallaxPerspectiveDamping,1,40,ka.parallaxPerspectiveDamping)),void 0!==e.parallaxPerspectiveZ1&&(ka.parallaxPerspectiveZ1=a(e.parallaxPerspectiveZ1,200,2e3,ka.parallaxPerspectiveZ1)),void 0!==e.parallaxPerspectiveZ2&&(ka.parallaxPerspectiveZ2=a(e.parallaxPerspectiveZ2,150,1500,ka.parallaxPerspectiveZ2)),void 0!==e.parallaxPerspectiveZ3&&(ka.parallaxPerspectiveZ3=a(e.parallaxPerspectiveZ3,100,1e3,ka.parallaxPerspectiveZ3)),void 0!==e.parallaxPerspectiveZ4&&(ka.parallaxPerspectiveZ4=a(e.parallaxPerspectiveZ4,40,600,ka.parallaxPerspectiveZ4)),void 0!==e.parallaxPerspectiveZ5&&(ka.parallaxPerspectiveZ5=a(e.parallaxPerspectiveZ5,10,300,ka.parallaxPerspectiveZ5)),void 0!==e.parallaxPerspectiveGridX&&(ka.parallaxPerspectiveGridX=o(e.parallaxPerspectiveGridX,3,50,ka.parallaxPerspectiveGridX)),void 0!==e.parallaxPerspectiveGridY&&(ka.parallaxPerspectiveGridY=o(e.parallaxPerspectiveGridY,3,50,ka.parallaxPerspectiveGridY)),void 0!==e.parallaxPerspectiveGridZ&&(ka.parallaxPerspectiveGridZ=o(e.parallaxPerspectiveGridZ,2,25,ka.parallaxPerspectiveGridZ)),void 0!==e.parallaxPerspectiveSpanX&&(ka.parallaxPerspectiveSpanX=a(e.parallaxPerspectiveSpanX,.2,3,ka.parallaxPerspectiveSpanX)),void 0!==e.parallaxPerspectiveSpanY&&(ka.parallaxPerspectiveSpanY=a(e.parallaxPerspectiveSpanY,.2,3,ka.parallaxPerspectiveSpanY)),void 0!==e.parallaxPerspectiveZNear&&(ka.parallaxPerspectiveZNear=a(e.parallaxPerspectiveZNear,10,1200,ka.parallaxPerspectiveZNear)),void 0!==e.parallaxPerspectiveZFar&&(ka.parallaxPerspectiveZFar=a(e.parallaxPerspectiveZFar,50,4e3,ka.parallaxPerspectiveZFar)),void 0!==e.parallaxPerspectiveParallaxStrength&&(ka.parallaxPerspectiveParallaxStrength=a(e.parallaxPerspectiveParallaxStrength,0,2e3,ka.parallaxPerspectiveParallaxStrength)),void 0!==e.parallaxPerspectiveRandomness&&(ka.parallaxPerspectiveRandomness=a(e.parallaxPerspectiveRandomness,0,1,ka.parallaxPerspectiveRandomness)),void 0!==e.parallaxPerspectiveDotSizeMul&&(ka.parallaxPerspectiveDotSizeMul=a(e.parallaxPerspectiveDotSizeMul,.1,6,ka.parallaxPerspectiveDotSizeMul));for(const[a,o]of Object.entries(e||{}))a in ka&&"config"!==a&&"soundConfig"!==a&&"soundPreset"!==a&&"function"!=typeof ka[a]&&(Array.isArray(o)||null===o||["string","number","boolean"].includes(typeof o))&&void 0!==o&&(ka[a]=o);void 0!==e.sceneImpactEnabled&&(ka.sceneImpactEnabled=!!e.sceneImpactEnabled),void 0!==e.sceneImpactMul?ka.sceneImpactMul=a(e.sceneImpactMul,0,.05,ka.sceneImpactMul):void 0!==e.brandLogoImpactMul&&(ka.sceneImpactMul=a(e.brandLogoImpactMul,0,.05,ka.sceneImpactMul)),void 0!==e.sceneImpactMobileMulFactor&&(ka.sceneImpactMobileMulFactor=a(e.sceneImpactMobileMulFactor,.25,3,ka.sceneImpactMobileMulFactor)),void 0!==e.sceneImpactOvershoot?ka.sceneImpactOvershoot=a(e.sceneImpactOvershoot,0,.8,ka.sceneImpactOvershoot):void 0!==e.brandLogoOvershoot&&(ka.sceneImpactOvershoot=a(e.brandLogoOvershoot,0,.8,ka.sceneImpactOvershoot)),void 0!==e.sceneImpactAnticipation?ka.sceneImpactAnticipation=a(e.sceneImpactAnticipation,0,.6,ka.sceneImpactAnticipation):void 0!==e.brandLogoAnticipation&&(ka.sceneImpactAnticipation=a(e.brandLogoAnticipation,0,.6,ka.sceneImpactAnticipation)),void 0!==e.sceneImpactPressMs?ka.sceneImpactPressMs=a(e.sceneImpactPressMs,20,300,ka.sceneImpactPressMs):void 0!==e.brandLogoPressMs&&(ka.sceneImpactPressMs=a(e.brandLogoPressMs,20,300,ka.sceneImpactPressMs)),void 0!==e.sceneImpactReleaseMs?ka.sceneImpactReleaseMs=a(e.sceneImpactReleaseMs,40,1200,ka.sceneImpactReleaseMs):void 0!==e.brandLogoReleaseMs&&(ka.sceneImpactReleaseMs=a(e.brandLogoReleaseMs,40,1200,ka.sceneImpactReleaseMs)),void 0!==e.sceneChangeSoundEnabled&&(ka.sceneChangeSoundEnabled=!!e.sceneChangeSoundEnabled),void 0!==e.sceneChangeSoundIntensity&&(ka.sceneChangeSoundIntensity=a(e.sceneChangeSoundIntensity,0,1,ka.sceneChangeSoundIntensity)),void 0!==e.sceneChangeSoundRadius&&(ka.sceneChangeSoundRadius=a(e.sceneChangeSoundRadius,6,60,ka.sceneChangeSoundRadius)),void 0!==e.containerBorder&&(ka.containerBorder=e.containerBorder),void 0!==e.simulationPadding&&(ka.simulationPadding=e.simulationPadding),void 0!==e.contentPadding&&(ka.contentPadding=e.contentPadding),void 0!==e.bgLight&&(ka.bgLight=e.bgLight),void 0!==e.bgDark&&(ka.bgDark=e.bgDark),void 0!==e.frameColor&&(ka.frameColor=e.frameColor),void 0!==e.textColorLight&&(ka.textColorLight=e.textColorLight),void 0!==e.textColorLightMuted&&(ka.textColorLightMuted=e.textColorLightMuted),void 0!==e.textColorDark&&(ka.textColorDark=e.textColorDark),void 0!==e.textColorDarkMuted&&(ka.textColorDarkMuted=e.textColorDarkMuted),void 0!==e.edgeLabelColorLight&&(ka.edgeLabelColorLight=e.edgeLabelColorLight),void 0!==e.edgeLabelColorDark&&(ka.edgeLabelColorDark=e.edgeLabelColorDark),void 0!==e.edgeLabelInsetAdjustPx&&(ka.edgeLabelInsetAdjustPx=a(e.edgeLabelInsetAdjustPx,-500,500,ka.edgeLabelInsetAdjustPx)),void 0!==e.linkHoverColor&&(ka.linkHoverColor=e.linkHoverColor),void 0!==e.logoColorLight&&(ka.logoColorLight=e.logoColorLight),void 0!==e.logoColorDark&&(ka.logoColorDark=e.logoColorDark),void 0!==e.noiseBackOpacity&&(ka.noiseBackOpacity=a(e.noiseBackOpacity,0,.3,ka.noiseBackOpacity)),void 0!==e.noiseFrontOpacity&&(ka.noiseFrontOpacity=a(e.noiseFrontOpacity,0,.3,ka.noiseFrontOpacity)),void 0!==e.noiseBackOpacityDark&&(ka.noiseBackOpacityDark=a(e.noiseBackOpacityDark,0,.5,ka.noiseBackOpacityDark)),void 0!==e.noiseFrontOpacityDark&&(ka.noiseFrontOpacityDark=a(e.noiseFrontOpacityDark,0,.5,ka.noiseFrontOpacityDark)),void 0!==e.wallThickness&&(ka.wallThickness=e.wallThickness),void 0!==e.wallRadius&&(ka.wallRadius=e.wallRadius,ka.cornerRadius=e.wallRadius),void 0!==e.wallInset&&(ka.wallInset=e.wallInset),void 0!==e.wallInset&&(ka.wallInset=e.wallInset),void 0!==e.ballSpacing&&(ka.ballSpacing=e.ballSpacing),void 0!==e.wallPreset&&(ka.wallPreset=e.wallPreset),void 0!==e.wallSoftness&&(ka.wallSoftness=e.wallSoftness),void 0!==e.wallBounciness&&(ka.wallBounciness=e.wallBounciness),void 0!==e.wallWobbleMaxDeform&&(ka.wallWobbleMaxDeform=e.wallWobbleMaxDeform),void 0!==e.wallWobbleStiffness&&(ka.wallWobbleStiffness=e.wallWobbleStiffness),void 0!==e.wallWobbleDamping&&(ka.wallWobbleDamping=e.wallWobbleDamping),void 0!==e.wallWobbleSigma&&(ka.wallWobbleSigma=e.wallWobbleSigma),void 0!==e.wallWobbleCornerClamp&&(ka.wallWobbleCornerClamp=e.wallWobbleCornerClamp),void 0!==e.wallWobbleImpactThreshold&&(ka.wallWobbleImpactThreshold=e.wallWobbleImpactThreshold),void 0!==e.wallWobbleSettlingSpeed&&(ka.wallWobbleSettlingSpeed=e.wallWobbleSettlingSpeed),void 0!==e.gateOverlayEnabled&&(ka.gateOverlayEnabled=e.gateOverlayEnabled),void 0!==e.gateOverlayOpacity&&(ka.gateOverlayOpacity=e.gateOverlayOpacity),void 0!==e.gateOverlayBlurPx&&(ka.gateOverlayBlurPx=e.gateOverlayBlurPx),void 0!==e.gateOverlayTransitionMs&&(ka.gateOverlayTransitionMs=e.gateOverlayTransitionMs),void 0!==e.gateOverlayTransitionOutMs&&(ka.gateOverlayTransitionOutMs=e.gateOverlayTransitionOutMs),void 0!==e.orbit3dMoonCount&&(ka.orbit3dMoonCount=a(e.orbit3dMoonCount,1,1e3,ka.orbit3dMoonCount)),void 0!==e.orbit3dGravity&&(ka.orbit3dGravity=a(e.orbit3dGravity,1e3,5e5,ka.orbit3dGravity)),void 0!==e.orbit3dMoonMass&&(ka.orbit3dMoonMass=a(e.orbit3dMoonMass,.1,100,ka.orbit3dMoonMass)),void 0!==e.orbit3dVelocityMult&&(ka.orbit3dVelocityMult=a(e.orbit3dVelocityMult,10,1e3,ka.orbit3dVelocityMult)),void 0!==e.orbit3dTargetOrbit&&(ka.orbit3dTargetOrbit=a(e.orbit3dTargetOrbit,1,100,ka.orbit3dTargetOrbit)),void 0!==e.orbit3dMinOrbit&&(ka.orbit3dMinOrbit=a(e.orbit3dMinOrbit,1,100,ka.orbit3dMinOrbit)),void 0!==e.orbit3dMaxOrbit&&(ka.orbit3dMaxOrbit=a(e.orbit3dMaxOrbit,1,200,ka.orbit3dMaxOrbit)),void 0!==e.orbit3dDepthScale&&(ka.orbit3dDepthScale=a(e.orbit3dDepthScale,0,1.5,ka.orbit3dDepthScale)),void 0!==e.orbit3dDamping&&(ka.orbit3dDamping=a(e.orbit3dDamping,.01,.2,ka.orbit3dDamping)),void 0!==e.orbit3d2MoonCount&&(ka.orbit3d2MoonCount=a(e.orbit3d2MoonCount,1,300,ka.orbit3d2MoonCount)),void 0!==e.orbit3d2Gravity&&(ka.orbit3d2Gravity=a(e.orbit3d2Gravity,1e3,5e5,ka.orbit3d2Gravity)),void 0!==e.orbit3d2VelocityMult&&(ka.orbit3d2VelocityMult=a(e.orbit3d2VelocityMult,.1,2,ka.orbit3d2VelocityMult)),void 0!==e.orbit3d2MinOrbit&&(ka.orbit3d2MinOrbit=a(e.orbit3d2MinOrbit,1,50,ka.orbit3d2MinOrbit)),void 0!==e.orbit3d2MaxOrbit&&(ka.orbit3d2MaxOrbit=a(e.orbit3d2MaxOrbit,1,50,ka.orbit3d2MaxOrbit)),void 0!==e.orbit3d2DepthScale&&(ka.orbit3d2DepthScale=a(e.orbit3d2DepthScale,0,.95,ka.orbit3d2DepthScale)),void 0!==e.orbit3d2Damping&&(ka.orbit3d2Damping=a(e.orbit3d2Damping,0,1,ka.orbit3d2Damping)),void 0!==e.orbit3d2FollowSmoothing&&(ka.orbit3d2FollowSmoothing=a(e.orbit3d2FollowSmoothing,1,200,ka.orbit3d2FollowSmoothing)),void 0!==e.orbit3d2Softening&&(ka.orbit3d2Softening=a(e.orbit3d2Softening,1,100,ka.orbit3d2Softening));const t=n();void 0!==e.containerBorderVw&&(ka.containerBorderVw=a(e.containerBorderVw,0,20,ka.containerBorderVw)),void 0!==e.simulationPaddingVw&&(ka.simulationPaddingVw=a(e.simulationPaddingVw,0,20,ka.simulationPaddingVw)),void 0!==e.contentPaddingVw&&(ka.contentPaddingVw=a(e.contentPaddingVw,0,40,ka.contentPaddingVw)),void 0!==e.contentPaddingHorizontalRatio&&(ka.contentPaddingHorizontalRatio=a(e.contentPaddingHorizontalRatio,.1,3,ka.contentPaddingHorizontalRatio)),void 0!==e.mobileWallThicknessXFactor&&(ka.mobileWallThicknessXFactor=a(e.mobileWallThicknessXFactor,.5,3,ka.mobileWallThicknessXFactor)),void 0!==e.mobileEdgeLabelsVisible&&(ka.mobileEdgeLabelsVisible=!!e.mobileEdgeLabelsVisible),void 0!==e.wallRadiusVw&&(ka.wallRadiusVw=a(e.wallRadiusVw,0,40,ka.wallRadiusVw)),void 0!==e.wallThicknessVw&&(ka.wallThicknessVw=a(e.wallThicknessVw,0,20,ka.wallThicknessVw)),Number.isFinite(ka.containerBorderVw)&&ka.containerBorderVw>0||(ka.containerBorderVw=i(ka.containerBorder,t)),Number.isFinite(ka.simulationPaddingVw)&&ka.simulationPaddingVw>=0||(ka.simulationPaddingVw=i(ka.simulationPadding,t)),Number.isFinite(ka.contentPaddingVw)&&ka.contentPaddingVw>0||(ka.contentPaddingVw=i(ka.contentPadding,t)),Number.isFinite(ka.wallRadiusVw)&&ka.wallRadiusVw>0||(ka.wallRadiusVw=i(ka.wallRadius,t)),Number.isFinite(ka.wallThicknessVw)&&ka.wallThicknessVw>0||(ka.wallThicknessVw=i(ka.wallThickness,t)),l()}function d(){return ka}function p(e){const t=d(),a=Math.round(+e||0);return Math.max(0,t.isMobile?Math.round(a*Math.max(0,Math.min(1,+(t.mobileObjectReductionFactor??.7)))):a)}function u(e,t,a){ka.canvas=e,ka.ctx=t,ka.container=a}function h(e){ka.currentMode=e}function f(){ka.balls.length=0}function m(){const e=navigator.userAgent||"",t=/iPad/.test(e)||/Mac/.test(e)&&navigator.maxTouchPoints>1,a=/iPhone/.test(e);let o=!1;try{o=!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(s){}const n=!(!t&&!a),i=o,r=n,l=n||o?ka.responsiveScaleMobile:1;if(ka.isMobile!==r||ka.isMobileViewport!==i||Math.abs((ka.responsiveScale??1)-l)>1e-6){ka.isMobile=r,ka.isMobileViewport=i,ka.responsiveScale=l,(ka.isMobile||ka.isMobileViewport)&&console.log(`✓ Mobile scaling active - ball scale: ${ka.responsiveScale}x (${ka.isMobile?"device":"viewport"})`),g();try{const e=(ka.R_MIN+ka.R_MAX)/2;if(Number.isFinite(e)&&e>0&&Array.isArray(ka.balls)&&ka.balls.length)for(let t=0;ka.balls.length>t;t++){const a=ka.balls[t];a&&(a.r=e,a.rBase=e)}}catch(s){}}}function g(){ka.R_MED=Math.max(1,(ka.R_MIN_BASE+ka.R_MAX_BASE)/2*ka.sizeScale*ka.responsiveScale);const e=a(ka.sizeVariationCap,0,.5,.12),t=a(ka.sizeVariationGlobalMul,0,2,1),o=a(e*t,0,.5,e);ka.R_MIN=Math.max(1,ka.R_MED*(1-o)),ka.R_MAX=Math.max(ka.R_MIN,ka.R_MED*(1+o))}function b(e,t,a){const o=+e;if(!Number.isFinite(o))return t;const n=Math.floor(o);return t>n?t:n>a?a:n}function M(e){return Array.isArray(e)&&e.every(e=>Number.isFinite(+e))}function y(e){const t=((e||"")+"").trim();if(!t)return null;const a="#"===t[0]?t.slice(1):t;if(3!==a.length&&6!==a.length)return null;const o=parseInt(3===a.length?a[0]+a[0]+a[1]+a[1]+a[2]+a[2]:a,16);return Number.isFinite(o)?{r:(o>>16&255)/255,g:(o>>8&255)/255,b:(255&o)/255}:null}function v(e){return e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92}function x(e){const t=y(e);return t?.2126*v(t.r)+.7152*v(t.g)+.0722*v(t.b):1}function w(e){const t=y(e);if(!t)return 0;const a=Math.max(t.r,t.g,t.b);return a>0?(a-Math.min(t.r,t.g,t.b))/a:0}function S(e,t){const a=t||d(),o=e&&e.length?e:[],n=Math.min(7,o.length-1);if(0>n)return[];const i=Number.isFinite(+a.cursorColorLumaMax)?+a.cursorColorLumaMax:.62,r=M(a.cursorColorAllowIndices)?a.cursorColorAllowIndices.map(e=>b(e,0,7)):[],l=M(a.cursorColorDenyIndices)?a.cursorColorDenyIndices.map(e=>b(e,0,7)):[],s=new Set(l),c=r.length?new Set(r):null,p=[];for(let d=0;n>=d;d++){if(s.has(d))continue;if(c&&!c.has(d))continue;const e=o[d];e&&(x(e)>i||.18>w(e)||p.push(d))}if(p.length)return p;const u=[];for(const d of Da)d>n||s.has(d)||c&&!c.has(d)||u.push(d);if(u.length)return u;for(let d=0;n>=d;d++)s.has(d)||c&&!c.has(d)||u.push(d);return u}function C(e,{forceMode:t}={}){const a=d(),o=a.currentColors,n=S(o,a),i=b(e,0,7),r=n.includes(i)?i:n[0]??i,l=((e,t)=>{const a=e&&e.length?e:[];return a[b(t,0,Math.max(0,Math.min(7,a.length-1)))]||"#000000"})(o,r);return t&&(a.cursorColorMode=t),a.cursorColorIndex=r,a.cursorColorHex=l,(e=>{try{document.documentElement.style.setProperty("--cursor-color",(e+"").trim()||"#000000")}catch(t){}})(l),{index:r,hex:l}}function P(){const e=d();if("auto"!==e.cursorColorMode)return C(e.cursorColorIndex,{forceMode:e.cursorColorMode}),!1;const t=S(e.currentColors,e);if(!t.length)return!1;const a=Number.isFinite(+e.o)?+e.o:-1;let o=t[Math.random()*t.length|0];return t.length>1&&o===a&&(o=t[Math.random()*t.length|0],o===a&&(o=t[(t.indexOf(a)+1)%t.length])),e.o=o,C(o,{forceMode:"auto"}),!0}function k(e){const t=d(),a=Ta[e];return a?t.isDarkMode?a.dark:a.light:Ta.industrialTeal.light}function F(){const e=d().currentColors;if(!e||0===e.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let a=0;for(let o=0;Math.min(e.length,8)>o;o++)if(a+=La[o],a>=t)return e[o];return e[Math.min(e.length-1,7)]}function T(e){const t=d().currentColors;return t&&0!==t.length?t[Math.max(0,Math.min(7,Math.floor(e)))]||"#ffffff":(console.warn("No colors available, using fallback"),"#ffffff")}function L(e){const t=d();t.currentTemplate=e,t.currentColors=k(e),"auto"!==t.cursorColorMode&&"manual"!==t.cursorColorMode&&(t.cursorColorMode="auto"),C(t.cursorColorIndex,{forceMode:t.cursorColorMode}),(()=>{const e=d(),t=e.balls,a=e.currentColors;if(t.length>0&&a&&a.length>0){const e=Math.min(8,a.length,t.length),o=Math.floor(Math.random()*e);for(let n=0;e>n;n++)t[n].color=a[(o+n)%e];for(let a=e;t.length>a;a++)t[a].color=F();return}for(let o=0;t.length>o;o++)t[o].color=F()})(),(e=>{try{const t=document.documentElement,a=(e&&e.length?e:[]).slice(0,8);for(let e=0;8>e;e++)t.style.setProperty("--ball-"+(e+1),a[e]||"#ffffff")}catch(t){}})(t.currentColors),(()=>{const e=d().currentColors;for(let t=1;8>=t;t++){const a=document.getElementById("color"+t),o=document.getElementById(`color${t}Val`);a&&e[t-1]&&(a.value=e[t-1],o&&(o.textContent=e[t-1].toUpperCase()))}})();try{window.dispatchEvent(new CustomEvent("bb:paletteChanged",{detail:{template:e}}))}catch(a){}}function D(){const e=document.getElementById("colorSelect");if(!e)return;e.innerHTML="";for(const[a,o]of Object.entries(Ta)){const t=document.createElement("option");t.value=a,t.textContent=o.label,e.appendChild(t)}const t=d();e.value=t.currentTemplate}function I(e,t=.15){return e*(1+2*(Math.random()-.5)*t)}function K(){try{"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent(Za,{detail:W()}))}catch(e){}}function A(){if(!Qa&&(Qa=!0,"undefined"!=typeof window&&window.matchMedia)){const e=window.matchMedia("(prefers-reduced-motion: reduce)");Ua=e.matches,e.addEventListener("change",e=>{Ua=e.matches})}}async function O(){if(Ha)return!0;try{const e=window.AudioContext||window.webkitAudioContext;return e?(za=new e({latencyHint:"interactive",sampleRate:44100}),"suspended"===za.state&&await za.resume(),(()=>{Va=za.createGain(),Va.gain.value=Aa.masterGain,$a=za.createDynamicsCompressor(),$a.threshold.value=-6,$a.knee.value=10,$a.ratio.value=16,$a.attack.value=5e-4,$a.release.value=.08,_a=za.createBiquadFilter(),_a.type="highshelf",_a.frequency.value=Aa.highShelfFreq,_a.gain.value=Aa.highShelfGain,_a.Q.value=.7,Ga=za.createWaveShaper(),Ga.curve=((e=.55)=>{const t=1024,a=new Float32Array(t),o=1+8*e;for(let n=0;t>n;n++)a[n]=Math.tanh(o*(2*n/(t-1)-1))/Math.tanh(o);return a})(.55),Ga.oversample="2x",Ba=za.createGain(),Ba.gain.value=1-Aa.reverbWetMix,Wa=za.createGain(),Wa.gain.value=Aa.reverbWetMix,Ea=(()=>{const e=za.createGain(),t=za.createGain(),a=[.029,.037,.053,.067].map(e=>{const t=za.createDelay(.1);return t.delayTime.value=e*Aa.reverbDecay,t}),o=a.map(()=>{const e=za.createGain();return e.gain.value=.4,e}),n=za.createBiquadFilter();return n.type="lowpass",n.frequency.value=2e3*(1-Aa.reverbHighDamp),n.Q.value=.5,a.forEach((t,i)=>{e.connect(t),t.connect(o[i]),o[i].connect(n),o[i].connect(a[(i+1)%a.length])}),n.connect(t),e.connect(t),e.l=t,e})();const e=Ea.l;Ba.connect(Ga),Wa.connect(Ea),e.connect(Ga),Ga.connect(_a),_a.connect($a),$a.connect(Va),Va.connect(za.destination),(()=>{Ya=[];for(let e=0;ja>e;e++){const t={id:e,inUse:!1,startTime:0,filter:za.createBiquadFilter(),envelope:za.createGain(),panner:za.createStereoPanner(),reverbSend:za.createGain(),noiseFilter:za.createBiquadFilter(),noiseEnvelope:za.createGain(),osc:null,harmonicOsc:null,sparkleOsc:null,noiseSource:null};t.filter.type="lowpass",t.noiseFilter.type="bandpass",t.noiseFilter.Q.value=1.2,t.filter.connect(t.envelope),t.envelope.connect(t.panner),t.panner.connect(Ba),t.panner.connect(t.reverbSend),t.reverbSend.connect(Wa),t.noiseFilter.connect(t.noiseEnvelope),t.noiseEnvelope.connect(t.panner),Ya.push(t)}})()})(),Ha=!0,Na=!0,K(),console.log(`✓ Audio unlocked (${(1e3*(za.baseLatency||0)).toFixed(1)}ms base latency)`),!0):(console.warn("Web Audio API not supported"),!1)}catch(e){return console.error("Failed to unlock audio:",e),!1}}function R(e,t,a=.5,o=null){if(!Na||!Ha||!za||Ua)return;if(Aa.collisionMinImpact>t)return;const n=za.currentTime;if(.005>n-Xa)return;if(null!==o){const e=qa.get(o)||0;if(Aa.minTimeBetweenSounds>n-e)return;qa.set(o,n)}if(Xa=n,qa.size>200){const e=n-.5;for(const[t,a]of qa)e>a&&qa.delete(t)}const i=(()=>{for(let t=0;ja>t;t++)if(!Ya[t].inUse)return Ya[t];let e=Ya[0];for(let t=1;ja>t;t++)e.startTime>Ya[t].startTime&&(e=Ya[t]);return V(e),e})();i&&((e,t,a,o,n)=>{e.inUse=!0,e.startTime=n;const i=Math.pow(Math.max(0,Math.min(1,a)),Aa.intensityExponent),r=I(t,Aa.variancePitch),l=I(Aa.decayTime,Aa.varianceDecay)*(1-i*(1-Aa.velocityDecayScale)),s=l+.02;let c=Aa.minGain+(Aa.maxGain-Aa.minGain)*i;c*=I(1,Aa.varianceGain);const d=1+(Aa.velocityBrightnessScale-1)*i;let p=Aa.filterBaseFreq+Aa.filterVelocityRange*Math.pow(i,1.3);p*=I(1,Aa.varianceFilter)*d;const u=2*(o-.5)*Aa.maxPan,h=.12+.5*(1-i);({gain:c,filterFreq:p}=((e,t,a)=>{const o=E((e-Aa.toneSafetyMinHz)/(Aa.toneSafetyMaxHz-Aa.toneSafetyMinHz),0,1),n=Aa.toneSafetyExponent,i=Math.pow(o,n),r=E(1-Aa.toneSafetyHighGainAtten*i-Aa.toneSafetyLowGainAtten*Math.pow(1-o,n),.6,1);let l=Math.min(t*r,Aa.voiceGainMax);const s=E(1-Aa.toneSafetyHighBrightAtten*i,.55,1);return{gain:l,filterFreq:E(a*s,Aa.filterMinHz,Aa.filterMaxHz)}})(r,c,p)),e.filter.frequency.value=p,e.filter.Q.value=Aa.filterQ,e.panner.pan.value=u,e.reverbSend.gain.value=h,e.noiseFilter.Q.value=E(Aa.noiseTransientQ||1.2,.5,8),e.envelope.gain.cancelScheduledValues(n),e.envelope.gain.setValueAtTime(c,n),e.envelope.gain.exponentialRampToValueAtTime(.001,n+l);const f=za.createOscillator();if(f.type="sine",f.frequency.value=r,e.osc=f,f.connect(e.filter),(Aa.harmonicGain||0)>.001){const t=za.createOscillator();t.type="sine",t.frequency.value=2*r;const a=za.createGain();a.gain.cancelScheduledValues(n),a.gain.setValueAtTime(c*Aa.harmonicGain,n),a.gain.exponentialRampToValueAtTime(.001,n+l),e.harmonicOsc=t,t.connect(a),a.connect(e.filter),t.onended=()=>{try{a.disconnect()}catch(e){}},t.start(n),t.stop(n+s)}else e.harmonicOsc=null;if((Aa.sparkleGain||0)>.001){const t=za.createOscillator();t.type="sine";const a=Aa.sparkleRatioMin||2.3,o=Aa.sparkleRatioMax||4.1,i=E(a+Math.random()*(o-a),1.2,10);t.frequency.value=r*I(i,.02);const d=za.createGain(),p=Math.max(.012,l*E(Aa.sparkleDecayMul||.65,.25,.95));d.gain.cancelScheduledValues(n),d.gain.setValueAtTime(c*Aa.sparkleGain,n),d.gain.exponentialRampToValueAtTime(.001,n+p),e.sparkleOsc=t,t.connect(d),d.connect(e.filter),t.onended=()=>{try{d.disconnect()}catch(e){}},t.start(n),t.stop(n+s)}else e.sparkleOsc=null;if(Aa.noiseTransientEnabled&&i>.25){const t=(()=>{if(!Ja){const e=2*za.sampleRate;Ja=za.createBuffer(1,e,za.sampleRate);const t=Ja.getChannelData(0);let a=0,o=0,n=0;for(let i=0;e>i;i++){const e=2*Math.random()-1;a=.99765*a+.099046*e,o=.963*o+.2965164*e,n=.57*n+1.0526913*e,t[i]=.25*(a+o+n+.1848*e)}}const e=za.createBufferSource();return e.buffer=Ja,e.loopStart=1.5*Math.random(),e.loopEnd=e.loopStart+.1,e.loop=!1,e})();e.noiseSource=t;const a=Math.pow(i,1.4);e.noiseFilter.frequency.value=I(Aa.noiseTransientFilterMin+(Aa.noiseTransientFilterMax-Aa.noiseTransientFilterMin)*a,Aa.varianceNoise);const o=Aa.noiseTransientGain*Aa.velocityNoiseScale*a*c,r=I(Aa.noiseTransientDecay,Aa.varianceNoise);e.noiseEnvelope.gain.cancelScheduledValues(n),e.noiseEnvelope.gain.setValueAtTime(o,n),e.noiseEnvelope.gain.exponentialRampToValueAtTime(.001,n+r),t.connect(e.noiseFilter),t.start(n),t.stop(n+r+.01)}else e.noiseSource=null;f.start(n),f.stop(n+s),f.onended=()=>V(e)})(i,(e=>{const t=1-E((e-8)/47,0,1),a=E(Aa.pitchMinHz||145,40,6e3),o=E(Aa.pitchMaxHz||280,a+10,12e3),n=E(Aa.pitchCurve||1,.5,2.5);return(a+Math.pow(t,n)*(o-a))*I(1,1.5*(Aa.variancePitch||.06))})(e),Math.max(0,Math.min(1,t)),a,n)}function z({intensity:e=.82,radius:t=18,xPosition:a=.72}={}){R(t,e,a,null)}function V(e){if(e.osc){try{e.osc.stop(),e.osc.disconnect()}catch(t){}e.osc=null}if(e.harmonicOsc){try{e.harmonicOsc.stop(),e.harmonicOsc.disconnect()}catch(t){}e.harmonicOsc=null}if(e.sparkleOsc){try{e.sparkleOsc.stop(),e.sparkleOsc.disconnect()}catch(t){}e.sparkleOsc=null}if(e.noiseSource){try{e.noiseSource.stop(),e.noiseSource.disconnect()}catch(t){}e.noiseSource=null}e.inUse=!1}function E(e,t,a){return t>e?t:e>a?a:e}function B(){return!!Ha&&(Na=!Na,K(),Na)}function W(){return{isUnlocked:Ha,isEnabled:Na,activeSounds:Ya.filter(e=>e.inUse).length,poolSize:ja}}function $(){return{...Aa}}function G(e){for(const[t,a]of Object.entries(e))t in Aa&&(Aa[t]=a);Wa&&Ba&&"reverbWetMix"in e&&(Wa.gain.value=Aa.reverbWetMix,Ba.gain.value=1-Aa.reverbWetMix),_a&&("highShelfFreq"in e||"highShelfGain"in e)&&(_a.frequency.value=Aa.highShelfFreq,_a.gain.value=Aa.highShelfGain),Va&&"masterGain"in e&&(Va.gain.value=Aa.masterGain)}function _(e){const t=Oa[e];if(!t)return!1;Ra=e;const{label:a,description:o,...n}=t;return G(n),!0}function N(){return Ra}function H(){const e=d(),t=e.balls,a=e.canvas,o=e.ballSpacing||0,n=t.length;if(2>n)return[];const i=Math.max(1,2*e.R_MAX*(1+o)),r=Math.ceil(a.width/i)+1;eo.clear();for(let s=0;n>s;s++){const e=t[s],a=(e.y/i|0)*r+(e.x/i|0);let o=eo.get(a);o||(o=[],eo.set(a,o)),o.push(s)}const l=[];for(const[s,c]of eo){const e=s/r|0,a=s%r;for(let n=-1;1>=n;n++)for(let i=-1;1>=i;i++){const s=eo.get((e+n)*r+(a+i));if(s)for(let e=0;c.length>e;e++){const a=c[e];for(let e=0;s.length>e;e++){const n=s[e];if(a>=n)continue;const i=t[a],r=t[n],c=r.x-i.x,d=r.y-i.y,p=i.r+r.r+(i.r+r.r)/2*o,u=c*c+d*d;p*p>u&&l.push({i:a,j:n,overlap:p-Math.sqrt(Math.max(u,xa.MIN_DISTANCE_EPSILON))})}}}}return l.sort((e,t)=>t.overlap-e.overlap),l}function Z(e=10){const t=d(),a=t.balls,o=H(),n=t.REST,i=.5*t.DPR,r=t.ballSpacing||0;for(let l=0;e>l;l++)for(let e=0;o.length>e;e++){const{i:s,j:c}=o[e],d=a[s],p=a[c],u=p.x-d.x,h=p.y-d.y,f=d.r+p.r+(d.r+p.r)/2*r,m=u*u+h*h;if(0===m||m>f*f)continue;const g=Math.sqrt(m),b=u/g,M=h/g,y=f-g,v=1/Math.max(d.m,.001),x=1/Math.max(p.m,.001),w=d.isSleeping&&p.isSleeping,S=.8*Math.max(y-i,0)/(v+x),C=S*b,P=S*M;d.x-=C*v,d.y-=P*v,p.x+=C*x,p.y+=P*x;const k="pit"===t.currentMode||"pit-throws"===t.currentMode;if(k&&-.3>M?p.hasSupport=!0:k&&M>.3&&(d.hasSupport=!0),w)continue;const F=p.vx-d.vx,T=p.vy-d.vy,L=F*b+T*M,D=-15*(t.DPR||1)>L;if((!d.isSleeping||D)&&(!p.isSleeping||D)&&(d.isSleeping&&d.wake(),p.isSleeping&&p.wake(),0>L)){const e=-(1+(30>Math.abs(L)?0:n))*L/(v+x),a=e*b,o=e*M;d.vx-=a*v,d.vy-=o*v,p.vx+=a*x,p.vy+=o*x;const i=F-L*b,r=T-L*M,c=Math.hypot(i,r);if(c>.001){const e=0>i*-M+r*b?-1:1,t=xa.SPIN_GAIN_TANGENT;d.omega-=e*t*c/Math.max(d.r,1),p.omega+=e*t*c/Math.max(p.r,1)}const u=Math.min(1,Math.abs(L)/(50*(d.r+p.r))),h=Math.min(t.getSquashMax(),.8*u);d.squashAmount=Math.max(d.squashAmount,.8*h),d.squashNormalAngle=Math.atan2(-M,-b),p.squashAmount=Math.max(p.squashAmount,.8*h),p.squashNormalAngle=Math.atan2(M,b),0===l&&R((d.r+p.r)/2,u,(d.x+p.x)/2/(t.canvas?.width||1),`${s}-${e}`)}}}function j(e,t,a){e.startsWith("corner")||("top"===e?oo.top.impact(t,a):"bottom"===e?oo.bottom.impact(t,a):"left"===e?oo.left.impact(t,a):"right"===e&&oo.right.impact(t,a))}function Y(e,t,a=1){e.startsWith("corner")||("top"===e?oo.top.addPressure(t,a):"bottom"===e?oo.bottom.addPressure(t,a):"left"===e?oo.left.addPressure(t,a):"right"===e&&oo.right.addPressure(t,a))}function X(e,t,a){return t>e?t:e>a?a:e}function q(e,t,a){return e+(t-e)*a}function U(e,t){switch(t){case Ma.PIT:return e.sizeVariationPit??0;case Ma.PIT_THROWS:return e.sizeVariationPitThrows??0;case Ma.FLIES:return e.sizeVariationFlies??0;case Ma.WEIGHTLESS:return e.sizeVariationWeightless??0;case Ma.WATER:return e.sizeVariationWater??0;case Ma.VORTEX:return e.sizeVariationVortex??0;case Ma.PING_PONG:return e.sizeVariationPingPong??0;case Ma.MAGNETIC:return e.sizeVariationMagnetic??0;case Ma.BUBBLES:return e.sizeVariationBubbles??0;case Ma.KALEIDOSCOPE:case Ma.KALEIDOSCOPE_1:case Ma.KALEIDOSCOPE_2:case Ma.KALEIDOSCOPE_3:return e.sizeVariationKaleidoscope??0;case Ma.ORBIT_3D:return e.sizeVariationOrbit3d??0;case Ma.ORBIT_3D_2:return e.sizeVariationOrbit3d2??0;case Ma.CRITTERS:return e.sizeVariationCritters??0;case Ma.NEURAL:return e.sizeVariationNeural??0;case Ma.LATTICE:return e.sizeVariationLattice??0;case Ma.PARALLAX_LINEAR:return e.sizeVariationParallaxLinear??0;case Ma.PARALLAX_PERSPECTIVE:return e.sizeVariationParallaxPerspective??0;default:return 0}}function J(e,t){const a=X(+(e.sizeVariationCap??.12),0,.5),o=X(+(e.sizeVariationGlobalMul??1),0,2),n=X(+(U(e,t)??0),0,1);return X(a*o*n,0,.5)}function Q(e,t){const{minR:a,maxR:o,medR:n}=((e,t)=>{const a=Math.max(1,e.R_MED||.5*(e.R_MIN+e.R_MAX)||10),o=X(+(e.sizeVariationCap??.12),0,.5),n=X(+(e.sizeVariationGlobalMul??1),0,2),i=X(+(U(e,t)??0),0,1),r=X(o*n*i,0,.5);return{minR:Math.max(1,a*(1-r)),maxR:Math.max(1,a*(1+r)),medR:a}})(e,t);return 1e-6>o-a?n:q(a,o,Math.random())}function ee(e,t){const a=d(),o=a.waterDrag||.015;e.vx*=1-o,e.vy*=1-o,e.omega*=1-.5*o;const n=a.DPR||1;for(let r=0;ro.length>r;r++){const a=ro[r],o=e.x-a.x,i=e.y-a.y,l=Math.sqrt(o*o+i*i),s=40*n;if(l>a.radius-s&&a.radius+s>l){const n=a.strength*(1-Math.abs(l-a.radius)/s);if(l>.1){const a=i/l;e.vx+=o/l*n*t,e.vy+=a*n*t}}}const i=a.waterDriftStrength||25;e.vx+=Math.sin(.5*e.t+.01*e.x)*i*t,e.vy+=Math.cos(.7*e.t+.01*e.y)*i*t}function te(e){const t=d().waterRippleSpeed||300;for(let a=ro.length-1;a>=0;a--){const o=ro[a];o.radius+=t*e,o.age+=e,o.strength*=.96,(o.age>3||10>o.strength)&&ro.splice(a,1)}}function ae(e,t,a=1){const o=d();ro.push({x:e,y:t,radius:0,strength:(o.waterRippleStrength||15e3)*Math.min(a,5),age:0})}function oe(e,t,a){a||(a=F());const o=d(),n=Q(o,o.currentMode||Ma.PIT),i=new io(e,t,n,a),r=.5*o.canvas.width>e?1:-1,l=Math.max(.6,Math.min(1.4,n/(.5*(o.R_MIN+o.R_MAX)))),s=180*l;return i.vx=r*(140*l+Math.random()*s),i.vy=120*-Math.random(),i.driftAx=r*(360+420*Math.random())*l,i.driftTime=.22+.28*Math.random(),o.balls.push(i),i}function ne(e,t){const a=d(),o=(-1e9===a.mouseX?.5*a.canvas.width:a.mouseX)-e.x,n=(-1e9===a.mouseY?.5*a.canvas.height:a.mouseY)-e.y,i=Math.sqrt(o*o+n*n+1),r=n/i;e.vx+=o/i*4e3*t,e.vy+=4e3*r*t;const l=120*a.DPR;let s=0,c=0,p=0;for(let d=0;a.balls.length>d;d++){const t=a.balls[d];if(t===e)continue;const o=e.x-t.x,n=e.y-t.y,i=o*o+n*n;if(l*l>i&&i>0){const e=Math.sqrt(i),t=1-e/l;s+=o/e*t,c+=n/e*t,p++}}if(p>0){const a=15e3;e.vx+=s/p*a*t,e.vy+=c/p*a*t}e.vx+=1e3*(Math.random()-.5)*t,e.vy+=1e3*(Math.random()-.5)*t}function ie(e,t){const a=d(),o=a.repelPower,n=a.repelRadius;if(!a.repellerEnabled||0>=o||0>=n)return;const i=n*a.DPR,r=e.x-a.mouseX,l=e.y-a.mouseY,s=r*r+l*l;if(s>i*i)return;const c=Math.max(Math.sqrt(s),1e-4),p=r/c,u=l/c,h=20*o*Math.pow(Math.max(0,1-c/i),a.repelSoft||3.4),f=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=p*h*t/f,e.vy+=u*h*t/f}function re(e,t,a){return Math.max(t,Math.min(a,e))}function le(e,t){return e+Math.random()*(t-e)}function se(e){const t=0|e.spawnedTotal;return e.spawnedTotal=t+1,8>t?T(t):void 0}function ce(e,t,a,{speedMul:o=1,spreadMul:n=1}={}){const i=e.canvas.width,r=e.canvas.height,l=e.DPR,s=(e.wallThickness||20)*l,c=Math.max(1,i-2*s),d=.35*-r,p=.05*-r,u=re(e.pitThrowInletInset??.06,0,.2),h=0===a?s+c*u:i-s-c*u,f=re(e.pitThrowSpawnSpread??.02,0,.12),m=re(f*n,0,.18),g=h+le(-c*m,c*m),b=le(d,p),M=re(e.pitThrowTargetYFrac??.36,.12,.7),y=re(e.pitThrowCrossBias??.12,0,.35),v=re(e.pitThrowAimJitter??.04,0,.2),x=re(v*n,0,.25),w=i*(.5+(0===a?y:-y)+le(-x,x)),S=r*M,C=re(e.pitThrowSpeed??650,50,4e3)*l,P=re(e.pitThrowSpeedJitter??.22,0,.8),k=re(e.pitThrowAngleJitter??.16,0,.8),F=oe(g,b,t),T=w-g,L=S-b,D=Math.max(1e-4,Math.sqrt(T*T+L*L));let I=T/D,K=L/D;const A=le(-Math.PI,Math.PI)*k,O=Math.cos(A),R=Math.sin(A),z=I*R+K*O;I=I*O-K*R,K=z;const V=C*o*(1+le(-P,P));return F.vx=I*V,F.vy=K*V,F.driftAx=0,F.driftTime=0,F}function de(e){const t=d();if(!t||"pit-throws"!==t.currentMode)return;const a=Math.max(0,p(t.maxBalls??300));if(0>=a)return;if(t.balls.length>=a)return;const o=t.p;if(!o)return;const n=re(t.pitThrowIntervalMs??70,10,2e3)/1e3,i=re(t.pitThrowBatchSize??12,1,100),r=re(t.pitThrowColorPauseMs??400,0,3e3)/1e3,l=re(t.pitThrowPairChance??.35,0,1),s=re(t.pitThrowPairStaggerMs??18,0,300)/1e3,c=re(t.pitThrowSpeedVar??.18,0,1),u=re(t.pitThrowSpreadVar??.25,0,1);o.cooldown-=e,0>o.cooldown&&(o.cooldown=0);let h=0;for(0>o.queueA||(o.queueA-=e),0>o.queueB||(o.queueB-=e);6>h&&a>t.balls.length;){let e=!1;if(o.queueA>=0&&0>=o.queueA){const a=1+le(-c,c),n=1+le(-u,u);ce(t,o.queueColorA,o.queueSideA,{speedMul:a,spreadMul:n}),o.queueA=-1,h++,e=!0}if(h>=6||t.balls.length>=a)break;if(o.queueB>=0&&0>=o.queueB){const a=1+le(-c,c),n=1+le(-u,u);ce(t,o.queueColorB,o.queueSideB,{speedMul:a,spreadMul:n}),o.queueB=-1,h++,e=!0}if(!e)break}if(0>=o.cooldown)for(o.batchPaused&&(o.batchPaused=!1,o.batchCount=0,o.side=1-o.side);6>h&&a>t.balls.length;){if(r>0&&o.batchCount>=i){o.cooldown=r,o.batchPaused=!0;break}const e=o.side,d=1+le(-c,c),p=1+le(-u,u);if(ce(t,se(o),e,{speedMul:d,spreadMul:p}),h++,o.batchCount++,l>Math.random()&&a>t.balls.length&&i>o.batchCount){const t=se(o);0>o.queueA&&(o.queueA=s,o.queueColorA=t,o.queueSideA=e,o.batchCount++)}o.cooldown=n;break}}function pe(e,t){const a=d();if(!a.mouseInCanvas)return;const o=a.weightlessRepelRadius??0,n=a.weightlessRepelPower??0;if(0>=o||0>=n)return;const i=o*(a.DPR||1),r=e.x-a.mouseX,l=e.y-a.mouseY,s=r*r+l*l;if(s>i*i)return;const c=Math.max(Math.sqrt(s),1e-4),p=r/c,u=l/c,h=20*n*Math.pow(Math.max(0,1-c/i),a.weightlessRepelSoft??2.2),f=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=p*h*t/f,e.vy+=u*h*t/f}function ue(){if(lo=document.getElementById("c"),!lo)return void console.error("Canvas not found");so=lo.getContext("2d",{alpha:!0,desynchronized:!0,willReadFrequently:!1}),so||(so=lo.getContext("2d"),console.warn("⚠️ Desynchronized mode unavailable, using standard context")),(()=>{const e=window.devicePixelRatio||1;(navigator.connection?.saveData||4>=navigator.hardwareConcurrency||/Android|iPhone|iPad|iPod/i.test(navigator.userAgent))&&e>1.5?(co=1.5,console.log("⚡ Adaptive DPR: Reduced to 1.5x for performance")):co=Math.min(e,2),t(co)})(),so.imageSmoothingEnabled=!1;const e=()=>{ho&&cancelAnimationFrame(ho),ho=requestAnimationFrame(()=>{he(),ho=null})};if(window.addEventListener("resize",e),window.addEventListener("orientationchange",()=>{setTimeout(he,100),setTimeout(he,300)}),window.visualViewport&&(window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e)),"undefined"!=typeof ResizeObserver){const t=document.getElementById("bravia-balls");t&&new ResizeObserver(()=>{e()}).observe(t)}console.log(`✓ Renderer optimized (DPR: ${co.toFixed(2)}, desync: ${so.getContextAttributes?.()?.desynchronized??"unknown"})`)}function he(){if(!lo)return;const e=d();try{const e=window.visualViewport,t=e&&"number"==typeof e.height?e.height:window.innerHeight,a=e&&"number"==typeof e.width?e.width:window.innerWidth,o=t>0?t:window.innerHeight,n=a>0?a:window.innerWidth,i=e&&"number"==typeof e.offsetTop?e.offsetTop:0,r=e&&"number"==typeof e.offsetLeft?e.offsetLeft:0,l=Number.isFinite(i)?i:0,s=Number.isFinite(r)?r:0;let c=l+o/2,d=s+n/2;d>0||(d=window.innerWidth/2),c>0||(c=window.innerHeight/2);const p=document.documentElement?.style;p?.setProperty("--abs-viewport-h",o+"px"),p?.setProperty("--abs-vv-offset-top",l+"px"),p?.setProperty("--abs-vv-offset-left",s+"px"),p?.setProperty("--abs-vv-h",o+"px"),p?.setProperty("--abs-vv-w",n+"px"),p?.setProperty("--abs-vv-center-x",d+"px"),p?.setProperty("--abs-vv-center-y",c+"px")}catch(h){}try{l(),s()}catch(h){}try{m()}catch(h){}const t=e.container||document.getElementById("bravia-balls"),a=t?t.clientWidth:window.innerWidth,o=t?t.clientHeight:window.innerHeight;if(0>=a||0>=o)return;const n=a,i=o,r=co,c=Math.floor(n*r),p=Math.floor(i*r);if(0>=c||0>=p)return;if(c===po&&p===uo)return;if(po>0&&uo>0&&e.balls&&e.balls.length>0){const t=c/po,a=p/uo;if(t>.1&&10>t&&a>.1&&10>a){const o=e.balls;for(let e=0;o.length>e;e++){const n=o[e];if(!n)continue;n.x*=t,n.y*=a;const i=n.r||10;n.x=Math.max(i,Math.min(c-i,n.x)),n.y=Math.max(i,Math.min(p-i,n.y)),n.isSleeping&&(n.isSleeping=!1,n.sleepTimer=0)}}}po=c,uo=p;const u=lo.width!==c||lo.height!==p;if(u&&(lo.width=c,lo.height=p,so&&(so.imageSmoothingEnabled=!1)),lo.style.width=n+"px",lo.style.height=i+"px",u&&((e=>{const t=d();if(!t.canvasShadowEnabled)return void(e.style.filter="");const a=t.shadow2Enabled?` drop-shadow(0 0 ${t.shadow2Blur||4}px rgba(0,0,0,${t.shadow2Opacity||.1}))`:"";e.style.filter=`drop-shadow(${t.shadowOffsetX||1}px ${t.shadowOffsetY||1}px ${t.shadowBlur||0}px ${((e,t)=>{const a=e.replace("#",""),o=parseInt(a,16);return`rgba(${o>>16&255}, ${o>>8&255}, ${255&o}, ${t})`})(t.shadowColor||"#000000",t.shadowOpacity||.29)})${a}`})(lo),fo))try{fo()}catch(h){}try{const t="function"==typeof e.getCanvasCornerRadius?e.getCanvasCornerRadius():e.cornerRadius??e.wallRadius??0,a=Math.max(0,(+t||0)*(e.DPR||1));(lo.width!==mo||lo.height!==go||Math.abs(a-bo)>.001)&&(mo=lo.width,go=lo.height,bo=a,e.canvasClipPath=((e,t,a)=>{const o=Math.max(0,Math.min(a,.5*Math.min(e,t)));if("undefined"==typeof Path2D)return null;const n=new Path2D;return o>0?(n.moveTo(o,0),n.lineTo(e-o,0),n.arcTo(e,0,e,o,o),n.lineTo(e,t-o),n.arcTo(e,t,e-o,t,o),n.lineTo(o,t),n.arcTo(0,t,0,t-o,o),n.lineTo(0,o),n.arcTo(0,0,o,0,o),n.closePath(),n):(n.rect(0,0,e,t),n)})(lo.width,lo.height,a))}catch(h){}}function fe(){return lo}function me(){return so}function ge(e,t){const a=d();if(a.currentMode!==Ma.VORTEX)return;if(!a.mouseInCanvas)return;const o=a.vortexSwirlStrength||420,n=a.vortexRadialPull||180,i=a.vortexSpeedMultiplier??1,r=a.vortexRadius??0,l=a.vortexFalloffCurve??1,s=a.vortexRotationDirection??1,c=a.vortexCoreStrength??1,p=a.vortexAccelerationZone??0,u=a.vortexOutwardPush??0,h=e.x-a.mouseX,f=e.y-a.mouseY,m=Math.max(8,Math.sqrt(h*h+f*f));if(r>0&&m>r){if(u>0){const a=f/m,o=u*((m-r)/r);e.vx+=h/m*o*t,e.vy+=a*o*t}return}let g;g=Math.pow(r>0?1-Math.min(1,m/r):1/(1+m*(a.vortexFalloffRate??.0015)),l);const b=1+(c-1)*(1-Math.min(1,m/(r||400))),M=o*g*b*i,y=n*g*b*i;let v=1;if(p>0){const e=Math.abs(m-p),t=.3*p;t>e&&(v=1+.5*(1-e/t))}const x=h/m,w=f/m,S=x*s,C=M*v;e.vx+=-w*s*C*t,e.vy+=S*C*t;const P=y*v;e.vx-=x*P*t,e.vy-=w*P*t;const k=Math.max(0,Math.min(1,a.vortexDrag??.005));e.vx*=1-k,e.vy*=1-k}function be(e){const t=d();if(t.currentMode!==Ma.PING_PONG)return;if(!e.isPingPong)return;if(t.mouseInCanvas){const a=Math.max(0,t.pingPongCursorRadius||0)*t.DPR,o=e.x-t.mouseX,n=e.y-t.mouseY,i=Math.sqrt(o*o+n*n),r=a+e.r;if(r>i&&i>.1){const t=r-i,a=o/i,l=n/i;e.x+=a*t*1.1,e.y+=l*t*1.1;const s=e.vx*a+e.vy*l;0>s&&(e.vx-=2*s*a,e.vy-=2*s*l,e.omega+=.02*s)}}const a=t.pingPongSpeed||400;.9*a>Math.abs(e.vx)&&(e.vx=(0>e.vx?-1:1)*a),e.vy*=Math.max(0,Math.min(1,t.pingPongVerticalDamp??.995))}function Me(e,t){const a=d();if(a.currentMode!==Ma.MAGNETIC)return;if(!a.mouseInCanvas)return;const o=a.mouseX-e.x,n=a.mouseY-e.y,i=a.DPR||1,r=Math.max(30*i,Math.sqrt(o*o+n*n)),l=(a.magneticStrength||65e3)/(r*r)*1e3,s=n/r,c=e.charge||1;e.vx+=o/r*l*c*t,e.vy+=s*l*c*t;const p=(a.magneticMaxVelocity||2800)*i,u=Math.sqrt(e.vx*e.vx+e.vy*e.vy);u>p&&(e.vx=e.vx/u*p,e.vy=e.vy/u*p),e.vx*=.998,e.vy*=.998}function ye(){const e=d();if(e.currentMode===Ma.MAGNETIC)for(let t=0;e.balls.length>t;t++)e.balls[t].alpha=1}function ve(e,t,a,o=!1){const n=d(),i=n.DPR||1,r=Q(n,Ma.BUBBLES),l=new io(e,t,o?r:.1,a);return l.isBubble=!0,l.baseRadius=r,l.targetRadius=r,l.wobblePhase=Math.random()*Math.PI*2,l.wobbleFreq=2+3*Math.random(),l.vx=20*(Math.random()-.5)*i,l.vy=(-50-50*Math.random())*i,l.spawning=!o,l.spawnProgress=o?1:0,l.dissipating=!1,l.dissipateProgress=0,l.alpha=1,n.balls.push(l),l}function xe(e){const t=d(),a=t.canvas;if(!a)return;const o=t.DPR||1,n=a.width,i=a.height;e.x=Math.random()*n,e.y=i+(60+30*Math.random())*o,e.vx=20*(Math.random()-.5)*o,e.vy=(-50-50*Math.random())*o,e.wobblePhase=Math.random()*Math.PI*2,e.wobbleFreq=2+3*Math.random(),e.color=F(),e.targetRadius=Q(t,Ma.BUBBLES),e.baseRadius=e.targetRadius,e.r=.1,e.rBase=.1,e.spawning=!0,e.spawnProgress=0,e.dissipating=!1,e.dissipateProgress=0,e.alpha=1}function we(e,t){const a=d();if(a.currentMode!==Ma.BUBBLES)return;if(!e.isBubble)return;const o=a.canvas;if(!o)return;if(e.spawning&&(e.spawnProgress+=3*t,e.r=e.targetRadius*(1-Math.pow(1-Math.min(1,e.spawnProgress),3)),e.rBase=e.r,1>e.spawnProgress||(e.spawning=!1,e.r=e.targetRadius,e.rBase=e.targetRadius)),e.dissipating){e.dissipateProgress+=3*t;const a=Math.pow(e.dissipateProgress,2);return e.r=e.targetRadius*Math.max(0,1-a),e.rBase=e.r,e.alpha=Math.max(0,1-.5*a),e.vy*=.92,e.vx*=.92,void(1>e.dissipateProgress||xe(e))}const n=.01*(a.bubblesWobble||40);if(e.vy-=(a.bubblesRiseSpeed||150)*a.DPR*t,e.wobblePhase+=e.wobbleFreq*t,e.vx+=Math.sin(e.wobblePhase)*n*100*t,e.vx*=.92,e.vy*=.96,a.mouseInCanvas){const o=e.x-a.mouseX,n=e.y-a.mouseY,i=Math.sqrt(o*o+n*n),r=Math.max(0,a.bubblesDeflectRadius||0)*a.DPR;if(r>i&&i>1){const a=3e3*Math.pow(1-i/r,3),l=o/i,s=n/i;if(e.vx+=l*a*t,e.vy+=s*a*t,.3*r>i){const a=500*(1-i/(.3*r));e.vx+=l*a*t,e.vy+=s*a*t}}}e.y>=2*e.targetRadius||e.dissipating||e.spawning||(e.dissipating=!0,e.dissipateProgress=0),(4*-e.r>e.x||e.x>o.width+4*e.r)&&xe(e)}function Se(){}function Ce(e,t,a){return Math.max(t,Math.min(a,e))}function Pe(e){const t=e.canvas;return t?Ce(Math.min(t.width,t.height)/1e3,.35,3):1}function ke(e,t,a,o){for(let n=0;e.length>n;n++){const i=e[n],r=t-i.x,l=a-i.y,s=o+i.r;if(s*s>r*r+l*l)return!0}return!1}function Fe(e,t,a,o=10){const n=2*o;return e.v+=o*o*(t-e.x)*a,e.v*=Math.max(0,1-n*a),e.x+=e.v*a,e.x}function Te(e,t,a,o){const n=d(),i=Math.max(2,n.wallInset||3)*(n.DPR||1),r=i+e.r,l=t-i-e.r,s=i+e.r,c=a-i-e.r,p=.92,u=Math.max(0,1-.15*o);r>e.x?(e.x=r,e.vx=Math.abs(e.vx)*p*u):e.x>l&&(e.x=l,e.vx=-Math.abs(e.vx)*p*u),s>e.y?(e.y=s,e.vy=Math.abs(e.vy)*p*u):e.y>c&&(e.y=c,e.vy=-Math.abs(e.vy)*p*u)}function Le(e){return e.currentMode===Ma.KALEIDOSCOPE_1?{count:e.kaleidoscope1BallCount??18,wedges:e.kaleidoscope1Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope1Speed??.8,complexity:.55,spawnAreaMul:e.kaleidoscope1SpawnAreaMul??1,sizeVariance:e.kaleidoscope1SizeVariance??.3}:e.currentMode===Ma.KALEIDOSCOPE_2?{count:e.kaleidoscope2BallCount??36,wedges:e.kaleidoscope2Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope2Speed??1.15,complexity:.95,spawnAreaMul:e.kaleidoscope2SpawnAreaMul??1,sizeVariance:e.kaleidoscope2SizeVariance??.3}:e.currentMode===Ma.KALEIDOSCOPE_3?{count:e.kaleidoscope3BallCount??54,wedges:e.kaleidoscope3Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope3Speed??1.55,complexity:1.35,spawnAreaMul:e.kaleidoscope3SpawnAreaMul??1,sizeVariance:e.kaleidoscope3SizeVariance??.3}:{count:e.kaleidoscopeBallCount??23,wedges:e.kaleidoscopeWedges??e.kaleidoscopeSegments??12,speed:e.kaleidoscopeSpeed??1,complexity:.75,spawnAreaMul:e.kaleidoscopeSpawnAreaMul??1,sizeVariance:e.kaleidoscopeSizeVariance??.3}}function De(e,t){function a(e){const a=((e,t)=>{const a=e?.canvas,o=a?.height||0;if(!o)return Q(e,t);const n=X(t===Ma.KALEIDOSCOPE_1?+(e.kaleidoscope1DotSizeVh??e.kaleidoscopeDotSizeVh??.95):t===Ma.KALEIDOSCOPE_2?+(e.kaleidoscope2DotSizeVh??e.kaleidoscopeDotSizeVh??.95):t===Ma.KALEIDOSCOPE_3?+(e.kaleidoscope3DotSizeVh??e.kaleidoscopeDotSizeVh??.95):+(e.kaleidoscopeDotSizeVh??.95),.1,6),i=X(t===Ma.KALEIDOSCOPE_1?+(e.kaleidoscope1DotAreaMul??e.kaleidoscopeDotAreaMul??.7):t===Ma.KALEIDOSCOPE_2?+(e.kaleidoscope2DotAreaMul??e.kaleidoscopeDotAreaMul??.7):t===Ma.KALEIDOSCOPE_3?+(e.kaleidoscope3DotAreaMul??e.kaleidoscopeDotAreaMul??.7):+(e.kaleidoscopeDotAreaMul??.7),.1,2),r=Math.max(1,.01*n*o*Math.sqrt(i)),l=X(.5*(t===Ma.KALEIDOSCOPE_1?+(e.kaleidoscope1SizeVariance??e.kaleidoscopeSizeVariance??.3):t===Ma.KALEIDOSCOPE_2?+(e.kaleidoscope2SizeVariance??e.kaleidoscopeSizeVariance??.3):t===Ma.KALEIDOSCOPE_3?+(e.kaleidoscope3SizeVariance??e.kaleidoscopeSizeVariance??.3):+(e.kaleidoscopeSizeVariance??.3)),0,.5),s=Math.max(1,r*(1-l)),c=Math.max(1,r*(1+l));return 1e-6>c-s?r:q(s,c,Math.random())})(o,t),n=1.2*b,i=l-n,r=l+n,d=s-n,p=s+n;for(let t=0;90>t;t++){const t=Math.random()*Mo,n=g+Math.random()*(b-g),u=Ce(l+Math.cos(t)*n,i,r),h=Ce(s+Math.sin(t)*n,d,p),f=a*(1+(o.ballSpacing||0));if(!ke(M,u,h,f)){M.push({x:u,y:h,r:f});const n=new io(u,h,a,e);n.u=Math.random()*Mo;const i=u-l,r=h-s;n.h=Math.sqrt(i*i+r*r);const d=(12+12*Math.random())*c;return n.vx=-Math.sin(t)*d,n.vy=Math.cos(t)*d,n.driftAx=0,n.driftTime=0,void o.balls.push(n)}}const u=Math.random()*Mo,h=g+Math.random()*(b-g),f=l+Math.cos(u)*h,m=s+Math.sin(u)*h,y=new io(f,m,a,e);y.u=Math.random()*Mo;const v=f-l,x=m-s;y.h=Math.sqrt(v*v+x*x);const w=(12+12*Math.random())*c;y.vx=-Math.sin(u)*w,y.vy=Math.cos(u)*w,y.driftAx=0,y.driftTime=0,o.balls.push(y)}const o=d();f();const n=o.canvas;if(!n)return;const i=n.width,r=n.height,l=.5*i,s=.5*r,c=Pe(o),p=o.maxBalls||300,u=Ce(Math.max(0,0|e),0,p);if(0>=u)return;const h=Ce(Le(o).spawnAreaMul??1,.2,2),m=Math.min(i,r),g=.05*m,b=2.8*m*h,M=[],y=Math.min(8,u);for(let d=0;y>d;d++)a(T(d));for(let d=y;u>d;d++)a(F())}function Ie(e){return e===Ma.KALEIDOSCOPE||e===Ma.KALEIDOSCOPE_1||e===Ma.KALEIDOSCOPE_2||e===Ma.KALEIDOSCOPE_3}function Ke(e){return Le(e).complexity}function Ae(e,t){const a=d();if(!Ie(a.currentMode))return;const o=a.canvas;if(!o)return;const n=.5*o.width,i=.5*o.height,r=Pe(a),l=Ce(Le(a).speed??1,.2,2),s=performance.now(),c=120>s-(a.lastPointerMoveMs||0);void 0===a.M&&(a.M=0);const p=c?1:0;a.M+=(p-a.M)*(1-Math.exp(-t/Math.max(1e-4,p>a.M?.45:.65)));const u=a.M,h=.008*Ke(a);if(.01>u){const a=(e.u??0)+.02*e.age+3e-4*s,o=Math.cos(a)*h*8,n=Math.sin(a)*h*8;return e.vx+=o*t,e.vy+=n*t,e.vx*=.96,void(e.vy*=.96)}const f=e.x-n,m=e.y-i,g=Math.max(yo,Math.sqrt(f*f+m*m)),b=f/g,M=m/g,y=b,v=30*r*l*u,x=-2.5*(g-(void 0!==e.h?e.h:g))*l*u;e.vx+=(-M*v+b*x)*t,e.vy+=(y*v+M*x)*t,e.vx*=.992,e.vy*=.992}function Oe(e,t){const a=d(),o=(-1e9===a.mouseX?.5*a.canvas.width:a.mouseX)-e.x,n=(-1e9===a.mouseY?.5*a.canvas.height:a.mouseY)-e.y,i=Math.sqrt(o*o+n*n+1),r=o/i,l=n/i,s=-n/i,c=o/i,p=a.DPR||1,u=40*p;if(u>i){const a=100*(u-i);e.vx-=r*a*t,e.vy-=l*a*t}const h=a.orbit3dGravity??5e3,f=.015*h;e.vx+=s*f*t,e.vy+=c*f*t;const m=.003*h/(1+i/(100*p));e.vx+=r*m*t,e.vy+=l*m*t;const g=60*a.DPR;let b=0,M=0,y=0;for(let d=0;a.balls.length>d;d++){const t=a.balls[d];if(t===e)continue;const o=e.x-t.x,n=e.y-t.y,i=o*o+n*n;if(g*g>i&&i>0){const e=Math.sqrt(i),t=1-e/g;b+=o/e*t,M+=n/e*t,y++}}if(y>0){const a=8e3;e.vx+=b/y*a*t,e.vy+=M/y*a*t}const v=2*(a.orbit3dVelocityMult??150)*p,x=Math.sqrt(e.vx*e.vx+e.vy*e.vy);x>v&&(e.vx=e.vx/x*v,e.vy=e.vy/x*v);const w=1-(a.orbit3dDamping??.02);e.vx*=w,e.vy*=w;const S=a.orbit3dDepthScale??.8;e.z=e.orbitDepth+.2*Math.sin(2*Math.atan2(n,o)),e.z=Math.max(0,Math.min(1,e.z)),e.r=Math.max(2,e.rBase*(.5+e.z*S))}function Re(e,t){const a=d(),o=(-1e9===a.mouseX?.5*a.canvas.width:a.mouseX)-e.x,n=(-1e9===a.mouseY?.5*a.canvas.height:a.mouseY)-e.y,i=Math.sqrt(o*o+n*n+1),r=o/i,l=n/i,s=-n/i,c=o/i,p=a.DPR||1,u=80*p;if(u>i){const a=100*(u-i);e.vx-=r*a*t,e.vy-=l*a*t}const h=a.orbit3d2Gravity??8e4,f=.015*h;e.vx+=s*f*t,e.vy+=c*f*t;const m=.003*h/(1+i/(100*p));e.vx+=r*m*t,e.vy+=l*m*t;const g=100*a.DPR;let b=0,M=0,y=0;for(let d=0;a.balls.length>d;d++){const t=a.balls[d];if(t===e)continue;const o=e.x-t.x,n=e.y-t.y,i=o*o+n*n;if(g*g>i&&i>0){const e=Math.sqrt(i),t=1-e/g;b+=o/e*t,M+=n/e*t,y++}}if(y>0){const a=8e3;e.vx+=b/y*a*t,e.vy+=M/y*a*t}const v=300*p,x=Math.sqrt(e.vx*e.vx+e.vy*e.vy);x>v&&(e.vx=e.vx/x*v,e.vy=e.vy/x*v);const w=1-(a.orbit3d2Damping??.02);e.vx*=w,e.vy*=w;const S=a.orbit3d2DepthScale??.6;e.z=e.orbitDepth+.2*Math.sin(2*Math.atan2(n,o)),e.z=Math.max(0,Math.min(1,e.z)),e.r=Math.max(2,e.rBase*(.5+e.z*S))}function ze(e,t,a){return t>e?t:e>a?a:e}function Ve(e){return e>Math.PI?e-=2*Math.PI:-Math.PI>e&&(e+=2*Math.PI),e}function Ee(e,t){const a=d(),o=a.canvas;if(!o)return;const n=a.DPR||1,i=Math.max(0,a.critterSpeed||0),r=Math.max(50,a.critterMaxSpeed||0)*n,l=Math.max(0,a.critterStepHz||0),s=a.critterStepSharpness??2.4,c=Math.max(0,a.critterTurnNoise||0),p=Math.max(.1,a.critterTurnDamp||0),u=Math.max(0,a.critterTurnSeek||0),h=Math.max(0,(a.critterAvoidRadius||0)*(a.DPR||1)),f=Math.max(0,a.critterAvoidForce||0),m=Math.max(0,a.critterEdgeAvoid||0),g=Math.max(0,a.critterMousePull||0),b=Math.max(0,a.critterMouseRadiusVw||0);let M=e.S||0,y=e.C||0,v=e.P||0,x=e.k??v,w=e.F||0;const S=e.T||0;w>0?w=Math.max(0,w-t):.25*t>Math.random()&&(w=.03+.09*Math.random());let C=0,P=0;if(m>0){const t=o.width,n=o.height,i=Math.max(24*(a.DPR||1),.08*Math.min(t,n)),r=e.x,l=e.y;i>r?C+=1-r/i:r>t-i&&(C-=1-(t-r)/i),i>l?P+=1-l/i:l>n-i&&(P-=1-(n-l)/i);const s=1.35*m;C*=s,P*=s}let k=0;if(g>0&&-1e9!==a.mouseX){const t=(window.innerWidth||o.width)/100,n=Math.max(1,b*t)*(a.DPR||1),i=e.x-a.mouseX,r=e.y-a.mouseY,l=i*i+r*r;if(n*n>l){const e=Math.sqrt(l)+1e-6,t=1-e/n;k=t;const a=g*(.85+.65*t);C+=i/e*a,P+=r/e*a;const o=.25*t*a;C+=-r/e*o,P+=i/e*o,w=0}}if(h>0&&f>0){const o=a.balls,n=h*h;let i=0,r=0,l=0;for(let t=0;o.length>t;t++){const a=o[t];if(a===e)continue;const s=e.x-a.x,c=e.y-a.y,d=s*s+c*c;if(d>0&&n>d){const e=Math.sqrt(d),t=1-e/h,a=t*t,o=1/(e+1e-6);i+=s*o*a,r+=c*o*a,l++}}if(l>0){const a=1/l;C+=i*a*1.15,P+=r*a*1.15,e.vx+=i*a*.65*f*t,e.vy+=r*a*.65*f*t}}y+=(c*(1+1.35*k*g)*(2*Math.random()-1)+.35*S*c)*t,C*C+P*P>1e-6&&(y+=Ve(Math.atan2(P,C)-M)*u*t),y*=Math.exp(-p*t),M=Ve(M+y*t),l>0&&(x=v,v+=l*t,v-=0|v);const F=w>0?0:((e,t)=>{const a=(o=ze(o=.5>e?2*e:2-2*e,0,1))*o*(3-2*o);var o;const n=ze(t,.5,6);return Math.pow(a,n)})(v,s),T=1+.95*k*g;if(0>=w&&v>.82){const t=(v-.82)/.18*.1*(.65+.35*T);t>e.squashAmount&&(e.squashAmount=t,e.squashNormalAngle=-Math.PI/2)}if(0>=w&&l>0&&x>v){const t=Math.max(.25,e.m/(a.MASS_BASELINE_KG||129)),o=i*(.55+.55*F)*T*(.85+.3*Math.random()),n=Math.cos(M),r=Math.sin(M),l=-r,s=n,c=.18*(2*Math.random()-1)*(.35+.65*k)*o;e.vx+=(n*o+l*c)/t,e.vy+=(r*o+s*c)/t,e.squashAmount=Math.max(e.squashAmount,.2+.15*k),e.squashNormalAngle=Math.PI/2}const L=i*(.08+.25*F)*T;e.vx+=Math.cos(M)*L*t,e.vy+=Math.sin(M)*L*t;const D=e.vx,I=e.vy,K=D*D+I*I;if(K>r*r){const t=r/(Math.sqrt(K)+1e-6);e.vx=D*t,e.vy=I*t}e.S=M,e.C=y,e.P=v,e.k=x,e.F=w,e.theta=M}function Be(e,t){const a=d(),o=Math.max(.25,e.m/a.MASS_BASELINE_KG),n=Math.max(0,a.neuralWanderStrength??420),i=(e.L??0)+1.35*t;e.L=i;const r=Math.sin(1.7*i+.3)*n,l=Math.cos(1.1*i+1.2)*n;e.vx+=r*t/o,e.vy+=l*t/o,xo+=t;const s=a.balls,c=s.length;if(c>1){const n=xo>.18;if(n&&(xo=0),n||void 0===a.D){let e=0,t=0;for(let a=0;c>a;a++)e+=s[a].x,t+=s[a].y;a.D=e/c,a.I=t/c}const i=a.D,r=a.I,l=Math.max(0,Math.min(1,a.neuralCohesion??.18)),d=r-e.y;e.vx+=(i-e.x)*l*t/o,e.vy+=d*l*t/o}const p=Math.pow(Math.max(0,Math.min(1,a.neuralDamping??.985)),60*t);e.vx*=p,e.vy*=p}function We(){}function $e(e,t){const a=d(),o=a.canvas;if(!o)return;const n=a.mouseX;if(!1!==a.repellerEnabled&&-1e9!==n&&a.mouseInCanvas){const o=(a.latticeDisruptRadius??600)*a.DPR,i=a.latticeDisruptPower??25,r=e.x-n,l=e.y-a.mouseY,s=r*r+l*l;if(o*o>s){const n=Math.max(Math.sqrt(s),1e-4),c=r/n,d=l/n,p=80*i*Math.pow(Math.max(0,1-n/o),1.8),u=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=c*p*t/u,e.vy+=d*p*t/u}}void 0!==e.latticeHomeX&&void 0!==e.latticeHomeY||(e.latticeHomeX=e.x,e.latticeHomeY=e.y);const i=.001*performance.now(),r=a.latticeMeshWaveStrength??12,l=a.latticeMeshWaveSpeed??.8,s=Math.sin(i*l+.004*e.latticeHomeX)*r,c=Math.cos(i*l*.7+.004*e.latticeHomeY)*r,p=.015*Math.sin(i*l*.5),u=e.latticeHomeX+s+(e.latticeHomeX-.5*o.width)*p-e.x,h=e.latticeHomeY+c+(e.latticeHomeY-.5*o.height)*p-e.y,f=Math.max(0,a.latticeStiffness??2.2),m=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=u*f*t/m,e.vy+=h*f*t/m;const g=Math.pow(Math.max(0,Math.min(1,a.latticeDamping??.92)),60*t);e.vx*=g,e.vy*=g}function Ge(e){if(!e.K)return;const t=d(),a=t.canvas;if(!a)return;const o=.5*a.width,n=.5*a.height;let i=0,r=0;t.mouseInCanvas&&(i=Math.max(-1,Math.min(1,(t.mouseX-o)/(.5*a.width))),r=Math.max(-1,Math.min(1,(t.mouseY-n)/(.5*a.height))));const l=Math.max(100,t.parallaxLinearFocalLength??400),s=Math.max(0,t.parallaxLinearParallaxStrength??120),{x:c,y:p,z:u}=e.K,h=l/(l+u),f=o+(c+i*s)*h,m=n+(p+r*s)*h;e.r=.768*(t.R_MED||20)*(t.DPR||1)*Math.max(.1,Math.min(6,t.parallaxLinearDotSizeMul??1.8))*(Number.isFinite(e.A)?e.A:1)*h,e.x=f,e.y=m,e.vx=0,e.vy=0}function _e(e){if(!e.K)return;const t=d(),a=t.canvas;if(!a)return;const o=.5*a.width,n=.5*a.height;let i=0,r=0;t.mouseInCanvas&&(i=Math.max(-1,Math.min(1,(t.mouseX-o)/(.5*a.width))),r=Math.max(-1,Math.min(1,(t.mouseY-n)/(.5*a.height))));const l=Math.max(100,t.parallaxPerspectiveFocalLength??400),s=Math.max(0,t.parallaxPerspectiveParallaxStrength??150),{x:c,y:p,z:u}=e.K,h=l/(l+u),f=o+(c+i*s)*h,m=n+(p+r*s)*h;e.r=.6*(t.R_MED||20)*(t.DPR||1)*Math.max(.1,Math.min(6,t.parallaxPerspectiveDotSizeMul??1.8))*(Number.isFinite(e.A)?e.A:1)*h,e.x=f,e.y=m,e.vx=0,e.vy=0}function Ne(e){const t=d(),a=t.currentMode;if(t.currentMode===Ma.CRITTERS&&e!==Ma.CRITTERS&&(void 0!==t.O&&(t.REST=t.O,delete t.O),void 0!==t.R&&(t.FRICTION=t.R,delete t.R),void 0!==t.V&&(t.ballSpacing=t.V,delete t.V)),h(e),e!==a)try{P?.()}catch(n){}if(console.log("Switching to mode: "+e),(e=>{const t=document.getElementById("announcer");t&&(t.textContent="",setTimeout(()=>{t.textContent=e},10))})(`Switched to ${{pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero Gravity",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope","kaleidoscope-1":"Kaleidoscope I","kaleidoscope-2":"Kaleidoscope II","kaleidoscope-3":"Kaleidoscope III","orbit-3d":"Orbit 3D","orbit-3d-2":"Orbit 3D (Tight Swarm)",critters:"Critters",neural:"Neural Network",lattice:"Crystal Lattice","parallax-linear":"Parallax (Linear)","parallax-perspective":"Parallax (Perspective)"}[e]||e} mode`),t.container){const a=t.container.classList.contains("dark-mode");t.container.className="",e!==Ma.PIT&&e!==Ma.PIT_THROWS||t.container.classList.add("mode-pit"),(a||t.isDarkMode)&&t.container.classList.add("dark-mode")}he(),e===Ma.PIT?(t.gravityMultiplier=t.gravityMultiplierPit,t.G=t.GE*t.gravityMultiplier,t.repellerEnabled=!0,(()=>{const e=d();f(),((e,t)=>{const a=e.DPR,o=-.65*e.canvas.height,n=(e.wallThickness||20)*a,i=n,r=e.canvas.width-n,l=r-i,s=Math.max(1,.22*l),c=i+l*(2/3),d=Math.max(i,c-.5*s),p=Math.min(r,c+.5*s),u=Math.max(0,0|t),h=100*a,f=50*a;for(let m=0;8>m&&u>m;m++){const e=oe(d+Math.random()*(p-d),o+Math.random()*(0-o),T(m));e.vx=(Math.random()-.5)*h,e.vy=Math.random()*f+f,e.driftAx=0,e.driftTime=0}for(let m=8;u>m;m++){const e=oe(d+Math.random()*(p-d),o+Math.random()*(0-o));e.vx=(Math.random()-.5)*h,e.vy=Math.random()*f+f,e.driftAx=0,e.driftTime=0}})(e,p(e.maxBalls??300))})()):e===Ma.PIT_THROWS?(t.gravityMultiplier=t.gravityMultiplierPit,t.G=t.GE*t.gravityMultiplier,t.repellerEnabled=!0,(()=>{const e=d();f(),p(e.maxBalls??300)>0&&(e.p={spawnedTotal:0,side:0,cooldown:0,batchCount:0,batchPaused:!1,queueA:-1,queueB:-1,queueColorA:void 0,queueColorB:void 0,queueSideA:0,queueSideB:1},ce(e,se(e.p),e.p.side),e.p.side=1-e.p.side)})()):e===Ma.FLIES?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=p(e.fliesBallCount??60);if(0>=t)return;const a=.5*e.canvas.width,o=.5*e.canvas.height,n=150*e.DPR,i=300*e.DPR;for(let r=0;8>r;r++){const e=Math.random()*Math.PI*2,t=Math.random()*n,l=oe(a+Math.cos(e)*t,o+Math.sin(e)*t,T(r)),s=.5+.5*Math.random(),c=Math.random()*Math.PI*2,d=i*s;l.vx=Math.cos(c)*d,l.vy=Math.sin(c)*d,l.driftAx=0,l.driftTime=0}for(let r=8;t>r;r++){const e=Math.random()*Math.PI*2,t=Math.random()*n,r=oe(a+Math.cos(e)*t,o+Math.sin(e)*t),l=.5+.5*Math.random(),s=Math.random()*Math.PI*2,c=i*l;r.vx=Math.cos(s)*c,r.vy=Math.sin(s)*c,r.driftAx=0,r.driftTime=0}})()):e===Ma.WEIGHTLESS?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=p(e.weightlessCount);if(0>=t)return;const a=e.canvas.width,o=e.canvas.height,n=e.DPR||1,i=40*n,r=e.weightlessInitialSpeed*n;for(let l=0;8>l&&t>l;l++){const e=oe(i+Math.random()*(a-2*i),i+Math.random()*(o-2*i),T(l)),t=Math.random()*Math.PI*2,n=r*(.7+.3*Math.random());e.vx=Math.cos(t)*n,e.vy=Math.sin(t)*n,e.driftAx=0,e.driftTime=0}for(let l=8;t>l;l++){const e=oe(i+Math.random()*(a-2*i),i+Math.random()*(o-2*i)),t=Math.random()*Math.PI*2,n=r*(.7+.3*Math.random());e.vx=Math.cos(t)*n,e.vy=Math.sin(t)*n,e.driftAx=0,e.driftTime=0}})()):e===Ma.WATER?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f(),ro.length=0;const t=e.canvas;if(!t)return;const a=t.width,o=t.height,n=p(e.waterBallCount||100);if(0>=n)return;const i=(e.waterInitialVelocity||120)*(e.DPR||1);for(let r=0;8>r&&n>r;r++){const t=Math.random()*a,n=Math.random()*o,l=Q(e,Ma.WATER),s=T(r),c=new io(t,n,l,s);c.vx=(Math.random()-.5)*i,c.vy=(Math.random()-.5)*i,e.balls.push(c)}for(let r=8;n>r;r++){const t=Math.random()*a,n=Math.random()*o,r=Q(e,Ma.WATER),l=F(),s=new io(t,n,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}})()):e===Ma.VORTEX?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=e.canvas;if(!t)return;const a=t.width,o=t.height,n=p(Math.min(e.vortexBallCount||180,e.maxBalls||500));if(0>=n)return;const i=80*(e.vortexSpeedMultiplier??1)*(e.DPR||1);for(let r=0;8>r&&n>r;r++){const t=Math.random()*a,n=Math.random()*o,l=Q(e,Ma.VORTEX),s=T(r),c=new io(t,n,l,s);c.vx=(Math.random()-.5)*i,c.vy=(Math.random()-.5)*i,e.balls.push(c)}for(let r=8;n>r;r++){const t=Math.random()*a,n=Math.random()*o,r=Q(e,Ma.VORTEX),l=F(),s=new io(t,n,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}})()):e===Ma.PING_PONG?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=e.canvas;if(!t)return;const a=t.width,o=t.height,n=p(Math.min(e.pingPongBallCount||80,e.maxBalls||300));if(0>=n)return;const i=e.pingPongSpeed||400;for(let r=0;8>r&&n>r;r++){const t=Math.random()*a,n=.15*o+Math.random()*o*.7,l=Q(e,Ma.PING_PONG),s=T(r),c=new io(t,n,l,s);c.vx=(Math.random()>.5?1:-1)*(.8*i+Math.random()*i*.4),c.vy=0,c.isPingPong=!0,e.balls.push(c)}for(let r=8;n>r;r++){const t=Math.random()*a,n=.15*o+Math.random()*o*.7,r=Q(e,Ma.PING_PONG),l=F(),s=new io(t,n,r,l);s.vx=(Math.random()>.5?1:-1)*(.8*i+Math.random()*i*.4),s.vy=0,s.isPingPong=!0,e.balls.push(s)}})()):e===Ma.MAGNETIC?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=e.canvas;if(!t)return;const a=t.width,o=t.height,n=p(Math.min(e.magneticBallCount||180,e.maxBalls||300));if(0>=n)return;const i=100*(e.DPR||1);for(let r=0;8>r&&n>r;r++){const t=Math.random()*a,n=Math.random()*o,l=Q(e,Ma.MAGNETIC),s=T(r),c=new io(t,n,l,s);c.vx=(Math.random()-.5)*i,c.vy=(Math.random()-.5)*i,c.charge=Math.random()>.5?1:-1,c.baseAlpha=1,e.balls.push(c)}for(let r=8;n>r;r++){const t=Math.random()*a,n=Math.random()*o,r=Q(e,Ma.MAGNETIC),l=F(),s=new io(t,n,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,s.charge=Math.random()>.5?1:-1,s.baseAlpha=1,e.balls.push(s)}})()):e===Ma.BUBBLES?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();e.balls.length=0;const t=e.canvas;if(!t)return;const a=t.width,o=t.height,n=p(e.bubblesMaxCount||200);if(n>0){for(let e=0;8>e&&n>e;e++)ve(Math.random()*a,Math.random()*o,T(e),!0);for(let e=8;n>e;e++)ve(Math.random()*a,Math.random()*o,F(),!0)}})()):e===Ma.KALEIDOSCOPE?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,De(p(d().kaleidoscopeBallCount??23),Ma.KALEIDOSCOPE)):e===Ma.KALEIDOSCOPE_1?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,De(p(d().kaleidoscope1BallCount??18),Ma.KALEIDOSCOPE_1)):e===Ma.KALEIDOSCOPE_2?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,De(p(d().kaleidoscope2BallCount??36),Ma.KALEIDOSCOPE_2)):e===Ma.KALEIDOSCOPE_3?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,De(p(d().kaleidoscope3BallCount??54),Ma.KALEIDOSCOPE_3)):e===Ma.ORBIT_3D?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=p(Math.max(0,0|(e.orbit3dMoonCount??80)));if(0>=t)return;const a=e.canvas.width,o=e.canvas.height;for(let n=0;t>n;n++){const t=Math.random()*Math.PI*2,i=.15*Math.min(a,o)+Math.random()*Math.min(a,o)*.1,r=oe(.5*a+Math.cos(t)*i,.5*o+Math.sin(t)*i,8>n?T(n):F());if(!r)continue;const l=e.DPR||1,s=(e.orbit3dVelocityMult??150)*(.9+.2*Math.random())*l;r.vx=-Math.sin(t)*s,r.vy=Math.cos(t)*s,r.orbitDepth=Math.random()}})()):e===Ma.ORBIT_3D_2?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=p(Math.max(0,0|(e.orbit3d2MoonCount??100)));if(0>=t)return;const a=e.canvas.width,o=e.canvas.height;for(let n=0;t>n;n++){const t=Math.random()*Math.PI*2,i=.35*Math.min(a,o)+Math.random()*Math.min(a,o)*.15,r=oe(.5*a+Math.cos(t)*i,.5*o+Math.sin(t)*i,8>n?T(n):F());if(!r)continue;const l=150*(e.orbit3d2VelocityMult??1.1)*(e.DPR||1);r.vx=-Math.sin(t)*l,r.vy=Math.cos(t)*l,r.orbitDepth=Math.random()}})()):e===Ma.CRITTERS?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,void 0===t.O&&(t.O=t.REST),void 0===t.R&&(t.R=t.FRICTION),t.REST=t.critterRestitution??t.REST,t.FRICTION=t.critterFriction??t.FRICTION,void 0===t.V&&(t.V=t.ballSpacing),t.ballSpacing=Math.min(t.ballSpacing||0,1),(()=>{const e=d();f();const t=e.canvas.width,a=e.canvas.height,o=p(Math.max(10,Math.min(260,0|e.critterCount)));if(o>0){for(let n=0;8>n&&o>n;n++){const o=oe(Math.random()*t|0,Math.random()*a|0,T(n)),i=Q(e,Ma.CRITTERS);o.r=i,o.rBase=i,o.m=Math.max(1,i*i*.12),o.vx=0,o.vy=0,o.S=Math.random()*Math.PI*2,o.C=0,o.P=Math.random(),o.k=o.P,o.T=2*Math.random()-1,o.F=0}for(let n=8;o>n;n++){const o=oe(Math.random()*t|0,Math.random()*a|0,F()),n=Q(e,Ma.CRITTERS);o.r=n,o.rBase=n,o.m=Math.max(1,n*n*.12),o.vx=0,o.vy=0,o.S=Math.random()*Math.PI*2,o.C=0,o.P=Math.random(),o.k=o.P,o.T=2*Math.random()-1,o.F=0}}})()):e===Ma.NEURAL?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!0,(()=>{const e=d(),t=e.canvas;if(!t)return;f();const a=p(Math.max(8,Math.min(e.neuralBallCount??80,260)));if(0>=a)return;const o=t.width,n=t.height,i=40*(e.DPR||1),r=Math.min(8,a);for(let l=0;r>l;l++){const t=oe(i+Math.random()*(o-2*i),i+Math.random()*(n-2*i),T(l)),a=Q(e,Ma.NEURAL);t.r=a,t.rBase=a,t.m=Math.max(1,a*a*.12),t.vx=0,t.vy=0,t.driftAx=0,t.driftTime=0,t.L=Math.random()*Math.PI*2}for(let l=r;a>l;l++){const t=oe(i+Math.random()*(o-2*i),i+Math.random()*(n-2*i),F()),a=Q(e,Ma.NEURAL);t.r=a,t.rBase=a,t.m=Math.max(1,a*a*.12),t.vx=0,t.vy=0,t.driftAx=0,t.driftTime=0,t.L=Math.random()*Math.PI*2}})()):e===Ma.LATTICE?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!0,(()=>{const e=d();f();const t=e.canvas,a=t.width,o=t.height,n=Math.max(8,((e,t)=>.01*t*Math.max(1,Math.min(e.width,e.height)))(t,e.latticeSpacingVw??8.5)),i=.8660254037844386*n,r=Math.ceil(a/n)+2,l=Math.ceil(o/i)+2,s=e.isMobile?Math.max(0,Math.min(1,+(e.mobileObjectReductionFactor??.7))):1;if(e.isMobile&&0>=s)return;const c=Math.sqrt(s),p=Math.max(0,Math.round(r*c)),u=Math.max(0,Math.round(l*c));if(0>=p||0>=u)return;const h=e.latticeAlignment??"center",m=(p-1)*n,g=(u-1)*i;let b,M;"center"===h?(b=.5*(a-m),M=.5*(o-g)):"top-left"===h?(b=.5*-n,M=.5*-i):"top-center"===h?(b=.5*(a-m),M=.5*-i):"top-right"===h?(b=a-m+.5*n,M=.5*-i):(b=.5*(a-m),M=.5*(o-g));const y=.25*n;for(let d=0;u>d;d++){const e=1&d?.5*n:0,t=M+d*i;for(let i=0;p>i;i++){const r=b+i*n+e;if(!(-y>r||r>a+y||-y>t||t>o+y)){const e=oe(r,t,T(Math.floor(8*Math.random())));e.latticeHomeX=r,e.latticeHomeY=t,e.latticeRow=d,e.latticeCol=i,e.vx=0,e.vy=0,e.driftAx=0,e.driftTime=0}}}})()):e===Ma.PARALLAX_LINEAR?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d(),t=e.canvas;if(!t)return;f();const a=t.width,o=t.height,n=p(Math.max(0,Math.min(40,Math.round(e.parallaxLinearGridX??14)))),i=p(Math.max(0,Math.min(40,Math.round(e.parallaxLinearGridY??10)))),r=p(Math.max(0,Math.min(20,Math.round(e.parallaxLinearGridZ??7))));if(0>=n||0>=i||0>=r)return;const l=Math.max(.2,Math.min(3,e.parallaxLinearSpanX??1.35)),s=Math.max(.2,Math.min(3,e.parallaxLinearSpanY??1.35)),c=-.5*a*l,u=-.5*o*s,h=a*l/Math.max(1,n-1),m=o*s/Math.max(1,i-1),g=Math.max(10,e.parallaxLinearZNear??50),b=(Math.max(g+100,e.parallaxLinearZFar??800)-g)/Math.max(1,r-1),M=Math.max(80,e.parallaxLinearFocalLength??420),y=.768*(e.R_MED||20)*(e.DPR||1)*Math.max(.1,Math.min(6,e.parallaxLinearDotSizeMul??1.8)),v=J(e,Ma.PARALLAX_LINEAR),x=.5*a,w=.5*o;let S=0;for(let d=r-1;d>=0;d--){const e=g+d*b;for(let t=0;i>t;t++)for(let a=0;n>a;a++){const o=c+a*h,n=u+t*m,i=e,r=M/(M+i),l=y*r,s=1,p=oe(x+o*r,w+n*r,T(S+2*d&7));p.r=l,p.vx=0,p.vy=0,p.alpha=s,p.K={x:o,y:n,z:i,baseScale:r},p.A=v>1e-6?1+(2*Math.random()-1)*v:1,p.B=!0,S++}}})()):e===Ma.PARALLAX_PERSPECTIVE&&(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d(),t=e.canvas;if(!t)return;f();const a=t.width,o=t.height,n=p(Math.max(0,Math.min(50,Math.round(e.parallaxPerspectiveGridX??16)))),i=p(Math.max(0,Math.min(50,Math.round(e.parallaxPerspectiveGridY??12)))),r=p(Math.max(0,Math.min(25,Math.round(e.parallaxPerspectiveGridZ??8))));if(0>=n||0>=i||0>=r)return;const l=Math.max(.2,Math.min(3,e.parallaxPerspectiveSpanX??1.45)),s=Math.max(.2,Math.min(3,e.parallaxPerspectiveSpanY??1.45)),c=-.5*a*l,u=-.5*o*s,h=a*l/Math.max(1,n-1),m=o*s/Math.max(1,i-1),g=Math.max(10,e.parallaxPerspectiveZNear??40),b=(Math.max(g+100,e.parallaxPerspectiveZFar??1200)-g)/Math.max(1,r-1),M=Math.max(0,Math.min(1,e.parallaxPerspectiveRandomness??.6)),y=Math.max(80,e.parallaxPerspectiveFocalLength??420),v=.6*(e.R_MED||20)*(e.DPR||1)*Math.max(.1,Math.min(6,e.parallaxPerspectiveDotSizeMul??1.8)),x=J(e,Ma.PARALLAX_PERSPECTIVE),w=.5*a,S=.5*o;let C=0;for(let d=r-1;d>=0;d--){const e=g+d*b;for(let t=0;i>t;t++)for(let a=0;n>a;a++){const o=u+t*m,n=e,i=c+a*h+(Math.random()-.5)*h*M,r=o+(Math.random()-.5)*m*M,l=n+(Math.random()-.5)*b*M*.5,s=y/(y+l),p=v*s,f=1,g=oe(w+i*s,S+r*s,T(C+3*d&7));g.r=p,g.vx=0,g.vy=0,g.alpha=f,g.K={x:i,y:r,z:l,baseScale:s},g.A=x>1e-6?1+(2*Math.random()-1)*x:1,g.B=!0,C++}}})()),console.log(`Mode ${e} initialized with ${t.balls.length} balls`);const o=Math.max(0,Math.round(((e,t)=>{switch(e){case Ma.PIT:return t.pitWarmupFrames??10;case Ma.PIT_THROWS:return t.pitThrowsWarmupFrames??10;case Ma.FLIES:return t.fliesWarmupFrames??10;case Ma.WEIGHTLESS:return t.weightlessWarmupFrames??10;case Ma.WATER:return t.waterWarmupFrames??10;case Ma.VORTEX:return t.vortexWarmupFrames??10;case Ma.PING_PONG:return t.pingPongWarmupFrames??10;case Ma.MAGNETIC:return t.magneticWarmupFrames??10;case Ma.BUBBLES:return t.bubblesWarmupFrames??10;case Ma.KALEIDOSCOPE:return t.kaleidoscopeWarmupFrames??10;case Ma.KALEIDOSCOPE_1:return t.kaleidoscope1WarmupFrames??10;case Ma.KALEIDOSCOPE_2:return t.kaleidoscope2WarmupFrames??10;case Ma.KALEIDOSCOPE_3:return t.kaleidoscope3WarmupFrames??10;case Ma.ORBIT_3D:return t.orbit3dWarmupFrames??10;case Ma.ORBIT_3D_2:return t.orbit3d2WarmupFrames??10;case Ma.CRITTERS:return t.crittersWarmupFrames??10;case Ma.NEURAL:return t.neuralWarmupFrames??10;case Ma.LATTICE:return t.latticeWarmupFrames??10;case Ma.PARALLAX_LINEAR:return t.parallaxLinearWarmupFrames??10;case Ma.PARALLAX_PERSPECTIVE:return t.parallaxPerspectiveWarmupFrames??10;default:return 10}})(e,t)||0));if(t.warmupFramesRemaining=o,"undefined"!=typeof window&&e!==a)try{window.dispatchEvent(new CustomEvent("bb:modeChanged",{detail:{prevMode:a,mode:e}}))}catch(n){}}function He(){const e=d();try{P?.()}catch(t){}Ne(e.currentMode)}function Ze(){const e=d();return e.currentMode===Ma.FLIES?ne:e.currentMode===Ma.PIT||e.currentMode===Ma.PIT_THROWS?ie:e.currentMode===Ma.WEIGHTLESS?pe:e.currentMode===Ma.WATER?ee:e.currentMode===Ma.VORTEX?ge:e.currentMode===Ma.PING_PONG?be:e.currentMode===Ma.MAGNETIC?Me:e.currentMode===Ma.BUBBLES?we:e.currentMode===Ma.KALEIDOSCOPE||e.currentMode===Ma.KALEIDOSCOPE_1||e.currentMode===Ma.KALEIDOSCOPE_2||e.currentMode===Ma.KALEIDOSCOPE_3?Ae:e.currentMode===Ma.ORBIT_3D?Oe:e.currentMode===Ma.ORBIT_3D_2?Re:e.currentMode===Ma.CRITTERS?Ee:e.currentMode===Ma.NEURAL?Be:e.currentMode===Ma.LATTICE?$e:e.currentMode===Ma.PARALLAX_LINEAR?Ge:e.currentMode===Ma.PARALLAX_PERSPECTIVE?_e:null}function je(){const e=d();return e.currentMode===Ma.WATER?te:e.currentMode===Ma.PIT_THROWS?de:e.currentMode===Ma.MAGNETIC?ye:e.currentMode===Ma.BUBBLES?Se:null}function Ye(){return d().currentMode===Ma.NEURAL?{preRender:We}:null}function Xe(){try{return!!window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches}catch(e){return!1}}function qe(e,t,a){return t>e?t:e>a?a:e}function Ue(e,t){const a=[{x:Io,y:Io},{x:t.width-Io,y:Io},{x:Io,y:t.height-Io},{x:t.width-Io,y:t.height-Io}];for(let o=0;a.length>o;o++){const t=e.x-a[o].x,n=e.y-a[o].y,i=Math.max(1,Math.hypot(t,n));if(Io+e.r>i){const a=(Io+e.r-i)/(Io+e.r)*1800,o=n/i;e.vx+=t/i*a*Lo,e.vy+=o*a*Lo}}}function Je(e,t){const a=d(),o=a.balls,n=a.canvas;if(!n)return;if(0===o.length)return;if(a.currentMode===Ma.KALEIDOSCOPE||a.currentMode===Ma.KALEIDOSCOPE_1||a.currentMode===Ma.KALEIDOSCOPE_2||a.currentMode===Ma.KALEIDOSCOPE_3){const i=Math.min(.033,Math.max(0,e)),r=o.length;for(let e=0;r>e;e++)o[e].step(i,t);(({iterations:e=4,positionalCorrectionPercent:t=.25,positionalCorrectionSlopPx:a=null,maxCorrectionPx:o=null,enableSound:n=!0}={})=>{const i=d(),r=i.balls,l=H(),s=i.REST,c=t,p=a??.5*i.DPR,u=i.ballSpacing||0,h=o??2*(i.DPR||1);for(let d=0;e>d;d++)for(let e=0;l.length>e;e++){const{i:t,j:a}=l[e],o=r[t],f=r[a];if(o.isSleeping&&f.isSleeping)continue;o.isSleeping&&o.wake(),f.isSleeping&&f.wake();const m=f.x-o.x,g=f.y-o.y,b=o.r+f.r+(o.r+f.r)/2*u,M=m*m+g*g;if(0===M||M>b*b)continue;const y=Math.sqrt(M),v=m/y,x=g/y,w=b-y,S=1/Math.max(o.m,.001),C=1/Math.max(f.m,.001);let P=c*Math.max(w-p,0)/(S+C);P>h&&(P=h);const k=P*v,F=P*x;o.x-=k*S,o.y-=F*S,f.x+=k*C,f.y+=F*C;const T=(f.vx-o.vx)*v+(f.vy-o.vy)*x;if(0>T){const e=-(1+(30>Math.abs(T)?0:s))*T/(S+C),r=e*v,l=e*x;if(o.vx-=r*S,o.vy-=l*S,f.vx+=r*C,f.vy+=l*C,n&&0===d){const e=(o.r+f.r)/2,n=(o.x+f.x)/2/(i.canvas?.width||1);R(e,Math.min(1,Math.abs(T)/(50*(o.r+f.r))),n,`${t}-${a}`)}}}})({iterations:3,positionalCorrectionPercent:.22,maxCorrectionPx:1.25*(a.DPR||1),enableSound:!1});for(let e=0;r>e;e++)Te(o[e],n.width,n.height,i);return void(Do=0)}Do+=e;let i=0;for(;Do>=Lo&&xa.MAX_PHYSICS_STEPS>i;){const e=o.length;for(let a=0;e>a;a++)o[a].step(Lo,t);if(a.currentMode===Ma.KALEIDOSCOPE||a.currentMode===Ma.KALEIDOSCOPE_1||a.currentMode===Ma.KALEIDOSCOPE_2||a.currentMode===Ma.KALEIDOSCOPE_3?Z(6):a.currentMode!==Ma.FLIES&&a.currentMode!==Ma.ORBIT_3D&&a.currentMode!==Ma.PARALLAX_LINEAR&&a.currentMode!==Ma.PARALLAX_PERSPECTIVE&&Z(10),oo.clearAllPressure(),a.currentMode!==Ma.ORBIT_3D&&a.currentMode!==Ma.ORBIT_3D_2&&a.currentMode!==Ma.PARALLAX_LINEAR&&a.currentMode!==Ma.PARALLAX_PERSPECTIVE&&a.currentMode!==Ma.LATTICE){const e=a.currentMode===Ma.WEIGHTLESS?a.weightlessBounce:a.REST,t=a.currentMode===Ma.PIT||a.currentMode===Ma.PIT_THROWS,i=o.length;for(let a=0;i>a;a++)t||Ue(o[a],n),o[a].walls(n.width,n.height,Lo,e)}if(a.currentMode===Ma.PIT||a.currentMode===Ma.PIT_THROWS){Z(3);const e=a.REST,t=o.length;for(let a=0;t>a;a++)o[a].walls(n.width,n.height,Lo,e,{registerEffects:!1});const i=a.DPR||1,r=8*i,l=.1,s=a.timeToSleep??.25;for(let a=0;t>a;a++){const e=o[a];if(!e||e.isSleeping)continue;const t=Math.sqrt(e.vx*e.vx+e.vy*e.vy),n=Math.abs(e.omega);(e.isGrounded||e.hasSupport)&&r>t&&l>n?(e.vx*=.5,e.vy*=.5,e.omega*=.5,2*i>t&&(e.vx=0,e.vy=0),.02>n&&(e.omega=0),e.sleepTimer+=Lo,s>e.sleepTimer||(e.vx=0,e.vy=0,e.omega=0,e.isSleeping=!0)):e.sleepTimer=0}}Do-=Lo,i++}const r=je();r&&r(e),oo.step(e),Do>Lo*xa.ACCUMULATOR_RESET_THRESHOLD&&(Do=0)}function Qe(){const e=d(),t=e.ctx,a=e.balls,o=e.canvas;if(!t||!o)return;t.clearRect(0,0,o.width,o.height);const n=e.canvasClipPath;if(n){t.save();try{t.clip(n)}catch(r){}}const i=Ye();if(i&&i.preRender&&i.preRender(t),e.currentMode===Ma.KALEIDOSCOPE||e.currentMode===Ma.KALEIDOSCOPE_1||e.currentMode===Ma.KALEIDOSCOPE_2||e.currentMode===Ma.KALEIDOSCOPE_3)(e=>{const t=d();if(!Ie(t.currentMode))return;const a=t.canvas;if(!a)return;const o=(()=>{const e=performance.now(),t=vo||e;return vo=e,Ce((e-t)/1e3,0,.05)})(),n=t.balls,i=a.width,r=a.height,l=Pe(t),s=Le(t).wedges??12,c=Ce(Math.round(s),3,24),p=!!(t.kaleidoscopeMirror??1),u=(e=>.5*e.width)(a),h=(e=>.5*e.height)(a),f=Mo/c,m=Math.max(1e-5,1e-4*f),g=t.mouseInCanvas?t.mouseX:u,b=t.mouseInCanvas?t.mouseY:h,M=g-u,y=b-h,v=Math.atan2(y,M),x=Ce(Math.hypot(M,y)/Math.max(1,.5*Math.min(i,r)),0,1);t.W||(t.W={phase:{x:0,v:0},panX:{x:0,v:0},panY:{x:0,v:0},lastMouseX:g,lastMouseY:b,lastInCanvas:!!t.mouseInCanvas});const w=t.W,S=!!t.mouseInCanvas,C=Math.hypot(g-w.lastMouseX,b-w.lastMouseY)>.5||S!==w.lastInCanvas,P=Ce(Le(t).speed??1,.2,2),k=Ke(t),F=.65*P*k,T=M*F*(t.mouseInCanvas?1:0),L=y*F*(t.mouseInCanvas?1:0),D=.7*v*k*(t.mouseInCanvas?1:0);C?(w.lastMouseX=g,w.lastMouseY=b,w.lastInCanvas=S,Fe(w.phase,D,o,4.5),Fe(w.panX,T,o,5),Fe(w.panY,L,o,5)):(w.phase.v=0,w.panX.v=0,w.panY.v=0);const I=w.phase.x,K=w.panX.x,A=w.panY.x,O=.22+.18*Ce((P-.2)/1.8,0,1),R=1-O+2*O*(1-x);for(let d=0;n.length>d;d++){const t=n[d],a=t.x-u+K,o=t.y-h+A,i=3.5*l,r=Math.hypot(a,o)*i*R;if(yo>r)continue;const s=p?2*f:f;let g=Math.atan2(o,a)+I;g=(g%s+s)%s,p&&g>f&&(g=s-g),g=Ce(g,m,f-m);for(let n=0;c>n;n++){const a=n*f+g,o=u+Math.cos(a)*r,i=h+Math.sin(a)*r;1>t.alpha&&(e.globalAlpha=t.alpha),e.fillStyle=t.color,e.beginPath(),e.arc(o,i,t.r,0,Mo),e.fill(),1>t.alpha&&(e.globalAlpha=1)}}})(t);else for(let l=0;a.length>l;l++)a[l].draw(t);i&&i.postRender&&i.postRender(t),(e=>{const t=d();if(!t?.mouseTrailEnabled)return;if(Xe())return;if(!e||!To||!So)return;const a=performance.now(),o=qe(+(t.mouseTrailFadeMs??220),40,2e3),n=qe(+(t.mouseTrailOpacity??.35),0,1);if(0>=n)return;const i=t.DPR||1,r=qe(+(t.mouseTrailSize??1.3),.5,10)*i;for(;To>0&&a-ko[(Fo-To+So)%So]>o;)To--;if(!To)return;if(2>To)return;const l=(()=>{const e=d();return e&&"string"==typeof e.cursorColorHex&&e.cursorColorHex?e.cursorColorHex:"#000000"})(),s=e.globalAlpha,c=e.globalCompositeOperation,p=e.lineCap,u=e.lineJoin,h=e.strokeStyle,f=e.lineWidth;e.globalCompositeOperation="source-over",e.lineCap="round",e.lineJoin="round",e.strokeStyle=l,e.lineWidth=r,e.globalAlpha=n;const m=To,g=(Fo-m+So)%So;if(e.beginPath(),e.moveTo(Co[g],Po[g]),2===m)e.lineTo(Co[(g+1)%So],Po[(g+1)%So]);else{for(let a=1;m-1>a;a++){const t=(g+a)%So,o=(g+a+1)%So,n=Co[t],i=Po[t];e.quadraticCurveTo(n,i,.5*(n+Co[o]),.5*(i+Po[o]))}const t=(g+m-1)%So;e.lineTo(Co[t],Po[t])}e.stroke(),e.globalAlpha=s,e.globalCompositeOperation=c,e.lineCap=p,e.lineJoin=u,e.strokeStyle=h,e.lineWidth=f})(t),((e,t,a)=>{const o=d(),n=(()=>{try{return getComputedStyle(document.documentElement).getPropertyValue("--wall-color").trim()||"#0a0a0a"}catch{return"#0a0a0a"}})(),i=(o.wallThickness||12)*(o.DPR||1);if(e.save(),e.fillStyle=n,oo.bottom.hasDeformation()){e.beginPath(),e.moveTo(0,a+i);for(let o=0;to>=o;o++){const n=o/to,i=n*t,r=oo.bottom.getDeformAt(n);e.lineTo(i,a-r)}e.lineTo(t,a+i),e.closePath(),e.fill()}if(oo.top.hasDeformation()){e.beginPath(),e.moveTo(0,-i);for(let a=0;to>=a;a++){const o=a/to,n=o*t,i=oo.top.getDeformAt(o);e.lineTo(n,i)}e.lineTo(t,-i),e.closePath(),e.fill()}if(oo.left.hasDeformation()){e.beginPath(),e.moveTo(-i,0);for(let t=0;to>=t;t++){const o=t/to,n=o*a,i=oo.left.getDeformAt(o);e.lineTo(i,n)}e.lineTo(-i,a),e.closePath(),e.fill()}if(oo.right.hasDeformation()){e.beginPath(),e.moveTo(t+i,0);for(let o=0;to>=o;o++){const n=o/to,i=n*a,r=oo.right.getDeformAt(n);e.lineTo(t-r,i)}e.lineTo(t+i,a),e.closePath(),e.fill()}e.restore()})(t,o.width,o.height),n&&t.restore()}function et(){return null===Oo&&(Oo=(()=>{try{return!1}catch(e){}try{if("8001"==(globalThis?.location?.port??"")+"")return!0}catch(e){}try{if(Array.from(document.scripts||[]).some(e=>{if("module"!==(e.getAttribute("type")||"").toLowerCase())return!1;const t=e.getAttribute("src")||"";return/(^|\/)main\.js(\?|#|$)/.test(t)}))return!0}catch(e){}return!1})()),Oo}function tt(){const e=Math.random();let t=0;for(let a=0;8>a;a++)if(t+=Bo[a],t>=e)return Eo[a];return Eo[0]}function at({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"],silence:a=!1}={}){if(!Vo){Vo=!0;try{Ao.log("%c"+e,"color: #888; font-style: italic;"),Ao.log("");const a=((e,t=3)=>{const{colorAssignments:a}=((e,t=3)=>{const a=[];for(let r=0;e.length>r;r++){const o=e[r];for(let e=0;o.length>e;e+=t){const n=o.slice(e,e+t);a.push({row:r,col:e,visible:n.trim().length>0})}}const o=a.map((e,t)=>e.visible?t:-1).filter(e=>e>=0),n=Array(a.length).fill(null),i=(e=>{for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e})([...o]);for(let r=0;Math.min(8,i.length)>r;r++)n[i[r]]=Eo[r];for(const r of o)null===n[r]&&(n[r]=tt());for(let r=0;a.length>r;r++)null===n[r]&&(n[r]="transparent");return{clusters:a,colorAssignments:n}})(e,t),o=[];let n=0;for(const i of e){let e="";const r=[];for(let o=0;i.length>o;o+=t)e+="%c"+i.slice(o,o+t),r.push(`color: ${a[n]}; font-family: monospace; font-weight: bold;`),n++;o.push([e,...r])}return o})(t,3);for(const e of a)Ao.log(...e);Ao.log("");const o=(new Date).getFullYear();Ao.log("%c© "+o+" Alexander Beck Studio. All rights reserved. Unauthorized reproduction prohibited.","color: #555; font-size: 10px;")}catch(o){}if(a)try{console.log=()=>{},console.info=()=>{},console.warn=()=>{},console.debug=()=>{},console.table=()=>{},console.group=()=>{},console.groupCollapsed=()=>{},console.groupEnd=()=>{}}catch(o){}}}function ot(e){if(!et())return;const t=("undefined"!=typeof performance&&performance.now?performance.now():Date.now())-zo;Ro+=1,Ao.log(`[${(Ro+"").padStart(2,"0")}] +${t.toFixed(1)}ms ${e}`)}function nt(e){if(et())try{performance.mark(e)}catch(t){}}function it(e,t,a){if(!et())return null;try{performance.measure(e,t,a);const o=performance.getEntriesByName(e),n=o&&o.length?o[o.length-1]:null;return n?n.duration:null}catch(o){return null}}function rt(e,t){return getComputedStyle(document.documentElement).getPropertyValue(e).trim()||t}function lt(){const e=navigator.userAgent||"",t=/Android/.test(e),a=/iPhone|iPad|iPod/.test(e)||/Mac/.test(e)&&navigator.maxTouchPoints>1,o=t||a,n=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||window.matchMedia&&window.matchMedia("(display-mode: minimal-ui)").matches||!0===navigator.standalone;return o||n}function st(e){const t=document.documentElement;t.style.setProperty("--wall-color",e),t.style.setProperty("--frame-color-light",e),t.style.setProperty("--frame-color-dark",e)}function ct(e){if(Wo&&$o){const t=document.documentElement;return t.style.setProperty("--frame-color-light",Wo),t.style.setProperty("--frame-color-dark",$o),void t.style.setProperty("--wall-color",e?$o:Wo)}st(rt(e?"--frame-color-dark":"--frame-color-light","#0a0a0a"))}function dt(e){Wo&&$o||(Wo=rt("--frame-color-light","#0a0a0a"),$o=rt("--frame-color-dark","#0a0a0a")),st(rt(e?"--wall-color-browser-dark":"--wall-color-browser-light",e?"#202124":"#f1f3f4"))}function pt(e,t){return getComputedStyle(document.documentElement).getPropertyValue(e).trim()||t}function ut(e){Go=e;let t=!1;t="auto"===e?"dark"===_o||(()=>{const e=d();if(!e.autoDarkModeEnabled)return!1;const t=Number.isFinite(e.autoDarkNightStartHour)?e.autoDarkNightStartHour:18,a=Number.isFinite(e.autoDarkNightEndHour)?e.autoDarkNightEndHour:6,o=(new Date).getHours();return t!==a&&(a>t?o>=t&&a>o:o>=t||a>o)})():"dark"===e,(e=>{const t=d();t.isDarkMode=e,document.documentElement.style.colorScheme=e?"dark":"light",e?(t.container?.classList.add("dark-mode"),document.body.classList.add("dark-mode"),document.documentElement.classList.add("dark-mode")):(t.container?.classList.remove("dark-mode"),document.body.classList.remove("dark-mode"),document.documentElement.classList.remove("dark-mode")),(e=>{const t=(d().chromeHarmonyMode||"auto")+"",a=(()=>{const e=navigator.userAgent||"",t=navigator.vendor||"";return{isFirefox:/Firefox\//.test(e),isSafari:/Safari\//.test(e)&&/Apple/.test(t)&&!/Chrome\//.test(e)&&!/Chromium\//.test(e),isChromium:/Chrome\//.test(e)||/Chromium\//.test(e)||/Edg\//.test(e),ua:e}})();if("site"===t)return ct(e),{mode:t,family:a,themeColorLikelyApplied:lt()};if("browser"===t)return dt(e),{mode:t,family:a,themeColorLikelyApplied:lt()};const o=lt();a.isSafari?ct(e):a.isChromium&&!o?dt(e):ct(e)})(e),(e=>{const t=(()=>{const e=d();return{light:e?.bgLight||pt("--bg-light","#f5f5f5"),dark:e?.bgDark||pt("--bg-dark","#0a0a0a")}})(),a=pt("--chrome-bg-light",t.light),o=pt("--chrome-bg-dark",t.dark),n=e?o:a;let i=document.querySelector('meta[name="theme-color"]');i||(i=document.createElement("meta"),i.name="theme-color",document.head.appendChild(i)),i.content=n;let r=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: light)"]');r||(r=document.createElement("meta"),r.name="theme-color",r.media="(prefers-color-scheme: light)",document.head.appendChild(r)),r.content=a;let l=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: dark)"]');l||(l=document.createElement("meta"),l.name="theme-color",l.media="(prefers-color-scheme: dark)",document.head.appendChild(l)),l.content=o})(e),L(t.currentTemplate),(()=>{const e=document.getElementById("themeAuto"),t=document.getElementById("themeLight"),a=document.getElementById("themeDark");if(!e||!t||!a)return;[e,t,a].forEach(e=>e.classList.remove("active")),"auto"===Go?e.classList.add("active"):"light"===Go?t.classList.add("active"):a.classList.add("active");const o=document.getElementById("themeStatus");if(o){const e=d();o.textContent="auto"===Go?e.isDarkMode?"🌙 Auto (Dark)":"☀️ Auto (Light)":"light"===Go?"☀️ Light Mode":"🌙 Dark Mode"}})()})(t);try{localStorage.setItem("theme-preference",e)}catch(a){}ot(`🎨 Theme set to: ${e} (rendering: ${t?"dark":"light"})`)}function ht(){if(No)return;No=!0,(()=>{const e=d(),t=document.documentElement;e?.bgLight&&(t.style.setProperty("--bg-light",e.bgLight),t.style.setProperty("--chrome-bg-light",e.bgLight)),e?.bgDark&&(t.style.setProperty("--bg-dark",e.bgDark),t.style.setProperty("--chrome-bg-dark",e.bgDark)),e?.frameColor&&(t.style.setProperty("--frame-color-light",e.frameColor),t.style.setProperty("--frame-color-dark",e.frameColor),t.style.setProperty("--wall-color",e.frameColor)),e?.textColorLight&&(t.style.setProperty("--text-color-light",e.textColorLight),t.style.setProperty("--text-color-light-base",e.textColorLight)),e?.textColorLightMuted&&t.style.setProperty("--text-color-light-muted",e.textColorLightMuted),e?.textColorDark&&(t.style.setProperty("--text-color-dark",e.textColorDark),t.style.setProperty("--text-color-dark-base",e.textColorDark)),e?.textColorDarkMuted&&t.style.setProperty("--text-color-dark-muted",e.textColorDarkMuted),e?.edgeLabelColorLight&&t.style.setProperty("--edge-label-color-light",e.edgeLabelColorLight),e?.edgeLabelColorDark&&t.style.setProperty("--edge-label-color-dark",e.edgeLabelColorDark),Number.isFinite(e?.edgeLabelInsetAdjustPx)&&t.style.setProperty("--edge-label-inset-adjust",e.edgeLabelInsetAdjustPx+"px"),e?.linkHoverColor&&t.style.setProperty("--link-hover-color",e.linkHoverColor),e?.logoColorLight&&t.style.setProperty("--logo-color-light",e.logoColorLight),e?.logoColorDark&&t.style.setProperty("--logo-color-dark",e.logoColorDark)})(),_o=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",ot("🖥️ System prefers: "+_o);let e="auto";try{const t=localStorage.getItem("theme-preference");"auto"!==t&&"light"!==t&&"dark"!==t||(e=t)}catch(n){}ut(e);const t=document.getElementById("themeAuto"),a=document.getElementById("themeLight"),o=document.getElementById("themeDark");t&&t.addEventListener("click",()=>ut("auto")),a&&a.addEventListener("click",()=>ut("light")),o&&o.addEventListener("click",()=>ut("dark")),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{_o=e.matches?"dark":"light",ot("🖥️ System preference changed to: "+_o),"auto"===Go&&ut("auto")}),window.setInterval(()=>{"auto"===Go&&ut("auto")},6e4),ot("✓ Modern dark mode initialized")}function ft(){ut("light"===Go?"dark":"light")}function mt(){console.log("⚠️ localStorage is disabled")}function gt(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(mt,500)}function bt(e){return!1!==jo[e]}function Mt(e,t=!0){const a=Sa[e];if(!a)return;const o=d();for(const[i,r]of Object.entries(a))"label"!==i&&void 0!==o[i]&&(o[i]=r);o.parallaxLinearPreset=e,t&&Promise.resolve().then(()=>wo).then(({resetCurrentMode:e})=>e());try{Ft()}catch(n){}console.log("Applied parallax linear preset: "+a.label)}function yt(e,t=!0){const a=Ca[e];if(!a)return;const o=d();for(const[i,r]of Object.entries(a))"label"!==i&&void 0!==o[i]&&(o[i]=r);o.parallaxPerspectivePreset=e,t&&Promise.resolve().then(()=>wo).then(({resetCurrentMode:e})=>e());try{Ft()}catch(n){}console.log("Applied parallax perspective preset: "+a.label)}function vt(e){return{id:e,label:"Warmup Frames",stateKey:e,type:"range",min:0,max:240,step:1,default:10,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0,hint:"Pre-runs physics before first render to avoid visible settling on mode start."}}function xt(e,t){try{if("function"==typeof e?.format)return e.format(t)}catch(a){}return(t??"")+""}function wt(){const e=[];for(const t of Object.values(Yo))for(const a of t.controls)e.push({...a,section:t.title});return e}function St(e){if("divider"===e.type)return`<div class="control-divider"><span class="control-divider-label">${e.label||""}</span></div>`;if(!bt(e.id))return"";const t=e.id+"Slider",a=e.id+"Val";if("color"===e.type)return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${e.default}</span>\n        </div>\n        <input type="color" id="${e.id+"Picker"}" value="${e.default}" aria-label="${e.label}" />\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`;if("select"===e.type){const o=(Array.isArray(e.options)?e.options:[]).map(t=>{const a=t.value+"";return`<option value="${a}" ${e.default+""===a?"selected":""}>${(t.label??t.value)+""}</option>`}).join(""),n=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${xt(e,e.default)}</span>\n        </div>\n        <select id="${t}" class="control-select" aria-label="${e.label}">\n          ${o}\n        </select>\n      </label>\n      ${n}`}if("checkbox"===e.type)return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${e.default?"On":"Off"}</span>\n        </div>\n        <input type="checkbox" id="${t}" ${e.default?"checked":""} aria-label="${e.label}">\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`;const o=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${xt(e,e.default)}</span>\n        </div>\n        <input type="range" id="${t}" min="${e.min}" max="${e.max}" step="${e.step}" value="${e.default}">\n      </label>\n      ${o}`}function Ct(e,t){const a=t.controls.filter(e=>bt(e.id));if(0===a.length)return"";let o=null,n="";for(const s of a)s.group&&s.group!==o?(null!==o&&(n+="</div>"),n+=`<div class="section-title" style="margin-top: 12px;">${s.group}</div><div class="group">`,o=s.group):s.group||null===o||(n+="</div>",o=null),n+=St(s);null!==o&&(n+="</div>");const i=t.defaultOpen?"open":"",r=`\n    <summary class="panel-section-header">\n      ${t.icon?`<span class="section-icon">${t.icon}</span>`:""}\n      <span class="section-label">${t.title}</span>\n    </summary>`,l=`<div class="panel-section-content">${n}</div>`;return t.mode?`\n      <div id="${t.mode}Controls" class="mode-controls">\n        <details class="panel-section-accordion" ${i}>\n          ${r}\n          ${l}\n        </details>\n      </div>`:`\n    <details class="panel-section-accordion" ${i}>\n      ${r}\n      ${l}\n    </details>`}function Pt(){try{for(const[,e]of Object.entries(Yo)){if(!e?.mode)continue;const t=Array.isArray(e.controls)?e.controls.length:0;4>t&&console.warn(`[panel] Mode "${e.mode}" has only ${t} controls; add at least 4 parameters.`)}}catch(a){}const e=Object.entries(Yo).filter(([,e])=>e?.mode).map(([e,t])=>Ct(0,t)).join("");let t=`\n    \x3c!-- Screen reader announcements --\x3e\n    <div role="status" aria-live="polite" aria-atomic="true" class="sr-only" id="announcer"></div>\n\n    \x3c!-- Theme --\x3e\n    <details class="panel-section-accordion" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎨</span>\n        <span class="section-label">Theme</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="theme-segment-control" role="group" aria-label="Theme selector">\n          <button id="themeAuto" class="theme-segment-btn" aria-label="Auto theme">Auto</button>\n          <button id="themeLight" class="theme-segment-btn active" aria-label="Light theme">Light</button>\n          <button id="themeDark" class="theme-segment-btn" aria-label="Dark theme">Dark</button>\n        </div>\n        <div id="themeStatus" class="panel-status">☀️ Light Mode</div>\n      </div>\n    </details>\n\n    \x3c!-- Mode --\x3e\n    <details class="panel-section-accordion" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎛️</span>\n        <span class="section-label">Mode</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="mode-switcher" role="group" aria-label="Simulation mode selector">\n          ${(()=>{const e={pit:"🎯",bubbles:"🫧",critters:"🪲",flies:"🕊️","pit-throws":"🎯",water:"🌊",vortex:"🌀",magnetic:"🧲","ping-pong":"🏓",weightless:"🌌",kaleidoscope:"🪞","kaleidoscope-1":"🪞","kaleidoscope-2":"🪞","kaleidoscope-3":"🪞","orbit-3d":"🌪️","orbit-3d-2":"🌪️",lattice:"💎",neural:"🧠"},t={pit:"Pit",bubbles:"Bubbles",critters:"Critters",flies:"Flies","pit-throws":"Throws",water:"Water",vortex:"Vortex",magnetic:"Magnet","ping-pong":"Pong",weightless:"Zero-G",kaleidoscope:"Kalei","kaleidoscope-1":"Kalei I","kaleidoscope-2":"Kalei II","kaleidoscope-3":"Kalei III","orbit-3d":"Orbit","orbit-3d-2":"Swarm",lattice:"Lattice",neural:"Neural"};let a="";return ya.forEach(o=>{const n=t[o]||o;a+=`<button class="mode-button" data-mode="${o}" aria-label="${va[o]||n} mode">${e[o]||"⚪"} ${n}</button>`}),a})()}\n        </div>\n        ${e}\n      </div>\n    </details>`;for(const[o,n]of Object.entries(Yo))n.mode||(t+=Ct(0,n));return t+='\n    <details class="panel-section-accordion">\n      <summary class="panel-section-header">\n        <span class="section-icon">🌈</span>\n        <span class="section-label">Colors</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Color Template</span>\n            <span class="control-value"></span>\n          </div>\n          <select id="colorSelect"></select>\n        </label>\n      </div>\n    </details>',t+='\n    <div class="panel-section panel-section--action">\n      <button id="saveConfigBtn" class="primary">💾 Save Config</button>\n    </div>\n    <div class="panel-footer">\n      <kbd>R</kbd> reset · <kbd>/</kbd> panel · <kbd>9</kbd> kalei · Critters + Throws have no key (yet)\n    </div>',t}function kt(){const e=d();for(const[t,a]of Object.entries(Yo))for(const o of a.controls){const t=document.getElementById(o.id+"Val");if("color"===o.type){const a=document.getElementById(o.id+"Picker");if(!a)continue;a.addEventListener("input",()=>{const n=a.value;o.stateKey&&(e[o.stateKey]=n),o.onChange&&o.onChange(e,n),t&&(t.textContent=n),gt()});continue}if("select"===o.type){const a=document.getElementById(o.id+"Slider");if(!a)continue;a.addEventListener("change",()=>{const n=o.parse?o.parse(a.value):a.value;if(o.stateKey&&(e[o.stateKey]=n),o.onChange&&o.onChange(e,n),t){const a=o.stateKey?e[o.stateKey]:n;t.textContent=o.format?o.format(a):a+""}gt()});continue}if("checkbox"===o.type){const n=document.getElementById(o.id+"Slider");if(!n)continue;n.addEventListener("change",()=>{const i=!!n.checked;o.stateKey&&(e[o.stateKey]=i),o.onChange&&o.onChange(e,i),t&&(t.textContent=i?"On":"Off"),o.reinitMode&&e.currentMode===a.mode&&Promise.resolve().then(()=>wo).then(({resetCurrentMode:e})=>e?.()).catch(()=>{}),gt()});continue}const n=document.getElementById(o.id+"Slider");n&&n.addEventListener("input",()=>{const i=o.parse(n.value);if(o.stateKey&&(e[o.stateKey]=i),o.onChange&&o.onChange(e,i),t&&(t.textContent=o.format(o.stateKey?e[o.stateKey]:i)),o.cssVar&&Zo){const e={};e[o.cssVar.replace("--","").replace(/-([a-z])/g,(e,t)=>t.toUpperCase())]=i,Zo(e)}o.reinitMode&&e.currentMode===a.mode&&Promise.resolve().then(()=>wo).then(({resetCurrentMode:e})=>e?.()).catch(()=>{}),gt()})}}function Ft(){const e=d();for(const t of Object.values(Yo))for(const a of t.controls){const t=a.id+"Val",o=document.getElementById(a.id+"Slider"),n=document.getElementById(t);if(!o||!a.stateKey)continue;const i=e[a.stateKey];void 0!==i&&("checkbox"===a.type?(o.checked=!!i,n&&(n.textContent=i?"On":"Off")):(o.value=i,n&&(n.textContent=a.format(i))))}}function Tt(){kt(),document.querySelectorAll(".mode-button").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const a=e.getAttribute("data-mode");console.log("Mode button clicked:",a),Ne(a),Lt(a)})}),D();const e=document.getElementById("colorSelect");e&&e.addEventListener("change",()=>{L(e.value),gt()});const t=document.getElementById("themeAuto"),a=document.getElementById("themeLight"),o=document.getElementById("themeDark");[t,a,o].forEach(e=>{e&&e.addEventListener("click",()=>{[t,a,o].forEach(e=>e?.classList.remove("active")),e.classList.add("active")})})}function Lt(e){document.querySelectorAll(".mode-button").forEach(t=>{const a=t.getAttribute("data-mode")===e;t.classList.toggle("active",a)}),document.querySelectorAll(".mode-controls").forEach(e=>e.classList.remove("active"));const t=document.getElementById(e+"Controls");t&&t.classList.add("active");const a=document.getElementById("announcer");a&&(a.textContent=`Switched to ${{critters:"Critters",pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero-G",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope","kaleidoscope-1":"Kaleidoscope I","kaleidoscope-2":"Kaleidoscope II","kaleidoscope-3":"Kaleidoscope III","orbit-3d":"Orbit 3D","orbit-3d-2":"Orbit 3D (Tight Swarm)",lattice:"Crystal Lattice",neural:"Neural Network"}[e]||e} mode`);try{const t=document.getElementById("edge-chapter-text");t&&(t.textContent=va?.[e]||"—")}catch(o){}}function Dt(e,t){const a=t();for(const o of Object.values(Jo))for(const t of o.controls){const o=e.querySelector("#sound_"+t.id),n=e.querySelector(`#sound_${t.id}_val`);if(!o||void 0===a[t.id])continue;const i=t.fromConfig(a[t.id]);o.value=i,n&&(n.textContent=t.format(i))}}function It(e){try{localStorage.setItem(an,e+"")}catch(t){}}function Kt(){try{const e=document.getElementById("controlPanel");e&&e.remove();const t=document.getElementById("soundPanel");t&&t.remove()}catch(e){}return Qo=document.createElement("div"),Qo.className="panel-dock",Qo.id="panelDock",Qo.classList.add("hidden"),It(!0),en=(()=>{const t=document.createElement("div");t.id="masterPanel",t.className=(()=>{try{const e=localStorage.getItem(on);return null===e||"true"===e}catch(e){return!0}})()?"panel collapsed":"panel",t.setAttribute("role","region"),t.setAttribute("aria-label","Settings");const a=document.createElement("div");a.className="panel-header";const o=et()?"DEV MODE":"BUILD MODE";a.innerHTML=`\n    <div class="mac-titlebar">\n      <div class="mac-traffic" aria-hidden="true">\n        <span class="mac-dot mac-dot--red"></span>\n        <span class="mac-dot mac-dot--yellow"></span>\n        <span class="mac-dot mac-dot--green"></span>\n      </div>\n      <div class="panel-title mac-title">Settings</div>\n      <div class="mac-right">\n        <span class="panel-mode-pill" role="status" aria-label="Runtime mode">${o}</span>\n        <button class="collapse-btn mac-collapse" aria-label="Collapse panel" title="Collapse">▾</button>\n      </div>\n    </div>\n  `;const i=document.createElement("div");i.className="panel-content",i.innerHTML=(()=>{const e=d(),t=+(e.containerBorderVw||0),a=+(e.wallRadiusVw||0),o=+(e.contentPaddingVw||0),i=n(),r=e.layoutViewportWidthPx>0?Math.round(e.layoutViewportWidthPx)+"px":`Auto (${Math.round(i)}px)`,l=Math.max(0,Math.round(e.containerBorder??0)),s=Math.max(0,Math.round(e.wallRadius??e.cornerRadius??0)),c=Math.max(0,Math.round(e.contentPadding??0)),p=Math.max(0,Math.round(e.wallInset??3)),u=Math.max(0,Math.round(e.layoutMinContentPaddingPx??0)),h=+(e.contentPaddingHorizontalRatio||1),f=Math.max(0,Math.round(e.layoutMinWallRadiusPx??0));return`\n    \x3c!-- ═══════════════════════════════════════════════════════════════════════\n         LAYOUT SECTION - Frame & Content Spacing\n         ═══════════════════════════════════════════════════════════════════════ --\x3e\n    <details class="panel-section-accordion" id="layoutSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">📐</span>\n        <span class="section-label">Layout</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Frame</span>\n            <span class="control-value" id="frameValue">${t.toFixed(2)}vw · ${l}px</span>\n          </div>\n          <input type="range" id="layoutFrame" min="0" max="8" step="0.05" value="${t||0}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Content Padding</span>\n            <span class="control-value" id="contentPadValue">${o.toFixed(2)}vw · ${c}px (min ${u}px)</span>\n          </div>\n          <input type="range" id="contentPadding" min="0" max="12" step="0.05" value="${o||0}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Horizontal Ratio</span>\n            <span class="control-value" id="contentPadHorizRatioValue">${h.toFixed(2)}× → ${Math.round(c*h)}px</span>\n          </div>\n          <input type="range" id="contentPadHorizRatio" min="0.5" max="2.5" step="0.05" value="${h}" />\n          <div class="control-hint">Horizontal padding = base × ratio</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Min Content Padding</span>\n            <span class="control-value" id="minContentPadValue">${u}px</span>\n          </div>\n          <input type="range" id="layoutMinContentPaddingPx" min="0" max="64" step="1" value="${u}" />\n          <div class="control-hint">Clamp target on smallest viewports (px).</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Radius</span>\n            <span class="control-value" id="radiusValue">${a.toFixed(2)}vw · ${s}px (min ${f}px)</span>\n          </div>\n          <input type="range" id="layoutRadius" min="0" max="20" step="0.05" value="${a||0}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Min Radius</span>\n            <span class="control-value" id="minRadiusValue">${f}px</span>\n          </div>\n          <input type="range" id="layoutMinWallRadiusPx" min="0" max="120" step="1" value="${f}" />\n          <div class="control-hint">Clamp target on smallest viewports (px).</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Viewport Width</span>\n            <span class="control-value" id="viewportWidthValue">${r}</span>\n          </div>\n          <input type="range" id="layoutViewportWidth" min="0" max="2400" step="10" value="${Math.round(e.layoutViewportWidthPx||0)}" />\n          <div class="control-hint">0 = Auto (uses current window width)</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Wall Inset</span>\n            <span class="control-value" id="wallInsetValue">${p}px</span>\n          </div>\n          <input type="range" id="layoutWallInset" min="0" max="20" value="${p}" />\n        </label>\n      </div>\n    </details>\n\n    \x3c!-- ═══════════════════════════════════════════════════════════════════════\n         SOUND SECTION\n         ═══════════════════════════════════════════════════════════════════════ --\x3e\n    <details class="panel-section-accordion" id="soundSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">🔊</span>\n        <span class="section-label">Sound</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="sound-enable-row">\n          <button id="soundEnableBtn" class="sound-enable-btn" aria-label="Enable sound" title="Enable sound">🔇</button>\n        </div>\n        <div id="soundControlsWrapper" class="sound-controls" style="display: none;">\n          <div class="sound-perf" aria-label="Sound performance controls">\n            <button type="button" id="soundTapBtn" class="sound-perf__btn" aria-label="Play test hit">▶︎</button>\n            <button type="button" id="soundResetBtn" class="sound-perf__btn" aria-label="Reset to preset">↺</button>\n            <button type="button" id="soundShuffleBtn" class="sound-perf__btn" aria-label="Shuffle (subtle) sound">🎲</button>\n            <span class="sound-perf__hint">wheel adjusts · shift/alt = fine</span>\n          </div>\n          <label class="control-row">\n            <span class="control-label">Preset</span>\n            <select id="soundPresetSelect" class="control-select"></select>\n          </label>\n          <p id="presetDescription" class="control-hint"></p>\n          ${(()=>{let e="";for(const[t,a]of Object.entries(Jo)){e+='<div class="sound-dock__section">',e+=`<div class="sound-dock__section-title">${a.title}</div>`,e+='<div class="sound-dock__group">';for(const t of a.controls)e+=`\n        <label class="sound-dock__row">\n          <span class="sound-dock__label">${t.label}</span>\n          <input type="range" \n            id="sound_${t.id}" \n            class="sound-dock__slider" \n            min="${t.min}" \n            max="${t.max}" \n            step="${t.step}">\n          <span class="sound-dock__val" id="sound_${t.id}_val">${t.format(t.fromConfig(0))}</span>\n        </label>`;e+="</div></div>"}return e})()}\n        </div>\n      </div>\n    </details>\n\n    \x3c!-- ═══════════════════════════════════════════════════════════════════════\n         CONTROLS SECTION - Theme & Mode\n         ═══════════════════════════════════════════════════════════════════════ --\x3e\n    <details class="panel-section-accordion" id="controlsSection" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">⚙️</span>\n        <span class="section-label">Controls</span>\n      </summary>\n      <div class="panel-section-content">\n        ${Uo}\n      </div>\n    </details>\n  `})(),t.appendChild(a),t.appendChild(i);const r=(()=>{try{const e=localStorage.getItem(nn);if(!e)return null;const t=JSON.parse(e);if(!t||"object"!=typeof t)return null;const a=+t.width,o=+t.height;return Number.isFinite(a)&&Number.isFinite(o)?{width:Math.round(a),height:Math.round(o)}:null}catch(e){return null}})();r&&(t.style.width=r.width+"px",t.style.height=r.height+"px",t.style.maxHeight="none");const c=a.querySelector(".collapse-btn");return c&&c.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),(t=>{t.classList.toggle("collapsed"),(t=>{try{localStorage.setItem(on,t+"")}catch(e){}})(t.classList.contains("collapsed"))})(t)}),setTimeout(()=>{Tt(),(()=>{const t=document.getElementById("saveConfigBtn");t&&t.addEventListener("click",()=>{const t=d(),a={};try{const e=wt();for(const o of e){if(!o||!o.stateKey)continue;const e=t[o.stateKey];void 0!==e&&(a[o.stateKey]=e)}}catch(e){}a.gravityMultiplier=t.gravityMultiplierPit,a.restitution=t.REST,a.friction=t.FRICTION,a.ballMass=t.ballMassKg,a.ballScale=t.sizeScale,a.sizeScale=t.sizeScale,a.sizeVariation=t.sizeVariation,a.repelSoft=t.repelSoft,a.repelSoftness=t.repelSoft,a.layoutViewportWidthPx=t.layoutViewportWidthPx||0,a.containerBorderVw=t.containerBorderVw,a.simulationPaddingVw=t.simulationPaddingVw,a.contentPaddingVw=t.contentPaddingVw,a.contentPaddingHorizontalRatio=t.contentPaddingHorizontalRatio,a.wallRadiusVw=t.wallRadiusVw,a.wallThicknessVw=t.wallThicknessVw,a.layoutMinContentPaddingPx=Math.max(0,Math.round(t.layoutMinContentPaddingPx??0)),a.layoutMinWallRadiusPx=Math.max(0,Math.round(t.layoutMinWallRadiusPx??0)),a.wallInset=t.wallInset;try{a.soundPreset=N(),a.soundConfig=$()}catch(e){}a.chromeHarmonyMode=t.chromeHarmonyMode,a.autoDarkModeEnabled=t.autoDarkModeEnabled,a.autoDarkNightStartHour=t.autoDarkNightStartHour,a.autoDarkNightEndHour=t.autoDarkNightEndHour,a.enableLOD=!1;const o=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(o),n.download="default-config.json",document.body.appendChild(n),n.click(),document.body.removeChild(n)})})(),(e=>{const t=e.querySelector("#soundEnableBtn"),a=e.querySelector("#soundControlsWrapper"),o=e.querySelector("#soundPresetSelect"),n=e.querySelector("#presetDescription"),i=e.querySelector("#soundSection"),r=e.querySelector("#soundTapBtn"),l=e.querySelector("#soundResetBtn"),s=e.querySelector("#soundShuffleBtn"),c=(e,t,a)=>t>e?t:e>a?a:e,d=(e,t)=>e+2*(Math.random()-.5)*t,p=(e,{openIfEnabled:o=!1}={})=>{if(!t)return;const n=e||W(),r=!(!n.isUnlocked||!n.isEnabled),l=!!n.isUnlocked;t.innerHTML=l&&r?'<i class="ti ti-volume-2" aria-hidden="true"></i>':'<i class="ti ti-volume-off" aria-hidden="true"></i>',t.setAttribute("aria-label",l?r?"Sound on":"Sound off":"Enable sound"),t.title=l?r?"Sound on":"Sound off":"Enable sound",t.classList.toggle("enabled",r),a&&(a.style.display=r?"":"none"),o&&r&&i&&!i.open&&(i.open=!0)};if(r&&r.addEventListener("click",()=>{z({intensity:.86,radius:18,xPosition:.72})}),l&&l.addEventListener("click",()=>{const t=N();_(t),n&&Oa[t]&&(n.textContent=Oa[t].description),Dt(e,$)}),s&&s.addEventListener("click",()=>{const t=$();G({filterBaseFreq:c(d(t.filterBaseFreq,120),300,8e3),filterQ:c(d(t.filterQ,.04),.05,.9),pitchCurve:c(d(t.pitchCurve,.06),.6,1.8),sparkleGain:c(d(t.sparkleGain,.03),0,.35),sparkleDecayMul:c(d(t.sparkleDecayMul,.05),.25,.95),noiseTransientQ:c(d(t.noiseTransientQ,.25),.6,6),reverbWetMix:c(d(t.reverbWetMix,.02),0,.35),reverbDecay:c(d(t.reverbDecay,.03),.05,.4),collisionMinImpact:c(d(t.collisionMinImpact,.03),.45,.9),variancePitch:c(d(t.variancePitch,.01),0,.2),varianceGain:c(d(t.varianceGain,.02),0,.35)}),Dt(e,$),z({intensity:.86,radius:18,xPosition:.72})}),t&&t.addEventListener("click",async()=>{const e=W();if(e.isUnlocked){const t=B();p({...e,isEnabled:t})}else await O()&&p(null,{openIfEnabled:!0})}),o){for(const[e,t]of Object.entries(Oa)){const a=document.createElement("option");a.value=e,a.textContent=t.label,o.appendChild(a)}o.value=N(),n&&Oa[N()]&&(n.textContent=Oa[N()].description),o.addEventListener("change",()=>{_(o.value),n&&Oa[o.value]&&(n.textContent=Oa[o.value].description),Dt(e,$)})}((e,t,a)=>{for(const o of Object.values(Jo))for(const t of o.controls){const o=e.querySelector("#sound_"+t.id),n=e.querySelector(`#sound_${t.id}_val`);if(!o)continue;const i=e=>{const i=(r=e,l=parseFloat(o.min),s=parseFloat(o.max),l>r?l:r>s?s:r);var r,l,s;o.value=i+"";const c=t.toConfig(i);n&&(n.textContent=t.format(i)),a({[t.id]:c})};o.addEventListener("input",()=>{i(parseFloat(o.value))}),o.addEventListener("wheel",e=>{if(e.ctrlKey)return;const t=(parseFloat(o.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),a=0>e.deltaY?1:-1,n=parseFloat(o.value);e.preventDefault(),i(n+a*t)},{passive:!1}),n&&n.addEventListener("wheel",e=>{if(e.ctrlKey)return;const t=(parseFloat(o.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),a=0>e.deltaY?1:-1,n=parseFloat(o.value);e.preventDefault(),i(n+a*t)},{passive:!1})}})(e,0,G),Dt(e,$),p(),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(Za,e=>{p(e&&e.detail?e.detail:null)})})(t),(e=>{const t=e.querySelector("#layoutFrame"),a=e.querySelector("#frameValue"),o=e.querySelector("#contentPadding"),i=e.querySelector("#contentPadValue"),r=e.querySelector("#contentPadHorizRatio"),c=e.querySelector("#contentPadHorizRatioValue"),p=e.querySelector("#layoutMinContentPaddingPx"),u=e.querySelector("#minContentPadValue"),h=e.querySelector("#layoutRadius"),f=e.querySelector("#radiusValue"),m=e.querySelector("#layoutMinWallRadiusPx"),g=e.querySelector("#minRadiusValue"),b=e.querySelector("#layoutViewportWidth"),M=e.querySelector("#viewportWidthValue"),y=e.querySelector("#layoutWallInset"),v=e.querySelector("#wallInsetValue"),x=d(),w=({triggerResize:e=!1}={})=>{if(l(),s(),a&&(a.textContent=`${(x.containerBorderVw||0).toFixed(2)}vw · ${Math.round(x.containerBorder||0)}px`),i){const e=Math.max(0,Math.round(x.layoutMinContentPaddingPx??0));i.textContent=`${(x.contentPaddingVw||0).toFixed(2)}vw · ${Math.round(x.contentPadding||0)}px (min ${e}px)`}if(c&&(c.textContent=`${(x.contentPaddingHorizontalRatio||1).toFixed(2)}× → ${Math.round(x.contentPaddingX||x.contentPadding)}px`),f){const e=Math.max(0,Math.round(x.layoutMinWallRadiusPx??0));f.textContent=`${(x.wallRadiusVw||0).toFixed(2)}vw · ${Math.round(x.wallRadius||0)}px (min ${e}px)`}if(u&&(u.textContent=Math.max(0,Math.round(x.layoutMinContentPaddingPx??0))+"px"),g&&(g.textContent=Math.max(0,Math.round(x.layoutMinWallRadiusPx??0))+"px"),M){const e=n();M.textContent=x.layoutViewportWidthPx>0?Math.round(x.layoutViewportWidthPx)+"px":`Auto (${Math.round(e)}px)`}e&&he(),document.dispatchEvent(new CustomEvent("layout-updated"))};t&&a&&t.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(x.containerBorderVw=t,x.wallThicknessVw=t,w({triggerResize:!0}))}),o&&i&&o.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(x.contentPaddingVw=t,w())}),r&&c&&r.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(x.contentPaddingHorizontalRatio=Math.max(.1,t),w())}),p&&u&&p.addEventListener("input",e=>{const t=parseInt(e.target.value,10);Number.isFinite(t)&&(x.layoutMinContentPaddingPx=Math.max(0,t),w({triggerResize:!0}))}),h&&f&&h.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(x.wallRadiusVw=t,w())}),m&&g&&m.addEventListener("input",e=>{const t=parseInt(e.target.value,10);Number.isFinite(t)&&(x.layoutMinWallRadiusPx=Math.max(0,t),w({triggerResize:!0}))}),b&&M&&b.addEventListener("input",e=>{const t=parseInt(e.target.value,10);x.layoutViewportWidthPx=Number.isFinite(t)?Math.max(0,t):0,w({triggerResize:!0})}),y&&v&&y.addEventListener("input",e=>{const t=parseInt(e.target.value,10);v.textContent=t+"px",x.wallInset=t})})(t)},0),t})(),Qo.appendChild(en),document.body.insertBefore(Qo,document.body.firstChild),(()=>{if(!en)return;const t=en.querySelector(".panel-header");t&&(t.addEventListener("mousedown",At),t.addEventListener("touchstart",At,{passive:!1}),document.addEventListener("mousemove",Ot),document.addEventListener("mouseup",Rt),document.addEventListener("touchmove",Ot,{passive:!1}),document.addEventListener("touchend",Rt),(()=>{try{if(!Qo)return;const e=JSON.parse(localStorage.getItem(tn)||"{}");e.custom&&(Qo.style.position="fixed",Qo.style.left=e.left,Qo.style.top=e.top,Qo.style.right="auto")}catch(e){}})())})(),(()=>{if(!en)return;if("undefined"==typeof ResizeObserver)return;let t=0;const a=new ResizeObserver(()=>{en&&(en.classList.contains("collapsed")||(window.clearTimeout(t),t=window.setTimeout(()=>{(t=>{try{if(!t)return;if(t.classList.contains("collapsed"))return;const e=t.getBoundingClientRect();localStorage.setItem(nn,JSON.stringify({width:Math.round(e.width),height:Math.round(e.height)}))}catch(e){}})(en)},150)))});try{a.observe(en)}catch(e){}})(),Qo}function At(e){if(e.target.closest("button")||e.target.closest("input")||e.target.closest("select"))return;if(!Qo)return;const t=e.touches?e.touches[0].clientX:e.clientX,a=e.touches?e.touches[0].clientY:e.clientY,o=Qo.getBoundingClientRect();ln=t,sn=a,cn=o.left,dn=o.top,rn=!1}function Ot(e){if(0===ln&&0===sn)return;if(!Qo)return;const t=(e.touches?e.touches[0].clientX:e.clientX)-ln,a=(e.touches?e.touches[0].clientY:e.clientY)-sn;if(rn||5>=Math.abs(t)&&5>=Math.abs(a)||(rn=!0,Qo.classList.add("dragging"),Qo.style.position="fixed",Qo.style.top=dn+"px",Qo.style.left=cn+"px",Qo.style.right="auto"),rn){let o=cn+t,n=dn+a;const i=Qo.getBoundingClientRect();o=Math.max(0,Math.min(window.innerWidth-i.width,o)),n=Math.max(0,Math.min(window.innerHeight-i.height,n)),Qo.style.left=o+"px",Qo.style.top=n+"px",e.preventDefault()}}function Rt(){rn&&(rn=!1,Qo&&Qo.classList.remove("dragging"),zt()),ln=0,sn=0,setTimeout(()=>{},10)}function zt(){try{if(!Qo)return;localStorage.setItem(tn,JSON.stringify({left:Qo.style.left,top:Qo.style.top,custom:!0}))}catch(e){}}function Vt(){if(Qo){Qo.style.position="",Qo.style.left="",Qo.style.top="",Qo.style.right="";try{localStorage.removeItem(tn)}catch(e){}}}function Et(){if(!Qo)try{Kt()}catch(t){return}const e=Qo.classList.toggle("hidden");if(It(e),!e)try{(()=>{if(!Qo)return;if(!Qo.style.left&&!Qo.style.top)return;const e=Qo.getBoundingClientRect(),t=window.innerWidth||0,a=window.innerHeight||0;if(!t||!a)return;const o=10;if(o>e.right||e.left>t-o||o>e.bottom||e.top>a-o)return void Vt();const n=(e,t,a)=>t>e?t:e>a?a:e,i=n(e.left,o,Math.max(o,t-e.width-o)),r=n(e.top,o,Math.max(o,a-e.height-o));Qo.style.position="fixed",Qo.style.left=Math.round(i)+"px",Qo.style.top=Math.round(r)+"px",Qo.style.right="auto",zt()})()}catch(t){}}function Bt(e){const t=d(),a=ya;if(!a||!a.length)return;const o=a.indexOf(t?.currentMode||Ma.PIT_THROWS),n=a[((0>o?0:o)+e+a.length)%a.length];Ne(n),Lt(n)}function Wt(){fn||(hn=document.createElement("div"),hn.id="custom-cursor",hn.setAttribute("aria-hidden","true"),document.body.appendChild(hn),hn.style.display="none",fn=!0,$t())}function $t(){if(!hn)return;const e=d();gn=(e.R_MIN+e.R_MAX)/2*e.cursorSize*2,hn.style.width=gn+"px",hn.style.height=gn+"px",hn.style.borderRadius="50%",hn.style.marginLeft="0",hn.style.marginTop="0",mn||(hn.style.transform="translate(-50%, -50%) scale(1)",hn.style.opacity="1")}function Gt(e,t){if(!hn)return;const a=mn;mn=((e,t)=>{const a=document.getElementById("bravia-balls");if(!a)return!1;const o=a.getBoundingClientRect();return!(o.left>e||e>o.right||o.top>t||t>o.bottom)})(e,t),hn.style.left=e+"px",hn.style.top=t+"px",document.body.style.cursor="none",mn?(hn.style.display="block",a?hn.style.transform.includes("scale(0.25)")||(hn.style.transform="translate(-50%, -50%) scale(0.25)",hn.style.opacity="1"):(hn.style.transform="translate(-50%, -50%) scale(1)",hn.style.opacity="1",requestAnimationFrame(()=>{hn.style.transform="translate(-50%, -50%) scale(0.25)",hn.style.opacity="1"}))):(hn.style.display="none",a&&(hn.style.transform="translate(-50%, -50%) scale(1)",hn.style.opacity="1"))}function _t(){hn&&(hn.style.display="none",document.body.style.cursor="none",mn=!1)}function Nt(){hn&&(mn=!1)}function Ht(){if(!Mn)return null;if(vn&&vn.isConnected)return vn;let e=document.getElementById("gate-modal-host");return e||(e=document.createElement("div"),e.id="gate-modal-host",e.className="gate-modal-host",Mn.appendChild(e)),vn=e,vn}function Zt(e){if(!Mn||!e)return;const t=Ht();t&&(xn.has(e)||xn.set(e,{parent:e.parentNode,nextSibling:e.nextSibling}),t.appendChild(e))}function jt(e){if(!e)return;const t=xn.get(e);if(t&&t.parent)try{t.nextSibling&&t.nextSibling.parentNode===t.parent?t.parent.insertBefore(e,t.nextSibling):t.parent.appendChild(e)}catch(a){}}function Yt(){try{const e=getComputedStyle(document.documentElement).getPropertyValue("--wall-thickness").trim();if(e)return parseFloat(e)||12}catch(t){}const e=d();return e?.wallThickness||12}function Xt(){if(!Mn)return;const e=Yt();Mn.style.setProperty("--gate-overlay-blur",e/2+"px")}function qt(e){if(Mn=document.getElementById("gate-overlay"),!Mn)return void console.warn("Gate Overlay: #gate-overlay element not found");if(yn=!1!==e.gateOverlayEnabled,!yn)return console.log("Gate Overlay: Disabled by config"),void(Mn.style.display="none");Mn.style.display="",Ht();const t=e.gateOverlayOpacity??.01,a=e.gateOverlayTransitionMs??400,o=e.gateOverlayTransitionOutMs??250,n=e.gateOverlayContentDelayMs??200,i=e.gateDepthTranslateY??8,r=e.logoOpacityInactive??1,l=e.logoOpacityActive??.2,s=e.logoBlurInactive??0,c=e.logoBlurActive??12,d=document.documentElement;d.style.setProperty("--gate-depth-scale",e.gateDepthScale??.96),d.style.setProperty("--gate-depth-translate-y",i+"px"),d.style.setProperty("--gate-depth-duration",a+"ms"),d.style.setProperty("--gate-depth-out-duration",o+"ms"),d.style.setProperty("--gate-content-delay",n+"ms"),d.style.setProperty("--logo-opacity-inactive",r),d.style.setProperty("--logo-opacity-active-target",l),d.style.setProperty("--logo-opacity-active",r),d.style.setProperty("--logo-blur-inactive",s+"px"),d.style.setProperty("--logo-blur-active-target",c+"px"),d.style.setProperty("--logo-blur-active",s+"px"),Xt(),Mn.style.setProperty("--gate-overlay-opacity",t),Mn.style.setProperty("--gate-overlay-transition-duration",a+"ms"),Mn.style.setProperty("--gate-overlay-transition-out-duration",o+"ms"),Mn.classList.remove("active"),Mn.setAttribute("aria-hidden","true"),Mn.addEventListener("click",Ut),window.addEventListener("resize",Xt),document.addEventListener("layout-updated",Xt);const p=Yt()/2;console.log(`Gate Overlay: Initialized (opacity: ${t}, blur: ${p}px [auto from wall thickness], transition: ${a}ms, logo: opacity ${r}→${l}, blur ${s}px→${c}px)`)}function Ut(e){if(e.target.closest("button"))return;if(e.target.closest("input"))return;if(e.target.closest("a"))return;if(e.target.closest("select"))return;if(e.target.closest("textarea"))return;const t="cv-gate"===e.target.id||"portfolio-gate"===e.target.id||"contact-gate"===e.target.id||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description");(e.target===Mn||"gate-modal-host"===e.target?.id||t)&&document.dispatchEvent(new CustomEvent("gate-overlay-dismiss",{detail:{instant:!0}}))}function Jt(e){const t=document.documentElement,a=document.getElementById("abs-scene");if(e){const e=getComputedStyle(t).getPropertyValue("--gate-depth-scale").trim()||"0.96",o=getComputedStyle(t).getPropertyValue("--gate-depth-translate-y").trim()||"8px",n=getComputedStyle(t).getPropertyValue("--logo-opacity-active-target").trim()||t.style.getPropertyValue("--logo-opacity-active-target")||"0.2",i=getComputedStyle(t).getPropertyValue("--logo-blur-active-target").trim()||t.style.getPropertyValue("--logo-blur-active-target")||"12px";t.style.setProperty("--gate-depth-scale-active",e),t.style.setProperty("--gate-depth-ty-active",o),t.style.setProperty("--logo-opacity-active",n),t.style.setProperty("--logo-blur-active",i),a&&a.classList.add("gate-depth-active")}else{const e=getComputedStyle(t).getPropertyValue("--logo-opacity-inactive").trim()||"1",o=getComputedStyle(t).getPropertyValue("--logo-blur-inactive").trim()||"0px";t.style.setProperty("--gate-depth-scale-active","1"),t.style.setProperty("--gate-depth-ty-active","0px"),t.style.setProperty("--logo-opacity-active",e),t.style.setProperty("--logo-blur-active",o),a&&a.classList.remove("gate-depth-active")}}function Qt(){if(!Mn||!yn)return;Xt(),Mn.setAttribute("aria-hidden","false"),Mn.classList.add("active");const e=document.getElementById("custom-cursor");if(e){let a=!1;try{a=!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(t){}a?(e.classList.remove("gate-active"),e.style.display="none"):(e.classList.add("gate-active"),e.style.display="block")}Jt(!0)}function ea(){if(!Mn||!yn)return;Mn.classList.remove("active"),Mn.setAttribute("aria-hidden","true");const e=document.getElementById("custom-cursor");e&&e.classList.remove("gate-active"),Jt(!1)}function ta(){return!!Mn&&Mn.classList.contains("active")}function aa(){if(!Pn)return;let e=null;try{e=d()}catch(a){}if(!e)return;const t=(e=>{const t=+e?.sceneImpactMul,o=Number.isFinite(t)?t:0,n=+e?.sceneImpactMobileMulFactor,i=Number.isFinite(n)&&n>0?n:1;return o*((e=>{if(e?.isMobile||e?.isMobileViewport)return!0;try{return!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(a){return!1}})(e)?i:1)})(e);Pn.style.setProperty("--abs-scene-impact-mul",t+"")}function oa(){Tn&&(window.clearTimeout(Tn),Tn=0),Ln&&(window.clearTimeout(Ln),Ln=0)}function na(e=1,t={}){if(!kn||!Pn)return;const a=d();if(!1===a?.sceneImpactEnabled)return;const o=!1!==t?.scheduleRelease,n=Math.max(0,Math.min(1,+e||0)),i=++Fn;oa(),Pn.classList.add("abs-scene--animating"),Pn.classList.add("abs-scene--impact"),t?.armManual&&(Dn=!0);const r=a?.sceneImpactPressMs??75,l=a?.sceneImpactReleaseMs??220;Pn.style.setProperty(Cn,Math.round(r)+"ms"),window.requestAnimationFrame(()=>{kn&&Pn&&i===Fn&&Pn.style.setProperty(Sn,n+"")}),o&&(Tn=window.setTimeout(()=>{ra({token:i,releaseMs:l})},0),Ln=window.setTimeout(()=>{Ln=0,Pn&&(Pn.classList.remove("abs-scene--impact"),Pn.classList.remove("abs-scene--animating"))},Math.max(0,Math.round(l)+80)))}function ia(){if(!kn||!Pn)return;const e=d();return!1!==e?.sceneImpactEnabled?ra({token:Fn,releaseMs:e?.sceneImpactReleaseMs??220}):void 0}function ra({token:e,releaseMs:t}){oa(),kn&&Pn&&e===Fn&&(Pn.style.setProperty(Cn,Math.round(t)+"ms"),window.requestAnimationFrame(()=>{kn&&Pn&&e===Fn&&Pn.style.setProperty(Sn,"0")}),Ln=window.setTimeout(()=>{Ln=0,Pn&&(Pn.classList.remove("abs-scene--impact"),Pn.classList.remove("abs-scene--animating"))},Math.max(0,Math.round(t)+80)))}function la(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function sa(){try{const e="undefined"!=typeof window?window.__TEXT__:null;return la(e)?e:null}catch(e){return null}}function ca(e,t=""){const a=Un||sa();if(!a)return t;if(!e)return t;const o=(e+"").split(".").filter(Boolean);let n=a;for(const i of o){if(!la(n)&&!Array.isArray(n))return t;if(n=n?.[i],null==n)return t}return n}function da(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.classList.add("page-flash--"+t),setTimeout(()=>{e.classList.remove("page-flash--"+t)},"success"===t?600:300)}function pa(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.classList.add("page-flash--"+t),setTimeout(()=>{e.classList.remove("page-flash--"+t)},"success"===t?600:300)}async function ua(){W().isUnlocked?ha(B()):await O()?ha(!0):(Qn&&(Qn.innerHTML=Jn,Qn.setAttribute("aria-label","Audio unavailable"),Qn.title="Audio unavailable"),setTimeout(()=>{ha(!1)},2e3))}function ha(e){Qn&&(Qn.setAttribute("data-enabled",e?"true":"false"),Qn.setAttribute("aria-pressed",e?"true":"false"),Qn.setAttribute("aria-label",e?"Sound on":"Sound off"),Qn.title=e?"Sound on":"Sound off",Qn.innerHTML=e?'<i class="ti ti-volume-2" aria-hidden="true"></i>':Jn)}function fa(e){return((e||"")+"").trim().toLowerCase()}function ma(e,t){e&&(e.textContent=(t??"")+"")}function ga(e,t,a){if(e&&null!=a)try{e.setAttribute(t,a+"")}catch(o){}}function ba(e){const t=document.documentElement;void 0!==e.noiseSizeBase&&t.style.setProperty("--noise-size-base",e.noiseSizeBase+"px"),void 0!==e.noiseSizeTop&&t.style.setProperty("--noise-size-top",e.noiseSizeTop+"px"),void 0!==e.noiseBackOpacity&&(t.style.setProperty("--noise-back-opacity",e.noiseBackOpacity+""),t.style.setProperty("--noise-back-opacity-light",e.noiseBackOpacity+"")),void 0!==e.noiseFrontOpacity&&(t.style.setProperty("--noise-front-opacity",e.noiseFrontOpacity+""),t.style.setProperty("--noise-front-opacity-light",e.noiseFrontOpacity+"")),void 0!==e.noiseBackOpacityDark&&t.style.setProperty("--noise-back-opacity-dark",e.noiseBackOpacityDark+""),void 0!==e.noiseFrontOpacityDark&&t.style.setProperty("--noise-front-opacity-dark",e.noiseFrontOpacityDark+"")}const Ma={PIT:"pit",PIT_THROWS:"pit-throws",FLIES:"flies",WEIGHTLESS:"weightless",WATER:"water",VORTEX:"vortex",PING_PONG:"ping-pong",MAGNETIC:"magnetic",BUBBLES:"bubbles",KALEIDOSCOPE:"kaleidoscope",KALEIDOSCOPE_1:"kaleidoscope-1",KALEIDOSCOPE_2:"kaleidoscope-2",KALEIDOSCOPE_3:"kaleidoscope-3",CRITTERS:"critters",ORBIT_3D:"orbit-3d",ORBIT_3D_2:"orbit-3d-2",NEURAL:"neural",LATTICE:"lattice",PARALLAX_LINEAR:"parallax-linear",PARALLAX_PERSPECTIVE:"parallax-perspective"},ya=[Ma.PIT,Ma.FLIES,Ma.LATTICE,Ma.BUBBLES,Ma.PIT_THROWS,Ma.MAGNETIC,Ma.WATER,Ma.PING_PONG,Ma.NEURAL,Ma.VORTEX,Ma.ORBIT_3D,Ma.WEIGHTLESS,Ma.PARALLAX_LINEAR,Ma.CRITTERS,Ma.ORBIT_3D_2,Ma.PARALLAX_PERSPECTIVE,Ma.KALEIDOSCOPE_1,Ma.KALEIDOSCOPE_2,Ma.KALEIDOSCOPE_3,Ma.KALEIDOSCOPE],va={[Ma.PIT]:"SOURCE MATERIAL",[Ma.FLIES]:"IDEA SPARK",[Ma.LATTICE]:"SYSTEM FRAME",[Ma.BUBBLES]:"NOISE SIGNAL",[Ma.PIT_THROWS]:"PROTOTYPE LOOP",[Ma.MAGNETIC]:"DESIGN FORCES",[Ma.WATER]:"USER FLOW",[Ma.PING_PONG]:"FEEDBACK CYCLE",[Ma.NEURAL]:"CONNECTION MAP",[Ma.VORTEX]:"EMERGENT ORDER",[Ma.ORBIT_3D]:"SYSTEM DYNAMICS",[Ma.WEIGHTLESS]:"OPEN SPACE",[Ma.PARALLAX_LINEAR]:"PERSPECTIVE SHIFT",[Ma.CRITTERS]:"BEHAVIOR MODEL",[Ma.ORBIT_3D_2]:"EDGE CASES",[Ma.PARALLAX_PERSPECTIVE]:"CONTEXT FIELD",[Ma.KALEIDOSCOPE_1]:"VOCAB SEED",[Ma.KALEIDOSCOPE_2]:"VOCAB FLOW",[Ma.KALEIDOSCOPE_3]:"VOCAB BLOOM",[Ma.KALEIDOSCOPE]:"VISUAL LANGUAGE"},xa={DPR:Math.max(1,Math.min(2,window.devicePixelRatio||1)),OFFSCREEN_MOUSE:-1e9,MIN_DISTANCE_EPSILON:1e-6,ACCUMULATOR_RESET_THRESHOLD:3,MAX_PHYSICS_STEPS:4,SPIN_DAMP_PER_S:3,SPIN_GAIN:.25,SPIN_GAIN_TANGENT:.18,ROLL_FRICTION_PER_S:2.5,SQUASH_MAX_BASE:.2,SQUASH_DECAY_PER_S:18,WALL_REST_VEL_THRESHOLD:70,GROUND_COUPLING_PER_S:12,SLEEP_VELOCITY_THRESHOLD:12,SLEEP_ANGULAR_THRESHOLD:.18,TIME_TO_SLEEP:.25,PHYSICS_DT:1/120},wa={rubber:{wallWobbleMaxDeform:45,wallWobbleStiffness:2200,wallWobbleDamping:35,wallWobbleImpactThreshold:140,wallWobbleSettlingSpeed:75,wallWobbleSigma:2,wallWobbleCornerClamp:.6},trampoline:{wallWobbleMaxDeform:55,wallWobbleStiffness:2800,wallWobbleDamping:15,wallWobbleImpactThreshold:100,wallWobbleSettlingSpeed:40,wallWobbleSigma:2.5,wallWobbleCornerClamp:.5},jelly:{wallWobbleMaxDeform:80,wallWobbleStiffness:800,wallWobbleDamping:12,wallWobbleImpactThreshold:80,wallWobbleSettlingSpeed:30,wallWobbleSigma:3.5,wallWobbleCornerClamp:.4},stiff:{wallWobbleMaxDeform:20,wallWobbleStiffness:3e3,wallWobbleDamping:60,wallWobbleImpactThreshold:180,wallWobbleSettlingSpeed:90,wallWobbleSigma:1.5,wallWobbleCornerClamp:.8}},Sa={default:{label:"Default (Full View Grid)",parallaxLinearDotSizeMul:1.8,sizeVariationParallaxLinear:0,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:7,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:50,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:260},dense:{label:"Dense (More Vertices)",parallaxLinearDotSizeMul:1.6,sizeVariationParallaxLinear:.1,parallaxLinearGridX:18,parallaxLinearGridY:13,parallaxLinearGridZ:9,parallaxLinearSpanX:1.25,parallaxLinearSpanY:1.25,parallaxLinearZNear:45,parallaxLinearZFar:1e3,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:240},deep:{label:"Deep Field (Stronger Depth)",parallaxLinearDotSizeMul:1.7,sizeVariationParallaxLinear:.08,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:10,parallaxLinearSpanX:1.45,parallaxLinearSpanY:1.45,parallaxLinearZNear:30,parallaxLinearZFar:1500,parallaxLinearFocalLength:520,parallaxLinearParallaxStrength:320},calm:{label:"Calm (Slow Camera)",parallaxLinearDotSizeMul:1.8,sizeVariationParallaxLinear:.05,parallaxLinearGridX:12,parallaxLinearGridY:9,parallaxLinearGridZ:6,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:60,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:160},minimal:{label:"Minimal (Big Dots)",parallaxLinearDotSizeMul:2.4,sizeVariationParallaxLinear:.15,parallaxLinearGridX:10,parallaxLinearGridY:7,parallaxLinearGridZ:4,parallaxLinearSpanX:1.6,parallaxLinearSpanY:1.6,parallaxLinearZNear:70,parallaxLinearZFar:800,parallaxLinearFocalLength:380,parallaxLinearParallaxStrength:220}},Ca={default:{label:"Default (Nebula Grid)",parallaxPerspectiveDotSizeMul:1.8,sizeVariationParallaxPerspective:0,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:8,parallaxPerspectiveSpanX:1.45,parallaxPerspectiveSpanY:1.45,parallaxPerspectiveZNear:40,parallaxPerspectiveZFar:1200,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:280,parallaxPerspectiveRandomness:.6},calm:{label:"Calm Mist",parallaxPerspectiveDotSizeMul:1.9,sizeVariationParallaxPerspective:.08,parallaxPerspectiveGridX:14,parallaxPerspectiveGridY:10,parallaxPerspectiveGridZ:6,parallaxPerspectiveSpanX:1.4,parallaxPerspectiveSpanY:1.4,parallaxPerspectiveZNear:60,parallaxPerspectiveZFar:900,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:180,parallaxPerspectiveRandomness:.25},deep:{label:"Deep Space",parallaxPerspectiveDotSizeMul:1.6,sizeVariationParallaxPerspective:.06,parallaxPerspectiveGridX:18,parallaxPerspectiveGridY:13,parallaxPerspectiveGridZ:12,parallaxPerspectiveSpanX:1.55,parallaxPerspectiveSpanY:1.55,parallaxPerspectiveZNear:30,parallaxPerspectiveZFar:2200,parallaxPerspectiveFocalLength:520,parallaxPerspectiveParallaxStrength:340,parallaxPerspectiveRandomness:.55},wild:{label:"Wild Nebula",parallaxPerspectiveDotSizeMul:1.7,sizeVariationParallaxPerspective:.18,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:10,parallaxPerspectiveSpanX:1.6,parallaxPerspectiveSpanY:1.6,parallaxPerspectiveZNear:20,parallaxPerspectiveZFar:1600,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:360,parallaxPerspectiveRandomness:.9},minimal:{label:"Minimal Stars",parallaxPerspectiveDotSizeMul:2.6,sizeVariationParallaxPerspective:.22,parallaxPerspectiveGridX:10,parallaxPerspectiveGridY:7,parallaxPerspectiveGridZ:5,parallaxPerspectiveSpanX:1.75,parallaxPerspectiveSpanY:1.75,parallaxPerspectiveZNear:70,parallaxPerspectiveZFar:1100,parallaxPerspectiveFocalLength:380,parallaxPerspectiveParallaxStrength:220,parallaxPerspectiveRandomness:.35}};let Pa=Math.max(1,Math.min(2,window.devicePixelRatio||1));const ka={config:{},currentMode:Ma.CRITTERS,warmupFramesRemaining:0,balls:[],canvas:null,ctx:null,container:null,mouseX:xa.OFFSCREEN_MOUSE,mouseY:xa.OFFSCREEN_MOUSE,mouseInCanvas:!1,lastPointerMoveMs:0,lastPointerMoveX:xa.OFFSCREEN_MOUSE,lastPointerMoveY:xa.OFFSCREEN_MOUSE,GE:1960,G:0,gravityScale:1,gravityMultiplier:0,gravityMultiplierPit:1.1,pitThrowSpeed:650,pitThrowSpeedJitter:.22,pitThrowAngleJitter:.16,pitThrowBatchSize:18,pitThrowIntervalMs:70,pitThrowColorPauseMs:180,pitThrowTargetYFrac:.36,pitThrowInletInset:.06,pitThrowCrossBias:.12,pitThrowSpawnSpread:.02,pitThrowAimJitter:.04,pitThrowPairChance:.35,pitThrowPairStaggerMs:18,pitThrowSpeedVar:.18,pitThrowSpreadVar:.25,REST:.69,FRICTION:.006,ballMassKg:129,MASS_BASELINE_KG:129,MASS_REST_EXP:.15,MASS_GRAVITY_EXP:.35,get DPR(){return Pa},sizeScale:1.2,sizeVariationGlobalMul:1,sizeVariationCap:.12,sizeVariationPit:0,sizeVariationPitThrows:0,sizeVariationFlies:0,sizeVariationWeightless:0,sizeVariationWater:0,sizeVariationVortex:.2,sizeVariationPingPong:0,sizeVariationMagnetic:0,sizeVariationBubbles:.2,sizeVariationKaleidoscope:0,sizeVariationOrbit3d:0,sizeVariationCritters:.2,sizeVariationNeural:0,sizeVariationLattice:0,sizeVariationParallaxLinear:0,sizeVariationParallaxPerspective:0,pitWarmupFrames:10,pitThrowsWarmupFrames:10,fliesWarmupFrames:10,weightlessWarmupFrames:10,waterWarmupFrames:10,vortexWarmupFrames:10,pingPongWarmupFrames:10,magneticWarmupFrames:10,bubblesWarmupFrames:10,kaleidoscopeWarmupFrames:10,kaleidoscope1WarmupFrames:10,kaleidoscope2WarmupFrames:10,kaleidoscope3WarmupFrames:10,orbit3dWarmupFrames:10,orbit3d2WarmupFrames:10,crittersWarmupFrames:10,neuralWarmupFrames:10,latticeWarmupFrames:10,parallaxLinearWarmupFrames:10,parallaxPerspectiveWarmupFrames:10,sizeVariation:0,responsiveScale:1,responsiveScaleMobile:.75,isMobile:!1,isMobileViewport:!1,mobileObjectReductionFactor:.7,R_MIN_BASE:6,R_MAX_BASE:24,R_MED:0,R_MIN:0,R_MAX:0,cursorSize:1,cursorColorMode:"auto",cursorColorIndex:5,cursorColorHex:"#ff4013",cursorColorLumaMax:.62,cursorColorAllowIndices:[],cursorColorDenyIndices:[],mouseTrailEnabled:!0,mouseTrailLength:18,mouseTrailSize:1.3,mouseTrailFadeMs:220,mouseTrailOpacity:.35,ballSoftness:20,ballSpacing:.08,sleepVelocityThreshold:12,sleepAngularThreshold:.18,timeToSleep:.25,critterCount:90,critterSpeed:680,critterMaxSpeed:1400,critterStepHz:5,critterStepSharpness:2.4,critterTurnNoise:2.2,critterTurnDamp:10,critterTurnSeek:10,critterAvoidRadius:90,critterAvoidForce:9500,critterEdgeAvoid:1,critterMousePull:1,critterMouseRadiusVw:30,critterRestitution:.18,critterFriction:.018,cornerRadius:42,layoutViewportWidthPx:0,containerBorderVw:0,simulationPaddingVw:0,contentPaddingVw:0,contentPaddingHorizontalRatio:1,mobileWallThicknessXFactor:1.4,mobileEdgeLabelsVisible:!0,wallRadiusVw:0,wallThicknessVw:0,noiseBackOpacity:.025,noiseFrontOpacity:.055,noiseBackOpacityDark:.12,noiseFrontOpacityDark:.08,layoutMinContentPaddingPx:16,layoutMinWallRadiusPx:28,wallInset:3,vortexSwirlStrength:420,vortexRadialPull:180,vortexBallCount:180,vortexSpeedMultiplier:1,vortexRadius:0,vortexFalloffCurve:1,vortexRotationDirection:1,vortexCoreStrength:1,vortexAccelerationZone:0,vortexOutwardPush:0,vortexFalloffRate:.0015,magneticBallCount:180,magneticStrength:65e3,magneticMaxVelocity:2800,magneticExplosionInterval:5,bubblesSpawnRate:8,bubblesRiseSpeed:150,bubblesWobble:40,bubblesMaxCount:200,bubblesDeflectRadius:0,pingPongBallCount:35,pingPongSpeed:800,pingPongCursorRadius:0,currentColors:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],currentTemplate:"industrialTeal",fliesBallCount:60,attractionPower:5e3,orbitRadius:180,swarmSpeed:.4,fliesSeparation:15e3,weightlessCount:80,weightlessInitialSpeed:250,weightlessBounce:.97,weightlessRepelRadius:220,weightlessRepelPower:22e4,weightlessRepelSoft:2.2,kaleidoscopeBallCount:23,kaleidoscopeWedges:12,kaleidoscopeMirror:1,kaleidoscopeSpeed:1,kaleidoscopeDotSizeVh:.95,kaleidoscopeDotAreaMul:.7,kaleidoscopeSpawnAreaMul:1,kaleidoscopeSizeVariance:.3,kaleidoscope1BallCount:18,kaleidoscope1Wedges:8,kaleidoscope1Speed:.8,kaleidoscope1DotSizeVh:.95,kaleidoscope1DotAreaMul:.7,kaleidoscope1SpawnAreaMul:1,kaleidoscope1SizeVariance:.3,kaleidoscope2BallCount:36,kaleidoscope2Wedges:8,kaleidoscope2Speed:1.15,kaleidoscope2DotSizeVh:.95,kaleidoscope2DotAreaMul:.7,kaleidoscope2SpawnAreaMul:1,kaleidoscope2SizeVariance:.3,kaleidoscope3BallCount:54,kaleidoscope3Wedges:8,kaleidoscope3Speed:1.55,kaleidoscope3DotSizeVh:.95,kaleidoscope3DotAreaMul:.7,kaleidoscope3SpawnAreaMul:1,kaleidoscope3SizeVariance:.3,orbit3dPreset:"serene",orbit3dMoonCount:80,orbit3dGravity:5e3,orbit3dMoonMass:1,orbit3dVelocityMult:150,orbit3dTargetOrbit:12,orbit3dMinOrbit:3,orbit3dMaxOrbit:3,orbit3dDepthScale:.8,orbit3dDamping:.02,orbit3d2MoonCount:60,orbit3d2Gravity:3e3,orbit3d2VelocityMult:200,orbit3d2MinOrbit:5,orbit3d2MaxOrbit:30,orbit3d2DepthScale:.5,orbit3d2Damping:.98,orbit3d2MoonMass:1,orbit3d2MaxSpeed:800,neuralBallCount:80,neuralLinkDistanceVw:14,neuralLineOpacity:.22,neuralWanderStrength:420,neuralMaxLinksPerBall:4,neuralDamping:.985,latticeBallCount:90,latticeSpacingVw:8.5,latticeStiffness:2.2,latticeDamping:.92,latticeDisruptRadius:600,latticeDisruptPower:25,latticeMeshWaveStrength:12,latticeMeshWaveSpeed:.8,latticeAlignment:"center",parallaxLinearDotCount:95,parallaxLinearRowPattern:"thirds",parallaxLinearSpacingPattern:"even",parallaxLinearFarPct:.42,parallaxLinearMidPct:.32,parallaxLinearFarSpeed:.15,parallaxLinearMidSpeed:.5,parallaxLinearNearSpeed:1,parallaxLinearFollowStrength:16,parallaxLinearDamping:12,parallaxPerspectiveDotCount:240,parallaxPerspectiveDepthMul:1.6,parallaxPerspectiveFocalLength:400,parallaxPerspectiveFollowStrength:16,parallaxPerspectiveDamping:12,parallaxPerspectiveZ1:1200,parallaxPerspectiveZ2:700,parallaxPerspectiveZ3:350,parallaxPerspectiveZ4:120,parallaxPerspectiveZ5:35,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:7,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:50,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:260,parallaxLinearDotSizeMul:1.8,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:8,parallaxPerspectiveSpanX:1.45,parallaxPerspectiveSpanY:1.45,parallaxPerspectiveZNear:40,parallaxPerspectiveZFar:1200,parallaxPerspectiveParallaxStrength:280,parallaxPerspectiveRandomness:.6,parallaxPerspectiveDotSizeMul:1.8,waterBallCount:300,waterDrag:.015,waterRippleSpeed:300,waterRippleStrength:18e3,waterDriftStrength:40,waterInitialVelocity:200,vortexDrag:.005,pingPongVerticalDamp:.995,magneticDamping:.98,repelRadius:120,repelPower:274e3,repelSoft:3.4,repellerEnabled:!1,cursorInfluenceRadiusVw:14,cursorInfluenceRadiusPx:140,emitterTimer:0,autoDarkModeEnabled:!0,isDarkMode:!1,chromeHarmonyMode:"site",autoDarkNightStartHour:18,autoDarkNightEndHour:6,clickCycleEnabled:!0,sceneImpactEnabled:!0,sceneImpactMul:.004,sceneImpactMobileMulFactor:1,sceneImpactOvershoot:.22,sceneImpactAnticipation:0,sceneImpactPressMs:75,sceneImpactReleaseMs:220,sceneChangeSoundEnabled:!0,sceneChangeSoundIntensity:.35,sceneChangeSoundRadius:18,brandLogoImpactMul:.014,brandLogoSquashMul:1,brandLogoOvershoot:.22,brandLogoAnticipation:0,brandLogoTiltDeg:0,brandLogoSkewDeg:0,brandLogoPressMs:75,brandLogoHoldMs:55,brandLogoReleaseMs:220,containerBorder:20,containerBorderX:20,simulationPadding:0,contentPadding:40,contentPaddingX:40,contentPaddingY:40,bgLight:"#f5f5f5",bgDark:"#0a0a0a",frameColor:"#0a0a0a",textColorLight:"#161616",textColorLightMuted:"#2f2f2f",textColorDark:"rgba(255,255,255,0.7)",textColorDarkMuted:"rgba(255,255,255,0.5)",edgeLabelColorLight:"#2f2f2f",edgeLabelColorDark:"#b3b3b3",edgeLabelInsetAdjustPx:0,linkHoverColor:"#ff4013",logoColorLight:"#161616",logoColorDark:"#d5d5d5",wallThickness:12,wallRadius:42,wallInset:3,wallPreset:"rubber",wallSoftness:50,wallBounciness:50,wallWobbleMaxDeform:45,wallWobbleStiffness:2200,wallWobbleDamping:35,wallWobbleSigma:2,wallWobbleCornerClamp:.6,wallWobbleImpactThreshold:140,wallWobbleSettlingSpeed:75,gateOverlayEnabled:!0,gateOverlayOpacity:.01,gateOverlayBlurPx:16,gateOverlayTransitionMs:800,gateOverlayTransitionOutMs:600,gateOverlayContentDelayMs:200,gateDepthScale:.96,gateDepthTranslateY:8,logoOpacityInactive:1,logoOpacityActive:.2,logoBlurInactive:0,logoBlurActive:12,getSquashMax(){return 0===this.ballSoftness?0:xa.SQUASH_MAX_BASE*(this.ballSoftness/40)},getCanvasCornerRadius(){return Math.max(0,this.cornerRadius-this.simulationPadding)}};var Fa=Object.freeze({__proto__:null,applyLayoutCSSVars:s,applyLayoutFromVwToPx:l,clearBalls:f,detectResponsiveScale:m,getBalls:()=>ka.balls,getConfig:()=>ka.config,getEffectiveDPR:()=>Pa,getGlobals:d,getLayoutViewportWidthPx:n,getMobileAdjustedCount:p,getState:()=>ka,initState:c,pxToVw:i,setCanvas:u,setEffectiveDPR:t,setMode:h,updateBallSizes:g,vwToPx:r});const Ta={industrialTeal:{label:"Industrial Teal",light:["#b7bcb7","#d0d0d0","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#6b726b","#3d453d","#8a928a","#00e6c3","#d5d5d5","#ff6b47","#5b9aff","#ffb84d"]},sunsetCoral:{label:"Sunset Coral",light:["#bdbbb8","#e8e6e3","#ffffff","#ff3b3b","#000000","#00f5d4","#1e40af","#fb923c"],dark:["#716f6b","#3f3d3a","#8e8c88","#ff6b6b","#d8d8d8","#00ffe7","#6ba3ff","#ffb570"]},violetPunch:{label:"Violet Punch",light:["#b8b7c2","#e6e5ed","#ffffff","#9333ea","#000000","#dc2626","#0ea5e9","#facc15"],dark:["#6d6c7a","#3a3845","#8b8a98","#c266ff","#dad6e8","#ff5c5c","#42d4ff","#fff066"]},citrusBlast:{label:"Citrus Blast",light:["#bfbdb5","#eae8df","#ffffff","#ea580c","#000000","#e11d48","#2563eb","#059669"],dark:["#74726a","#403e38","#918f87","#ff8c4d","#dbd9d1","#ff5c7a","#6ba3ff","#00d699"]},cobaltSpark:{label:"Cobalt Spark",light:["#b5b8be","#e3e6eb","#ffffff","#1d4ed8","#000000","#ea580c","#db2777","#d97706"],dark:["#696d75","#3a3e45","#878b93","#6b9dff","#d6dae2","#ff8c5c","#ff66b3","#ffc266"]}},La=[.5,.25,.12,.06,.03,.02,.01,.01],Da=[3,5,6,7];var Ia=Object.freeze({__proto__:null,COLOR_TEMPLATES:Ta,applyColorTemplate:L,applyCursorColorIndex:C,getColorByIndex:T,getCurrentPalette:k,getCursorCandidateIndices:S,maybeAutoPickCursorColor:P,pickRandomColor:F,populateColorSelect:D});const Ka={attackTime:.005,decayTime:.075,harmonicGain:0,filterBaseFreq:580,filterVelocityRange:400,filterQ:.18,filterMinHz:350,filterMaxHz:2800,pitchMinHz:145,pitchMaxHz:280,pitchCurve:1,reverbDecay:.14,reverbWetMix:.08,reverbHighDamp:.8,minGain:.008,maxGain:.09,masterGain:.28,voiceGainMax:.14,minTimeBetweenSounds:.012,maxPan:.15,noiseTransientEnabled:!0,noiseTransientGain:.045,noiseTransientDecay:.008,noiseTransientFilterMin:500,noiseTransientFilterMax:1800,noiseTransientQ:1.2,sparkleGain:0,sparkleRatioMin:2.3,sparkleRatioMax:4.1,sparkleDecayMul:.65,variancePitch:.06,varianceDecay:.2,varianceGain:.15,varianceFilter:.18,varianceNoise:.25,velocityNoiseScale:1.8,velocityBrightnessScale:1.4,velocityDecayScale:.65,intensityExponent:1.5,toneSafetyMinHz:130,toneSafetyMaxHz:480,toneSafetyExponent:2.2,toneSafetyHighGainAtten:.25,toneSafetyLowGainAtten:.06,toneSafetyHighBrightAtten:.45,collisionMinImpact:.58,highShelfFreq:2200,highShelfGain:-6};let Aa=null;const Oa={organicImpact:{label:"Organic Impact",description:"Warm, natural thuds with intensity dynamics",...Ka},glassMarbles:{label:"Glass Marbles",description:"Clear, glassy impacts with more presence",...Ka,pitchMinHz:260,pitchMaxHz:780,pitchCurve:1.05,filterBaseFreq:850,filterVelocityRange:600,noiseTransientGain:.065,noiseTransientFilterMin:650,noiseTransientFilterMax:2200,noiseTransientQ:1.6,decayTime:.055,intensityExponent:1.3,highShelfGain:-4.5},crystalPebbles:{label:"Crystal Pebbles ★",description:"Crisp, close, soothing micro-chimes (non-repetitive)",...Ka,pitchMinHz:420,pitchMaxHz:1600,pitchCurve:1.15,filterBaseFreq:1300,filterVelocityRange:1700,filterQ:.22,filterMaxHz:6200,decayTime:.04,intensityExponent:1.65,collisionMinImpact:.7,minTimeBetweenSounds:.018,noiseTransientGain:.02,noiseTransientDecay:.006,noiseTransientFilterMin:1200,noiseTransientFilterMax:7e3,noiseTransientQ:2.8,sparkleGain:.12,sparkleRatioMin:2.6,sparkleRatioMax:4.4,sparkleDecayMul:.55,reverbWetMix:.04,reverbDecay:.1,highShelfGain:-4,masterGain:.24},woodenBeads:{label:"Wooden Beads ★",description:"Ultra-soft, muted thuds (recommended)",...Ka,filterBaseFreq:420,filterVelocityRange:200,noiseTransientGain:.025,noiseTransientFilterMin:380,noiseTransientFilterMax:1400,noiseTransientQ:1.1,decayTime:.095,intensityExponent:1.7,collisionMinImpact:.62,highShelfGain:-7.5,reverbWetMix:.12},rubberBalls:{label:"Rubber Balls",description:"Bouncy, playful with longer decay",...Ka,pitchMinHz:160,pitchMaxHz:360,filterBaseFreq:520,filterVelocityRange:350,noiseTransientGain:.035,noiseTransientFilterMin:450,noiseTransientFilterMax:1600,noiseTransientQ:1.2,decayTime:.12,intensityExponent:1.4,reverbWetMix:.14,highShelfGain:-5},metallicClick:{label:"Metallic Click",description:"Crisp, percussive impacts",...Ka,pitchMinHz:220,pitchMaxHz:620,pitchCurve:1.1,filterBaseFreq:720,filterVelocityRange:550,noiseTransientGain:.08,noiseTransientFilterMin:700,noiseTransientFilterMax:2400,noiseTransientQ:1.8,noiseTransientDecay:.006,decayTime:.045,intensityExponent:1.2,highShelfGain:-3.5,collisionMinImpact:.5}};let Ra="crystalPebbles";Aa={...Oa[Ra]},delete Aa.label,delete Aa.description;let za=null,Va=null,Ea=null,Ba=null,Wa=null,$a=null,Ga=null,_a=null,Na=!1,Ha=!1;const Za="bravia-balls:sound-state",ja=8;let Ya=[],Xa=0,qa=new Map,Ua=!1,Ja=null,Qa=!1;const eo=new Map,to=12;class ao{constructor(){this.deformations=new Float32Array(to),this.velocities=new Float32Array(to),this.pressure=new Float32Array(to)}impact(e,t){const a=d(),o=Math.max(0,Math.min(.45,a.wallWobbleCornerClamp??.1)),n=11*Math.max(o,Math.min(1-o,e)),i=(a.wallWobbleMaxDeform??45)*t,r=Math.max(.25,a.wallWobbleSigma??2);for(let l=1;11>l;l++){const e=Math.abs(l-n);this.velocities[l]+=i*Math.exp(-e*e/(2*r*r))*Math.min(1,Math.min(l,11-l)/2)}}addPressure(e,t){const a=11*Math.max(.1,Math.min(.9,e)),o=Math.max(1,Math.floor(a-2)),n=Math.min(10,Math.ceil(a+2));for(let i=o;n>=i;i++)this.pressure[i]=Math.min(1,this.pressure[i]+t*Math.max(0,1-Math.abs(i-a)/3))}clearPressure(){this.pressure.fill(0)}step(e){const t=d(),a=Math.max(1,t.wallWobbleStiffness??2200),o=Math.max(0,t.wallWobbleDamping??35),n=Math.max(0,t.wallWobbleMaxDeform??45),i=Math.max(0,Math.min(100,t.wallWobbleSettlingSpeed??50))/100,r=2*Math.sqrt(a),l=5+30*i;this.deformations[0]=0,this.deformations[11]=0,this.velocities[0]=0,this.velocities[11]=0,this.pressure[0]=0,this.pressure[11]=0;const s=.5+1.5*i;for(let c=1;11>c;c++){const t=Math.abs(this.velocities[c]),i=Math.abs(this.deformations[c]);this.velocities[c]+=(-a*this.deformations[c]-Math.min(o*(1+1*Math.max(0,Math.min(1,1-i/20)))*(1+this.pressure[c]*l),.95*r)*this.velocities[c])*e,this.deformations[c]+=this.velocities[c]*e,this.deformations[c]=Math.max(0,Math.min(n,this.deformations[c])),(this.pressure[c]>.5?.3:this.pressure[c]>.1?.8:2)*s>i&&(this.pressure[c]>.5?.5:this.pressure[c]>.1?3:10)*s>t&&(this.deformations[c]=0,this.velocities[c]=0)}}getDeformAt(e){const t=11*Math.max(0,Math.min(1,e)),a=Math.floor(t),o=t-a,n=o*o*(3-2*o);return this.deformations[a]*(1-n)+this.deformations[Math.min(a+1,11)]*n}getMaxDeformation(){let e=0;for(let t=0;to>t;t++)this.deformations[t]>e&&(e=this.deformations[t]);return e}hasDeformation(){return this.getMaxDeformation()>2}reset(){this.deformations.fill(0),this.velocities.fill(0),this.pressure.fill(0)}}const oo={top:new ao,bottom:new ao,left:new ao,right:new ao,clearAllPressure(){this.top.clearPressure(),this.bottom.clearPressure(),this.left.clearPressure(),this.right.clearPressure()},step(e){this.top.step(e),this.bottom.step(e),this.left.step(e),this.right.step(e)},reset(){this.top.reset(),this.bottom.reset(),this.left.reset(),this.right.reset()},hasAnyDeformation(){return this.top.hasDeformation()||this.bottom.hasDeformation()||this.left.hasDeformation()||this.right.hasDeformation()}};let no=0;class io{constructor(e,t,a,o){const n=d();this.x=e,this.y=t,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=a,this.rBase=a,this.m=n.ballMassKg,this.color=o,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1,this.isSleeping=!1,this.sleepTimer=0,this.isGrounded=!1,this.hasSupport=!1,this.$="ball-"+no++}step(e,t){const a=d(),{currentMode:o,G:n,gravityScale:i,FRICTION:r,MASS_BASELINE_KG:l}=a;if(this.t+=e,this.age+=e,this.isSleeping&&(o===Ma.PIT||o===Ma.PIT_THROWS)){const e=(a.repelRadius||710)*a.DPR*1.2,t=this.x-a.mouseX,o=this.y-a.mouseY;e*e>t*t+o*o&&this.wake()}if(this.isSleeping)return;const s=a.DPR||1,c=this.isGrounded,p=this.hasSupport;this.isGrounded=!1,this.hasSupport=!1,o!==Ma.WEIGHTLESS&&(!c&&!p||-8*s>this.vy)&&(this.vy+=n*i*e);const u=Math.max(.25,this.m/l),h=Math.max(0,1-(o===Ma.WEIGHTLESS||o===Ma.ORBIT_3D||o===Ma.ORBIT_3D_2?0:r)*(1+1*Math.max(0,Math.min(1,1-Math.sqrt(this.vx*this.vx+this.vy*this.vy)/(100*s))))/u);if(this.vx*=h,this.vy*=h,o!==Ma.ORBIT_3D&&o!==Ma.ORBIT_3D_2){const e=2*s;e>Math.abs(this.vx)&&(this.vx=0),e>Math.abs(this.vy)&&o===Ma.WEIGHTLESS&&(this.vy=0)}0!==this.driftAx&&this.driftTime>this.age?this.vx+=this.driftAx*e/u:0!==this.driftAx&&(this.driftAx=0),t&&t(this,e),this.x+=this.vx*e,this.y+=this.vy*e,this.omega*=Math.max(0,1-xa.SPIN_DAMP_PER_S*(1+.5*Math.max(0,Math.min(1,1-Math.abs(this.omega)/2)))*e),this.theta+=this.omega*e,.01>Math.abs(this.omega)&&(this.omega=0),this.squashAmount+=(0-this.squashAmount)*Math.min(1,xa.SQUASH_DECAY_PER_S*e),this.squash=1-this.squashAmount}updateSleepState(e,t){const a=Math.sqrt(this.vx*this.vx+this.vy*this.vy),o=Math.abs(this.omega),n=t.DPR||1,i=(Number.isFinite(t.sleepVelocityThreshold)?t.sleepVelocityThreshold:xa.SLEEP_VELOCITY_THRESHOLD)*n,r=Number.isFinite(t.sleepAngularThreshold)?t.sleepAngularThreshold:xa.SLEEP_ANGULAR_THRESHOLD,l=Number.isFinite(t.timeToSleep)?t.timeToSleep:xa.TIME_TO_SLEEP;(this.isGrounded||this.hasSupport)&&i>a&&r>o?(this.sleepTimer+=e,l>this.sleepTimer||(this.vx=0,this.vy=0,this.omega=0,this.isSleeping=!0)):this.sleepTimer=0}wake(){this.isSleeping=!1,this.sleepTimer=0}walls(e,t,a,o,n={}){const i=!1!==n.registerEffects,r=d(),{REST:l,MASS_BASELINE_KG:s,MASS_REST_EXP:c,currentMode:p,DPR:u}=r,h=void 0!==o?o:l,f=r.wallWobbleImpactThreshold??xa.WALL_REST_VEL_THRESHOLD,m=this.r*(1+(r.ballSpacing||0)),g="function"==typeof r.getCanvasCornerRadius?r.getCanvasCornerRadius():r.cornerRadius??r.wallRadius??42,b=Math.max(0,g)*(u||1),M=Math.max(0,r.wallInset??3)*(u||1),y=Math.max(0,b-M);let v=!1;const x=[{cx:b,cy:b},{cx:e-b,cy:b},{cx:b,cy:t-b},{cx:e-b,cy:t-b}];for(let d=0;x.length>d;d++){if((p===Ma.PIT||p===Ma.PIT_THROWS)&&2>d)continue;const a=x[d];if((d%2==0?b>this.x:this.x>e-b)&&(2>d?b>this.y:this.y>t-b)){const e=this.x-a.cx,t=this.y-a.cy,o=Math.sqrt(e*e+t*t),n=y-m;if(o>n&&n>0){v=!0;const a=o-n,i=e/o,r=t/o;this.x-=i*a,this.y-=r*a;const l=this.vx*i+this.vy*r;l>0&&(this.vx-=(1+h)*l*i,this.vy-=(1+h)*l*r)}}}const w=M,S=e-M,C=M,P=t-M;if(this.y+m>P){v=!0,this.isGrounded=!0,this.y=P-m;const t=this.vy,o=this.vx-this.omega*this.r,n=Math.max(.25,this.m/s);this.omega+=o/this.r*xa.SPIN_GAIN/n,this.vx*=Math.max(0,1-xa.ROLL_FRICTION_PER_S*(1+1*Math.max(0,Math.min(1,1-Math.abs(this.vx)/(80*u))))*a/n),3*u>Math.abs(this.vx)&&(this.vx=0),this.vy=(f>Math.abs(t)?0:h)*Math.pow(s/this.m,c)*-this.vy;const l=Math.min(1,Math.abs(t)/(90*this.r));if(this.squashAmount=Math.min(r.getSquashMax(),.8*l),this.squashNormalAngle=-Math.PI/2,this.omega+=(this.vx/this.r-this.omega)*Math.min(1,xa.GROUND_COUPLING_PER_S*a),.05>Math.abs(this.omega)&&(this.omega=0),i){R(this.r,.7*l,this.x/e,this.$),this.isSleeping||0>=t||f>t||j("bottom",this.x/e,l);const a=this.isSleeping?1:Math.min(1,(f-Math.abs(t))/f);a>.1&&Y("bottom",this.x/e,a)}}if(p!==Ma.PIT&&p!==Ma.PIT_THROWS&&C>this.y-m){v=!0,this.y=C+m;const t=this.vy;this.vy=-this.vy*h;const a=Math.min(1,Math.abs(t)/(90*this.r));if(this.squashAmount=Math.min(r.getSquashMax(),.8*a),this.squashNormalAngle=Math.PI/2,i){R(this.r,.7*a,this.x/e,this.$),this.isSleeping||t>=0||f>Math.abs(t)||j("top",this.x/e,a);const o=this.isSleeping?1:Math.min(1,(f-Math.abs(t))/f);o>.1&&Y("top",this.x/e,o)}}if(this.x+m>S){v=!0,this.x=S-m;const e=this.vx;this.omega+=(this.vy-this.omega*this.r)/this.r*.5*xa.SPIN_GAIN/Math.max(.25,this.m/s),this.vx=l*Math.pow(s/this.m,c)*-this.vx;const a=Math.min(1,Math.abs(e)/(70*this.r));if(this.squashAmount=Math.min(r.getSquashMax(),.8*a),this.squashNormalAngle=Math.PI,i){R(this.r,.6*a,1,this.$),this.isSleeping||0>=e||f>e||j("right",this.y/t,a);const o=this.isSleeping?1:Math.min(1,(f-Math.abs(e))/f);o>.1&&Y("right",this.y/t,o)}}if(w>this.x-m){v=!0,this.x=w+m;const e=this.vx;this.omega+=(this.vy-this.omega*this.r)/this.r*.5*xa.SPIN_GAIN/Math.max(.25,this.m/s),this.vx=l*Math.pow(s/this.m,c)*-this.vx;const a=Math.min(1,Math.abs(e)/(70*this.r));if(this.squashAmount=Math.min(r.getSquashMax(),.8*a),this.squashNormalAngle=0,i){R(this.r,.6*a,0,this.$),this.isSleeping||e>=0||f>Math.abs(e)||j("left",this.y/t,a);const o=this.isSleeping?1:Math.min(1,(f-Math.abs(e))/f);o>.1&&Y("left",this.y/t,o)}}v&&this.isSleeping&&this.wake()}draw(e){const t=this.squashAmount>.001,a=1>this.alpha;t||a?(e.save(),e.translate(this.x,this.y),t?(e.rotate(this.theta+this.squashNormalAngle),e.scale(1-.3*this.squashAmount,1+.3*this.squashAmount),e.rotate(-this.squashNormalAngle)):e.rotate(this.theta),a&&(e.globalAlpha=this.alpha),e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI),e.fillStyle=this.color,e.fill(),e.restore()):(e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.r,0,2*Math.PI),e.fill())}}const ro=[];let lo,so,co=xa.DPR,po=0,uo=0,ho=null,fo=null,mo=0,go=0,bo=0;const Mo=2*Math.PI,yo=1e-6;let vo=0,xo=0;var wo=Object.freeze({__proto__:null,MODES:Ma,getForceApplicator:Ze,getModeRenderer:Ye,getModeUpdater:je,resetCurrentMode:He,setMode:Ne});let So=0,Co=null,Po=null,ko=null,Fo=0,To=0;const Lo=xa.PHYSICS_DT;let Do=0;const Io=42,Ko=1/60,Ao=(()=>{try{return{log:console.log?.bind(console)??(()=>{}),info:console.info?.bind(console)??(()=>{}),warn:console.warn?.bind(console)??(()=>{}),error:console.error?.bind(console)??(()=>{}),debug:console.debug?.bind(console)??(()=>{}),groupCollapsed:console.groupCollapsed?.bind(console)??(()=>{}),groupEnd:console.groupEnd?.bind(console)??(()=>{}),table:console.table?.bind(console)??(()=>{})}}catch(e){return{log(){},info(){},warn(){},error(){},debug(){},groupCollapsed(){},groupEnd(){},table(){}}}})();let Oo=null,Ro=0,zo="undefined"!=typeof performance&&performance.now?performance.now():Date.now(),Vo=!1;const Eo=["#b7bcb7","#d0d0d0","#ffffff","#00695c","#1a1a1a","#ff4013","#0d5cb6","#ffa000"],Bo=[.5,.25,.12,.06,.03,.02,.01,.01];let Wo=null,$o=null,Go="auto",_o="light",No=!1;var Ho=Object.freeze({__proto__:null,getCurrentTheme:()=>Go,initializeDarkMode:ht,setTheme:ut,toggleDarkMode:ft});let Zo=null,jo={};(()=>{try{const e=localStorage.getItem("panel_control_visibility");e&&(jo=JSON.parse(e))}catch(e){jo={}}})();const Yo={environment:{title:"Browser",icon:"🧭",defaultOpen:!1,controls:[{id:"chromeHarmonyMode",label:"Chrome Harmony",stateKey:"chromeHarmonyMode",type:"select",options:[{value:"auto",label:"Auto (adapt only when needed)"},{value:"site",label:"Site (benchmark)"},{value:"browser",label:"Browser (force adapt)"}],default:"site",format:e=>e+"",parse:e=>e+"",hint:"If desktop browsers ignore theme-color, the wall adapts to match the browser UI palette.",onChange(){Promise.resolve().then(()=>Ho).then(({getCurrentTheme:e,setTheme:t})=>{t(e())}).catch(()=>{})}},{id:"autoDarkModeEnabled",label:"Auto Dark (Night)",stateKey:"autoDarkModeEnabled",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,hint:"In Auto theme, prefer Dark during the night window (privacy-first: local clock only).",onChange(){Promise.resolve().then(()=>Ho).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}},{id:"autoDarkNightStartHour",label:"Night Starts",stateKey:"autoDarkNightStartHour",type:"range",min:0,max:23,step:1,default:18,format:e=>Math.round(e)+":00",parse:e=>parseInt(e,10),onChange(){Promise.resolve().then(()=>Ho).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}},{id:"autoDarkNightEndHour",label:"Night Ends",stateKey:"autoDarkNightEndHour",type:"range",min:0,max:23,step:1,default:6,format:e=>Math.round(e)+":00",parse:e=>parseInt(e,10),onChange(){Promise.resolve().then(()=>Ho).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}}]},balls:{title:"Balls",icon:"🎱",defaultOpen:!1,controls:[{id:"sizeGlobal",label:"Size",stateKey:"sizeScale",type:"range",min:.1,max:6,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat,onChange(e){Promise.resolve().then(()=>Fa).then(({updateBallSizes:t})=>{t();const a=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=a,e.rBase=a})}),Promise.resolve().then(()=>bn).then(({updateCursorSize:e})=>{e()})}},{id:"responsiveScaleMobile",label:"Mobile Scale",stateKey:"responsiveScaleMobile",type:"range",min:.5,max:1.5,step:.05,default:.75,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Ball size multiplier for iPad/iPhone (requires reload)",onChange(e){Promise.resolve().then(()=>Fa).then(({detectResponsiveScale:t})=>{t();const a=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=a,e.rBase=a})})}},{id:"mobileObjectReductionFactor",label:"Mobile Density",stateKey:"mobileObjectReductionFactor",type:"range",min:0,max:1,step:.05,default:.7,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Scales object counts on mobile (0% = none). Resets the current mode.",onChange(e){Promise.resolve().then(()=>wo).then(({setMode:t})=>{t(e.currentMode)}).catch(()=>{})}},{id:"ballSoftnessGlobal",label:"Softness",stateKey:"ballSoftness",type:"range",min:0,max:100,step:1,default:20,format:e=>e+"",parse:e=>parseInt(e,10)},{id:"ballSpacing",label:"Spacing",stateKey:"ballSpacing",type:"range",min:0,max:.5,step:.01,default:.08,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Collision gap as % of ball radius (affects physics)"},{id:"sizeVariationGlobalMul",label:"Variation Scale",stateKey:"sizeVariationGlobalMul",type:"range",min:0,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Global multiplier for per-mode size variation",onChange(){Promise.resolve().then(()=>Fa).then(({updateBallSizes:e})=>{e()})}},{id:"sizeVariationCap",label:"Variation Cap",stateKey:"sizeVariationCap",type:"range",min:0,max:.5,step:.01,default:.12,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Max radius deviation from medium (12% = ±12%)",onChange(){Promise.resolve().then(()=>Fa).then(({updateBallSizes:e})=>{e()})}}]},cursor:{title:"Cursor",icon:"👆",defaultOpen:!1,controls:[{id:"cursorSize",label:"Size",stateKey:"cursorSize",type:"range",min:.1,max:3,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,onChange(){Promise.resolve().then(()=>bn).then(({updateCursorSize:e})=>{e()})}},{id:"cursorInfluenceRadiusVw",label:"Influence Radius",stateKey:"cursorInfluenceRadiusVw",type:"range",min:0,max:80,step:.5,default:14,format:e=>e.toFixed(1)+"vw",parse:parseFloat,hint:"Universal cursor interaction zone (scales with viewport width)."}]},trail:{title:"Trail",icon:"✨",defaultOpen:!1,controls:[{id:"mouseTrailEnabled",label:"Enabled",stateKey:"mouseTrailEnabled",type:"checkbox",default:!0},{id:"mouseTrailLength",label:"Length",stateKey:"mouseTrailLength",type:"range",min:4,max:96,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),hint:"Max samples kept (higher = smoother, slightly more work)"},{id:"mouseTrailSize",label:"Size",stateKey:"mouseTrailSize",type:"range",min:.5,max:10,step:.1,default:1.3,format:e=>e.toFixed(1)+"px",parse:parseFloat},{id:"mouseTrailFadeMs",label:"Fade",stateKey:"mouseTrailFadeMs",type:"range",min:40,max:1200,step:10,default:220,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10)},{id:"mouseTrailOpacity",label:"Opacity",stateKey:"mouseTrailOpacity",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat}]},scene:{title:"Scene",icon:"⬚",defaultOpen:!1,controls:[{id:"sceneImpactEnabled",label:"Enabled",stateKey:"sceneImpactEnabled",type:"checkbox",default:!0,hint:"If disabled, mode changes will not animate the scene."},{id:"sceneImpactMul",label:"Click Depth",stateKey:"sceneImpactMul",type:"range",min:0,max:.05,step:.001,default:.004,format:e=>e.toFixed(3),parse:parseFloat,hint:"How far the entire scene “presses in” on simulation change.",onChange(e,t){const a=document.getElementById("abs-scene");if(!a)return;const o=e||{},n=+o.sceneImpactMobileMulFactor;a.style.setProperty("--abs-scene-impact-mul",+t*((o.isMobile||o.isMobileViewport)&&Number.isFinite(n)&&n>0?n:1)+"")}},{id:"sceneImpactMobileMulFactor",label:"Mobile Depth ×",stateKey:"sceneImpactMobileMulFactor",type:"range",min:.25,max:3,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Multiplier applied to Click Depth on mobile-sized viewports.",onChange(e,t){const a=document.getElementById("abs-scene");if(!a)return;const o=e||{},n=+o.sceneImpactMul,i=+t;a.style.setProperty("--abs-scene-impact-mul",(Number.isFinite(n)?n:0)*((o.isMobile||o.isMobileViewport)&&Number.isFinite(i)&&i>0?i:1)+"")}},{id:"sceneImpactPressMs",label:"Press",stateKey:"sceneImpactPressMs",type:"range",min:20,max:300,step:5,default:75,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Press-in duration."},{id:"sceneImpactReleaseMs",label:"Release",stateKey:"sceneImpactReleaseMs",type:"range",min:40,max:1200,step:10,default:220,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Release duration (“bounce out” length)."},{id:"sceneImpactAnticipation",label:"Anticipation",stateKey:"sceneImpactAnticipation",type:"range",min:0,max:.6,step:.01,default:0,format:e=>e.toFixed(2),parse:parseFloat,hint:"Micro pre-pop before the click-in (0 = off)."},{id:"sceneChangeSoundEnabled",label:"Scene Sound",stateKey:"sceneChangeSoundEnabled",type:"checkbox",default:!0,hint:"Plays a soft “pebble-like” tick when switching simulations (only if sound is enabled)."},{id:"sceneChangeSoundIntensity",label:"Scene Sound Intensity",stateKey:"sceneChangeSoundIntensity",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat},{id:"sceneChangeSoundRadius",label:"Scene Sound Pitch",stateKey:"sceneChangeSoundRadius",type:"range",min:6,max:60,step:1,default:18,format:e=>""+Math.round(e),parse:e=>parseInt(e,10),hint:"Higher = lower pitch (maps like “ball size”)."}]},overlay:{title:"Overlay",icon:"🌫️",defaultOpen:!1,controls:[{id:"gateOverlayEnabled",label:"Enabled",stateKey:"gateOverlayEnabled",type:"checkbox",default:!0},{id:"gateOverlayOpacity",label:"White Wash",stateKey:"gateOverlayOpacity",type:"range",min:0,max:.1,step:.001,default:.01,format:e=>e.toFixed(3),parse:parseFloat,onChange(e,t){Promise.resolve().then(()=>wn).then(({updateOverlayOpacity:e})=>{e(t)})}},{id:"gateOverlayTransitionMs",label:"Anim In Speed",stateKey:"gateOverlayTransitionMs",type:"range",min:200,max:1500,step:50,default:800,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration for blur & depth zoom when opening",onChange(e,t){Promise.resolve().then(()=>wn).then(({updateOverlayTransition:e})=>{e(t)})}},{id:"gateOverlayTransitionOutMs",label:"Anim Out Speed",stateKey:"gateOverlayTransitionOutMs",type:"range",min:200,max:1200,step:50,default:600,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration for blur & depth zoom when closing",onChange(e,t){Promise.resolve().then(()=>wn).then(({updateOverlayTransitionOut:e})=>{e(t)})}},{id:"gateOverlayContentDelayMs",label:"Content Delay",stateKey:"gateOverlayContentDelayMs",type:"range",min:0,max:1e3,step:50,default:200,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Wait before showing dialog content",onChange(e,t){Promise.resolve().then(()=>wn).then(({updateGateContentDelay:e})=>{e(t)})}},{id:"gateDepthScale",label:"Depth Scale",stateKey:"gateDepthScale",type:"range",min:.9,max:1,step:.001,default:.96,format:e=>e.toFixed(3),parse:parseFloat,hint:"Scene scale when gate opens (0.9-1.0)",onChange(e,t){Promise.resolve().then(()=>wn).then(({updateGateDepthScale:e})=>{e(t)})}},{id:"gateDepthTranslateY",label:"Depth Shift",stateKey:"gateDepthTranslateY",type:"range",min:0,max:30,step:1,default:8,format:e=>Math.round(e)+"px",parse:parseInt,hint:"Vertical shift when gate opens",onChange(e,t){Promise.resolve().then(()=>wn).then(({updateGateDepthTranslateY:e})=>{e(t)})}},{id:"logoOpacityInactive",label:"Logo Opacity Closed",stateKey:"logoOpacityInactive",type:"range",min:0,max:1,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,hint:"Logo opacity when gate is closed (1 = fully visible)",onChange(e,t){Promise.resolve().then(()=>wn).then(({updateLogoOpacityInactive:e})=>{e(t)})}},{id:"logoOpacityActive",label:"Logo Opacity Open",stateKey:"logoOpacityActive",type:"range",min:0,max:1,step:.05,default:.2,format:e=>e.toFixed(2),parse:parseFloat,hint:"Logo opacity when gate is active (0.2 = more faded)",onChange(e,t){Promise.resolve().then(()=>wn).then(({updateLogoOpacityActive:e})=>{e(t)})}},{id:"logoBlurInactive",label:"Logo Blur Closed",stateKey:"logoBlurInactive",type:"range",min:0,max:20,step:.5,default:0,format:e=>e.toFixed(1)+"px",parse:parseFloat,hint:"Logo blur when gate is closed (0 = sharp)",onChange(e,t){Promise.resolve().then(()=>wn).then(({updateLogoBlurInactive:e})=>{e(t)})}},{id:"logoBlurActive",label:"Logo Blur Open",stateKey:"logoBlurActive",type:"range",min:0,max:30,step:.5,default:12,format:e=>e.toFixed(1)+"px",parse:parseFloat,hint:"Logo blur when gate is active (12px = soft blur)",onChange(e,t){Promise.resolve().then(()=>wn).then(({updateLogoBlurActive:e})=>{e(t)})}}]},colors:{title:"Colors",icon:"🎨",defaultOpen:!1,controls:[{type:"divider",label:"Backgrounds"},{id:"bgLight",label:"Light Mode",stateKey:"bgLight",type:"color",default:"#f5f5f5",hint:"Background color for light mode",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--bg-light",t),!e.isDarkMode){a.style.setProperty("--chrome-bg",t);const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t)}}},{id:"bgDark",label:"Dark Mode",stateKey:"bgDark",type:"color",default:"#0a0a0a",hint:"Background color for dark mode",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--bg-dark",t),e.isDarkMode){a.style.setProperty("--chrome-bg",t);const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t)}}},{id:"frameColor",label:"Frame/Wall",stateKey:"frameColor",type:"color",default:"#0a0a0a",hint:"Color for the wall/frame border",onChange(e,t){const a=document.documentElement;a.style.setProperty("--frame-color-light",t),a.style.setProperty("--frame-color-dark",t),a.style.setProperty("--wall-color",t)}},{type:"divider",label:"Text · Light Mode"},{id:"textColorLight",label:"Primary",stateKey:"textColorLight",type:"color",default:"#161616",hint:"Main text color in light mode",onChange(e,t){const a=document.documentElement;a.style.setProperty("--text-color-light",t),a.style.setProperty("--text-color-light-base",t)}},{id:"textColorLightMuted",label:"Muted",stateKey:"textColorLightMuted",type:"color",default:"#2f2f2f",hint:"Secondary/muted text in light mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-light-muted",t)}},{type:"divider",label:"Text · Dark Mode"},{id:"textColorDark",label:"Primary",stateKey:"textColorDark",type:"color",default:"#b3b3b3",hint:"Main text color in dark mode",onChange(e,t){const a=document.documentElement;a.style.setProperty("--text-color-dark",t),a.style.setProperty("--text-color-dark-base",t)}},{id:"textColorDarkMuted",label:"Muted",stateKey:"textColorDarkMuted",type:"color",default:"#808080",hint:"Secondary/muted text in dark mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-dark-muted",t)}},{type:"divider",label:"Edge Labels"},{id:"edgeLabelColorLight",label:"Light Mode",stateKey:"edgeLabelColorLight",type:"color",default:"#2f2f2f",hint:"Color for the vertical edge labels in light mode",onChange(e,t){document.documentElement.style.setProperty("--edge-label-color-light",t)}},{id:"edgeLabelColorDark",label:"Dark Mode",stateKey:"edgeLabelColorDark",type:"color",default:"#b3b3b3",hint:"Color for the vertical edge labels in dark mode",onChange(e,t){document.documentElement.style.setProperty("--edge-label-color-dark",t)}},{id:"edgeLabelInsetAdjustPx",label:"Inset",stateKey:"edgeLabelInsetAdjustPx",type:"range",min:-120,max:240,step:1,default:0,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Adjusts edge label inset relative to wall. Higher = inward; lower = outward.",onChange(){Promise.resolve().then(()=>Fa).then(e=>{e.applyLayoutCSSVars()})}},{type:"divider",label:"Links"},{id:"linkHoverColor",label:"Hover Accent",stateKey:"linkHoverColor",type:"color",default:"#ff4013",hint:"Link hover color (accent)",onChange(e,t){document.documentElement.style.setProperty("--link-hover-color",t)}},{type:"divider",label:"Logo"},{id:"logoColorLight",label:"Light Mode",stateKey:"logoColorLight",type:"color",default:"#161616",hint:"Logo color in light mode",onChange(e,t){document.documentElement.style.setProperty("--logo-color-light",t)}},{id:"logoColorDark",label:"Dark Mode",stateKey:"logoColorDark",type:"color",default:"#d5d5d5",hint:"Logo color in dark mode",onChange(e,t){document.documentElement.style.setProperty("--logo-color-dark",t)}}]},wall:{title:"Wall",icon:"🏗️",defaultOpen:!1,controls:[{id:"wallPreset",label:"Material",stateKey:"wallPreset",type:"select",options:Object.keys(wa).map(e=>({value:e,label:e.charAt(0).toUpperCase()+e.slice(1)})),default:"rubber",format:e=>e.charAt(0).toUpperCase()+e.slice(1),onChange(e,t){((e,t)=>{wa[e]&&(t.wallPreset=e)})(t,e),Ft()}},{id:"frameColor",label:"Color",stateKey:"frameColor",type:"color",default:"#0a0a0a",hint:"Wall/frame border color (same as Colors → Frame Color)",onChange(e,t){const a=document.documentElement;a.style.setProperty("--frame-color-light",t),a.style.setProperty("--frame-color-dark",t),a.style.setProperty("--wall-color",t)}},{id:"wallThicknessVw",label:"Thickness",stateKey:"wallThicknessVw",type:"range",min:0,max:8,step:.1,default:1.3,format:e=>e.toFixed(1)+"vw",parse:parseFloat,onChange(e,t){e.containerBorderVw=t,Promise.resolve().then(()=>Fa).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars(),Promise.resolve().then(()=>wn).then(({updateBlurFromWallThickness:e})=>{e()})})}},{id:"wallRadiusVw",label:"Corner Radius",stateKey:"wallRadiusVw",type:"range",min:0,max:12,step:.1,default:3.7,format:e=>e.toFixed(1)+"vw",parse:parseFloat,onChange(){Promise.resolve().then(()=>Fa).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars()})}},{id:"wallInset",label:"Collision Inset",stateKey:"wallInset",type:"range",min:0,max:20,step:1,default:2,format:e=>e+"px",parse:e=>parseInt(e,10),hint:"Physics padding inside the visual wall"},{id:"mobileWallThicknessXFactor",label:"Mobile L/R Thickness",stateKey:"mobileWallThicknessXFactor",type:"range",min:.5,max:3,step:.05,default:1.4,format:e=>e.toFixed(2)+"×",parse:parseFloat,hint:"Wall thickness multiplier for LEFT/RIGHT sides on mobile",onChange(){Promise.resolve().then(()=>Fa).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars()})}},{id:"mobileEdgeLabelsVisible",label:"Mobile Edge Labels",stateKey:"mobileEdgeLabelsVisible",type:"toggle",default:!0,hint:"Show side edge labels on mobile (chapter/copyright)",onChange(){Promise.resolve().then(()=>Fa).then(e=>{e.applyLayoutCSSVars()})}},{id:"mobileEdgeLabelSizeFactor",label:"Mobile Label Size",stateKey:"mobileEdgeLabelSizeFactor",type:"range",min:.3,max:2,step:.05,default:.85,format:e=>e.toFixed(2)+"×",parse:parseFloat,hint:"Font size multiplier for edge labels on mobile",onChange(){Promise.resolve().then(()=>Fa).then(e=>{e.applyLayoutCSSVars()})}},{id:"mobileEdgeLabelOpacity",label:"Mobile Label Opacity",stateKey:"mobileEdgeLabelOpacity",type:"range",min:0,max:1,step:.05,default:.5,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,hint:"Opacity for edge labels on mobile",onChange(){Promise.resolve().then(()=>Fa).then(e=>{e.applyLayoutCSSVars()})}},{id:"wallWobbleMaxDeform",label:"Strength (Max Deform)",stateKey:"wallWobbleMaxDeform",type:"range",min:0,max:150,step:1,default:45,format:e=>e+"px",parse:e=>parseInt(e,10),group:"Advanced Physics",groupCollapsed:!0},{id:"wallWobbleStiffness",label:"Stiffness",stateKey:"wallWobbleStiffness",type:"range",min:50,max:3e3,step:10,default:2200,format:e=>e+"",parse:e=>parseInt(e,10),group:"Advanced Physics"},{id:"wallWobbleDamping",label:"Damping",stateKey:"wallWobbleDamping",type:"range",min:0,max:80,step:1,default:35,format:e=>e+"",parse:e=>parseInt(e,10),group:"Advanced Physics"},{id:"wallWobbleSigma",label:"Impact Spread",stateKey:"wallWobbleSigma",type:"range",min:.5,max:4,step:.1,default:2,format:e=>e.toFixed(1),parse:parseFloat,group:"Advanced Physics"},{id:"wallWobbleCornerClamp",label:"Corner Stickiness",stateKey:"wallWobbleCornerClamp",type:"range",min:0,max:1,step:.01,default:.6,format:e=>e.toFixed(2),parse:parseFloat,group:"Advanced Physics"},{id:"wallWobbleImpactThreshold",label:"Impact Threshold",stateKey:"wallWobbleImpactThreshold",type:"range",min:20,max:200,step:1,default:140,format:e=>e+" px/s",parse:e=>parseInt(e,10),group:"Advanced Physics",hint:"Minimum velocity to trigger wall wobble"},{id:"wallWobbleSettlingSpeed",label:"Settling Speed",stateKey:"wallWobbleSettlingSpeed",type:"range",min:0,max:100,step:1,default:75,format:e=>e+"%",parse:e=>parseInt(e,10),group:"Advanced Physics",hint:"How aggressively walls stop moving"}]},noise:{title:"Noise",icon:"📺",defaultOpen:!1,controls:[{id:"noiseSizeBase",label:"Back Size",stateKey:"noiseSizeBase",type:"range",min:50,max:200,step:5,default:100,format:e=>e+"",parse:e=>parseInt(e,10),cssVar:"--noise-size-base"},{id:"noiseSizeTop",label:"Front Size",stateKey:"noiseSizeTop",type:"range",min:40,max:150,step:5,default:80,format:e=>e+"",parse:e=>parseInt(e,10),cssVar:"--noise-size-top"},{id:"noiseBackOpacity",label:"Back Opacity (Light)",stateKey:"noiseBackOpacity",type:"range",min:0,max:.3,step:.005,default:.025,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-back-opacity"},{id:"noiseFrontOpacity",label:"Front Opacity (Light)",stateKey:"noiseFrontOpacity",type:"range",min:0,max:.3,step:.005,default:.055,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-front-opacity"},{id:"noiseBackOpacityDark",label:"Back Opacity (Dark)",stateKey:"noiseBackOpacityDark",type:"range",min:0,max:.5,step:.005,default:.12,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-back-opacity-dark"},{id:"noiseFrontOpacityDark",label:"Front Opacity (Dark)",stateKey:"noiseFrontOpacityDark",type:"range",min:0,max:.5,step:.005,default:.08,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-front-opacity-dark"}]},critters:{title:"Critters",icon:"🪲",mode:"critters",defaultOpen:!1,controls:[{id:"critterCount",label:"Count",stateKey:"critterCount",type:"range",min:10,max:260,step:5,default:90,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"critterSpeed",label:"Speed",stateKey:"critterSpeed",type:"range",min:0,max:1800,step:10,default:680,format:e=>""+Math.round(e),parse:parseFloat},{id:"critterMaxSpeed",label:"Max Speed",stateKey:"critterMaxSpeed",type:"range",min:200,max:4e3,step:25,default:1400,format:e=>""+Math.round(e),parse:parseFloat},{id:"critterStepHz",label:"Step Rate",stateKey:"critterStepHz",type:"range",min:0,max:16,step:.1,default:5,format:e=>e.toFixed(1)+" Hz",parse:parseFloat},{id:"critterStepSharpness",label:"Step Sharpness",stateKey:"critterStepSharpness",type:"range",min:.5,max:6,step:.1,default:2.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnNoise",label:"Wander",stateKey:"critterTurnNoise",type:"range",min:0,max:8,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnDamp",label:"Turn Inertia",stateKey:"critterTurnDamp",type:"range",min:.5,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnSeek",label:"Steering",stateKey:"critterTurnSeek",type:"range",min:0,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterAvoidRadius",label:"Avoid Radius",stateKey:"critterAvoidRadius",type:"range",min:0,max:260,step:5,default:90,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"critterAvoidForce",label:"Avoid Force",stateKey:"critterAvoidForce",type:"range",min:0,max:25e3,step:250,default:9500,format:e=>Math.round(e)+"",parse:parseFloat},{id:"critterEdgeAvoid",label:"Edge Avoid",stateKey:"critterEdgeAvoid",type:"range",min:0,max:3,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat},{id:"critterMousePull",label:"Mouse Fear",stateKey:"critterMousePull",type:"range",min:0,max:4,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Flee strength inside the mouse zone"},{id:"critterMouseRadiusVw",label:"Mouse Zone",stateKey:"critterMouseRadiusVw",type:"range",min:0,max:80,step:1,default:30,format:e=>Math.round(e)+"vw",parse:parseFloat},{id:"critterRestitution",label:"Bounciness",stateKey:"critterRestitution",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat,hint:"Mode-only override",onChange(e,t){"critters"===e.currentMode&&(e.REST=t)}},{id:"critterFriction",label:"Friction",stateKey:"critterFriction",type:"range",min:0,max:.06,step:.001,default:.018,format:e=>e.toFixed(3),parse:parseFloat,hint:"Mode-only override",onChange(e,t){"critters"===e.currentMode&&(e.FRICTION=t)}},vt("crittersWarmupFrames")]},pit:{title:"Ball Pit",icon:"🎯",mode:"pit",defaultOpen:!1,controls:[{id:"gravityPit",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange(e,t){"pit"===e.currentMode&&(e.G=e.GE*t)}},{id:"weightPit",label:"Weight",stateKey:"ballMassKg",type:"range",min:10,max:200,step:1,default:129,format:e=>e.toFixed(0),parse:parseFloat,onChange(e,t){e.balls.forEach(e=>{e.m=t})}},{id:"restitution",label:"Bounciness",stateKey:"REST",type:"range",min:0,max:1,step:.01,default:.69,format:e=>e.toFixed(2),parse:parseFloat},{id:"friction",label:"Air Friction",stateKey:"FRICTION",type:"range",min:0,max:.01,step:5e-4,default:.006,format:e=>e.toFixed(4),parse:parseFloat},{id:"repelPower",label:"Repel Power",stateKey:"repelPower",type:"range",min:0,max:1e4,step:100,default:8500,format:e=>""+Math.round(e),parse:parseFloat,onChange(e,t){e.repelPower=24e3*Math.pow(2,12*(Math.max(0,Math.min(1e4,t))/1e4-.5))}},{id:"sleepVelocityThreshold",label:"Sleep Speed",stateKey:"sleepVelocityThreshold",type:"range",min:0,max:40,step:.5,default:12,format:e=>(+e).toFixed(1)+" px/s",parse:parseFloat,hint:"Pit modes only. Higher = settles sooner."},{id:"sleepAngularThreshold",label:"Sleep Spin",stateKey:"sleepAngularThreshold",type:"range",min:0,max:1,step:.01,default:.18,format:e=>(+e).toFixed(2)+" rad/s",parse:parseFloat,hint:"Pit modes only. Higher = stops spinning sooner."},{id:"timeToSleep",label:"Sleep Time",stateKey:"timeToSleep",type:"range",min:.05,max:2,step:.05,default:.25,format:e=>(+e).toFixed(2)+"s",parse:parseFloat,hint:"Pit modes only. Lower = sleeps faster."},vt("pitWarmupFrames")]},pitThrows:{title:"Ball Pit (Throws)",icon:"🎯",mode:"pit-throws",defaultOpen:!1,controls:[{id:"gravityPitThrows",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange(e,t){"pit-throws"===e.currentMode&&(e.G=e.GE*t)}},{id:"pitThrowsSpeed",label:"Throw Speed",stateKey:"pitThrowSpeed",type:"range",min:100,max:2e3,step:25,default:650,format:e=>Math.round(e)+"",parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpeedVar",label:"Speed Variance",stateKey:"pitThrowSpeedVar",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},{id:"sleepVelocityThresholdThrows",label:"Sleep Speed",stateKey:"sleepVelocityThreshold",type:"range",min:0,max:40,step:.5,default:12,format:e=>(+e).toFixed(1)+" px/s",parse:parseFloat,hint:"Pit modes only. Higher = settles sooner."},{id:"sleepAngularThresholdThrows",label:"Sleep Spin",stateKey:"sleepAngularThreshold",type:"range",min:0,max:1,step:.01,default:.18,format:e=>(+e).toFixed(2)+" rad/s",parse:parseFloat,hint:"Pit modes only. Higher = stops spinning sooner."},{id:"timeToSleepThrows",label:"Sleep Time",stateKey:"timeToSleep",type:"range",min:.05,max:2,step:.05,default:.25,format:e=>(+e).toFixed(2)+"s",parse:parseFloat,hint:"Pit modes only. Lower = sleeps faster."},{id:"pitThrowsInterval",label:"Throw Interval",stateKey:"pitThrowIntervalMs",type:"range",min:10,max:500,step:5,default:70,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsColorPause",label:"Color Pause",stateKey:"pitThrowColorPauseMs",type:"range",min:0,max:1200,step:10,default:180,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsPairChance",label:"Pair Chance",stateKey:"pitThrowPairChance",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsPairStagger",label:"Pair Stagger",stateKey:"pitThrowPairStaggerMs",type:"range",min:0,max:120,step:1,default:18,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsBatchSize",label:"Batch Size",stateKey:"pitThrowBatchSize",type:"range",min:1,max:60,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"pitThrowsTargetYFrac",label:"Throw Aim (Y)",stateKey:"pitThrowTargetYFrac",type:"range",min:.12,max:.7,step:.01,default:.36,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAngleJitter",label:"Angle Jitter",stateKey:"pitThrowAngleJitter",type:"range",min:0,max:.6,step:.01,default:.16,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpreadVar",label:"Spread Variance",stateKey:"pitThrowSpreadVar",type:"range",min:0,max:.8,step:.01,default:.25,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsSpeedJitter",label:"Speed Jitter",stateKey:"pitThrowSpeedJitter",type:"range",min:0,max:.8,step:.01,default:.22,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsInletInset",label:"Inlet Inset",stateKey:"pitThrowInletInset",type:"range",min:0,max:.2,step:.005,default:.06,format:e=>e.toFixed(3),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpawnSpread",label:"Spawn Spread",stateKey:"pitThrowSpawnSpread",type:"range",min:0,max:.12,step:.0025,default:.02,format:e=>e.toFixed(4),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAimJitter",label:"Aim Jitter",stateKey:"pitThrowAimJitter",type:"range",min:0,max:.2,step:.005,default:.04,format:e=>e.toFixed(3),parse:parseFloat},{id:"pitThrowsCrossBias",label:"Cross Aim",stateKey:"pitThrowCrossBias",type:"range",min:0,max:.3,step:.005,default:.12,format:e=>e.toFixed(3),parse:parseFloat},vt("pitThrowsWarmupFrames")]},flies:{title:"Flies",icon:"🕊️",mode:"flies",defaultOpen:!1,controls:[{id:"fliesBallCount",label:"Ball Count",stateKey:"fliesBallCount",type:"range",min:20,max:150,step:5,default:60,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"attractPower",label:"Attraction",stateKey:"attractionPower",type:"range",min:100,max:8e3,step:50,default:5e3,format:e=>""+Math.round(e),parse:parseFloat},{id:"swarmSpeed",label:"Swarm Speed",stateKey:"swarmSpeed",type:"range",min:.2,max:5,step:.1,default:.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"fliesSeparation",label:"Separation",stateKey:"fliesSeparation",type:"range",min:5e3,max:3e4,step:1e3,default:15e3,format:e=>""+Math.round(e),parse:parseFloat},vt("fliesWarmupFrames")]},weightless:{title:"Zero-G",icon:"🌌",mode:"weightless",defaultOpen:!1,controls:[{id:"weightlessCount",label:"Ball Count",stateKey:"weightlessCount",type:"range",min:20,max:200,step:10,default:80,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"weightlessSpeed",label:"Initial Speed",stateKey:"weightlessInitialSpeed",type:"range",min:100,max:600,step:25,default:250,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"weightlessBounce",label:"Bounce",stateKey:"weightlessBounce",type:"range",min:.5,max:1,step:.05,default:.95,format:e=>e.toFixed(2),parse:parseFloat},{id:"weightlessRepelPower",label:"Cursor Blast Power",stateKey:"weightlessRepelPower",type:"range",min:0,max:6e5,step:1e4,default:22e4,format:e=>""+Math.round(e),parse:parseFloat},{id:"weightlessRepelSoft",label:"Cursor Blast Falloff",stateKey:"weightlessRepelSoft",type:"range",min:.5,max:6,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},vt("weightlessWarmupFrames")]},water:{title:"Water",icon:"🌊",mode:"water",defaultOpen:!1,controls:[{id:"waterBallCount",label:"Ball Count",stateKey:"waterBallCount",type:"range",min:50,max:400,step:10,default:300,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"waterDrag",label:"Water Resistance",stateKey:"waterDrag",type:"range",min:.001,max:.05,step:.001,default:.015,format:e=>e.toFixed(3),parse:parseFloat},{id:"waterRippleStrength",label:"Ripple Strength",stateKey:"waterRippleStrength",type:"range",min:5e3,max:3e4,step:1e3,default:18e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"waterMotion",label:"Drift Strength",stateKey:"waterDriftStrength",type:"range",min:0,max:80,step:1,default:40,format:e=>e.toFixed(0),parse:parseFloat,onChange(e,t){e.waterInitialVelocity=5*t},reinitMode:!0},vt("waterWarmupFrames")]},vortex:{title:"Vortex",icon:"🌀",mode:"vortex",defaultOpen:!1,controls:[{id:"vortexBallCount",label:"Ball Count",stateKey:"vortexBallCount",type:"range",min:50,max:500,step:10,default:180,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"vortexSwirl",label:"Swirl Strength",stateKey:"vortexSwirlStrength",type:"range",min:100,max:3e3,step:50,default:420,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexPull",label:"Radial Pull",stateKey:"vortexRadialPull",type:"range",min:0,max:2e3,step:20,default:180,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexSpeedMultiplier",label:"Speed Multiplier",stateKey:"vortexSpeedMultiplier",type:"range",min:.1,max:3,step:.1,default:1,format:e=>e.toFixed(1),parse:parseFloat},{id:"vortexRadius",label:"Vortex Radius",stateKey:"vortexRadius",type:"range",min:0,max:800,step:20,default:0,format:e=>0===e?"Unlimited":e.toFixed(0)+"px",parse:parseFloat,tooltip:"Maximum effective radius (0 = unlimited, uses distance falloff)"},{id:"vortexFalloffCurve",label:"Falloff Curve",stateKey:"vortexFalloffCurve",type:"range",min:.3,max:3,step:.1,default:1,format:e=>e.toFixed(1),parse:parseFloat,tooltip:"Falloff shape: 1.0 = linear, 2.0 = quadratic (sharper), 0.5 = gentle"},{id:"vortexRotationDirection",label:"Rotation Direction",stateKey:"vortexRotationDirection",type:"range",min:-1,max:1,step:2,default:1,format:e=>1===e?"Counterclockwise":"Clockwise",parse:parseFloat},{id:"vortexCoreStrength",label:"Core Strength",stateKey:"vortexCoreStrength",type:"range",min:.5,max:3,step:.1,default:1,format:e=>e.toFixed(1)+"x",parse:parseFloat,tooltip:"Strength multiplier at vortex center"},{id:"vortexAccelerationZone",label:"Acceleration Zone",stateKey:"vortexAccelerationZone",type:"range",min:0,max:400,step:20,default:0,format:e=>0===e?"Disabled":e.toFixed(0)+"px",parse:parseFloat,tooltip:"Radius where extra acceleration occurs (0 = disabled)"},{id:"vortexOutwardPush",label:"Outward Push",stateKey:"vortexOutwardPush",type:"range",min:0,max:1e3,step:20,default:0,format:e=>0===e?"Disabled":e.toFixed(0),parse:parseFloat,tooltip:"Outward force at edges (only when radius is set)"},{id:"vortexDrag",label:"Drag",stateKey:"vortexDrag",type:"range",min:.001,max:.05,step:.001,default:.005,format:e=>e.toFixed(3),parse:parseFloat},vt("vortexWarmupFrames")]},"ping-pong":{title:"Ping Pong",icon:"🏓",mode:"ping-pong",defaultOpen:!1,controls:[{id:"pingPongBallCount",label:"Ball Count",stateKey:"pingPongBallCount",type:"range",min:10,max:100,step:5,default:35,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"pingPongSpeed",label:"Ball Speed",stateKey:"pingPongSpeed",type:"range",min:200,max:1600,step:50,default:800,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"pingPongVerticalDamp",label:"Vertical Damping",stateKey:"pingPongVerticalDamp",type:"range",min:.8,max:.999,step:.001,default:.995,format:e=>e.toFixed(3),parse:parseFloat},vt("pingPongWarmupFrames")]},magnetic:{title:"Magnetic",icon:"🧲",mode:"magnetic",defaultOpen:!1,controls:[{id:"magneticBallCount",label:"Ball Count",stateKey:"magneticBallCount",type:"range",min:50,max:300,step:10,default:180,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"magneticStrength",label:"Strength",stateKey:"magneticStrength",type:"range",min:1e4,max:1e5,step:5e3,default:65e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticVelocity",label:"Max Velocity",stateKey:"magneticMaxVelocity",type:"range",min:500,max:4e3,step:100,default:2800,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticDamping",label:"Damping",stateKey:"magneticDamping",type:"range",min:.8,max:.999,step:.001,default:.98,format:e=>e.toFixed(3),parse:parseFloat},vt("magneticWarmupFrames")]},bubbles:{title:"Bubbles",icon:"🫧",mode:"bubbles",defaultOpen:!1,controls:[{id:"bubblesRate",label:"Bubble Rate",stateKey:"bubblesSpawnRate",type:"range",min:1,max:20,step:1,default:8,format:e=>e+"",parse:e=>parseInt(e,10)},{id:"bubblesSpeed",label:"Rise Speed",stateKey:"bubblesRiseSpeed",type:"range",min:50,max:400,step:25,default:150,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesWobble",label:"Wobble",stateKey:"bubblesWobble",type:"range",min:0,max:100,step:5,default:40,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesMax",label:"Max Bubbles",stateKey:"bubblesMaxCount",type:"range",min:50,max:300,step:10,default:150,format:e=>e+"",parse:e=>parseInt(e,10)},vt("bubblesWarmupFrames")]},tilt:{title:"Tilt",icon:"⚖️",mode:"tilt",defaultOpen:!1,controls:[{id:"tiltBallCount",label:"Particle Count",stateKey:"tiltBallCount",type:"range",min:100,max:500,step:10,default:300,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"tiltMaxAngle",label:"Max Angle",stateKey:"tiltMaxAngle",type:"range",min:.5,max:10,step:.5,default:2,format:e=>e.toFixed(1)+"°",parse:parseFloat},{id:"tiltLerpSpeed",label:"Smoothness",stateKey:"tiltLerpSpeed",type:"range",min:.01,max:.5,step:.01,default:.08,format:e=>e.toFixed(2),parse:parseFloat},{id:"tiltGlassMass",label:"Particle Mass",stateKey:"tiltGlassBallMass",type:"range",min:.02,max:.3,step:.01,default:.08,format:e=>e.toFixed(2)+"x",parse:parseFloat,reinitMode:!0},{id:"tiltFriction",label:"Friction",stateKey:"tiltFriction",type:"range",min:.002,max:.02,step:.001,default:.008,format:e=>e.toFixed(3),parse:parseFloat}]},kaleidoscope:{title:"Kaleidoscope",icon:"🪞",mode:"kaleidoscope",defaultOpen:!1,controls:[{id:"kaleiBallCount",label:"Ball Count",stateKey:"kaleidoscopeBallCount",type:"range",min:15,max:120,step:1,default:23,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kaleiWedges",label:"Wedges",stateKey:"kaleidoscopeWedges",type:"range",min:4,max:16,step:1,default:12,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kaleiMirror",label:"Mirror",type:"range",min:0,max:1,step:1,default:1,format:e=>e?"On":"Off",parse:e=>parseInt(e,10)},{id:"kaleiSpeed",label:"Speed",stateKey:"kaleidoscopeSpeed",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat},{id:"kaleiDotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscopeDotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kaleiDotAreaMul",label:"Dot Area",stateKey:"kaleidoscopeDotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kaleiSpawnArea",label:"Spawn Density",stateKey:"kaleidoscopeSpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kaleiSizeVar",label:"Size Variance",stateKey:"kaleidoscopeSizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},vt("kaleidoscopeWarmupFrames")]},kaleidoscope1:{title:"Kaleidoscope I (Variant)",icon:"🪞",mode:"kaleidoscope-1",defaultOpen:!1,controls:[{id:"kalei1BallCount",label:"Ball Count",stateKey:"kaleidoscope1BallCount",type:"range",min:6,max:180,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei1Wedges",label:"Wedges",stateKey:"kaleidoscope1Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei1Speed",label:"Speed",stateKey:"kaleidoscope1Speed",type:"range",min:.2,max:2,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei1DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope1DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei1DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope1DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei1SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope1SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei1SizeVar",label:"Size Variance",stateKey:"kaleidoscope1SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},vt("kaleidoscope1WarmupFrames")]},kaleidoscope2:{title:"Kaleidoscope II (Variant)",icon:"🪞",mode:"kaleidoscope-2",defaultOpen:!1,controls:[{id:"kalei2BallCount",label:"Ball Count",stateKey:"kaleidoscope2BallCount",type:"range",min:10,max:260,step:2,default:36,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei2Wedges",label:"Wedges",stateKey:"kaleidoscope2Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei2Speed",label:"Speed",stateKey:"kaleidoscope2Speed",type:"range",min:.2,max:2,step:.05,default:1.15,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei2DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope2DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei2DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope2DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei2SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope2SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei2SizeVar",label:"Size Variance",stateKey:"kaleidoscope2SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},vt("kaleidoscope2WarmupFrames")]},kaleidoscope3:{title:"Kaleidoscope III (Variant)",icon:"🪞",mode:"kaleidoscope-3",defaultOpen:!1,controls:[{id:"kalei3BallCount",label:"Ball Count",stateKey:"kaleidoscope3BallCount",type:"range",min:12,max:300,step:3,default:54,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei3Wedges",label:"Wedges",stateKey:"kaleidoscope3Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei3Speed",label:"Speed",stateKey:"kaleidoscope3Speed",type:"range",min:.2,max:2,step:.05,default:1.55,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei3DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope3DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei3DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope3DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei3SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope3SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei3SizeVar",label:"Size Variance",stateKey:"kaleidoscope3SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},vt("kaleidoscope3WarmupFrames")]},orbit3d:{title:"Orbit 3D: Zero Gravity",icon:"🌪️",mode:"orbit-3d",defaultOpen:!1,controls:[{id:"orbit3dMoonCount",label:"Body Count",stateKey:"orbit3dMoonCount",type:"range",min:10,max:200,step:10,default:80,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"orbit3dGravity",label:"Gravity Pull",stateKey:"orbit3dGravity",type:"range",min:1e3,max:1e4,step:500,default:5e3,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3dVelocityMult",label:"Orbital Speed",stateKey:"orbit3dVelocityMult",type:"range",min:50,max:300,step:10,default:150,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3dDepthScale",label:"Depth Effect",stateKey:"orbit3dDepthScale",type:"range",min:0,max:1.5,step:.1,default:.8,format:e=>e.toFixed(1),parse:parseFloat},{id:"orbit3dDamping",label:"Stability",stateKey:"orbit3dDamping",type:"range",min:.005,max:.05,step:.005,default:.02,format:e=>e.toFixed(3),parse:parseFloat},{id:"sizeVariationOrbit3d",label:"Size Variation",stateKey:"sizeVariationOrbit3d",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},vt("orbit3dWarmupFrames")]},orbit3d2:{title:"Orbit 3D (Tight Swarm)",icon:"🌪️",mode:"orbit-3d-2",defaultOpen:!1,controls:[{id:"orbit3d2MoonCount",label:"Moon Count",stateKey:"orbit3d2MoonCount",type:"range",min:20,max:200,step:10,default:100,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"orbit3d2Gravity",label:"Gravity (G×M)",stateKey:"orbit3d2Gravity",type:"range",min:1e4,max:3e5,step:1e4,default:8e4,format:e=>Math.round(e/1e3)+"k",parse:parseFloat,reinitMode:!0},{id:"orbit3d2VelocityMult",label:"Initial Velocity",stateKey:"orbit3d2VelocityMult",type:"range",min:.5,max:1.5,step:.05,default:1.1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"orbit3d2MinOrbit",label:"Min Orbit (vw)",stateKey:"orbit3d2MinOrbit",type:"range",min:2,max:15,step:1,default:4,format:e=>e+"vw",parse:parseFloat,reinitMode:!0},{id:"orbit3d2MaxOrbit",label:"Max Orbit (vw)",stateKey:"orbit3d2MaxOrbit",type:"range",min:3,max:25,step:1,default:12,format:e=>e+"vw",parse:parseFloat,reinitMode:!0},{id:"orbit3d2DepthScale",label:"Depth Effect",stateKey:"orbit3d2DepthScale",type:"range",min:0,max:.8,step:.05,default:.6,format:e=>e.toFixed(2),parse:parseFloat},{id:"orbit3d2Damping",label:"Damping",stateKey:"orbit3d2Damping",type:"range",min:0,max:.2,step:.005,default:.01,format:e=>e.toFixed(3),parse:parseFloat},{id:"orbit3d2FollowSmoothing",label:"Cursor Follow Speed",stateKey:"orbit3d2FollowSmoothing",type:"range",min:1,max:200,step:1,default:40,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3d2Softening",label:"Gravity Softening",stateKey:"orbit3d2Softening",type:"range",min:1,max:100,step:1,default:15,format:e=>Math.round(e),parse:parseFloat},{id:"sizeVariationOrbit3d2",label:"Size Variation",stateKey:"sizeVariationOrbit3d2",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},vt("orbit3d2WarmupFrames")]},lattice:{title:"Crystal Lattice",icon:"💎",mode:"lattice",defaultOpen:!1,controls:[{id:"sizeVariationLattice",label:"Size Variation",stateKey:"sizeVariationLattice",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"latticeSpacingVw",label:"Spacing (vw)",stateKey:"latticeSpacingVw",type:"range",min:1,max:20,step:.25,default:8.5,format:e=>e.toFixed(2)+"vw",parse:parseFloat,reinitMode:!0},{id:"latticeStiffness",label:"Stiffness",stateKey:"latticeStiffness",type:"range",min:0,max:10,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},{id:"latticeDamping",label:"Damping",stateKey:"latticeDamping",type:"range",min:.5,max:1,step:.01,default:.92,format:e=>e.toFixed(2),parse:parseFloat},{id:"latticeDisruptRadius",label:"Mesh Stretch Radius",stateKey:"latticeDisruptRadius",type:"range",min:50,max:1e3,step:25,default:600,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"latticeDisruptPower",label:"Mesh Stretch Power",stateKey:"latticeDisruptPower",type:"range",min:0,max:50,step:1,default:25,format:e=>e.toFixed(1),parse:parseFloat},{id:"latticeMeshWaveStrength",label:"Wave Amplitude",stateKey:"latticeMeshWaveStrength",type:"range",min:0,max:50,step:1,default:12,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"latticeMeshWaveSpeed",label:"Wave Speed",stateKey:"latticeMeshWaveSpeed",type:"range",min:0,max:3,step:.1,default:.8,format:e=>e.toFixed(1)+"x",parse:parseFloat},{id:"latticeAlignment",label:"Grid Alignment",stateKey:"latticeAlignment",type:"select",options:[{value:"center",label:"Center (Fill)"},{value:"top-left",label:"Top-Left"},{value:"top-center",label:"Top-Center"},{value:"top-right",label:"Top-Right"}],default:"center",format:e=>e+"",parse:e=>e+"",reinitMode:!0},vt("latticeWarmupFrames")]},neural:{title:"Neural Network",icon:"🧠",mode:"neural",defaultOpen:!1,controls:[{id:"neuralBallCount",label:"Ball Count",stateKey:"neuralBallCount",type:"range",min:8,max:260,step:1,default:80,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"sizeVariationNeural",label:"Size Variation",stateKey:"sizeVariationNeural",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"neuralWanderStrength",label:"Wander Strength",stateKey:"neuralWanderStrength",type:"range",min:0,max:2e3,step:10,default:420,format:e=>Math.round(e)+"",parse:parseFloat},{id:"neuralDamping",label:"Damping",stateKey:"neuralDamping",type:"range",min:.8,max:1,step:.005,default:.985,format:e=>e.toFixed(3),parse:parseFloat},{id:"neuralCohesion",label:"Cohesion",stateKey:"neuralCohesion",type:"range",min:0,max:1,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},vt("neuralWarmupFrames")]},parallaxLinear:{title:"Parallax (Linear)",icon:"🫧",mode:"parallax-linear",defaultOpen:!1,controls:[{id:"parallaxLinearPreset",label:"Preset",stateKey:"parallaxLinearPreset",type:"select",options:Object.keys(Sa).map(e=>({value:e,label:Sa[e].label})),default:"default",format:e=>Sa[e]?.label||e,onChange(e){Mt(e,!0)}},{id:"parallaxLinearDotSizeMul",label:"Dot Size",stateKey:"parallaxLinearDotSizeMul",type:"range",min:.2,max:6,step:.1,default:1.8,format:e=>e.toFixed(1)+"×",parse:parseFloat,reinitMode:!0},{id:"sizeVariationParallaxLinear",label:"Size Variation",stateKey:"sizeVariationParallaxLinear",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"parallaxLinearGridX",label:"Grid X (Cols)",stateKey:"parallaxLinearGridX",type:"range",min:3,max:40,step:1,default:14,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearGridY",label:"Grid Y (Rows)",stateKey:"parallaxLinearGridY",type:"range",min:3,max:40,step:1,default:10,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearGridZ",label:"Grid Z (Layers)",stateKey:"parallaxLinearGridZ",type:"range",min:2,max:20,step:1,default:7,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearSpanX",label:"Span X",stateKey:"parallaxLinearSpanX",type:"range",min:.2,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0,hint:"World-space width as a multiple of the viewport width. Use >1 to fill edge-to-edge."},{id:"parallaxLinearSpanY",label:"Span Y",stateKey:"parallaxLinearSpanY",type:"range",min:.2,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0,hint:"World-space height as a multiple of the viewport height."},{id:"parallaxLinearZNear",label:"Z Near",stateKey:"parallaxLinearZNear",type:"range",min:10,max:1200,step:10,default:50,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearZFar",label:"Z Far",stateKey:"parallaxLinearZFar",type:"range",min:50,max:3e3,step:25,default:900,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearFocalLength",label:"Focal Length",stateKey:"parallaxLinearFocalLength",type:"range",min:80,max:2e3,step:10,default:420,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10)},{id:"parallaxLinearParallaxStrength",label:"Parallax Strength",stateKey:"parallaxLinearParallaxStrength",type:"range",min:0,max:2e3,step:10,default:260,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},vt("parallaxLinearWarmupFrames")]},parallaxPerspective:{title:"Parallax (Perspective)",icon:"🫧",mode:"parallax-perspective",defaultOpen:!1,controls:[{id:"parallaxPerspectivePreset",label:"Preset",stateKey:"parallaxPerspectivePreset",type:"select",options:Object.keys(Ca).map(e=>({value:e,label:Ca[e].label})),default:"default",format:e=>Ca[e]?.label||e,onChange(e){yt(e,!0)}},{id:"parallaxPerspectiveRandomness",label:"Randomness",stateKey:"parallaxPerspectiveRandomness",type:"range",min:0,max:1,step:.05,default:.6,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0,hint:"0 = perfect grid. 1 = full jitter from grid vertices."},{id:"parallaxPerspectiveDotSizeMul",label:"Dot Size",stateKey:"parallaxPerspectiveDotSizeMul",type:"range",min:.2,max:6,step:.1,default:1.8,format:e=>e.toFixed(1)+"×",parse:parseFloat,reinitMode:!0},{id:"sizeVariationParallaxPerspective",label:"Size Variation",stateKey:"sizeVariationParallaxPerspective",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveGridX",label:"Grid X (Cols)",stateKey:"parallaxPerspectiveGridX",type:"range",min:3,max:50,step:1,default:16,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveGridY",label:"Grid Y (Rows)",stateKey:"parallaxPerspectiveGridY",type:"range",min:3,max:50,step:1,default:12,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveGridZ",label:"Grid Z (Layers)",stateKey:"parallaxPerspectiveGridZ",type:"range",min:2,max:25,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveSpanX",label:"Span X",stateKey:"parallaxPerspectiveSpanX",type:"range",min:.2,max:3,step:.05,default:1.45,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveSpanY",label:"Span Y",stateKey:"parallaxPerspectiveSpanY",type:"range",min:.2,max:3,step:.05,default:1.45,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveZNear",label:"Z Near",stateKey:"parallaxPerspectiveZNear",type:"range",min:10,max:1200,step:10,default:40,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveZFar",label:"Z Far",stateKey:"parallaxPerspectiveZFar",type:"range",min:50,max:4e3,step:50,default:1200,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveFocalLength",label:"Focal Length",stateKey:"parallaxPerspectiveFocalLength",type:"range",min:80,max:2e3,step:10,default:420,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10)},{id:"parallaxPerspectiveParallaxStrength",label:"Parallax Strength",stateKey:"parallaxPerspectiveParallaxStrength",type:"range",min:0,max:2e3,step:10,default:280,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},vt("parallaxPerspectiveWarmupFrames")]}};var Xo=Object.freeze({__proto__:null,CONTROL_SECTIONS:Yo,applyParallaxLinearPreset:Mt,applyParallaxPerspectivePreset:yt,bindRegisteredControls:kt,generatePanelHTML:Pt,getAllControls:wt,isControlVisible:bt,setApplyVisualCSSVars(e){Zo=e},syncSlidersToState:Ft}),qo=Object.freeze({__proto__:null,setupControls:Tt,updateModeButtonsUI:Lt});const Uo=Pt(),Jo={core:{title:"Core",controls:[{id:"masterGain",label:"Master Volume",min:10,max:100,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"collisionMinImpact",label:"Silence Threshold",min:20,max:85,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e}]},envelope:{title:"Envelope",controls:[{id:"decayTime",label:"Click Length",min:20,max:180,step:1,format:e=>Math.round(e)+"ms",toConfig:e=>e/1e3,fromConfig:e=>1e3*e}]},tone:{title:"Tone",controls:[{id:"filterBaseFreq",label:"Brightness",min:300,max:6e3,step:50,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"harmonicGain",label:"Warmth",min:0,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"filterQ",label:"Resonance",min:10,max:200,step:5,format:e=>""+(e/100).toFixed(2),toConfig:e=>e/100,fromConfig:e=>100*e}]},crystal:{title:"Crystal",controls:[{id:"pitchMinHz",label:"Pitch Low",min:80,max:1200,step:10,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"pitchMaxHz",label:"Pitch High",min:200,max:4e3,step:20,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"pitchCurve",label:"Pitch Curve",min:70,max:160,step:1,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleGain",label:"Sparkle",min:0,max:35,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMin",label:"Sparkle Min",min:120,max:600,step:10,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMax",label:"Sparkle Max",min:160,max:800,step:10,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleDecayMul",label:"Sparkle Decay",min:20,max:95,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"noiseTransientQ",label:"Sparkle Q",min:60,max:600,step:5,format:e=>""+(e/100).toFixed(2),toConfig:e=>e/100,fromConfig:e=>100*e}]},space:{title:"Space",controls:[{id:"reverbWetMix",label:"Reverb Mix",min:0,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"reverbDecay",label:"Room Size",min:5,max:80,step:1,format:e=>(e/100).toFixed(2)+"s",toConfig:e=>e/100,fromConfig:e=>100*e}]},dynamics:{title:"Dynamics",controls:[{id:"minGain",label:"Min Hit Volume",min:0,max:20,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"maxGain",label:"Max Hit Volume",min:5,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e}]},realism:{title:"Realism",controls:[{id:"noiseTransientGain",label:"Impact Snap",min:0,max:80,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"varianceGain",label:"Volume Variance",min:0,max:50,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"variancePitch",label:"Pitch Variance",min:0,max:25,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"velocityNoiseScale",label:"Hard Hit Crack",min:100,max:500,step:10,format:e=>(e/100).toFixed(1)+"×",toConfig:e=>e/100,fromConfig:e=>100*e}]}};let Qo=null,en=null;const tn="panel_dock_position_v2",an="panel_dock_hidden",on="master_panel_collapsed",nn="panel_dock_size";let rn=!1,ln=0,sn=0,cn=0,dn=0;var pn=Object.freeze({__proto__:null,createPanelDock:Kt,resetPanelPositions:Vt,toggleDock:Et});let un=!1,hn=null,fn=!1,mn=!1,gn=0;var bn=Object.freeze({__proto__:null,hideCursor:_t,setupCustomCursor:Wt,showCursor:Nt,updateCursorPosition:Gt,updateCursorSize:$t});let Mn=null,yn=!0,vn=null;const xn=new WeakMap;var wn=Object.freeze({__proto__:null,hideOverlay:ea,initGateOverlay:qt,isOverlayActive:ta,mountGateIntoOverlay:Zt,showOverlay:Qt,unmountGateFromOverlay:jt,updateGateContentDelay(e){document.documentElement.style.setProperty("--gate-content-delay",e+"ms")},updateGateDepthScale(e){document.documentElement.style.setProperty("--gate-depth-scale",e)},updateGateDepthTranslateY(e){document.documentElement.style.setProperty("--gate-depth-translate-y",e+"px")},updateLogoBlurActive(e){const t=document.documentElement;t.style.setProperty("--logo-blur-active-target",e+"px"),ta()&&t.style.setProperty("--logo-blur-active",e+"px")},updateLogoBlurInactive(e){const t=document.documentElement;t.style.setProperty("--logo-blur-inactive",e+"px"),ta()||t.style.setProperty("--logo-blur-active",e+"px")},updateLogoOpacityActive(e){const t=document.documentElement,a=e;t.style.setProperty("--logo-opacity-active-target",a),ta()&&t.style.setProperty("--logo-opacity-active",a)},updateLogoOpacityInactive(e){const t=document.documentElement;t.style.setProperty("--logo-opacity-inactive",e),ta()||t.style.setProperty("--logo-opacity-active",e)},updateOverlayOpacity(e){Mn&&Mn.style.setProperty("--gate-overlay-opacity",e)},updateOverlayTransition(e){Mn&&(Mn.style.setProperty("--gate-overlay-transition-duration",e+"ms"),document.documentElement.style.setProperty("--gate-depth-duration",e+"ms"))},updateOverlayTransitionOut(e){Mn&&(Mn.style.setProperty("--gate-overlay-transition-out-duration",e+"ms"),document.documentElement.style.setProperty("--gate-depth-out-duration",e+"ms"))}});const Sn="--abs-scene-impact",Cn="--abs-scene-impact-dur";let Pn=null,kn=!1,Fn=0,Tn=0,Ln=0,Dn=!1,In=0,Kn=0,An=0,On=0,Rn=!1,zn=null,Vn=0,En=0,Bn=0,Wn=0,$n=0,Gn=0,_n=0,Nn=performance.now()/1e3,Hn=0,Zn=!0,jn=null;const Yn=1e3/60;let Xn=[],qn=0,Un=null;const Jn='<i class="ti ti-volume-off" aria-hidden="true"></i>';let Qn=null;const ei=new Map([["apple music",'<i class="ti ti-brand-apple" aria-hidden="true"></i>'],["instagram",'<i class="ti ti-brand-instagram" aria-hidden="true"></i>'],["linkedin",'<i class="ti ti-brand-linkedin" aria-hidden="true"></i>']]),ti=new Map([["ai integration","bg-ball-4"],["ui/ux design","bg-ball-2"],["creative strategy","bg-story-grey"],["frontend development","bg-ball-5"],["brand identity","bg-ball-8"],["3d design","bg-ball-7"],["art direction","bg-ball-6"]]);let ai=!1;(async()=>{document.documentElement.classList.add("js-enabled");try{await(async()=>{if(Un)return Un;const e=sa();if(e)return Un=e,Un;const t=await(async()=>{const e=["config/text.json","js/text.json","../public/js/text.json"];for(const a of e)try{const e=await fetch(a,{cache:"no-cache"});if(!e.ok)continue;const t=await e.json();if(la(t))return t}catch(t){}throw Error("No text.json found")})();Un=t;try{"undefined"!=typeof window&&(window.__TEXT__=t)}catch(a){}return Un})(),(()=>{try{(()=>{const e=ca("meta.title","");e&&(document.title=e);const t=ca("meta.description","");if(t){const e=document.querySelector('meta[name="description"]');e&&e.setAttribute("content",t)}})(),ma(document.getElementById("edge-chapter-text"),ca("edge.chapterText","")),ma(document.querySelector(".edge-copyright__text"),ca("edge.copyright","")),(()=>{const e=document.getElementById("expertise-legend");ga(e,"aria-label",ca("legend.ariaLabel",""));const t=ca("legend.items",null);if(!Array.isArray(t)||!e)return;const a=e.querySelectorAll(".legend__item span");for(let o=0;a.length>o&&t.length>o;o++){const e=t?.[o]?.label;e&&(a[o].textContent=e)}})(),(()=>{const e=document.querySelector(".decorative-script p");if(!e)return;const t=ca("philosophy.textBeforeLink",""),a=ca("philosophy.link.id","contact-email-inline")||"contact-email-inline",o=ca("philosophy.link.href","#")||"#",n=ca("philosophy.link.text","")||"";let i=document.getElementById(a);if(i||(i=e.querySelector("a")),!i)return;i.id=a,i.setAttribute("href",o),i.textContent=n;const r=i.previousSibling;r&&r.nodeType===Node.TEXT_NODE?r.nodeValue=t:e.insertBefore(document.createTextNode(t),i);const l=i.nextSibling;l&&l.nodeType===Node.TEXT_NODE&&(l.nodeValue="")})(),(()=>{ga(document.getElementById("footer-links-container"),"aria-label",ca("footer.navAriaLabel",""));const e=ca("footer.links",null);if(e&&"object"==typeof e)for(const t of["contact","portfolio","cv"]){const a=e?.[t];if(!a)continue;const o=document.getElementById(a.id||"");o&&(a.href&&o.setAttribute("href",a.href),a.text&&(o.textContent=a.text))}})(),(()=>{const e=document.getElementById("social-links");ga(e,"aria-label",ca("socials.ariaLabel",""));const t=ca("socials.items",null);if(!e||!t||"object"!=typeof t)return;const a=["appleMusic","instagram","linkedin"],o=e.querySelectorAll("a.footer_icon-link");for(let n=0;o.length>n&&3>n;n++){const e=o[n],i=t?.[a[n]];if(!i)continue;i.url&&e.setAttribute("href",i.url),i.ariaLabel&&e.setAttribute("aria-label",i.ariaLabel);const r=e.querySelector(".screen-reader");r&&i.screenReaderText&&(r.textContent=i.screenReaderText)}})()}catch(e){}})()}catch(e){}if(et()?at():(({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"]}={})=>{et()||at({sentence:e,ascii:t,silence:!0})})(),et())try{const e=await Promise.resolve().then(()=>Xo);e.setApplyVisualCSSVars?.(ba)}catch(e){}try{et()&&Ao.groupCollapsed("BouncyBalls bootstrap"),nt("bb:start"),ot("🚀 Initializing modular bouncy balls...");const t=await(async()=>{try{try{if("undefined"!=typeof window&&window.__RUNTIME_CONFIG__&&"object"==typeof window.__RUNTIME_CONFIG__)return window.__RUNTIME_CONFIG__}catch(e){}const t=["config/default-config.json","js/config.json","../public/js/config.json"];for(const a of t)try{const e=await fetch(a,{cache:"no-cache"});if(e.ok)return await e.json()}catch(e){}throw Error("No config found")}catch(e){return console.warn("Config load failed, using defaults"),{gravityMultiplier:1.05,ballMass:91,maxBalls:300}}})();c(t),nt("bb:config"),ot("✓ Config loaded");try{const e=d();"undefined"!=typeof window&&(window.REST=e.REST,window.FRICTION=e.FRICTION,window.MAX_BALLS=e.maxBalls,window.repelRadius=e.repelRadius,window.repelPower=e.repelPower)}catch(e){}s(),ot("✓ Layout applied"),ba(t),ot("✓ Visual effects configured"),(()=>{const e=document.querySelector(".noise");if(!e)return;const t=e.closest("#bravia-balls")||document.getElementById("bravia-balls")||e.parentElement||document.body,a=getComputedStyle(e),o=a.backgroundImage&&"none"!==a.backgroundImage?a.backgroundImage:null;if(!document.querySelector(".noise-2")){const e=document.createElement("div");e.className="noise-2",o&&(e.style.backgroundImage=o),t.appendChild(e),console.log("✓ Created .noise-2 element")}if(!document.querySelector(".noise-3")){const e=document.createElement("div");e.className="noise-3",o&&(e.style.backgroundImage=o),t.appendChild(e),console.log("✓ Created .noise-3 element")}})(),ue();const a=fe(),o=me(),n=document.getElementById("bravia-balls");if(!a||!o||!n)throw Error("Missing DOM elements");try{a.setAttribute("role","application"),a.getAttribute("aria-label")||a.setAttribute("aria-label","Interactive bouncy balls physics simulation")}catch(e){}u(a,o,n),he(),nt("bb:renderer"),ot("✓ Canvas initialized (container-relative sizing)"),d().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),(()=>{function t(e){return!(!e||!e.closest||!(e.closest("#panelDock")||e.closest("#masterPanel")||e.closest("#dockToggle")||e.closest(".panel-dock")||e.closest(".panel")))}function a(e,t){return!p&&c||(c=l.getBoundingClientRect(),p=!1),{x:(e-c.left)*s,y:(t-c.top)*s,inBounds:!(c.left>e||e>c.right||c.top>t||t>c.bottom)}}function o(e,o,n,{isMouseLike:i}={isMouseLike:!0}){if(i?Gt(e,o):_t(),r.currentMode!==Ma.ORBIT_3D&&r.currentMode!==Ma.ORBIT_3D_2&&t(n))return;if(ta())return;const l=a(e,o),s=performance.now(),c=s-An;if(c>0&&An>0){const e=l.x-In,t=l.y-Kn;On=Math.sqrt(e*e+t*t)/c}r.mouseX=l.x,r.mouseY=l.y,r.mouseInCanvas=l.inBounds,"undefined"!=typeof window&&(window.mouseInCanvas=l.inBounds);const p=Math.hypot(l.x-(r.lastPointerMoveX??l.x),l.y-(r.lastPointerMoveY??l.y));p>.5&&(r.lastPointerMoveMs=s,r.lastPointerMoveX=l.x,r.lastPointerMoveY=l.y),i&&p>.5&&((e,t,a,o)=>{const n=d();if(!n?.mouseTrailEnabled)return;if(!o)return;if(Xe())return;if((e=>{const t=Math.max(0,0|e);t>0&&(So===t&&Co&&Po&&ko||(So=t,Co=new Float32Array(So),Po=new Float32Array(So),ko=new Float64Array(So),Fo=0,To=0))})(qe(0|(n.mouseTrailLength??18),4,96)),!So)return;const i=n.DPR||1,r=qe(+(n.mouseTrailSize??1.3),.5,10)*i,l=Math.max(.35,.55*r),s=l*l;if(To>0){const o=(Fo-1+So)%So;if(((e,t,a,o)=>{const n=e-a,i=t-o;return n*n+i*i})(e,t,Co[o],Po[o])<s)return void(ko[o]=a)}Co[Fo]=e,Po[Fo]=t,ko[Fo]=a,Fo=(Fo+1)%So,So>To&&To++})(l.x,l.y,s,l.inBounds),r.currentMode===Ma.WATER&&l.inBounds&&On>.3&&s-Wn>80&&(ae(l.x,l.y,Math.min(2*On,3)),Wn=s),In=l.x,Kn=l.y,An=s}function n(e,o,n,i=null){Rn||t(n)||(e=>!(!e||!e.closest||!(e.closest("a")||e.closest("button")||e.closest("input")||e.closest("select")||e.closest("textarea"))))(n)||ta()||r.clickCycleEnabled&&a(e,o).inBounds&&(Rn=!0,zn=i,Vn=e,En=o,Bn=0,na(1,{armManual:!0,scheduleRelease:!1}))}function i(e=null,t="mouse"){if(!Rn)return;if(null!==zn&&null!==e&&e!==zn)return;const a=Bn;Rn=!1,zn=null,Bn=0,"touch"!==t&&"pen"!==t||15>=a?((()=>{const e=d(),t=ya,a=t.indexOf(e.currentMode),o=t[((0>a?0:a)+1)%t.length];Promise.resolve().then(()=>wo).then(({setMode:e})=>{e(o)}),Promise.resolve().then(()=>qo).then(({updateModeButtonsUI:e})=>{e(o)})})(),ia()):ia()}const r=d(),l=r.canvas;if(void 0===r.clickCycleEnabled&&(r.clickCycleEnabled=!1),!l)return void console.error("Canvas not available for pointer setup");const s=r.DPR;let c=null,p=!0;try{window.addEventListener("resize",()=>{p=!0},{passive:!0})}catch(e){}document.addEventListener("mousemove",e=>{window.PointerEvent||o(e.clientX,e.clientY,e.target,{isMouseLike:!0})},{passive:!0}),document.addEventListener("pointermove",e=>{o(e.clientX,e.clientY,e.target,{isMouseLike:"mouse"===e.pointerType||"pen"===e.pointerType})},{passive:!0}),window.PointerEvent?(document.addEventListener("pointerdown",e=>{n(e.clientX,e.clientY,e.target,e.pointerId)},{passive:!0}),document.addEventListener("pointermove",e=>{Rn&&zn===e.pointerId&&(Bn=Math.max(Bn,Math.hypot(e.clientX-Vn,e.clientY-En)))},{passive:!0}),document.addEventListener("pointerup",e=>{i(e.pointerId,e.pointerType)},{passive:!0}),document.addEventListener("pointercancel",e=>{i(e.pointerId,e.pointerType)},{passive:!0})):(document.addEventListener("mousedown",e=>{n(e.clientX,e.clientY,e.target,null)},{passive:!0}),document.addEventListener("mouseup",()=>{i(null,"mouse")},{passive:!0})),document.addEventListener("touchmove",e=>{if(!ta()&&e.touches&&e.touches[0]){const t=a(e.touches[0].clientX,e.touches[0].clientY);r.mouseX=t.x,r.mouseY=t.y,r.mouseInCanvas=t.inBounds;const o=performance.now();Math.hypot(t.x-(r.lastPointerMoveX??t.x),t.y-(r.lastPointerMoveY??t.y))>.5&&(r.lastPointerMoveMs=o,r.lastPointerMoveX=t.x,r.lastPointerMoveY=t.y),r.currentMode===Ma.WATER&&t.inBounds&&o-Wn>80&&(ae(t.x,t.y,2),Wn=o)}},{passive:!0}),document.addEventListener("touchstart",e=>{if(!window.PointerEvent&&!t(e.target)&&!ta()&&(_t(),!e.target.closest("a")&&!e.target.closest("button")&&!e.target.closest("input")&&!e.target.closest("select")&&!e.target.closest("textarea")&&e.touches&&e.touches[0])){const t=e.touches[0];if(!a(t.clientX,t.clientY).inBounds)return;r.clickCycleEnabled&&(Rn=!0,zn=null,Vn=t.clientX,En=t.clientY,Bn=0,na(1,{armManual:!0,scheduleRelease:!1}))}},{passive:!0}),document.addEventListener("touchmove",e=>{if(!window.PointerEvent&&Rn&&e.touches&&e.touches[0]){const t=e.touches[0];Bn=Math.max(Bn,Math.hypot(t.clientX-Vn,t.clientY-En))}},{passive:!0}),document.addEventListener("touchend",()=>{window.PointerEvent||i(null,"touch")},{passive:!0}),document.addEventListener("touchcancel",()=>{window.PointerEvent||i(null,"touch")},{passive:!0}),document.addEventListener("mouseleave",()=>{r.mouseX=xa.OFFSCREEN_MOUSE,r.mouseY=xa.OFFSCREEN_MOUSE,r.mouseInCanvas=!1,On=0,"undefined"!=typeof window&&(window.mouseInCanvas=!1),_t()}),document.addEventListener("mouseenter",()=>{Nt()}),document.addEventListener("touchend",()=>{r.mouseX=xa.OFFSCREEN_MOUSE,r.mouseY=xa.OFFSCREEN_MOUSE,r.mouseInCanvas=!1},{passive:!0}),console.log("✓ Unified pointer system configured (document-level)"),r._=!0,"undefined"!=typeof window&&(window._=!0)})(),ot("✓ Pointer tracking configured"),"undefined"!=typeof document&&document.addEventListener("touchmove",e=>{var t;(t=e.target)instanceof Element&&(t.closest(".panel-dock .panel .panel-content")||t.closest("#controlPanel"))||e.preventDefault()},{passive:!1,capture:!0}),ot("✓ Overscroll lock configured"),Wt(),nt("bb:input"),ot("✓ Custom cursor initialized"),(()=>{if("undefined"!=typeof window&&"undefined"!=typeof document&&(Pn=document.querySelector("#abs-scene")||null,Pn&&(Pn.style.setProperty(Sn,"0"),Pn.style.setProperty(Cn,"100ms"),aa(),!(()=>{try{return!(!window.matchMedia||!window.matchMedia("(prefers-reduced-motion: reduce)").matches)}catch(e){return!1}})()))){kn=!0;try{window.addEventListener("resize",aa,{passive:!0})}catch(e){}window.addEventListener("bb:modeChanged",e=>{const t=d();if(!1===t?.sceneImpactEnabled)return;if(Dn)return void(Dn=!1);const a=e?.detail||{};na(a.prevMode&&a.mode&&a.prevMode!==a.mode?1:.75,{armManual:!1})},{passive:!0})}})(),console.log("⚠️ localStorage is disabled - using defaults"),A();try{(e=>{const t=e&&"object"==typeof e?e:null;if(!t)return;if("string"==typeof t.soundPreset&&_(t.soundPreset),t.soundConfig&&"object"==typeof t.soundConfig)return void G(t.soundConfig);const a={};let o=!1;for(const[n,i]of Object.entries(t))n in Aa&&(a[n]=i,o=!0);o&&G(a)})(t)}catch(e){}if(ot("✓ Sound engine primed (awaiting user unlock)"),"undefined"!=typeof window&&(ai||(ai=!0,window.addEventListener("bb:modeChanged",e=>{const t=d();if(!1===t?.sceneChangeSoundEnabled)return;const a=e?.detail||{};a.prevMode&&a.mode&&a.prevMode!==a.mode&&R(+(t?.sceneChangeSoundRadius??18),+(t?.sceneChangeSoundIntensity??.35),.5,null)},{passive:!0}))),et())try{const e=await Promise.resolve().then(()=>pn);e.createPanelDock?.();const t=await Promise.resolve().then(()=>Ia);t.populateColorSelect?.()}catch(e){}nt("bb:ui"),ot(et()?"✓ Panel dock created (Sound + Controls)":"✓ UI initialized (panel disabled in production)"),ht(),nt("bb:theme"),(()=>{const e=document.getElementById("expertise-legend");if(!e)return;const t=Array.from(e.querySelectorAll(".legend__item"));for(const a of t){const e=a.querySelector("span"),t=a.querySelector(".circle");if(!e||!t)continue;const o=fa(e.textContent),n=ti.get(o);if(n){for(const e of Array.from(t.classList))(e.startsWith("bg-ball-")||e.startsWith("bg-story-"))&&t.classList.remove(e);t.classList.add(n)}}})(),un||(un=!0,window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName))return;const t=e.key.toLowerCase();if("/"===t||"Slash"===e.code)return e.preventDefault(),void Et();if("r"!==t)return"ArrowRight"===e.key?(e.preventDefault(),void Bt(1)):"ArrowLeft"===e.key?(e.preventDefault(),void Bt(-1)):void 0;e.preventDefault(),He();try{Lt(d().currentMode)}catch(e){}})),ot("✓ Keyboard shortcuts registered"),qt(t),ot("✓ Gate overlay system initialized"),(()=>{const t=document.getElementById("cv-gate-trigger"),a=document.getElementById("brand-logo"),o=document.getElementById("cv-gate"),n=document.getElementById("portfolio-gate"),i=document.getElementById("contact-gate"),r=Array.from(document.querySelectorAll(".cv-digit")),l=document.getElementById("page-flash"),s=document.getElementById("cv-gate-label");if(!t||!a||!o||0===r.length)return void console.warn("CV Gate: Missing required elements");const c=ca("gates.common.backText","BACK"),d=ca("gates.common.backAriaLabel","Back"),p=ca("gates.cv.title","Bio/CV"),u=ca("gates.cv.description","Because spam bots don't deserve nice things—and neither do recruiters who don't read portfolios. This keeps my inbox slightly more civilized.");s&&(s.innerHTML=`\n            <div class="gate-nav">\n                <button type="button" class="gate-back" data-gate-back aria-label="${d}">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>${c}</span>\n                </button>\n            </div>\n            <h2 class="gate-title">${p}</h2>\n            <p class="gate-description">${u}</p>\n        `);const h=l||(()=>{const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e})();let f=!1;const m=()=>o&&o.classList.contains("active")||n&&n.classList.contains("active")||i&&i.classList.contains("active"),g=(e=!1)=>{f=!1,r.forEach(e=>e.value=""),e?(o.style.transition="none",a.style.transition="none",o.classList.remove("active"),o.setAttribute("aria-hidden","true"),o.classList.add("hidden"),jt(o),a.classList.remove("fade-out-up"),m()||ea(),requestAnimationFrame(()=>{o.style.removeProperty("transition"),a.style.removeProperty("transition")})):(o.classList.remove("active"),o.setAttribute("aria-hidden","true"),a.classList.remove("fade-out-up"),setTimeout(()=>{f||(o.classList.add("hidden"),jt(o)),m()||ea()},400))};try{const e=s?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",g)}catch(e){}o.addEventListener("click",e=>{(e.target===o||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&g(!0)});const b=()=>{const e=r.map(e=>e.value).join("");4===e.length&&("1111"===e?(da(h,"success"),setTimeout(()=>{window.location.href="cv.html"},500)):(da(h,"error"),setTimeout(()=>{r.forEach(e=>e.value=""),r[0].focus()},350)))};t.addEventListener("click",e=>{e.preventDefault();const t=m();n&&n.classList.contains("active")&&(n.classList.remove("active"),n.setAttribute("aria-hidden","true"),setTimeout(()=>{n.classList.add("hidden"),jt(n)},400)),i&&i.classList.contains("active")&&(i.classList.remove("active"),i.setAttribute("aria-hidden","true"),setTimeout(()=>{i.classList.add("hidden"),jt(i)},400)),f=!0,t||Qt(),a.classList.add("fade-out-up"),Zt(o),o.classList.remove("hidden"),o.setAttribute("aria-hidden","false"),o.classList.add("active"),r[0].focus()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&f&&g()}),document.addEventListener("gate-overlay-dismiss",e=>{f&&g(e.detail?.instant||!1)}),r.forEach((e,t)=>{e.addEventListener("keydown",a=>{"Backspace"===a.key&&""===e.value&&(t>0?r[t-1].focus():g())}),e.addEventListener("input",e=>{const a=e.target.value;if(/^\d*$/.test(a)){if(1===a.length)r.length-1>t?r[t+1].focus():b();else if(a.length>1){const o=a.split("");e.target.value=o[0];let n=t+1;for(let e=1;o.length>e&&r.length>n;e++)r[n].value=o[e],n++;r.length>n?r[n].focus():b()}}else e.target.value=a.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})})(),ot("✓ CV password gate initialized"),(()=>{const t=document.getElementById("portfolio-gate-trigger"),a=document.getElementById("brand-logo"),o=document.getElementById("portfolio-gate"),n=document.getElementById("cv-gate"),i=document.getElementById("contact-gate"),r=Array.from(document.querySelectorAll(".portfolio-digit")),l=document.getElementById("page-flash"),s=document.getElementById("portfolio-gate-label");if(!t||!a||!o||0===r.length)return void console.warn("Portfolio Gate: Missing required elements");const c=ca("gates.common.backText","BACK"),d=ca("gates.common.backAriaLabel","Back"),p=ca("gates.portfolio.title","View Portfolio"),u=ca("gates.portfolio.description","Good work deserves good context. This small step ensures you're here with intention, not just browsing. Quality takes time—yours and mine.");s&&(s.innerHTML=`\n            <div class="gate-nav">\n                <button type="button" class="gate-back" data-gate-back aria-label="${d}">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>${c}</span>\n                </button>\n            </div>\n            <h2 class="gate-title">${p}</h2>\n            <p class="gate-description">${u}</p>\n        `);const h=l||(()=>{const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e})();let f=!1;const m=()=>o&&o.classList.contains("active")||n&&n.classList.contains("active")||i&&i.classList.contains("active"),g=(e=!1)=>{f=!1,r.forEach(e=>e.value=""),e?(o.style.transition="none",a.style.transition="none",o.classList.remove("active"),o.setAttribute("aria-hidden","true"),o.classList.add("hidden"),jt(o),a.classList.remove("fade-out-up"),m()||ea(),requestAnimationFrame(()=>{o.style.removeProperty("transition"),a.style.removeProperty("transition")})):(o.classList.remove("active"),o.setAttribute("aria-hidden","true"),a.classList.remove("fade-out-up"),setTimeout(()=>{f||(o.classList.add("hidden"),jt(o)),m()||ea()},400))};try{const e=s?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",g)}catch(e){}o.addEventListener("click",e=>{(e.target===o||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&g(!0)});const b=()=>{const e=r.map(e=>e.value).join("");4===e.length&&("1234"===e?(pa(h,"success"),setTimeout(()=>{window.location.href="portfolio.html"},500)):(pa(h,"error"),setTimeout(()=>{r.forEach(e=>e.value=""),r[0].focus()},350)))};t.addEventListener("click",e=>{e.preventDefault();const t=m();n&&n.classList.contains("active")&&(n.classList.remove("active"),n.setAttribute("aria-hidden","true"),setTimeout(()=>{n.classList.add("hidden"),jt(n)},400)),i&&i.classList.contains("active")&&(i.classList.remove("active"),i.setAttribute("aria-hidden","true"),setTimeout(()=>{i.classList.add("hidden"),jt(i)},400)),f=!0,t||Qt(),a.classList.add("fade-out-up"),Zt(o),o.classList.remove("hidden"),o.setAttribute("aria-hidden","false"),o.classList.add("active"),r[0].focus()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&f&&g()}),document.addEventListener("gate-overlay-dismiss",e=>{f&&g(e.detail?.instant||!1)}),r.forEach((e,t)=>{e.addEventListener("keydown",a=>{"Backspace"===a.key&&""===e.value&&(t>0?r[t-1].focus():g())}),e.addEventListener("input",e=>{const a=e.target.value;if(/^\d*$/.test(a)){if(1===a.length)r.length-1>t?r[t+1].focus():b();else if(a.length>1){const o=a.split("");e.target.value=o[0];let n=t+1;for(let e=1;o.length>e&&r.length>n;e++)r[n].value=o[e],n++;r.length>n?r[n].focus():b()}}else e.target.value=a.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})})(),ot("✓ Portfolio password gate initialized"),(()=>{const t=ca("contact.email","alexander@beck.fyi"),a=ca("gates.common.backText","BACK"),o=ca("gates.common.backAriaLabel","Back"),n=ca("gates.contact.title","Contact"),i=ca("gates.contact.description","For collaborations, product design work, AI prototyping, or anything that needs a crisp creative + technical brain."),r=ca("contact.copy.buttonAriaLabel","Copy email address"),l=ca("contact.copy.statusCopied","Copied"),s=ca("contact.copy.statusError","Copy failed"),c=[document.getElementById("contact-email"),document.getElementById("contact-email-inline")].filter(Boolean),d=document.getElementById("brand-logo"),p=document.getElementById("contact-gate"),u=document.getElementById("contact-gate-label"),h=document.getElementById("contact-gate-inputs"),f=document.getElementById("cv-gate"),m=document.getElementById("portfolio-gate");if(!(c.length&&d&&p&&u&&h))return void console.warn("Contact Gate: Missing required elements");u.innerHTML=`\n    <div class="gate-nav">\n      <button type="button" class="gate-back" data-gate-back aria-label="${o}">\n        <i class="ti ti-arrow-left" aria-hidden="true"></i>\n        <span>${a}</span>\n      </button>\n    </div>\n    <h2 class="gate-title">${n}</h2>\n    <p class="gate-description">\n      ${i}\n    </p>\n  `,h.innerHTML=`\n    <div class="contact-email-row" data-email-row>\n      <button type="button" class="contact-email-value" data-copy-email aria-label="${r}">\n        <span class="contact-email-text">${t}</span>\n      </button>\n      <button type="button" class="contact-email-copy" data-copy-email-icon aria-label="${r}">\n        <i class="ti ti-copy" aria-hidden="true"></i>\n      </button>\n    </div>\n    <div class="contact-copy-status" data-copy-status aria-live="polite"></div>\n  `;const g=u.querySelector("[data-gate-back]"),b=h.querySelector("[data-copy-email]"),M=h.querySelector("[data-copy-email-icon]"),y=h.querySelector("[data-email-row]"),v=h.querySelector("[data-copy-status]"),x=h.querySelector(".contact-email-copy i");let w=!1,S=null;const C=()=>p&&p.classList.contains("active")||f&&f.classList.contains("active")||m&&m.classList.contains("active"),P=e=>{if(b&&M&&v){if(S&&window.clearTimeout(S),"copied"===e)return y?.classList?.add?.("is-copied"),y?.classList?.remove?.("is-error"),v.textContent=l,x&&(x.className="ti ti-check"),void(S=window.setTimeout(()=>P("idle"),1200));if("error"===e)return y?.classList?.add?.("is-error"),y?.classList?.remove?.("is-copied"),v.textContent=s,x&&(x.className="ti ti-alert-triangle"),void(S=window.setTimeout(()=>P("idle"),1200));y?.classList?.remove?.("is-copied","is-error"),v.textContent="",x&&(x.className="ti ti-copy")}},k=e=>{e?.preventDefault?.();const t=C();f&&f.classList.contains("active")&&(f.classList.remove("active"),f.setAttribute("aria-hidden","true"),setTimeout(()=>{f.classList.add("hidden"),jt(f)},400)),m&&m.classList.contains("active")&&(m.classList.remove("active"),m.setAttribute("aria-hidden","true"),setTimeout(()=>{m.classList.add("hidden"),jt(m)},400)),w=!0,t||Qt(),P("idle"),d.classList.add("fade-out-up"),Zt(p),p.classList.remove("hidden"),p.setAttribute("aria-hidden","false"),p.classList.add("active"),b?.focus?.()},F=(e=!1)=>{w=!1,P("idle"),e?(p.style.transition="none",d.style.transition="none",p.classList.remove("active"),p.setAttribute("aria-hidden","true"),p.classList.add("hidden"),jt(p),d.classList.remove("fade-out-up"),C()||ea(),requestAnimationFrame(()=>{p.style.removeProperty("transition"),d.style.removeProperty("transition")})):(p.classList.remove("active"),p.setAttribute("aria-hidden","true"),d.classList.remove("fade-out-up"),setTimeout(()=>{w||(p.classList.add("hidden"),jt(p)),C()||ea()},400))};c.forEach(e=>e.addEventListener("click",k,{capture:!0})),g?.addEventListener("click",F),p.addEventListener("click",e=>{(e.target===p||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&F(!0)});const T=async()=>{const a=await(async t=>{try{if(navigator?.clipboard?.writeText)return await navigator.clipboard.writeText(t),!0}catch(e){}try{const e=document.createElement("textarea");e.value=t,e.setAttribute("readonly","true"),e.style.position="fixed",e.style.left="-9999px",e.style.top="0",document.body.appendChild(e),e.select();const a=!0===document.execCommand?.("copy");return document.body.removeChild(e),a}catch(e){return!1}})(t);P(a?"copied":"error")};b?.addEventListener("click",T),M?.addEventListener("click",T),document.addEventListener("keydown",e=>{"Escape"===e.key&&w&&F()}),document.addEventListener("gate-overlay-dismiss",e=>{w&&F(e.detail?.instant||!1)})})(),ot("✓ Contact gate initialized"),(()=>{const e=document.getElementById("social-links");if(!e)return;if(e.querySelector("i.ti"))return;const t=Array.from(e.querySelectorAll("a.footer_icon-link[aria-label]"));for(const a of t){const e=(a.getAttribute("aria-label")||"").trim().toLowerCase(),t=ei.get(e);if(!t)continue;const o=a.querySelector("svg");o?(a.insertAdjacentHTML("afterbegin",t),o.remove()):a.insertAdjacentHTML("afterbegin",t)}})(),(()=>{function e(){t.textContent=o.format(new Date).toUpperCase()}const t=document.getElementById("time-display"),a=document.getElementById("site-year");if(!t)return;const o=new Intl.DateTimeFormat("en-GB",{timeZone:"Europe/London",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});e(),setInterval(e,1e3),a&&(a.style.cursor="pointer",a.addEventListener("click",ft))})(),(()=>{try{const e=document.getElementById("cv-gate-trigger");if(e&&!e.querySelector(".footer-link-nowrap")){const t=((ca("footer.links.cv.text","")||"")+"").trim(),a=(e.textContent||"").trim().replace(/\s+/g," "),o=t||a;o&&o.includes("/")&&a===o&&(e.innerHTML=`<span class="footer-link-nowrap">${o}</span>`)}}catch(e){}})(),(()=>{if(A(),"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return console.log("⏸ Sound toggle hidden (prefers-reduced-motion)"),null;Qn=document.createElement("button"),Qn.className="sound-toggle",Qn.id="sound-toggle",Qn.type="button",Qn.setAttribute("aria-label","Toggle collision sounds"),Qn.setAttribute("aria-pressed","false"),Qn.setAttribute("data-enabled","false"),Qn.innerHTML=Jn,Qn.title="Sound off",Qn.addEventListener("click",ua);const t=document.getElementById("fade-content"),a=document.getElementById("sound-toggle-slot"),o=document.getElementById("top-elements-soundRow"),n=document.getElementById("social-links"),i=document.querySelector(".ui-meta-right"),r=!!a,l=n&&(!t||t.contains(n)),s="undefined"!=typeof window&&"function"==typeof window.matchMedia&&window.matchMedia("(max-width: 600px)").matches,c=t=>{if(!t)return!1;try{Qn.parentElement&&Qn.parentElement!==t&&Qn.parentElement.removeChild(Qn)}catch(e){}if(t.classList.contains("ui-meta-right")){const e=t.querySelector("time");if(e)return t.insertBefore(Qn,e),!0}return t.appendChild(Qn),!0};if(s&&o)Qn.classList.add("sound-toggle--top"),Qn.classList.add("sound-toggle--topwide"),c(o);else if(r)Qn.classList.add("sound-toggle--top"),c(a);else if(i)c(i);else if(l){const e=document.createElement("li");e.className="margin-bottom_none sound-toggle-item",Qn.classList.add("sound-toggle--social"),e.appendChild(Qn),n.appendChild(e)}else t?t.appendChild(Qn):document.body.appendChild(Qn);try{if("undefined"!=typeof window&&"function"==typeof window.matchMedia){const e=window.matchMedia("(max-width: 600px)"),t=()=>{const t=document.getElementById("top-elements-soundRow"),a=document.getElementById("sound-toggle-slot"),o=e.matches&&!!t;Qn.classList.toggle("sound-toggle--topwide",o),o?c(t):a&&c(a)};"function"==typeof e.addEventListener?e.addEventListener("change",t):"function"==typeof e.addListener&&e.addListener(t)}}catch(e){}console.log("✓ Sound toggle created");try{const e=W();ha(!(!e.isUnlocked||!e.isEnabled))}catch(e){}"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(Za,e=>{const t=e&&e.detail?e.detail:null;t&&ha(!(!t.isUnlocked||!t.isEnabled))})})(),ot("✓ Sound toggle button created"),ot("✓ Theme toggle button created");const i=Ma.PIT;P?.(),Ne(i);try{const e=await Promise.resolve().then(()=>qo);e.updateModeButtonsUI?.(i)}catch(e){}nt("bb:mode"),ot("✓ Mode initialized"),fo=Qe;const r=()=>Ze();(e=>{function t(a){if(!Zn)return void(jn=null);const o=a-Hn;if(Yn>o)return void(jn=requestAnimationFrame(t));Hn=a-o%Yn,(e=>{if(Xn.push(e),Xn.length>30&&Xn.shift(),30===Xn.length){const e=1e3/(Xn.reduce((e,t)=>e+t,0)/30);30>e&&2>qn?(qn++,console.log(`⚡ Adaptive throttle increased to level ${qn} (avg FPS: ${e.toFixed(1)})`)):e>55&&qn>0&&(qn--,console.log(`⚡ Adaptive throttle decreased to level ${qn} (avg FPS: ${e.toFixed(1)})`))}})(o);const n=a/1e3;let i=Math.min(.033,n-Nn);Nn=n,(2>qn||Math.random()>.5)&&(async(e,t)=>{const a=d(),o=a.balls;if(!a.canvas)return;if(!o||0===o.length)return;const n=Math.max(0,Math.round(a.warmupFramesRemaining||0));if(n>0){a.warmupFramesRemaining=0,Do=0;for(let e=0;n>e;e++)Je(Ko,t)}else Je(e,t)})(i,e),Qe(),(e=>{if(Gn++,e-$n>1e3){_n=Gn,Gn=0,$n=e;const t=document.getElementById("render-fps");t&&(t.textContent=_n+"")}})(performance.now()),jn=requestAnimationFrame(t)}document.addEventListener("visibilitychange",()=>{Zn=!document.hidden,Zn?(Nn=performance.now()/1e3,Hn=performance.now(),console.log("▶️ Animation resumed"),jn||(jn=requestAnimationFrame(t))):(console.log("⏸️ Animation paused (tab hidden)"),jn&&(cancelAnimationFrame(jn),jn=null))}),jn=requestAnimationFrame(t),console.log("✓ Render loop started (60fps throttle, visibility-aware)")})((e,t)=>{const a=r();a&&a(e,t)}),nt("bb:end"),ot("✅ Bouncy Balls running (modular)");const l=[{phase:"config",ms:it("bb:m:config","bb:start","bb:config")},{phase:"renderer",ms:it("bb:m:renderer","bb:config","bb:renderer")},{phase:"input",ms:it("bb:m:input","bb:renderer","bb:input")},{phase:"ui",ms:it("bb:m:ui","bb:input","bb:ui")},{phase:"theme",ms:it("bb:m:theme","bb:ui","bb:theme")},{phase:"mode+loop",ms:it("bb:m:mode","bb:theme","bb:mode")},{phase:"total",ms:it("bb:m:total","bb:start","bb:end")}].filter(e=>"number"==typeof e.ms);l.length&&(t=>{if(et())try{Ao.table(t)}catch(e){}})(l.map(e=>({...e,ms:+e.ms.toFixed(2)}))),et()&&Ao.groupEnd();const p=400,h=3e3,f="cubic-bezier(0.16, 1, 0.3, 1)",m=p+h+750,g=(e,t)=>{e.style.opacity="1",console.warn(`⚠️ Fade failsafe: forcing #fade-content visible (${t})`)};setTimeout(()=>{const e=document.getElementById("fade-content");if(!e)return void console.warn("⚠️ #fade-content not found (fade skipped)");if(window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches)return e&&(e.style.opacity="1"),void console.log("✓ Page fade-in skipped (prefers-reduced-motion)");if(e&&"function"!=typeof e.animate)return void g(e,"WAAPI unsupported");const t=(e=>e&&"function"==typeof e.animate?e.animate([{opacity:0},{opacity:1}],{duration:h,easing:f,fill:"forwards"}):null)(e);t?.addEventListener?.("finish",()=>{e&&(e.style.opacity="1"),console.log("✓ Page fade-in finished")}),t?.addEventListener?.("cancel",()=>{e&&g(e,"animation canceled")}),console.log("✓ Page fade-in started (WAAPI)"),setTimeout(()=>{e&&"0"===window.getComputedStyle(e).opacity&&g(e,"opacity still 0 after failsafe window")},m)},p)}catch(t){console.error("❌ Initialization failed:",t),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${t.message}\n${t.stack}</pre>\n    </div>`}})(),e.applyFramePaddingCSSVars=()=>{s()},e.applyVisualCSSVars=ba})({});