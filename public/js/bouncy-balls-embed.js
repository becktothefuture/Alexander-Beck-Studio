!(function(e){function t(e){Ia=e}function a(e,t,a,o){const n=+e;return Number.isFinite(n)?Math.min(a,Math.max(t,n)):o}function o(e,t,o,n){const i=a(e,t,o,n);return Math.round(i)}function n(){const e=+Aa.layoutViewportWidthPx;return Number.isFinite(e)&&e>0?e:Math.max(1,window.innerWidth||1)}function i(e,t){const a=Math.max(1,t||n()),o=+e;return Number.isFinite(o)?o/a*100:0}function r(e,t){const a=Math.max(1,t||n()),o=+e;return Number.isFinite(o)?o/100*a:0}function l(){const e=n(),t=r(Aa.containerBorderVw,e),a=r(Aa.simulationPaddingVw,e),o=r(Aa.contentPaddingVw,e),i=r(Aa.wallRadiusVw,e),l=Math.max(0,Math.round(Aa.layoutMinContentPaddingPx||0)),s=Math.max(0,Math.round(Aa.layoutMinWallRadiusPx||0)),c=r(Number.isFinite(Aa.wallThicknessVw)&&Aa.wallThicknessVw>0?Aa.wallThicknessVw:Aa.containerBorderVw,e),d=Aa.isMobile||Aa.isMobileViewport?Math.max(.5,Aa.mobileWallThicknessXFactor||1):1;Aa.containerBorder=Math.round(t),Aa.containerBorderX=Math.round(t*d),Aa.simulationPadding=Math.round(a),Aa.contentPadding=Math.max(l,Math.round(o));const p=Math.max(.1,Aa.contentPaddingHorizontalRatio||1);Aa.contentPaddingY=Aa.contentPadding,Aa.contentPaddingX=Math.round(Aa.contentPadding*p),Aa.wallRadius=Math.max(s,Math.round(i)),Aa.cornerRadius=Aa.wallRadius,Aa.wallThickness=Math.round(c*d);const u=Math.max(0,r(Aa.cursorInfluenceRadiusVw||0,e));Aa.cursorInfluenceRadiusPx=Math.round(u),Aa.repelRadius=Math.round(u),Aa.weightlessRepelRadius=Math.round(u),Aa.pingPongCursorRadius=Math.round(u),Aa.bubblesDeflectRadius=Math.round(u)}function s(){const e=document.documentElement,t=Aa.isMobile||Aa.isMobileViewport,a=t?Math.max(.5,Aa.mobileWallThicknessXFactor||1):1;e.style.setProperty("--container-border",Aa.containerBorder+"px"),e.style.setProperty("--container-border-x",Aa.containerBorderX+"px"),e.style.setProperty("--container-border-y",Aa.containerBorder+"px"),e.style.setProperty("--simulation-padding",Aa.simulationPadding+"px"),e.style.setProperty("--content-padding",Aa.contentPadding+"px"),e.style.setProperty("--content-padding-x",Aa.contentPaddingX+"px"),e.style.setProperty("--content-padding-y",Aa.contentPaddingY+"px"),e.style.setProperty("--wall-radius",Aa.wallRadius+"px"),e.style.setProperty("--wall-thickness",Aa.wallThickness+"px");const o=Aa.containerBorderVw||1.3;e.style.setProperty("--container-border-vw",""+o),e.style.setProperty("--container-border-x-vw",""+o*a),e.style.setProperty("--wall-thickness-vw",""+(Number.isFinite(Aa.wallThicknessVw)&&Aa.wallThicknessVw>0?Aa.wallThicknessVw:Aa.containerBorderVw)*a);const n=Aa.edgeLabelInsetAdjustPx||0;e.style.setProperty("--edge-label-inset",Aa.containerBorder+8+n+"px"),e.style.setProperty("--edge-label-inset-adjust",n+"px"),e.style.setProperty("--edge-label-mobile-display",t&&Aa.mobileEdgeLabelsVisible?"flex":"none")}function c(e){if(Aa.config={...e},void 0!==e.layoutViewportWidthPx&&(Aa.layoutViewportWidthPx=a(e.layoutViewportWidthPx,0,4096,0)),e.ballMass&&(Aa.ballMassKg=e.ballMass),void 0!==e.gravityMultiplier&&(Aa.gravityMultiplier=e.gravityMultiplier,Aa.gravityMultiplierPit=e.gravityMultiplier),e.restitution&&(Aa.REST=e.restitution),e.friction&&(Aa.FRICTION=e.friction),void 0!==e.ballScale&&(Aa.sizeScale=e.ballScale),void 0!==e.sizeScale&&(Aa.sizeScale=e.sizeScale),void 0!==e.sizeVariationGlobalMul&&(Aa.sizeVariationGlobalMul=a(e.sizeVariationGlobalMul,0,2,Aa.sizeVariationGlobalMul)),void 0!==e.sizeVariationPit&&(Aa.sizeVariationPit=a(e.sizeVariationPit,0,1,Aa.sizeVariationPit)),void 0!==e.sizeVariationPitThrows&&(Aa.sizeVariationPitThrows=a(e.sizeVariationPitThrows,0,1,Aa.sizeVariationPitThrows)),void 0!==e.sizeVariationFlies&&(Aa.sizeVariationFlies=a(e.sizeVariationFlies,0,1,Aa.sizeVariationFlies)),void 0!==e.sizeVariationWeightless&&(Aa.sizeVariationWeightless=a(e.sizeVariationWeightless,0,1,Aa.sizeVariationWeightless)),void 0!==e.sizeVariationWater&&(Aa.sizeVariationWater=a(e.sizeVariationWater,0,1,Aa.sizeVariationWater)),void 0!==e.sizeVariationVortex&&(Aa.sizeVariationVortex=a(e.sizeVariationVortex,0,1,Aa.sizeVariationVortex)),void 0!==e.sizeVariationPingPong&&(Aa.sizeVariationPingPong=a(e.sizeVariationPingPong,0,1,Aa.sizeVariationPingPong)),void 0!==e.sizeVariationMagnetic&&(Aa.sizeVariationMagnetic=a(e.sizeVariationMagnetic,0,1,Aa.sizeVariationMagnetic)),void 0!==e.sizeVariationBubbles&&(Aa.sizeVariationBubbles=a(e.sizeVariationBubbles,0,1,Aa.sizeVariationBubbles)),void 0!==e.sizeVariationKaleidoscope&&(Aa.sizeVariationKaleidoscope=a(e.sizeVariationKaleidoscope,0,1,Aa.sizeVariationKaleidoscope)),void 0!==e.sizeVariationOrbit3d&&(Aa.sizeVariationOrbit3d=a(e.sizeVariationOrbit3d,0,1,Aa.sizeVariationOrbit3d)),void 0!==e.sizeVariationCritters&&(Aa.sizeVariationCritters=a(e.sizeVariationCritters,0,1,Aa.sizeVariationCritters)),void 0!==e.sizeVariationNeural&&(Aa.sizeVariationNeural=a(e.sizeVariationNeural,0,1,Aa.sizeVariationNeural)),void 0!==e.sizeVariationLattice&&(Aa.sizeVariationLattice=a(e.sizeVariationLattice,0,1,Aa.sizeVariationLattice)),void 0!==e.sizeVariationParallaxLinear&&(Aa.sizeVariationParallaxLinear=a(e.sizeVariationParallaxLinear,0,1,Aa.sizeVariationParallaxLinear)),void 0!==e.sizeVariationParallaxPerspective&&(Aa.sizeVariationParallaxPerspective=a(e.sizeVariationParallaxPerspective,0,1,Aa.sizeVariationParallaxPerspective)),void 0!==e.sizeVariation&&(Aa.sizeVariation=e.sizeVariation),Array.isArray(e.colorDistribution)){const t=e.colorDistribution,a=Array.isArray(Aa.colorDistribution)?Aa.colorDistribution:[],n=[];for(let e=0;7>e;e++){const i=a[e]||{},r=t[e]||{},l="string"==typeof r.label&&r.label.trim()?r.label.trim():"string"==typeof i.label?i.label:"Discipline "+(e+1),s=o(r.colorIndex,0,7,o(i.colorIndex,0,7,0)),c=o(r.weight,0,100,o(i.weight,0,100,0));n.push({label:l,colorIndex:s,weight:c})}Aa.colorDistribution=n}if(void 0!==e.pitWarmupFrames&&(Aa.pitWarmupFrames=o(e.pitWarmupFrames,0,240,Aa.pitWarmupFrames)),void 0!==e.pitThrowsWarmupFrames&&(Aa.pitThrowsWarmupFrames=o(e.pitThrowsWarmupFrames,0,240,Aa.pitThrowsWarmupFrames)),void 0!==e.fliesWarmupFrames&&(Aa.fliesWarmupFrames=o(e.fliesWarmupFrames,0,240,Aa.fliesWarmupFrames)),void 0!==e.weightlessWarmupFrames&&(Aa.weightlessWarmupFrames=o(e.weightlessWarmupFrames,0,240,Aa.weightlessWarmupFrames)),void 0!==e.waterWarmupFrames&&(Aa.waterWarmupFrames=o(e.waterWarmupFrames,0,240,Aa.waterWarmupFrames)),void 0!==e.vortexWarmupFrames&&(Aa.vortexWarmupFrames=o(e.vortexWarmupFrames,0,240,Aa.vortexWarmupFrames)),void 0!==e.pingPongWarmupFrames&&(Aa.pingPongWarmupFrames=o(e.pingPongWarmupFrames,0,240,Aa.pingPongWarmupFrames)),void 0!==e.magneticWarmupFrames&&(Aa.magneticWarmupFrames=o(e.magneticWarmupFrames,0,240,Aa.magneticWarmupFrames)),void 0!==e.bubblesWarmupFrames&&(Aa.bubblesWarmupFrames=o(e.bubblesWarmupFrames,0,240,Aa.bubblesWarmupFrames)),void 0!==e.kaleidoscopeWarmupFrames&&(Aa.kaleidoscopeWarmupFrames=o(e.kaleidoscopeWarmupFrames,0,240,Aa.kaleidoscopeWarmupFrames)),void 0!==e.kaleidoscope1WarmupFrames&&(Aa.kaleidoscope1WarmupFrames=o(e.kaleidoscope1WarmupFrames,0,240,Aa.kaleidoscope1WarmupFrames)),void 0!==e.kaleidoscope2WarmupFrames&&(Aa.kaleidoscope2WarmupFrames=o(e.kaleidoscope2WarmupFrames,0,240,Aa.kaleidoscope2WarmupFrames)),void 0!==e.kaleidoscope3WarmupFrames&&(Aa.kaleidoscope3WarmupFrames=o(e.kaleidoscope3WarmupFrames,0,240,Aa.kaleidoscope3WarmupFrames)),void 0!==e.orbit3dWarmupFrames&&(Aa.orbit3dWarmupFrames=o(e.orbit3dWarmupFrames,0,240,Aa.orbit3dWarmupFrames)),void 0!==e.orbit3d2WarmupFrames&&(Aa.orbit3d2WarmupFrames=o(e.orbit3d2WarmupFrames,0,240,Aa.orbit3d2WarmupFrames)),void 0!==e.crittersWarmupFrames&&(Aa.crittersWarmupFrames=o(e.crittersWarmupFrames,0,240,Aa.crittersWarmupFrames)),void 0!==e.neuralWarmupFrames&&(Aa.neuralWarmupFrames=o(e.neuralWarmupFrames,0,240,Aa.neuralWarmupFrames)),void 0!==e.latticeWarmupFrames&&(Aa.latticeWarmupFrames=o(e.latticeWarmupFrames,0,240,Aa.latticeWarmupFrames)),void 0!==e.parallaxLinearWarmupFrames&&(Aa.parallaxLinearWarmupFrames=o(e.parallaxLinearWarmupFrames,0,240,Aa.parallaxLinearWarmupFrames)),void 0!==e.parallaxPerspectiveWarmupFrames&&(Aa.parallaxPerspectiveWarmupFrames=o(e.parallaxPerspectiveWarmupFrames,0,240,Aa.parallaxPerspectiveWarmupFrames)),g(),void 0!==e.maxBalls&&(Aa.maxBalls=e.maxBalls),void 0!==e.repelRadius&&(Aa.repelRadius=e.repelRadius),void 0!==e.repelPower&&(Aa.repelPower=e.repelPower),void 0!==e.repelSoft&&(Aa.repelSoft=e.repelSoft),void 0!==e.repelSoftness&&(Aa.repelSoft=e.repelSoftness),void 0!==e.cursorInfluenceRadiusVw?Aa.cursorInfluenceRadiusVw=a(e.cursorInfluenceRadiusVw,0,80,Aa.cursorInfluenceRadiusVw):void 0!==e.repelRadius&&(Aa.cursorInfluenceRadiusVw=a(e.repelRadius/10,0,80,Aa.cursorInfluenceRadiusVw)),void 0!==e.responsiveScaleMobile&&(Aa.responsiveScaleMobile=e.responsiveScaleMobile),void 0!==e.mobileObjectReductionFactor&&(Aa.mobileObjectReductionFactor=a(e.mobileObjectReductionFactor,0,1,Aa.mobileObjectReductionFactor)),m(),void 0!==e.kaleidoscopeBallCount&&(Aa.kaleidoscopeBallCount=a(e.kaleidoscopeBallCount,10,300,Aa.kaleidoscopeBallCount)),void 0!==e.kaleidoscopeDotSizeVh&&(Aa.kaleidoscopeDotSizeVh=a(e.kaleidoscopeDotSizeVh,.1,6,Aa.kaleidoscopeDotSizeVh)),void 0!==e.kaleidoscopeDotAreaMul&&(Aa.kaleidoscopeDotAreaMul=a(e.kaleidoscopeDotAreaMul,.1,2,Aa.kaleidoscopeDotAreaMul)),void 0!==e.kaleidoscopeSpawnAreaMul&&(Aa.kaleidoscopeSpawnAreaMul=a(e.kaleidoscopeSpawnAreaMul,.2,2,Aa.kaleidoscopeSpawnAreaMul)),void 0!==e.kaleidoscopeSizeVariance&&(Aa.kaleidoscopeSizeVariance=a(e.kaleidoscopeSizeVariance,0,1,Aa.kaleidoscopeSizeVariance)),void 0!==e.kaleidoscope1BallCount&&(Aa.kaleidoscope1BallCount=a(e.kaleidoscope1BallCount,3,300,Aa.kaleidoscope1BallCount)),void 0!==e.kaleidoscope1Wedges&&(Aa.kaleidoscope1Wedges=a(e.kaleidoscope1Wedges,3,24,Aa.kaleidoscope1Wedges)),void 0!==e.kaleidoscope1Speed&&(Aa.kaleidoscope1Speed=a(e.kaleidoscope1Speed,.2,2,Aa.kaleidoscope1Speed)),void 0!==e.kaleidoscope1DotSizeVh&&(Aa.kaleidoscope1DotSizeVh=a(e.kaleidoscope1DotSizeVh,.1,6,Aa.kaleidoscope1DotSizeVh)),void 0!==e.kaleidoscope1DotAreaMul&&(Aa.kaleidoscope1DotAreaMul=a(e.kaleidoscope1DotAreaMul,.1,2,Aa.kaleidoscope1DotAreaMul)),void 0!==e.kaleidoscope1SpawnAreaMul&&(Aa.kaleidoscope1SpawnAreaMul=a(e.kaleidoscope1SpawnAreaMul,.2,2,Aa.kaleidoscope1SpawnAreaMul)),void 0!==e.kaleidoscope1SizeVariance&&(Aa.kaleidoscope1SizeVariance=a(e.kaleidoscope1SizeVariance,0,1,Aa.kaleidoscope1SizeVariance)),void 0!==e.kaleidoscope2BallCount&&(Aa.kaleidoscope2BallCount=a(e.kaleidoscope2BallCount,3,300,Aa.kaleidoscope2BallCount)),void 0!==e.kaleidoscope2Wedges&&(Aa.kaleidoscope2Wedges=a(e.kaleidoscope2Wedges,3,24,Aa.kaleidoscope2Wedges)),void 0!==e.kaleidoscope2Speed&&(Aa.kaleidoscope2Speed=a(e.kaleidoscope2Speed,.2,2,Aa.kaleidoscope2Speed)),void 0!==e.kaleidoscope2DotSizeVh&&(Aa.kaleidoscope2DotSizeVh=a(e.kaleidoscope2DotSizeVh,.1,6,Aa.kaleidoscope2DotSizeVh)),void 0!==e.kaleidoscope2DotAreaMul&&(Aa.kaleidoscope2DotAreaMul=a(e.kaleidoscope2DotAreaMul,.1,2,Aa.kaleidoscope2DotAreaMul)),void 0!==e.kaleidoscope2SpawnAreaMul&&(Aa.kaleidoscope2SpawnAreaMul=a(e.kaleidoscope2SpawnAreaMul,.2,2,Aa.kaleidoscope2SpawnAreaMul)),void 0!==e.kaleidoscope2SizeVariance&&(Aa.kaleidoscope2SizeVariance=a(e.kaleidoscope2SizeVariance,0,1,Aa.kaleidoscope2SizeVariance)),void 0!==e.kaleidoscope3BallCount&&(Aa.kaleidoscope3BallCount=a(e.kaleidoscope3BallCount,3,300,Aa.kaleidoscope3BallCount)),void 0!==e.kaleidoscope3Wedges&&(Aa.kaleidoscope3Wedges=a(e.kaleidoscope3Wedges,3,24,Aa.kaleidoscope3Wedges)),void 0!==e.kaleidoscope3Speed&&(Aa.kaleidoscope3Speed=a(e.kaleidoscope3Speed,.2,2,Aa.kaleidoscope3Speed)),void 0!==e.kaleidoscope3DotSizeVh&&(Aa.kaleidoscope3DotSizeVh=a(e.kaleidoscope3DotSizeVh,.1,6,Aa.kaleidoscope3DotSizeVh)),void 0!==e.kaleidoscope3DotAreaMul&&(Aa.kaleidoscope3DotAreaMul=a(e.kaleidoscope3DotAreaMul,.1,2,Aa.kaleidoscope3DotAreaMul)),void 0!==e.kaleidoscope3SpawnAreaMul&&(Aa.kaleidoscope3SpawnAreaMul=a(e.kaleidoscope3SpawnAreaMul,.2,2,Aa.kaleidoscope3SpawnAreaMul)),void 0!==e.kaleidoscope3SizeVariance&&(Aa.kaleidoscope3SizeVariance=a(e.kaleidoscope3SizeVariance,0,1,Aa.kaleidoscope3SizeVariance)),void 0!==e.kaleidoscopeWedges?Aa.kaleidoscopeWedges=a(e.kaleidoscopeWedges,3,24,Aa.kaleidoscopeWedges):void 0!==e.kaleidoscopeSegments&&(Aa.kaleidoscopeWedges=a(e.kaleidoscopeSegments,3,24,Aa.kaleidoscopeWedges)),void 0!==e.kaleidoscopeMirror&&(Aa.kaleidoscopeMirror=a(e.kaleidoscopeMirror,0,1,Aa.kaleidoscopeMirror)),void 0!==e.kaleidoscopeSpeed)Aa.kaleidoscopeSpeed=a(e.kaleidoscopeSpeed,.2,2,Aa.kaleidoscopeSpeed);else if(void 0!==e.kaleidoscopeSwirlStrength){const t=a(e.kaleidoscopeSwirlStrength,0,800,52);Aa.kaleidoscopeSpeed=a(.2+t/800*1.8,.2,2,Aa.kaleidoscopeSpeed)}void 0!==e.critterCount&&(Aa.critterCount=e.critterCount),void 0!==e.critterSpeed&&(Aa.critterSpeed=e.critterSpeed),void 0!==e.critterMaxSpeed&&(Aa.critterMaxSpeed=e.critterMaxSpeed),void 0!==e.critterStepHz&&(Aa.critterStepHz=e.critterStepHz),void 0!==e.critterStepSharpness&&(Aa.critterStepSharpness=e.critterStepSharpness),void 0!==e.critterTurnNoise&&(Aa.critterTurnNoise=e.critterTurnNoise),void 0!==e.critterTurnDamp&&(Aa.critterTurnDamp=e.critterTurnDamp),void 0!==e.critterTurnSeek&&(Aa.critterTurnSeek=e.critterTurnSeek),void 0!==e.critterAvoidRadius&&(Aa.critterAvoidRadius=e.critterAvoidRadius),void 0!==e.critterAvoidForce&&(Aa.critterAvoidForce=e.critterAvoidForce),void 0!==e.critterEdgeAvoid&&(Aa.critterEdgeAvoid=e.critterEdgeAvoid),void 0!==e.critterMousePull&&(Aa.critterMousePull=e.critterMousePull),void 0!==e.layoutMinContentPaddingPx&&(Aa.layoutMinContentPaddingPx=a(e.layoutMinContentPaddingPx,0,200,Aa.layoutMinContentPaddingPx)),void 0!==e.layoutMinWallRadiusPx&&(Aa.layoutMinWallRadiusPx=a(e.layoutMinWallRadiusPx,0,400,Aa.layoutMinWallRadiusPx)),void 0!==e.critterMouseRadiusVw&&(Aa.critterMouseRadiusVw=e.critterMouseRadiusVw),void 0!==e.critterRestitution&&(Aa.critterRestitution=e.critterRestitution),void 0!==e.critterFriction&&(Aa.critterFriction=e.critterFriction),void 0!==e.neuralBallCount&&(Aa.neuralBallCount=a(e.neuralBallCount,8,260,Aa.neuralBallCount)),void 0!==e.neuralLinkDistanceVw&&(Aa.neuralLinkDistanceVw=a(e.neuralLinkDistanceVw,1,50,Aa.neuralLinkDistanceVw)),void 0!==e.neuralLineOpacity&&(Aa.neuralLineOpacity=a(e.neuralLineOpacity,0,1,Aa.neuralLineOpacity)),void 0!==e.neuralWanderStrength&&(Aa.neuralWanderStrength=a(e.neuralWanderStrength,0,4e3,Aa.neuralWanderStrength)),void 0!==e.neuralMaxLinksPerBall&&(Aa.neuralMaxLinksPerBall=a(e.neuralMaxLinksPerBall,0,16,Aa.neuralMaxLinksPerBall)),void 0!==e.neuralDamping&&(Aa.neuralDamping=a(e.neuralDamping,.8,1,Aa.neuralDamping)),void 0!==e.latticeBallCount&&(Aa.latticeBallCount=a(e.latticeBallCount,8,260,Aa.latticeBallCount)),void 0!==e.latticeSpacingVw&&(Aa.latticeSpacingVw=a(e.latticeSpacingVw,1,40,Aa.latticeSpacingVw)),void 0!==e.latticeStiffness&&(Aa.latticeStiffness=a(e.latticeStiffness,0,20,Aa.latticeStiffness)),void 0!==e.latticeDamping&&(Aa.latticeDamping=a(e.latticeDamping,.5,1,Aa.latticeDamping)),void 0!==e.latticeDisruptRadius&&(Aa.latticeDisruptRadius=a(e.latticeDisruptRadius,50,800,Aa.latticeDisruptRadius)),void 0!==e.latticeDisruptPower&&(Aa.latticeDisruptPower=a(e.latticeDisruptPower,0,20,Aa.latticeDisruptPower)),void 0!==e.latticeMeshWaveStrength&&(Aa.latticeMeshWaveStrength=a(e.latticeMeshWaveStrength,0,50,Aa.latticeMeshWaveStrength)),void 0!==e.latticeMeshWaveSpeed&&(Aa.latticeMeshWaveSpeed=a(e.latticeMeshWaveSpeed,0,3,Aa.latticeMeshWaveSpeed)),void 0!==e.latticeAlignment&&(Aa.latticeAlignment=e.latticeAlignment+""),void 0!==e.parallaxLinearDotCount&&(Aa.parallaxLinearDotCount=a(e.parallaxLinearDotCount,20,220,Aa.parallaxLinearDotCount)),void 0!==e.parallaxLinearGridJitter&&(Aa.parallaxLinearGridJitter=a(e.parallaxLinearGridJitter,0,1,Aa.parallaxLinearGridJitter)),void 0!==e.parallaxLinearFarSpeed&&(Aa.parallaxLinearFarSpeed=a(e.parallaxLinearFarSpeed,0,1.5,Aa.parallaxLinearFarSpeed)),void 0!==e.parallaxLinearMidSpeed&&(Aa.parallaxLinearMidSpeed=a(e.parallaxLinearMidSpeed,0,1.5,Aa.parallaxLinearMidSpeed)),void 0!==e.parallaxLinearNearSpeed&&(Aa.parallaxLinearNearSpeed=a(e.parallaxLinearNearSpeed,0,1.5,Aa.parallaxLinearNearSpeed)),void 0!==e.parallaxLinearGridX&&(Aa.parallaxLinearGridX=o(e.parallaxLinearGridX,3,40,Aa.parallaxLinearGridX)),void 0!==e.parallaxLinearGridY&&(Aa.parallaxLinearGridY=o(e.parallaxLinearGridY,3,40,Aa.parallaxLinearGridY)),void 0!==e.parallaxLinearGridZ&&(Aa.parallaxLinearGridZ=o(e.parallaxLinearGridZ,2,20,Aa.parallaxLinearGridZ)),void 0!==e.parallaxLinearSpanX&&(Aa.parallaxLinearSpanX=a(e.parallaxLinearSpanX,.2,3,Aa.parallaxLinearSpanX)),void 0!==e.parallaxLinearSpanY&&(Aa.parallaxLinearSpanY=a(e.parallaxLinearSpanY,.2,3,Aa.parallaxLinearSpanY)),void 0!==e.parallaxLinearZNear&&(Aa.parallaxLinearZNear=a(e.parallaxLinearZNear,10,1200,Aa.parallaxLinearZNear)),void 0!==e.parallaxLinearZFar&&(Aa.parallaxLinearZFar=a(e.parallaxLinearZFar,50,3e3,Aa.parallaxLinearZFar)),void 0!==e.parallaxLinearFocalLength&&(Aa.parallaxLinearFocalLength=a(e.parallaxLinearFocalLength,80,2e3,Aa.parallaxLinearFocalLength)),void 0!==e.parallaxLinearParallaxStrength&&(Aa.parallaxLinearParallaxStrength=a(e.parallaxLinearParallaxStrength,0,2e3,Aa.parallaxLinearParallaxStrength)),void 0!==e.parallaxLinearDotSizeMul&&(Aa.parallaxLinearDotSizeMul=a(e.parallaxLinearDotSizeMul,.1,6,Aa.parallaxLinearDotSizeMul)),void 0!==e.parallaxLinearFollowStrength&&(Aa.parallaxLinearFollowStrength=a(e.parallaxLinearFollowStrength,1,80,Aa.parallaxLinearFollowStrength)),void 0!==e.parallaxLinearDamping&&(Aa.parallaxLinearDamping=a(e.parallaxLinearDamping,1,80,Aa.parallaxLinearDamping)),void 0!==e.parallaxPerspectiveDotCount&&(Aa.parallaxPerspectiveDotCount=a(e.parallaxPerspectiveDotCount,40,420,Aa.parallaxPerspectiveDotCount)),void 0!==e.parallaxPerspectiveDepthMul&&(Aa.parallaxPerspectiveDepthMul=a(e.parallaxPerspectiveDepthMul,.5,3,Aa.parallaxPerspectiveDepthMul)),void 0!==e.parallaxPerspectiveFocalLength&&(Aa.parallaxPerspectiveFocalLength=a(e.parallaxPerspectiveFocalLength,80,1e3,Aa.parallaxPerspectiveFocalLength)),void 0!==e.parallaxPerspectiveFollowStrength&&(Aa.parallaxPerspectiveFollowStrength=a(e.parallaxPerspectiveFollowStrength,1,40,Aa.parallaxPerspectiveFollowStrength)),void 0!==e.parallaxPerspectiveDamping&&(Aa.parallaxPerspectiveDamping=a(e.parallaxPerspectiveDamping,1,40,Aa.parallaxPerspectiveDamping)),void 0!==e.parallaxPerspectiveZ1&&(Aa.parallaxPerspectiveZ1=a(e.parallaxPerspectiveZ1,200,2e3,Aa.parallaxPerspectiveZ1)),void 0!==e.parallaxPerspectiveZ2&&(Aa.parallaxPerspectiveZ2=a(e.parallaxPerspectiveZ2,150,1500,Aa.parallaxPerspectiveZ2)),void 0!==e.parallaxPerspectiveZ3&&(Aa.parallaxPerspectiveZ3=a(e.parallaxPerspectiveZ3,100,1e3,Aa.parallaxPerspectiveZ3)),void 0!==e.parallaxPerspectiveZ4&&(Aa.parallaxPerspectiveZ4=a(e.parallaxPerspectiveZ4,40,600,Aa.parallaxPerspectiveZ4)),void 0!==e.parallaxPerspectiveZ5&&(Aa.parallaxPerspectiveZ5=a(e.parallaxPerspectiveZ5,10,300,Aa.parallaxPerspectiveZ5)),void 0!==e.parallaxPerspectiveGridX&&(Aa.parallaxPerspectiveGridX=o(e.parallaxPerspectiveGridX,3,50,Aa.parallaxPerspectiveGridX)),void 0!==e.parallaxPerspectiveGridY&&(Aa.parallaxPerspectiveGridY=o(e.parallaxPerspectiveGridY,3,50,Aa.parallaxPerspectiveGridY)),void 0!==e.parallaxPerspectiveGridZ&&(Aa.parallaxPerspectiveGridZ=o(e.parallaxPerspectiveGridZ,2,25,Aa.parallaxPerspectiveGridZ)),void 0!==e.parallaxPerspectiveSpanX&&(Aa.parallaxPerspectiveSpanX=a(e.parallaxPerspectiveSpanX,.2,3,Aa.parallaxPerspectiveSpanX)),void 0!==e.parallaxPerspectiveSpanY&&(Aa.parallaxPerspectiveSpanY=a(e.parallaxPerspectiveSpanY,.2,3,Aa.parallaxPerspectiveSpanY)),void 0!==e.parallaxPerspectiveZNear&&(Aa.parallaxPerspectiveZNear=a(e.parallaxPerspectiveZNear,10,1200,Aa.parallaxPerspectiveZNear)),void 0!==e.parallaxPerspectiveZFar&&(Aa.parallaxPerspectiveZFar=a(e.parallaxPerspectiveZFar,50,4e3,Aa.parallaxPerspectiveZFar)),void 0!==e.parallaxPerspectiveParallaxStrength&&(Aa.parallaxPerspectiveParallaxStrength=a(e.parallaxPerspectiveParallaxStrength,0,2e3,Aa.parallaxPerspectiveParallaxStrength)),void 0!==e.parallaxPerspectiveRandomness&&(Aa.parallaxPerspectiveRandomness=a(e.parallaxPerspectiveRandomness,0,1,Aa.parallaxPerspectiveRandomness)),void 0!==e.parallaxPerspectiveDotSizeMul&&(Aa.parallaxPerspectiveDotSizeMul=a(e.parallaxPerspectiveDotSizeMul,.1,6,Aa.parallaxPerspectiveDotSizeMul));for(const[a,o]of Object.entries(e||{}))a in Aa&&"config"!==a&&"soundConfig"!==a&&"soundPreset"!==a&&"function"!=typeof Aa[a]&&(Array.isArray(o)||null===o||["string","number","boolean"].includes(typeof o))&&void 0!==o&&(Aa[a]=o);void 0!==e.sceneImpactEnabled&&(Aa.sceneImpactEnabled=!!e.sceneImpactEnabled),void 0!==e.sceneImpactMul?Aa.sceneImpactMul=a(e.sceneImpactMul,0,.05,Aa.sceneImpactMul):void 0!==e.brandLogoImpactMul&&(Aa.sceneImpactMul=a(e.brandLogoImpactMul,0,.05,Aa.sceneImpactMul)),void 0!==e.sceneImpactMobileMulFactor&&(Aa.sceneImpactMobileMulFactor=a(e.sceneImpactMobileMulFactor,.25,3,Aa.sceneImpactMobileMulFactor)),void 0!==e.sceneImpactLogoCompMul&&(Aa.sceneImpactLogoCompMul=a(e.sceneImpactLogoCompMul,.25,6,Aa.sceneImpactLogoCompMul)),void 0!==e.sceneImpactOvershoot?Aa.sceneImpactOvershoot=a(e.sceneImpactOvershoot,0,.8,Aa.sceneImpactOvershoot):void 0!==e.brandLogoOvershoot&&(Aa.sceneImpactOvershoot=a(e.brandLogoOvershoot,0,.8,Aa.sceneImpactOvershoot)),void 0!==e.sceneImpactAnticipation?Aa.sceneImpactAnticipation=a(e.sceneImpactAnticipation,0,.6,Aa.sceneImpactAnticipation):void 0!==e.brandLogoAnticipation&&(Aa.sceneImpactAnticipation=a(e.brandLogoAnticipation,0,.6,Aa.sceneImpactAnticipation)),void 0!==e.sceneImpactPressMs?Aa.sceneImpactPressMs=a(e.sceneImpactPressMs,20,300,Aa.sceneImpactPressMs):void 0!==e.brandLogoPressMs&&(Aa.sceneImpactPressMs=a(e.brandLogoPressMs,20,300,Aa.sceneImpactPressMs)),void 0!==e.sceneImpactReleaseMs?Aa.sceneImpactReleaseMs=a(e.sceneImpactReleaseMs,40,1200,Aa.sceneImpactReleaseMs):void 0!==e.brandLogoReleaseMs&&(Aa.sceneImpactReleaseMs=a(e.brandLogoReleaseMs,40,1200,Aa.sceneImpactReleaseMs)),void 0!==e.sceneChangeSoundEnabled&&(Aa.sceneChangeSoundEnabled=!!e.sceneChangeSoundEnabled),void 0!==e.sceneChangeSoundIntensity&&(Aa.sceneChangeSoundIntensity=a(e.sceneChangeSoundIntensity,0,1,Aa.sceneChangeSoundIntensity)),void 0!==e.sceneChangeSoundRadius&&(Aa.sceneChangeSoundRadius=a(e.sceneChangeSoundRadius,6,60,Aa.sceneChangeSoundRadius)),void 0!==e.containerBorder&&(Aa.containerBorder=e.containerBorder),void 0!==e.simulationPadding&&(Aa.simulationPadding=e.simulationPadding),void 0!==e.contentPadding&&(Aa.contentPadding=e.contentPadding),void 0!==e.bgLight&&(Aa.bgLight=e.bgLight),void 0!==e.bgDark&&(Aa.bgDark=e.bgDark),void 0!==e.frameColor&&(Aa.frameColor=e.frameColor),void 0!==e.textColorLight&&(Aa.textColorLight=e.textColorLight),void 0!==e.textColorLightMuted&&(Aa.textColorLightMuted=e.textColorLightMuted),void 0!==e.textColorDark&&(Aa.textColorDark=e.textColorDark),void 0!==e.textColorDarkMuted&&(Aa.textColorDarkMuted=e.textColorDarkMuted),void 0!==e.edgeLabelColorLight&&(Aa.edgeLabelColorLight=e.edgeLabelColorLight),void 0!==e.edgeLabelColorDark&&(Aa.edgeLabelColorDark=e.edgeLabelColorDark),void 0!==e.edgeLabelInsetAdjustPx&&(Aa.edgeLabelInsetAdjustPx=a(e.edgeLabelInsetAdjustPx,-500,500,Aa.edgeLabelInsetAdjustPx)),void 0!==e.linkHoverColor&&(Aa.linkHoverColor=e.linkHoverColor),void 0!==e.logoColorLight&&(Aa.logoColorLight=e.logoColorLight),void 0!==e.logoColorDark&&(Aa.logoColorDark=e.logoColorDark),void 0!==e.noiseBackOpacity&&(Aa.noiseBackOpacity=a(e.noiseBackOpacity,0,.3,Aa.noiseBackOpacity)),void 0!==e.noiseFrontOpacity&&(Aa.noiseFrontOpacity=a(e.noiseFrontOpacity,0,.3,Aa.noiseFrontOpacity)),void 0!==e.noiseBackOpacityDark&&(Aa.noiseBackOpacityDark=a(e.noiseBackOpacityDark,0,.5,Aa.noiseBackOpacityDark)),void 0!==e.noiseFrontOpacityDark&&(Aa.noiseFrontOpacityDark=a(e.noiseFrontOpacityDark,0,.5,Aa.noiseFrontOpacityDark)),void 0!==e.wallThickness&&(Aa.wallThickness=e.wallThickness),void 0!==e.wallRadius&&(Aa.wallRadius=e.wallRadius,Aa.cornerRadius=e.wallRadius),void 0!==e.wallInset&&(Aa.wallInset=e.wallInset),void 0!==e.wallInset&&(Aa.wallInset=e.wallInset),void 0!==e.ballSpacing&&(Aa.ballSpacing=e.ballSpacing),void 0!==e.wallPreset&&(Aa.wallPreset=e.wallPreset),void 0!==e.wallSoftness&&(Aa.wallSoftness=e.wallSoftness),void 0!==e.wallBounciness&&(Aa.wallBounciness=e.wallBounciness),void 0!==e.wallWobbleMaxDeform&&(Aa.wallWobbleMaxDeform=e.wallWobbleMaxDeform),void 0!==e.wallWobbleStiffness&&(Aa.wallWobbleStiffness=e.wallWobbleStiffness),void 0!==e.wallWobbleDamping&&(Aa.wallWobbleDamping=e.wallWobbleDamping),void 0!==e.wallWobbleSigma&&(Aa.wallWobbleSigma=e.wallWobbleSigma),void 0!==e.wallWobbleCornerClamp&&(Aa.wallWobbleCornerClamp=e.wallWobbleCornerClamp),void 0!==e.wallWobbleImpactThreshold&&(Aa.wallWobbleImpactThreshold=e.wallWobbleImpactThreshold),void 0!==e.wallWobbleSettlingSpeed&&(Aa.wallWobbleSettlingSpeed=e.wallWobbleSettlingSpeed),void 0!==e.gateOverlayEnabled&&(Aa.gateOverlayEnabled=e.gateOverlayEnabled),void 0!==e.gateOverlayOpacity&&(Aa.gateOverlayOpacity=e.gateOverlayOpacity),void 0!==e.gateOverlayBlurPx&&(Aa.gateOverlayBlurPx=e.gateOverlayBlurPx),void 0!==e.gateOverlayTransitionMs&&(Aa.gateOverlayTransitionMs=e.gateOverlayTransitionMs),void 0!==e.gateOverlayTransitionOutMs&&(Aa.gateOverlayTransitionOutMs=e.gateOverlayTransitionOutMs),void 0!==e.orbit3dMoonCount&&(Aa.orbit3dMoonCount=a(e.orbit3dMoonCount,1,1e3,Aa.orbit3dMoonCount)),void 0!==e.orbit3dGravity&&(Aa.orbit3dGravity=a(e.orbit3dGravity,1e3,5e5,Aa.orbit3dGravity)),void 0!==e.orbit3dMoonMass&&(Aa.orbit3dMoonMass=a(e.orbit3dMoonMass,.1,100,Aa.orbit3dMoonMass)),void 0!==e.orbit3dVelocityMult&&(Aa.orbit3dVelocityMult=a(e.orbit3dVelocityMult,10,1e3,Aa.orbit3dVelocityMult)),void 0!==e.orbit3dTargetOrbit&&(Aa.orbit3dTargetOrbit=a(e.orbit3dTargetOrbit,1,100,Aa.orbit3dTargetOrbit)),void 0!==e.orbit3dMinOrbit&&(Aa.orbit3dMinOrbit=a(e.orbit3dMinOrbit,1,100,Aa.orbit3dMinOrbit)),void 0!==e.orbit3dMaxOrbit&&(Aa.orbit3dMaxOrbit=a(e.orbit3dMaxOrbit,1,200,Aa.orbit3dMaxOrbit)),void 0!==e.orbit3dDepthScale&&(Aa.orbit3dDepthScale=a(e.orbit3dDepthScale,0,1.5,Aa.orbit3dDepthScale)),void 0!==e.orbit3dDamping&&(Aa.orbit3dDamping=a(e.orbit3dDamping,.01,.2,Aa.orbit3dDamping)),void 0!==e.orbit3d2MoonCount&&(Aa.orbit3d2MoonCount=a(e.orbit3d2MoonCount,1,300,Aa.orbit3d2MoonCount)),void 0!==e.orbit3d2Gravity&&(Aa.orbit3d2Gravity=a(e.orbit3d2Gravity,1e3,5e5,Aa.orbit3d2Gravity)),void 0!==e.orbit3d2VelocityMult&&(Aa.orbit3d2VelocityMult=a(e.orbit3d2VelocityMult,.1,2,Aa.orbit3d2VelocityMult)),void 0!==e.orbit3d2MinOrbit&&(Aa.orbit3d2MinOrbit=a(e.orbit3d2MinOrbit,1,50,Aa.orbit3d2MinOrbit)),void 0!==e.orbit3d2MaxOrbit&&(Aa.orbit3d2MaxOrbit=a(e.orbit3d2MaxOrbit,1,50,Aa.orbit3d2MaxOrbit)),void 0!==e.orbit3d2DepthScale&&(Aa.orbit3d2DepthScale=a(e.orbit3d2DepthScale,0,.95,Aa.orbit3d2DepthScale)),void 0!==e.orbit3d2Damping&&(Aa.orbit3d2Damping=a(e.orbit3d2Damping,0,1,Aa.orbit3d2Damping)),void 0!==e.orbit3d2FollowSmoothing&&(Aa.orbit3d2FollowSmoothing=a(e.orbit3d2FollowSmoothing,1,200,Aa.orbit3d2FollowSmoothing)),void 0!==e.orbit3d2Softening&&(Aa.orbit3d2Softening=a(e.orbit3d2Softening,1,100,Aa.orbit3d2Softening));const t=n();void 0!==e.containerBorderVw&&(Aa.containerBorderVw=a(e.containerBorderVw,0,20,Aa.containerBorderVw)),void 0!==e.simulationPaddingVw&&(Aa.simulationPaddingVw=a(e.simulationPaddingVw,0,20,Aa.simulationPaddingVw)),void 0!==e.contentPaddingVw&&(Aa.contentPaddingVw=a(e.contentPaddingVw,0,40,Aa.contentPaddingVw)),void 0!==e.contentPaddingHorizontalRatio&&(Aa.contentPaddingHorizontalRatio=a(e.contentPaddingHorizontalRatio,.1,3,Aa.contentPaddingHorizontalRatio)),void 0!==e.mobileWallThicknessXFactor&&(Aa.mobileWallThicknessXFactor=a(e.mobileWallThicknessXFactor,.5,3,Aa.mobileWallThicknessXFactor)),void 0!==e.mobileEdgeLabelsVisible&&(Aa.mobileEdgeLabelsVisible=!!e.mobileEdgeLabelsVisible),void 0!==e.wallRadiusVw&&(Aa.wallRadiusVw=a(e.wallRadiusVw,0,40,Aa.wallRadiusVw)),void 0!==e.wallThicknessVw&&(Aa.wallThicknessVw=a(e.wallThicknessVw,0,20,Aa.wallThicknessVw)),Number.isFinite(Aa.containerBorderVw)&&Aa.containerBorderVw>0||(Aa.containerBorderVw=i(Aa.containerBorder,t)),Number.isFinite(Aa.simulationPaddingVw)&&Aa.simulationPaddingVw>=0||(Aa.simulationPaddingVw=i(Aa.simulationPadding,t)),Number.isFinite(Aa.contentPaddingVw)&&Aa.contentPaddingVw>0||(Aa.contentPaddingVw=i(Aa.contentPadding,t)),Number.isFinite(Aa.wallRadiusVw)&&Aa.wallRadiusVw>0||(Aa.wallRadiusVw=i(Aa.wallRadius,t)),Number.isFinite(Aa.wallThicknessVw)&&Aa.wallThicknessVw>0||(Aa.wallThicknessVw=i(Aa.wallThickness,t)),l()}function d(){return Aa}function p(e){const t=d(),a=Math.round(+e||0);return Math.max(0,t.isMobile?Math.round(a*Math.max(0,Math.min(1,+(t.mobileObjectReductionFactor??.7)))):a)}function u(e,t,a){Aa.canvas=e,Aa.ctx=t,Aa.container=a}function h(e){Aa.currentMode=e}function f(){Aa.balls.length=0}function m(){const e=navigator.userAgent||"",t=/iPad/.test(e)||/Mac/.test(e)&&navigator.maxTouchPoints>1,a=/iPhone/.test(e);let o=!1;try{o=!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(s){}const n=!(!t&&!a),i=o,r=n,l=n||o?Aa.responsiveScaleMobile:1;if(Aa.isMobile!==r||Aa.isMobileViewport!==i||Math.abs((Aa.responsiveScale??1)-l)>1e-6){Aa.isMobile=r,Aa.isMobileViewport=i,Aa.responsiveScale=l,(Aa.isMobile||Aa.isMobileViewport)&&console.log(`✓ Mobile scaling active - ball scale: ${Aa.responsiveScale}x (${Aa.isMobile?"device":"viewport"})`),g();try{const e=(Aa.R_MIN+Aa.R_MAX)/2;if(Number.isFinite(e)&&e>0&&Array.isArray(Aa.balls)&&Aa.balls.length)for(let t=0;Aa.balls.length>t;t++){const a=Aa.balls[t];a&&(a.r=e,a.rBase=e)}}catch(s){}}}function g(){Aa.R_MED=Math.max(1,(Aa.R_MIN_BASE+Aa.R_MAX_BASE)/2*Aa.sizeScale*Aa.responsiveScale);const e=a(Aa.sizeVariationCap,0,.5,.12),t=a(Aa.sizeVariationGlobalMul,0,2,1),o=a(e*t,0,.5,e);Aa.R_MIN=Math.max(1,Aa.R_MED*(1-o)),Aa.R_MAX=Math.max(Aa.R_MIN,Aa.R_MED*(1+o))}function b(e,t,a,o=t){const n=+e;if(!Number.isFinite(n))return o;const i=Math.floor(n);return t>i?t:i>a?a:i}function M(e,t,a){const o=+e;if(!Number.isFinite(o))return t;const n=Math.floor(o);return t>n?t:n>a?a:n}function y(e){return Array.isArray(e)&&e.every(e=>Number.isFinite(+e))}function v(e){const t=((e||"")+"").trim();if(!t)return null;const a="#"===t[0]?t.slice(1):t;if(3!==a.length&&6!==a.length)return null;const o=parseInt(3===a.length?a[0]+a[0]+a[1]+a[1]+a[2]+a[2]:a,16);return Number.isFinite(o)?{r:(o>>16&255)/255,g:(o>>8&255)/255,b:(255&o)/255}:null}function x(e){return e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92}function w(e){const t=v(e);return t?.2126*x(t.r)+.7152*x(t.g)+.0722*x(t.b):1}function S(e){const t=v(e);if(!t)return 0;const a=Math.max(t.r,t.g,t.b);return a>0?(a-Math.min(t.r,t.g,t.b))/a:0}function C(e,t){const a=t||d(),o=e&&e.length?e:[],n=Math.min(7,o.length-1);if(0>n)return[];const i=Number.isFinite(+a.cursorColorLumaMax)?+a.cursorColorLumaMax:.62,r=y(a.cursorColorAllowIndices)?a.cursorColorAllowIndices.map(e=>M(e,0,7)):[],l=y(a.cursorColorDenyIndices)?a.cursorColorDenyIndices.map(e=>M(e,0,7)):[],s=new Set(l),c=r.length?new Set(r):null,p=[];for(let d=0;n>=d;d++){if(s.has(d))continue;if(c&&!c.has(d))continue;const e=o[d];e&&(w(e)>i||.18>S(e)||p.push(d))}if(p.length)return p;const u=[];for(const d of za)d>n||s.has(d)||c&&!c.has(d)||u.push(d);if(u.length)return u;for(let d=0;n>=d;d++)s.has(d)||c&&!c.has(d)||u.push(d);return u}function k(e,{forceMode:t}={}){const a=d(),o=a.currentColors,n=C(o,a),i=M(e,0,7),r=n.includes(i)?i:n[0]??i,l=((e,t)=>{const a=e&&e.length?e:[];return a[M(t,0,Math.max(0,Math.min(7,a.length-1)))]||"#000000"})(o,r);return t&&(a.cursorColorMode=t),a.cursorColorIndex=r,a.cursorColorHex=l,(e=>{try{document.documentElement.style.setProperty("--cursor-color",(e+"").trim()||"#000000")}catch(t){}})(l),{index:r,hex:l}}function P(){const e=d();if("auto"!==e.cursorColorMode)return k(e.cursorColorIndex,{forceMode:e.cursorColorMode}),!1;const t=C(e.currentColors,e);if(!t.length)return!1;const a=Number.isFinite(+e.o)?+e.o:-1;let o=t[Math.random()*t.length|0];return t.length>1&&o===a&&(o=t[Math.random()*t.length|0],o===a&&(o=t[(t.indexOf(a)+1)%t.length])),e.o=o,k(o,{forceMode:"auto"}),!0}function F(e){const t=d(),a=Oa[e];return a?t.isDarkMode?a.dark:a.light:Oa.industrialTeal.light}function D(){const e=d(),t=e.currentColors;if(!t||0===t.length)return console.warn("No colors available, using fallback"),"#ffffff";const a=(e=>{const t=e?.colorDistribution;return Array.isArray(t)?t:null})(e);if(a&&a.length){let e=0;for(let t=0;a.length>t;t++){const o=+a[t]?.weight;Number.isFinite(o)&&o>0&&(e+=o)}if(e>0){let o=Math.random()*e;for(let e=0;a.length>e;e++){const n=a[e],i=+n?.weight;if(Number.isFinite(i)&&i>0&&(o-=i,0>=o))return t[b(n?.colorIndex,0,7,0)]||t[0]||"#ffffff"}const n=a[a.length-1];return t[b(n?.colorIndex,0,7,0)]||t[0]||"#ffffff"}}const o=Math.random();let n=0;const i=Math.min(t.length,8,8);for(let r=0;i>r;r++)if(n+=Ra[r],n>=o)return t[r];return t[Math.min(t.length-1,7)]||"#ffffff"}function T(e){const t=d();t.currentTemplate=e,t.currentColors=F(e),"auto"!==t.cursorColorMode&&"manual"!==t.cursorColorMode&&(t.cursorColorMode="auto"),k(t.cursorColorIndex,{forceMode:t.cursorColorMode}),(()=>{const e=d().balls;for(let t=0;e.length>t;t++)e[t].color=D()})(),(e=>{try{const t=document.documentElement,a=(e&&e.length?e:[]).slice(0,8);for(let e=0;8>e;e++)t.style.setProperty("--ball-"+(e+1),a[e]||"#ffffff")}catch(t){}})(t.currentColors),(()=>{const e=d().currentColors;for(let t=1;8>=t;t++){const a=document.getElementById("color"+t),o=document.getElementById(`color${t}Val`);a&&e[t-1]&&(a.value=e[t-1],o&&(o.textContent=e[t-1].toUpperCase()))}})();try{window.dispatchEvent(new CustomEvent("bb:paletteChanged",{detail:{template:e}}))}catch(a){}}function L(){const e=document.getElementById("colorSelect");if(!e)return;e.innerHTML="";for(const[a,o]of Object.entries(Oa)){const t=document.createElement("option");t.value=a,t.textContent=o.label,e.appendChild(t)}const t=d();e.value=t.currentTemplate}function I(e,t=.15){return e*(1+2*(Math.random()-.5)*t)}function A(){try{"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent(Qa,{detail:$()}))}catch(e){}}function K(){if(!ro&&(ro=!0,"undefined"!=typeof window&&window.matchMedia)){const e=window.matchMedia("(prefers-reduced-motion: reduce)");no=e.matches,e.addEventListener("change",e=>{no=e.matches})}}async function O(){if(Ja)return!0;try{const e=window.AudioContext||window.webkitAudioContext;return e?(_a=new e({latencyHint:"interactive",sampleRate:44100}),"suspended"===_a.state&&await _a.resume(),(()=>{Ga=_a.createGain(),Ga.gain.value=Ba.masterGain,Za=_a.createDynamicsCompressor(),Za.threshold.value=-6,Za.knee.value=10,Za.ratio.value=16,Za.attack.value=5e-4,Za.release.value=.08,Xa=_a.createBiquadFilter(),Xa.type="highshelf",Xa.frequency.value=Ba.highShelfFreq,Xa.gain.value=Ba.highShelfGain,Xa.Q.value=.7,Ya=_a.createWaveShaper(),Ya.curve=((e=.55)=>{const t=1024,a=new Float32Array(t),o=1+8*e;for(let n=0;t>n;n++)a[n]=Math.tanh(o*(2*n/(t-1)-1))/Math.tanh(o);return a})(.55),Ya.oversample="2x",Ha=_a.createGain(),Ha.gain.value=1-Ba.reverbWetMix,ja=_a.createGain(),ja.gain.value=Ba.reverbWetMix,Na=(()=>{const e=_a.createGain(),t=_a.createGain(),a=[.029,.037,.053,.067].map(e=>{const t=_a.createDelay(.1);return t.delayTime.value=e*Ba.reverbDecay,t}),o=a.map(()=>{const e=_a.createGain();return e.gain.value=.4,e}),n=_a.createBiquadFilter();return n.type="lowpass",n.frequency.value=2e3*(1-Ba.reverbHighDamp),n.Q.value=.5,a.forEach((t,i)=>{e.connect(t),t.connect(o[i]),o[i].connect(n),o[i].connect(a[(i+1)%a.length])}),n.connect(t),e.connect(t),e.l=t,e})();const e=Na.l;Ha.connect(Ya),ja.connect(Na),e.connect(Ya),Ya.connect(Xa),Xa.connect(Za),Za.connect(Ga),Ga.connect(_a.destination),(()=>{if(_a){if(qa)try{qa.disconnect()}catch(e){}else qa=_a.createGain(),qa.gain.value=1;qa.connect(Za||_a.destination)}})(),(()=>{to=[];for(let e=0;eo>e;e++){const t={id:e,inUse:!1,startTime:0,filter:_a.createBiquadFilter(),envelope:_a.createGain(),panner:_a.createStereoPanner(),reverbSend:_a.createGain(),noiseFilter:_a.createBiquadFilter(),noiseEnvelope:_a.createGain(),osc:null,harmonicOsc:null,sparkleOsc:null,noiseSource:null};t.filter.type="lowpass",t.noiseFilter.type="bandpass",t.noiseFilter.Q.value=1.2,t.filter.connect(t.envelope),t.envelope.connect(t.panner),t.panner.connect(Ha),t.panner.connect(t.reverbSend),t.reverbSend.connect(ja),t.noiseFilter.connect(t.noiseEnvelope),t.noiseEnvelope.connect(t.panner),to.push(t)}})()})(),Ja=!0,Ua=!0,A(),console.log(`✓ Audio unlocked (${(1e3*(_a.baseLatency||0)).toFixed(1)}ms base latency)`),!0):(console.warn("Web Audio API not supported"),!1)}catch(e){return console.error("Failed to unlock audio:",e),!1}}function R(e,t,a=.5,o=null){if(!Ua||!Ja||!_a||no)return;if(Ba.collisionMinImpact>t)return;const n=_a.currentTime;if(.005>n-ao)return;if(null!==o){const e=oo.get(o)||0;if(Ba.minTimeBetweenSounds>n-e)return;oo.set(o,n)}if(ao=n,oo.size>200){const e=n-.5;for(const[t,a]of oo)e>a&&oo.delete(t)}const i=(()=>{for(let t=0;eo>t;t++)if(!to[t].inUse)return to[t];let e=to[0];for(let t=1;eo>t;t++)e.startTime>to[t].startTime&&(e=to[t]);return V(e),e})();i&&((e,t,a,o,n)=>{e.inUse=!0,e.startTime=n;const i=Math.pow(Math.max(0,Math.min(1,a)),Ba.intensityExponent),r=I(t,Ba.variancePitch),l=I(Ba.decayTime,Ba.varianceDecay)*(1-i*(1-Ba.velocityDecayScale)),s=l+.02;let c=Ba.minGain+(Ba.maxGain-Ba.minGain)*i;c*=I(1,Ba.varianceGain);const d=1+(Ba.velocityBrightnessScale-1)*i;let p=Ba.filterBaseFreq+Ba.filterVelocityRange*Math.pow(i,1.3);p*=I(1,Ba.varianceFilter)*d;const u=2*(o-.5)*Ba.maxPan,h=.12+.5*(1-i);({gain:c,filterFreq:p}=((e,t,a)=>{const o=E((e-Ba.toneSafetyMinHz)/(Ba.toneSafetyMaxHz-Ba.toneSafetyMinHz),0,1),n=Ba.toneSafetyExponent,i=Math.pow(o,n),r=E(1-Ba.toneSafetyHighGainAtten*i-Ba.toneSafetyLowGainAtten*Math.pow(1-o,n),.6,1);let l=Math.min(t*r,Ba.voiceGainMax);const s=E(1-Ba.toneSafetyHighBrightAtten*i,.55,1);return{gain:l,filterFreq:E(a*s,Ba.filterMinHz,Ba.filterMaxHz)}})(r,c,p)),e.filter.frequency.value=p,e.filter.Q.value=Ba.filterQ,e.panner.pan.value=u,e.reverbSend.gain.value=h,e.noiseFilter.Q.value=E(Ba.noiseTransientQ||1.2,.5,8),e.envelope.gain.cancelScheduledValues(n),e.envelope.gain.setValueAtTime(c,n),e.envelope.gain.exponentialRampToValueAtTime(.001,n+l);const f=_a.createOscillator();if(f.type="sine",f.frequency.value=r,e.osc=f,f.connect(e.filter),(Ba.harmonicGain||0)>.001){const t=_a.createOscillator();t.type="sine",t.frequency.value=2*r;const a=_a.createGain();a.gain.cancelScheduledValues(n),a.gain.setValueAtTime(c*Ba.harmonicGain,n),a.gain.exponentialRampToValueAtTime(.001,n+l),e.harmonicOsc=t,t.connect(a),a.connect(e.filter),t.onended=()=>{try{a.disconnect()}catch(e){}},t.start(n),t.stop(n+s)}else e.harmonicOsc=null;if((Ba.sparkleGain||0)>.001){const t=_a.createOscillator();t.type="sine";const a=Ba.sparkleRatioMin||2.3,o=Ba.sparkleRatioMax||4.1,i=E(a+Math.random()*(o-a),1.2,10);t.frequency.value=r*I(i,.02);const d=_a.createGain(),p=Math.max(.012,l*E(Ba.sparkleDecayMul||.65,.25,.95));d.gain.cancelScheduledValues(n),d.gain.setValueAtTime(c*Ba.sparkleGain,n),d.gain.exponentialRampToValueAtTime(.001,n+p),e.sparkleOsc=t,t.connect(d),d.connect(e.filter),t.onended=()=>{try{d.disconnect()}catch(e){}},t.start(n),t.stop(n+s)}else e.sparkleOsc=null;if(Ba.noiseTransientEnabled&&i>.25){const t=(()=>{if(!io){const e=2*_a.sampleRate;io=_a.createBuffer(1,e,_a.sampleRate);const t=io.getChannelData(0);let a=0,o=0,n=0;for(let i=0;e>i;i++){const e=2*Math.random()-1;a=.99765*a+.099046*e,o=.963*o+.2965164*e,n=.57*n+1.0526913*e,t[i]=.25*(a+o+n+.1848*e)}}const e=_a.createBufferSource();return e.buffer=io,e.loopStart=1.5*Math.random(),e.loopEnd=e.loopStart+.1,e.loop=!1,e})();e.noiseSource=t;const a=Math.pow(i,1.4);e.noiseFilter.frequency.value=I(Ba.noiseTransientFilterMin+(Ba.noiseTransientFilterMax-Ba.noiseTransientFilterMin)*a,Ba.varianceNoise);const o=Ba.noiseTransientGain*Ba.velocityNoiseScale*a*c,r=I(Ba.noiseTransientDecay,Ba.varianceNoise);e.noiseEnvelope.gain.cancelScheduledValues(n),e.noiseEnvelope.gain.setValueAtTime(o,n),e.noiseEnvelope.gain.exponentialRampToValueAtTime(.001,n+r),t.connect(e.noiseFilter),t.start(n),t.stop(n+r+.01)}else e.noiseSource=null;f.start(n),f.stop(n+s),f.onended=()=>V(e)})(i,(e=>{const t=1-E((e-8)/47,0,1),a=E(Ba.pitchMinHz||145,40,6e3),o=E(Ba.pitchMaxHz||280,a+10,12e3),n=E(Ba.pitchCurve||1,.5,2.5);return(a+Math.pow(t,n)*(o-a))*I(1,1.5*(Ba.variancePitch||.06))})(e),Math.max(0,Math.min(1,t)),a,n)}function z({intensity:e=.82,radius:t=18,xPosition:a=.72}={}){R(t,e,a,null)}function V(e){if(e.osc){try{e.osc.stop(),e.osc.disconnect()}catch(t){}e.osc=null}if(e.harmonicOsc){try{e.harmonicOsc.stop(),e.harmonicOsc.disconnect()}catch(t){}e.harmonicOsc=null}if(e.sparkleOsc){try{e.sparkleOsc.stop(),e.sparkleOsc.disconnect()}catch(t){}e.sparkleOsc=null}if(e.noiseSource){try{e.noiseSource.stop(),e.noiseSource.disconnect()}catch(t){}e.noiseSource=null}e.inUse=!1}function E(e,t,a){return t>e?t:e>a?a:e}function B(){return!!Ja&&(Ua=!Ua,A(),Ua)}function $(){return{isUnlocked:Ja,isEnabled:Ua,activeSounds:to.filter(e=>e.inUse).length,poolSize:eo}}function W(){return{...Ba}}function _(e){for(const[t,a]of Object.entries(e))t in Ba&&(Ba[t]=a);ja&&Ha&&"reverbWetMix"in e&&(ja.gain.value=Ba.reverbWetMix,Ha.gain.value=1-Ba.reverbWetMix),Xa&&("highShelfFreq"in e||"highShelfGain"in e)&&(Xa.frequency.value=Ba.highShelfFreq,Xa.gain.value=Ba.highShelfGain),Ga&&"masterGain"in e&&(Ga.gain.value=Ba.masterGain)}function G(e){const t=$a[e];if(!t)return!1;Wa=e;const{label:a,description:o,...n}=t;return _(n),!0}function N(){return Wa}function H(){const e=d(),t=e.balls,a=e.canvas,o=e.ballSpacing||0,n=t.length;if(2>n)return[];const i=Math.max(1,2*e.R_MAX*(1+o)),r=Math.ceil(a.width/i)+1;lo.clear();for(let s=0;n>s;s++){const e=t[s],a=(e.y/i|0)*r+(e.x/i|0);let o=lo.get(a);o||(o=[],lo.set(a,o)),o.push(s)}const l=[];for(const[s,c]of lo){const e=s/r|0,a=s%r;for(let n=-1;1>=n;n++)for(let i=-1;1>=i;i++){const s=lo.get((e+n)*r+(a+i));if(s)for(let e=0;c.length>e;e++){const a=c[e];for(let e=0;s.length>e;e++){const n=s[e];if(a>=n)continue;const i=t[a],r=t[n],c=r.x-i.x,d=r.y-i.y,p=i.r+r.r+(i.r+r.r)/2*o,u=c*c+d*d;p*p>u&&l.push({i:a,j:n,overlap:p-Math.sqrt(Math.max(u,Fa.MIN_DISTANCE_EPSILON))})}}}}return l.sort((e,t)=>t.overlap-e.overlap),l}function j(e=10){const t=d(),a=t.balls,o=H(),n=t.REST,i=.5*t.DPR,r=t.ballSpacing||0;for(let l=0;e>l;l++)for(let e=0;o.length>e;e++){const{i:s,j:c}=o[e],d=a[s],p=a[c],u=p.x-d.x,h=p.y-d.y,f=d.r+p.r+(d.r+p.r)/2*r,m=u*u+h*h;if(0===m||m>f*f)continue;const g=Math.sqrt(m),b=u/g,M=h/g,y=f-g,v=1/Math.max(d.m,.001),x=1/Math.max(p.m,.001),w=d.isSleeping&&p.isSleeping,S=.8*Math.max(y-i,0)/(v+x),C=S*b,k=S*M;d.x-=C*v,d.y-=k*v,p.x+=C*x,p.y+=k*x;const P="pit"===t.currentMode||"pit-throws"===t.currentMode;if(P&&-.3>M?p.hasSupport=!0:P&&M>.3&&(d.hasSupport=!0),w)continue;const F=p.vx-d.vx,D=p.vy-d.vy,T=F*b+D*M,L=-15*(t.DPR||1)>T;if((!d.isSleeping||L)&&(!p.isSleeping||L)&&(d.isSleeping&&d.wake(),p.isSleeping&&p.wake(),0>T)){const e=-(1+(30>Math.abs(T)?0:n))*T/(v+x),a=e*b,o=e*M;d.vx-=a*v,d.vy-=o*v,p.vx+=a*x,p.vy+=o*x;const i=F-T*b,r=D-T*M,c=Math.hypot(i,r);if(c>.001){const e=0>i*-M+r*b?-1:1,t=Fa.SPIN_GAIN_TANGENT;d.omega-=e*t*c/Math.max(d.r,1),p.omega+=e*t*c/Math.max(p.r,1)}const u=Math.min(1,Math.abs(T)/(50*(d.r+p.r))),h=Math.min(t.getSquashMax(),.8*u);d.squashAmount=Math.max(d.squashAmount,.8*h),d.squashNormalAngle=Math.atan2(-M,-b),p.squashAmount=Math.max(p.squashAmount,.8*h),p.squashNormalAngle=Math.atan2(M,b),0===l&&R((d.r+p.r)/2,u,(d.x+p.x)/2/(t.canvas?.width||1),`${s}-${e}`)}}}function Z(e,t,a){e.startsWith("corner")||("top"===e?po.top.impact(t,a):"bottom"===e?po.bottom.impact(t,a):"left"===e?po.left.impact(t,a):"right"===e&&po.right.impact(t,a))}function Y(e,t,a=1){e.startsWith("corner")||("top"===e?po.top.addPressure(t,a):"bottom"===e?po.bottom.addPressure(t,a):"left"===e?po.left.addPressure(t,a):"right"===e&&po.right.addPressure(t,a))}function X(e,t,a){return t>e?t:e>a?a:e}function q(e,t,a){return e+(t-e)*a}function U(e,t){switch(t){case Ca.PIT:return e.sizeVariationPit??0;case Ca.PIT_THROWS:return e.sizeVariationPitThrows??0;case Ca.FLIES:return e.sizeVariationFlies??0;case Ca.WEIGHTLESS:return e.sizeVariationWeightless??0;case Ca.WATER:return e.sizeVariationWater??0;case Ca.VORTEX:return e.sizeVariationVortex??0;case Ca.PING_PONG:return e.sizeVariationPingPong??0;case Ca.MAGNETIC:return e.sizeVariationMagnetic??0;case Ca.BUBBLES:return e.sizeVariationBubbles??0;case Ca.KALEIDOSCOPE:case Ca.KALEIDOSCOPE_1:case Ca.KALEIDOSCOPE_2:case Ca.KALEIDOSCOPE_3:return e.sizeVariationKaleidoscope??0;case Ca.ORBIT_3D:return e.sizeVariationOrbit3d??0;case Ca.ORBIT_3D_2:return e.sizeVariationOrbit3d2??0;case Ca.CRITTERS:return e.sizeVariationCritters??0;case Ca.NEURAL:return e.sizeVariationNeural??0;case Ca.LATTICE:return e.sizeVariationLattice??0;case Ca.PARALLAX_LINEAR:return e.sizeVariationParallaxLinear??0;case Ca.PARALLAX_PERSPECTIVE:return e.sizeVariationParallaxPerspective??0;default:return 0}}function J(e,t){const a=X(+(e.sizeVariationCap??.12),0,.5),o=X(+(e.sizeVariationGlobalMul??1),0,2),n=X(+(U(e,t)??0),0,1);return X(a*o*n,0,.5)}function Q(e,t){const{minR:a,maxR:o,medR:n}=((e,t)=>{const a=Math.max(1,e.R_MED||.5*(e.R_MIN+e.R_MAX)||10),o=X(+(e.sizeVariationCap??.12),0,.5),n=X(+(e.sizeVariationGlobalMul??1),0,2),i=X(+(U(e,t)??0),0,1),r=X(o*n*i,0,.5);return{minR:Math.max(1,a*(1-r)),maxR:Math.max(1,a*(1+r)),medR:a}})(e,t);return 1e-6>o-a?n:q(a,o,Math.random())}function ee(e,t){const a=d(),o=a.waterDrag||.015;e.vx*=1-o,e.vy*=1-o,e.omega*=1-.5*o;const n=a.DPR||1;for(let r=0;fo.length>r;r++){const a=fo[r],o=e.x-a.x,i=e.y-a.y,l=Math.sqrt(o*o+i*i),s=40*n;if(l>a.radius-s&&a.radius+s>l){const n=a.strength*(1-Math.abs(l-a.radius)/s);if(l>.1){const a=i/l;e.vx+=o/l*n*t,e.vy+=a*n*t}}}const i=a.waterDriftStrength||25;e.vx+=Math.sin(.5*e.t+.01*e.x)*i*t,e.vy+=Math.cos(.7*e.t+.01*e.y)*i*t}function te(e){const t=d().waterRippleSpeed||300;for(let a=fo.length-1;a>=0;a--){const o=fo[a];o.radius+=t*e,o.age+=e,o.strength*=.96,(o.age>3||10>o.strength)&&fo.splice(a,1)}}function ae(e,t,a=1){const o=d();fo.push({x:e,y:t,radius:0,strength:(o.waterRippleStrength||15e3)*Math.min(a,5),age:0})}function oe(e,t,a){a||(a=D());const o=d(),n=Q(o,o.currentMode||Ca.PIT),i=new ho(e,t,n,a),r=.5*o.canvas.width>e?1:-1,l=Math.max(.6,Math.min(1.4,n/(.5*(o.R_MIN+o.R_MAX)))),s=180*l;return i.vx=r*(140*l+Math.random()*s),i.vy=120*-Math.random(),i.driftAx=r*(360+420*Math.random())*l,i.driftTime=.22+.28*Math.random(),o.balls.push(i),i}function ne(e,t){const a=d(),o=(-1e9===a.mouseX?.5*a.canvas.width:a.mouseX)-e.x,n=(-1e9===a.mouseY?.5*a.canvas.height:a.mouseY)-e.y,i=Math.sqrt(o*o+n*n+1),r=n/i;e.vx+=o/i*4e3*t,e.vy+=4e3*r*t;const l=120*a.DPR;let s=0,c=0,p=0;for(let d=0;a.balls.length>d;d++){const t=a.balls[d];if(t===e)continue;const o=e.x-t.x,n=e.y-t.y,i=o*o+n*n;if(l*l>i&&i>0){const e=Math.sqrt(i),t=1-e/l;s+=o/e*t,c+=n/e*t,p++}}if(p>0){const a=15e3;e.vx+=s/p*a*t,e.vy+=c/p*a*t}e.vx+=1e3*(Math.random()-.5)*t,e.vy+=1e3*(Math.random()-.5)*t}function ie(e,t){const a=d(),o=a.repelPower,n=a.repelRadius;if(!a.repellerEnabled||0>=o||0>=n)return;const i=n*a.DPR,r=e.x-a.mouseX,l=e.y-a.mouseY,s=r*r+l*l;if(s>i*i)return;const c=Math.max(Math.sqrt(s),1e-4),p=r/c,u=l/c,h=20*o*Math.pow(Math.max(0,1-c/i),a.repelSoft||3.4),f=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=p*h*t/f,e.vy+=u*h*t/f}function re(e,t,a){return Math.max(t,Math.min(a,e))}function le(e,t){return e+Math.random()*(t-e)}function se(e){e.spawnedTotal=1+(0|e.spawnedTotal)}function ce(e,t,a,{speedMul:o=1,spreadMul:n=1}={}){const i=e.canvas.width,r=e.canvas.height,l=e.DPR,s=(e.wallThickness||20)*l,c=Math.max(1,i-2*s),d=.35*-r,p=.05*-r,u=re(e.pitThrowInletInset??.06,0,.2),h=0===a?s+c*u:i-s-c*u,f=re(e.pitThrowSpawnSpread??.02,0,.12),m=re(f*n,0,.18),g=h+le(-c*m,c*m),b=le(d,p),M=re(e.pitThrowTargetYFrac??.36,.12,.7),y=re(e.pitThrowCrossBias??.12,0,.35),v=re(e.pitThrowAimJitter??.04,0,.2),x=re(v*n,0,.25),w=i*(.5+(0===a?y:-y)+le(-x,x)),S=r*M,C=re(e.pitThrowSpeed??650,50,4e3)*l,k=re(e.pitThrowSpeedJitter??.22,0,.8),P=re(e.pitThrowAngleJitter??.16,0,.8),F=oe(g,b,t),D=w-g,T=S-b,L=Math.max(1e-4,Math.sqrt(D*D+T*T));let I=D/L,A=T/L;const K=le(-Math.PI,Math.PI)*P,O=Math.cos(K),R=Math.sin(K),z=I*R+A*O;I=I*O-A*R,A=z;const V=C*o*(1+le(-k,k));return F.vx=I*V,F.vy=A*V,F.driftAx=0,F.driftTime=0,F}function de(e){const t=d();if(!t||"pit-throws"!==t.currentMode)return;const a=Math.max(0,p(t.maxBalls??300));if(0>=a)return;if(t.balls.length>=a)return;const o=t.p;if(!o)return;const n=re(t.pitThrowIntervalMs??70,10,2e3)/1e3,i=re(t.pitThrowBatchSize??12,1,100),r=re(t.pitThrowColorPauseMs??400,0,3e3)/1e3,l=re(t.pitThrowPairChance??.35,0,1),s=re(t.pitThrowPairStaggerMs??18,0,300)/1e3,c=re(t.pitThrowSpeedVar??.18,0,1),u=re(t.pitThrowSpreadVar??.25,0,1);o.cooldown-=e,0>o.cooldown&&(o.cooldown=0);let h=0;for(0>o.queueA||(o.queueA-=e),0>o.queueB||(o.queueB-=e);6>h&&a>t.balls.length;){let e=!1;if(o.queueA>=0&&0>=o.queueA){const a=1+le(-c,c),n=1+le(-u,u);ce(t,o.queueColorA,o.queueSideA,{speedMul:a,spreadMul:n}),o.queueA=-1,h++,e=!0}if(h>=6||t.balls.length>=a)break;if(o.queueB>=0&&0>=o.queueB){const a=1+le(-c,c),n=1+le(-u,u);ce(t,o.queueColorB,o.queueSideB,{speedMul:a,spreadMul:n}),o.queueB=-1,h++,e=!0}if(!e)break}if(0>=o.cooldown)for(o.batchPaused&&(o.batchPaused=!1,o.batchCount=0,o.side=1-o.side);6>h&&a>t.balls.length;){if(r>0&&o.batchCount>=i){o.cooldown=r,o.batchPaused=!0;break}const e=o.side,d=1+le(-c,c),p=1+le(-u,u);if(ce(t,se(o),e,{speedMul:d,spreadMul:p}),h++,o.batchCount++,l>Math.random()&&a>t.balls.length&&i>o.batchCount){const t=se(o);0>o.queueA&&(o.queueA=s,o.queueColorA=t,o.queueSideA=e,o.batchCount++)}o.cooldown=n;break}}function pe(e,t){const a=d();if(!a.mouseInCanvas)return;const o=a.weightlessRepelRadius??0,n=a.weightlessRepelPower??0;if(0>=o||0>=n)return;const i=o*(a.DPR||1),r=e.x-a.mouseX,l=e.y-a.mouseY,s=r*r+l*l;if(s>i*i)return;const c=Math.max(Math.sqrt(s),1e-4),p=r/c,u=l/c,h=20*n*Math.pow(Math.max(0,1-c/i),a.weightlessRepelSoft??2.2),f=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=p*h*t/f,e.vy+=u*h*t/f}function ue(){if(mo=document.getElementById("c"),!mo)return void console.error("Canvas not found");go=mo.getContext("2d",{alpha:!0,desynchronized:!0,willReadFrequently:!1}),go||(go=mo.getContext("2d"),console.warn("⚠️ Desynchronized mode unavailable, using standard context")),(()=>{const e=window.devicePixelRatio||1;(navigator.connection?.saveData||4>=navigator.hardwareConcurrency||/Android|iPhone|iPad|iPod/i.test(navigator.userAgent))&&e>1.5?(bo=1.5,console.log("⚡ Adaptive DPR: Reduced to 1.5x for performance")):bo=Math.min(e,2),t(bo)})(),go.imageSmoothingEnabled=!1;const e=()=>{vo&&cancelAnimationFrame(vo),vo=requestAnimationFrame(()=>{he(),vo=null})};if(window.addEventListener("resize",e),window.addEventListener("orientationchange",()=>{setTimeout(he,100),setTimeout(he,300)}),window.visualViewport&&(window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e)),"undefined"!=typeof ResizeObserver){const t=document.getElementById("bravia-balls");t&&new ResizeObserver(()=>{e()}).observe(t)}console.log(`✓ Renderer optimized (DPR: ${bo.toFixed(2)}, desync: ${go.getContextAttributes?.()?.desynchronized??"unknown"})`)}function he(){if(!mo)return;const e=d();try{const e=window.visualViewport,t=e&&"number"==typeof e.height?e.height:window.innerHeight,a=e&&"number"==typeof e.width?e.width:window.innerWidth,o=t>0?t:window.innerHeight,n=a>0?a:window.innerWidth,i=e&&"number"==typeof e.offsetTop?e.offsetTop:0,r=e&&"number"==typeof e.offsetLeft?e.offsetLeft:0,l=Number.isFinite(i)?i:0,s=Number.isFinite(r)?r:0;let c=l+o/2,d=s+n/2;d>0||(d=window.innerWidth/2),c>0||(c=window.innerHeight/2);const p=document.documentElement?.style;p?.setProperty("--abs-viewport-h",o+"px"),p?.setProperty("--abs-vv-offset-top",l+"px"),p?.setProperty("--abs-vv-offset-left",s+"px"),p?.setProperty("--abs-vv-h",o+"px"),p?.setProperty("--abs-vv-w",n+"px"),p?.setProperty("--abs-vv-center-x",d+"px"),p?.setProperty("--abs-vv-center-y",c+"px")}catch(h){}try{l(),s()}catch(h){}try{m()}catch(h){}const t=e.container||document.getElementById("bravia-balls"),a=t?t.clientWidth:window.innerWidth,o=t?t.clientHeight:window.innerHeight;if(0>=a||0>=o)return;const n=a,i=o,r=bo,c=Math.floor(n*r),p=Math.floor(i*r);if(0>=c||0>=p)return;if(c===Mo&&p===yo)return;if(Mo>0&&yo>0&&e.balls&&e.balls.length>0){const t=c/Mo,a=p/yo;if(t>.1&&10>t&&a>.1&&10>a){const o=e.balls;for(let e=0;o.length>e;e++){const n=o[e];if(!n)continue;n.x*=t,n.y*=a;const i=n.r||10;n.x=Math.max(i,Math.min(c-i,n.x)),n.y=Math.max(i,Math.min(p-i,n.y)),n.isSleeping&&(n.isSleeping=!1,n.sleepTimer=0)}}}Mo=c,yo=p;const u=mo.width!==c||mo.height!==p;if(u&&(mo.width=c,mo.height=p,go&&(go.imageSmoothingEnabled=!1)),mo.style.width=n+"px",mo.style.height=i+"px",u&&((e=>{const t=d();if(!t.canvasShadowEnabled)return void(e.style.filter="");const a=t.shadow2Enabled?` drop-shadow(0 0 ${t.shadow2Blur||4}px rgba(0,0,0,${t.shadow2Opacity||.1}))`:"";e.style.filter=`drop-shadow(${t.shadowOffsetX||1}px ${t.shadowOffsetY||1}px ${t.shadowBlur||0}px ${((e,t)=>{const a=e.replace("#",""),o=parseInt(a,16);return`rgba(${o>>16&255}, ${o>>8&255}, ${255&o}, ${t})`})(t.shadowColor||"#000000",t.shadowOpacity||.29)})${a}`})(mo),xo))try{xo()}catch(h){}try{const t="function"==typeof e.getCanvasCornerRadius?e.getCanvasCornerRadius():e.cornerRadius??e.wallRadius??0,a=Math.max(0,(+t||0)*(e.DPR||1));(mo.width!==wo||mo.height!==So||Math.abs(a-Co)>.001)&&(wo=mo.width,So=mo.height,Co=a,e.canvasClipPath=((e,t,a)=>{const o=Math.max(0,Math.min(a,.5*Math.min(e,t)));if("undefined"==typeof Path2D)return null;const n=new Path2D;return o>0?(n.moveTo(o,0),n.lineTo(e-o,0),n.arcTo(e,0,e,o,o),n.lineTo(e,t-o),n.arcTo(e,t,e-o,t,o),n.lineTo(o,t),n.arcTo(0,t,0,t-o,o),n.lineTo(0,o),n.arcTo(0,0,o,0,o),n.closePath(),n):(n.rect(0,0,e,t),n)})(mo.width,mo.height,a))}catch(h){}}function fe(){return mo}function me(){return go}function ge(e,t){const a=d();if(a.currentMode!==Ca.VORTEX)return;if(!a.mouseInCanvas)return;const o=a.vortexSwirlStrength||420,n=a.vortexRadialPull||180,i=a.vortexSpeedMultiplier??1,r=a.vortexRadius??0,l=a.vortexFalloffCurve??1,s=a.vortexRotationDirection??1,c=a.vortexCoreStrength??1,p=a.vortexAccelerationZone??0,u=a.vortexOutwardPush??0,h=e.x-a.mouseX,f=e.y-a.mouseY,m=Math.max(8,Math.sqrt(h*h+f*f));if(r>0&&m>r){if(u>0){const a=f/m,o=u*((m-r)/r);e.vx+=h/m*o*t,e.vy+=a*o*t}return}let g;g=Math.pow(r>0?1-Math.min(1,m/r):1/(1+m*(a.vortexFalloffRate??.0015)),l);const b=1+(c-1)*(1-Math.min(1,m/(r||400))),M=o*g*b*i,y=n*g*b*i;let v=1;if(p>0){const e=Math.abs(m-p),t=.3*p;t>e&&(v=1+.5*(1-e/t))}const x=h/m,w=f/m,S=x*s,C=M*v;e.vx+=-w*s*C*t,e.vy+=S*C*t;const k=y*v;e.vx-=x*k*t,e.vy-=w*k*t;const P=Math.max(0,Math.min(1,a.vortexDrag??.005));e.vx*=1-P,e.vy*=1-P}function be(e){const t=d();if(t.currentMode!==Ca.PING_PONG)return;if(!e.isPingPong)return;if(t.mouseInCanvas){const a=Math.max(0,t.pingPongCursorRadius||0)*t.DPR,o=e.x-t.mouseX,n=e.y-t.mouseY,i=Math.sqrt(o*o+n*n),r=a+e.r;if(r>i&&i>.1){const t=r-i,a=o/i,l=n/i;e.x+=a*t*1.1,e.y+=l*t*1.1;const s=e.vx*a+e.vy*l;0>s&&(e.vx-=2*s*a,e.vy-=2*s*l,e.omega+=.02*s)}}const a=t.pingPongSpeed||400;.9*a>Math.abs(e.vx)&&(e.vx=(0>e.vx?-1:1)*a),e.vy*=Math.max(0,Math.min(1,t.pingPongVerticalDamp??.995))}function Me(e,t){const a=d();if(a.currentMode!==Ca.MAGNETIC)return;if(!a.mouseInCanvas)return;const o=a.mouseX-e.x,n=a.mouseY-e.y,i=a.DPR||1,r=Math.max(30*i,Math.sqrt(o*o+n*n)),l=(a.magneticStrength||65e3)/(r*r)*1e3,s=n/r,c=e.charge||1;e.vx+=o/r*l*c*t,e.vy+=s*l*c*t;const p=(a.magneticMaxVelocity||2800)*i,u=Math.sqrt(e.vx*e.vx+e.vy*e.vy);u>p&&(e.vx=e.vx/u*p,e.vy=e.vy/u*p),e.vx*=.998,e.vy*=.998}function ye(){const e=d();if(e.currentMode===Ca.MAGNETIC)for(let t=0;e.balls.length>t;t++)e.balls[t].alpha=1}function ve(e,t,a,o=!1){const n=d(),i=n.DPR||1,r=Q(n,Ca.BUBBLES),l=new ho(e,t,o?r:.1,a);return l.isBubble=!0,l.baseRadius=r,l.targetRadius=r,l.wobblePhase=Math.random()*Math.PI*2,l.wobbleFreq=2+3*Math.random(),l.vx=20*(Math.random()-.5)*i,l.vy=(-50-50*Math.random())*i,l.spawning=!o,l.spawnProgress=o?1:0,l.dissipating=!1,l.dissipateProgress=0,l.alpha=1,n.balls.push(l),l}function xe(e){const t=d(),a=t.canvas;if(!a)return;const o=t.DPR||1,n=a.width,i=a.height;e.x=Math.random()*n,e.y=i+(60+30*Math.random())*o,e.vx=20*(Math.random()-.5)*o,e.vy=(-50-50*Math.random())*o,e.wobblePhase=Math.random()*Math.PI*2,e.wobbleFreq=2+3*Math.random(),e.color=D(),e.targetRadius=Q(t,Ca.BUBBLES),e.baseRadius=e.targetRadius,e.r=.1,e.rBase=.1,e.spawning=!0,e.spawnProgress=0,e.dissipating=!1,e.dissipateProgress=0,e.alpha=1}function we(e,t){const a=d();if(a.currentMode!==Ca.BUBBLES)return;if(!e.isBubble)return;const o=a.canvas;if(!o)return;if(e.spawning&&(e.spawnProgress+=3*t,e.r=e.targetRadius*(1-Math.pow(1-Math.min(1,e.spawnProgress),3)),e.rBase=e.r,1>e.spawnProgress||(e.spawning=!1,e.r=e.targetRadius,e.rBase=e.targetRadius)),e.dissipating){e.dissipateProgress+=3*t;const a=Math.pow(e.dissipateProgress,2);return e.r=e.targetRadius*Math.max(0,1-a),e.rBase=e.r,e.alpha=Math.max(0,1-.5*a),e.vy*=.92,e.vx*=.92,void(1>e.dissipateProgress||xe(e))}const n=.01*(a.bubblesWobble||40);if(e.vy-=(a.bubblesRiseSpeed||150)*a.DPR*t,e.wobblePhase+=e.wobbleFreq*t,e.vx+=Math.sin(e.wobblePhase)*n*100*t,e.vx*=.92,e.vy*=.96,a.mouseInCanvas){const o=e.x-a.mouseX,n=e.y-a.mouseY,i=Math.sqrt(o*o+n*n),r=Math.max(0,a.bubblesDeflectRadius||0)*a.DPR;if(r>i&&i>1){const a=3e3*Math.pow(1-i/r,3),l=o/i,s=n/i;if(e.vx+=l*a*t,e.vy+=s*a*t,.3*r>i){const a=500*(1-i/(.3*r));e.vx+=l*a*t,e.vy+=s*a*t}}}e.y>=2*e.targetRadius||e.dissipating||e.spawning||(e.dissipating=!0,e.dissipateProgress=0),(4*-e.r>e.x||e.x>o.width+4*e.r)&&xe(e)}function Se(){}function Ce(e,t,a){return Math.max(t,Math.min(a,e))}function ke(e){const t=e.canvas;return t?Ce(Math.min(t.width,t.height)/1e3,.35,3):1}function Pe(e,t,a,o){for(let n=0;e.length>n;n++){const i=e[n],r=t-i.x,l=a-i.y,s=o+i.r;if(s*s>r*r+l*l)return!0}return!1}function Fe(e,t,a,o=10){const n=2*o;return e.v+=o*o*(t-e.x)*a,e.v*=Math.max(0,1-n*a),e.x+=e.v*a,e.x}function De(e,t,a,o){const n=d(),i=Math.max(2,n.wallInset||3)*(n.DPR||1),r=i+e.r,l=t-i-e.r,s=i+e.r,c=a-i-e.r,p=.92,u=Math.max(0,1-.15*o);r>e.x?(e.x=r,e.vx=Math.abs(e.vx)*p*u):e.x>l&&(e.x=l,e.vx=-Math.abs(e.vx)*p*u),s>e.y?(e.y=s,e.vy=Math.abs(e.vy)*p*u):e.y>c&&(e.y=c,e.vy=-Math.abs(e.vy)*p*u)}function Te(e){return e.currentMode===Ca.KALEIDOSCOPE_1?{count:e.kaleidoscope1BallCount??18,wedges:e.kaleidoscope1Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope1Speed??.8,complexity:.55,spawnAreaMul:e.kaleidoscope1SpawnAreaMul??1,sizeVariance:e.kaleidoscope1SizeVariance??.3}:e.currentMode===Ca.KALEIDOSCOPE_2?{count:e.kaleidoscope2BallCount??36,wedges:e.kaleidoscope2Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope2Speed??1.15,complexity:.95,spawnAreaMul:e.kaleidoscope2SpawnAreaMul??1,sizeVariance:e.kaleidoscope2SizeVariance??.3}:e.currentMode===Ca.KALEIDOSCOPE_3?{count:e.kaleidoscope3BallCount??54,wedges:e.kaleidoscope3Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope3Speed??1.55,complexity:1.35,spawnAreaMul:e.kaleidoscope3SpawnAreaMul??1,sizeVariance:e.kaleidoscope3SizeVariance??.3}:{count:e.kaleidoscopeBallCount??23,wedges:e.kaleidoscopeWedges??e.kaleidoscopeSegments??12,speed:e.kaleidoscopeSpeed??1,complexity:.75,spawnAreaMul:e.kaleidoscopeSpawnAreaMul??1,sizeVariance:e.kaleidoscopeSizeVariance??.3}}function Le(e,t){function a(e){const a=((e,t)=>{const a=e?.canvas,o=a?.height||0;if(!o)return Q(e,t);const n=X(t===Ca.KALEIDOSCOPE_1?+(e.kaleidoscope1DotSizeVh??e.kaleidoscopeDotSizeVh??.95):t===Ca.KALEIDOSCOPE_2?+(e.kaleidoscope2DotSizeVh??e.kaleidoscopeDotSizeVh??.95):t===Ca.KALEIDOSCOPE_3?+(e.kaleidoscope3DotSizeVh??e.kaleidoscopeDotSizeVh??.95):+(e.kaleidoscopeDotSizeVh??.95),.1,6),i=X(t===Ca.KALEIDOSCOPE_1?+(e.kaleidoscope1DotAreaMul??e.kaleidoscopeDotAreaMul??.7):t===Ca.KALEIDOSCOPE_2?+(e.kaleidoscope2DotAreaMul??e.kaleidoscopeDotAreaMul??.7):t===Ca.KALEIDOSCOPE_3?+(e.kaleidoscope3DotAreaMul??e.kaleidoscopeDotAreaMul??.7):+(e.kaleidoscopeDotAreaMul??.7),.1,2),r=Math.max(1,.01*n*o*Math.sqrt(i)),l=X(.5*(t===Ca.KALEIDOSCOPE_1?+(e.kaleidoscope1SizeVariance??e.kaleidoscopeSizeVariance??.3):t===Ca.KALEIDOSCOPE_2?+(e.kaleidoscope2SizeVariance??e.kaleidoscopeSizeVariance??.3):t===Ca.KALEIDOSCOPE_3?+(e.kaleidoscope3SizeVariance??e.kaleidoscopeSizeVariance??.3):+(e.kaleidoscopeSizeVariance??.3)),0,.5),s=Math.max(1,r*(1-l)),c=Math.max(1,r*(1+l));return 1e-6>c-s?r:q(s,c,Math.random())})(o,t),n=1.2*b,i=l-n,r=l+n,d=s-n,p=s+n;for(let t=0;90>t;t++){const t=Math.random()*ko,n=g+Math.random()*(b-g),u=Ce(l+Math.cos(t)*n,i,r),h=Ce(s+Math.sin(t)*n,d,p),f=a*(1+(o.ballSpacing||0));if(!Pe(M,u,h,f)){M.push({x:u,y:h,r:f});const n=new ho(u,h,a,e);n.u=Math.random()*ko;const i=u-l,r=h-s;n.h=Math.sqrt(i*i+r*r);const d=(12+12*Math.random())*c;return n.vx=-Math.sin(t)*d,n.vy=Math.cos(t)*d,n.driftAx=0,n.driftTime=0,void o.balls.push(n)}}const u=Math.random()*ko,h=g+Math.random()*(b-g),f=l+Math.cos(u)*h,m=s+Math.sin(u)*h,y=new ho(f,m,a,e);y.u=Math.random()*ko;const v=f-l,x=m-s;y.h=Math.sqrt(v*v+x*x);const w=(12+12*Math.random())*c;y.vx=-Math.sin(u)*w,y.vy=Math.cos(u)*w,y.driftAx=0,y.driftTime=0,o.balls.push(y)}const o=d();f();const n=o.canvas;if(!n)return;const i=n.width,r=n.height,l=.5*i,s=.5*r,c=ke(o),p=o.maxBalls||300,u=Ce(Math.max(0,0|e),0,p);if(0>=u)return;const h=Ce(Te(o).spawnAreaMul??1,.2,2),m=Math.min(i,r),g=.05*m,b=2.8*m*h,M=[],y=Math.min(8,u);for(let d=0;y>d;d++)a(D());for(let d=y;u>d;d++)a(D())}function Ie(e){return e===Ca.KALEIDOSCOPE||e===Ca.KALEIDOSCOPE_1||e===Ca.KALEIDOSCOPE_2||e===Ca.KALEIDOSCOPE_3}function Ae(e){return Te(e).complexity}function Ke(e,t){const a=d();if(!Ie(a.currentMode))return;const o=a.canvas;if(!o)return;const n=.5*o.width,i=.5*o.height,r=ke(a),l=Ce(Te(a).speed??1,.2,2),s=performance.now(),c=120>s-(a.lastPointerMoveMs||0);void 0===a.M&&(a.M=0);const p=c?1:0;a.M+=(p-a.M)*(1-Math.exp(-t/Math.max(1e-4,p>a.M?.45:.65)));const u=a.M,h=.008*Ae(a);if(.01>u){const a=(e.u??0)+.02*e.age+3e-4*s,o=Math.cos(a)*h*8,n=Math.sin(a)*h*8;return e.vx+=o*t,e.vy+=n*t,e.vx*=.96,void(e.vy*=.96)}const f=e.x-n,m=e.y-i,g=Math.max(Po,Math.sqrt(f*f+m*m)),b=f/g,M=m/g,y=b,v=30*r*l*u,x=-2.5*(g-(void 0!==e.h?e.h:g))*l*u;e.vx+=(-M*v+b*x)*t,e.vy+=(y*v+M*x)*t,e.vx*=.992,e.vy*=.992}function Oe(e,t){const a=d(),o=(-1e9===a.mouseX?.5*a.canvas.width:a.mouseX)-e.x,n=(-1e9===a.mouseY?.5*a.canvas.height:a.mouseY)-e.y,i=Math.sqrt(o*o+n*n+1),r=o/i,l=n/i,s=-n/i,c=o/i,p=a.DPR||1,u=40*p;if(u>i){const a=100*(u-i);e.vx-=r*a*t,e.vy-=l*a*t}const h=a.orbit3dGravity??5e3,f=.015*h;e.vx+=s*f*t,e.vy+=c*f*t;const m=.003*h/(1+i/(100*p));e.vx+=r*m*t,e.vy+=l*m*t;const g=60*a.DPR;let b=0,M=0,y=0;for(let d=0;a.balls.length>d;d++){const t=a.balls[d];if(t===e)continue;const o=e.x-t.x,n=e.y-t.y,i=o*o+n*n;if(g*g>i&&i>0){const e=Math.sqrt(i),t=1-e/g;b+=o/e*t,M+=n/e*t,y++}}if(y>0){const a=8e3;e.vx+=b/y*a*t,e.vy+=M/y*a*t}const v=2*(a.orbit3dVelocityMult??150)*p,x=Math.sqrt(e.vx*e.vx+e.vy*e.vy);x>v&&(e.vx=e.vx/x*v,e.vy=e.vy/x*v);const w=1-(a.orbit3dDamping??.02);e.vx*=w,e.vy*=w;const S=a.orbit3dDepthScale??.8;e.z=e.orbitDepth+.2*Math.sin(2*Math.atan2(n,o)),e.z=Math.max(0,Math.min(1,e.z)),e.r=Math.max(2,e.rBase*(.5+e.z*S))}function Re(e,t){const a=d(),o=(-1e9===a.mouseX?.5*a.canvas.width:a.mouseX)-e.x,n=(-1e9===a.mouseY?.5*a.canvas.height:a.mouseY)-e.y,i=Math.sqrt(o*o+n*n+1),r=o/i,l=n/i,s=-n/i,c=o/i,p=a.DPR||1,u=80*p;if(u>i){const a=100*(u-i);e.vx-=r*a*t,e.vy-=l*a*t}const h=a.orbit3d2Gravity??8e4,f=.015*h;e.vx+=s*f*t,e.vy+=c*f*t;const m=.003*h/(1+i/(100*p));e.vx+=r*m*t,e.vy+=l*m*t;const g=100*a.DPR;let b=0,M=0,y=0;for(let d=0;a.balls.length>d;d++){const t=a.balls[d];if(t===e)continue;const o=e.x-t.x,n=e.y-t.y,i=o*o+n*n;if(g*g>i&&i>0){const e=Math.sqrt(i),t=1-e/g;b+=o/e*t,M+=n/e*t,y++}}if(y>0){const a=8e3;e.vx+=b/y*a*t,e.vy+=M/y*a*t}const v=300*p,x=Math.sqrt(e.vx*e.vx+e.vy*e.vy);x>v&&(e.vx=e.vx/x*v,e.vy=e.vy/x*v);const w=1-(a.orbit3d2Damping??.02);e.vx*=w,e.vy*=w;const S=a.orbit3d2DepthScale??.6;e.z=e.orbitDepth+.2*Math.sin(2*Math.atan2(n,o)),e.z=Math.max(0,Math.min(1,e.z)),e.r=Math.max(2,e.rBase*(.5+e.z*S))}function ze(e,t,a){return t>e?t:e>a?a:e}function Ve(e){return e>Math.PI?e-=2*Math.PI:-Math.PI>e&&(e+=2*Math.PI),e}function Ee(e,t){const a=d(),o=a.canvas;if(!o)return;const n=a.DPR||1,i=Math.max(0,a.critterSpeed||0),r=Math.max(50,a.critterMaxSpeed||0)*n,l=Math.max(0,a.critterStepHz||0),s=a.critterStepSharpness??2.4,c=Math.max(0,a.critterTurnNoise||0),p=Math.max(.1,a.critterTurnDamp||0),u=Math.max(0,a.critterTurnSeek||0),h=Math.max(0,(a.critterAvoidRadius||0)*(a.DPR||1)),f=Math.max(0,a.critterAvoidForce||0),m=Math.max(0,a.critterEdgeAvoid||0),g=Math.max(0,a.critterMousePull||0),b=Math.max(0,a.critterMouseRadiusVw||0);let M=e.S||0,y=e.C||0,v=e.k||0,x=e.P??v,w=e.F||0;const S=e.D||0;w>0?w=Math.max(0,w-t):.25*t>Math.random()&&(w=.03+.09*Math.random());let C=0,k=0;if(m>0){const t=o.width,n=o.height,i=Math.max(24*(a.DPR||1),.08*Math.min(t,n)),r=e.x,l=e.y;i>r?C+=1-r/i:r>t-i&&(C-=1-(t-r)/i),i>l?k+=1-l/i:l>n-i&&(k-=1-(n-l)/i);const s=1.35*m;C*=s,k*=s}let P=0;if(g>0&&-1e9!==a.mouseX){const t=(window.innerWidth||o.width)/100,n=Math.max(1,b*t)*(a.DPR||1),i=e.x-a.mouseX,r=e.y-a.mouseY,l=i*i+r*r;if(n*n>l){const e=Math.sqrt(l)+1e-6,t=1-e/n;P=t;const a=g*(.85+.65*t);C+=i/e*a,k+=r/e*a;const o=.25*t*a;C+=-r/e*o,k+=i/e*o,w=0}}if(h>0&&f>0){const o=a.balls,n=h*h;let i=0,r=0,l=0;for(let t=0;o.length>t;t++){const a=o[t];if(a===e)continue;const s=e.x-a.x,c=e.y-a.y,d=s*s+c*c;if(d>0&&n>d){const e=Math.sqrt(d),t=1-e/h,a=t*t,o=1/(e+1e-6);i+=s*o*a,r+=c*o*a,l++}}if(l>0){const a=1/l;C+=i*a*1.15,k+=r*a*1.15,e.vx+=i*a*.65*f*t,e.vy+=r*a*.65*f*t}}y+=(c*(1+1.35*P*g)*(2*Math.random()-1)+.35*S*c)*t,C*C+k*k>1e-6&&(y+=Ve(Math.atan2(k,C)-M)*u*t),y*=Math.exp(-p*t),M=Ve(M+y*t),l>0&&(x=v,v+=l*t,v-=0|v);const F=w>0?0:((e,t)=>{const a=(o=ze(o=.5>e?2*e:2-2*e,0,1))*o*(3-2*o);var o;const n=ze(t,.5,6);return Math.pow(a,n)})(v,s),D=1+.95*P*g;if(0>=w&&v>.82){const t=(v-.82)/.18*.1*(.65+.35*D);t>e.squashAmount&&(e.squashAmount=t,e.squashNormalAngle=-Math.PI/2)}if(0>=w&&l>0&&x>v){const t=Math.max(.25,e.m/(a.MASS_BASELINE_KG||129)),o=i*(.55+.55*F)*D*(.85+.3*Math.random()),n=Math.cos(M),r=Math.sin(M),l=-r,s=n,c=.18*(2*Math.random()-1)*(.35+.65*P)*o;e.vx+=(n*o+l*c)/t,e.vy+=(r*o+s*c)/t,e.squashAmount=Math.max(e.squashAmount,.2+.15*P),e.squashNormalAngle=Math.PI/2}const T=i*(.08+.25*F)*D;e.vx+=Math.cos(M)*T*t,e.vy+=Math.sin(M)*T*t;const L=e.vx,I=e.vy,A=L*L+I*I;if(A>r*r){const t=r/(Math.sqrt(A)+1e-6);e.vx=L*t,e.vy=I*t}e.S=M,e.C=y,e.k=v,e.P=x,e.F=w,e.theta=M}function Be(e,t){const a=d(),o=Math.max(.25,e.m/a.MASS_BASELINE_KG),n=Math.max(0,a.neuralWanderStrength??420),i=(e.T??0)+1.35*t;e.T=i;const r=Math.sin(1.7*i+.3)*n,l=Math.cos(1.1*i+1.2)*n;e.vx+=r*t/o,e.vy+=l*t/o,Do+=t;const s=a.balls,c=s.length;if(c>1){const n=Do>.18;if(n&&(Do=0),n||void 0===a.L){let e=0,t=0;for(let a=0;c>a;a++)e+=s[a].x,t+=s[a].y;a.L=e/c,a.I=t/c}const i=a.L,r=a.I,l=Math.max(0,Math.min(1,a.neuralCohesion??.18)),d=r-e.y;e.vx+=(i-e.x)*l*t/o,e.vy+=d*l*t/o}const p=Math.pow(Math.max(0,Math.min(1,a.neuralDamping??.985)),60*t);e.vx*=p,e.vy*=p}function $e(){}function We(e,t){const a=d(),o=a.canvas;if(!o)return;const n=a.mouseX;if(!1!==a.repellerEnabled&&-1e9!==n&&a.mouseInCanvas){const o=(a.latticeDisruptRadius??600)*a.DPR,i=a.latticeDisruptPower??25,r=e.x-n,l=e.y-a.mouseY,s=r*r+l*l;if(o*o>s){const n=Math.max(Math.sqrt(s),1e-4),c=r/n,d=l/n,p=80*i*Math.pow(Math.max(0,1-n/o),1.8),u=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=c*p*t/u,e.vy+=d*p*t/u}}void 0!==e.latticeHomeX&&void 0!==e.latticeHomeY||(e.latticeHomeX=e.x,e.latticeHomeY=e.y);const i=.001*performance.now(),r=a.latticeMeshWaveStrength??12,l=a.latticeMeshWaveSpeed??.8,s=Math.sin(i*l+.004*e.latticeHomeX)*r,c=Math.cos(i*l*.7+.004*e.latticeHomeY)*r,p=.015*Math.sin(i*l*.5),u=e.latticeHomeX+s+(e.latticeHomeX-.5*o.width)*p-e.x,h=e.latticeHomeY+c+(e.latticeHomeY-.5*o.height)*p-e.y,f=Math.max(0,a.latticeStiffness??2.2),m=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=u*f*t/m,e.vy+=h*f*t/m;const g=Math.pow(Math.max(0,Math.min(1,a.latticeDamping??.92)),60*t);e.vx*=g,e.vy*=g}function _e(e){if(!e.A)return;const t=d(),a=t.canvas;if(!a)return;const o=.5*a.width,n=.5*a.height;let i=0,r=0;t.mouseInCanvas&&(i=Math.max(-1,Math.min(1,(t.mouseX-o)/(.5*a.width))),r=Math.max(-1,Math.min(1,(t.mouseY-n)/(.5*a.height))));const l=Math.max(100,t.parallaxLinearFocalLength??400),s=Math.max(0,t.parallaxLinearParallaxStrength??120),{x:c,y:p,z:u}=e.A,h=l/(l+u),f=o+(c+i*s)*h,m=n+(p+r*s)*h;e.r=.768*(t.R_MED||20)*(t.DPR||1)*Math.max(.1,Math.min(6,t.parallaxLinearDotSizeMul??1.8))*(Number.isFinite(e.K)?e.K:1)*h,e.x=f,e.y=m,e.vx=0,e.vy=0}function Ge(e){if(!e.A)return;const t=d(),a=t.canvas;if(!a)return;const o=.5*a.width,n=.5*a.height;let i=0,r=0;t.mouseInCanvas&&(i=Math.max(-1,Math.min(1,(t.mouseX-o)/(.5*a.width))),r=Math.max(-1,Math.min(1,(t.mouseY-n)/(.5*a.height))));const l=Math.max(100,t.parallaxPerspectiveFocalLength??400),s=Math.max(0,t.parallaxPerspectiveParallaxStrength??150),{x:c,y:p,z:u}=e.A,h=l/(l+u),f=o+(c+i*s)*h,m=n+(p+r*s)*h;e.r=.6*(t.R_MED||20)*(t.DPR||1)*Math.max(.1,Math.min(6,t.parallaxPerspectiveDotSizeMul??1.8))*(Number.isFinite(e.K)?e.K:1)*h,e.x=f,e.y=m,e.vx=0,e.vy=0}function Ne(e){const t=d(),a=t.currentMode;if(t.currentMode===Ca.CRITTERS&&e!==Ca.CRITTERS&&(void 0!==t.O&&(t.REST=t.O,delete t.O),void 0!==t.R&&(t.FRICTION=t.R,delete t.R),void 0!==t.V&&(t.ballSpacing=t.V,delete t.V)),h(e),e!==a)try{P?.()}catch(n){}if(console.log("Switching to mode: "+e),(e=>{const t=document.getElementById("announcer");t&&(t.textContent="",setTimeout(()=>{t.textContent=e},10))})(`Switched to ${{pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero Gravity",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope","kaleidoscope-1":"Kaleidoscope I","kaleidoscope-2":"Kaleidoscope II","kaleidoscope-3":"Kaleidoscope III","orbit-3d":"Orbit 3D","orbit-3d-2":"Orbit 3D (Tight Swarm)",critters:"Critters",neural:"Neural Network",lattice:"Crystal Lattice","parallax-linear":"Parallax (Linear)","parallax-perspective":"Parallax (Perspective)"}[e]||e} mode`),t.container){const a=t.container.classList.contains("dark-mode");t.container.className="",e!==Ca.PIT&&e!==Ca.PIT_THROWS||t.container.classList.add("mode-pit"),(a||t.isDarkMode)&&t.container.classList.add("dark-mode")}he(),e===Ca.PIT?(t.gravityMultiplier=t.gravityMultiplierPit,t.G=t.GE*t.gravityMultiplier,t.repellerEnabled=!0,(()=>{const e=d();f(),((e,t)=>{const a=e.DPR,o=-.65*e.canvas.height,n=(e.wallThickness||20)*a,i=n,r=e.canvas.width-n,l=r-i,s=Math.max(1,.22*l),c=i+l*(2/3),d=Math.max(i,c-.5*s),p=Math.min(r,c+.5*s),u=Math.max(0,0|t),h=100*a,f=50*a;for(let m=0;u>m;m++){const e=oe(d+Math.random()*(p-d),o+Math.random()*(0-o));e.vx=(Math.random()-.5)*h,e.vy=Math.random()*f+f,e.driftAx=0,e.driftTime=0}})(e,p(e.maxBalls??300))})()):e===Ca.PIT_THROWS?(t.gravityMultiplier=t.gravityMultiplierPit,t.G=t.GE*t.gravityMultiplier,t.repellerEnabled=!0,(()=>{const e=d();f(),p(e.maxBalls??300)>0&&(e.p={spawnedTotal:0,side:0,cooldown:0,batchCount:0,batchPaused:!1,queueA:-1,queueB:-1,queueColorA:void 0,queueColorB:void 0,queueSideA:0,queueSideB:1},ce(e,se(e.p),e.p.side),e.p.side=1-e.p.side)})()):e===Ca.FLIES?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=p(e.fliesBallCount??60);if(0>=t)return;const a=.5*e.canvas.width,o=.5*e.canvas.height,n=150*e.DPR,i=300*e.DPR;for(let r=0;8>r;r++){const e=Math.random()*Math.PI*2,t=Math.random()*n,r=oe(a+Math.cos(e)*t,o+Math.sin(e)*t,D()),l=.5+.5*Math.random(),s=Math.random()*Math.PI*2,c=i*l;r.vx=Math.cos(s)*c,r.vy=Math.sin(s)*c,r.driftAx=0,r.driftTime=0}for(let r=8;t>r;r++){const e=Math.random()*Math.PI*2,t=Math.random()*n,r=oe(a+Math.cos(e)*t,o+Math.sin(e)*t),l=.5+.5*Math.random(),s=Math.random()*Math.PI*2,c=i*l;r.vx=Math.cos(s)*c,r.vy=Math.sin(s)*c,r.driftAx=0,r.driftTime=0}})()):e===Ca.WEIGHTLESS?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=p(e.weightlessCount);if(0>=t)return;const a=e.canvas.width,o=e.canvas.height,n=e.DPR||1,i=40*n,r=e.weightlessInitialSpeed*n;for(let l=0;t>l;l++){const e=oe(i+Math.random()*(a-2*i),i+Math.random()*(o-2*i)),t=Math.random()*Math.PI*2,n=r*(.7+.3*Math.random());e.vx=Math.cos(t)*n,e.vy=Math.sin(t)*n,e.driftAx=0,e.driftTime=0}})()):e===Ca.WATER?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f(),fo.length=0;const t=e.canvas;if(!t)return;const a=t.width,o=t.height,n=p(e.waterBallCount||100);if(0>=n)return;const i=(e.waterInitialVelocity||120)*(e.DPR||1);for(let r=0;8>r&&n>r;r++){const t=Math.random()*a,n=Math.random()*o,r=Q(e,Ca.WATER),l=D(),s=new ho(t,n,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}for(let r=8;n>r;r++){const t=Math.random()*a,n=Math.random()*o,r=Q(e,Ca.WATER),l=D(),s=new ho(t,n,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}})()):e===Ca.VORTEX?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=e.canvas;if(!t)return;const a=t.width,o=t.height,n=p(Math.min(e.vortexBallCount||180,e.maxBalls||500));if(0>=n)return;const i=80*(e.vortexSpeedMultiplier??1)*(e.DPR||1);for(let r=0;8>r&&n>r;r++){const t=Math.random()*a,n=Math.random()*o,r=Q(e,Ca.VORTEX),l=D(),s=new ho(t,n,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}for(let r=8;n>r;r++){const t=Math.random()*a,n=Math.random()*o,r=Q(e,Ca.VORTEX),l=D(),s=new ho(t,n,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}})()):e===Ca.PING_PONG?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=e.canvas;if(!t)return;const a=t.width,o=t.height,n=p(Math.min(e.pingPongBallCount||80,e.maxBalls||300));if(0>=n)return;const i=e.pingPongSpeed||400;for(let r=0;8>r&&n>r;r++){const t=Math.random()*a,n=.15*o+Math.random()*o*.7,r=Q(e,Ca.PING_PONG),l=D(),s=new ho(t,n,r,l);s.vx=(Math.random()>.5?1:-1)*(.8*i+Math.random()*i*.4),s.vy=0,s.isPingPong=!0,e.balls.push(s)}for(let r=8;n>r;r++){const t=Math.random()*a,n=.15*o+Math.random()*o*.7,r=Q(e,Ca.PING_PONG),l=D(),s=new ho(t,n,r,l);s.vx=(Math.random()>.5?1:-1)*(.8*i+Math.random()*i*.4),s.vy=0,s.isPingPong=!0,e.balls.push(s)}})()):e===Ca.MAGNETIC?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=e.canvas;if(!t)return;const a=t.width,o=t.height,n=p(Math.min(e.magneticBallCount||180,e.maxBalls||300));if(0>=n)return;const i=100*(e.DPR||1);for(let r=0;8>r&&n>r;r++){const t=Math.random()*a,n=Math.random()*o,r=Q(e,Ca.MAGNETIC),l=D(),s=new ho(t,n,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,s.charge=Math.random()>.5?1:-1,s.baseAlpha=1,e.balls.push(s)}for(let r=8;n>r;r++){const t=Math.random()*a,n=Math.random()*o,r=Q(e,Ca.MAGNETIC),l=D(),s=new ho(t,n,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,s.charge=Math.random()>.5?1:-1,s.baseAlpha=1,e.balls.push(s)}})()):e===Ca.BUBBLES?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();e.balls.length=0;const t=e.canvas;if(!t)return;const a=t.width,o=t.height,n=p(e.bubblesMaxCount||200);if(n>0){for(let e=0;8>e&&n>e;e++)ve(Math.random()*a,Math.random()*o,D(),!0);for(let e=8;n>e;e++)ve(Math.random()*a,Math.random()*o,D(),!0)}})()):e===Ca.KALEIDOSCOPE?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Le(p(d().kaleidoscopeBallCount??23),Ca.KALEIDOSCOPE)):e===Ca.KALEIDOSCOPE_1?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Le(p(d().kaleidoscope1BallCount??18),Ca.KALEIDOSCOPE_1)):e===Ca.KALEIDOSCOPE_2?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Le(p(d().kaleidoscope2BallCount??36),Ca.KALEIDOSCOPE_2)):e===Ca.KALEIDOSCOPE_3?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Le(p(d().kaleidoscope3BallCount??54),Ca.KALEIDOSCOPE_3)):e===Ca.ORBIT_3D?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=p(Math.max(0,0|(e.orbit3dMoonCount??80)));if(0>=t)return;const a=e.canvas.width,o=e.canvas.height;for(let n=0;t>n;n++){const t=Math.random()*Math.PI*2,n=.15*Math.min(a,o)+Math.random()*Math.min(a,o)*.1,i=oe(.5*a+Math.cos(t)*n,.5*o+Math.sin(t)*n,D());if(!i)continue;const r=e.DPR||1,l=(e.orbit3dVelocityMult??150)*(.9+.2*Math.random())*r;i.vx=-Math.sin(t)*l,i.vy=Math.cos(t)*l,i.orbitDepth=Math.random()}})()):e===Ca.ORBIT_3D_2?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=p(Math.max(0,0|(e.orbit3d2MoonCount??100)));if(0>=t)return;const a=e.canvas.width,o=e.canvas.height;for(let n=0;t>n;n++){const t=Math.random()*Math.PI*2,n=.35*Math.min(a,o)+Math.random()*Math.min(a,o)*.15,i=oe(.5*a+Math.cos(t)*n,.5*o+Math.sin(t)*n,D());if(!i)continue;const r=150*(e.orbit3d2VelocityMult??1.1)*(e.DPR||1);i.vx=-Math.sin(t)*r,i.vy=Math.cos(t)*r,i.orbitDepth=Math.random()}})()):e===Ca.CRITTERS?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,void 0===t.O&&(t.O=t.REST),void 0===t.R&&(t.R=t.FRICTION),t.REST=t.critterRestitution??t.REST,t.FRICTION=t.critterFriction??t.FRICTION,void 0===t.V&&(t.V=t.ballSpacing),t.ballSpacing=Math.min(t.ballSpacing||0,1),(()=>{const e=d();f();const t=e.canvas.width,a=e.canvas.height,o=p(Math.max(10,Math.min(260,0|e.critterCount)));if(o>0){for(let n=0;8>n&&o>n;n++){const o=oe(Math.random()*t|0,Math.random()*a|0,D()),n=Q(e,Ca.CRITTERS);o.r=n,o.rBase=n,o.m=Math.max(1,n*n*.12),o.vx=0,o.vy=0,o.S=Math.random()*Math.PI*2,o.C=0,o.k=Math.random(),o.P=o.k,o.D=2*Math.random()-1,o.F=0}for(let n=8;o>n;n++){const o=oe(Math.random()*t|0,Math.random()*a|0,D()),n=Q(e,Ca.CRITTERS);o.r=n,o.rBase=n,o.m=Math.max(1,n*n*.12),o.vx=0,o.vy=0,o.S=Math.random()*Math.PI*2,o.C=0,o.k=Math.random(),o.P=o.k,o.D=2*Math.random()-1,o.F=0}}})()):e===Ca.NEURAL?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!0,(()=>{const e=d(),t=e.canvas;if(!t)return;f();const a=p(Math.max(8,Math.min(e.neuralBallCount??80,260)));if(0>=a)return;const o=t.width,n=t.height,i=40*(e.DPR||1),r=Math.min(8,a);for(let l=0;r>l;l++){const t=oe(i+Math.random()*(o-2*i),i+Math.random()*(n-2*i),D()),a=Q(e,Ca.NEURAL);t.r=a,t.rBase=a,t.m=Math.max(1,a*a*.12),t.vx=0,t.vy=0,t.driftAx=0,t.driftTime=0,t.T=Math.random()*Math.PI*2}for(let l=r;a>l;l++){const t=oe(i+Math.random()*(o-2*i),i+Math.random()*(n-2*i),D()),a=Q(e,Ca.NEURAL);t.r=a,t.rBase=a,t.m=Math.max(1,a*a*.12),t.vx=0,t.vy=0,t.driftAx=0,t.driftTime=0,t.T=Math.random()*Math.PI*2}})()):e===Ca.LATTICE?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!0,(()=>{const e=d();f();const t=e.canvas,a=t.width,o=t.height,n=Math.max(8,((e,t)=>.01*t*Math.max(1,Math.min(e.width,e.height)))(t,e.latticeSpacingVw??8.5)),i=.8660254037844386*n,r=Math.ceil(a/n)+2,l=Math.ceil(o/i)+2,s=e.isMobile?Math.max(0,Math.min(1,+(e.mobileObjectReductionFactor??.7))):1;if(e.isMobile&&0>=s)return;const c=Math.sqrt(s),p=Math.max(0,Math.round(r*c)),u=Math.max(0,Math.round(l*c));if(0>=p||0>=u)return;const h=e.latticeAlignment??"center",m=(p-1)*n,g=(u-1)*i;let b,M;"center"===h?(b=.5*(a-m),M=.5*(o-g)):"top-left"===h?(b=.5*-n,M=.5*-i):"top-center"===h?(b=.5*(a-m),M=.5*-i):"top-right"===h?(b=a-m+.5*n,M=.5*-i):(b=.5*(a-m),M=.5*(o-g));const y=.25*n;for(let d=0;u>d;d++){const e=1&d?.5*n:0,t=M+d*i;for(let i=0;p>i;i++){const r=b+i*n+e;if(!(-y>r||r>a+y||-y>t||t>o+y)){const e=oe(r,t,D());e.latticeHomeX=r,e.latticeHomeY=t,e.latticeRow=d,e.latticeCol=i,e.vx=0,e.vy=0,e.driftAx=0,e.driftTime=0}}}})()):e===Ca.PARALLAX_LINEAR?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d(),t=e.canvas;if(!t)return;f();const a=t.width,o=t.height,n=p(Math.max(0,Math.min(40,Math.round(e.parallaxLinearGridX??14)))),i=p(Math.max(0,Math.min(40,Math.round(e.parallaxLinearGridY??10)))),r=p(Math.max(0,Math.min(20,Math.round(e.parallaxLinearGridZ??7))));if(0>=n||0>=i||0>=r)return;const l=Math.max(.2,Math.min(3,e.parallaxLinearSpanX??1.35)),s=Math.max(.2,Math.min(3,e.parallaxLinearSpanY??1.35)),c=-.5*a*l,u=-.5*o*s,h=a*l/Math.max(1,n-1),m=o*s/Math.max(1,i-1),g=Math.max(10,e.parallaxLinearZNear??50),b=(Math.max(g+100,e.parallaxLinearZFar??800)-g)/Math.max(1,r-1),M=Math.max(80,e.parallaxLinearFocalLength??420),y=.768*(e.R_MED||20)*(e.DPR||1)*Math.max(.1,Math.min(6,e.parallaxLinearDotSizeMul??1.8)),v=J(e,Ca.PARALLAX_LINEAR),x=.5*a,w=.5*o;for(let d=r-1;d>=0;d--){const e=g+d*b;for(let t=0;i>t;t++)for(let a=0;n>a;a++){const o=c+a*h,n=u+t*m,i=e,r=M/(M+i),l=y*r,s=1,d=oe(x+o*r,w+n*r,D());d.r=l,d.vx=0,d.vy=0,d.alpha=s,d.A={x:o,y:n,z:i,baseScale:r},d.K=v>1e-6?1+(2*Math.random()-1)*v:1,d.B=!0}}})()):e===Ca.PARALLAX_PERSPECTIVE&&(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d(),t=e.canvas;if(!t)return;f();const a=t.width,o=t.height,n=p(Math.max(0,Math.min(50,Math.round(e.parallaxPerspectiveGridX??16)))),i=p(Math.max(0,Math.min(50,Math.round(e.parallaxPerspectiveGridY??12)))),r=p(Math.max(0,Math.min(25,Math.round(e.parallaxPerspectiveGridZ??8))));if(0>=n||0>=i||0>=r)return;const l=Math.max(.2,Math.min(3,e.parallaxPerspectiveSpanX??1.45)),s=Math.max(.2,Math.min(3,e.parallaxPerspectiveSpanY??1.45)),c=-.5*a*l,u=-.5*o*s,h=a*l/Math.max(1,n-1),m=o*s/Math.max(1,i-1),g=Math.max(10,e.parallaxPerspectiveZNear??40),b=(Math.max(g+100,e.parallaxPerspectiveZFar??1200)-g)/Math.max(1,r-1),M=Math.max(0,Math.min(1,e.parallaxPerspectiveRandomness??.6)),y=Math.max(80,e.parallaxPerspectiveFocalLength??420),v=.6*(e.R_MED||20)*(e.DPR||1)*Math.max(.1,Math.min(6,e.parallaxPerspectiveDotSizeMul??1.8)),x=J(e,Ca.PARALLAX_PERSPECTIVE),w=.5*a,S=.5*o;for(let d=r-1;d>=0;d--){const e=g+d*b;for(let t=0;i>t;t++)for(let a=0;n>a;a++){const o=u+t*m,n=e,i=c+a*h+(Math.random()-.5)*h*M,r=o+(Math.random()-.5)*m*M,l=n+(Math.random()-.5)*b*M*.5,s=y/(y+l),d=v*s,p=1,f=oe(w+i*s,S+r*s,D());f.r=d,f.vx=0,f.vy=0,f.alpha=p,f.A={x:i,y:r,z:l,baseScale:s},f.K=x>1e-6?1+(2*Math.random()-1)*x:1,f.B=!0}}})()),console.log(`Mode ${e} initialized with ${t.balls.length} balls`);const o=Math.max(0,Math.round(((e,t)=>{switch(e){case Ca.PIT:return t.pitWarmupFrames??10;case Ca.PIT_THROWS:return t.pitThrowsWarmupFrames??10;case Ca.FLIES:return t.fliesWarmupFrames??10;case Ca.WEIGHTLESS:return t.weightlessWarmupFrames??10;case Ca.WATER:return t.waterWarmupFrames??10;case Ca.VORTEX:return t.vortexWarmupFrames??10;case Ca.PING_PONG:return t.pingPongWarmupFrames??10;case Ca.MAGNETIC:return t.magneticWarmupFrames??10;case Ca.BUBBLES:return t.bubblesWarmupFrames??10;case Ca.KALEIDOSCOPE:return t.kaleidoscopeWarmupFrames??10;case Ca.KALEIDOSCOPE_1:return t.kaleidoscope1WarmupFrames??10;case Ca.KALEIDOSCOPE_2:return t.kaleidoscope2WarmupFrames??10;case Ca.KALEIDOSCOPE_3:return t.kaleidoscope3WarmupFrames??10;case Ca.ORBIT_3D:return t.orbit3dWarmupFrames??10;case Ca.ORBIT_3D_2:return t.orbit3d2WarmupFrames??10;case Ca.CRITTERS:return t.crittersWarmupFrames??10;case Ca.NEURAL:return t.neuralWarmupFrames??10;case Ca.LATTICE:return t.latticeWarmupFrames??10;case Ca.PARALLAX_LINEAR:return t.parallaxLinearWarmupFrames??10;case Ca.PARALLAX_PERSPECTIVE:return t.parallaxPerspectiveWarmupFrames??10;default:return 10}})(e,t)||0));if(t.warmupFramesRemaining=o,"undefined"!=typeof window&&e!==a)try{window.dispatchEvent(new CustomEvent("bb:modeChanged",{detail:{prevMode:a,mode:e}}))}catch(n){}}function He(){const e=d();try{P?.()}catch(t){}Ne(e.currentMode)}function je(){const e=d();return e.currentMode===Ca.FLIES?ne:e.currentMode===Ca.PIT||e.currentMode===Ca.PIT_THROWS?ie:e.currentMode===Ca.WEIGHTLESS?pe:e.currentMode===Ca.WATER?ee:e.currentMode===Ca.VORTEX?ge:e.currentMode===Ca.PING_PONG?be:e.currentMode===Ca.MAGNETIC?Me:e.currentMode===Ca.BUBBLES?we:e.currentMode===Ca.KALEIDOSCOPE||e.currentMode===Ca.KALEIDOSCOPE_1||e.currentMode===Ca.KALEIDOSCOPE_2||e.currentMode===Ca.KALEIDOSCOPE_3?Ke:e.currentMode===Ca.ORBIT_3D?Oe:e.currentMode===Ca.ORBIT_3D_2?Re:e.currentMode===Ca.CRITTERS?Ee:e.currentMode===Ca.NEURAL?Be:e.currentMode===Ca.LATTICE?We:e.currentMode===Ca.PARALLAX_LINEAR?_e:e.currentMode===Ca.PARALLAX_PERSPECTIVE?Ge:null}function Ze(){const e=d();return e.currentMode===Ca.WATER?te:e.currentMode===Ca.PIT_THROWS?de:e.currentMode===Ca.MAGNETIC?ye:e.currentMode===Ca.BUBBLES?Se:null}function Ye(){return d().currentMode===Ca.NEURAL?{preRender:$e}:null}function Xe(){try{return!!window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches}catch(e){return!1}}function qe(e,t,a){return t>e?t:e>a?a:e}function Ue(e,t){const a=[{x:Eo,y:Eo},{x:t.width-Eo,y:Eo},{x:Eo,y:t.height-Eo},{x:t.width-Eo,y:t.height-Eo}];for(let o=0;a.length>o;o++){const t=e.x-a[o].x,n=e.y-a[o].y,i=Math.max(1,Math.hypot(t,n));if(Eo+e.r>i){const a=(Eo+e.r-i)/(Eo+e.r)*1800,o=n/i;e.vx+=t/i*a*zo,e.vy+=o*a*zo}}}function Je(e,t){const a=d(),o=a.balls,n=a.canvas;if(!n)return;if(0===o.length)return;if(a.currentMode===Ca.KALEIDOSCOPE||a.currentMode===Ca.KALEIDOSCOPE_1||a.currentMode===Ca.KALEIDOSCOPE_2||a.currentMode===Ca.KALEIDOSCOPE_3){const i=Math.min(.033,Math.max(0,e)),r=o.length;for(let e=0;r>e;e++)o[e].step(i,t);(({iterations:e=4,positionalCorrectionPercent:t=.25,positionalCorrectionSlopPx:a=null,maxCorrectionPx:o=null,enableSound:n=!0}={})=>{const i=d(),r=i.balls,l=H(),s=i.REST,c=t,p=a??.5*i.DPR,u=i.ballSpacing||0,h=o??2*(i.DPR||1);for(let d=0;e>d;d++)for(let e=0;l.length>e;e++){const{i:t,j:a}=l[e],o=r[t],f=r[a];if(o.isSleeping&&f.isSleeping)continue;o.isSleeping&&o.wake(),f.isSleeping&&f.wake();const m=f.x-o.x,g=f.y-o.y,b=o.r+f.r+(o.r+f.r)/2*u,M=m*m+g*g;if(0===M||M>b*b)continue;const y=Math.sqrt(M),v=m/y,x=g/y,w=b-y,S=1/Math.max(o.m,.001),C=1/Math.max(f.m,.001);let k=c*Math.max(w-p,0)/(S+C);k>h&&(k=h);const P=k*v,F=k*x;o.x-=P*S,o.y-=F*S,f.x+=P*C,f.y+=F*C;const D=(f.vx-o.vx)*v+(f.vy-o.vy)*x;if(0>D){const e=-(1+(30>Math.abs(D)?0:s))*D/(S+C),r=e*v,l=e*x;if(o.vx-=r*S,o.vy-=l*S,f.vx+=r*C,f.vy+=l*C,n&&0===d){const e=(o.r+f.r)/2,n=(o.x+f.x)/2/(i.canvas?.width||1);R(e,Math.min(1,Math.abs(D)/(50*(o.r+f.r))),n,`${t}-${a}`)}}}})({iterations:3,positionalCorrectionPercent:.22,maxCorrectionPx:1.25*(a.DPR||1),enableSound:!1});for(let e=0;r>e;e++)De(o[e],n.width,n.height,i);return void(Vo=0)}Vo+=e;let i=0;for(;Vo>=zo&&Fa.MAX_PHYSICS_STEPS>i;){const e=o.length;for(let a=0;e>a;a++)o[a].step(zo,t);if(a.currentMode===Ca.KALEIDOSCOPE||a.currentMode===Ca.KALEIDOSCOPE_1||a.currentMode===Ca.KALEIDOSCOPE_2||a.currentMode===Ca.KALEIDOSCOPE_3?j(6):a.currentMode!==Ca.FLIES&&a.currentMode!==Ca.ORBIT_3D&&a.currentMode!==Ca.PARALLAX_LINEAR&&a.currentMode!==Ca.PARALLAX_PERSPECTIVE&&j(10),po.clearAllPressure(),a.currentMode!==Ca.ORBIT_3D&&a.currentMode!==Ca.ORBIT_3D_2&&a.currentMode!==Ca.PARALLAX_LINEAR&&a.currentMode!==Ca.PARALLAX_PERSPECTIVE&&a.currentMode!==Ca.LATTICE){const e=a.currentMode===Ca.WEIGHTLESS?a.weightlessBounce:a.REST,t=a.currentMode===Ca.PIT||a.currentMode===Ca.PIT_THROWS,i=o.length;for(let a=0;i>a;a++)t||Ue(o[a],n),o[a].walls(n.width,n.height,zo,e)}if(a.currentMode===Ca.PIT||a.currentMode===Ca.PIT_THROWS){j(3);const e=a.REST,t=o.length;for(let a=0;t>a;a++)o[a].walls(n.width,n.height,zo,e,{registerEffects:!1});const i=a.DPR||1,r=8*i,l=.1,s=a.timeToSleep??.25;for(let a=0;t>a;a++){const e=o[a];if(!e||e.isSleeping)continue;const t=Math.sqrt(e.vx*e.vx+e.vy*e.vy),n=Math.abs(e.omega);(e.isGrounded||e.hasSupport)&&r>t&&l>n?(e.vx*=.5,e.vy*=.5,e.omega*=.5,2*i>t&&(e.vx=0,e.vy=0),.02>n&&(e.omega=0),e.sleepTimer+=zo,s>e.sleepTimer||(e.vx=0,e.vy=0,e.omega=0,e.isSleeping=!0)):e.sleepTimer=0}}Vo-=zo,i++}const r=Ze();r&&r(e),po.step(e),Vo>zo*Fa.ACCUMULATOR_RESET_THRESHOLD&&(Vo=0)}function Qe(){const e=d(),t=e.ctx,a=e.balls,o=e.canvas;if(!t||!o)return;t.clearRect(0,0,o.width,o.height);const n=e.canvasClipPath;if(n){t.save();try{t.clip(n)}catch(r){}}const i=Ye();if(i&&i.preRender&&i.preRender(t),e.currentMode===Ca.KALEIDOSCOPE||e.currentMode===Ca.KALEIDOSCOPE_1||e.currentMode===Ca.KALEIDOSCOPE_2||e.currentMode===Ca.KALEIDOSCOPE_3)(e=>{const t=d();if(!Ie(t.currentMode))return;const a=t.canvas;if(!a)return;const o=(()=>{const e=performance.now(),t=Fo||e;return Fo=e,Ce((e-t)/1e3,0,.05)})(),n=t.balls,i=a.width,r=a.height,l=ke(t),s=Te(t).wedges??12,c=Ce(Math.round(s),3,24),p=!!(t.kaleidoscopeMirror??1),u=(e=>.5*e.width)(a),h=(e=>.5*e.height)(a),f=ko/c,m=Math.max(1e-5,1e-4*f),g=t.mouseInCanvas?t.mouseX:u,b=t.mouseInCanvas?t.mouseY:h,M=g-u,y=b-h,v=Math.atan2(y,M),x=Ce(Math.hypot(M,y)/Math.max(1,.5*Math.min(i,r)),0,1);t.$||(t.$={phase:{x:0,v:0},panX:{x:0,v:0},panY:{x:0,v:0},lastMouseX:g,lastMouseY:b,lastInCanvas:!!t.mouseInCanvas});const w=t.$,S=!!t.mouseInCanvas,C=Math.hypot(g-w.lastMouseX,b-w.lastMouseY)>.5||S!==w.lastInCanvas,k=Ce(Te(t).speed??1,.2,2),P=Ae(t),F=.65*k*P,D=M*F*(t.mouseInCanvas?1:0),T=y*F*(t.mouseInCanvas?1:0),L=.7*v*P*(t.mouseInCanvas?1:0);C?(w.lastMouseX=g,w.lastMouseY=b,w.lastInCanvas=S,Fe(w.phase,L,o,4.5),Fe(w.panX,D,o,5),Fe(w.panY,T,o,5)):(w.phase.v=0,w.panX.v=0,w.panY.v=0);const I=w.phase.x,A=w.panX.x,K=w.panY.x,O=.22+.18*Ce((k-.2)/1.8,0,1),R=1-O+2*O*(1-x);for(let d=0;n.length>d;d++){const t=n[d],a=t.x-u+A,o=t.y-h+K,i=3.5*l,r=Math.hypot(a,o)*i*R;if(Po>r)continue;const s=p?2*f:f;let g=Math.atan2(o,a)+I;g=(g%s+s)%s,p&&g>f&&(g=s-g),g=Ce(g,m,f-m);for(let n=0;c>n;n++){const a=n*f+g,o=u+Math.cos(a)*r,i=h+Math.sin(a)*r;1>t.alpha&&(e.globalAlpha=t.alpha),e.fillStyle=t.color,e.beginPath(),e.arc(o,i,t.r,0,ko),e.fill(),1>t.alpha&&(e.globalAlpha=1)}}})(t);else for(let l=0;a.length>l;l++)a[l].draw(t);i&&i.postRender&&i.postRender(t),(e=>{const t=d();if(!t?.mouseTrailEnabled)return;if(Xe())return;if(!e||!Ro||!Lo)return;const a=performance.now(),o=qe(+(t.mouseTrailFadeMs??220),40,2e3),n=qe(+(t.mouseTrailOpacity??.35),0,1);if(0>=n)return;const i=t.DPR||1,r=qe(+(t.mouseTrailSize??1.3),.5,10)*i;for(;Ro>0&&a-Ko[(Oo-Ro+Lo)%Lo]>o;)Ro--;if(!Ro)return;if(2>Ro)return;const l=(()=>{const e=d();return e&&"string"==typeof e.cursorColorHex&&e.cursorColorHex?e.cursorColorHex:"#000000"})(),s=e.globalAlpha,c=e.globalCompositeOperation,p=e.lineCap,u=e.lineJoin,h=e.strokeStyle,f=e.lineWidth;e.globalCompositeOperation="source-over",e.lineCap="round",e.lineJoin="round",e.strokeStyle=l,e.lineWidth=r,e.globalAlpha=n;const m=Ro,g=(Oo-m+Lo)%Lo;if(e.beginPath(),e.moveTo(Io[g],Ao[g]),2===m)e.lineTo(Io[(g+1)%Lo],Ao[(g+1)%Lo]);else{for(let a=1;m-1>a;a++){const t=(g+a)%Lo,o=(g+a+1)%Lo,n=Io[t],i=Ao[t];e.quadraticCurveTo(n,i,.5*(n+Io[o]),.5*(i+Ao[o]))}const t=(g+m-1)%Lo;e.lineTo(Io[t],Ao[t])}e.stroke(),e.globalAlpha=s,e.globalCompositeOperation=c,e.lineCap=p,e.lineJoin=u,e.strokeStyle=h,e.lineWidth=f})(t),n&&t.restore(),((e,t,a)=>{const o=d(),n=(()=>{try{return getComputedStyle(document.documentElement).getPropertyValue("--wall-color").trim()||"#0a0a0a"}catch{return"#0a0a0a"}})(),i=o.containerBorder||12,r=o.DPR||1,l=i*r,s=(o.containerBorderX||i)*r;if(e.save(),e.fillStyle=n,po.bottom.hasDeformation()){e.beginPath(),e.moveTo(0,a+l);for(let o=0;so>=o;o++){const n=o/so,i=n*t,l=po.bottom.getDeformAt(n);e.lineTo(i,a-l*r)}e.lineTo(t,a+l),e.closePath(),e.fill()}if(po.top.hasDeformation()){e.beginPath(),e.moveTo(0,-l);for(let a=0;so>=a;a++){const o=a/so,n=o*t,i=po.top.getDeformAt(o);e.lineTo(n,i*r)}e.lineTo(t,-l),e.closePath(),e.fill()}if(po.left.hasDeformation()){e.beginPath(),e.moveTo(-s,0);for(let t=0;so>=t;t++){const o=t/so,n=o*a,i=po.left.getDeformAt(o);e.lineTo(i*r,n)}e.lineTo(-s,a),e.closePath(),e.fill()}if(po.right.hasDeformation()){e.beginPath(),e.moveTo(t+s,0);for(let o=0;so>=o;o++){const n=o/so,i=n*a,l=po.right.getDeformAt(n);e.lineTo(t-l*r,i)}e.lineTo(t+s,a),e.closePath(),e.fill()}e.restore()})(t,o.width,o.height)}function et(){return null===Wo&&(Wo=(()=>{try{return!1}catch(e){}try{if("8001"==(globalThis?.location?.port??"")+"")return!0}catch(e){}try{if(Array.from(document.scripts||[]).some(e=>{if("module"!==(e.getAttribute("type")||"").toLowerCase())return!1;const t=e.getAttribute("src")||"";return/(^|\/)main\.js(\?|#|$)/.test(t)}))return!0}catch(e){}return!1})()),Wo}function tt(){const e=Math.random();let t=0;for(let a=0;8>a;a++)if(t+=jo[a],t>=e)return Ho[a];return Ho[0]}function at({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"],silence:a=!1}={}){if(!No){No=!0;try{$o.log("%c"+e,"color: #888; font-style: italic;"),$o.log("");const a=((e,t=3)=>{const{colorAssignments:a}=((e,t=3)=>{const a=[];for(let r=0;e.length>r;r++){const o=e[r];for(let e=0;o.length>e;e+=t){const n=o.slice(e,e+t);a.push({row:r,col:e,visible:n.trim().length>0})}}const o=a.map((e,t)=>e.visible?t:-1).filter(e=>e>=0),n=Array(a.length).fill(null),i=(e=>{for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e})([...o]);for(let r=0;Math.min(8,i.length)>r;r++)n[i[r]]=Ho[r];for(const r of o)null===n[r]&&(n[r]=tt());for(let r=0;a.length>r;r++)null===n[r]&&(n[r]="transparent");return{clusters:a,colorAssignments:n}})(e,t),o=[];let n=0;for(const i of e){let e="";const r=[];for(let o=0;i.length>o;o+=t)e+="%c"+i.slice(o,o+t),r.push(`color: ${a[n]}; font-family: monospace; font-weight: bold;`),n++;o.push([e,...r])}return o})(t,3);for(const e of a)$o.log(...e);$o.log("");const o=(new Date).getFullYear();$o.log("%c© "+o+" Alexander Beck Studio. All rights reserved. Unauthorized reproduction prohibited.","color: #555; font-size: 10px;")}catch(o){}if(a)try{console.log=()=>{},console.info=()=>{},console.warn=()=>{},console.debug=()=>{},console.table=()=>{},console.group=()=>{},console.groupCollapsed=()=>{},console.groupEnd=()=>{}}catch(o){}}}function ot(e){if(!et())return;const t=("undefined"!=typeof performance&&performance.now?performance.now():Date.now())-Go;_o+=1,$o.log(`[${(_o+"").padStart(2,"0")}] +${t.toFixed(1)}ms ${e}`)}function nt(e){if(et())try{performance.mark(e)}catch(t){}}function it(e,t,a){if(!et())return null;try{performance.measure(e,t,a);const o=performance.getEntriesByName(e),n=o&&o.length?o[o.length-1]:null;return n?n.duration:null}catch(o){return null}}function rt(e,t){return getComputedStyle(document.documentElement).getPropertyValue(e).trim()||t}function lt(){const e=navigator.userAgent||"",t=/Android/.test(e),a=/iPhone|iPad|iPod/.test(e)||/Mac/.test(e)&&navigator.maxTouchPoints>1,o=t||a,n=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||window.matchMedia&&window.matchMedia("(display-mode: minimal-ui)").matches||!0===navigator.standalone;return o||n}function st(e){const t=document.documentElement;t.style.setProperty("--wall-color",e),t.style.setProperty("--frame-color-light",e),t.style.setProperty("--frame-color-dark",e)}function ct(e){if(Zo&&Yo){const t=document.documentElement;return t.style.setProperty("--frame-color-light",Zo),t.style.setProperty("--frame-color-dark",Yo),void t.style.setProperty("--wall-color",e?Yo:Zo)}st(rt(e?"--frame-color-dark":"--frame-color-light","#0a0a0a"))}function dt(e){Zo&&Yo||(Zo=rt("--frame-color-light","#0a0a0a"),Yo=rt("--frame-color-dark","#0a0a0a")),st(rt(e?"--wall-color-browser-dark":"--wall-color-browser-light",e?"#202124":"#f1f3f4"))}function pt(e,t){return getComputedStyle(document.documentElement).getPropertyValue(e).trim()||t}function ut(e){Xo=e;let t=!1;t="auto"===e?"dark"===qo||(()=>{const e=d();if(!e.autoDarkModeEnabled)return!1;const t=Number.isFinite(e.autoDarkNightStartHour)?e.autoDarkNightStartHour:18,a=Number.isFinite(e.autoDarkNightEndHour)?e.autoDarkNightEndHour:6,o=(new Date).getHours();return t!==a&&(a>t?o>=t&&a>o:o>=t||a>o)})():"dark"===e,(e=>{const t=d();t.isDarkMode=e,document.documentElement.style.colorScheme=e?"dark":"light",e?(t.container?.classList.add("dark-mode"),document.body.classList.add("dark-mode"),document.documentElement.classList.add("dark-mode")):(t.container?.classList.remove("dark-mode"),document.body.classList.remove("dark-mode"),document.documentElement.classList.remove("dark-mode")),(e=>{const t=(d().chromeHarmonyMode||"auto")+"",a=(()=>{const e=navigator.userAgent||"",t=navigator.vendor||"";return{isFirefox:/Firefox\//.test(e),isSafari:/Safari\//.test(e)&&/Apple/.test(t)&&!/Chrome\//.test(e)&&!/Chromium\//.test(e),isChromium:/Chrome\//.test(e)||/Chromium\//.test(e)||/Edg\//.test(e),ua:e}})();if("site"===t)return ct(e),{mode:t,family:a,themeColorLikelyApplied:lt()};if("browser"===t)return dt(e),{mode:t,family:a,themeColorLikelyApplied:lt()};const o=lt();a.isSafari?ct(e):a.isChromium&&!o?dt(e):ct(e)})(e),(e=>{const t=(()=>{const e=d();return{light:e?.bgLight||pt("--bg-light","#f5f5f5"),dark:e?.bgDark||pt("--bg-dark","#0a0a0a")}})(),a=pt("--chrome-bg-light",t.light),o=pt("--chrome-bg-dark",t.dark),n=e?o:a;let i=document.querySelector('meta[name="theme-color"]');i||(i=document.createElement("meta"),i.name="theme-color",document.head.appendChild(i)),i.content=n;let r=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: light)"]');r||(r=document.createElement("meta"),r.name="theme-color",r.media="(prefers-color-scheme: light)",document.head.appendChild(r)),r.content=a;let l=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: dark)"]');l||(l=document.createElement("meta"),l.name="theme-color",l.media="(prefers-color-scheme: dark)",document.head.appendChild(l)),l.content=o})(e),T(t.currentTemplate),(()=>{const e=document.getElementById("themeAuto"),t=document.getElementById("themeLight"),a=document.getElementById("themeDark");if(!e||!t||!a)return;[e,t,a].forEach(e=>e.classList.remove("active")),"auto"===Xo?e.classList.add("active"):"light"===Xo?t.classList.add("active"):a.classList.add("active");const o=document.getElementById("themeStatus");if(o){const e=d();o.textContent="auto"===Xo?e.isDarkMode?"🌙 Auto (Dark)":"☀️ Auto (Light)":"light"===Xo?"☀️ Light Mode":"🌙 Dark Mode"}})()})(t);try{localStorage.setItem("theme-preference",e)}catch(a){}ot(`🎨 Theme set to: ${e} (rendering: ${t?"dark":"light"})`)}function ht(){if(Uo)return;Uo=!0,(()=>{const e=d(),t=document.documentElement;e?.bgLight&&(t.style.setProperty("--bg-light",e.bgLight),t.style.setProperty("--chrome-bg-light",e.bgLight)),e?.bgDark&&(t.style.setProperty("--bg-dark",e.bgDark),t.style.setProperty("--chrome-bg-dark",e.bgDark)),e?.frameColor&&(t.style.setProperty("--frame-color-light",e.frameColor),t.style.setProperty("--frame-color-dark",e.frameColor),t.style.setProperty("--wall-color",e.frameColor)),e?.textColorLight&&(t.style.setProperty("--text-color-light",e.textColorLight),t.style.setProperty("--text-color-light-base",e.textColorLight)),e?.textColorLightMuted&&t.style.setProperty("--text-color-light-muted",e.textColorLightMuted),e?.textColorDark&&(t.style.setProperty("--text-color-dark",e.textColorDark),t.style.setProperty("--text-color-dark-base",e.textColorDark)),e?.textColorDarkMuted&&t.style.setProperty("--text-color-dark-muted",e.textColorDarkMuted),e?.edgeLabelColorLight&&t.style.setProperty("--edge-label-color-light",e.edgeLabelColorLight),e?.edgeLabelColorDark&&t.style.setProperty("--edge-label-color-dark",e.edgeLabelColorDark),Number.isFinite(e?.edgeLabelInsetAdjustPx)&&t.style.setProperty("--edge-label-inset-adjust",e.edgeLabelInsetAdjustPx+"px"),e?.linkHoverColor&&t.style.setProperty("--link-hover-color",e.linkHoverColor),e?.logoColorLight&&t.style.setProperty("--logo-color-light",e.logoColorLight),e?.logoColorDark&&t.style.setProperty("--logo-color-dark",e.logoColorDark)})(),qo=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",ot("🖥️ System prefers: "+qo);let e="auto";try{const t=localStorage.getItem("theme-preference");"auto"!==t&&"light"!==t&&"dark"!==t||(e=t)}catch(n){}ut(e);const t=document.getElementById("themeAuto"),a=document.getElementById("themeLight"),o=document.getElementById("themeDark");t&&t.addEventListener("click",()=>ut("auto")),a&&a.addEventListener("click",()=>ut("light")),o&&o.addEventListener("click",()=>ut("dark")),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{qo=e.matches?"dark":"light",ot("🖥️ System preference changed to: "+qo),"auto"===Xo&&ut("auto")}),window.setInterval(()=>{"auto"===Xo&&ut("auto")},6e4),ot("✓ Modern dark mode initialized")}function ft(){ut("light"===Xo?"dark":"light")}function mt(){console.log("⚠️ localStorage is disabled")}function gt(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(mt,500)}function bt(e){return!1!==en[e]}function Mt(e,t=!0){const a=Ta[e];if(!a)return;const o=d();for(const[i,r]of Object.entries(a))"label"!==i&&void 0!==o[i]&&(o[i]=r);o.parallaxLinearPreset=e,t&&Promise.resolve().then(()=>To).then(({resetCurrentMode:e})=>e());try{Ft()}catch(n){}console.log("Applied parallax linear preset: "+a.label)}function yt(e,t=!0){const a=La[e];if(!a)return;const o=d();for(const[i,r]of Object.entries(a))"label"!==i&&void 0!==o[i]&&(o[i]=r);o.parallaxPerspectivePreset=e,t&&Promise.resolve().then(()=>To).then(({resetCurrentMode:e})=>e());try{Ft()}catch(n){}console.log("Applied parallax perspective preset: "+a.label)}function vt(e){return{id:e,label:"Warmup Frames",stateKey:e,type:"range",min:0,max:240,step:1,default:10,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0,hint:"Pre-runs physics before first render to avoid visible settling on mode start."}}function xt(e,t){try{if("function"==typeof e?.format)return e.format(t)}catch(a){}return(t??"")+""}function wt(){const e=[];for(const t of Object.values(tn))for(const a of t.controls)e.push({...a,section:t.title});return e}function St(e){if("divider"===e.type)return`<div class="control-divider"><span class="control-divider-label">${e.label||""}</span></div>`;if(!bt(e.id))return"";const t=e.id+"Slider",a=e.id+"Val",o=e.id+"Picker";if("colorDistribution"===e.type){const t=(Array.isArray(e.labels)?e.labels:[]).map((e,t)=>{const a=((e||"")+"").trim();return`\n        <div class="color-dist-row" data-color-dist-row="${t}">\n          <div class="color-dist-row-label">${a}</div>\n          <div class="color-dist-row-controls">\n            <span class="color-dist-swatch" id="${"colorDistSwatch"+t}" aria-hidden="true"></span>\n            <select id="${"colorDistColor"+t}" class="control-select color-dist-select" aria-label="${a} color"></select>\n            <input type="range" id="${"colorDistWeight"+t}" min="0" max="100" step="1" value="0" aria-label="${a} weight">\n            <span class="color-dist-weight" id="${"colorDistWeightVal"+t}">0%</span>\n          </div>\n        </div>`}).join("");return`\n      <div class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="colorDistTotalVal">100%</span>\n        </div>\n        <div class="color-dist-grid" id="colorDistGrid">\n          ${t}\n        </div>\n        <div class="color-dist-actions">\n          <button type="button" class="secondary" id="colorDistResetBtn" aria-label="Reset color distribution to defaults">Reset Defaults</button>\n        </div>\n      </div>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`}if("color"===e.type)return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${e.default}</span>\n        </div>\n        <input type="color" id="${o}" value="${e.default}" aria-label="${e.label}" />\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`;if("select"===e.type){const o=(Array.isArray(e.options)?e.options:[]).map(t=>{const a=t.value+"";return`<option value="${a}" ${e.default+""===a?"selected":""}>${(t.label??t.value)+""}</option>`}).join(""),n=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${xt(e,e.default)}</span>\n        </div>\n        <select id="${t}" class="control-select" aria-label="${e.label}">\n          ${o}\n        </select>\n      </label>\n      ${n}`}if("checkbox"===e.type)return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${e.default?"On":"Off"}</span>\n        </div>\n        <input type="checkbox" id="${t}" ${e.default?"checked":""} aria-label="${e.label}">\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`;const n=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${xt(e,e.default)}</span>\n        </div>\n        <input type="range" id="${t}" min="${e.min}" max="${e.max}" step="${e.step}" value="${e.default}">\n      </label>\n      ${n}`}function Ct(e,t){const a=t.controls.filter(e=>bt(e.id));if(0===a.length)return"";let o=null,n="";for(const s of a)s.group&&s.group!==o?(null!==o&&(n+="</div>"),n+=`<div class="section-title" style="margin-top: 12px;">${s.group}</div><div class="group">`,o=s.group):s.group||null===o||(n+="</div>",o=null),n+=St(s);null!==o&&(n+="</div>");const i=t.defaultOpen?"open":"",r=`\n    <summary class="panel-section-header">\n      ${t.icon?`<span class="section-icon">${t.icon}</span>`:""}\n      <span class="section-label">${t.title}</span>\n    </summary>`,l=`<div class="panel-section-content">${n}</div>`;return t.mode?`\n      <div id="${t.mode}Controls" class="mode-controls">\n        <details class="panel-section-accordion" ${i}>\n          ${r}\n          ${l}\n        </details>\n      </div>`:`\n    <details class="panel-section-accordion" ${i}>\n      ${r}\n      ${l}\n    </details>`}function kt(){try{for(const[,e]of Object.entries(tn)){if(!e?.mode)continue;const t=Array.isArray(e.controls)?e.controls.length:0;4>t&&console.warn(`[panel] Mode "${e.mode}" has only ${t} controls; add at least 4 parameters.`)}}catch(a){}const e=Object.entries(tn).filter(([,e])=>e?.mode).map(([e,t])=>Ct(0,t)).join("");let t=`\n    \x3c!-- Screen reader announcements --\x3e\n    <div role="status" aria-live="polite" aria-atomic="true" class="sr-only" id="announcer"></div>\n\n    \x3c!-- Theme --\x3e\n    <details class="panel-section-accordion" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎨</span>\n        <span class="section-label">Theme</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="theme-segment-control" role="group" aria-label="Theme selector">\n          <button id="themeAuto" class="theme-segment-btn" aria-label="Auto theme">Auto</button>\n          <button id="themeLight" class="theme-segment-btn active" aria-label="Light theme">Light</button>\n          <button id="themeDark" class="theme-segment-btn" aria-label="Dark theme">Dark</button>\n        </div>\n        <div id="themeStatus" class="panel-status">☀️ Light Mode</div>\n      </div>\n    </details>\n\n    \x3c!-- Mode --\x3e\n    <details class="panel-section-accordion" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎛️</span>\n        <span class="section-label">Mode</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="mode-switcher" role="group" aria-label="Simulation mode selector">\n          ${(()=>{const e={pit:"🎯",bubbles:"🫧",critters:"🪲",flies:"🕊️","pit-throws":"🎯",water:"🌊",vortex:"🌀",magnetic:"🧲","ping-pong":"🏓",weightless:"🌌",kaleidoscope:"🪞","kaleidoscope-1":"🪞","kaleidoscope-2":"🪞","kaleidoscope-3":"🪞","orbit-3d":"🌪️","orbit-3d-2":"🌪️",lattice:"💎",neural:"🧠"},t={pit:"Pit",bubbles:"Bubbles",critters:"Critters",flies:"Flies","pit-throws":"Throws",water:"Water",vortex:"Vortex",magnetic:"Magnet","ping-pong":"Pong",weightless:"Zero-G",kaleidoscope:"Kalei","kaleidoscope-1":"Kalei I","kaleidoscope-2":"Kalei II","kaleidoscope-3":"Kalei III","orbit-3d":"Orbit","orbit-3d-2":"Swarm",lattice:"Lattice",neural:"Neural"};let a="";return ka.forEach(o=>{const n=t[o]||o;a+=`<button class="mode-button" data-mode="${o}" aria-label="${Pa[o]||n} mode">${e[o]||"⚪"} ${n}</button>`}),a})()}\n        </div>\n        ${e}\n      </div>\n    </details>`;for(const[o,n]of Object.entries(tn))n.mode||(t+=Ct(0,n));return t+='\n    <details class="panel-section-accordion">\n      <summary class="panel-section-header">\n        <span class="section-icon">🌈</span>\n        <span class="section-label">Colors</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Color Template</span>\n            <span class="control-value"></span>\n          </div>\n          <select id="colorSelect"></select>\n        </label>\n      </div>\n    </details>',t+='\n    <div class="panel-section panel-section--action">\n      <button id="saveConfigBtn" class="primary">💾 Save Config</button>\n    </div>\n    <div class="panel-footer">\n      <kbd>R</kbd> reset · <kbd>/</kbd> panel · <kbd>9</kbd> kalei · Critters + Throws have no key (yet)\n    </div>',t}function Pt(){const e=d();for(const[a,o]of Object.entries(tn))for(const n of o.controls){const i=document.getElementById(n.id+"Val");if("colorDistribution"===n.type){const l=Array.isArray(n.labels)?n.labels:[],s=document.getElementById("colorDistResetBtn");function c(e){return((e||"")+"").trim().toLowerCase()}function p(e,t,a,o=t){const n=+e;if(!Number.isFinite(n))return o;const i=Math.floor(n);return t>i?t:i>a?a:i}function u(e){const t=[];for(let a=0;8>a;a++)t.push({value:a+"",label:`Ball ${a+1}${e[a]?" — "+e[a]:""}`});return t}function h(t){const a=Array.isArray(e.colorDistribution)?e.colorDistribution:[],o=new Map;for(const e of a)o.set(c(e?.label),e);const n=Array.isArray(t)?t:a,i=[],r=new Set;for(let e=0;l.length>e;e++){const t=((l[e]||"")+"").trim(),a=c(t),s=n.find(e=>c(e?.label)===a)||o.get(a)||{};let d=p(s?.colorIndex,0,7,p(o.get(a)?.colorIndex,0,7,0));if(r.has(d))for(let e=0;8>e;e++)if(!r.has(e)){d=e;break}r.add(d);const u=p(s?.weight,0,100,p(o.get(a)?.weight,0,100,0));i.push({label:t,colorIndex:d,weight:u})}return i}function f(e,t=0){const a=e.map(e=>p(e,0,100,0));let o=0;for(let l=0;a.length>l;l++)o+=a[l];if(100===o)return a;if(0===o)return a[t]=100,a;const n=Array(a.length).fill(0);let i=0;for(let l=0;a.length>l;l++){const e=Math.round(a[l]/o*100);n[l]=e,i+=e}let r=100-i;for(;0!==r;)if(r>0){let e=0;for(let t=1;n.length>t;t++)n[t]>n[e]&&(e=t);n[e]+=1,r-=1}else{let e=-1;for(let t=0;n.length>t;t++)n[t]>0&&(-1===e||n[t]>n[e])&&(e=t);if(-1===e)break;n[e]-=1,r+=1}return n.map(e=>p(e,0,100,0))}function m(e,t,a){const o=e.map(e=>p(e?.weight,0,100,0));return o[t]=p(a,0,100,o[t]),100===o.reduce((e,t)=>e+t,0)?o:f(o,t)}function g(){const t={pit:null,"pit-throws":null,flies:e.fliesBallCount,weightless:e.weightlessCount,water:e.waterBallCount,vortex:e.vortexBallCount,"ping-pong":e.pingPongBallCount,magnetic:e.magneticBallCount,bubbles:e.bubblesMaxCount,kaleidoscope:e.kaleidoscopeBallCount,"kaleidoscope-1":e.kaleidoscope1BallCount,"kaleidoscope-2":e.kaleidoscope2BallCount,"kaleidoscope-3":e.kaleidoscope3BallCount,critters:e.critterCount,neural:e.neuralBallCount,lattice:e.latticeBallCount,orbit3d:e.orbit3dMoonCount,orbit3d2:e.orbit3d2MoonCount}[e.currentMode];return Number.isFinite(+t)?+t:null}function b(){Promise.resolve().then(()=>pi).then(({applyExpertiseLegendColors:e})=>e?.()).catch(()=>{}),Promise.resolve().then(()=>Va).then(({pickRandomColor:t})=>{if("function"!=typeof t)return;const a=e.balls||[];for(let e=0;a.length>e;e++)a[e].color=t()}).catch(()=>{})}function M(){const t=h(e.colorDistribution),a=f(t.map(e=>e.weight),0);for(let e=0;t.length>e;e++)t[e].weight=a[e];e.colorDistribution=t;const o={};for(let e=0;t.length>e;e++)o[t[e].colorIndex]=t[e].label;const n=u(o),i=g();for(let e=0;l.length>e;e++){const a=t[e]||{colorIndex:0,weight:0},r=document.getElementById("colorDistSwatch"+e),l=document.getElementById("colorDistColor"+e),s=document.getElementById("colorDistWeight"+e),c=document.getElementById("colorDistWeightVal"+e);if(l){l.innerHTML="";for(const e of n){const t=document.createElement("option");t.value=e.value,t.textContent=e.label;const n=p(e.value,0,7,0);o[n]&&!(n===a.colorIndex)&&(t.disabled=!0),l.appendChild(t)}l.value=a.colorIndex+""}if(s&&(s.value=p(a.weight,0,100,0)+""),c){const e=p(a.weight,0,100,0),t=null!=i?Math.round(e/100*i):null;c.textContent=null!=t?`${e}% (≈${t})`:e+"%"}if(r){const e=p(a.colorIndex,0,7,0);r.style.backgroundColor=`var(--ball-${e+1})`}}const r=document.getElementById("colorDistTotalVal");if(r){let e=0;for(let a=0;t.length>a;a++)e+=t[a].weight;r.textContent=e+"%"}}try{M()}catch(t){}s&&s.addEventListener("click",()=>{const t=e?.config?.colorDistribution;e.colorDistribution=h(t);const a=f(e.colorDistribution.map(e=>e.weight),0);for(let o=0;e.colorDistribution.length>o;o++)e.colorDistribution[o].weight=a[o];M(),b(),gt()});for(let y=0;l.length>y;y++){const v=document.getElementById("colorDistColor"+y),x=document.getElementById("colorDistWeight"+y);v&&v.addEventListener("change",()=>{const t=p(v.value,0,7,0),a=h(e.colorDistribution);a[y].colorIndex=t,e.colorDistribution=a,M(),b(),gt()}),x&&x.addEventListener("input",()=>{const t=p(x.value,0,100,0),a=h(e.colorDistribution),o=m(a,y,t);for(let e=0;a.length>e;e++)a[e].weight=o[e];e.colorDistribution=a,M(),b(),gt()})}continue}if("color"===n.type){const w=document.getElementById(n.id+"Picker");if(!w)continue;w.addEventListener("input",()=>{const t=w.value;n.stateKey&&(e[n.stateKey]=t),n.onChange&&n.onChange(e,t),i&&(i.textContent=t),gt()});continue}if("select"===n.type){const S=document.getElementById(n.id+"Slider");if(!S)continue;S.addEventListener("change",()=>{const t=n.parse?n.parse(S.value):S.value;if(n.stateKey&&(e[n.stateKey]=t),n.onChange&&n.onChange(e,t),i){const a=n.stateKey?e[n.stateKey]:t;i.textContent=n.format?n.format(a):a+""}gt()});continue}if("checkbox"===n.type){const C=document.getElementById(n.id+"Slider");if(!C)continue;C.addEventListener("change",()=>{const t=!!C.checked;n.stateKey&&(e[n.stateKey]=t),n.onChange&&n.onChange(e,t),i&&(i.textContent=t?"On":"Off"),n.reinitMode&&e.currentMode===o.mode&&Promise.resolve().then(()=>To).then(({resetCurrentMode:e})=>e?.()).catch(()=>{}),gt()});continue}const r=document.getElementById(n.id+"Slider");r&&r.addEventListener("input",()=>{const t=n.parse(r.value);if(n.stateKey&&(e[n.stateKey]=t),n.onChange&&n.onChange(e,t),i&&(i.textContent=n.format(n.stateKey?e[n.stateKey]:t)),n.cssVar&&Qo){const e={};e[n.cssVar.replace("--","").replace(/-([a-z])/g,(e,t)=>t.toUpperCase())]=t,Qo(e)}n.reinitMode&&e.currentMode===o.mode&&Promise.resolve().then(()=>To).then(({resetCurrentMode:e})=>e?.()).catch(()=>{}),gt()})}}function Ft(){const e=d();for(const t of Object.values(tn))for(const a of t.controls){const t=a.id+"Slider",o=a.id+"Val";if("colorDistribution"===a.type)continue;const n=document.getElementById(t),i=document.getElementById(o);if(!n||!a.stateKey)continue;const r=e[a.stateKey];void 0!==r&&("checkbox"===a.type?(n.checked=!!r,i&&(i.textContent=r?"On":"Off")):(n.value=r,i&&(i.textContent=a.format(r))))}}function Dt(){Pt(),document.querySelectorAll(".mode-button").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const a=e.getAttribute("data-mode");console.log("Mode button clicked:",a),Ne(a),Tt(a)})}),L();const e=document.getElementById("colorSelect");e&&e.addEventListener("change",()=>{T(e.value),gt()});const t=document.getElementById("themeAuto"),a=document.getElementById("themeLight"),o=document.getElementById("themeDark");[t,a,o].forEach(e=>{e&&e.addEventListener("click",()=>{[t,a,o].forEach(e=>e?.classList.remove("active")),e.classList.add("active")})})}function Tt(e){document.querySelectorAll(".mode-button").forEach(t=>{const a=t.getAttribute("data-mode")===e;t.classList.toggle("active",a)}),document.querySelectorAll(".mode-controls").forEach(e=>e.classList.remove("active"));const t=document.getElementById(e+"Controls");t&&t.classList.add("active");const a=document.getElementById("announcer");a&&(a.textContent=`Switched to ${{critters:"Critters",pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero-G",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope","kaleidoscope-1":"Kaleidoscope I","kaleidoscope-2":"Kaleidoscope II","kaleidoscope-3":"Kaleidoscope III","orbit-3d":"Orbit 3D","orbit-3d-2":"Orbit 3D (Tight Swarm)",lattice:"Crystal Lattice",neural:"Neural Network"}[e]||e} mode`);try{const t=document.getElementById("edge-chapter-text");t&&(t.textContent=Pa?.[e]||"—")}catch(o){}}function Lt(e,t){const a=t();for(const o of Object.values(rn))for(const t of o.controls){const o=e.querySelector("#sound_"+t.id),n=e.querySelector(`#sound_${t.id}_val`);if(!o||void 0===a[t.id])continue;const i=t.fromConfig(a[t.id]);o.value=i,n&&(n.textContent=t.format(i))}}function It(e){try{localStorage.setItem(dn,e+"")}catch(t){}}function At(){try{const e=document.getElementById("controlPanel");e&&e.remove();const t=document.getElementById("soundPanel");t&&t.remove()}catch(e){}return ln=document.createElement("div"),ln.className="panel-dock",ln.id="panelDock",ln.classList.add("hidden"),It(!0),sn=(()=>{const t=document.createElement("div");t.id="masterPanel",t.className=(()=>{try{const e=localStorage.getItem(pn);return null===e||"true"===e}catch(e){return!0}})()?"panel collapsed":"panel",t.setAttribute("role","region"),t.setAttribute("aria-label","Settings");const a=document.createElement("div");a.className="panel-header";const o=et()?"DEV MODE":"BUILD MODE";a.innerHTML=`\n    <div class="mac-titlebar">\n      <div class="mac-traffic" aria-hidden="true">\n        <span class="mac-dot mac-dot--red"></span>\n        <span class="mac-dot mac-dot--yellow"></span>\n        <span class="mac-dot mac-dot--green"></span>\n      </div>\n      <div class="panel-title mac-title">Settings</div>\n      <div class="mac-right">\n        <span class="panel-mode-pill" role="status" aria-label="Runtime mode">${o}</span>\n        <button class="collapse-btn mac-collapse" aria-label="Collapse panel" title="Collapse">▾</button>\n      </div>\n    </div>\n  `;const i=document.createElement("div");i.className="panel-content",i.innerHTML=(()=>{const e=d(),t=+(e.containerBorderVw||0),a=+(e.wallRadiusVw||0),o=+(e.contentPaddingVw||0),i=n(),r=e.layoutViewportWidthPx>0?Math.round(e.layoutViewportWidthPx)+"px":`Auto (${Math.round(i)}px)`,l=Math.max(0,Math.round(e.containerBorder??0)),s=Math.max(0,Math.round(e.wallRadius??e.cornerRadius??0)),c=Math.max(0,Math.round(e.contentPadding??0)),p=Math.max(0,Math.round(e.wallInset??3)),u=Math.max(0,Math.round(e.layoutMinContentPaddingPx??0)),h=+(e.contentPaddingHorizontalRatio||1),f=Math.max(0,Math.round(e.layoutMinWallRadiusPx??0));return`\n    \x3c!-- ═══════════════════════════════════════════════════════════════════════\n         LAYOUT SECTION - Frame & Content Spacing\n         ═══════════════════════════════════════════════════════════════════════ --\x3e\n    <details class="panel-section-accordion" id="layoutSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">📐</span>\n        <span class="section-label">Layout</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Frame</span>\n            <span class="control-value" id="frameValue">${t.toFixed(2)}vw · ${l}px</span>\n          </div>\n          <input type="range" id="layoutFrame" min="0" max="8" step="0.05" value="${t||0}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Content Padding</span>\n            <span class="control-value" id="contentPadValue">${o.toFixed(2)}vw · ${c}px (min ${u}px)</span>\n          </div>\n          <input type="range" id="contentPadding" min="0" max="12" step="0.05" value="${o||0}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Horizontal Ratio</span>\n            <span class="control-value" id="contentPadHorizRatioValue">${h.toFixed(2)}× → ${Math.round(c*h)}px</span>\n          </div>\n          <input type="range" id="contentPadHorizRatio" min="0.5" max="2.5" step="0.05" value="${h}" />\n          <div class="control-hint">Horizontal padding = base × ratio</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Min Content Padding</span>\n            <span class="control-value" id="minContentPadValue">${u}px</span>\n          </div>\n          <input type="range" id="layoutMinContentPaddingPx" min="0" max="64" step="1" value="${u}" />\n          <div class="control-hint">Clamp target on smallest viewports (px).</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Radius</span>\n            <span class="control-value" id="radiusValue">${a.toFixed(2)}vw · ${s}px (min ${f}px)</span>\n          </div>\n          <input type="range" id="layoutRadius" min="0" max="20" step="0.05" value="${a||0}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Min Radius</span>\n            <span class="control-value" id="minRadiusValue">${f}px</span>\n          </div>\n          <input type="range" id="layoutMinWallRadiusPx" min="0" max="120" step="1" value="${f}" />\n          <div class="control-hint">Clamp target on smallest viewports (px).</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Viewport Width</span>\n            <span class="control-value" id="viewportWidthValue">${r}</span>\n          </div>\n          <input type="range" id="layoutViewportWidth" min="0" max="2400" step="10" value="${Math.round(e.layoutViewportWidthPx||0)}" />\n          <div class="control-hint">0 = Auto (uses current window width)</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Wall Inset</span>\n            <span class="control-value" id="wallInsetValue">${p}px</span>\n          </div>\n          <input type="range" id="layoutWallInset" min="0" max="20" value="${p}" />\n        </label>\n      </div>\n    </details>\n\n    \x3c!-- ═══════════════════════════════════════════════════════════════════════\n         SOUND SECTION\n         ═══════════════════════════════════════════════════════════════════════ --\x3e\n    <details class="panel-section-accordion" id="soundSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">🔊</span>\n        <span class="section-label">Sound</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="sound-enable-row">\n          <button id="soundEnableBtn" class="sound-enable-btn" aria-label="Enable sound" title="Enable sound">🔇</button>\n        </div>\n        <div id="soundControlsWrapper" class="sound-controls" style="display: none;">\n          <div class="sound-perf" aria-label="Sound performance controls">\n            <button type="button" id="soundTapBtn" class="sound-perf__btn" aria-label="Play test hit">▶︎</button>\n            <button type="button" id="soundResetBtn" class="sound-perf__btn" aria-label="Reset to preset">↺</button>\n            <button type="button" id="soundShuffleBtn" class="sound-perf__btn" aria-label="Shuffle (subtle) sound">🎲</button>\n            <span class="sound-perf__hint">wheel adjusts · shift/alt = fine</span>\n          </div>\n          <label class="control-row">\n            <span class="control-label">Preset</span>\n            <select id="soundPresetSelect" class="control-select"></select>\n          </label>\n          <p id="presetDescription" class="control-hint"></p>\n          ${(()=>{let e="";for(const[t,a]of Object.entries(rn)){e+='<div class="sound-dock__section">',e+=`<div class="sound-dock__section-title">${a.title}</div>`,e+='<div class="sound-dock__group">';for(const t of a.controls)e+=`\n        <label class="sound-dock__row">\n          <span class="sound-dock__label">${t.label}</span>\n          <input type="range" \n            id="sound_${t.id}" \n            class="sound-dock__slider" \n            min="${t.min}" \n            max="${t.max}" \n            step="${t.step}">\n          <span class="sound-dock__val" id="sound_${t.id}_val">${t.format(t.fromConfig(0))}</span>\n        </label>`;e+="</div></div>"}return e})()}\n        </div>\n      </div>\n    </details>\n\n    \x3c!-- ═══════════════════════════════════════════════════════════════════════\n         CONTROLS SECTION - Theme & Mode\n         ═══════════════════════════════════════════════════════════════════════ --\x3e\n    <details class="panel-section-accordion" id="controlsSection" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">⚙️</span>\n        <span class="section-label">Controls</span>\n      </summary>\n      <div class="panel-section-content">\n        ${nn}\n      </div>\n    </details>\n  `})(),t.appendChild(a),t.appendChild(i);const r=(()=>{try{const e=localStorage.getItem(un);if(!e)return null;const t=JSON.parse(e);if(!t||"object"!=typeof t)return null;const a=+t.width,o=+t.height;return Number.isFinite(a)&&Number.isFinite(o)?{width:Math.round(a),height:Math.round(o)}:null}catch(e){return null}})();r&&(t.style.width=r.width+"px",t.style.height=r.height+"px",t.style.maxHeight="none");const c=a.querySelector(".collapse-btn");return c&&c.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),(t=>{t.classList.toggle("collapsed"),(t=>{try{localStorage.setItem(pn,t+"")}catch(e){}})(t.classList.contains("collapsed"))})(t)}),setTimeout(()=>{Dt(),(()=>{const t=document.getElementById("saveConfigBtn");t&&t.addEventListener("click",()=>{const t=d(),a={};try{const e=wt();for(const o of e){if(!o||!o.stateKey)continue;const e=t[o.stateKey];void 0!==e&&(a[o.stateKey]=e)}}catch(e){}a.gravityMultiplier=t.gravityMultiplierPit,a.restitution=t.REST,a.friction=t.FRICTION,a.ballMass=t.ballMassKg,a.ballScale=t.sizeScale,a.sizeScale=t.sizeScale,a.sizeVariation=t.sizeVariation,a.repelSoft=t.repelSoft,a.repelSoftness=t.repelSoft,a.layoutViewportWidthPx=t.layoutViewportWidthPx||0,a.containerBorderVw=t.containerBorderVw,a.simulationPaddingVw=t.simulationPaddingVw,a.contentPaddingVw=t.contentPaddingVw,a.contentPaddingHorizontalRatio=t.contentPaddingHorizontalRatio,a.wallRadiusVw=t.wallRadiusVw,a.wallThicknessVw=t.wallThicknessVw,a.layoutMinContentPaddingPx=Math.max(0,Math.round(t.layoutMinContentPaddingPx??0)),a.layoutMinWallRadiusPx=Math.max(0,Math.round(t.layoutMinWallRadiusPx??0)),a.wallInset=t.wallInset;try{a.soundPreset=N(),a.soundConfig=W()}catch(e){}a.chromeHarmonyMode=t.chromeHarmonyMode,a.autoDarkModeEnabled=t.autoDarkModeEnabled,a.autoDarkNightStartHour=t.autoDarkNightStartHour,a.autoDarkNightEndHour=t.autoDarkNightEndHour,a.enableLOD=!1;const o=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(o),n.download="default-config.json",document.body.appendChild(n),n.click(),document.body.removeChild(n)})})(),(e=>{const t=e.querySelector("#soundEnableBtn"),a=e.querySelector("#soundControlsWrapper"),o=e.querySelector("#soundPresetSelect"),n=e.querySelector("#presetDescription"),i=e.querySelector("#soundSection"),r=e.querySelector("#soundTapBtn"),l=e.querySelector("#soundResetBtn"),s=e.querySelector("#soundShuffleBtn"),c=(e,t,a)=>t>e?t:e>a?a:e,d=(e,t)=>e+2*(Math.random()-.5)*t,p=(e,{openIfEnabled:o=!1}={})=>{if(!t)return;const n=e||$(),r=!(!n.isUnlocked||!n.isEnabled),l=!!n.isUnlocked;t.innerHTML=l&&r?'<i class="ti ti-volume-2" aria-hidden="true"></i>':'<i class="ti ti-volume-off" aria-hidden="true"></i>',t.setAttribute("aria-label",l?r?"Sound on":"Sound off":"Enable sound"),t.title=l?r?"Sound on":"Sound off":"Enable sound",t.classList.toggle("enabled",r),a&&(a.style.display=r?"":"none"),o&&r&&i&&!i.open&&(i.open=!0)};if(r&&r.addEventListener("click",()=>{z({intensity:.86,radius:18,xPosition:.72})}),l&&l.addEventListener("click",()=>{const t=N();G(t),n&&$a[t]&&(n.textContent=$a[t].description),Lt(e,W)}),s&&s.addEventListener("click",()=>{const t=W();_({filterBaseFreq:c(d(t.filterBaseFreq,120),300,8e3),filterQ:c(d(t.filterQ,.04),.05,.9),pitchCurve:c(d(t.pitchCurve,.06),.6,1.8),sparkleGain:c(d(t.sparkleGain,.03),0,.35),sparkleDecayMul:c(d(t.sparkleDecayMul,.05),.25,.95),noiseTransientQ:c(d(t.noiseTransientQ,.25),.6,6),reverbWetMix:c(d(t.reverbWetMix,.02),0,.35),reverbDecay:c(d(t.reverbDecay,.03),.05,.4),collisionMinImpact:c(d(t.collisionMinImpact,.03),.45,.9),variancePitch:c(d(t.variancePitch,.01),0,.2),varianceGain:c(d(t.varianceGain,.02),0,.35)}),Lt(e,W),z({intensity:.86,radius:18,xPosition:.72})}),t&&t.addEventListener("click",async()=>{const e=$();if(e.isUnlocked){const t=B();p({...e,isEnabled:t})}else await O()&&p(null,{openIfEnabled:!0})}),o){for(const[e,t]of Object.entries($a)){const a=document.createElement("option");a.value=e,a.textContent=t.label,o.appendChild(a)}o.value=N(),n&&$a[N()]&&(n.textContent=$a[N()].description),o.addEventListener("change",()=>{G(o.value),n&&$a[o.value]&&(n.textContent=$a[o.value].description),Lt(e,W)})}((e,t,a)=>{for(const o of Object.values(rn))for(const t of o.controls){const o=e.querySelector("#sound_"+t.id),n=e.querySelector(`#sound_${t.id}_val`);if(!o)continue;const i=e=>{const i=(r=e,l=parseFloat(o.min),s=parseFloat(o.max),l>r?l:r>s?s:r);var r,l,s;o.value=i+"";const c=t.toConfig(i);n&&(n.textContent=t.format(i)),a({[t.id]:c})};o.addEventListener("input",()=>{i(parseFloat(o.value))}),o.addEventListener("wheel",e=>{if(e.ctrlKey)return;const t=(parseFloat(o.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),a=0>e.deltaY?1:-1,n=parseFloat(o.value);e.preventDefault(),i(n+a*t)},{passive:!1}),n&&n.addEventListener("wheel",e=>{if(e.ctrlKey)return;const t=(parseFloat(o.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),a=0>e.deltaY?1:-1,n=parseFloat(o.value);e.preventDefault(),i(n+a*t)},{passive:!1})}})(e,0,_),Lt(e,W),p(),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(Qa,e=>{p(e&&e.detail?e.detail:null)})})(t),(e=>{const t=e.querySelector("#layoutFrame"),a=e.querySelector("#frameValue"),o=e.querySelector("#contentPadding"),i=e.querySelector("#contentPadValue"),r=e.querySelector("#contentPadHorizRatio"),c=e.querySelector("#contentPadHorizRatioValue"),p=e.querySelector("#layoutMinContentPaddingPx"),u=e.querySelector("#minContentPadValue"),h=e.querySelector("#layoutRadius"),f=e.querySelector("#radiusValue"),m=e.querySelector("#layoutMinWallRadiusPx"),g=e.querySelector("#minRadiusValue"),b=e.querySelector("#layoutViewportWidth"),M=e.querySelector("#viewportWidthValue"),y=e.querySelector("#layoutWallInset"),v=e.querySelector("#wallInsetValue"),x=d(),w=({triggerResize:e=!1}={})=>{if(l(),s(),a&&(a.textContent=`${(x.containerBorderVw||0).toFixed(2)}vw · ${Math.round(x.containerBorder||0)}px`),i){const e=Math.max(0,Math.round(x.layoutMinContentPaddingPx??0));i.textContent=`${(x.contentPaddingVw||0).toFixed(2)}vw · ${Math.round(x.contentPadding||0)}px (min ${e}px)`}if(c&&(c.textContent=`${(x.contentPaddingHorizontalRatio||1).toFixed(2)}× → ${Math.round(x.contentPaddingX||x.contentPadding)}px`),f){const e=Math.max(0,Math.round(x.layoutMinWallRadiusPx??0));f.textContent=`${(x.wallRadiusVw||0).toFixed(2)}vw · ${Math.round(x.wallRadius||0)}px (min ${e}px)`}if(u&&(u.textContent=Math.max(0,Math.round(x.layoutMinContentPaddingPx??0))+"px"),g&&(g.textContent=Math.max(0,Math.round(x.layoutMinWallRadiusPx??0))+"px"),M){const e=n();M.textContent=x.layoutViewportWidthPx>0?Math.round(x.layoutViewportWidthPx)+"px":`Auto (${Math.round(e)}px)`}e&&he(),document.dispatchEvent(new CustomEvent("layout-updated"))};t&&a&&t.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(x.containerBorderVw=t,x.wallThicknessVw=t,w({triggerResize:!0}))}),o&&i&&o.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(x.contentPaddingVw=t,w())}),r&&c&&r.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(x.contentPaddingHorizontalRatio=Math.max(.1,t),w())}),p&&u&&p.addEventListener("input",e=>{const t=parseInt(e.target.value,10);Number.isFinite(t)&&(x.layoutMinContentPaddingPx=Math.max(0,t),w({triggerResize:!0}))}),h&&f&&h.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(x.wallRadiusVw=t,w())}),m&&g&&m.addEventListener("input",e=>{const t=parseInt(e.target.value,10);Number.isFinite(t)&&(x.layoutMinWallRadiusPx=Math.max(0,t),w({triggerResize:!0}))}),b&&M&&b.addEventListener("input",e=>{const t=parseInt(e.target.value,10);x.layoutViewportWidthPx=Number.isFinite(t)?Math.max(0,t):0,w({triggerResize:!0})}),y&&v&&y.addEventListener("input",e=>{const t=parseInt(e.target.value,10);v.textContent=t+"px",x.wallInset=t})})(t)},0),t})(),ln.appendChild(sn),document.body.insertBefore(ln,document.body.firstChild),(()=>{if(!sn)return;const t=sn.querySelector(".panel-header");t&&(t.addEventListener("mousedown",Kt),t.addEventListener("touchstart",Kt,{passive:!1}),document.addEventListener("mousemove",Ot),document.addEventListener("mouseup",Rt),document.addEventListener("touchmove",Ot,{passive:!1}),document.addEventListener("touchend",Rt),(()=>{try{if(!ln)return;const e=JSON.parse(localStorage.getItem(cn)||"{}");e.custom&&(ln.style.position="fixed",ln.style.left=e.left,ln.style.top=e.top,ln.style.right="auto")}catch(e){}})())})(),(()=>{if(!sn)return;if("undefined"==typeof ResizeObserver)return;let t=0;const a=new ResizeObserver(()=>{sn&&(sn.classList.contains("collapsed")||(window.clearTimeout(t),t=window.setTimeout(()=>{(t=>{try{if(!t)return;if(t.classList.contains("collapsed"))return;const e=t.getBoundingClientRect();localStorage.setItem(un,JSON.stringify({width:Math.round(e.width),height:Math.round(e.height)}))}catch(e){}})(sn)},150)))});try{a.observe(sn)}catch(e){}})(),ln}function Kt(e){if(e.target.closest("button")||e.target.closest("input")||e.target.closest("select"))return;if(!ln)return;const t=e.touches?e.touches[0].clientX:e.clientX,a=e.touches?e.touches[0].clientY:e.clientY,o=ln.getBoundingClientRect();fn=t,mn=a,gn=o.left,bn=o.top,hn=!1}function Ot(e){if(0===fn&&0===mn)return;if(!ln)return;const t=(e.touches?e.touches[0].clientX:e.clientX)-fn,a=(e.touches?e.touches[0].clientY:e.clientY)-mn;if(hn||5>=Math.abs(t)&&5>=Math.abs(a)||(hn=!0,ln.classList.add("dragging"),ln.style.position="fixed",ln.style.top=bn+"px",ln.style.left=gn+"px",ln.style.right="auto"),hn){let o=gn+t,n=bn+a;const i=ln.getBoundingClientRect();o=Math.max(0,Math.min(window.innerWidth-i.width,o)),n=Math.max(0,Math.min(window.innerHeight-i.height,n)),ln.style.left=o+"px",ln.style.top=n+"px",e.preventDefault()}}function Rt(){hn&&(hn=!1,ln&&ln.classList.remove("dragging"),zt()),fn=0,mn=0,setTimeout(()=>{},10)}function zt(){try{if(!ln)return;localStorage.setItem(cn,JSON.stringify({left:ln.style.left,top:ln.style.top,custom:!0}))}catch(e){}}function Vt(){if(ln){ln.style.position="",ln.style.left="",ln.style.top="",ln.style.right="";try{localStorage.removeItem(cn)}catch(e){}}}function Et(){if(!ln)try{At()}catch(t){return}const e=ln.classList.toggle("hidden");if(It(e),!e)try{(()=>{if(!ln)return;if(!ln.style.left&&!ln.style.top)return;const e=ln.getBoundingClientRect(),t=window.innerWidth||0,a=window.innerHeight||0;if(!t||!a)return;const o=10;if(o>e.right||e.left>t-o||o>e.bottom||e.top>a-o)return void Vt();const n=(e,t,a)=>t>e?t:e>a?a:e,i=n(e.left,o,Math.max(o,t-e.width-o)),r=n(e.top,o,Math.max(o,a-e.height-o));ln.style.position="fixed",ln.style.left=Math.round(i)+"px",ln.style.top=Math.round(r)+"px",ln.style.right="auto",zt()})()}catch(t){}}function Bt(e){const t=d(),a=ka;if(!a||!a.length)return;const o=a.indexOf(t?.currentMode||Ca.PIT_THROWS),n=a[((0>o?0:o)+e+a.length)%a.length];Ne(n),Tt(n)}function $t(){xn||(vn=document.createElement("div"),vn.id="custom-cursor",vn.setAttribute("aria-hidden","true"),document.body.appendChild(vn),vn.style.display="none",xn=!0,Wt())}function Wt(){if(!vn)return;const e=d();Sn=(e.R_MIN+e.R_MAX)/2*e.cursorSize*2,vn.style.width=Sn+"px",vn.style.height=Sn+"px",vn.style.borderRadius="50%",vn.style.marginLeft="0",vn.style.marginTop="0",wn||(vn.style.transform="translate(-50%, -50%) scale(1)",vn.style.opacity="1")}function _t(e,t){if(!vn)return;const a=wn;wn=((e,t)=>{const a=document.getElementById("bravia-balls");if(!a)return!1;const o=a.getBoundingClientRect();return!(o.left>e||e>o.right||o.top>t||t>o.bottom)})(e,t),vn.style.left=e+"px",vn.style.top=t+"px",document.body.style.cursor="none",wn?(vn.style.display="block",a?(vn.style.opacity="1",vn.style.transform.includes("scale(0.25)")||(vn.style.transform="translate(-50%, -50%) scale(0.25)")):(vn.style.transform="translate(-50%, -50%) scale(1)",vn.style.opacity="1",requestAnimationFrame(()=>{vn.style.transform="translate(-50%, -50%) scale(0.25)",vn.style.opacity="1"}))):(vn.style.display="none",a&&(vn.style.transform="translate(-50%, -50%) scale(1)",vn.style.opacity="1"))}function Gt(){vn&&(vn.style.display="none",document.body.style.cursor="none",wn=!1)}function Nt(){vn&&(wn=!1)}function Ht(){if(!kn)return null;if(Fn&&Fn.isConnected)return Fn;let e=document.getElementById("gate-modal-host");return e||(e=document.createElement("div"),e.id="gate-modal-host",e.className="gate-modal-host",kn.appendChild(e)),Fn=e,Fn}function jt(e){if(!kn||!e)return;const t=Ht();t&&(Dn.has(e)||Dn.set(e,{parent:e.parentNode,nextSibling:e.nextSibling}),t.appendChild(e))}function Zt(e){if(!e)return;const t=Dn.get(e);if(t&&t.parent)try{t.nextSibling&&t.nextSibling.parentNode===t.parent?t.parent.insertBefore(e,t.nextSibling):t.parent.appendChild(e)}catch(a){}}function Yt(){try{const e=getComputedStyle(document.documentElement).getPropertyValue("--wall-thickness").trim();if(e)return parseFloat(e)||12}catch(t){}const e=d();return e?.wallThickness||12}function Xt(){if(!kn)return;const e=Yt();kn.style.setProperty("--gate-overlay-blur",e/2+"px")}function qt(e){if(kn=document.getElementById("gate-overlay"),!kn)return void console.warn("Gate Overlay: #gate-overlay element not found");if(Pn=!1!==e.gateOverlayEnabled,!Pn)return console.log("Gate Overlay: Disabled by config"),void(kn.style.display="none");kn.style.display="",Ht();const t=e.gateOverlayOpacity??.01,a=e.gateOverlayTransitionMs??400,o=e.gateOverlayTransitionOutMs??250,n=e.gateOverlayContentDelayMs??200,i=e.gateDepthTranslateY??8,r=e.logoOpacityInactive??1,l=e.logoOpacityActive??.2,s=e.logoBlurInactive??0,c=e.logoBlurActive??12,d=document.documentElement;d.style.setProperty("--gate-depth-scale",e.gateDepthScale??.96),d.style.setProperty("--gate-depth-translate-y",i+"px"),d.style.setProperty("--gate-depth-duration",a+"ms"),d.style.setProperty("--gate-depth-out-duration",o+"ms"),d.style.setProperty("--gate-content-delay",n+"ms"),d.style.setProperty("--logo-opacity-inactive",r),d.style.setProperty("--logo-opacity-active-target",l),d.style.setProperty("--logo-opacity-active",r),d.style.setProperty("--logo-blur-inactive",s+"px"),d.style.setProperty("--logo-blur-active-target",c+"px"),d.style.setProperty("--logo-blur-active",s+"px"),Xt(),kn.style.setProperty("--gate-overlay-opacity",t),kn.style.setProperty("--gate-overlay-transition-duration",a+"ms"),kn.style.setProperty("--gate-overlay-transition-out-duration",o+"ms"),kn.classList.remove("active"),kn.setAttribute("aria-hidden","true"),kn.addEventListener("click",Ut),window.addEventListener("resize",Xt),document.addEventListener("layout-updated",Xt);const p=Yt()/2;console.log(`Gate Overlay: Initialized (opacity: ${t}, blur: ${p}px [auto from wall thickness], transition: ${a}ms, logo: opacity ${r}→${l}, blur ${s}px→${c}px)`)}function Ut(e){if(e.target.closest("button"))return;if(e.target.closest("input"))return;if(e.target.closest("a"))return;if(e.target.closest("select"))return;if(e.target.closest("textarea"))return;const t="cv-gate"===e.target.id||"portfolio-gate"===e.target.id||"contact-gate"===e.target.id||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description");(e.target===kn||"gate-modal-host"===e.target?.id||t)&&document.dispatchEvent(new CustomEvent("gate-overlay-dismiss",{detail:{instant:!0}}))}function Jt(e){const t=document.documentElement,a=document.getElementById("abs-scene");if(e){const e=getComputedStyle(t).getPropertyValue("--gate-depth-scale").trim()||"0.96",o=getComputedStyle(t).getPropertyValue("--gate-depth-translate-y").trim()||"8px",n=getComputedStyle(t).getPropertyValue("--logo-opacity-active-target").trim()||t.style.getPropertyValue("--logo-opacity-active-target")||"0.2",i=getComputedStyle(t).getPropertyValue("--logo-blur-active-target").trim()||t.style.getPropertyValue("--logo-blur-active-target")||"12px";t.style.setProperty("--gate-depth-scale-active",e),t.style.setProperty("--gate-depth-ty-active",o),t.style.setProperty("--logo-opacity-active",n),t.style.setProperty("--logo-blur-active",i),a&&a.classList.add("gate-depth-active")}else{const e=getComputedStyle(t).getPropertyValue("--logo-opacity-inactive").trim()||"1",o=getComputedStyle(t).getPropertyValue("--logo-blur-inactive").trim()||"0px";t.style.setProperty("--gate-depth-scale-active","1"),t.style.setProperty("--gate-depth-ty-active","0px"),t.style.setProperty("--logo-opacity-active",e),t.style.setProperty("--logo-blur-active",o),a&&a.classList.remove("gate-depth-active")}}function Qt(){if(!kn||!Pn)return;Xt(),kn.setAttribute("aria-hidden","false"),kn.classList.add("active");const e=document.getElementById("custom-cursor");if(e){let a=!1;try{a=!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(t){}a?(e.classList.remove("gate-active"),e.style.display="none"):(e.classList.add("gate-active"),e.style.display="block")}Jt(!0)}function ea(){if(!kn||!Pn)return;kn.classList.remove("active"),kn.setAttribute("aria-hidden","true");const e=document.getElementById("custom-cursor");e&&e.classList.remove("gate-active"),Jt(!1)}function ta(){return!!kn&&kn.classList.contains("active")}function aa(e){const t=+e?.sceneImpactMul,a=Number.isFinite(t)?t:0,o=+e?.sceneImpactMobileMulFactor,n=Number.isFinite(o)&&o>0?o:1;return a*((e=>{if(e?.isMobile||e?.isMobileViewport)return!0;try{return!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(t){return!1}})(e)?n:1)}function oa(){if(!Kn)return;let e=null;try{e=d()}catch(o){}if(!e)return;const t=aa(e);Kn.style.setProperty("--abs-scene-impact-mul",t+"");const a=+e.sceneImpactLogoCompMul;Number.isFinite(a)&&a>0&&Kn.style.setProperty("--abs-scene-impact-logo-comp-mul",a+"")}function na(e,t){const a=aa(t),o=Math.max(0,+e||0)*a,n=1/Math.max(.001,1-o),i=+t?.sceneImpactLogoCompMul;return Math.max(.5,Math.min(4,n*(1+((Number.isFinite(i)&&i>0?i:1)-1)*o)))}function ia(){zn&&(window.clearTimeout(zn),zn=0),Vn&&(window.clearTimeout(Vn),Vn=0)}function ra(e=1,t={}){if(!On||!Kn)return;const a=d();if(!1===a?.sceneImpactEnabled)return;const o=!1!==t?.scheduleRelease,n=Math.max(0,Math.min(1,+e||0)),i=++Rn;ia(),Kn.classList.add("abs-scene--animating"),t?.armManual&&(En=!0);const r=a?.sceneImpactPressMs??75,l=a?.sceneImpactReleaseMs??220,s=Math.max(1,Math.round(.8*(+r||0))),c=Math.max(1,Math.round(1.2*(+l||0)));Kn.style.setProperty(In,Math.round(s)+"ms"),window.requestAnimationFrame(()=>{On&&Kn&&i===Rn&&(Kn.style.setProperty(Ln,n+""),Kn.style.setProperty(An,na(n,a)+""))}),o&&(zn=window.setTimeout(()=>{sa({token:i,releaseMs:c})},0),Vn=window.setTimeout(()=>{Vn=0,Kn&&Kn.classList.remove("abs-scene--animating")},Math.max(0,Math.round(c)+80)))}function la(){if(!On||!Kn)return;const e=d();return!1!==e?.sceneImpactEnabled?sa({token:Rn,releaseMs:Math.max(1,Math.round(1.2*(+(e?.sceneImpactReleaseMs??220)||0)))}):void 0}function sa({token:e,releaseMs:t}){ia(),On&&Kn&&e===Rn&&(Kn.style.setProperty(In,Math.round(t)+"ms"),window.requestAnimationFrame(()=>{On&&Kn&&e===Rn&&(Kn.style.setProperty(Ln,"0"),Kn.style.setProperty(An,"1"))}),Vn=window.setTimeout(()=>{Vn=0,Kn&&Kn.classList.remove("abs-scene--animating")},Math.max(0,Math.round(t)+80)))}function ca(){const e=d(),t=ka,a=t.indexOf(e.currentMode),o=t[((0>a?0:a)+1)%t.length];Promise.resolve().then(()=>To).then(({setMode:e})=>{e(o)}),Promise.resolve().then(()=>on).then(({updateModeButtonsUI:e})=>{e(o)})}function da(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function pa(){try{const e="undefined"!=typeof window?window.__TEXT__:null;return da(e)?e:null}catch(e){return null}}function ua(e,t=""){const a=li||pa();if(!a)return t;if(!e)return t;const o=(e+"").split(".").filter(Boolean);let n=a;for(const i of o){if(!da(n)&&!Array.isArray(n))return t;if(n=n?.[i],null==n)return t}return n}function ha(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.classList.add("page-flash--"+t),setTimeout(()=>{e.classList.remove("page-flash--"+t)},"success"===t?600:300)}function fa(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.classList.add("page-flash--"+t),setTimeout(()=>{e.classList.remove("page-flash--"+t)},"success"===t?600:300)}async function ma(){$().isUnlocked?ga(B()):await O()?ga(!0):(ci&&(ci.innerHTML=si,ci.setAttribute("aria-label","Audio unavailable"),ci.title="Audio unavailable"),setTimeout(()=>{ga(!1)},2e3))}function ga(e){ci&&(ci.setAttribute("data-enabled",e?"true":"false"),ci.setAttribute("aria-pressed",e?"true":"false"),ci.setAttribute("aria-label",e?"Sound on":"Sound off"),ci.title=e?"Sound on":"Sound off",ci.innerHTML=e?'<i class="ti ti-volume-2" aria-hidden="true"></i>':si)}function ba(e){return((e||"")+"").trim().toLowerCase()}function Ma(e,t,a,o=t){const n=+e;if(!Number.isFinite(n))return o;const i=Math.floor(n);return t>i?t:i>a?a:i}function ya(e){const t=d(),a=ba(e),o=Array.isArray(t.colorDistribution)?t.colorDistribution:null;if(!o)return null;for(let n=0;o.length>n;n++){const e=o[n];if(ba(e?.label)===a)return"bg-ball-"+(Ma(e?.colorIndex,0,7,0)+1)}return null}function va(){const e=document.getElementById("expertise-legend");if(!e)return;const t=Array.from(e.querySelectorAll(".legend__item"));for(const a of t){const e=a.querySelector("span"),t=a.querySelector(".circle");if(!e||!t)continue;const o=ya(ba(e.textContent));if(o){for(const e of Array.from(t.classList))(e.startsWith("bg-ball-")||e.startsWith("bg-story-"))&&t.classList.remove(e);t.classList.add(o)}}}function xa(e,t){e&&(e.textContent=(t??"")+"")}function wa(e,t,a){if(e&&null!=a)try{e.setAttribute(t,a+"")}catch(o){}}function Sa(e){const t=document.documentElement;void 0!==e.noiseSizeBase&&t.style.setProperty("--noise-size-base",e.noiseSizeBase+"px"),void 0!==e.noiseSizeTop&&t.style.setProperty("--noise-size-top",e.noiseSizeTop+"px"),void 0!==e.noiseBackOpacity&&(t.style.setProperty("--noise-back-opacity",e.noiseBackOpacity+""),t.style.setProperty("--noise-back-opacity-light",e.noiseBackOpacity+"")),void 0!==e.noiseFrontOpacity&&(t.style.setProperty("--noise-front-opacity",e.noiseFrontOpacity+""),t.style.setProperty("--noise-front-opacity-light",e.noiseFrontOpacity+"")),void 0!==e.noiseBackOpacityDark&&t.style.setProperty("--noise-back-opacity-dark",e.noiseBackOpacityDark+""),void 0!==e.noiseFrontOpacityDark&&t.style.setProperty("--noise-front-opacity-dark",e.noiseFrontOpacityDark+"")}const Ca={PIT:"pit",PIT_THROWS:"pit-throws",FLIES:"flies",WEIGHTLESS:"weightless",WATER:"water",VORTEX:"vortex",PING_PONG:"ping-pong",MAGNETIC:"magnetic",BUBBLES:"bubbles",KALEIDOSCOPE:"kaleidoscope",KALEIDOSCOPE_1:"kaleidoscope-1",KALEIDOSCOPE_2:"kaleidoscope-2",KALEIDOSCOPE_3:"kaleidoscope-3",CRITTERS:"critters",ORBIT_3D:"orbit-3d",ORBIT_3D_2:"orbit-3d-2",NEURAL:"neural",LATTICE:"lattice",PARALLAX_LINEAR:"parallax-linear",PARALLAX_PERSPECTIVE:"parallax-perspective"},ka=[Ca.PIT,Ca.FLIES,Ca.LATTICE,Ca.BUBBLES,Ca.PIT_THROWS,Ca.MAGNETIC,Ca.WATER,Ca.PING_PONG,Ca.NEURAL,Ca.VORTEX,Ca.ORBIT_3D,Ca.WEIGHTLESS,Ca.PARALLAX_LINEAR,Ca.CRITTERS,Ca.ORBIT_3D_2,Ca.PARALLAX_PERSPECTIVE,Ca.KALEIDOSCOPE_1,Ca.KALEIDOSCOPE_2,Ca.KALEIDOSCOPE_3,Ca.KALEIDOSCOPE],Pa={[Ca.PIT]:"SOURCE MATERIAL",[Ca.FLIES]:"IDEA SPARK",[Ca.LATTICE]:"SYSTEM FRAME",[Ca.BUBBLES]:"NOISE SIGNAL",[Ca.PIT_THROWS]:"PROTOTYPE LOOP",[Ca.MAGNETIC]:"DESIGN FORCES",[Ca.WATER]:"USER FLOW",[Ca.PING_PONG]:"FEEDBACK CYCLE",[Ca.NEURAL]:"CONNECTION MAP",[Ca.VORTEX]:"EMERGENT ORDER",[Ca.ORBIT_3D]:"SYSTEM DYNAMICS",[Ca.WEIGHTLESS]:"OPEN SPACE",[Ca.PARALLAX_LINEAR]:"PERSPECTIVE SHIFT",[Ca.CRITTERS]:"BEHAVIOR MODEL",[Ca.ORBIT_3D_2]:"EDGE CASES",[Ca.PARALLAX_PERSPECTIVE]:"CONTEXT FIELD",[Ca.KALEIDOSCOPE_1]:"VOCAB SEED",[Ca.KALEIDOSCOPE_2]:"VOCAB FLOW",[Ca.KALEIDOSCOPE_3]:"VOCAB BLOOM",[Ca.KALEIDOSCOPE]:"VISUAL LANGUAGE"},Fa={DPR:Math.max(1,Math.min(2,window.devicePixelRatio||1)),OFFSCREEN_MOUSE:-1e9,MIN_DISTANCE_EPSILON:1e-6,ACCUMULATOR_RESET_THRESHOLD:3,MAX_PHYSICS_STEPS:4,SPIN_DAMP_PER_S:3,SPIN_GAIN:.25,SPIN_GAIN_TANGENT:.18,ROLL_FRICTION_PER_S:2.5,SQUASH_MAX_BASE:.2,SQUASH_DECAY_PER_S:18,WALL_REST_VEL_THRESHOLD:70,GROUND_COUPLING_PER_S:12,SLEEP_VELOCITY_THRESHOLD:12,SLEEP_ANGULAR_THRESHOLD:.18,TIME_TO_SLEEP:.25,PHYSICS_DT:1/120},Da={rubber:{wallWobbleMaxDeform:45,wallWobbleStiffness:2200,wallWobbleDamping:35,wallWobbleImpactThreshold:140,wallWobbleSettlingSpeed:75,wallWobbleSigma:2,wallWobbleCornerClamp:.6},trampoline:{wallWobbleMaxDeform:55,wallWobbleStiffness:2800,wallWobbleDamping:15,wallWobbleImpactThreshold:100,wallWobbleSettlingSpeed:40,wallWobbleSigma:2.5,wallWobbleCornerClamp:.5},jelly:{wallWobbleMaxDeform:80,wallWobbleStiffness:800,wallWobbleDamping:12,wallWobbleImpactThreshold:80,wallWobbleSettlingSpeed:30,wallWobbleSigma:3.5,wallWobbleCornerClamp:.4},stiff:{wallWobbleMaxDeform:20,wallWobbleStiffness:3e3,wallWobbleDamping:60,wallWobbleImpactThreshold:180,wallWobbleSettlingSpeed:90,wallWobbleSigma:1.5,wallWobbleCornerClamp:.8}},Ta={default:{label:"Default (Full View Grid)",parallaxLinearDotSizeMul:1.8,sizeVariationParallaxLinear:0,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:7,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:50,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:260},dense:{label:"Dense (More Vertices)",parallaxLinearDotSizeMul:1.6,sizeVariationParallaxLinear:.1,parallaxLinearGridX:18,parallaxLinearGridY:13,parallaxLinearGridZ:9,parallaxLinearSpanX:1.25,parallaxLinearSpanY:1.25,parallaxLinearZNear:45,parallaxLinearZFar:1e3,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:240},deep:{label:"Deep Field (Stronger Depth)",parallaxLinearDotSizeMul:1.7,sizeVariationParallaxLinear:.08,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:10,parallaxLinearSpanX:1.45,parallaxLinearSpanY:1.45,parallaxLinearZNear:30,parallaxLinearZFar:1500,parallaxLinearFocalLength:520,parallaxLinearParallaxStrength:320},calm:{label:"Calm (Slow Camera)",parallaxLinearDotSizeMul:1.8,sizeVariationParallaxLinear:.05,parallaxLinearGridX:12,parallaxLinearGridY:9,parallaxLinearGridZ:6,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:60,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:160},minimal:{label:"Minimal (Big Dots)",parallaxLinearDotSizeMul:2.4,sizeVariationParallaxLinear:.15,parallaxLinearGridX:10,parallaxLinearGridY:7,parallaxLinearGridZ:4,parallaxLinearSpanX:1.6,parallaxLinearSpanY:1.6,parallaxLinearZNear:70,parallaxLinearZFar:800,parallaxLinearFocalLength:380,parallaxLinearParallaxStrength:220}},La={default:{label:"Default (Nebula Grid)",parallaxPerspectiveDotSizeMul:1.8,sizeVariationParallaxPerspective:0,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:8,parallaxPerspectiveSpanX:1.45,parallaxPerspectiveSpanY:1.45,parallaxPerspectiveZNear:40,parallaxPerspectiveZFar:1200,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:280,parallaxPerspectiveRandomness:.6},calm:{label:"Calm Mist",parallaxPerspectiveDotSizeMul:1.9,sizeVariationParallaxPerspective:.08,parallaxPerspectiveGridX:14,parallaxPerspectiveGridY:10,parallaxPerspectiveGridZ:6,parallaxPerspectiveSpanX:1.4,parallaxPerspectiveSpanY:1.4,parallaxPerspectiveZNear:60,parallaxPerspectiveZFar:900,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:180,parallaxPerspectiveRandomness:.25},deep:{label:"Deep Space",parallaxPerspectiveDotSizeMul:1.6,sizeVariationParallaxPerspective:.06,parallaxPerspectiveGridX:18,parallaxPerspectiveGridY:13,parallaxPerspectiveGridZ:12,parallaxPerspectiveSpanX:1.55,parallaxPerspectiveSpanY:1.55,parallaxPerspectiveZNear:30,parallaxPerspectiveZFar:2200,parallaxPerspectiveFocalLength:520,parallaxPerspectiveParallaxStrength:340,parallaxPerspectiveRandomness:.55},wild:{label:"Wild Nebula",parallaxPerspectiveDotSizeMul:1.7,sizeVariationParallaxPerspective:.18,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:10,parallaxPerspectiveSpanX:1.6,parallaxPerspectiveSpanY:1.6,parallaxPerspectiveZNear:20,parallaxPerspectiveZFar:1600,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:360,parallaxPerspectiveRandomness:.9},minimal:{label:"Minimal Stars",parallaxPerspectiveDotSizeMul:2.6,sizeVariationParallaxPerspective:.22,parallaxPerspectiveGridX:10,parallaxPerspectiveGridY:7,parallaxPerspectiveGridZ:5,parallaxPerspectiveSpanX:1.75,parallaxPerspectiveSpanY:1.75,parallaxPerspectiveZNear:70,parallaxPerspectiveZFar:1100,parallaxPerspectiveFocalLength:380,parallaxPerspectiveParallaxStrength:220,parallaxPerspectiveRandomness:.35}};let Ia=Math.max(1,Math.min(2,window.devicePixelRatio||1));const Aa={config:{},currentMode:Ca.CRITTERS,warmupFramesRemaining:0,balls:[],canvas:null,ctx:null,container:null,mouseX:Fa.OFFSCREEN_MOUSE,mouseY:Fa.OFFSCREEN_MOUSE,mouseInCanvas:!1,lastPointerMoveMs:0,lastPointerMoveX:Fa.OFFSCREEN_MOUSE,lastPointerMoveY:Fa.OFFSCREEN_MOUSE,GE:1960,G:0,gravityScale:1,gravityMultiplier:0,gravityMultiplierPit:1.1,pitThrowSpeed:650,pitThrowSpeedJitter:.22,pitThrowAngleJitter:.16,pitThrowBatchSize:18,pitThrowIntervalMs:70,pitThrowColorPauseMs:180,pitThrowTargetYFrac:.36,pitThrowInletInset:.06,pitThrowCrossBias:.12,pitThrowSpawnSpread:.02,pitThrowAimJitter:.04,pitThrowPairChance:.35,pitThrowPairStaggerMs:18,pitThrowSpeedVar:.18,pitThrowSpreadVar:.25,REST:.69,FRICTION:.006,ballMassKg:129,MASS_BASELINE_KG:129,MASS_REST_EXP:.15,MASS_GRAVITY_EXP:.35,get DPR(){return Ia},sizeScale:1.2,sizeVariationGlobalMul:1,sizeVariationCap:.12,sizeVariationPit:0,sizeVariationPitThrows:0,sizeVariationFlies:0,sizeVariationWeightless:0,sizeVariationWater:0,sizeVariationVortex:.2,sizeVariationPingPong:0,sizeVariationMagnetic:0,sizeVariationBubbles:.2,sizeVariationKaleidoscope:0,sizeVariationOrbit3d:0,sizeVariationCritters:.2,sizeVariationNeural:0,sizeVariationLattice:0,sizeVariationParallaxLinear:0,sizeVariationParallaxPerspective:0,pitWarmupFrames:10,pitThrowsWarmupFrames:10,fliesWarmupFrames:10,weightlessWarmupFrames:10,waterWarmupFrames:10,vortexWarmupFrames:10,pingPongWarmupFrames:10,magneticWarmupFrames:10,bubblesWarmupFrames:10,kaleidoscopeWarmupFrames:10,kaleidoscope1WarmupFrames:10,kaleidoscope2WarmupFrames:10,kaleidoscope3WarmupFrames:10,orbit3dWarmupFrames:10,orbit3d2WarmupFrames:10,crittersWarmupFrames:10,neuralWarmupFrames:10,latticeWarmupFrames:10,parallaxLinearWarmupFrames:10,parallaxPerspectiveWarmupFrames:10,sizeVariation:0,responsiveScale:1,responsiveScaleMobile:.75,isMobile:!1,isMobileViewport:!1,mobileObjectReductionFactor:.7,R_MIN_BASE:6,R_MAX_BASE:24,R_MED:0,R_MIN:0,R_MAX:0,cursorSize:1,cursorColorMode:"auto",cursorColorIndex:5,cursorColorHex:"#ff4013",cursorColorLumaMax:.62,cursorColorAllowIndices:[],cursorColorDenyIndices:[],mouseTrailEnabled:!0,mouseTrailLength:18,mouseTrailSize:1.3,mouseTrailFadeMs:220,mouseTrailOpacity:.35,ballSoftness:20,ballSpacing:.08,sleepVelocityThreshold:12,sleepAngularThreshold:.18,timeToSleep:.25,critterCount:90,critterSpeed:680,critterMaxSpeed:1400,critterStepHz:5,critterStepSharpness:2.4,critterTurnNoise:2.2,critterTurnDamp:10,critterTurnSeek:10,critterAvoidRadius:90,critterAvoidForce:9500,critterEdgeAvoid:1,critterMousePull:1,critterMouseRadiusVw:30,critterRestitution:.18,critterFriction:.018,cornerRadius:42,layoutViewportWidthPx:0,containerBorderVw:0,simulationPaddingVw:0,contentPaddingVw:0,contentPaddingHorizontalRatio:1,mobileWallThicknessXFactor:1.4,mobileEdgeLabelsVisible:!0,wallRadiusVw:0,wallThicknessVw:0,noiseBackOpacity:.025,noiseFrontOpacity:.055,noiseBackOpacityDark:.12,noiseFrontOpacityDark:.08,layoutMinContentPaddingPx:16,layoutMinWallRadiusPx:28,wallInset:3,vortexSwirlStrength:420,vortexRadialPull:180,vortexBallCount:180,vortexSpeedMultiplier:1,vortexRadius:0,vortexFalloffCurve:1,vortexRotationDirection:1,vortexCoreStrength:1,vortexAccelerationZone:0,vortexOutwardPush:0,vortexFalloffRate:.0015,magneticBallCount:180,magneticStrength:65e3,magneticMaxVelocity:2800,magneticExplosionInterval:5,bubblesSpawnRate:8,bubblesRiseSpeed:150,bubblesWobble:40,bubblesMaxCount:200,bubblesDeflectRadius:0,pingPongBallCount:35,pingPongSpeed:800,pingPongCursorRadius:0,currentColors:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],currentTemplate:"industrialTeal",colorDistribution:[{label:"AI Integration",colorIndex:0,weight:30},{label:"UI/UX Design",colorIndex:4,weight:18},{label:"Creative Strategy",colorIndex:3,weight:15},{label:"Frontend Development",colorIndex:2,weight:12},{label:"Brand Identity",colorIndex:5,weight:10},{label:"3D Design",colorIndex:6,weight:10},{label:"Art Direction",colorIndex:7,weight:5}],fliesBallCount:60,attractionPower:5e3,orbitRadius:180,swarmSpeed:.4,fliesSeparation:15e3,weightlessCount:80,weightlessInitialSpeed:250,weightlessBounce:.97,weightlessRepelRadius:220,weightlessRepelPower:22e4,weightlessRepelSoft:2.2,kaleidoscopeBallCount:23,kaleidoscopeWedges:12,kaleidoscopeMirror:1,kaleidoscopeSpeed:1,kaleidoscopeDotSizeVh:.95,kaleidoscopeDotAreaMul:.7,kaleidoscopeSpawnAreaMul:1,kaleidoscopeSizeVariance:.3,kaleidoscope1BallCount:18,kaleidoscope1Wedges:8,kaleidoscope1Speed:.8,kaleidoscope1DotSizeVh:.95,kaleidoscope1DotAreaMul:.7,kaleidoscope1SpawnAreaMul:1,kaleidoscope1SizeVariance:.3,kaleidoscope2BallCount:36,kaleidoscope2Wedges:8,kaleidoscope2Speed:1.15,kaleidoscope2DotSizeVh:.95,kaleidoscope2DotAreaMul:.7,kaleidoscope2SpawnAreaMul:1,kaleidoscope2SizeVariance:.3,kaleidoscope3BallCount:54,kaleidoscope3Wedges:8,kaleidoscope3Speed:1.55,kaleidoscope3DotSizeVh:.95,kaleidoscope3DotAreaMul:.7,kaleidoscope3SpawnAreaMul:1,kaleidoscope3SizeVariance:.3,orbit3dPreset:"serene",orbit3dMoonCount:80,orbit3dGravity:5e3,orbit3dMoonMass:1,orbit3dVelocityMult:150,orbit3dTargetOrbit:12,orbit3dMinOrbit:3,orbit3dMaxOrbit:3,orbit3dDepthScale:.8,orbit3dDamping:.02,orbit3d2MoonCount:60,orbit3d2Gravity:3e3,orbit3d2VelocityMult:200,orbit3d2MinOrbit:5,orbit3d2MaxOrbit:30,orbit3d2DepthScale:.5,orbit3d2Damping:.98,orbit3d2MoonMass:1,orbit3d2MaxSpeed:800,neuralBallCount:80,neuralLinkDistanceVw:14,neuralLineOpacity:.22,neuralWanderStrength:420,neuralMaxLinksPerBall:4,neuralDamping:.985,latticeBallCount:90,latticeSpacingVw:8.5,latticeStiffness:2.2,latticeDamping:.92,latticeDisruptRadius:600,latticeDisruptPower:25,latticeMeshWaveStrength:12,latticeMeshWaveSpeed:.8,latticeAlignment:"center",parallaxLinearDotCount:95,parallaxLinearRowPattern:"thirds",parallaxLinearSpacingPattern:"even",parallaxLinearFarPct:.42,parallaxLinearMidPct:.32,parallaxLinearFarSpeed:.15,parallaxLinearMidSpeed:.5,parallaxLinearNearSpeed:1,parallaxLinearFollowStrength:16,parallaxLinearDamping:12,parallaxPerspectiveDotCount:240,parallaxPerspectiveDepthMul:1.6,parallaxPerspectiveFocalLength:400,parallaxPerspectiveFollowStrength:16,parallaxPerspectiveDamping:12,parallaxPerspectiveZ1:1200,parallaxPerspectiveZ2:700,parallaxPerspectiveZ3:350,parallaxPerspectiveZ4:120,parallaxPerspectiveZ5:35,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:7,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:50,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:260,parallaxLinearDotSizeMul:1.8,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:8,parallaxPerspectiveSpanX:1.45,parallaxPerspectiveSpanY:1.45,parallaxPerspectiveZNear:40,parallaxPerspectiveZFar:1200,parallaxPerspectiveParallaxStrength:280,parallaxPerspectiveRandomness:.6,parallaxPerspectiveDotSizeMul:1.8,waterBallCount:300,waterDrag:.015,waterRippleSpeed:300,waterRippleStrength:18e3,waterDriftStrength:40,waterInitialVelocity:200,vortexDrag:.005,pingPongVerticalDamp:.995,magneticDamping:.98,repelRadius:120,repelPower:274e3,repelSoft:3.4,repellerEnabled:!1,cursorInfluenceRadiusVw:14,cursorInfluenceRadiusPx:140,emitterTimer:0,autoDarkModeEnabled:!0,isDarkMode:!1,chromeHarmonyMode:"site",autoDarkNightStartHour:18,autoDarkNightEndHour:6,clickCycleEnabled:!0,sceneImpactEnabled:!0,sceneImpactMul:.01,sceneImpactMobileMulFactor:1,sceneImpactLogoCompMul:3.6,sceneImpactOvershoot:.22,sceneImpactAnticipation:0,sceneImpactPressMs:90,sceneImpactReleaseMs:310,sceneChangeSoundEnabled:!0,sceneChangeSoundIntensity:.35,sceneChangeSoundRadius:18,brandLogoImpactMul:.014,brandLogoSquashMul:1,brandLogoOvershoot:.22,brandLogoAnticipation:0,brandLogoTiltDeg:0,brandLogoSkewDeg:0,brandLogoPressMs:75,brandLogoHoldMs:55,brandLogoReleaseMs:220,containerBorder:20,containerBorderX:20,simulationPadding:0,contentPadding:40,contentPaddingX:40,contentPaddingY:40,bgLight:"#f5f5f5",bgDark:"#0a0a0a",frameColor:"#0a0a0a",textColorLight:"#161616",textColorLightMuted:"#2f2f2f",textColorDark:"rgba(255,255,255,0.7)",textColorDarkMuted:"rgba(255,255,255,0.5)",edgeLabelColorLight:"#2f2f2f",edgeLabelColorDark:"#b3b3b3",edgeLabelInsetAdjustPx:0,linkHoverColor:"#ff4013",logoColorLight:"#161616",logoColorDark:"#d5d5d5",wallThickness:12,wallRadius:42,wallInset:3,wallPreset:"rubber",wallSoftness:50,wallBounciness:50,wallWobbleMaxDeform:45,wallWobbleStiffness:2200,wallWobbleDamping:35,wallWobbleSigma:2,wallWobbleCornerClamp:.6,wallWobbleImpactThreshold:140,wallWobbleSettlingSpeed:75,gateOverlayEnabled:!0,gateOverlayOpacity:.01,gateOverlayBlurPx:16,gateOverlayTransitionMs:800,gateOverlayTransitionOutMs:600,gateOverlayContentDelayMs:200,gateDepthScale:.96,gateDepthTranslateY:8,logoOpacityInactive:1,logoOpacityActive:.2,logoBlurInactive:0,logoBlurActive:12,getSquashMax(){return 0===this.ballSoftness?0:Fa.SQUASH_MAX_BASE*(this.ballSoftness/40)},getCanvasCornerRadius(){return Math.max(0,this.cornerRadius-this.simulationPadding)}};var Ka=Object.freeze({__proto__:null,applyLayoutCSSVars:s,applyLayoutFromVwToPx:l,clearBalls:f,detectResponsiveScale:m,getBalls:()=>Aa.balls,getConfig:()=>Aa.config,getEffectiveDPR:()=>Ia,getGlobals:d,getLayoutViewportWidthPx:n,getMobileAdjustedCount:p,getState:()=>Aa,initState:c,pxToVw:i,setCanvas:u,setEffectiveDPR:t,setMode:h,updateBallSizes:g,vwToPx:r});const Oa={industrialTeal:{label:"Industrial Teal",light:["#b7bcb7","#d0d0d0","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#6b726b","#3d453d","#8a928a","#00e6c3","#d5d5d5","#ff6b47","#5b9aff","#ffb84d"]},sunsetCoral:{label:"Sunset Coral",light:["#bdbbb8","#e8e6e3","#ffffff","#ff3b3b","#000000","#00f5d4","#1e40af","#fb923c"],dark:["#716f6b","#3f3d3a","#8e8c88","#ff6b6b","#d8d8d8","#00ffe7","#6ba3ff","#ffb570"]},violetPunch:{label:"Violet Punch",light:["#b8b7c2","#e6e5ed","#ffffff","#9333ea","#000000","#dc2626","#0ea5e9","#facc15"],dark:["#6d6c7a","#3a3845","#8b8a98","#c266ff","#dad6e8","#ff5c5c","#42d4ff","#fff066"]},citrusBlast:{label:"Citrus Blast",light:["#bfbdb5","#eae8df","#ffffff","#ea580c","#000000","#e11d48","#2563eb","#059669"],dark:["#74726a","#403e38","#918f87","#ff8c4d","#dbd9d1","#ff5c7a","#6ba3ff","#00d699"]},cobaltSpark:{label:"Cobalt Spark",light:["#b5b8be","#e3e6eb","#ffffff","#1d4ed8","#000000","#ea580c","#db2777","#d97706"],dark:["#696d75","#3a3e45","#878b93","#6b9dff","#d6dae2","#ff8c5c","#ff66b3","#ffc266"]}},Ra=[.5,.25,.12,.06,.03,.02,.01,.01],za=[3,5,6,7];var Va=Object.freeze({__proto__:null,COLOR_TEMPLATES:Oa,applyColorTemplate:T,applyCursorColorIndex:k,getCurrentPalette:F,getCursorCandidateIndices:C,maybeAutoPickCursorColor:P,pickRandomColor:D,populateColorSelect:L});const Ea={attackTime:.005,decayTime:.075,harmonicGain:0,filterBaseFreq:580,filterVelocityRange:400,filterQ:.18,filterMinHz:350,filterMaxHz:2800,pitchMinHz:145,pitchMaxHz:280,pitchCurve:1,reverbDecay:.14,reverbWetMix:.08,reverbHighDamp:.8,minGain:.008,maxGain:.09,masterGain:.28,voiceGainMax:.14,minTimeBetweenSounds:.012,maxPan:.15,noiseTransientEnabled:!0,noiseTransientGain:.045,noiseTransientDecay:.008,noiseTransientFilterMin:500,noiseTransientFilterMax:1800,noiseTransientQ:1.2,sparkleGain:0,sparkleRatioMin:2.3,sparkleRatioMax:4.1,sparkleDecayMul:.65,variancePitch:.06,varianceDecay:.2,varianceGain:.15,varianceFilter:.18,varianceNoise:.25,velocityNoiseScale:1.8,velocityBrightnessScale:1.4,velocityDecayScale:.65,intensityExponent:1.5,toneSafetyMinHz:130,toneSafetyMaxHz:480,toneSafetyExponent:2.2,toneSafetyHighGainAtten:.25,toneSafetyLowGainAtten:.06,toneSafetyHighBrightAtten:.45,collisionMinImpact:.58,highShelfFreq:2200,highShelfGain:-6};let Ba=null;const $a={organicImpact:{label:"Organic Impact",description:"Warm, natural thuds with intensity dynamics",...Ea},glassMarbles:{label:"Glass Marbles",description:"Clear, glassy impacts with more presence",...Ea,pitchMinHz:260,pitchMaxHz:780,pitchCurve:1.05,filterBaseFreq:850,filterVelocityRange:600,noiseTransientGain:.065,noiseTransientFilterMin:650,noiseTransientFilterMax:2200,noiseTransientQ:1.6,decayTime:.055,intensityExponent:1.3,highShelfGain:-4.5},crystalPebbles:{label:"Crystal Pebbles ★",description:"Crisp, close, soothing micro-chimes (non-repetitive)",...Ea,pitchMinHz:420,pitchMaxHz:1600,pitchCurve:1.15,filterBaseFreq:1300,filterVelocityRange:1700,filterQ:.22,filterMaxHz:6200,decayTime:.04,intensityExponent:1.65,collisionMinImpact:.7,minTimeBetweenSounds:.018,noiseTransientGain:.02,noiseTransientDecay:.006,noiseTransientFilterMin:1200,noiseTransientFilterMax:7e3,noiseTransientQ:2.8,sparkleGain:.12,sparkleRatioMin:2.6,sparkleRatioMax:4.4,sparkleDecayMul:.55,reverbWetMix:.04,reverbDecay:.1,highShelfGain:-4,masterGain:.24},woodenBeads:{label:"Wooden Beads ★",description:"Ultra-soft, muted thuds (recommended)",...Ea,filterBaseFreq:420,filterVelocityRange:200,noiseTransientGain:.025,noiseTransientFilterMin:380,noiseTransientFilterMax:1400,noiseTransientQ:1.1,decayTime:.095,intensityExponent:1.7,collisionMinImpact:.62,highShelfGain:-7.5,reverbWetMix:.12},rubberBalls:{label:"Rubber Balls",description:"Bouncy, playful with longer decay",...Ea,pitchMinHz:160,pitchMaxHz:360,filterBaseFreq:520,filterVelocityRange:350,noiseTransientGain:.035,noiseTransientFilterMin:450,noiseTransientFilterMax:1600,noiseTransientQ:1.2,decayTime:.12,intensityExponent:1.4,reverbWetMix:.14,highShelfGain:-5},metallicClick:{label:"Metallic Click",description:"Crisp, percussive impacts",...Ea,pitchMinHz:220,pitchMaxHz:620,pitchCurve:1.1,filterBaseFreq:720,filterVelocityRange:550,noiseTransientGain:.08,noiseTransientFilterMin:700,noiseTransientFilterMax:2400,noiseTransientQ:1.8,noiseTransientDecay:.006,decayTime:.045,intensityExponent:1.2,highShelfGain:-3.5,collisionMinImpact:.5}};let Wa="crystalPebbles";Ba={...$a[Wa]},delete Ba.label,delete Ba.description;let _a=null,Ga=null,Na=null,Ha=null,ja=null,Za=null,Ya=null,Xa=null,qa=null,Ua=!1,Ja=!1;const Qa="bravia-balls:sound-state",eo=8;let to=[],ao=0,oo=new Map,no=!1,io=null,ro=!1;const lo=new Map,so=12;class co{constructor(){this.deformations=new Float32Array(so),this.velocities=new Float32Array(so),this.pressure=new Float32Array(so)}impact(e,t){const a=d(),o=Math.max(0,Math.min(.45,a.wallWobbleCornerClamp??.1)),n=11*Math.max(o,Math.min(1-o,e)),i=(a.wallWobbleMaxDeform??45)*t,r=Math.max(.25,a.wallWobbleSigma??2);for(let l=1;11>l;l++){const e=Math.abs(l-n);this.velocities[l]+=i*Math.exp(-e*e/(2*r*r))*Math.min(1,Math.min(l,11-l)/2)}}addPressure(e,t){const a=11*Math.max(.1,Math.min(.9,e)),o=Math.max(1,Math.floor(a-2)),n=Math.min(10,Math.ceil(a+2));for(let i=o;n>=i;i++)this.pressure[i]=Math.min(1,this.pressure[i]+t*Math.max(0,1-Math.abs(i-a)/3))}clearPressure(){this.pressure.fill(0)}step(e){const t=d(),a=Math.max(1,t.wallWobbleStiffness??2200),o=Math.max(0,t.wallWobbleDamping??35),n=Math.max(0,t.wallWobbleMaxDeform??45),i=Math.max(0,Math.min(100,t.wallWobbleSettlingSpeed??50))/100,r=2*Math.sqrt(a),l=5+30*i;this.deformations[0]=0,this.deformations[11]=0,this.velocities[0]=0,this.velocities[11]=0,this.pressure[0]=0,this.pressure[11]=0;const s=.5+1.5*i;for(let c=1;11>c;c++){const t=Math.abs(this.velocities[c]),i=Math.abs(this.deformations[c]);this.velocities[c]+=(-a*this.deformations[c]-Math.min(o*(1+1*Math.max(0,Math.min(1,1-i/20)))*(1+this.pressure[c]*l),.95*r)*this.velocities[c])*e,this.deformations[c]+=this.velocities[c]*e,this.deformations[c]=Math.max(0,Math.min(n,this.deformations[c])),(this.pressure[c]>.5?.3:this.pressure[c]>.1?.8:2)*s>i&&(this.pressure[c]>.5?.5:this.pressure[c]>.1?3:10)*s>t&&(this.deformations[c]=0,this.velocities[c]=0)}}getDeformAt(e){const t=11*Math.max(0,Math.min(1,e)),a=Math.floor(t),o=t-a,n=o*o*(3-2*o);return this.deformations[a]*(1-n)+this.deformations[Math.min(a+1,11)]*n}getMaxDeformation(){let e=0;for(let t=0;so>t;t++)this.deformations[t]>e&&(e=this.deformations[t]);return e}hasDeformation(){return this.getMaxDeformation()>2}reset(){this.deformations.fill(0),this.velocities.fill(0),this.pressure.fill(0)}}const po={top:new co,bottom:new co,left:new co,right:new co,clearAllPressure(){this.top.clearPressure(),this.bottom.clearPressure(),this.left.clearPressure(),this.right.clearPressure()},step(e){this.top.step(e),this.bottom.step(e),this.left.step(e),this.right.step(e)},reset(){this.top.reset(),this.bottom.reset(),this.left.reset(),this.right.reset()},hasAnyDeformation(){return this.top.hasDeformation()||this.bottom.hasDeformation()||this.left.hasDeformation()||this.right.hasDeformation()}};let uo=0;class ho{constructor(e,t,a,o){const n=d();this.x=e,this.y=t,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=a,this.rBase=a,this.m=n.ballMassKg,this.color=o,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1,this.isSleeping=!1,this.sleepTimer=0,this.isGrounded=!1,this.hasSupport=!1,this.W="ball-"+uo++}step(e,t){const a=d(),{currentMode:o,G:n,gravityScale:i,FRICTION:r,MASS_BASELINE_KG:l}=a;if(this.t+=e,this.age+=e,this.isSleeping&&(o===Ca.PIT||o===Ca.PIT_THROWS)){const e=(a.repelRadius||710)*a.DPR*1.2,t=this.x-a.mouseX,o=this.y-a.mouseY;e*e>t*t+o*o&&this.wake()}if(this.isSleeping)return;const s=a.DPR||1,c=this.isGrounded,p=this.hasSupport;this.isGrounded=!1,this.hasSupport=!1,o!==Ca.WEIGHTLESS&&(!c&&!p||-8*s>this.vy)&&(this.vy+=n*i*e);const u=Math.max(.25,this.m/l),h=Math.max(0,1-(o===Ca.WEIGHTLESS||o===Ca.ORBIT_3D||o===Ca.ORBIT_3D_2?0:r)*(1+1*Math.max(0,Math.min(1,1-Math.sqrt(this.vx*this.vx+this.vy*this.vy)/(100*s))))/u);if(this.vx*=h,this.vy*=h,o!==Ca.ORBIT_3D&&o!==Ca.ORBIT_3D_2){const e=2*s;e>Math.abs(this.vx)&&(this.vx=0),e>Math.abs(this.vy)&&o===Ca.WEIGHTLESS&&(this.vy=0)}0!==this.driftAx&&this.driftTime>this.age?this.vx+=this.driftAx*e/u:0!==this.driftAx&&(this.driftAx=0),t&&t(this,e),this.x+=this.vx*e,this.y+=this.vy*e,this.omega*=Math.max(0,1-Fa.SPIN_DAMP_PER_S*(1+.5*Math.max(0,Math.min(1,1-Math.abs(this.omega)/2)))*e),this.theta+=this.omega*e,.01>Math.abs(this.omega)&&(this.omega=0),this.squashAmount+=(0-this.squashAmount)*Math.min(1,Fa.SQUASH_DECAY_PER_S*e),this.squash=1-this.squashAmount}updateSleepState(e,t){const a=Math.sqrt(this.vx*this.vx+this.vy*this.vy),o=Math.abs(this.omega),n=t.DPR||1,i=(Number.isFinite(t.sleepVelocityThreshold)?t.sleepVelocityThreshold:Fa.SLEEP_VELOCITY_THRESHOLD)*n,r=Number.isFinite(t.sleepAngularThreshold)?t.sleepAngularThreshold:Fa.SLEEP_ANGULAR_THRESHOLD,l=Number.isFinite(t.timeToSleep)?t.timeToSleep:Fa.TIME_TO_SLEEP;(this.isGrounded||this.hasSupport)&&i>a&&r>o?(this.sleepTimer+=e,l>this.sleepTimer||(this.vx=0,this.vy=0,this.omega=0,this.isSleeping=!0)):this.sleepTimer=0}wake(){this.isSleeping=!1,this.sleepTimer=0}walls(e,t,a,o,n={}){const i=!1!==n.registerEffects,r=d(),{REST:l,MASS_BASELINE_KG:s,MASS_REST_EXP:c,currentMode:p,DPR:u}=r,h=void 0!==o?o:l,f=r.wallWobbleImpactThreshold??Fa.WALL_REST_VEL_THRESHOLD,m=this.r*(1+(r.ballSpacing||0)),g="function"==typeof r.getCanvasCornerRadius?r.getCanvasCornerRadius():r.cornerRadius??r.wallRadius??42,b=Math.max(0,g)*(u||1),M=Math.max(0,r.wallInset??3)*(u||1),y=Math.max(0,b-M);let v=!1;const x=[{cx:b,cy:b},{cx:e-b,cy:b},{cx:b,cy:t-b},{cx:e-b,cy:t-b}];for(let d=0;x.length>d;d++){if((p===Ca.PIT||p===Ca.PIT_THROWS)&&2>d)continue;const a=x[d];if((d%2==0?b>this.x:this.x>e-b)&&(2>d?b>this.y:this.y>t-b)){const e=this.x-a.cx,t=this.y-a.cy,o=Math.sqrt(e*e+t*t),n=y-m;if(o>n&&n>0){v=!0;const a=o-n,i=e/o,r=t/o;this.x-=i*a,this.y-=r*a;const l=this.vx*i+this.vy*r;l>0&&(this.vx-=(1+h)*l*i,this.vy-=(1+h)*l*r)}}}const w=M,S=e-M,C=M,k=t-M;if(this.y+m>k){v=!0,this.isGrounded=!0,this.y=k-m;const t=this.vy,o=this.vx-this.omega*this.r,n=Math.max(.25,this.m/s);this.omega+=o/this.r*Fa.SPIN_GAIN/n,this.vx*=Math.max(0,1-Fa.ROLL_FRICTION_PER_S*(1+1*Math.max(0,Math.min(1,1-Math.abs(this.vx)/(80*u))))*a/n),3*u>Math.abs(this.vx)&&(this.vx=0),this.vy=(f>Math.abs(t)?0:h)*Math.pow(s/this.m,c)*-this.vy;const l=Math.min(1,Math.abs(t)/(90*this.r));if(this.squashAmount=Math.min(r.getSquashMax(),.8*l),this.squashNormalAngle=-Math.PI/2,this.omega+=(this.vx/this.r-this.omega)*Math.min(1,Fa.GROUND_COUPLING_PER_S*a),.05>Math.abs(this.omega)&&(this.omega=0),i){R(this.r,.7*l,this.x/e,this.W),this.isSleeping||0>=t||f>t||Z("bottom",this.x/e,l);const a=this.isSleeping?1:Math.min(1,(f-Math.abs(t))/f);a>.1&&Y("bottom",this.x/e,a)}}if(p!==Ca.PIT&&p!==Ca.PIT_THROWS&&C>this.y-m){v=!0,this.y=C+m;const t=this.vy;this.vy=-this.vy*h;const a=Math.min(1,Math.abs(t)/(90*this.r));if(this.squashAmount=Math.min(r.getSquashMax(),.8*a),this.squashNormalAngle=Math.PI/2,i){R(this.r,.7*a,this.x/e,this.W),this.isSleeping||t>=0||f>Math.abs(t)||Z("top",this.x/e,a);const o=this.isSleeping?1:Math.min(1,(f-Math.abs(t))/f);o>.1&&Y("top",this.x/e,o)}}if(this.x+m>S){v=!0,this.x=S-m;const e=this.vx;this.omega+=(this.vy-this.omega*this.r)/this.r*.5*Fa.SPIN_GAIN/Math.max(.25,this.m/s),this.vx=l*Math.pow(s/this.m,c)*-this.vx;const a=Math.min(1,Math.abs(e)/(70*this.r));if(this.squashAmount=Math.min(r.getSquashMax(),.8*a),this.squashNormalAngle=Math.PI,i){R(this.r,.6*a,1,this.W),this.isSleeping||0>=e||f>e||Z("right",this.y/t,a);const o=this.isSleeping?1:Math.min(1,(f-Math.abs(e))/f);o>.1&&Y("right",this.y/t,o)}}if(w>this.x-m){v=!0,this.x=w+m;const e=this.vx;this.omega+=(this.vy-this.omega*this.r)/this.r*.5*Fa.SPIN_GAIN/Math.max(.25,this.m/s),this.vx=l*Math.pow(s/this.m,c)*-this.vx;const a=Math.min(1,Math.abs(e)/(70*this.r));if(this.squashAmount=Math.min(r.getSquashMax(),.8*a),this.squashNormalAngle=0,i){R(this.r,.6*a,0,this.W),this.isSleeping||e>=0||f>Math.abs(e)||Z("left",this.y/t,a);const o=this.isSleeping?1:Math.min(1,(f-Math.abs(e))/f);o>.1&&Y("left",this.y/t,o)}}v&&this.isSleeping&&this.wake()}draw(e){const t=this.squashAmount>.001,a=1>this.alpha;t||a?(e.save(),e.translate(this.x,this.y),t?(e.rotate(this.theta+this.squashNormalAngle),e.scale(1-.3*this.squashAmount,1+.3*this.squashAmount),e.rotate(-this.squashNormalAngle)):e.rotate(this.theta),a&&(e.globalAlpha=this.alpha),e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI),e.fillStyle=this.color,e.fill(),e.restore()):(e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.r,0,2*Math.PI),e.fill())}}const fo=[];let mo,go,bo=Fa.DPR,Mo=0,yo=0,vo=null,xo=null,wo=0,So=0,Co=0;const ko=2*Math.PI,Po=1e-6;let Fo=0,Do=0;var To=Object.freeze({__proto__:null,MODES:Ca,getForceApplicator:je,getModeRenderer:Ye,getModeUpdater:Ze,resetCurrentMode:He,setMode:Ne});let Lo=0,Io=null,Ao=null,Ko=null,Oo=0,Ro=0;const zo=Fa.PHYSICS_DT;let Vo=0;const Eo=42,Bo=1/60,$o=(()=>{try{return{log:console.log?.bind(console)??(()=>{}),info:console.info?.bind(console)??(()=>{}),warn:console.warn?.bind(console)??(()=>{}),error:console.error?.bind(console)??(()=>{}),debug:console.debug?.bind(console)??(()=>{}),groupCollapsed:console.groupCollapsed?.bind(console)??(()=>{}),groupEnd:console.groupEnd?.bind(console)??(()=>{}),table:console.table?.bind(console)??(()=>{})}}catch(e){return{log(){},info(){},warn(){},error(){},debug(){},groupCollapsed(){},groupEnd(){},table(){}}}})();let Wo=null,_o=0,Go="undefined"!=typeof performance&&performance.now?performance.now():Date.now(),No=!1;const Ho=["#b7bcb7","#d0d0d0","#ffffff","#00695c","#1a1a1a","#ff4013","#0d5cb6","#ffa000"],jo=[.5,.25,.12,.06,.03,.02,.01,.01];let Zo=null,Yo=null,Xo="auto",qo="light",Uo=!1;var Jo=Object.freeze({__proto__:null,getCurrentTheme:()=>Xo,initializeDarkMode:ht,setTheme:ut,toggleDarkMode:ft});let Qo=null,en={};(()=>{try{const e=localStorage.getItem("panel_control_visibility");e&&(en=JSON.parse(e))}catch(e){en={}}})();const tn={environment:{title:"Browser",icon:"🧭",defaultOpen:!1,controls:[{id:"chromeHarmonyMode",label:"Chrome Harmony",stateKey:"chromeHarmonyMode",type:"select",options:[{value:"auto",label:"Auto (adapt only when needed)"},{value:"site",label:"Site (benchmark)"},{value:"browser",label:"Browser (force adapt)"}],default:"site",format:e=>e+"",parse:e=>e+"",hint:"If desktop browsers ignore theme-color, the wall adapts to match the browser UI palette.",onChange(){Promise.resolve().then(()=>Jo).then(({getCurrentTheme:e,setTheme:t})=>{t(e())}).catch(()=>{})}},{id:"autoDarkModeEnabled",label:"Auto Dark (Night)",stateKey:"autoDarkModeEnabled",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,hint:"In Auto theme, prefer Dark during the night window (privacy-first: local clock only).",onChange(){Promise.resolve().then(()=>Jo).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}},{id:"autoDarkNightStartHour",label:"Night Starts",stateKey:"autoDarkNightStartHour",type:"range",min:0,max:23,step:1,default:18,format:e=>Math.round(e)+":00",parse:e=>parseInt(e,10),onChange(){Promise.resolve().then(()=>Jo).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}},{id:"autoDarkNightEndHour",label:"Night Ends",stateKey:"autoDarkNightEndHour",type:"range",min:0,max:23,step:1,default:6,format:e=>Math.round(e)+":00",parse:e=>parseInt(e,10),onChange(){Promise.resolve().then(()=>Jo).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}}]},balls:{title:"Balls",icon:"🎱",defaultOpen:!1,controls:[{id:"sizeGlobal",label:"Size",stateKey:"sizeScale",type:"range",min:.1,max:6,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat,onChange(e){Promise.resolve().then(()=>Ka).then(({updateBallSizes:t})=>{t();const a=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=a,e.rBase=a})}),Promise.resolve().then(()=>Cn).then(({updateCursorSize:e})=>{e()})}},{id:"responsiveScaleMobile",label:"Mobile Scale",stateKey:"responsiveScaleMobile",type:"range",min:.5,max:1.5,step:.05,default:.75,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Ball size multiplier for iPad/iPhone (requires reload)",onChange(e){Promise.resolve().then(()=>Ka).then(({detectResponsiveScale:t})=>{t();const a=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=a,e.rBase=a})})}},{id:"mobileObjectReductionFactor",label:"Mobile Density",stateKey:"mobileObjectReductionFactor",type:"range",min:0,max:1,step:.05,default:.7,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Scales object counts on mobile (0% = none). Resets the current mode.",onChange(e){Promise.resolve().then(()=>To).then(({setMode:t})=>{t(e.currentMode)}).catch(()=>{})}},{id:"ballSoftnessGlobal",label:"Softness",stateKey:"ballSoftness",type:"range",min:0,max:100,step:1,default:20,format:e=>e+"",parse:e=>parseInt(e,10)},{id:"ballSpacing",label:"Spacing",stateKey:"ballSpacing",type:"range",min:0,max:.5,step:.01,default:.08,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Collision gap as % of ball radius (affects physics)"},{id:"sizeVariationGlobalMul",label:"Variation Scale",stateKey:"sizeVariationGlobalMul",type:"range",min:0,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Global multiplier for per-mode size variation",onChange(){Promise.resolve().then(()=>Ka).then(({updateBallSizes:e})=>{e()})}},{id:"sizeVariationCap",label:"Variation Cap",stateKey:"sizeVariationCap",type:"range",min:0,max:.5,step:.01,default:.12,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Max radius deviation from medium (12% = ±12%)",onChange(){Promise.resolve().then(()=>Ka).then(({updateBallSizes:e})=>{e()})}}]},cursor:{title:"Cursor",icon:"👆",defaultOpen:!1,controls:[{id:"cursorSize",label:"Size",stateKey:"cursorSize",type:"range",min:.1,max:3,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,onChange(){Promise.resolve().then(()=>Cn).then(({updateCursorSize:e})=>{e()})}},{id:"cursorInfluenceRadiusVw",label:"Influence Radius",stateKey:"cursorInfluenceRadiusVw",type:"range",min:0,max:80,step:.5,default:14,format:e=>e.toFixed(1)+"vw",parse:parseFloat,hint:"Universal cursor interaction zone (scales with viewport width)."}]},trail:{title:"Trail",icon:"✨",defaultOpen:!1,controls:[{id:"mouseTrailEnabled",label:"Enabled",stateKey:"mouseTrailEnabled",type:"checkbox",default:!0},{id:"mouseTrailLength",label:"Length",stateKey:"mouseTrailLength",type:"range",min:4,max:96,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),hint:"Max samples kept (higher = smoother, slightly more work)"},{id:"mouseTrailSize",label:"Size",stateKey:"mouseTrailSize",type:"range",min:.5,max:10,step:.1,default:1.3,format:e=>e.toFixed(1)+"px",parse:parseFloat},{id:"mouseTrailFadeMs",label:"Fade",stateKey:"mouseTrailFadeMs",type:"range",min:40,max:1200,step:10,default:220,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10)},{id:"mouseTrailOpacity",label:"Opacity",stateKey:"mouseTrailOpacity",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat}]},scene:{title:"Scene",icon:"⬚",defaultOpen:!1,controls:[{id:"sceneImpactEnabled",label:"Enabled",stateKey:"sceneImpactEnabled",type:"checkbox",default:!0,hint:"If disabled, mode changes will not animate the scene."},{id:"sceneImpactMul",label:"Click Depth",stateKey:"sceneImpactMul",type:"range",min:0,max:.05,step:.001,default:.01,format:e=>e.toFixed(3),parse:parseFloat,hint:"How far the entire scene “presses in” on simulation change.",onChange(e,t){const a=document.getElementById("abs-scene");if(!a)return;const o=e||{},n=+o.sceneImpactMobileMulFactor;a.style.setProperty("--abs-scene-impact-mul",+t*((o.isMobile||o.isMobileViewport)&&Number.isFinite(n)&&n>0?n:1)+"")}},{id:"sceneImpactLogoCompMul",label:"Logo Comp",stateKey:"sceneImpactLogoCompMul",type:"range",min:.25,max:6,step:.05,default:3.6,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"How strongly the logo counter-scales against the scene press (higher = logo feels more “anchored”).",onChange(e,t){const a=document.getElementById("abs-scene");if(!a)return;const o=+t;a.style.setProperty("--abs-scene-impact-logo-comp-mul",(Number.isFinite(o)&&o>0?o:1)+"")}},{id:"sceneImpactMobileMulFactor",label:"Mobile Depth ×",stateKey:"sceneImpactMobileMulFactor",type:"range",min:.25,max:3,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Multiplier applied to Click Depth on mobile-sized viewports.",onChange(e,t){const a=document.getElementById("abs-scene");if(!a)return;const o=e||{},n=+o.sceneImpactMul,i=+t;a.style.setProperty("--abs-scene-impact-mul",(Number.isFinite(n)?n:0)*((o.isMobile||o.isMobileViewport)&&Number.isFinite(i)&&i>0?i:1)+"")}},{id:"sceneImpactPressMs",label:"Press",stateKey:"sceneImpactPressMs",type:"range",min:20,max:300,step:5,default:90,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Press-in duration."},{id:"sceneImpactReleaseMs",label:"Release",stateKey:"sceneImpactReleaseMs",type:"range",min:40,max:1200,step:10,default:310,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Release duration (“bounce out” length)."},{id:"sceneImpactAnticipation",label:"Anticipation",stateKey:"sceneImpactAnticipation",type:"range",min:0,max:.6,step:.01,default:0,format:e=>e.toFixed(2),parse:parseFloat,hint:"Micro pre-pop before the click-in (0 = off)."},{id:"sceneChangeSoundEnabled",label:"Scene Sound",stateKey:"sceneChangeSoundEnabled",type:"checkbox",default:!0,hint:"Plays a soft “pebble-like” tick when switching simulations (only if sound is enabled)."},{id:"sceneChangeSoundIntensity",label:"Scene Sound Intensity",stateKey:"sceneChangeSoundIntensity",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat},{id:"sceneChangeSoundRadius",label:"Scene Sound Pitch",stateKey:"sceneChangeSoundRadius",type:"range",min:6,max:60,step:1,default:18,format:e=>""+Math.round(e),parse:e=>parseInt(e,10),hint:"Higher = lower pitch (maps like “ball size”)."}]},overlay:{title:"Overlay",icon:"🌫️",defaultOpen:!1,controls:[{id:"gateOverlayEnabled",label:"Enabled",stateKey:"gateOverlayEnabled",type:"checkbox",default:!0},{id:"gateOverlayOpacity",label:"White Wash",stateKey:"gateOverlayOpacity",type:"range",min:0,max:.1,step:.001,default:.01,format:e=>e.toFixed(3),parse:parseFloat,onChange(e,t){Promise.resolve().then(()=>Tn).then(({updateOverlayOpacity:e})=>{e(t)})}},{id:"gateOverlayTransitionMs",label:"Anim In Speed",stateKey:"gateOverlayTransitionMs",type:"range",min:200,max:1500,step:50,default:800,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration for blur & depth zoom when opening",onChange(e,t){Promise.resolve().then(()=>Tn).then(({updateOverlayTransition:e})=>{e(t)})}},{id:"gateOverlayTransitionOutMs",label:"Anim Out Speed",stateKey:"gateOverlayTransitionOutMs",type:"range",min:200,max:1200,step:50,default:600,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration for blur & depth zoom when closing",onChange(e,t){Promise.resolve().then(()=>Tn).then(({updateOverlayTransitionOut:e})=>{e(t)})}},{id:"gateOverlayContentDelayMs",label:"Content Delay",stateKey:"gateOverlayContentDelayMs",type:"range",min:0,max:1e3,step:50,default:200,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Wait before showing dialog content",onChange(e,t){Promise.resolve().then(()=>Tn).then(({updateGateContentDelay:e})=>{e(t)})}},{id:"gateDepthScale",label:"Depth Scale",stateKey:"gateDepthScale",type:"range",min:.9,max:1,step:.001,default:.96,format:e=>e.toFixed(3),parse:parseFloat,hint:"Scene scale when gate opens (0.9-1.0)",onChange(e,t){Promise.resolve().then(()=>Tn).then(({updateGateDepthScale:e})=>{e(t)})}},{id:"gateDepthTranslateY",label:"Depth Shift",stateKey:"gateDepthTranslateY",type:"range",min:0,max:30,step:1,default:8,format:e=>Math.round(e)+"px",parse:parseInt,hint:"Vertical shift when gate opens",onChange(e,t){Promise.resolve().then(()=>Tn).then(({updateGateDepthTranslateY:e})=>{e(t)})}},{id:"logoOpacityInactive",label:"Logo Opacity Closed",stateKey:"logoOpacityInactive",type:"range",min:0,max:1,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,hint:"Logo opacity when gate is closed (1 = fully visible)",onChange(e,t){Promise.resolve().then(()=>Tn).then(({updateLogoOpacityInactive:e})=>{e(t)})}},{id:"logoOpacityActive",label:"Logo Opacity Open",stateKey:"logoOpacityActive",type:"range",min:0,max:1,step:.05,default:.2,format:e=>e.toFixed(2),parse:parseFloat,hint:"Logo opacity when gate is active (0.2 = more faded)",onChange(e,t){Promise.resolve().then(()=>Tn).then(({updateLogoOpacityActive:e})=>{e(t)})}},{id:"logoBlurInactive",label:"Logo Blur Closed",stateKey:"logoBlurInactive",type:"range",min:0,max:20,step:.5,default:0,format:e=>e.toFixed(1)+"px",parse:parseFloat,hint:"Logo blur when gate is closed (0 = sharp)",onChange(e,t){Promise.resolve().then(()=>Tn).then(({updateLogoBlurInactive:e})=>{e(t)})}},{id:"logoBlurActive",label:"Logo Blur Open",stateKey:"logoBlurActive",type:"range",min:0,max:30,step:.5,default:12,format:e=>e.toFixed(1)+"px",parse:parseFloat,hint:"Logo blur when gate is active (12px = soft blur)",onChange(e,t){Promise.resolve().then(()=>Tn).then(({updateLogoBlurActive:e})=>{e(t)})}}]},colors:{title:"Colors",icon:"🎨",defaultOpen:!1,controls:[{type:"divider",label:"Backgrounds"},{id:"bgLight",label:"Light Mode",stateKey:"bgLight",type:"color",default:"#f5f5f5",hint:"Background color for light mode",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--bg-light",t),!e.isDarkMode){a.style.setProperty("--chrome-bg",t);const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t)}}},{id:"bgDark",label:"Dark Mode",stateKey:"bgDark",type:"color",default:"#0a0a0a",hint:"Background color for dark mode",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--bg-dark",t),e.isDarkMode){a.style.setProperty("--chrome-bg",t);const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t)}}},{id:"frameColor",label:"Frame/Wall",stateKey:"frameColor",type:"color",default:"#0a0a0a",hint:"Color for the wall/frame border",onChange(e,t){const a=document.documentElement;a.style.setProperty("--frame-color-light",t),a.style.setProperty("--frame-color-dark",t),a.style.setProperty("--wall-color",t)}},{type:"divider",label:"Text · Light Mode"},{id:"textColorLight",label:"Primary",stateKey:"textColorLight",type:"color",default:"#161616",hint:"Main text color in light mode",onChange(e,t){const a=document.documentElement;a.style.setProperty("--text-color-light",t),a.style.setProperty("--text-color-light-base",t)}},{id:"textColorLightMuted",label:"Muted",stateKey:"textColorLightMuted",type:"color",default:"#2f2f2f",hint:"Secondary/muted text in light mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-light-muted",t)}},{type:"divider",label:"Text · Dark Mode"},{id:"textColorDark",label:"Primary",stateKey:"textColorDark",type:"color",default:"#b3b3b3",hint:"Main text color in dark mode",onChange(e,t){const a=document.documentElement;a.style.setProperty("--text-color-dark",t),a.style.setProperty("--text-color-dark-base",t)}},{id:"textColorDarkMuted",label:"Muted",stateKey:"textColorDarkMuted",type:"color",default:"#808080",hint:"Secondary/muted text in dark mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-dark-muted",t)}},{type:"divider",label:"Edge Labels"},{id:"edgeLabelColorLight",label:"Light Mode",stateKey:"edgeLabelColorLight",type:"color",default:"#2f2f2f",hint:"Color for the vertical edge labels in light mode",onChange(e,t){document.documentElement.style.setProperty("--edge-label-color-light",t)}},{id:"edgeLabelColorDark",label:"Dark Mode",stateKey:"edgeLabelColorDark",type:"color",default:"#b3b3b3",hint:"Color for the vertical edge labels in dark mode",onChange(e,t){document.documentElement.style.setProperty("--edge-label-color-dark",t)}},{id:"edgeLabelInsetAdjustPx",label:"Inset",stateKey:"edgeLabelInsetAdjustPx",type:"range",min:-120,max:240,step:1,default:0,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Adjusts edge label inset relative to wall. Higher = inward; lower = outward.",onChange(){Promise.resolve().then(()=>Ka).then(e=>{e.applyLayoutCSSVars()})}},{type:"divider",label:"Links"},{id:"linkHoverColor",label:"Hover Accent",stateKey:"linkHoverColor",type:"color",default:"#ff4013",hint:"Link hover color (accent)",onChange(e,t){document.documentElement.style.setProperty("--link-hover-color",t)}},{type:"divider",label:"Logo"},{id:"logoColorLight",label:"Light Mode",stateKey:"logoColorLight",type:"color",default:"#161616",hint:"Logo color in light mode",onChange(e,t){document.documentElement.style.setProperty("--logo-color-light",t)}},{id:"logoColorDark",label:"Dark Mode",stateKey:"logoColorDark",type:"color",default:"#d5d5d5",hint:"Logo color in dark mode",onChange(e,t){document.documentElement.style.setProperty("--logo-color-dark",t)}},{id:"topLogoWidthVw",label:"Logo Size",stateKey:"topLogoWidthVw",type:"range",min:4,max:30,step:.25,default:12,format:e=>parseFloat(e).toFixed(2)+"vw",parse:parseFloat,hint:"Top-center logo width (clamped by min/max tokens).",onChange(e,t){document.documentElement.style.setProperty("--top-logo-width-vw",t+"")}}]},colorDistribution:{title:"Color Distribution",icon:"🧩",defaultOpen:!1,controls:[{id:"colorDistribution",label:"Discipline Colors",stateKey:"colorDistribution",type:"colorDistribution",labels:["AI Integration","UI/UX Design","Creative Strategy","Frontend Development","Brand Identity","3D Design","Art Direction"],hint:"Assign each discipline to one palette color (unique) and set weights that must sum to 100%. This distribution is used for ALL ball spawns across modes."}]},wall:{title:"Wall",icon:"🏗️",defaultOpen:!1,controls:[{id:"wallPreset",label:"Material",stateKey:"wallPreset",type:"select",options:Object.keys(Da).map(e=>({value:e,label:e.charAt(0).toUpperCase()+e.slice(1)})),default:"rubber",format:e=>e.charAt(0).toUpperCase()+e.slice(1),onChange(e,t){((e,t)=>{Da[e]&&(t.wallPreset=e)})(t,e),Ft()}},{id:"frameColor",label:"Color",stateKey:"frameColor",type:"color",default:"#0a0a0a",hint:"Wall/frame border color (same as Colors → Frame Color)",onChange(e,t){const a=document.documentElement;a.style.setProperty("--frame-color-light",t),a.style.setProperty("--frame-color-dark",t),a.style.setProperty("--wall-color",t)}},{id:"wallThicknessVw",label:"Thickness",stateKey:"wallThicknessVw",type:"range",min:0,max:8,step:.1,default:1.3,format:e=>e.toFixed(1)+"vw",parse:parseFloat,onChange(e,t){e.containerBorderVw=t,Promise.resolve().then(()=>Ka).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars(),Promise.resolve().then(()=>Tn).then(({updateBlurFromWallThickness:e})=>{e()})})}},{id:"wallRadiusVw",label:"Corner Radius",stateKey:"wallRadiusVw",type:"range",min:0,max:12,step:.1,default:3.7,format:e=>e.toFixed(1)+"vw",parse:parseFloat,onChange(){Promise.resolve().then(()=>Ka).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars()})}},{id:"wallInset",label:"Collision Inset",stateKey:"wallInset",type:"range",min:0,max:20,step:1,default:2,format:e=>e+"px",parse:e=>parseInt(e,10),hint:"Physics padding inside the visual wall"},{id:"mobileWallThicknessXFactor",label:"Mobile L/R Thickness",stateKey:"mobileWallThicknessXFactor",type:"range",min:.5,max:3,step:.05,default:1.4,format:e=>e.toFixed(2)+"×",parse:parseFloat,hint:"Wall thickness multiplier for LEFT/RIGHT sides on mobile",onChange(){Promise.resolve().then(()=>Ka).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars()})}},{id:"mobileEdgeLabelsVisible",label:"Mobile Edge Labels",stateKey:"mobileEdgeLabelsVisible",type:"toggle",default:!0,hint:"Show side edge labels on mobile (chapter/copyright)",onChange(){Promise.resolve().then(()=>Ka).then(e=>{e.applyLayoutCSSVars()})}},{id:"mobileEdgeLabelSizeFactor",label:"Mobile Label Size",stateKey:"mobileEdgeLabelSizeFactor",type:"range",min:.3,max:2,step:.05,default:.85,format:e=>e.toFixed(2)+"×",parse:parseFloat,hint:"Font size multiplier for edge labels on mobile",onChange(){Promise.resolve().then(()=>Ka).then(e=>{e.applyLayoutCSSVars()})}},{id:"mobileEdgeLabelOpacity",label:"Mobile Label Opacity",stateKey:"mobileEdgeLabelOpacity",type:"range",min:0,max:1,step:.05,default:.5,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,hint:"Opacity for edge labels on mobile",onChange(){Promise.resolve().then(()=>Ka).then(e=>{e.applyLayoutCSSVars()})}},{id:"wallWobbleMaxDeform",label:"Strength (Max Deform)",stateKey:"wallWobbleMaxDeform",type:"range",min:0,max:150,step:1,default:45,format:e=>e+"px",parse:e=>parseInt(e,10),group:"Advanced Physics",groupCollapsed:!0},{id:"wallWobbleStiffness",label:"Stiffness",stateKey:"wallWobbleStiffness",type:"range",min:50,max:3e3,step:10,default:2200,format:e=>e+"",parse:e=>parseInt(e,10),group:"Advanced Physics"},{id:"wallWobbleDamping",label:"Damping",stateKey:"wallWobbleDamping",type:"range",min:0,max:80,step:1,default:35,format:e=>e+"",parse:e=>parseInt(e,10),group:"Advanced Physics"},{id:"wallWobbleSigma",label:"Impact Spread",stateKey:"wallWobbleSigma",type:"range",min:.5,max:4,step:.1,default:2,format:e=>e.toFixed(1),parse:parseFloat,group:"Advanced Physics"},{id:"wallWobbleCornerClamp",label:"Corner Stickiness",stateKey:"wallWobbleCornerClamp",type:"range",min:0,max:1,step:.01,default:.6,format:e=>e.toFixed(2),parse:parseFloat,group:"Advanced Physics"},{id:"wallWobbleImpactThreshold",label:"Impact Threshold",stateKey:"wallWobbleImpactThreshold",type:"range",min:20,max:200,step:1,default:140,format:e=>e+" px/s",parse:e=>parseInt(e,10),group:"Advanced Physics",hint:"Minimum velocity to trigger wall wobble"},{id:"wallWobbleSettlingSpeed",label:"Settling Speed",stateKey:"wallWobbleSettlingSpeed",type:"range",min:0,max:100,step:1,default:75,format:e=>e+"%",parse:e=>parseInt(e,10),group:"Advanced Physics",hint:"How aggressively walls stop moving"}]},noise:{title:"Noise",icon:"📺",defaultOpen:!1,controls:[{id:"noiseSizeBase",label:"Back Size",stateKey:"noiseSizeBase",type:"range",min:50,max:200,step:5,default:100,format:e=>e+"",parse:e=>parseInt(e,10),cssVar:"--noise-size-base"},{id:"noiseSizeTop",label:"Front Size",stateKey:"noiseSizeTop",type:"range",min:40,max:150,step:5,default:80,format:e=>e+"",parse:e=>parseInt(e,10),cssVar:"--noise-size-top"},{id:"noiseBackOpacity",label:"Back Opacity (Light)",stateKey:"noiseBackOpacity",type:"range",min:0,max:.3,step:.005,default:.025,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-back-opacity"},{id:"noiseFrontOpacity",label:"Front Opacity (Light)",stateKey:"noiseFrontOpacity",type:"range",min:0,max:.3,step:.005,default:.055,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-front-opacity"},{id:"noiseBackOpacityDark",label:"Back Opacity (Dark)",stateKey:"noiseBackOpacityDark",type:"range",min:0,max:.5,step:.005,default:.12,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-back-opacity-dark"},{id:"noiseFrontOpacityDark",label:"Front Opacity (Dark)",stateKey:"noiseFrontOpacityDark",type:"range",min:0,max:.5,step:.005,default:.08,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-front-opacity-dark"}]},critters:{title:"Critters",icon:"🪲",mode:"critters",defaultOpen:!1,controls:[{id:"critterCount",label:"Count",stateKey:"critterCount",type:"range",min:10,max:260,step:5,default:90,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"critterSpeed",label:"Speed",stateKey:"critterSpeed",type:"range",min:0,max:1800,step:10,default:680,format:e=>""+Math.round(e),parse:parseFloat},{id:"critterMaxSpeed",label:"Max Speed",stateKey:"critterMaxSpeed",type:"range",min:200,max:4e3,step:25,default:1400,format:e=>""+Math.round(e),parse:parseFloat},{id:"critterStepHz",label:"Step Rate",stateKey:"critterStepHz",type:"range",min:0,max:16,step:.1,default:5,format:e=>e.toFixed(1)+" Hz",parse:parseFloat},{id:"critterStepSharpness",label:"Step Sharpness",stateKey:"critterStepSharpness",type:"range",min:.5,max:6,step:.1,default:2.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnNoise",label:"Wander",stateKey:"critterTurnNoise",type:"range",min:0,max:8,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnDamp",label:"Turn Inertia",stateKey:"critterTurnDamp",type:"range",min:.5,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnSeek",label:"Steering",stateKey:"critterTurnSeek",type:"range",min:0,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterAvoidRadius",label:"Avoid Radius",stateKey:"critterAvoidRadius",type:"range",min:0,max:260,step:5,default:90,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"critterAvoidForce",label:"Avoid Force",stateKey:"critterAvoidForce",type:"range",min:0,max:25e3,step:250,default:9500,format:e=>Math.round(e)+"",parse:parseFloat},{id:"critterEdgeAvoid",label:"Edge Avoid",stateKey:"critterEdgeAvoid",type:"range",min:0,max:3,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat},{id:"critterMousePull",label:"Mouse Fear",stateKey:"critterMousePull",type:"range",min:0,max:4,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Flee strength inside the mouse zone"},{id:"critterMouseRadiusVw",label:"Mouse Zone",stateKey:"critterMouseRadiusVw",type:"range",min:0,max:80,step:1,default:30,format:e=>Math.round(e)+"vw",parse:parseFloat},{id:"critterRestitution",label:"Bounciness",stateKey:"critterRestitution",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat,hint:"Mode-only override",onChange(e,t){"critters"===e.currentMode&&(e.REST=t)}},{id:"critterFriction",label:"Friction",stateKey:"critterFriction",type:"range",min:0,max:.06,step:.001,default:.018,format:e=>e.toFixed(3),parse:parseFloat,hint:"Mode-only override",onChange(e,t){"critters"===e.currentMode&&(e.FRICTION=t)}},vt("crittersWarmupFrames")]},pit:{title:"Ball Pit",icon:"🎯",mode:"pit",defaultOpen:!1,controls:[{id:"gravityPit",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange(e,t){"pit"===e.currentMode&&(e.G=e.GE*t)}},{id:"weightPit",label:"Weight",stateKey:"ballMassKg",type:"range",min:10,max:200,step:1,default:129,format:e=>e.toFixed(0),parse:parseFloat,onChange(e,t){e.balls.forEach(e=>{e.m=t})}},{id:"restitution",label:"Bounciness",stateKey:"REST",type:"range",min:0,max:1,step:.01,default:.69,format:e=>e.toFixed(2),parse:parseFloat},{id:"friction",label:"Air Friction",stateKey:"FRICTION",type:"range",min:0,max:.01,step:5e-4,default:.006,format:e=>e.toFixed(4),parse:parseFloat},{id:"repelPower",label:"Repel Power",stateKey:"repelPower",type:"range",min:0,max:1e4,step:100,default:8500,format:e=>""+Math.round(e),parse:parseFloat,onChange(e,t){e.repelPower=24e3*Math.pow(2,12*(Math.max(0,Math.min(1e4,t))/1e4-.5))}},{id:"sleepVelocityThreshold",label:"Sleep Speed",stateKey:"sleepVelocityThreshold",type:"range",min:0,max:40,step:.5,default:12,format:e=>(+e).toFixed(1)+" px/s",parse:parseFloat,hint:"Pit modes only. Higher = settles sooner."},{id:"sleepAngularThreshold",label:"Sleep Spin",stateKey:"sleepAngularThreshold",type:"range",min:0,max:1,step:.01,default:.18,format:e=>(+e).toFixed(2)+" rad/s",parse:parseFloat,hint:"Pit modes only. Higher = stops spinning sooner."},{id:"timeToSleep",label:"Sleep Time",stateKey:"timeToSleep",type:"range",min:.05,max:2,step:.05,default:.25,format:e=>(+e).toFixed(2)+"s",parse:parseFloat,hint:"Pit modes only. Lower = sleeps faster."},vt("pitWarmupFrames")]},pitThrows:{title:"Ball Pit (Throws)",icon:"🎯",mode:"pit-throws",defaultOpen:!1,controls:[{id:"gravityPitThrows",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange(e,t){"pit-throws"===e.currentMode&&(e.G=e.GE*t)}},{id:"pitThrowsSpeed",label:"Throw Speed",stateKey:"pitThrowSpeed",type:"range",min:100,max:2e3,step:25,default:650,format:e=>Math.round(e)+"",parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpeedVar",label:"Speed Variance",stateKey:"pitThrowSpeedVar",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},{id:"sleepVelocityThresholdThrows",label:"Sleep Speed",stateKey:"sleepVelocityThreshold",type:"range",min:0,max:40,step:.5,default:12,format:e=>(+e).toFixed(1)+" px/s",parse:parseFloat,hint:"Pit modes only. Higher = settles sooner."},{id:"sleepAngularThresholdThrows",label:"Sleep Spin",stateKey:"sleepAngularThreshold",type:"range",min:0,max:1,step:.01,default:.18,format:e=>(+e).toFixed(2)+" rad/s",parse:parseFloat,hint:"Pit modes only. Higher = stops spinning sooner."},{id:"timeToSleepThrows",label:"Sleep Time",stateKey:"timeToSleep",type:"range",min:.05,max:2,step:.05,default:.25,format:e=>(+e).toFixed(2)+"s",parse:parseFloat,hint:"Pit modes only. Lower = sleeps faster."},{id:"pitThrowsInterval",label:"Throw Interval",stateKey:"pitThrowIntervalMs",type:"range",min:10,max:500,step:5,default:70,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsColorPause",label:"Color Pause",stateKey:"pitThrowColorPauseMs",type:"range",min:0,max:1200,step:10,default:180,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsPairChance",label:"Pair Chance",stateKey:"pitThrowPairChance",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsPairStagger",label:"Pair Stagger",stateKey:"pitThrowPairStaggerMs",type:"range",min:0,max:120,step:1,default:18,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsBatchSize",label:"Batch Size",stateKey:"pitThrowBatchSize",type:"range",min:1,max:60,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"pitThrowsTargetYFrac",label:"Throw Aim (Y)",stateKey:"pitThrowTargetYFrac",type:"range",min:.12,max:.7,step:.01,default:.36,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAngleJitter",label:"Angle Jitter",stateKey:"pitThrowAngleJitter",type:"range",min:0,max:.6,step:.01,default:.16,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpreadVar",label:"Spread Variance",stateKey:"pitThrowSpreadVar",type:"range",min:0,max:.8,step:.01,default:.25,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsSpeedJitter",label:"Speed Jitter",stateKey:"pitThrowSpeedJitter",type:"range",min:0,max:.8,step:.01,default:.22,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsInletInset",label:"Inlet Inset",stateKey:"pitThrowInletInset",type:"range",min:0,max:.2,step:.005,default:.06,format:e=>e.toFixed(3),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpawnSpread",label:"Spawn Spread",stateKey:"pitThrowSpawnSpread",type:"range",min:0,max:.12,step:.0025,default:.02,format:e=>e.toFixed(4),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAimJitter",label:"Aim Jitter",stateKey:"pitThrowAimJitter",type:"range",min:0,max:.2,step:.005,default:.04,format:e=>e.toFixed(3),parse:parseFloat},{id:"pitThrowsCrossBias",label:"Cross Aim",stateKey:"pitThrowCrossBias",type:"range",min:0,max:.3,step:.005,default:.12,format:e=>e.toFixed(3),parse:parseFloat},vt("pitThrowsWarmupFrames")]},flies:{title:"Flies",icon:"🕊️",mode:"flies",defaultOpen:!1,controls:[{id:"fliesBallCount",label:"Ball Count",stateKey:"fliesBallCount",type:"range",min:20,max:150,step:5,default:60,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"attractPower",label:"Attraction",stateKey:"attractionPower",type:"range",min:100,max:8e3,step:50,default:5e3,format:e=>""+Math.round(e),parse:parseFloat},{id:"swarmSpeed",label:"Swarm Speed",stateKey:"swarmSpeed",type:"range",min:.2,max:5,step:.1,default:.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"fliesSeparation",label:"Separation",stateKey:"fliesSeparation",type:"range",min:5e3,max:3e4,step:1e3,default:15e3,format:e=>""+Math.round(e),parse:parseFloat},vt("fliesWarmupFrames")]},weightless:{title:"Zero-G",icon:"🌌",mode:"weightless",defaultOpen:!1,controls:[{id:"weightlessCount",label:"Ball Count",stateKey:"weightlessCount",type:"range",min:20,max:200,step:10,default:80,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"weightlessSpeed",label:"Initial Speed",stateKey:"weightlessInitialSpeed",type:"range",min:100,max:600,step:25,default:250,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"weightlessBounce",label:"Bounce",stateKey:"weightlessBounce",type:"range",min:.5,max:1,step:.05,default:.95,format:e=>e.toFixed(2),parse:parseFloat},{id:"weightlessRepelPower",label:"Cursor Blast Power",stateKey:"weightlessRepelPower",type:"range",min:0,max:6e5,step:1e4,default:22e4,format:e=>""+Math.round(e),parse:parseFloat},{id:"weightlessRepelSoft",label:"Cursor Blast Falloff",stateKey:"weightlessRepelSoft",type:"range",min:.5,max:6,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},vt("weightlessWarmupFrames")]},water:{title:"Water",icon:"🌊",mode:"water",defaultOpen:!1,controls:[{id:"waterBallCount",label:"Ball Count",stateKey:"waterBallCount",type:"range",min:50,max:400,step:10,default:300,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"waterDrag",label:"Water Resistance",stateKey:"waterDrag",type:"range",min:.001,max:.05,step:.001,default:.015,format:e=>e.toFixed(3),parse:parseFloat},{id:"waterRippleStrength",label:"Ripple Strength",stateKey:"waterRippleStrength",type:"range",min:5e3,max:3e4,step:1e3,default:18e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"waterMotion",label:"Drift Strength",stateKey:"waterDriftStrength",type:"range",min:0,max:80,step:1,default:40,format:e=>e.toFixed(0),parse:parseFloat,onChange(e,t){e.waterInitialVelocity=5*t},reinitMode:!0},vt("waterWarmupFrames")]},vortex:{title:"Vortex",icon:"🌀",mode:"vortex",defaultOpen:!1,controls:[{id:"vortexBallCount",label:"Ball Count",stateKey:"vortexBallCount",type:"range",min:50,max:500,step:10,default:180,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"vortexSwirl",label:"Swirl Strength",stateKey:"vortexSwirlStrength",type:"range",min:100,max:3e3,step:50,default:420,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexPull",label:"Radial Pull",stateKey:"vortexRadialPull",type:"range",min:0,max:2e3,step:20,default:180,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexSpeedMultiplier",label:"Speed Multiplier",stateKey:"vortexSpeedMultiplier",type:"range",min:.1,max:3,step:.1,default:1,format:e=>e.toFixed(1),parse:parseFloat},{id:"vortexRadius",label:"Vortex Radius",stateKey:"vortexRadius",type:"range",min:0,max:800,step:20,default:0,format:e=>0===e?"Unlimited":e.toFixed(0)+"px",parse:parseFloat,tooltip:"Maximum effective radius (0 = unlimited, uses distance falloff)"},{id:"vortexFalloffCurve",label:"Falloff Curve",stateKey:"vortexFalloffCurve",type:"range",min:.3,max:3,step:.1,default:1,format:e=>e.toFixed(1),parse:parseFloat,tooltip:"Falloff shape: 1.0 = linear, 2.0 = quadratic (sharper), 0.5 = gentle"},{id:"vortexRotationDirection",label:"Rotation Direction",stateKey:"vortexRotationDirection",type:"range",min:-1,max:1,step:2,default:1,format:e=>1===e?"Counterclockwise":"Clockwise",parse:parseFloat},{id:"vortexCoreStrength",label:"Core Strength",stateKey:"vortexCoreStrength",type:"range",min:.5,max:3,step:.1,default:1,format:e=>e.toFixed(1)+"x",parse:parseFloat,tooltip:"Strength multiplier at vortex center"},{id:"vortexAccelerationZone",label:"Acceleration Zone",stateKey:"vortexAccelerationZone",type:"range",min:0,max:400,step:20,default:0,format:e=>0===e?"Disabled":e.toFixed(0)+"px",parse:parseFloat,tooltip:"Radius where extra acceleration occurs (0 = disabled)"},{id:"vortexOutwardPush",label:"Outward Push",stateKey:"vortexOutwardPush",type:"range",min:0,max:1e3,step:20,default:0,format:e=>0===e?"Disabled":e.toFixed(0),parse:parseFloat,tooltip:"Outward force at edges (only when radius is set)"},{id:"vortexDrag",label:"Drag",stateKey:"vortexDrag",type:"range",min:.001,max:.05,step:.001,default:.005,format:e=>e.toFixed(3),parse:parseFloat},vt("vortexWarmupFrames")]},"ping-pong":{title:"Ping Pong",icon:"🏓",mode:"ping-pong",defaultOpen:!1,controls:[{id:"pingPongBallCount",label:"Ball Count",stateKey:"pingPongBallCount",type:"range",min:10,max:100,step:5,default:35,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"pingPongSpeed",label:"Ball Speed",stateKey:"pingPongSpeed",type:"range",min:200,max:1600,step:50,default:800,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"pingPongVerticalDamp",label:"Vertical Damping",stateKey:"pingPongVerticalDamp",type:"range",min:.8,max:.999,step:.001,default:.995,format:e=>e.toFixed(3),parse:parseFloat},vt("pingPongWarmupFrames")]},magnetic:{title:"Magnetic",icon:"🧲",mode:"magnetic",defaultOpen:!1,controls:[{id:"magneticBallCount",label:"Ball Count",stateKey:"magneticBallCount",type:"range",min:50,max:300,step:10,default:180,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"magneticStrength",label:"Strength",stateKey:"magneticStrength",type:"range",min:1e4,max:1e5,step:5e3,default:65e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticVelocity",label:"Max Velocity",stateKey:"magneticMaxVelocity",type:"range",min:500,max:4e3,step:100,default:2800,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticDamping",label:"Damping",stateKey:"magneticDamping",type:"range",min:.8,max:.999,step:.001,default:.98,format:e=>e.toFixed(3),parse:parseFloat},vt("magneticWarmupFrames")]},bubbles:{title:"Bubbles",icon:"🫧",mode:"bubbles",defaultOpen:!1,controls:[{id:"bubblesRate",label:"Bubble Rate",stateKey:"bubblesSpawnRate",type:"range",min:1,max:20,step:1,default:8,format:e=>e+"",parse:e=>parseInt(e,10)},{id:"bubblesSpeed",label:"Rise Speed",stateKey:"bubblesRiseSpeed",type:"range",min:50,max:400,step:25,default:150,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesWobble",label:"Wobble",stateKey:"bubblesWobble",type:"range",min:0,max:100,step:5,default:40,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesMax",label:"Max Bubbles",stateKey:"bubblesMaxCount",type:"range",min:50,max:300,step:10,default:150,format:e=>e+"",parse:e=>parseInt(e,10)},vt("bubblesWarmupFrames")]},tilt:{title:"Tilt",icon:"⚖️",mode:"tilt",defaultOpen:!1,controls:[{id:"tiltBallCount",label:"Particle Count",stateKey:"tiltBallCount",type:"range",min:100,max:500,step:10,default:300,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"tiltMaxAngle",label:"Max Angle",stateKey:"tiltMaxAngle",type:"range",min:.5,max:10,step:.5,default:2,format:e=>e.toFixed(1)+"°",parse:parseFloat},{id:"tiltLerpSpeed",label:"Smoothness",stateKey:"tiltLerpSpeed",type:"range",min:.01,max:.5,step:.01,default:.08,format:e=>e.toFixed(2),parse:parseFloat},{id:"tiltGlassMass",label:"Particle Mass",stateKey:"tiltGlassBallMass",type:"range",min:.02,max:.3,step:.01,default:.08,format:e=>e.toFixed(2)+"x",parse:parseFloat,reinitMode:!0},{id:"tiltFriction",label:"Friction",stateKey:"tiltFriction",type:"range",min:.002,max:.02,step:.001,default:.008,format:e=>e.toFixed(3),parse:parseFloat}]},kaleidoscope:{title:"Kaleidoscope",icon:"🪞",mode:"kaleidoscope",defaultOpen:!1,controls:[{id:"kaleiBallCount",label:"Ball Count",stateKey:"kaleidoscopeBallCount",type:"range",min:15,max:120,step:1,default:23,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kaleiWedges",label:"Wedges",stateKey:"kaleidoscopeWedges",type:"range",min:4,max:16,step:1,default:12,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kaleiMirror",label:"Mirror",type:"range",min:0,max:1,step:1,default:1,format:e=>e?"On":"Off",parse:e=>parseInt(e,10)},{id:"kaleiSpeed",label:"Speed",stateKey:"kaleidoscopeSpeed",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat},{id:"kaleiDotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscopeDotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kaleiDotAreaMul",label:"Dot Area",stateKey:"kaleidoscopeDotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kaleiSpawnArea",label:"Spawn Density",stateKey:"kaleidoscopeSpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kaleiSizeVar",label:"Size Variance",stateKey:"kaleidoscopeSizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},vt("kaleidoscopeWarmupFrames")]},kaleidoscope1:{title:"Kaleidoscope I (Variant)",icon:"🪞",mode:"kaleidoscope-1",defaultOpen:!1,controls:[{id:"kalei1BallCount",label:"Ball Count",stateKey:"kaleidoscope1BallCount",type:"range",min:6,max:180,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei1Wedges",label:"Wedges",stateKey:"kaleidoscope1Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei1Speed",label:"Speed",stateKey:"kaleidoscope1Speed",type:"range",min:.2,max:2,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei1DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope1DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei1DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope1DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei1SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope1SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei1SizeVar",label:"Size Variance",stateKey:"kaleidoscope1SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},vt("kaleidoscope1WarmupFrames")]},kaleidoscope2:{title:"Kaleidoscope II (Variant)",icon:"🪞",mode:"kaleidoscope-2",defaultOpen:!1,controls:[{id:"kalei2BallCount",label:"Ball Count",stateKey:"kaleidoscope2BallCount",type:"range",min:10,max:260,step:2,default:36,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei2Wedges",label:"Wedges",stateKey:"kaleidoscope2Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei2Speed",label:"Speed",stateKey:"kaleidoscope2Speed",type:"range",min:.2,max:2,step:.05,default:1.15,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei2DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope2DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei2DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope2DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei2SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope2SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei2SizeVar",label:"Size Variance",stateKey:"kaleidoscope2SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},vt("kaleidoscope2WarmupFrames")]},kaleidoscope3:{title:"Kaleidoscope III (Variant)",icon:"🪞",mode:"kaleidoscope-3",defaultOpen:!1,controls:[{id:"kalei3BallCount",label:"Ball Count",stateKey:"kaleidoscope3BallCount",type:"range",min:12,max:300,step:3,default:54,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei3Wedges",label:"Wedges",stateKey:"kaleidoscope3Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei3Speed",label:"Speed",stateKey:"kaleidoscope3Speed",type:"range",min:.2,max:2,step:.05,default:1.55,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei3DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope3DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei3DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope3DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei3SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope3SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei3SizeVar",label:"Size Variance",stateKey:"kaleidoscope3SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},vt("kaleidoscope3WarmupFrames")]},orbit3d:{title:"Orbit 3D: Zero Gravity",icon:"🌪️",mode:"orbit-3d",defaultOpen:!1,controls:[{id:"orbit3dMoonCount",label:"Body Count",stateKey:"orbit3dMoonCount",type:"range",min:10,max:200,step:10,default:80,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"orbit3dGravity",label:"Gravity Pull",stateKey:"orbit3dGravity",type:"range",min:1e3,max:1e4,step:500,default:5e3,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3dVelocityMult",label:"Orbital Speed",stateKey:"orbit3dVelocityMult",type:"range",min:50,max:300,step:10,default:150,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3dDepthScale",label:"Depth Effect",stateKey:"orbit3dDepthScale",type:"range",min:0,max:1.5,step:.1,default:.8,format:e=>e.toFixed(1),parse:parseFloat},{id:"orbit3dDamping",label:"Stability",stateKey:"orbit3dDamping",type:"range",min:.005,max:.05,step:.005,default:.02,format:e=>e.toFixed(3),parse:parseFloat},{id:"sizeVariationOrbit3d",label:"Size Variation",stateKey:"sizeVariationOrbit3d",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},vt("orbit3dWarmupFrames")]},orbit3d2:{title:"Orbit 3D (Tight Swarm)",icon:"🌪️",mode:"orbit-3d-2",defaultOpen:!1,controls:[{id:"orbit3d2MoonCount",label:"Moon Count",stateKey:"orbit3d2MoonCount",type:"range",min:20,max:200,step:10,default:100,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"orbit3d2Gravity",label:"Gravity (G×M)",stateKey:"orbit3d2Gravity",type:"range",min:1e4,max:3e5,step:1e4,default:8e4,format:e=>Math.round(e/1e3)+"k",parse:parseFloat,reinitMode:!0},{id:"orbit3d2VelocityMult",label:"Initial Velocity",stateKey:"orbit3d2VelocityMult",type:"range",min:.5,max:1.5,step:.05,default:1.1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"orbit3d2MinOrbit",label:"Min Orbit (vw)",stateKey:"orbit3d2MinOrbit",type:"range",min:2,max:15,step:1,default:4,format:e=>e+"vw",parse:parseFloat,reinitMode:!0},{id:"orbit3d2MaxOrbit",label:"Max Orbit (vw)",stateKey:"orbit3d2MaxOrbit",type:"range",min:3,max:25,step:1,default:12,format:e=>e+"vw",parse:parseFloat,reinitMode:!0},{id:"orbit3d2DepthScale",label:"Depth Effect",stateKey:"orbit3d2DepthScale",type:"range",min:0,max:.8,step:.05,default:.6,format:e=>e.toFixed(2),parse:parseFloat},{id:"orbit3d2Damping",label:"Damping",stateKey:"orbit3d2Damping",type:"range",min:0,max:.2,step:.005,default:.01,format:e=>e.toFixed(3),parse:parseFloat},{id:"orbit3d2FollowSmoothing",label:"Cursor Follow Speed",stateKey:"orbit3d2FollowSmoothing",type:"range",min:1,max:200,step:1,default:40,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3d2Softening",label:"Gravity Softening",stateKey:"orbit3d2Softening",type:"range",min:1,max:100,step:1,default:15,format:e=>Math.round(e),parse:parseFloat},{id:"sizeVariationOrbit3d2",label:"Size Variation",stateKey:"sizeVariationOrbit3d2",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},vt("orbit3d2WarmupFrames")]},lattice:{title:"Crystal Lattice",icon:"💎",mode:"lattice",defaultOpen:!1,controls:[{id:"sizeVariationLattice",label:"Size Variation",stateKey:"sizeVariationLattice",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"latticeSpacingVw",label:"Spacing (vw)",stateKey:"latticeSpacingVw",type:"range",min:1,max:20,step:.25,default:8.5,format:e=>e.toFixed(2)+"vw",parse:parseFloat,reinitMode:!0},{id:"latticeStiffness",label:"Stiffness",stateKey:"latticeStiffness",type:"range",min:0,max:10,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},{id:"latticeDamping",label:"Damping",stateKey:"latticeDamping",type:"range",min:.5,max:1,step:.01,default:.92,format:e=>e.toFixed(2),parse:parseFloat},{id:"latticeDisruptRadius",label:"Mesh Stretch Radius",stateKey:"latticeDisruptRadius",type:"range",min:50,max:1e3,step:25,default:600,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"latticeDisruptPower",label:"Mesh Stretch Power",stateKey:"latticeDisruptPower",type:"range",min:0,max:50,step:1,default:25,format:e=>e.toFixed(1),parse:parseFloat},{id:"latticeMeshWaveStrength",label:"Wave Amplitude",stateKey:"latticeMeshWaveStrength",type:"range",min:0,max:50,step:1,default:12,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"latticeMeshWaveSpeed",label:"Wave Speed",stateKey:"latticeMeshWaveSpeed",type:"range",min:0,max:3,step:.1,default:.8,format:e=>e.toFixed(1)+"x",parse:parseFloat},{id:"latticeAlignment",label:"Grid Alignment",stateKey:"latticeAlignment",type:"select",options:[{value:"center",label:"Center (Fill)"},{value:"top-left",label:"Top-Left"},{value:"top-center",label:"Top-Center"},{value:"top-right",label:"Top-Right"}],default:"center",format:e=>e+"",parse:e=>e+"",reinitMode:!0},vt("latticeWarmupFrames")]},neural:{title:"Neural Network",icon:"🧠",mode:"neural",defaultOpen:!1,controls:[{id:"neuralBallCount",label:"Ball Count",stateKey:"neuralBallCount",type:"range",min:8,max:260,step:1,default:80,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"sizeVariationNeural",label:"Size Variation",stateKey:"sizeVariationNeural",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"neuralWanderStrength",label:"Wander Strength",stateKey:"neuralWanderStrength",type:"range",min:0,max:2e3,step:10,default:420,format:e=>Math.round(e)+"",parse:parseFloat},{id:"neuralDamping",label:"Damping",stateKey:"neuralDamping",type:"range",min:.8,max:1,step:.005,default:.985,format:e=>e.toFixed(3),parse:parseFloat},{id:"neuralCohesion",label:"Cohesion",stateKey:"neuralCohesion",type:"range",min:0,max:1,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},vt("neuralWarmupFrames")]},parallaxLinear:{title:"Parallax (Linear)",icon:"🫧",mode:"parallax-linear",defaultOpen:!1,controls:[{id:"parallaxLinearPreset",label:"Preset",stateKey:"parallaxLinearPreset",type:"select",options:Object.keys(Ta).map(e=>({value:e,label:Ta[e].label})),default:"default",format:e=>Ta[e]?.label||e,onChange(e){Mt(e,!0)}},{id:"parallaxLinearDotSizeMul",label:"Dot Size",stateKey:"parallaxLinearDotSizeMul",type:"range",min:.2,max:6,step:.1,default:1.8,format:e=>e.toFixed(1)+"×",parse:parseFloat,reinitMode:!0},{id:"sizeVariationParallaxLinear",label:"Size Variation",stateKey:"sizeVariationParallaxLinear",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"parallaxLinearGridX",label:"Grid X (Cols)",stateKey:"parallaxLinearGridX",type:"range",min:3,max:40,step:1,default:14,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearGridY",label:"Grid Y (Rows)",stateKey:"parallaxLinearGridY",type:"range",min:3,max:40,step:1,default:10,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearGridZ",label:"Grid Z (Layers)",stateKey:"parallaxLinearGridZ",type:"range",min:2,max:20,step:1,default:7,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearSpanX",label:"Span X",stateKey:"parallaxLinearSpanX",type:"range",min:.2,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0,hint:"World-space width as a multiple of the viewport width. Use >1 to fill edge-to-edge."},{id:"parallaxLinearSpanY",label:"Span Y",stateKey:"parallaxLinearSpanY",type:"range",min:.2,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0,hint:"World-space height as a multiple of the viewport height."},{id:"parallaxLinearZNear",label:"Z Near",stateKey:"parallaxLinearZNear",type:"range",min:10,max:1200,step:10,default:50,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearZFar",label:"Z Far",stateKey:"parallaxLinearZFar",type:"range",min:50,max:3e3,step:25,default:900,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearFocalLength",label:"Focal Length",stateKey:"parallaxLinearFocalLength",type:"range",min:80,max:2e3,step:10,default:420,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10)},{id:"parallaxLinearParallaxStrength",label:"Parallax Strength",stateKey:"parallaxLinearParallaxStrength",type:"range",min:0,max:2e3,step:10,default:260,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},vt("parallaxLinearWarmupFrames")]},parallaxPerspective:{title:"Parallax (Perspective)",icon:"🫧",mode:"parallax-perspective",defaultOpen:!1,controls:[{id:"parallaxPerspectivePreset",label:"Preset",stateKey:"parallaxPerspectivePreset",type:"select",options:Object.keys(La).map(e=>({value:e,label:La[e].label})),default:"default",format:e=>La[e]?.label||e,onChange(e){yt(e,!0)}},{id:"parallaxPerspectiveRandomness",label:"Randomness",stateKey:"parallaxPerspectiveRandomness",type:"range",min:0,max:1,step:.05,default:.6,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0,hint:"0 = perfect grid. 1 = full jitter from grid vertices."},{id:"parallaxPerspectiveDotSizeMul",label:"Dot Size",stateKey:"parallaxPerspectiveDotSizeMul",type:"range",min:.2,max:6,step:.1,default:1.8,format:e=>e.toFixed(1)+"×",parse:parseFloat,reinitMode:!0},{id:"sizeVariationParallaxPerspective",label:"Size Variation",stateKey:"sizeVariationParallaxPerspective",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveGridX",label:"Grid X (Cols)",stateKey:"parallaxPerspectiveGridX",type:"range",min:3,max:50,step:1,default:16,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveGridY",label:"Grid Y (Rows)",stateKey:"parallaxPerspectiveGridY",type:"range",min:3,max:50,step:1,default:12,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveGridZ",label:"Grid Z (Layers)",stateKey:"parallaxPerspectiveGridZ",type:"range",min:2,max:25,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveSpanX",label:"Span X",stateKey:"parallaxPerspectiveSpanX",type:"range",min:.2,max:3,step:.05,default:1.45,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveSpanY",label:"Span Y",stateKey:"parallaxPerspectiveSpanY",type:"range",min:.2,max:3,step:.05,default:1.45,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveZNear",label:"Z Near",stateKey:"parallaxPerspectiveZNear",type:"range",min:10,max:1200,step:10,default:40,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveZFar",label:"Z Far",stateKey:"parallaxPerspectiveZFar",type:"range",min:50,max:4e3,step:50,default:1200,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveFocalLength",label:"Focal Length",stateKey:"parallaxPerspectiveFocalLength",type:"range",min:80,max:2e3,step:10,default:420,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10)},{id:"parallaxPerspectiveParallaxStrength",label:"Parallax Strength",stateKey:"parallaxPerspectiveParallaxStrength",type:"range",min:0,max:2e3,step:10,default:280,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},vt("parallaxPerspectiveWarmupFrames")]}};var an=Object.freeze({__proto__:null,CONTROL_SECTIONS:tn,applyParallaxLinearPreset:Mt,applyParallaxPerspectivePreset:yt,bindRegisteredControls:Pt,generatePanelHTML:kt,getAllControls:wt,isControlVisible:bt,setApplyVisualCSSVars(e){Qo=e},syncSlidersToState:Ft}),on=Object.freeze({__proto__:null,setupControls:Dt,updateModeButtonsUI:Tt});const nn=kt(),rn={core:{title:"Core",controls:[{id:"masterGain",label:"Master Volume",min:10,max:100,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"collisionMinImpact",label:"Silence Threshold",min:20,max:85,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e}]},envelope:{title:"Envelope",controls:[{id:"decayTime",label:"Click Length",min:20,max:180,step:1,format:e=>Math.round(e)+"ms",toConfig:e=>e/1e3,fromConfig:e=>1e3*e}]},tone:{title:"Tone",controls:[{id:"filterBaseFreq",label:"Brightness",min:300,max:6e3,step:50,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"harmonicGain",label:"Warmth",min:0,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"filterQ",label:"Resonance",min:10,max:200,step:5,format:e=>""+(e/100).toFixed(2),toConfig:e=>e/100,fromConfig:e=>100*e}]},crystal:{title:"Crystal",controls:[{id:"pitchMinHz",label:"Pitch Low",min:80,max:1200,step:10,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"pitchMaxHz",label:"Pitch High",min:200,max:4e3,step:20,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"pitchCurve",label:"Pitch Curve",min:70,max:160,step:1,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleGain",label:"Sparkle",min:0,max:35,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMin",label:"Sparkle Min",min:120,max:600,step:10,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMax",label:"Sparkle Max",min:160,max:800,step:10,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleDecayMul",label:"Sparkle Decay",min:20,max:95,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"noiseTransientQ",label:"Sparkle Q",min:60,max:600,step:5,format:e=>""+(e/100).toFixed(2),toConfig:e=>e/100,fromConfig:e=>100*e}]},space:{title:"Space",controls:[{id:"reverbWetMix",label:"Reverb Mix",min:0,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"reverbDecay",label:"Room Size",min:5,max:80,step:1,format:e=>(e/100).toFixed(2)+"s",toConfig:e=>e/100,fromConfig:e=>100*e}]},dynamics:{title:"Dynamics",controls:[{id:"minGain",label:"Min Hit Volume",min:0,max:20,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"maxGain",label:"Max Hit Volume",min:5,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e}]},realism:{title:"Realism",controls:[{id:"noiseTransientGain",label:"Impact Snap",min:0,max:80,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"varianceGain",label:"Volume Variance",min:0,max:50,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"variancePitch",label:"Pitch Variance",min:0,max:25,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"velocityNoiseScale",label:"Hard Hit Crack",min:100,max:500,step:10,format:e=>(e/100).toFixed(1)+"×",toConfig:e=>e/100,fromConfig:e=>100*e}]}};let ln=null,sn=null;const cn="panel_dock_position_v2",dn="panel_dock_hidden",pn="master_panel_collapsed",un="panel_dock_size";let hn=!1,fn=0,mn=0,gn=0,bn=0;var Mn=Object.freeze({__proto__:null,createPanelDock:At,resetPanelPositions:Vt,toggleDock:Et});let yn=!1,vn=null,xn=!1,wn=!1,Sn=0;var Cn=Object.freeze({__proto__:null,hideCursor:Gt,setupCustomCursor:$t,showCursor:Nt,updateCursorPosition:_t,updateCursorSize:Wt});let kn=null,Pn=!0,Fn=null;const Dn=new WeakMap;var Tn=Object.freeze({__proto__:null,hideOverlay:ea,initGateOverlay:qt,isOverlayActive:ta,mountGateIntoOverlay:jt,showOverlay:Qt,unmountGateFromOverlay:Zt,updateGateContentDelay(e){document.documentElement.style.setProperty("--gate-content-delay",e+"ms")},updateGateDepthScale(e){document.documentElement.style.setProperty("--gate-depth-scale",e)},updateGateDepthTranslateY(e){document.documentElement.style.setProperty("--gate-depth-translate-y",e+"px")},updateLogoBlurActive(e){const t=document.documentElement;t.style.setProperty("--logo-blur-active-target",e+"px"),ta()&&t.style.setProperty("--logo-blur-active",e+"px")},updateLogoBlurInactive(e){const t=document.documentElement;t.style.setProperty("--logo-blur-inactive",e+"px"),ta()||t.style.setProperty("--logo-blur-active",e+"px")},updateLogoOpacityActive(e){const t=document.documentElement,a=e;t.style.setProperty("--logo-opacity-active-target",a),ta()&&t.style.setProperty("--logo-opacity-active",a)},updateLogoOpacityInactive(e){const t=document.documentElement;t.style.setProperty("--logo-opacity-inactive",e),ta()||t.style.setProperty("--logo-opacity-active",e)},updateOverlayOpacity(e){kn&&kn.style.setProperty("--gate-overlay-opacity",e)},updateOverlayTransition(e){kn&&(kn.style.setProperty("--gate-overlay-transition-duration",e+"ms"),document.documentElement.style.setProperty("--gate-depth-duration",e+"ms"))},updateOverlayTransitionOut(e){kn&&(kn.style.setProperty("--gate-overlay-transition-out-duration",e+"ms"),document.documentElement.style.setProperty("--gate-depth-out-duration",e+"ms"))}});const Ln="--abs-scene-impact",In="--abs-scene-impact-dur",An="--abs-scene-impact-logo-scale";let Kn=null,On=!1,Rn=0,zn=0,Vn=0,En=!1,Bn=0,$n=0,Wn=0,_n=0,Gn=!1,Nn=null,Hn=0,jn=0,Zn=0,Yn=!1,Xn=0,qn=0,Un=0,Jn=0,Qn=0,ei=performance.now()/1e3,ti=0,ai=!0,oi=null;const ni=1e3/60;let ii=[],ri=0,li=null;const si='<i class="ti ti-volume-off" aria-hidden="true"></i>';let ci=null;const di=new Map([["apple music",'<i class="ti ti-brand-apple" aria-hidden="true"></i>'],["instagram",'<i class="ti ti-brand-instagram" aria-hidden="true"></i>'],["linkedin",'<i class="ti ti-brand-linkedin" aria-hidden="true"></i>'],["x",'<i class="ti ti-brand-x" aria-hidden="true"></i>']]);var pi=Object.freeze({__proto__:null,applyExpertiseLegendColors:va});let ui=!1;(async()=>{document.documentElement.classList.add("js-enabled");try{await(async()=>{if(li)return li;const e=pa();if(e)return li=e,li;const t=await(async()=>{const e=["config/text.json","js/text.json","../public/js/text.json"];for(const a of e)try{const e=await fetch(a,{cache:"no-cache"});if(!e.ok)continue;const t=await e.json();if(da(t))return t}catch(t){}throw Error("No text.json found")})();li=t;try{"undefined"!=typeof window&&(window.__TEXT__=t)}catch(a){}return li})(),(()=>{try{(()=>{const e=ua("meta.title","");e&&(document.title=e);const t=ua("meta.description","");if(t){const e=document.querySelector('meta[name="description"]');e&&e.setAttribute("content",t)}})(),xa(document.getElementById("edge-chapter-text"),ua("edge.chapterText","")),xa(document.querySelector(".edge-copyright__text"),ua("edge.copyright","")),(()=>{const e=document.getElementById("expertise-legend");wa(e,"aria-label",ua("legend.ariaLabel",""));const t=ua("legend.items",null);if(!Array.isArray(t)||!e)return;const a=e.querySelectorAll(".legend__item span");for(let o=0;a.length>o&&t.length>o;o++){const e=t?.[o]?.label;e&&(a[o].textContent=e)}})(),(()=>{const e=document.querySelector(".decorative-script p");if(!e)return;const t=ua("philosophy.textBeforeLink",""),a=ua("philosophy.link.id","contact-email-inline")||"contact-email-inline",o=ua("philosophy.link.href","#")||"#",n=ua("philosophy.link.text","")||"";let i=document.getElementById(a);if(i||(i=e.querySelector("a")),!i)return;i.id=a,i.setAttribute("href",o),i.textContent=n;const r=i.previousSibling;r&&r.nodeType===Node.TEXT_NODE?r.nodeValue=t:e.insertBefore(document.createTextNode(t),i);const l=i.nextSibling;l&&l.nodeType===Node.TEXT_NODE&&(l.nodeValue="")})(),(()=>{wa(document.getElementById("footer-links-container"),"aria-label",ua("footer.navAriaLabel",""));const e=ua("footer.links",null);if(e&&"object"==typeof e)for(const t of["contact","portfolio","cv"]){const a=e?.[t];if(!a)continue;const o=document.getElementById(a.id||"");o&&(a.href&&o.setAttribute("href",a.href),a.text&&(o.textContent=a.text))}})(),(()=>{const e=document.getElementById("social-links");wa(e,"aria-label",ua("socials.ariaLabel",""));const t=ua("socials.items",null);if(!e||!t||"object"!=typeof t)return;const a=["appleMusic","x","linkedin"],o=e.querySelectorAll("a.footer_icon-link");for(let n=0;o.length>n&&3>n;n++){const e=o[n],i=t?.[a[n]];if(!i)continue;i.url&&e.setAttribute("href",i.url),i.ariaLabel&&e.setAttribute("aria-label",i.ariaLabel);const r=e.querySelector(".screen-reader");r&&i.screenReaderText&&(r.textContent=i.screenReaderText)}})(),(()=>{const e=document.getElementById("header-cv-link");if(!e)return;const t=ua("footer.links.cv",null);t&&"object"==typeof t&&(t.href&&e.setAttribute("href",t.href),t.text&&(e.textContent=t.text))})(),(()=>{const e=document.querySelector("[data-portfolio-ui] .decorative-script p");if(!e)return;const t=ua("portfolio.blurb","");t&&(e.textContent=t)})()}catch(e){}})()}catch(e){}if(et()?at():(({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"]}={})=>{et()||at({sentence:e,ascii:t,silence:!0})})(),et())try{const e=await Promise.resolve().then(()=>an);e.setApplyVisualCSSVars?.(Sa)}catch(e){}try{et()&&$o.groupCollapsed("BouncyBalls bootstrap"),nt("bb:start"),ot("🚀 Initializing modular bouncy balls...");const t=await(async()=>{try{try{if("undefined"!=typeof window&&window.__RUNTIME_CONFIG__&&"object"==typeof window.__RUNTIME_CONFIG__)return window.__RUNTIME_CONFIG__}catch(e){}const t=["config/default-config.json","js/config.json","../public/js/config.json"];for(const a of t)try{const e=await fetch(a,{cache:"no-cache"});if(e.ok)return await e.json()}catch(e){}throw Error("No config found")}catch(e){return console.warn("Config load failed, using defaults"),{gravityMultiplier:1.05,ballMass:91,maxBalls:300}}})();c(t),nt("bb:config"),ot("✓ Config loaded");try{const e=d();"undefined"!=typeof window&&(window.REST=e.REST,window.FRICTION=e.FRICTION,window.MAX_BALLS=e.maxBalls,window.repelRadius=e.repelRadius,window.repelPower=e.repelPower)}catch(e){}s(),ot("✓ Layout applied"),Sa(t),ot("✓ Visual effects configured"),(()=>{const e=document.querySelector(".noise");if(!e)return;const t=e.closest("#bravia-balls")||document.getElementById("bravia-balls")||e.parentElement||document.body,a=getComputedStyle(e),o=a.backgroundImage&&"none"!==a.backgroundImage?a.backgroundImage:null;if(!document.querySelector(".noise-2")){const e=document.createElement("div");e.className="noise-2",o&&(e.style.backgroundImage=o),t.appendChild(e),console.log("✓ Created .noise-2 element")}if(!document.querySelector(".noise-3")){const e=document.createElement("div");e.className="noise-3",o&&(e.style.backgroundImage=o),t.appendChild(e),console.log("✓ Created .noise-3 element")}})(),ue();const a=fe(),o=me(),n=document.getElementById("bravia-balls");if(!a||!o||!n)throw Error("Missing DOM elements");try{const e=document.getElementById("brand-logo");e&&e.parentElement!==n&&n.prepend(e)}catch(e){}try{a.setAttribute("role","application"),a.getAttribute("aria-label")||a.setAttribute("aria-label","Interactive bouncy balls physics simulation")}catch(e){}u(a,o,n),he(),nt("bb:renderer"),ot("✓ Canvas initialized (container-relative sizing)"),d().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),(()=>{function t(e=1200){m=!0;const t=performance.now();b=Math.max(b,t+e)}function a(e){return!(!e||!e.closest||!(e.closest("#panelDock")||e.closest("#masterPanel")||e.closest("#dockToggle")||e.closest(".panel-dock")||e.closest(".panel")))}function o(e,t){if(g>0||performance.now()<b){const a=u.getBoundingClientRect();return{x:(e-a.left)*h,y:(t-a.top)*h,inBounds:!(a.left>e||e>a.right||a.top>t||t>a.bottom)}}return!m&&f||(f=u.getBoundingClientRect(),m=!1),{x:(e-f.left)*h,y:(t-f.top)*h,inBounds:!(f.left>e||e>f.right||f.top>t||t>f.bottom)}}function n(e,t,n,{isMouseLike:i}={isMouseLike:!0}){if(i?_t(e,t):Gt(),p.currentMode!==Ca.ORBIT_3D&&p.currentMode!==Ca.ORBIT_3D_2&&a(n))return;if(ta())return;const r=o(e,t),l=performance.now(),s=l-Wn;if(s>0&&Wn>0){const e=r.x-Bn,t=r.y-$n;_n=Math.sqrt(e*e+t*t)/s}p.mouseX=r.x,p.mouseY=r.y,p.mouseInCanvas=r.inBounds,"undefined"!=typeof window&&(window.mouseInCanvas=r.inBounds);const c=Math.hypot(r.x-(p.lastPointerMoveX??r.x),r.y-(p.lastPointerMoveY??r.y));c>.5&&(p.lastPointerMoveMs=l,p.lastPointerMoveX=r.x,p.lastPointerMoveY=r.y),i&&c>.5&&((e,t,a,o)=>{const n=d();if(!n?.mouseTrailEnabled)return;if(!o)return;if(Xe())return;if((e=>{const t=Math.max(0,0|e);t>0&&(Lo===t&&Io&&Ao&&Ko||(Lo=t,Io=new Float32Array(Lo),Ao=new Float32Array(Lo),Ko=new Float64Array(Lo),Oo=0,Ro=0))})(qe(0|(n.mouseTrailLength??18),4,96)),!Lo)return;const i=n.DPR||1,r=qe(+(n.mouseTrailSize??1.3),.5,10)*i,l=Math.max(.35,.55*r),s=l*l;if(Ro>0){const o=(Oo-1+Lo)%Lo;if(((e,t,a,o)=>{const n=e-a,i=t-o;return n*n+i*i})(e,t,Io[o],Ao[o])<s)return void(Ko[o]=a)}Io[Oo]=e,Ao[Oo]=t,Ko[Oo]=a,Oo=(Oo+1)%Lo,Lo>Ro&&Ro++})(r.x,r.y,l,r.inBounds),p.currentMode===Ca.WATER&&r.inBounds&&_n>.3&&l-qn>80&&(ae(r.x,r.y,Math.min(2*_n,3)),qn=l),Bn=r.x,$n=r.y,Wn=l}function i(){if(p?.isMobile||p?.isMobileViewport)return!0;try{return!(!window.matchMedia||!window.matchMedia("(max-width: 768px)").matches)}catch(e){return!1}}function r(){if(Xn){try{window.clearTimeout(Xn)}catch(e){}Xn=0}}function l(e,t,n,l=null){Gn||a(n)||(e=>!(!e||!e.closest||!(e.closest("a")||e.closest("button")||e.closest("input")||e.closest("select")||e.closest("textarea"))))(n)||ta()||p.clickCycleEnabled&&o(e,t).inBounds&&(Gn=!0,Nn=l,Hn=e,jn=t,Zn=0,Yn=!1,r(),i()||(Yn=!0,ra(1,{armManual:!0,scheduleRelease:!1})))}function s(e=null,t="mouse"){if(!Gn)return;if(null!==Nn&&null!==e&&e!==Nn)return;const a=Zn;Gn=!1,Nn=null,Zn=0;const o=Yn;if(Yn=!1,"touch"!==t&&"pen"!==t||15>=a){if(i()){ra(1,{armManual:!0,scheduleRelease:!1});const e=Math.max(1,Math.round(.8*(+(p.sceneImpactPressMs??75)||0))),t=Math.round(Math.min(80,Math.max(0,.4*(+e||0))));return r(),void(Xn=window.setTimeout(()=>{Xn=0,ca(),la()},Math.max(0,Math.round(e)+t)))}ca(),la()}else o&&la()}function c(e=null){Gn&&(null!==Nn&&null!==e&&e!==Nn||(Gn=!1,Nn=null,Zn=0,r(),Yn&&la(),Yn=!1))}const p=d(),u=p.canvas;if(void 0===p.clickCycleEnabled&&(p.clickCycleEnabled=!1),!u)return void console.error("Canvas not available for pointer setup");const h=p.DPR;let f=null,m=!0,g=0,b=0;try{window.addEventListener("resize",()=>{m=!0},{passive:!0})}catch(e){}try{const e=e=>!e||"transform"===e||"top"===e||"left"===e||"right"===e||"bottom"===e||"width"===e||"height"===e,a=(a,o)=>{if(!a||!a.addEventListener)return;a.addEventListener("transitionrun",a=>{e(a?.propertyName)&&(g++,t(o))});const n=a=>{e(a?.propertyName)&&(g=Math.max(0,g-1),t(120))};a.addEventListener("transitionend",n),a.addEventListener("transitioncancel",n)};a(document.getElementById("abs-scene"),600),a(document.getElementById("bravia-balls"),1200)}catch(e){}document.addEventListener("mousemove",e=>{window.PointerEvent||n(e.clientX,e.clientY,e.target,{isMouseLike:!0})},{passive:!0}),document.addEventListener("pointermove",e=>{n(e.clientX,e.clientY,e.target,{isMouseLike:"mouse"===e.pointerType||"pen"===e.pointerType})},{passive:!0}),window.PointerEvent?(document.addEventListener("pointerdown",e=>{l(e.clientX,e.clientY,e.target,e.pointerId)},{passive:!0}),document.addEventListener("pointermove",e=>{Gn&&Nn===e.pointerId&&(Zn=Math.max(Zn,Math.hypot(e.clientX-Hn,e.clientY-jn)))},{passive:!0}),document.addEventListener("pointerup",e=>{s(e.pointerId,e.pointerType)},{passive:!0}),document.addEventListener("pointercancel",e=>{c(e.pointerId)},{passive:!0})):(document.addEventListener("mousedown",e=>{l(e.clientX,e.clientY,e.target,null)},{passive:!0}),document.addEventListener("mouseup",()=>{s(null,"mouse")},{passive:!0})),document.addEventListener("touchmove",e=>{if(!ta()&&e.touches&&e.touches[0]){const t=o(e.touches[0].clientX,e.touches[0].clientY);p.mouseX=t.x,p.mouseY=t.y,p.mouseInCanvas=t.inBounds;const a=performance.now();Math.hypot(t.x-(p.lastPointerMoveX??t.x),t.y-(p.lastPointerMoveY??t.y))>.5&&(p.lastPointerMoveMs=a,p.lastPointerMoveX=t.x,p.lastPointerMoveY=t.y),p.currentMode===Ca.WATER&&t.inBounds&&a-qn>80&&(ae(t.x,t.y,2),qn=a)}},{passive:!0}),document.addEventListener("touchstart",e=>{if(!window.PointerEvent&&!a(e.target)&&!ta()&&(Gt(),!e.target.closest("a")&&!e.target.closest("button")&&!e.target.closest("input")&&!e.target.closest("select")&&!e.target.closest("textarea")&&e.touches&&e.touches[0])){const t=e.touches[0];if(!o(t.clientX,t.clientY).inBounds)return;p.clickCycleEnabled&&(Gn=!0,Nn=null,Hn=t.clientX,jn=t.clientY,Zn=0)}},{passive:!0}),document.addEventListener("touchmove",e=>{if(!window.PointerEvent&&Gn&&e.touches&&e.touches[0]){const t=e.touches[0];Zn=Math.max(Zn,Math.hypot(t.clientX-Hn,t.clientY-jn))}},{passive:!0}),document.addEventListener("touchend",()=>{window.PointerEvent||s(null,"touch")},{passive:!0}),document.addEventListener("touchcancel",()=>{window.PointerEvent||c(null)},{passive:!0}),document.addEventListener("mouseleave",()=>{p.mouseX=Fa.OFFSCREEN_MOUSE,p.mouseY=Fa.OFFSCREEN_MOUSE,p.mouseInCanvas=!1,_n=0,"undefined"!=typeof window&&(window.mouseInCanvas=!1),Gt()}),document.addEventListener("mouseenter",()=>{Nt()}),document.addEventListener("touchend",()=>{p.mouseX=Fa.OFFSCREEN_MOUSE,p.mouseY=Fa.OFFSCREEN_MOUSE,p.mouseInCanvas=!1},{passive:!0}),console.log("✓ Unified pointer system configured (document-level)"),p._=!0,"undefined"!=typeof window&&(window._=!0)})(),ot("✓ Pointer tracking configured"),"undefined"!=typeof document&&document.addEventListener("touchmove",e=>{var t;(t=e.target)instanceof Element&&(t.closest(".panel-dock .panel .panel-content")||t.closest("#controlPanel"))||e.preventDefault()},{passive:!1,capture:!0}),ot("✓ Overscroll lock configured"),$t(),nt("bb:input"),ot("✓ Custom cursor initialized"),(()=>{if("undefined"!=typeof window&&"undefined"!=typeof document&&(Kn=document.querySelector("#abs-scene")||null,Kn&&(Kn.style.setProperty(Ln,"0"),Kn.style.setProperty(In,"100ms"),Kn.style.setProperty(An,"1"),oa(),!(()=>{try{return!(!window.matchMedia||!window.matchMedia("(prefers-reduced-motion: reduce)").matches)}catch(e){return!1}})()))){On=!0,Kn.classList.add("abs-scene--impact");try{window.addEventListener("resize",oa,{passive:!0})}catch(e){}window.addEventListener("bb:modeChanged",e=>{const t=d();if(!1===t?.sceneImpactEnabled)return;if(En)return void(En=!1);const a=e?.detail||{};((e=1,t={})=>{if(!On||!Kn)return;const a=d();if(!1===a?.sceneImpactEnabled)return;const o=Math.max(0,Math.min(1,+e||0)),n=++Rn;ia(),Kn.classList.add("abs-scene--animating"),t?.armManual&&(En=!0);const i=a?.sceneImpactPressMs??75,r=a?.sceneImpactReleaseMs??220,l=Math.max(1,Math.round(.8*(+i||0))),s=Math.max(1,Math.round(1.2*(+r||0))),c=Math.round(Math.min(80,Math.max(0,.4*(+l||0))));Kn.style.setProperty(In,Math.round(l)+"ms"),window.requestAnimationFrame(()=>{On&&Kn&&n===Rn&&(Kn.style.setProperty(Ln,o+""),Kn.style.setProperty(An,na(o,a)+""))}),zn=window.setTimeout(()=>{sa({token:n,releaseMs:s})},Math.max(0,Math.round(l)+c)),Vn=window.setTimeout(()=>{Vn=0,Kn&&Kn.classList.remove("abs-scene--animating")},Math.max(0,Math.round(l)+c+Math.round(s)+80))})(a.prevMode&&a.mode&&a.prevMode!==a.mode?1:.75,{armManual:!1})},{passive:!0})}})(),console.log("⚠️ localStorage is disabled - using defaults"),K();try{(e=>{const t=e&&"object"==typeof e?e:null;if(!t)return;if("string"==typeof t.soundPreset&&G(t.soundPreset),t.soundConfig&&"object"==typeof t.soundConfig)return void _(t.soundConfig);const a={};let o=!1;for(const[n,i]of Object.entries(t))n in Ba&&(a[n]=i,o=!0);o&&_(a)})(t)}catch(e){}if(ot("✓ Sound engine primed (awaiting user unlock)"),"undefined"!=typeof window&&(ui||(ui=!0,window.addEventListener("bb:modeChanged",e=>{const t=d();if(!1===t?.sceneChangeSoundEnabled)return;const a=e?.detail||{};a.prevMode&&a.mode&&a.prevMode!==a.mode&&R(+(t?.sceneChangeSoundRadius??18),+(t?.sceneChangeSoundIntensity??.35),.5,null)},{passive:!0}))),et())try{const e=await Promise.resolve().then(()=>Mn);e.createPanelDock?.();const t=await Promise.resolve().then(()=>Va);t.populateColorSelect?.()}catch(e){}nt("bb:ui"),ot(et()?"✓ Panel dock created (Sound + Controls)":"✓ UI initialized (panel disabled in production)"),ht(),nt("bb:theme"),va(),yn||(yn=!0,window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName))return;const t=e.key.toLowerCase();if("/"===t||"Slash"===e.code)return e.preventDefault(),void Et();if("r"!==t)return"ArrowRight"===e.key?(e.preventDefault(),void Bt(1)):"ArrowLeft"===e.key?(e.preventDefault(),void Bt(-1)):void 0;e.preventDefault(),He();try{Tt(d().currentMode)}catch(e){}})),ot("✓ Keyboard shortcuts registered"),qt(t),ot("✓ Gate overlay system initialized"),(()=>{const t=document.getElementById("cv-gate-trigger"),a=document.getElementById("brand-logo"),o=document.getElementById("cv-gate"),n=document.getElementById("portfolio-gate"),i=document.getElementById("contact-gate"),r=Array.from(document.querySelectorAll(".cv-digit")),l=document.getElementById("page-flash"),s=document.getElementById("cv-gate-label");if(!t||!a||!o||0===r.length)return void console.warn("CV Gate: Missing required elements");const c=ua("gates.common.backText","BACK"),d=ua("gates.common.backAriaLabel","Back"),p=ua("gates.cv.title","Bio/CV"),u=ua("gates.cv.description","Because spam bots don't deserve nice things—and neither do recruiters who don't read portfolios. This keeps my inbox slightly more civilized.");s&&(s.innerHTML=`\n            <div class="gate-nav">\n                <button type="button" class="gate-back" data-gate-back aria-label="${d}">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>${c}</span>\n                </button>\n            </div>\n            <h2 class="gate-title">${p}</h2>\n            <p class="gate-description">${u}</p>\n        `);const h=l||(()=>{const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e})();let f=!1;const m=()=>o&&o.classList.contains("active")||n&&n.classList.contains("active")||i&&i.classList.contains("active"),g=e=>{e?.preventDefault?.();const t=m();n&&n.classList.contains("active")&&(n.classList.remove("active"),n.setAttribute("aria-hidden","true"),setTimeout(()=>{n.classList.add("hidden"),Zt(n)},400)),i&&i.classList.contains("active")&&(i.classList.remove("active"),i.setAttribute("aria-hidden","true"),setTimeout(()=>{i.classList.add("hidden"),Zt(i)},400)),f=!0,t||Qt(),a.classList.add("fade-out-up"),jt(o),o.classList.remove("hidden"),o.setAttribute("aria-hidden","false"),o.classList.add("active"),r[0].focus()},b=(e=!1)=>{f=!1,r.forEach(e=>e.value=""),e?(o.style.transition="none",a.style.transition="none",o.classList.remove("active"),o.setAttribute("aria-hidden","true"),o.classList.add("hidden"),Zt(o),a.classList.remove("fade-out-up"),m()||ea(),requestAnimationFrame(()=>{o.style.removeProperty("transition"),a.style.removeProperty("transition")})):(o.classList.remove("active"),o.setAttribute("aria-hidden","true"),a.classList.remove("fade-out-up"),setTimeout(()=>{f||(o.classList.add("hidden"),Zt(o)),m()||ea()},400))};try{const e=s?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",b)}catch(e){}o.addEventListener("click",e=>{(e.target===o||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&b(!0)});const M=()=>{const e=r.map(e=>e.value).join("");4===e.length&&("1111"===e?(ha(h,"success"),setTimeout(()=>{window.location.href="cv.html"},500)):(ha(h,"error"),setTimeout(()=>{r.forEach(e=>e.value=""),r[0].focus()},350)))};t.addEventListener("click",g);try{sessionStorage.getItem("abs_open_cv_gate")&&(sessionStorage.removeItem("abs_open_cv_gate"),setTimeout(()=>g(),300))}catch(e){}document.addEventListener("keydown",e=>{"Escape"===e.key&&f&&b()}),document.addEventListener("gate-overlay-dismiss",e=>{f&&b(e.detail?.instant||!1)}),r.forEach((e,t)=>{e.addEventListener("keydown",a=>{"Backspace"===a.key&&""===e.value&&(t>0?r[t-1].focus():b())}),e.addEventListener("input",e=>{const a=e.target.value;if(/^\d*$/.test(a)){if(1===a.length)r.length-1>t?r[t+1].focus():M();else if(a.length>1){const o=a.split("");e.target.value=o[0];let n=t+1;for(let e=1;o.length>e&&r.length>n;e++)r[n].value=o[e],n++;r.length>n?r[n].focus():M()}}else e.target.value=a.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})})(),ot("✓ CV password gate initialized"),(()=>{const t=document.getElementById("portfolio-gate-trigger"),a=document.getElementById("portfolio-gate"),o=document.getElementById("brand-logo"),n=document.getElementById("cv-gate"),i=document.getElementById("contact-gate"),r=Array.from(document.querySelectorAll(".portfolio-digit")),l=document.getElementById("page-flash"),s=document.getElementById("portfolio-gate-label");if(!t||!a||0===r.length)return void console.warn("Portfolio Gate: Missing required elements");const c=ua("gates.common.backText","BACK"),d=ua("gates.common.backAriaLabel","Back"),p=ua("gates.portfolio.title","View Portfolio"),u=ua("gates.portfolio.description","Good work deserves good context. This small step ensures you're here with intention, not just browsing. Quality takes time—yours and mine.");s&&(s.innerHTML=`\n            <div class="gate-nav">\n                <button type="button" class="gate-back" data-gate-back aria-label="${d}">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>${c}</span>\n                </button>\n            </div>\n            <h2 class="gate-title">${p}</h2>\n            <p class="gate-description">${u}</p>\n        `);const h=l||(()=>{const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e})();let f=!1;const m=()=>a&&a.classList.contains("active")||n&&n.classList.contains("active")||i&&i.classList.contains("active"),g=e=>{e&&e.preventDefault();const t=m(),l=document.createElement("link");l.rel="prefetch",l.href="js/portfolio-bundle.js",document.head.appendChild(l);const s=document.createElement("link");s.rel="preload",s.as="image",s.href="images/portfolio/pages/chapter-0-1.webp",document.head.appendChild(s),n&&n.classList.contains("active")&&(n.classList.remove("active"),n.setAttribute("aria-hidden","true"),setTimeout(()=>{n.classList.add("hidden"),Zt(n)},400)),i&&i.classList.contains("active")&&(i.classList.remove("active"),i.setAttribute("aria-hidden","true"),setTimeout(()=>{i.classList.add("hidden"),Zt(i)},400)),f=!0,t||Qt(),o&&o.classList.add("fade-out-up"),jt(a),a.classList.remove("hidden"),a.setAttribute("aria-hidden","false"),a.classList.add("active"),r[0].focus()},b=(e=!1)=>{f=!1,r.forEach(e=>e.value=""),e?(a.style.transition="none",o&&(o.style.transition="none"),a.classList.remove("active"),a.setAttribute("aria-hidden","true"),a.classList.add("hidden"),Zt(a),o&&o.classList.remove("fade-out-up"),m()||ea(),requestAnimationFrame(()=>{a.style.removeProperty("transition"),o&&o.style.removeProperty("transition")})):(a.classList.remove("active"),a.setAttribute("aria-hidden","true"),o&&o.classList.remove("fade-out-up"),setTimeout(()=>{f||(a.classList.add("hidden"),Zt(a)),m()||ea()},400))};try{const e=s?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",b)}catch(e){}a.addEventListener("click",e=>{(e.target===a||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&b(!0)});const M=()=>{const e=r.map(e=>e.value).join("");4===e.length&&("1234"===e?(fa(h,"success"),sessionStorage.setItem("abs_portfolio_ok",Date.now()),setTimeout(()=>{window.location.href="portfolio.html"},500)):(fa(h,"error"),setTimeout(()=>{r.forEach(e=>e.value=""),r[0].focus()},350)))};sessionStorage.getItem("abs_open_portfolio_gate")&&(sessionStorage.removeItem("abs_open_portfolio_gate"),setTimeout(()=>g(),300)),t.addEventListener("click",g),document.addEventListener("keydown",e=>{"Escape"===e.key&&f&&b()}),document.addEventListener("gate-overlay-dismiss",e=>{f&&b(e.detail?.instant||!1)}),r.forEach((e,t)=>{e.addEventListener("keydown",a=>{"Backspace"===a.key&&""===e.value&&(t>0?r[t-1].focus():b())}),e.addEventListener("input",e=>{const a=e.target.value;if(/^\d*$/.test(a)){if(1===a.length)r.length-1>t?r[t+1].focus():M();else if(a.length>1){const o=a.split("");e.target.value=o[0];let n=t+1;for(let e=1;o.length>e&&r.length>n;e++)r[n].value=o[e],n++;r.length>n?r[n].focus():M()}}else e.target.value=a.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})})(),ot("✓ Portfolio password gate initialized"),(()=>{const t=ua("contact.email","alexander@beck.fyi"),a=ua("gates.common.backText","BACK"),o=ua("gates.common.backAriaLabel","Back"),n=ua("gates.contact.title","Contact"),i=ua("gates.contact.description","For collaborations, product design work, AI prototyping, or anything that needs a crisp creative + technical brain."),r=ua("contact.copy.buttonAriaLabel","Copy email address"),l=ua("contact.copy.statusCopied","Copied"),s=ua("contact.copy.statusError","Copy failed"),c=[document.getElementById("contact-email"),document.getElementById("contact-email-inline")].filter(Boolean),d=document.getElementById("brand-logo"),p=document.getElementById("contact-gate"),u=document.getElementById("contact-gate-label"),h=document.getElementById("contact-gate-inputs"),f=document.getElementById("cv-gate"),m=document.getElementById("portfolio-gate");if(!(c.length&&d&&p&&u&&h))return void console.warn("Contact Gate: Missing required elements");u.innerHTML=`\n    <div class="gate-nav">\n      <button type="button" class="gate-back" data-gate-back aria-label="${o}">\n        <i class="ti ti-arrow-left" aria-hidden="true"></i>\n        <span>${a}</span>\n      </button>\n    </div>\n    <h2 class="gate-title">${n}</h2>\n    <p class="gate-description">\n      ${i}\n    </p>\n  `,h.innerHTML=`\n    <div class="contact-email-row" data-email-row>\n      <button type="button" class="contact-email-value" data-copy-email aria-label="${r}">\n        <span class="contact-email-text">${t}</span>\n      </button>\n      <button type="button" class="contact-email-copy" data-copy-email-icon aria-label="${r}">\n        <i class="ti ti-copy" aria-hidden="true"></i>\n      </button>\n    </div>\n    <div class="contact-copy-status" data-copy-status aria-live="polite"></div>\n  `;const g=u.querySelector("[data-gate-back]"),b=h.querySelector("[data-copy-email]"),M=h.querySelector("[data-copy-email-icon]"),y=h.querySelector("[data-email-row]"),v=h.querySelector("[data-copy-status]"),x=h.querySelector(".contact-email-copy i");let w=!1,S=null;const C=()=>p&&p.classList.contains("active")||f&&f.classList.contains("active")||m&&m.classList.contains("active"),k=e=>{if(b&&M&&v){if(S&&window.clearTimeout(S),"copied"===e)return y?.classList?.add?.("is-copied"),y?.classList?.remove?.("is-error"),v.textContent=l,x&&(x.className="ti ti-check"),void(S=window.setTimeout(()=>k("idle"),1200));if("error"===e)return y?.classList?.add?.("is-error"),y?.classList?.remove?.("is-copied"),v.textContent=s,x&&(x.className="ti ti-alert-triangle"),void(S=window.setTimeout(()=>k("idle"),1200));y?.classList?.remove?.("is-copied","is-error"),v.textContent="",x&&(x.className="ti ti-copy")}},P=e=>{e?.preventDefault?.();const t=C();f&&f.classList.contains("active")&&(f.classList.remove("active"),f.setAttribute("aria-hidden","true"),setTimeout(()=>{f.classList.add("hidden"),Zt(f)},400)),m&&m.classList.contains("active")&&(m.classList.remove("active"),m.setAttribute("aria-hidden","true"),setTimeout(()=>{m.classList.add("hidden"),Zt(m)},400)),w=!0,t||Qt(),k("idle"),d.classList.add("fade-out-up"),jt(p),p.classList.remove("hidden"),p.setAttribute("aria-hidden","false"),p.classList.add("active"),b?.focus?.()},F=(e=!1)=>{w=!1,k("idle"),e?(p.style.transition="none",d.style.transition="none",p.classList.remove("active"),p.setAttribute("aria-hidden","true"),p.classList.add("hidden"),Zt(p),d.classList.remove("fade-out-up"),C()||ea(),requestAnimationFrame(()=>{p.style.removeProperty("transition"),d.style.removeProperty("transition")})):(p.classList.remove("active"),p.setAttribute("aria-hidden","true"),d.classList.remove("fade-out-up"),setTimeout(()=>{w||(p.classList.add("hidden"),Zt(p)),C()||ea()},400))};c.forEach(e=>e.addEventListener("click",P,{capture:!0})),g?.addEventListener("click",F),p.addEventListener("click",e=>{(e.target===p||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&F(!0)});const D=async()=>{const a=await(async t=>{try{if(navigator?.clipboard?.writeText)return await navigator.clipboard.writeText(t),!0}catch(e){}try{const e=document.createElement("textarea");e.value=t,e.setAttribute("readonly","true"),e.style.position="fixed",e.style.left="-9999px",e.style.top="0",document.body.appendChild(e),e.select();const a=!0===document.execCommand?.("copy");return document.body.removeChild(e),a}catch(e){return!1}})(t);k(a?"copied":"error")};b?.addEventListener("click",D),M?.addEventListener("click",D),document.addEventListener("keydown",e=>{"Escape"===e.key&&w&&F()}),document.addEventListener("gate-overlay-dismiss",e=>{w&&F(e.detail?.instant||!1)});try{sessionStorage.getItem("abs_open_contact_gate")&&(sessionStorage.removeItem("abs_open_contact_gate"),requestAnimationFrame(()=>P()))}catch(e){}})(),ot("✓ Contact gate initialized"),(()=>{const e=document.getElementById("social-links");if(!e)return;if(e.querySelector("i.ti"))return;const t=Array.from(e.querySelectorAll("a.footer_icon-link[aria-label]"));for(const a of t){const e=(a.getAttribute("aria-label")||"").trim().toLowerCase(),t=di.get(e);if(!t)continue;const o=a.querySelector("svg");o?(a.insertAdjacentHTML("afterbegin",t),o.remove()):a.insertAdjacentHTML("afterbegin",t)}})(),(()=>{function e(){t.textContent=o.format(new Date).toUpperCase()}const t=document.getElementById("time-display"),a=document.getElementById("site-year");if(!t)return;const o=new Intl.DateTimeFormat("en-GB",{timeZone:"Europe/London",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});e(),setInterval(e,1e3),a&&(a.style.cursor="pointer",a.addEventListener("click",ft))})(),(()=>{try{const e=document.getElementById("cv-gate-trigger");if(e&&!e.querySelector(".footer-link-nowrap")){const t=((ua("footer.links.cv.text","")||"")+"").trim(),a=(e.textContent||"").trim().replace(/\s+/g," "),o=t||a;o&&o.includes("/")&&a===o&&(e.innerHTML=`<span class="footer-link-nowrap">${o}</span>`)}}catch(e){}})(),(()=>{if(K(),"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return console.log("⏸ Sound toggle hidden (prefers-reduced-motion)"),null;ci=document.createElement("button"),ci.className="sound-toggle",ci.id="sound-toggle",ci.type="button",ci.setAttribute("aria-label","Toggle collision sounds"),ci.setAttribute("aria-pressed","false"),ci.setAttribute("data-enabled","false"),ci.innerHTML=si,ci.title="Sound off",ci.addEventListener("click",ma);const t=document.getElementById("fade-content"),a=document.getElementById("sound-toggle-slot"),o=document.getElementById("top-elements-soundRow"),n=document.getElementById("social-links"),i=document.querySelector(".ui-meta-right"),r=!!a,l=n&&(!t||t.contains(n)),s="undefined"!=typeof window&&"function"==typeof window.matchMedia&&window.matchMedia("(max-width: 600px)").matches,c=t=>{if(!t)return!1;try{ci.parentElement&&ci.parentElement!==t&&ci.parentElement.removeChild(ci)}catch(e){}if(t.classList.contains("ui-meta-right")){const e=t.querySelector("time");if(e)return t.insertBefore(ci,e),!0}return t.appendChild(ci),!0};if(s&&o)ci.classList.add("sound-toggle--top"),ci.classList.add("sound-toggle--topwide"),c(o);else if(r)ci.classList.add("sound-toggle--top"),c(a);else if(i)c(i);else if(l){const e=document.createElement("li");e.className="margin-bottom_none sound-toggle-item",ci.classList.add("sound-toggle--social"),e.appendChild(ci),n.appendChild(e)}else t?t.appendChild(ci):document.body.appendChild(ci);try{if("undefined"!=typeof window&&"function"==typeof window.matchMedia){const e=window.matchMedia("(max-width: 600px)"),t=()=>{const t=document.getElementById("top-elements-soundRow"),a=document.getElementById("sound-toggle-slot"),o=e.matches&&!!t;ci.classList.toggle("sound-toggle--topwide",o),o?c(t):a&&c(a)};"function"==typeof e.addEventListener?e.addEventListener("change",t):"function"==typeof e.addListener&&e.addListener(t)}}catch(e){}console.log("✓ Sound toggle created");try{const e=$();ga(!(!e.isUnlocked||!e.isEnabled))}catch(e){}"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(Qa,e=>{const t=e&&e.detail?e.detail:null;t&&ga(!(!t.isUnlocked||!t.isEnabled))})})(),ot("✓ Sound toggle button created"),ot("✓ Theme toggle button created");const i=Ca.PIT;P?.(),Ne(i);try{const e=await Promise.resolve().then(()=>on);e.updateModeButtonsUI?.(i)}catch(e){}nt("bb:mode"),ot("✓ Mode initialized"),xo=Qe;const r=()=>je();(e=>{function t(a){if(!ai)return void(oi=null);const o=a-ti;if(ni>o)return void(oi=requestAnimationFrame(t));ti=a-o%ni,(e=>{if(ii.push(e),ii.length>30&&ii.shift(),30===ii.length){const e=1e3/(ii.reduce((e,t)=>e+t,0)/30);30>e&&2>ri?(ri++,console.log(`⚡ Adaptive throttle increased to level ${ri} (avg FPS: ${e.toFixed(1)})`)):e>55&&ri>0&&(ri--,console.log(`⚡ Adaptive throttle decreased to level ${ri} (avg FPS: ${e.toFixed(1)})`))}})(o);const n=a/1e3;let i=Math.min(.033,n-ei);ei=n,(2>ri||Math.random()>.5)&&(async(e,t)=>{const a=d(),o=a.balls;if(!a.canvas)return;if(!o||0===o.length)return;const n=Math.max(0,Math.round(a.warmupFramesRemaining||0));if(n>0){a.warmupFramesRemaining=0,Vo=0;for(let e=0;n>e;e++)Je(Bo,t)}else Je(e,t)})(i,e),Qe(),(e=>{if(Jn++,e-Un>1e3){Qn=Jn,Jn=0,Un=e;const t=document.getElementById("render-fps");t&&(t.textContent=Qn+"")}})(performance.now()),oi=requestAnimationFrame(t)}document.addEventListener("visibilitychange",()=>{ai=!document.hidden,ai?(ei=performance.now()/1e3,ti=performance.now(),console.log("▶️ Animation resumed"),oi||(oi=requestAnimationFrame(t))):(console.log("⏸️ Animation paused (tab hidden)"),oi&&(cancelAnimationFrame(oi),oi=null))}),oi=requestAnimationFrame(t),console.log("✓ Render loop started (60fps throttle, visibility-aware)")})((e,t)=>{const a=r();a&&a(e,t)}),nt("bb:end"),ot("✅ Bouncy Balls running (modular)");const l=[{phase:"config",ms:it("bb:m:config","bb:start","bb:config")},{phase:"renderer",ms:it("bb:m:renderer","bb:config","bb:renderer")},{phase:"input",ms:it("bb:m:input","bb:renderer","bb:input")},{phase:"ui",ms:it("bb:m:ui","bb:input","bb:ui")},{phase:"theme",ms:it("bb:m:theme","bb:ui","bb:theme")},{phase:"mode+loop",ms:it("bb:m:mode","bb:theme","bb:mode")},{phase:"total",ms:it("bb:m:total","bb:start","bb:end")}].filter(e=>"number"==typeof e.ms);l.length&&(t=>{if(et())try{$o.table(t)}catch(e){}})(l.map(e=>({...e,ms:+e.ms.toFixed(2)}))),et()&&$o.groupEnd();const p=400,h=3e3,f="cubic-bezier(0.16, 1, 0.3, 1)",m=p+h+750,g=(e,t)=>{e.style.opacity="1",console.warn(`⚠️ Fade failsafe: forcing #fade-content visible (${t})`)};setTimeout(()=>{const e=document.getElementById("fade-content");if(!e)return void console.warn("⚠️ #fade-content not found (fade skipped)");if(window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches)return e&&(e.style.opacity="1"),void console.log("✓ Page fade-in skipped (prefers-reduced-motion)");if(e&&"function"!=typeof e.animate)return void g(e,"WAAPI unsupported");const t=(e=>e&&"function"==typeof e.animate?e.animate([{opacity:0},{opacity:1}],{duration:h,easing:f,fill:"forwards"}):null)(e);t?.addEventListener?.("finish",()=>{e&&(e.style.opacity="1"),console.log("✓ Page fade-in finished")}),t?.addEventListener?.("cancel",()=>{e&&g(e,"animation canceled")}),console.log("✓ Page fade-in started (WAAPI)"),setTimeout(()=>{e&&"0"===window.getComputedStyle(e).opacity&&g(e,"opacity still 0 after failsafe window")},m)},p)}catch(t){console.error("❌ Initialization failed:",t),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${t.message}\n${t.stack}</pre>\n    </div>`}})(),e.applyFramePaddingCSSVars=()=>{s()},e.applyVisualCSSVars=Sa})({});