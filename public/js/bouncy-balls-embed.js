(()=>{const t={PIT:"pit",FLIES:"flies",WEIGHTLESS:"weightless"},e={[t.PIT]:{desktop:!0,mobile:!0},[t.FLIES]:{desktop:!0,mobile:!0},[t.WEIGHTLESS]:{desktop:!0,mobile:!0}};let n=t.PIT,i=40,a=1.1,o=!0,s=1e3,l=150,r=1,d=80,h=200,c=.98,u=300,m=150;const f=-1e9,g=1e-4,p=.25;function y(){return 0===i?0:i/40*.2}const x=document.getElementById("c"),v=x.getContext("2d",{alpha:!0}),E=document.getElementById("controlPanel"),I=Math.max(1,Math.min(2,window.devicePixelRatio||1));let M=50,b=-50,S=100,B=50;function C(){const t=1.5*window.innerHeight;x.width=Math.floor(window.innerWidth*I),x.height=Math.floor(t*I)}C(),window.addEventListener("resize",()=>{C(),Y(),Z()});const w=1960;let L=1.1,T=w*L,V=.88,F=.003,R=.03,P=400;const A=.5*I,q=6,z=24;let k=1,G=.15,N=1,U=null,W=11.2;const D=.15;let H=1;function O(){H=Math.max(.5,Math.min(3,Math.pow(W/1,.35)))}O();let _=q*k,j=z*k;function Y(){N=(x.clientWidth||window.innerWidth)<=768?.4:1;const t=k*N;if(null===U)return U=t,_=q*t,void(j=z*t);const e=t/U;if(1!==e){for(let t=0;t<Vt.length;t++)Vt[t].r*=e;U=t}_=q*t,j=z*t}function Z(){vt=[];const t=document.querySelector(xt);if(!t)return;const e=t.getBoundingClientRect(),n=x.getBoundingClientRect(),i=function(t){const e=document.createElement("span");e.style.cssText=window.getComputedStyle(t).cssText,e.style.position="absolute",e.style.visibility="hidden",e.style.whiteSpace="nowrap",e.textContent="ABCDEFGHIJKLMNOPQRSTUVWXYZ",document.body.appendChild(e);const n=e.getBoundingClientRect().height;return document.body.removeChild(e),n}(t),a=.5*(e.height-i),o={x:(e.left-n.left)*I,y:(e.top-n.top+a)*I,width:e.width*I,height:i*I};o.width>0&&o.height>0&&o.x<x.width&&o.y<x.height&&o.x+o.width>0&&o.y+o.height>0&&vt.push(o)}let $=!0,X=0,J=1;const K={industrialTeal:{label:"Industrial Teal",colors:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"]},modern:{label:"Modern European",colors:["#9ca3af","#d1d5db","#ffffff","#ff3b30","#000000","#00e5ff","#1976d2","#ffc107"]},corporate:{label:"Corporate Modern",colors:["#a0a8b1","#d2d8de","#ffffff","#1a73e8","#000000","#ff5722","#7b1fa2","#ffa000"]},minimal:{label:"Helvetica Minimal",colors:["#bdbdbd","#e0e0e0","#ffffff","#6b7280","#000000","#40e0d0","#303f9f","#ff9800"]},euroBlue:{label:"European Blue",colors:["#9aa6b2","#d4dde5","#ffffff","#0a66c2","#000000","#ff4081","#388e3c","#ffb300"]},scandi:{label:"Scandinavian Bright",colors:["#aab2b7","#e6eaee","#ffffff","#74b9ff","#000000","#e91e63","#1976d2","#4caf50"]},neonCyan:{label:"Graphite Neon Cyan",colors:["#9aa0a6","#d5d9dd","#ffffff","#00e5ff","#000000","#ff9800","#9c27b0","#4caf50"]},coralTech:{label:"Coral Tech",colors:["#9da3a9","#d8dde2","#ffffff","#ff6b6b","#000000","#00e676","#3f51b5","#ff5722"]},violetMidnight:{label:"Violet Midnight",colors:["#9fa3b1","#d9dce3","#ffffff","#7c3aed","#000000","#e91e63","#388e3c","#ffb300"]},mintSage:{label:"Mint Sage",colors:["#a0a7a2","#dbe0dd","#ffffff","#00c896","#000000","#ff1744","#3f51b5","#ff9800"]},slateAzure:{label:"Slate Azure",colors:["#9aa3ad","#d8dee6","#ffffff","#3b82f6","#000000","#ff4081","#388e3c","#ffc107"]},vaporPop:{label:"Vapor Pop",colors:["#9ea0a8","#d6d7dc","#ffffff","#ff00e5","#000000","#00bcd4","#673ab7","#ff5722"]},cyberMagenta:{label:"Cyber Magenta",colors:["#9c9fad","#d6d9e3","#ffffff","#ff007a","#000000","#40e0d0","#1976d2","#ff9800"]},streetLime:{label:"Street Lime",colors:["#9aa19a","#d6dbd6","#ffffff","#baff00","#000000","#e91e63","#3f51b5","#ff6f00"]},cmykPop:{label:"CMYK Pop",colors:["#9f9f9f","#d9d9d9","#ffffff","#ffd400","#000000","#ff1744","#7b1fa2","#4caf50"]}};let Q="industrialTeal",tt=["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],et=5,nt=tt[et]||"#ff4013";function it(t=tt){try{const e=document.documentElement,n=(t&&t.length?t:tt).slice(0,8);for(let t=0;t<8;t++){const i=n[t]||"#ffffff";e.style.setProperty(`--ball-${t+1}`,i)}}catch(t){}}const at=[.5,.25,.12,.06,.03,.02,.01,.01];function ot(){try{if(!tt||0===tt.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let e=0;for(let n=0;n<Math.min(tt.length,at.length);n++)if(e+=at[n],t<=e)return tt[n];return tt[Math.min(tt.length-1,7)]}catch(t){return console.error("Error picking random color:",t),"#ffffff"}}let st=255,lt=274e3,rt=4.4,dt=f,ht=f,ct=!1,ut=!1;("ontouchstart"in window||navigator.maxTouchPoints>0)&&(ut=!0);const mt="bouncyBallsSettings";function ft(){const t={currentMode:n,gravityMultiplierPit:a,repellerEnabledPit:o,attractionPower:s,orbitRadius:l,swarmSpeed:r,sparkleEmissionRate:sparkleEmissionRate,sparkleLifetime:sparkleLifetime,sparkleVelocitySpread:sparkleVelocitySpread,sparkleDriftStrength:sparkleDriftStrength,sparkleParticleScale:sparkleParticleScale,weightlessInitialSpeed:h,weightlessBounce:c,weightlessMaxBalls:weightlessMaxBalls,weightlessRepellerPower:u,weightlessRepellerRadius:m,restitution:V,friction:F,sizeScale:k,sizeVariation:G,ballMassKg:W,ballSoftness:i,repelPower:lt,repelRadius:st,repelSoft:rt,cornerRadius:yt,motionBlur:trailFade,trailSubtlety:It,currentTemplate:Q,cursorBallColor:nt};try{localStorage.setItem(mt,JSON.stringify(t)),console.log("✓ Settings saved")}catch(t){console.warn("Could not save settings:",t)}}function gt(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(ft,500)}const pt=1e3;let yt=0;const xt="#hero-text";let vt=[],Et=.025,It=1.8,Mt=0,bt=0,St=0,Bt=0,Ct=0;const wt=document.getElementById("render-fps"),Lt=document.getElementById("physics-fps");class Tt{constructor(t,e,n,i){this.x=t,this.y=e,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=n,this.rBase=n,this.m=W,this.color=i,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1}step(e){this.t+=e,this.age+=e,this.vy+=T*H*e;const i=Math.max(.25,this.m/1),a=Math.max(0,1-F/i);this.vx*=a,this.vy*=a,0!==this.driftAx&&this.age<this.driftTime?this.vx+=this.driftAx*e/i:0!==this.driftAx&&(this.driftAx=0),function(e,i){n!==t.PIT?n!==t.FLIES?n===t.WEIGHTLESS&&function(t,e){if(dt===f||ht===f)return;if(u<=0||m<=0)return;const n=m*I,i=t.x-dt,a=t.y-ht,o=i*i+a*a;if(o>n*n)return;const s=Math.max(Math.sqrt(o),g),l=i/s,r=a/s,d=Math.max(0,1-s/n),h=u*d;t.vx+=l*h*e,t.vy+=r*h*e}(e,i):function(t,e){if(dt===f||ht===f)return;const n=dt-t.x,i=ht-t.y,a=n*n+i*i,o=Math.sqrt(a+1),l=n/o,d=i/o,h=4*s;t.vx+=l*h*e,t.vy+=d*h*e;const c=80*I;let u=0,m=0,g=0;for(let e=0;e<Vt.length;e++){const n=Vt[e];if(n===t)continue;const i=t.x-n.x,a=t.y-n.y,o=i*i+a*a;if(o<c*c&&o>0){const t=Math.sqrt(o),e=1-t/c;u+=i/t*e,m+=a/t*e,g++}}if(g>0){const n=15e3;t.vx+=u/g*n*e,t.vy+=m/g*n*e}if(Math.random()<.05){const e=Math.random()*Math.PI*2,n=800;t.vx+=Math.cos(e)*n,t.vy+=Math.sin(e)*n}t.vx+=1200*(Math.random()-.5)*e,t.vy+=1200*(Math.random()-.5)*e;const p=.5+1.5*Math.random(),y=1200*r*p*e;t.vx+=-d*y,t.vy+=l*y;const x=1400,v=Math.sqrt(t.vx*t.vx+t.vy*t.vy);v>x&&(t.vx=t.vx/v*x,t.vy=t.vy/v*x),t.vx*=.99,t.vy*=.99}(e,i):function(t,e){if(!ct)return;if(lt<=0||st<=0)return;const n=st*I,i=t.x-dt,a=t.y-ht,o=i*i+a*a;if(o>n*n)return;const s=Math.max(Math.sqrt(o),g),l=i/s,r=a/s,d=Math.max(0,1-s/n),h=20*lt*Math.pow(d,rt),c=Math.max(.25,t.m/1);t.vx+=l*h*e/c,t.vy+=r*h*e/c;t.vx+=10*(Math.random()-.5)*e,t.vy+=10*(Math.random()-.5)*e}(e,i)}(this,e),this.x+=this.vx*e,this.y+=this.vy*e;const o=Math.max(0,1-2*e);this.omega*=o,this.theta+=this.omega*e,this.theta>Math.PI?this.theta-=2*Math.PI:this.theta<-Math.PI&&(this.theta+=2*Math.PI);const l=Math.min(1,18*e);this.squashAmount+=(0-this.squashAmount)*l,this.squash=1-this.squashAmount}walls(t,e,n,i=V){const a=i;if(0===yt){if(this.y+this.r>e){this.y=e-this.r;const t=this.vy,i=this.vx-this.omega*this.r,o=Math.max(.25,this.m/1);this.omega+=i/this.r*p/o;const s=Math.max(0,1-1.5*n/o);this.vx*=s;const l=Math.abs(t)<70?0:a;this.vy=-this.vy*(l*Math.pow(1/this.m,D));const r=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(y(),.8*r),this.squash=1-this.squashAmount,this.squashNormalAngle=-Math.PI/2;const d=this.vx/this.r;this.omega+=(d-this.omega)*Math.min(1,8*n)}const i=e/3;if(this.y-this.r<i){this.y=i+this.r;const t=this.vy;this.vy=-this.vy*a;const e=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(y(),.8*e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI/2}if(this.x+this.r>t){this.x=t-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*a;const e=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(y(),.8*e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*a;const t=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(y(),.8*t),this.squash=1-this.squashAmount,this.squashNormalAngle=0}}else this.handleRoundedWallCollision(t,e);this.checkTextCollisions(n)}checkTextCollisions(t){for(let t=0;t<vt.length;t++){const e=vt[t],n=Math.max(e.x,Math.min(this.x,e.x+e.width)),i=Math.max(e.y,Math.min(this.y,e.y+e.height)),a=this.x-n,o=this.y-i,s=Math.sqrt(a*a+o*o);if(s<this.r)if(0===s){const t=this.x-e.x,n=e.x+e.width-this.x,i=this.y-e.y,a=e.y+e.height-this.y,o=Math.min(t,n,i,a);o===t?(this.x=e.x-this.r,this.vx=-Math.abs(this.vx)*V):o===n?(this.x=e.x+e.width+this.r,this.vx=Math.abs(this.vx)*V):o===i?(this.y=e.y-this.r,this.vy=-Math.abs(this.vy)*V):(this.y=e.y+e.height+this.r,this.vy=Math.abs(this.vy)*V)}else{const t=this.r-s,e=a/s,n=o/s;this.x+=e*t,this.y+=n*t;const i=this.vx*e+this.vy*n;if(i<0){this.vx-=2*i*e*V,this.vy-=2*i*n*V;const t=Math.min(1,Math.abs(i)/(70*this.r));this.squash=1-y()*t,this.squashDirX=Math.abs(e)>Math.abs(n)?1:0,this.squashDirY=Math.abs(n)>Math.abs(e)?1:0}}}}handleRoundedWallCollision(t,e){const n=yt,i=[{x:n,y:n},{x:t-n,y:n},{x:t-n,y:e-n},{x:n,y:e-n}];for(let a=0;a<i.length;a++){const o=i[a],s=this.x-o.x,l=this.y-o.y,r=Math.sqrt(s*s+l*l);if(this.isInCornerRegion(o,t,e,n)&&r+this.r>n){const t=n-(r-this.r);if(t>0&&r>0){const e=s/r,n=l/r;this.x+=e*t,this.y+=n*t;const i=this.vx*e+this.vy*n;this.vx-=2*i*e*V,this.vy-=2*i*n*V;const a=Math.min(1,Math.abs(i)/(90*this.r));this.squashAmount=Math.min(y(),.8*a),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.atan2(n,e)}}}if(this.y+this.r>e&&(this.x<n||this.x>t-n)&&(this.y=e-this.r,this.vy=-this.vy*(V*Math.pow(1/this.m,D))),this.y-this.r<0&&(this.x<n||this.x>t-n)&&(this.y=this.r,this.vy=-this.vy*V),this.x+this.r>t&&(this.y<n||this.y>e-n)){this.x=t-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(V*Math.pow(1/this.m,D));const e=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(y(),e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0&&(this.y<n||this.y>e-n)){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(V*Math.pow(1/this.m,D));const t=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(y(),t),this.squash=1-this.squashAmount,this.squashNormalAngle=0}this.y+this.r>e&&this.x>=n&&this.x<=t-n&&(this.y=e-this.r,this.vy=-this.vy*(V*Math.pow(1/this.m,D))),this.y-this.r<0&&this.x>=n&&this.x<=t-n&&(this.y=this.r,this.vy=-this.vy*(V*Math.pow(1/this.m,D))),this.x+this.r>t&&this.y>=n&&this.y<=e-n&&(this.x=t-this.r,this.vx=-this.vx*(V*Math.pow(1/this.m,D))),this.x-this.r<0&&this.y>=n&&this.y<=e-n&&(this.x=this.r,this.vx=-this.vx*(V*Math.pow(1/this.m,D)))}isInCornerRegion(t,e,n,i){return t.x===i&&t.y===i?this.x<=i&&this.y<=i:t.x===e-i&&t.y===i?this.x>=e-i&&this.y<=i:t.x===e-i&&t.y===n-i?this.x>=e-i&&this.y>=n-i:t.x===i&&t.y===n-i&&this.x<=i&&this.y>=n-i}draw(t){if(t.save(),t.translate(this.x,this.y),this.isSparkle){const e=performance.now()/1e3-this.spawnTime,n=Math.min(1,e/this.lifetime),i=Math.max(0,1-n);if(trailIntensity>0){const e=this.r*(1.5+2*trailIntensity),n=i*trailIntensity*.3;t.beginPath(),t.arc(0,0,e,0,2*Math.PI);const a=t.createRadialGradient(0,0,0,0,0,e),o=this.color,s=o.replace(/[\d\.]+\)$/g,`${n})`),l=o.replace(/[\d\.]+\)$/g,.5*n+")");a.addColorStop(0,s),a.addColorStop(.7,l),a.addColorStop(1,o.replace(/[\d\.]+\)$/g,"0)")),t.fillStyle=a,t.fill()}t.beginPath(),t.arc(0,0,this.r,0,2*Math.PI),t.fillStyle=this.color.replace(/[\d\.]+\)$/g,`${i})`),t.fill(),trailIntensity>.2&&(t.beginPath(),t.arc(.3*this.r,.3*-this.r,.15*this.r,0,2*Math.PI),t.fillStyle=`rgba(255, 255, 255, ${i*trailIntensity*.8})`,t.fill())}else{const e=Math.min(y(),Math.max(0,this.squashAmount));if(e>.001){const n=1+e,i=1/n;t.rotate(this.squashNormalAngle),t.scale(n,i),t.rotate(-this.squashNormalAngle)}t.beginPath(),t.arc(0,0,this.r,0,2*Math.PI),t.fillStyle=this.color,t.fill()}t.restore()}}const Vt=[];function Ft(t,e,n){return Math.max(e,Math.min(n,t))}function Rt(t,e){return t+Math.random()*(e-t)}function Pt(t,e,n=ot()){const i=(_+j)/2;let a;if(0===G)a=i;else{const t=.1*i;a=Rt(Math.max(1,i-t),i+t)}const o=new Tt(t,e,a,n),s=.5*x.width,l=$?J>=0?1:-1:t<s?1:-1,r=Ft(a/(.5*(_+j)),.6,1.4),d=140*r,h=180*r;return o.vx=l*(d+Math.random()*h),o.vy=120*-Math.random(),o.driftAx=l*(360+420*Math.random())*r,o.driftTime=.22+.28*Math.random(),Vt.push(o),o}let At=0;function qt(){const t=x.clientWidth,e=x.clientHeight,n=Ft(S/100*t,0,t);let i=Ft(M/100*t,0,t);if($){const e=.2*t,n=i;i=Ft(i+Math.sin(X)*e,0,t),J=i>=n?1:-1}const a=Math.min(40,.1*n),o=Ft(i-n/2-a,-a,t),s=Ft(i+n/2+a,-a,t),l=b/100*e,r=l+B/100*e,d=Math.random();return{x:(o+(s-o)*(J>0?Math.pow(d,.7):1-Math.pow(1-d,.7)))*I,y:Rt(l*I,r*I)-(j+2+Rt(0,10*I))}}const zt=new Map;function kt(t=6){const e=function(){const t=Vt.length;if(t<2)return[];const e=Math.max(1,2*j),n=Math.ceil(x.width/e)+1;zt.clear();for(let i=0;i<t;i++){const t=Vt[i],a=t.x/e|0,o=(t.y/e|0)*n+a;let s=zt.get(o);s||(s=[],zt.set(o,s)),s.push(i)}const i=[];for(const[t,e]of zt){const a=t/n|0,o=t%n;for(let t=-1;t<=1;t++)for(let s=-1;s<=1;s++){const l=(a+t)*n+(o+s),r=zt.get(l);if(r)for(let t=0;t<e.length;t++){const n=e[t];for(let t=0;t<r.length;t++){const e=r[t];if(e<=n)continue;const a=Vt[n],o=Vt[e],s=o.x-a.x,l=o.y-a.y,d=a.r+o.r,h=s*s+l*l;if(h<d*d){const t=d-Math.sqrt(Math.max(h,1e-6));i.push({i:n,j:e,overlap:t})}}}}}return i.sort((t,e)=>e.overlap-t.overlap),i}();for(let n=0;n<t;n++)for(let t=0;t<e.length;t++){const{i:n,j:i}=e[t],a=Vt[n],o=Vt[i],s=o.x-a.x,l=o.y-a.y,r=a.r+o.r,d=s*s+l*l;if(0===d||d>r*r)continue;const h=Math.sqrt(d),c=s/h,u=l/h,m=r-h,f=1/Math.max(a.m,.001),g=1/Math.max(o.m,.001),p=.8*Math.max(m-A,0)/(f+g),x=p*c,v=p*u;a.x-=x*f,a.y-=v*f,o.x+=x*g,o.y+=v*g;const E=o.vx-a.vx,I=o.vy-a.vy,M=E*c+I*u;if(M<0){const t=-(1+(Math.abs(M)<30?0:V))*M/(f+g),e=t*c,n=t*u;a.vx-=e*f,a.vy-=n*f,o.vx+=e*g,o.vy+=n*g;const i=E-M*c,s=I-M*u,l=Math.hypot(i,s);if(l>.001){const t=i*-u+s*c>=0?1:-1,e=.18;a.omega-=t*e*l/Math.max(a.r,1),o.omega+=t*e*l/Math.max(o.r,1)}const r=Math.min(1,Math.abs(M)/(50*(a.r+o.r))),d=Math.min(y(),.8*r);a.squashAmount=Math.max(a.squashAmount,.8*d),a.squashNormalAngle=Math.atan2(-u,-c),o.squashAmount=Math.max(o.squashAmount,.8*d),o.squashNormalAngle=Math.atan2(u,c)}}}let Gt=performance.now()/1e3,Nt=0;const Ut=1/120;function Wt(){const t=parseFloat(_t.value);k=t,Y();const e=(_+j)/2;for(let t=0;t<Vt.length;t++)if(0===G)Vt[t].r=e,Vt[t].rBase=e;else{const n=.1*e,i=Math.max(1,e-n),a=e+n;Vt[t].r=Rt(i,a),Vt[t].rBase=Vt[t].r}}console.log("High refresh mode enabled - using requestAnimationFrame"),requestAnimationFrame(function e(i){const a=i/1e3;let o=Math.min(.008,a-Gt);Gt=a,Nt+=o,Mt++,(wt||Lt)&&a-St>=1&&(wt&&Mt!==Bt&&(Bt=Mt,wt.textContent=Bt.toString()),Lt&&bt!==Ct&&(Ct=bt,Lt.textContent=Ct.toString()),Mt=0,bt=0,St=a),function(e){if(n!==t.WEIGHTLESS)for(At+=e;At>=R;){const t=(Math.random()-.5)*R*.5;At-=R+t,X+=2*Math.PI*.12*(R+t);const e=qt(),n=Math.random()<.35?3:1;for(let t=0;t<n;t++)if(Vt.length<P){const n=8*t*(Math.random()<.5?1:-1);Pt(e.x+n,e.y-12*t)}}}(o),Mt%60==0&&Z();let s=0;for(;Nt>=Ut&&s<2;){for(let t=0;t<Vt.length;t++)Vt[t].step(Ut);n!==t.FLIES&&kt(3);const e=n===t.WEIGHTLESS?c:V;for(let t=0;t<Vt.length;t++)Vt[t].walls(x.width,x.height,Ut,e);Nt-=Ut,s++,bt++}if(n===t.TRAIL)for(let t=Vt.length-1;t>=0;t--){const e=Vt[t];e.isSparkle&&e.r<=.5&&(e.active=!1,Vt.splice(t,1))}Nt>3*Ut&&(Nt=0),v.clearRect(0,0,x.width,x.height),yt>0&&function(t,e,n){const i=yt;t.strokeStyle="rgba(255, 255, 255, 0.1)",t.lineWidth=2,t.beginPath(),t.moveTo(i,0),t.lineTo(e-i,0),t.arcTo(e,0,e,i,i),t.lineTo(e,n-i),t.arcTo(e,n,e-i,n,i),t.lineTo(i,n),t.arcTo(0,n,0,n-i,i),t.lineTo(0,i),t.arcTo(0,0,i,0,i),t.closePath(),t.stroke()}(v,x.width,x.height);for(let t=0;t<Vt.length;t++)Vt[t].draw(v);if(function(t){if(ut)return;if(dt===f||ht===f)return;const e=dt,n=ht,i=(_+j)/2;t.beginPath(),t.arc(e,n,i,0,2*Math.PI),t.fillStyle="rgba(255, 255, 255, 0.9)",t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.6)",t.lineWidth=2,t.stroke()}(v),!ut){v.save(),v.font="14px system-ui, -apple-system, sans-serif",v.fillStyle="rgba(255, 255, 255, 0.3)",v.textAlign="left",v.textBaseline="bottom";const t=n.charAt(0).toUpperCase()+n.slice(1);v.fillText(t+" Mode",10,x.height-10),v.restore()}requestAnimationFrame(e)}),window.addEventListener("keydown",e=>{const i=e.key.toLowerCase();"r"===i&&(function(){if(n===t.WEIGHTLESS)Vn();else for(let t=0;t<Vt.length;t++){const e=Vt[t],n=qt();e.x=n.x,e.y=n.y;const i=.5*x.width,a=$?J>=0?1:-1:e.x<i?1:-1,o=Ft(e.r/(.5*(_+j)),.6,1.4),s=140*o,l=180*o,r=120;e.vx=a*(s+Math.random()*l),e.vy=-Math.random()*r,e.age=0,e.driftAx=a*(360+420*Math.random())*o,e.driftTime=.22+.28*Math.random()}}(),e.preventDefault()),"/"===i&&E&&(e.preventDefault(),E.classList.toggle("hidden")),"1"===i&&Fn(t.PIT),"2"===i&&Fn(t.FLIES),"3"===i&&Fn(t.WEIGHTLESS)}),function(t=160){for(let e=0;e<t&&Vt.length<P;e++){const t=qt();Pt(t.x,t.y)}}(200),x.addEventListener("mousemove",e=>{const i=x.getBoundingClientRect();dt=(e.clientX-i.left)*I,ht=(e.clientY-i.top)*I,n===t.PIT&&lt>0&&st>0&&(ct=!0)}),x.addEventListener("mouseleave",()=>{dt=f,ht=f});const Dt=document.getElementById("restitutionSlider"),Ht=document.getElementById("frictionSlider"),Ot=document.getElementById("emitterSlider"),_t=document.getElementById("sizeSliderGlobal"),jt=document.getElementById("sizeVariationSliderGlobal"),Yt=(document.getElementById("weightSliderGlobal"),document.getElementById("ballSoftnessSliderGlobal")),Zt=document.getElementById("sizeValGlobal"),$t=document.getElementById("sizeVariationValGlobal"),Xt=(document.getElementById("weightValGlobal"),document.getElementById("ballSoftnessValGlobal")),Jt=(document.getElementById("sizeSliderPit"),document.getElementById("sizeVariationSliderPit"),document.getElementById("weightSliderPit"),document.getElementById("ballSoftnessSliderPit"),document.getElementById("sizeValPit"),document.getElementById("sizeVariationValPit"),document.getElementById("weightValPit"),document.getElementById("ballSoftnessValPit"),document.getElementById("sizeSliderFlies"),document.getElementById("sizeVariationSliderFlies"),document.getElementById("weightSliderFlies"),document.getElementById("ballSoftnessSliderFlies"),document.getElementById("sizeValFlies"),document.getElementById("sizeVariationValFlies"),document.getElementById("weightValFlies"),document.getElementById("ballSoftnessValFlies"),document.getElementById("sizeSliderZeroG"),document.getElementById("sizeVariationSliderZeroG"),document.getElementById("weightSliderZeroG"),document.getElementById("ballSoftnessSliderZeroG"),document.getElementById("sizeValZeroG"),document.getElementById("sizeVariationValZeroG"),document.getElementById("weightValZeroG"),document.getElementById("ballSoftnessValZeroG"),document.getElementById("maxBallsSlider")),Kt=document.getElementById("spawnYSlider"),Qt=document.getElementById("spawnWidthSlider"),te=document.getElementById("spawnCenterSlider"),ee=document.getElementById("spawnHeightSlider"),ne=document.getElementById("repelSizeSlider"),ie=document.getElementById("repelPowerSlider"),ae=document.getElementById("repelSoftSlider"),oe=document.getElementById("colorSelect"),se=document.getElementById("color1"),le=document.getElementById("color2"),re=document.getElementById("color3"),de=document.getElementById("color4"),he=document.getElementById("color5"),ce=document.getElementById("color6"),ue=document.getElementById("color7"),me=document.getElementById("color8"),fe=document.getElementById("cursorColorSelect"),ge=document.getElementById("color1Val"),pe=document.getElementById("color2Val"),ye=document.getElementById("color3Val"),xe=document.getElementById("color4Val"),ve=document.getElementById("color5Val"),Ee=document.getElementById("color6Val"),Ie=document.getElementById("color7Val"),Me=document.getElementById("color8Val");[ge,pe,ye,xe,ve,Ee,Ie,Me].forEach(t=>{t&&t.setAttribute("title","Click to copy")});const be=document.getElementById("cornerRadiusSlider"),Se=document.getElementById("cornerRadiusVal"),Be=document.getElementById("trailFadeSlider"),Ce=document.getElementById("trailFadeVal"),we=document.getElementById("trailSubtletySlider"),Le=document.getElementById("trailSubtletyVal"),Te=document.getElementById("restitutionVal"),Ve=document.getElementById("frictionVal"),Fe=document.getElementById("emitterVal"),Re=document.getElementById("maxBallsVal"),Pe=document.getElementById("spawnYVal"),Ae=document.getElementById("spawnWidthVal"),qe=document.getElementById("spawnCenterVal"),ze=document.getElementById("spawnHeightVal"),ke=document.getElementById("repelSizeVal"),Ge=document.getElementById("repelPowerVal"),Ne=document.getElementById("repelSoftVal");function Ue(){return{gravityMultiplier:L,restitution:V,friction:F,ballMass:W,emitRate:R,maxBalls:P,ballScale:k,ballVariation:G,spawnX:M,spawnY:b,spawnWidth:S,spawnHeight:B,sweepEnabled:$,repelRadius:st,repelPower:lt,repelSoftness:rt,trailFade:trailFade,trailSubtlety:It,colors:tt.slice(),colorWeights:at.slice(),currentTemplate:Q,cursorColorIndex:et}}const We=document.getElementById("saveConfigBtn"),De=document.getElementById("buildBtn"),He=document.getElementById("configOutput");function Oe(t,e){t&&t.addEventListener("click",async()=>{const n="function"==typeof e?e():String(e||"").trim();try{await navigator.clipboard.writeText(n);const e=t.textContent;t.textContent="COPIED",t.style.color="#3ddc84",setTimeout(()=>{t.textContent=e,t.style.color="#888"},900)}catch(t){console.warn("Clipboard unavailable")}})}We&&De&&He&&(We.addEventListener("click",()=>{const t=(e=Ue(),`// Generated configuration from frontend\nconst CONFIG = ${JSON.stringify(e,null,2)};`);var e;He.style.display="block",He.textContent=t,navigator.clipboard.writeText(t).then(()=>{const t=We.textContent;We.textContent="✅ Copied!",setTimeout(()=>{We.textContent=t},1200)}).catch(()=>{console.warn("Clipboard copy failed");const t=We.textContent;We.textContent="⚠️ Copy failed",setTimeout(()=>{We.textContent=t},1200)})}),De.addEventListener("click",()=>{const t=Ue();He.style.display="block",He.innerHTML="\n<strong>🚀 Build Instructions:</strong><br>\n1. Run: <code>npm run build</code><br>\n2. Your current config will be baked into <code>public/js/bouncy-balls-embed.js</code>";const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download="current-config.json",i.click(),URL.revokeObjectURL(n)})),Dt&&Dt.addEventListener("input",()=>{V=parseFloat(Dt.value),Te&&(Te.textContent=V.toFixed(2)),gt()}),Ht&&Ht.addEventListener("input",()=>{F=parseFloat(Ht.value),Ve&&(Ve.textContent=F.toFixed(4)),gt()}),Ot&&Ot.addEventListener("input",()=>{R=parseFloat(Ot.value),Fe&&(Fe.textContent=R.toFixed(3)),gt()}),function(t){if(!t)return;const{size:e,sizeVal:n,sizeVar:a,sizeVarVal:o,soft:s,softVal:l}=t;e&&e.addEventListener("input",()=>{const t=parseFloat(e.value);n&&(n.textContent=t.toFixed(1)),k=t,Y();for(let t=0;t<Vt.length;t++)Vt[t].m=W;gt()}),a&&a.addEventListener("input",()=>{const t=parseFloat(a.value);o&&(o.textContent=t.toFixed(1)),G=t,gt()}),s&&s.addEventListener("input",()=>{const t=parseInt(s.value,10);l&&(l.textContent=String(t)),i=t,gt()})}({size:_t,sizeVal:Zt,sizeVar:jt,sizeVarVal:$t,soft:Yt,softVal:Xt}),Jt&&Jt.addEventListener("input",()=>{P=parseInt(Jt.value,10),Re&&(Re.textContent=P.toString()),Vt.length>P&&(Vt.length=P)}),jt&&jt.addEventListener("input",()=>{G=parseFloat(jt.value),$t&&($t.textContent=G.toFixed(1)),Ye()});const _e=document.getElementById("weightPitSlider"),je=document.getElementById("weightPitVal");function Ye(){const t=(_+j)/2;for(let e=0;e<Vt.length;e++){const n=Vt[e];if(0===G)n.r=t;else{const e=.1*t,i=Math.max(1,t-e),a=t+e;n.r=Rt(i,a)}n.m=W}}document.getElementById("weightWeightlessSlider"),document.getElementById("weightWeightlessVal"),Kt&&Kt.addEventListener("input",()=>{b=parseFloat(Kt.value),Pe&&(Pe.textContent=b.toFixed(0)),C()}),Qt&&Qt.addEventListener("input",()=>{S=parseFloat(Qt.value),Ae&&(Ae.textContent=S.toFixed(0))}),te&&te.addEventListener("input",()=>{M=parseFloat(te.value),qe&&(qe.textContent=M.toFixed(0))}),ee&&ee.addEventListener("input",()=>{B=parseFloat(ee.value),ze&&(ze.textContent=B.toFixed(0))}),ne&&ne.addEventListener("input",()=>{st=parseFloat(ne.value),ke&&(ke.textContent=st.toFixed(0)),ct=ct||lt>0&&st>0}),ie&&ie.addEventListener("input",()=>{lt=function(t){const e=Math.max(0,Math.min(pt,Number(t)))/pt;return 2*Math.pow(2,12*(e-.5))*12e3}(ie.value),Ge&&(Ge.textContent=Math.round(lt).toString()),Nn&&"off"!==Nn.value&&(ct=lt>0&&st>0)}),ae&&ae.addEventListener("input",()=>{rt=parseFloat(ae.value),Ne&&(Ne.textContent=rt.toFixed(1))}),oe&&oe.addEventListener("change",()=>{const t=K[oe.value];t&&(Q=oe.value,tt=t.colors.slice(),nt=tt[et]||nt,se&&ge&&(se.value=tt[0],ge.textContent=tt[0].toUpperCase()),le&&pe&&(le.value=tt[1],pe.textContent=tt[1].toUpperCase()),re&&ye&&(re.value=tt[2],ye.textContent=tt[2].toUpperCase()),de&&xe&&(de.value=tt[3],xe.textContent=tt[3].toUpperCase()),he&&ve&&(he.value=tt[4],ve.textContent=tt[4].toUpperCase()),ce&&Ee&&(ce.value=tt[5],Ee.textContent=tt[5].toUpperCase()),ue&&Ie&&(ue.value=tt[6],Ie.textContent=tt[6].toUpperCase()),me&&Me&&(me.value=tt[7],Me.textContent=tt[7].toUpperCase()),Rn(),it())});const Ze=Array.from(document.querySelectorAll(".mode-button")),$e=document.getElementById("pitControls"),Xe=document.getElementById("fliesControls"),Je=(document.getElementById("trailControls"),document.getElementById("weightlessControls")),Ke=(document.getElementById("boulderControls"),document.getElementById("gravityPitSlider")),Qe=document.getElementById("gravityPitVal"),tn=document.getElementById("repellerEnabledPit"),en=document.getElementById("attractPowerSlider"),nn=document.getElementById("attractPowerVal"),an=document.getElementById("orbitRadiusSlider"),on=document.getElementById("orbitRadiusVal"),sn=document.getElementById("swarmSpeedSlider"),ln=document.getElementById("swarmSpeedVal"),rn=document.getElementById("trailLengthSlider"),dn=document.getElementById("trailLengthVal"),hn=document.getElementById("trailSpacingSlider"),cn=document.getElementById("trailSpacingVal"),un=document.getElementById("trailModeFadeSlider"),mn=document.getElementById("trailModeFadeVal"),fn=document.getElementById("weightlessCountSlider"),gn=document.getElementById("weightlessCountVal"),pn=document.getElementById("weightlessSpeedSlider"),yn=document.getElementById("weightlessSpeedVal"),xn=document.getElementById("weightlessBounceSlider"),vn=document.getElementById("weightlessBounceVal"),En=document.getElementById("weightlessRepelSlider"),In=document.getElementById("weightlessRepelVal"),Mn=document.getElementById("weightlessRepelRadiusSlider"),bn=document.getElementById("weightlessRepelRadiusVal"),Sn=document.getElementById("bouldersDelaySlider"),Bn=document.getElementById("bouldersDelayVal"),Cn=document.getElementById("bouldersGravitySlider"),wn=document.getElementById("bouldersGravityVal"),Ln=document.getElementById("bouldersSizeVarietySlider"),Tn=document.getElementById("bouldersSizeVarietyVal");function Vn(){Vt.length=0;const t=d,e=x.width,n=x.height,i=e/n,a=Math.ceil(Math.sqrt(t*i)),o=Math.ceil(t/a),s=(e-80)/Math.max(1,a-1),l=(n-80)/Math.max(1,o-1),r=[];for(let i=0;i<o;i++)for(let o=0;o<a&&!(r.length>=t);o++){const t=40+o*s,a=40+i*l,d=(Math.random()-.5)*s*.25,h=(Math.random()-.5)*l*.25;r.push({x:Math.max(20,Math.min(e-20,t+d)),y:Math.max(20,Math.min(n-20,a+h))})}for(const t of r){const e=Pt(t.x,t.y),n=Math.random()*Math.PI*2,i=h*(.7+.3*Math.random());e.vx=Math.cos(n)*i,e.vy=Math.sin(n)*i,e.driftAx=0,e.driftTime=0}}function Fn(e){n=e,n===t.PIT?(L=a,T=w*L,ct=o&&lt>0&&st>0,$=!0,Vt.length=0,At=0,Wt()):n===t.FLIES?(L=0,T=w*L,ct=!1,$=!1,Vt.length=0,Wt()):n===t.WEIGHTLESS&&(L=0,T=w*L,ct=!1,$=!1,Vn(),Wt()),$e&&$e.classList.toggle("active",n===t.PIT),Xe&&Xe.classList.toggle("active",n===t.FLIES),Je&&Je.classList.toggle("active",n===t.WEIGHTLESS),Ze.forEach(t=>t.classList.toggle("active",t.getAttribute("data-mode")===n))}function Rn(){for(let t=0;t<Vt.length;t++)Vt[t].color=ot()}Ze.forEach(t=>t.addEventListener("click",()=>{Fn(t.getAttribute("data-mode")),gt()})),Ke&&Ke.addEventListener("input",()=>{a=parseFloat(Ke.value),Qe&&(Qe.textContent=a.toFixed(1)),gt(),n===t.PIT&&(L=a,T=w*L)}),_e&&_e.addEventListener("input",()=>{W=parseFloat(_e.value),je&&(je.textContent=W.toFixed(2));for(let t=0;t<Vt.length;t++)Vt[t].m=W;O(),gt()}),tn&&tn.addEventListener("change",()=>{o=!!tn.checked,n===t.PIT&&(ct=o&&lt>0&&st>0)}),en&&en.addEventListener("input",()=>{s=parseFloat(en.value),nn&&(nn.textContent=Math.round(s).toString())}),an&&an.addEventListener("input",()=>{l=parseFloat(an.value),on&&(on.textContent=Math.round(l).toString())}),sn&&sn.addEventListener("input",()=>{r=parseFloat(sn.value),ln&&(ln.textContent=r.toFixed(1))}),rn&&rn.addEventListener("input",()=>{TRAIL_MAX_POINTS=parseInt(rn.value,10),dn&&(dn.textContent=TRAIL_MAX_POINTS.toString())}),hn&&hn.addEventListener("input",()=>{trailMinSpacing=parseFloat(hn.value),cn&&(cn.textContent=trailMinSpacing.toFixed(0))}),un&&un.addEventListener("input",()=>{trailFade=parseFloat(un.value),mn&&(mn.textContent=trailFade.toFixed(2))}),fn&&fn.addEventListener("input",()=>{d=parseInt(fn.value,10),gn&&(gn.textContent=d.toString()),n===t.WEIGHTLESS&&Vn()}),pn&&pn.addEventListener("input",()=>{h=parseFloat(pn.value),yn&&(yn.textContent=Math.round(h).toString())}),xn&&xn.addEventListener("input",()=>{c=parseFloat(xn.value),vn&&(vn.textContent=c.toFixed(2))}),En&&En.addEventListener("input",()=>{u=parseFloat(En.value),In&&(In.textContent=Math.round(u).toString())}),Mn&&Mn.addEventListener("input",()=>{m=parseFloat(Mn.value),bn&&(bn.textContent=Math.round(m).toString())}),Sn&&Sn.addEventListener("input",()=>{bouldersDropDelay=parseFloat(Sn.value),Bn&&(Bn.textContent=bouldersDropDelay.toFixed(1))}),Cn&&Cn.addEventListener("input",()=>{bouldersGravity=parseFloat(Cn.value),wn&&(wn.textContent=bouldersGravity.toFixed(1)),n===t.BOULDERS&&(L=bouldersGravity,T=w*L)}),Ln&&Ln.addEventListener("input",()=>{bouldersSizeVariety=parseFloat(Ln.value),Tn&&(Tn.textContent=bouldersSizeVariety.toFixed(1))}),se&&se.addEventListener("input",()=>{tt[0]=se.value,ge&&(ge.textContent=se.value.toUpperCase()),Rn(),it()}),le&&le.addEventListener("input",()=>{tt[1]=le.value,pe&&(pe.textContent=le.value.toUpperCase()),Rn(),it()}),re&&re.addEventListener("input",()=>{tt[2]=re.value,ye&&(ye.textContent=re.value.toUpperCase()),Rn(),it()}),de&&de.addEventListener("input",()=>{tt[3]=de.value,xe&&(xe.textContent=de.value.toUpperCase()),Rn(),it()}),he&&he.addEventListener("input",()=>{tt[4]=he.value,ve&&(ve.textContent=he.value.toUpperCase()),Rn(),it()}),ce&&ce.addEventListener("input",()=>{tt[5]=ce.value,Ee&&(Ee.textContent=ce.value.toUpperCase()),Rn(),it()}),ue&&ue.addEventListener("input",()=>{tt[6]=ue.value,Ie&&(Ie.textContent=ue.value.toUpperCase()),Rn(),it()}),me&&me.addEventListener("input",()=>{tt[7]=me.value,Me&&(Me.textContent=me.value.toUpperCase()),Rn(),it()}),fe&&fe.addEventListener("change",()=>{const t=Math.max(1,Math.min(8,parseInt(fe.value,10)))-1;et=t,nt=tt[et]||nt}),Oe(ge,()=>se.value.toUpperCase()),Oe(pe,()=>le.value.toUpperCase()),Oe(ye,()=>re.value.toUpperCase()),Oe(xe,()=>de.value.toUpperCase()),Oe(ve,()=>he.value.toUpperCase()),Oe(Ee,()=>ce.value.toUpperCase()),Oe(Ie,()=>ue.value.toUpperCase()),Oe(Me,()=>me.value.toUpperCase()),be&&be.addEventListener("input",()=>{yt=parseFloat(be.value),Se&&(Se.textContent=yt.toFixed(0))}),Be&&Be.addEventListener("input",()=>{Et=parseFloat(Be.value),Ce&&(Ce.textContent=Et.toFixed(3))}),we&&we.addEventListener("input",()=>{It=parseFloat(we.value),Le&&(Le.textContent=It.toFixed(2)+"×")});const Pn={rubberPlayground:{label:"Rubber – Playground",G:1960,REST:.9,FRICTION:.0025,sizeScale:1.8,maxBalls:450,sizeVariation:.2},rubberRacquet:{label:"Rubber – Racquetball",G:3320,REST:.97,FRICTION:.0035,sizeScale:.7,maxBalls:350,sizeVariation:.3},rubberSuperball:{label:"Rubber – Superball",G:1960,REST:.95,FRICTION:.0015,sizeScale:1.2,maxBalls:450,sizeVariation:.05},rubberSoft:{label:"Rubber – Soft",G:1960,REST:.86,FRICTION:.0035,sizeScale:2.2,maxBalls:350,sizeVariation:.25},rubberHeavy:{label:"Rubber – Heavy",G:1960,REST:.88,FRICTION:.003,sizeScale:2,maxBalls:400,sizeVariation:.15}},An={fullRain:{label:"Full Rain (top-half)",EMIT_INTERVAL:.03,xCenter:50,y:-50,w:100,h:50},narrowStrip:{label:"Narrow Strip Top",EMIT_INTERVAL:.05,xCenter:50,y:-40,w:20,h:10},leftGutter:{label:"Left Gutter",EMIT_INTERVAL:.045,xCenter:10,y:-60,w:18,h:20},rightGutter:{label:"Right Gutter",EMIT_INTERVAL:.045,xCenter:90,y:-60,w:18,h:20},centerFountain:{label:"Center Fountain",EMIT_INTERVAL:.02,xCenter:50,y:-30,w:30,h:20},stormBurst:{label:"Storm Burst",EMIT_INTERVAL:.005,xCenter:50,y:-80,w:100,h:30},slowSnow:{label:"Slow Snow",EMIT_INTERVAL:.2,xCenter:50,y:-30,w:100,h:20},edgeDrizzle:{label:"Edge Drizzle",EMIT_INTERVAL:.08,xCenter:15,y:-40,w:30,h:15},twinColumns:{label:"Twin Columns",EMIT_INTERVAL:.03,xCenter:30,y:-50,w:10,h:40},focusedBeam:{label:"Focused Beam",EMIT_INTERVAL:.015,xCenter:50,y:-70,w:6,h:12}},qn={off:{label:"Off",r:710,p:274e3,s:4.4},gentle:{label:"Gentle Breeze",r:120,p:2500,s:2.5},pushField:{label:"Push Field",r:240,p:8e4,s:2},tractor:{label:"Tractor Push",r:320,p:14e4,s:1.6},magnet:{label:"Magnet Repel",r:200,p:18e4,s:3},pulse:{label:"Pulse Strong",r:280,p:22e4,s:1.2},wideSoft:{label:"Wide Soft",r:500,p:8e4,s:4.5},needle:{label:"Needle Point",r:80,p:26e4,s:.8},wall:{label:"Invisible Wall",r:700,p:16e4,s:5},singularity:{label:"Singularity",r:600,p:3e5,s:.5}};function zn(t,e,n){t.innerHTML="";for(const[i,a]of Object.entries(e)){const e=document.createElement("option");e.value=i,e.textContent=a.label||i,i===n&&(e.selected=!0),t.appendChild(e)}}const kn=document.getElementById("physicsSelect"),Gn=document.getElementById("spawnSelect"),Nn=document.getElementById("repellerSelect");function Un(t,e,n,i=0){t&&(t.value=String(n)),e&&(e.textContent=i>0?n.toFixed(i):n.toString())}function Wn(e){const i=Pn[e];if(!i)return;V=i.REST,F=i.FRICTION,P=i.maxBalls,G=i.sizeVariation;const a=i.sizeScale;k=a,Y();for(let e=0;e<Vt.length;e++)Vt[e].m=n===t.BOULDERS?5*W:W;Vt.length>P&&(Vt.length=P),Un(Dt,Te,V,2),Un(Ht,Ve,F,4),Un(_t,Zt,k,1),Un(Jt,Re,P,0),Un(jt,$t,G,1),Ye()}function Dn(t){const e=An[t];e&&(R=e.EMIT_INTERVAL,M=e.xCenter,b=e.y,S=e.w,B=e.h,Un(Ot,Fe,R,3),Un(te,qe,M,0),Un(Kt,Pe,b,0),Un(Qt,Ae,S,0),Un(ee,ze,B,0))}function Hn(t){const e=qn[t];if(!e)return;st=e.r,lt=1*e.p,ct="off"!==t,Un(ne,ke,st,0);const n=function(t){const e=Math.max(1,Number(t))/24e3,n=.5+Math.log2(e)/12;return Math.round(Math.max(0,Math.min(1,n))*pt)}(lt);ie&&(ie.value=String(n)),Ge&&(Ge.textContent=Math.round(lt).toString()),Un(ae,Ne,rt,1)}kn&&zn(kn,Pn,"rubberRacquet"),Gn&&zn(Gn,An,"fullRain"),Nn&&zn(Nn,qn,"off"),oe&&zn(oe,K,"industrialTeal"),Wn("rubberRacquet"),Dn("fullRain"),Hn("off");const On=K[Q];se&&ge&&(se.value=On.colors[0],ge.textContent=On.colors[0].toUpperCase()),le&&pe&&(le.value=On.colors[1],pe.textContent=On.colors[1].toUpperCase()),re&&ye&&(re.value=On.colors[2],ye.textContent=On.colors[2].toUpperCase()),de&&xe&&(de.value=On.colors[3],xe.textContent=On.colors[3].toUpperCase()),he&&ve&&(he.value=On.colors[4],ve.textContent=On.colors[4].toUpperCase()),ce&&Ee&&(ce.value=On.colors[5],Ee.textContent=On.colors[5].toUpperCase()),ue&&Ie&&(ue.value=On.colors[6],Ie.textContent=On.colors[6].toUpperCase()),me&&Me&&(me.value=On.colors[7],Me.textContent=On.colors[7].toUpperCase()),it(On.colors),kn&&kn.addEventListener("change",()=>Wn(kn.value)),Gn&&Gn.addEventListener("change",()=>Dn(Gn.value)),Nn&&Nn.addEventListener("change",()=>Hn(Nn.value)),Y(),Z(),function(){try{const t=localStorage.getItem(mt);if(t){const e=JSON.parse(t);return e.currentMode&&(n=e.currentMode),void 0!==e.gravityMultiplierPit&&(a=e.gravityMultiplierPit),void 0!==e.repellerEnabledPit&&(o=e.repellerEnabledPit),e.attractionPower&&(s=e.attractionPower),e.orbitRadius&&(l=e.orbitRadius),e.swarmSpeed&&(r=e.swarmSpeed),void 0!==e.sparkleEmissionRate&&(sparkleEmissionRate=e.sparkleEmissionRate),void 0!==e.sparkleLifetime&&(sparkleLifetime=e.sparkleLifetime),void 0!==e.sparkleVelocitySpread&&(sparkleVelocitySpread=e.sparkleVelocitySpread),void 0!==e.sparkleDriftStrength&&(sparkleDriftStrength=e.sparkleDriftStrength),void 0!==e.sparkleParticleScale&&(sparkleParticleScale=e.sparkleParticleScale),e.weightlessInitialSpeed&&(h=e.weightlessInitialSpeed),e.weightlessBounce&&(c=e.weightlessBounce),e.weightlessMaxBalls&&(weightlessMaxBalls=e.weightlessMaxBalls),void 0!==e.weightlessRepellerPower&&(u=e.weightlessRepellerPower),void 0!==e.weightlessRepellerRadius&&(m=e.weightlessRepellerRadius),e.restitution&&(V=e.restitution),void 0!==e.friction&&(F=e.friction),e.sizeScale&&(k=e.sizeScale),void 0!==e.sizeVariation&&(G=e.sizeVariation),e.ballMassKg&&(W=e.ballMassKg),e.repelPower&&(lt=e.repelPower),e.repelRadius&&(st=e.repelRadius),e.repelSoft&&(rt=e.repelSoft),void 0!==e.cornerRadius&&(yt=e.cornerRadius),void 0!==e.motionBlur&&(trailFade=e.motionBlur),e.trailSubtlety&&(It=e.trailSubtlety),e.currentTemplate&&(Q=e.currentTemplate),e.cursorBallColor&&(nt=e.cursorBallColor),console.log("✓ Settings loaded"),!0}}catch(t){console.warn("Could not load settings:",t)}}(),function(){const n=ut?"mobile":"desktop",i=document.getElementById("trailModeButton");i&&!e[t.TRAIL][n]&&(i.style.display="none")}(),Fn(n),window.addEventListener("beforeunload",ft)})();