var e=function(e){"use strict";const t={PIT:"pit",PIT_THROWS:"pit-throws",FLIES:"flies",WEIGHTLESS:"weightless",WATER:"water",VORTEX:"vortex",PING_PONG:"ping-pong",MAGNETIC:"magnetic",BUBBLES:"bubbles",KALEIDOSCOPE:"kaleidoscope",KALEIDOSCOPE_1:"kaleidoscope-1",KALEIDOSCOPE_2:"kaleidoscope-2",KALEIDOSCOPE_3:"kaleidoscope-3",CRITTERS:"critters",ORBIT_3D:"orbit-3d",ORBIT_3D_2:"orbit-3d-2",NEURAL:"neural",LATTICE:"lattice",PARALLAX_LINEAR:"parallax-linear",PARALLAX_PERSPECTIVE:"parallax-perspective"},a=[t.PIT,t.BUBBLES,t.CRITTERS,t.FLIES,t.PIT_THROWS,t.WATER,t.VORTEX,t.MAGNETIC,t.PING_PONG,t.WEIGHTLESS,t.KALEIDOSCOPE_1,t.KALEIDOSCOPE_2,t.KALEIDOSCOPE_3,t.KALEIDOSCOPE,t.ORBIT_3D,t.ORBIT_3D_2,t.LATTICE,t.NEURAL,t.PARALLAX_LINEAR,t.PARALLAX_PERSPECTIVE],n={[t.PIT]:"SOURCE MATERIAL",[t.BUBBLES]:"SIGNAL NOISE",[t.CRITTERS]:"CONCEPT MODEL",[t.FLIES]:"SWARM LOGIC",[t.PIT_THROWS]:"SOURCE ITERATION",[t.WATER]:"FLOW STATE",[t.VORTEX]:"ORDERED CHAOS",[t.MAGNETIC]:"FORCE FIELDS",[t.PING_PONG]:"FEEDBACK PATTERNS",[t.WEIGHTLESS]:"ZERO GRAVITY",[t.KALEIDOSCOPE]:"A NEW LANGUAGE",[t.KALEIDOSCOPE_1]:"LANGUAGE SEED",[t.KALEIDOSCOPE_2]:"LANGUAGE FLOW",[t.KALEIDOSCOPE_3]:"LANGUAGE BLOOM",[t.ORBIT_3D]:"AXIAL STORM",[t.ORBIT_3D_2]:"TIGHT SWARM",[t.LATTICE]:"CRYSTAL LOGIC",[t.NEURAL]:"SYNAPTIC WEB",[t.PARALLAX_LINEAR]:"DEPTH DRIFT",[t.PARALLAX_PERSPECTIVE]:"PERSPECTIVE FIELD"},r={DPR:Math.max(1,Math.min(2,window.devicePixelRatio||1)),OFFSCREEN_MOUSE:-1e9,MIN_DISTANCE_EPSILON:1e-6,ACCUMULATOR_RESET_THRESHOLD:3,MAX_PHYSICS_STEPS:2,SPIN_DAMP_PER_S:3,SPIN_GAIN:.25,SPIN_GAIN_TANGENT:.18,ROLL_FRICTION_PER_S:2.5,SQUASH_MAX_BASE:.2,SQUASH_DECAY_PER_S:18,WALL_REST_VEL_THRESHOLD:70,GROUND_COUPLING_PER_S:12,SLEEP_VELOCITY_THRESHOLD:8,SLEEP_ANGULAR_THRESHOLD:.1,TIME_TO_SLEEP:.25,PHYSICS_DT:1/120},i={rubber:{wallWobbleMaxDeform:45,wallWobbleStiffness:2200,wallWobbleDamping:35,wallWobbleImpactThreshold:140,wallWobbleSettlingSpeed:75,wallWobbleSigma:2,wallWobbleCornerClamp:.6},trampoline:{wallWobbleMaxDeform:55,wallWobbleStiffness:2800,wallWobbleDamping:15,wallWobbleImpactThreshold:100,wallWobbleSettlingSpeed:40,wallWobbleSigma:2.5,wallWobbleCornerClamp:.5},jelly:{wallWobbleMaxDeform:80,wallWobbleStiffness:800,wallWobbleDamping:12,wallWobbleImpactThreshold:80,wallWobbleSettlingSpeed:30,wallWobbleSigma:3.5,wallWobbleCornerClamp:.4},stiff:{wallWobbleMaxDeform:20,wallWobbleStiffness:3e3,wallWobbleDamping:60,wallWobbleImpactThreshold:180,wallWobbleSettlingSpeed:90,wallWobbleSigma:1.5,wallWobbleCornerClamp:.8}},o={default:{label:"Default (Full View Grid)",parallaxLinearDotSizeMul:1.8,sizeVariationParallaxLinear:0,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:7,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:50,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:260},dense:{label:"Dense (More Vertices)",parallaxLinearDotSizeMul:1.6,sizeVariationParallaxLinear:.1,parallaxLinearGridX:18,parallaxLinearGridY:13,parallaxLinearGridZ:9,parallaxLinearSpanX:1.25,parallaxLinearSpanY:1.25,parallaxLinearZNear:45,parallaxLinearZFar:1e3,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:240},deep:{label:"Deep Field (Stronger Depth)",parallaxLinearDotSizeMul:1.7,sizeVariationParallaxLinear:.08,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:10,parallaxLinearSpanX:1.45,parallaxLinearSpanY:1.45,parallaxLinearZNear:30,parallaxLinearZFar:1500,parallaxLinearFocalLength:520,parallaxLinearParallaxStrength:320},calm:{label:"Calm (Slow Camera)",parallaxLinearDotSizeMul:1.8,sizeVariationParallaxLinear:.05,parallaxLinearGridX:12,parallaxLinearGridY:9,parallaxLinearGridZ:6,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:60,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:160},minimal:{label:"Minimal (Big Dots)",parallaxLinearDotSizeMul:2.4,sizeVariationParallaxLinear:.15,parallaxLinearGridX:10,parallaxLinearGridY:7,parallaxLinearGridZ:4,parallaxLinearSpanX:1.6,parallaxLinearSpanY:1.6,parallaxLinearZNear:70,parallaxLinearZFar:800,parallaxLinearFocalLength:380,parallaxLinearParallaxStrength:220}},l={default:{label:"Default (Nebula Grid)",parallaxPerspectiveDotSizeMul:1.8,sizeVariationParallaxPerspective:0,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:8,parallaxPerspectiveSpanX:1.45,parallaxPerspectiveSpanY:1.45,parallaxPerspectiveZNear:40,parallaxPerspectiveZFar:1200,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:280,parallaxPerspectiveRandomness:.6},calm:{label:"Calm Mist",parallaxPerspectiveDotSizeMul:1.9,sizeVariationParallaxPerspective:.08,parallaxPerspectiveGridX:14,parallaxPerspectiveGridY:10,parallaxPerspectiveGridZ:6,parallaxPerspectiveSpanX:1.4,parallaxPerspectiveSpanY:1.4,parallaxPerspectiveZNear:60,parallaxPerspectiveZFar:900,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:180,parallaxPerspectiveRandomness:.25},deep:{label:"Deep Space",parallaxPerspectiveDotSizeMul:1.6,sizeVariationParallaxPerspective:.06,parallaxPerspectiveGridX:18,parallaxPerspectiveGridY:13,parallaxPerspectiveGridZ:12,parallaxPerspectiveSpanX:1.55,parallaxPerspectiveSpanY:1.55,parallaxPerspectiveZNear:30,parallaxPerspectiveZFar:2200,parallaxPerspectiveFocalLength:520,parallaxPerspectiveParallaxStrength:340,parallaxPerspectiveRandomness:.55},wild:{label:"Wild Nebula",parallaxPerspectiveDotSizeMul:1.7,sizeVariationParallaxPerspective:.18,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:10,parallaxPerspectiveSpanX:1.6,parallaxPerspectiveSpanY:1.6,parallaxPerspectiveZNear:20,parallaxPerspectiveZFar:1600,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:360,parallaxPerspectiveRandomness:.9},minimal:{label:"Minimal Stars",parallaxPerspectiveDotSizeMul:2.6,sizeVariationParallaxPerspective:.22,parallaxPerspectiveGridX:10,parallaxPerspectiveGridY:7,parallaxPerspectiveGridZ:5,parallaxPerspectiveSpanX:1.75,parallaxPerspectiveSpanY:1.75,parallaxPerspectiveZNear:70,parallaxPerspectiveZFar:1100,parallaxPerspectiveFocalLength:380,parallaxPerspectiveParallaxStrength:220,parallaxPerspectiveRandomness:.35}};let s=Math.max(1,Math.min(2,window.devicePixelRatio||1));function c(e){s=e}const d={config:{},currentMode:t.CRITTERS,warmupFramesRemaining:0,balls:[],canvas:null,ctx:null,container:null,mouseX:r.OFFSCREEN_MOUSE,mouseY:r.OFFSCREEN_MOUSE,mouseInCanvas:!1,lastPointerMoveMs:0,lastPointerMoveX:r.OFFSCREEN_MOUSE,lastPointerMoveY:r.OFFSCREEN_MOUSE,GE:1960,G:0,gravityScale:1,gravityMultiplier:0,gravityMultiplierPit:1.1,pitThrowSpeed:650,pitThrowSpeedJitter:.22,pitThrowAngleJitter:.16,pitThrowBatchSize:18,pitThrowIntervalMs:70,pitThrowColorPauseMs:180,pitThrowTargetYFrac:.36,pitThrowInletInset:.06,pitThrowCrossBias:.12,pitThrowSpawnSpread:.02,pitThrowAimJitter:.04,pitThrowPairChance:.35,pitThrowPairStaggerMs:18,pitThrowSpeedVar:.18,pitThrowSpreadVar:.25,REST:.69,FRICTION:.006,ballMassKg:129,MASS_BASELINE_KG:129,MASS_REST_EXP:.15,MASS_GRAVITY_EXP:.35,get DPR(){return s},sizeScale:1.2,sizeVariationGlobalMul:1,sizeVariationCap:.12,sizeVariationPit:0,sizeVariationPitThrows:0,sizeVariationFlies:0,sizeVariationWeightless:0,sizeVariationWater:0,sizeVariationVortex:.2,sizeVariationPingPong:0,sizeVariationMagnetic:0,sizeVariationBubbles:.2,sizeVariationKaleidoscope:0,sizeVariationOrbit3d:0,sizeVariationCritters:.2,sizeVariationNeural:0,sizeVariationLattice:0,sizeVariationParallaxLinear:0,sizeVariationParallaxPerspective:0,pitWarmupFrames:10,pitThrowsWarmupFrames:10,fliesWarmupFrames:10,weightlessWarmupFrames:10,waterWarmupFrames:10,vortexWarmupFrames:10,pingPongWarmupFrames:10,magneticWarmupFrames:10,bubblesWarmupFrames:10,kaleidoscopeWarmupFrames:10,kaleidoscope1WarmupFrames:10,kaleidoscope2WarmupFrames:10,kaleidoscope3WarmupFrames:10,orbit3dWarmupFrames:10,orbit3d2WarmupFrames:10,crittersWarmupFrames:10,neuralWarmupFrames:10,latticeWarmupFrames:10,parallaxLinearWarmupFrames:10,parallaxPerspectiveWarmupFrames:10,sizeVariation:0,responsiveScale:1,responsiveScaleMobile:.75,isMobile:!1,R_MIN_BASE:6,R_MAX_BASE:24,R_MED:0,R_MIN:0,R_MAX:0,cursorSize:1,cursorColorMode:"auto",cursorColorIndex:5,cursorColorHex:"#ff4013",cursorColorLumaMax:.62,cursorColorAllowIndices:[],cursorColorDenyIndices:[],mouseTrailEnabled:!0,mouseTrailLength:18,mouseTrailSize:1.3,mouseTrailFadeMs:220,mouseTrailOpacity:.35,ballSoftness:20,ballSpacing:2.5,critterCount:90,critterSpeed:680,critterMaxSpeed:1400,critterStepHz:5,critterStepSharpness:2.4,critterTurnNoise:2.2,critterTurnDamp:10,critterTurnSeek:10,critterAvoidRadius:90,critterAvoidForce:9500,critterEdgeAvoid:1,critterMousePull:1,critterMouseRadiusVw:30,critterRestitution:.18,critterFriction:.018,cornerRadius:42,layoutViewportWidthPx:0,containerBorderVw:0,simulationPaddingVw:0,contentPaddingVw:0,contentPaddingHorizontalRatio:1,wallRadiusVw:0,wallThicknessVw:0,layoutMinContentPaddingPx:16,layoutMinWallRadiusPx:28,wallInset:3,vortexSwirlStrength:420,vortexRadialPull:180,vortexBallCount:180,vortexSpeedMultiplier:1,vortexRadius:0,vortexFalloffCurve:1,vortexRotationDirection:1,vortexCoreStrength:1,vortexAccelerationZone:0,vortexOutwardPush:0,vortexFalloffRate:.0015,magneticBallCount:180,magneticStrength:65e3,magneticMaxVelocity:2800,magneticExplosionInterval:5,bubblesSpawnRate:8,bubblesRiseSpeed:150,bubblesWobble:40,bubblesMaxCount:200,bubblesDeflectRadius:200,pingPongBallCount:35,pingPongSpeed:800,pingPongCursorRadius:50,currentColors:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],currentTemplate:"industrialTeal",fliesBallCount:60,attractionPower:5e3,orbitRadius:180,swarmSpeed:.4,fliesSeparation:15e3,weightlessCount:80,weightlessInitialSpeed:250,weightlessBounce:.97,weightlessRepelRadius:220,weightlessRepelPower:22e4,weightlessRepelSoft:2.2,kaleidoscopeBallCount:23,kaleidoscopeWedges:12,kaleidoscopeMirror:1,kaleidoscopeSpeed:1,kaleidoscopeDotSizeVh:.95,kaleidoscopeDotAreaMul:.7,kaleidoscope1BallCount:18,kaleidoscope1Wedges:8,kaleidoscope1Speed:.8,kaleidoscope1DotSizeVh:.95,kaleidoscope1DotAreaMul:.7,kaleidoscope2BallCount:36,kaleidoscope2Wedges:8,kaleidoscope2Speed:1.15,kaleidoscope2DotSizeVh:.95,kaleidoscope2DotAreaMul:.7,kaleidoscope3BallCount:54,kaleidoscope3Wedges:8,kaleidoscope3Speed:1.55,kaleidoscope3DotSizeVh:.95,kaleidoscope3DotAreaMul:.7,orbit3dPreset:"serene",orbit3dMoonCount:80,orbit3dGravity:5e3,orbit3dMoonMass:1,orbit3dVelocityMult:150,orbit3dTargetOrbit:12,orbit3dMinOrbit:3,orbit3dMaxOrbit:3,orbit3dDepthScale:.8,orbit3dDamping:.02,orbit3d2MoonCount:60,orbit3d2Gravity:3e3,orbit3d2VelocityMult:200,orbit3d2MinOrbit:5,orbit3d2MaxOrbit:30,orbit3d2DepthScale:.5,orbit3d2Damping:.98,orbit3d2MoonMass:1,orbit3d2MaxSpeed:800,neuralBallCount:80,neuralLinkDistanceVw:14,neuralLineOpacity:.22,neuralWanderStrength:420,neuralMaxLinksPerBall:4,neuralDamping:.985,latticeBallCount:90,latticeSpacingVw:8.5,latticeStiffness:2.2,latticeDamping:.92,latticeDisruptRadius:600,latticeDisruptPower:25,latticeMeshWaveStrength:12,latticeMeshWaveSpeed:.8,latticeAlignment:"center",parallaxLinearDotCount:95,parallaxLinearRowPattern:"thirds",parallaxLinearSpacingPattern:"even",parallaxLinearFarPct:.42,parallaxLinearMidPct:.32,parallaxLinearFarSpeed:.15,parallaxLinearMidSpeed:.5,parallaxLinearNearSpeed:1,parallaxLinearFollowStrength:16,parallaxLinearDamping:12,parallaxPerspectiveDotCount:240,parallaxPerspectiveDepthMul:1.6,parallaxPerspectiveFocalLength:400,parallaxPerspectiveFollowStrength:16,parallaxPerspectiveDamping:12,parallaxPerspectiveZ1:1200,parallaxPerspectiveZ2:700,parallaxPerspectiveZ3:350,parallaxPerspectiveZ4:120,parallaxPerspectiveZ5:35,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:7,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:50,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:260,parallaxLinearDotSizeMul:1.8,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:8,parallaxPerspectiveSpanX:1.45,parallaxPerspectiveSpanY:1.45,parallaxPerspectiveZNear:40,parallaxPerspectiveZFar:1200,parallaxPerspectiveParallaxStrength:280,parallaxPerspectiveRandomness:.6,parallaxPerspectiveDotSizeMul:1.8,waterBallCount:300,waterDrag:.015,waterRippleSpeed:300,waterRippleStrength:18e3,waterDriftStrength:40,waterInitialVelocity:200,vortexDrag:.005,pingPongCursorRadius:100,pingPongVerticalDamp:.995,magneticDamping:.98,repelRadius:120,repelPower:274e3,repelSoft:3.4,repellerEnabled:!1,cursorInfluenceRadiusVw:14,cursorInfluenceRadiusPx:140,emitterTimer:0,autoDarkModeEnabled:!0,isDarkMode:!1,chromeHarmonyMode:"site",autoDarkNightStartHour:18,autoDarkNightEndHour:6,clickCycleEnabled:!0,brandLogoImpactMul:.014,brandLogoSquashMul:1,brandLogoOvershoot:.22,brandLogoAnticipation:0,brandLogoTiltDeg:0,brandLogoSkewDeg:0,brandLogoPressMs:75,brandLogoHoldMs:55,brandLogoReleaseMs:220,containerBorder:20,simulationPadding:0,contentPadding:40,contentPaddingX:40,contentPaddingY:40,containerInnerShadowOpacity:.12,containerInnerShadowBlur:80,containerInnerShadowSpread:-10,containerInnerShadowOffsetY:0,frameColor:"#0a0a0a",wallThickness:12,wallRadius:42,wallInset:3,wallPreset:"rubber",wallSoftness:50,wallBounciness:50,wallWobbleMaxDeform:45,wallWobbleStiffness:2200,wallWobbleDamping:35,wallWobbleSigma:2,wallWobbleCornerClamp:.6,wallWobbleImpactThreshold:140,wallWobbleSettlingSpeed:75,gateOverlayEnabled:!0,gateOverlayOpacity:.01,gateOverlayBlurPx:16,gateOverlayTransitionMs:800,gateOverlayTransitionOutMs:600,gateOverlayContentDelayMs:200,gateDepthScale:.96,gateDepthTranslateY:8,logoOpacityInactive:1,logoOpacityActive:.2,logoBlurInactive:0,logoBlurActive:12,ghostLayerEnabled:!1,ghostLayerOpacity:.7,ghostLayerUsePerThemeOpacity:!1,ghostLayerOpacityLight:.7,ghostLayerOpacityDark:.7,getSquashMax(){return 0===this.ballSoftness?0:r.SQUASH_MAX_BASE*(this.ballSoftness/40)},getCanvasCornerRadius(){return Math.max(0,this.cornerRadius-this.simulationPadding)}};function p(e,t,a,n){const r=Number(e);return Number.isFinite(r)?Math.min(a,Math.max(t,r)):n}function u(e,t,a,n){const r=p(e,t,a,n);return Math.round(r)}function m(){const e=Number(d.layoutViewportWidthPx);return Number.isFinite(e)&&e>0?e:Math.max(1,window.innerWidth||1)}function h(e,t){const a=Math.max(1,t||m()),n=Number(e);return Number.isFinite(n)?n/a*100:0}function g(e,t){const a=Math.max(1,t||m()),n=Number(e);return Number.isFinite(n)?n/100*a:0}function f(){const e=m(),t=g(d.containerBorderVw,e),a=g(d.simulationPaddingVw,e),n=g(d.contentPaddingVw,e),r=g(d.wallRadiusVw,e),i=Math.max(0,Math.round(d.layoutMinContentPaddingPx||0)),o=Math.max(0,Math.round(d.layoutMinWallRadiusPx||0)),l=g(Number.isFinite(d.wallThicknessVw)&&d.wallThicknessVw>0?d.wallThicknessVw:d.containerBorderVw,e);d.containerBorder=Math.round(t),d.simulationPadding=Math.round(a),d.contentPadding=Math.max(i,Math.round(n));const s=Math.max(.1,d.contentPaddingHorizontalRatio||1);d.contentPaddingY=d.contentPadding,d.contentPaddingX=Math.round(d.contentPadding*s),d.wallRadius=Math.max(o,Math.round(r)),d.cornerRadius=d.wallRadius,d.wallThickness=Math.round(l);const c=Math.max(0,g(d.cursorInfluenceRadiusVw||0,e));d.cursorInfluenceRadiusPx=Math.round(c),d.repelRadius=Math.round(c),d.weightlessRepelRadius=Math.round(c),d.pingPongCursorRadius=Math.round(c),d.bubblesDeflectRadius=Math.round(c)}function y(){const e=document.documentElement;e.style.setProperty("--container-border",`${d.containerBorder}px`),e.style.setProperty("--simulation-padding",`${d.simulationPadding}px`),e.style.setProperty("--content-padding",`${d.contentPadding}px`),e.style.setProperty("--content-padding-x",`${d.contentPaddingX}px`),e.style.setProperty("--content-padding-y",`${d.contentPaddingY}px`),e.style.setProperty("--wall-radius",`${d.wallRadius}px`),e.style.setProperty("--wall-thickness",`${d.wallThickness}px`)}function v(e){if(d.config={...e},void 0!==e.layoutViewportWidthPx&&(d.layoutViewportWidthPx=p(e.layoutViewportWidthPx,0,4096,0)),e.ballMass&&(d.ballMassKg=e.ballMass),void 0!==e.gravityMultiplier&&(d.gravityMultiplier=e.gravityMultiplier,d.gravityMultiplierPit=e.gravityMultiplier),e.restitution&&(d.REST=e.restitution),e.friction&&(d.FRICTION=e.friction),void 0!==e.ballScale&&(d.sizeScale=e.ballScale),void 0!==e.sizeScale&&(d.sizeScale=e.sizeScale),void 0!==e.sizeVariationGlobalMul&&(d.sizeVariationGlobalMul=p(e.sizeVariationGlobalMul,0,2,d.sizeVariationGlobalMul)),void 0!==e.sizeVariationPit&&(d.sizeVariationPit=p(e.sizeVariationPit,0,1,d.sizeVariationPit)),void 0!==e.sizeVariationPitThrows&&(d.sizeVariationPitThrows=p(e.sizeVariationPitThrows,0,1,d.sizeVariationPitThrows)),void 0!==e.sizeVariationFlies&&(d.sizeVariationFlies=p(e.sizeVariationFlies,0,1,d.sizeVariationFlies)),void 0!==e.sizeVariationWeightless&&(d.sizeVariationWeightless=p(e.sizeVariationWeightless,0,1,d.sizeVariationWeightless)),void 0!==e.sizeVariationWater&&(d.sizeVariationWater=p(e.sizeVariationWater,0,1,d.sizeVariationWater)),void 0!==e.sizeVariationVortex&&(d.sizeVariationVortex=p(e.sizeVariationVortex,0,1,d.sizeVariationVortex)),void 0!==e.sizeVariationPingPong&&(d.sizeVariationPingPong=p(e.sizeVariationPingPong,0,1,d.sizeVariationPingPong)),void 0!==e.sizeVariationMagnetic&&(d.sizeVariationMagnetic=p(e.sizeVariationMagnetic,0,1,d.sizeVariationMagnetic)),void 0!==e.sizeVariationBubbles&&(d.sizeVariationBubbles=p(e.sizeVariationBubbles,0,1,d.sizeVariationBubbles)),void 0!==e.sizeVariationKaleidoscope&&(d.sizeVariationKaleidoscope=p(e.sizeVariationKaleidoscope,0,1,d.sizeVariationKaleidoscope)),void 0!==e.sizeVariationOrbit3d&&(d.sizeVariationOrbit3d=p(e.sizeVariationOrbit3d,0,1,d.sizeVariationOrbit3d)),void 0!==e.sizeVariationCritters&&(d.sizeVariationCritters=p(e.sizeVariationCritters,0,1,d.sizeVariationCritters)),void 0!==e.sizeVariationNeural&&(d.sizeVariationNeural=p(e.sizeVariationNeural,0,1,d.sizeVariationNeural)),void 0!==e.sizeVariationLattice&&(d.sizeVariationLattice=p(e.sizeVariationLattice,0,1,d.sizeVariationLattice)),void 0!==e.sizeVariationParallaxLinear&&(d.sizeVariationParallaxLinear=p(e.sizeVariationParallaxLinear,0,1,d.sizeVariationParallaxLinear)),void 0!==e.sizeVariationParallaxPerspective&&(d.sizeVariationParallaxPerspective=p(e.sizeVariationParallaxPerspective,0,1,d.sizeVariationParallaxPerspective)),void 0!==e.sizeVariation&&(d.sizeVariation=e.sizeVariation),void 0!==e.pitWarmupFrames&&(d.pitWarmupFrames=u(e.pitWarmupFrames,0,240,d.pitWarmupFrames)),void 0!==e.pitThrowsWarmupFrames&&(d.pitThrowsWarmupFrames=u(e.pitThrowsWarmupFrames,0,240,d.pitThrowsWarmupFrames)),void 0!==e.fliesWarmupFrames&&(d.fliesWarmupFrames=u(e.fliesWarmupFrames,0,240,d.fliesWarmupFrames)),void 0!==e.weightlessWarmupFrames&&(d.weightlessWarmupFrames=u(e.weightlessWarmupFrames,0,240,d.weightlessWarmupFrames)),void 0!==e.waterWarmupFrames&&(d.waterWarmupFrames=u(e.waterWarmupFrames,0,240,d.waterWarmupFrames)),void 0!==e.vortexWarmupFrames&&(d.vortexWarmupFrames=u(e.vortexWarmupFrames,0,240,d.vortexWarmupFrames)),void 0!==e.pingPongWarmupFrames&&(d.pingPongWarmupFrames=u(e.pingPongWarmupFrames,0,240,d.pingPongWarmupFrames)),void 0!==e.magneticWarmupFrames&&(d.magneticWarmupFrames=u(e.magneticWarmupFrames,0,240,d.magneticWarmupFrames)),void 0!==e.bubblesWarmupFrames&&(d.bubblesWarmupFrames=u(e.bubblesWarmupFrames,0,240,d.bubblesWarmupFrames)),void 0!==e.kaleidoscopeWarmupFrames&&(d.kaleidoscopeWarmupFrames=u(e.kaleidoscopeWarmupFrames,0,240,d.kaleidoscopeWarmupFrames)),void 0!==e.kaleidoscope1WarmupFrames&&(d.kaleidoscope1WarmupFrames=u(e.kaleidoscope1WarmupFrames,0,240,d.kaleidoscope1WarmupFrames)),void 0!==e.kaleidoscope2WarmupFrames&&(d.kaleidoscope2WarmupFrames=u(e.kaleidoscope2WarmupFrames,0,240,d.kaleidoscope2WarmupFrames)),void 0!==e.kaleidoscope3WarmupFrames&&(d.kaleidoscope3WarmupFrames=u(e.kaleidoscope3WarmupFrames,0,240,d.kaleidoscope3WarmupFrames)),void 0!==e.orbit3dWarmupFrames&&(d.orbit3dWarmupFrames=u(e.orbit3dWarmupFrames,0,240,d.orbit3dWarmupFrames)),void 0!==e.orbit3d2WarmupFrames&&(d.orbit3d2WarmupFrames=u(e.orbit3d2WarmupFrames,0,240,d.orbit3d2WarmupFrames)),void 0!==e.crittersWarmupFrames&&(d.crittersWarmupFrames=u(e.crittersWarmupFrames,0,240,d.crittersWarmupFrames)),void 0!==e.neuralWarmupFrames&&(d.neuralWarmupFrames=u(e.neuralWarmupFrames,0,240,d.neuralWarmupFrames)),void 0!==e.latticeWarmupFrames&&(d.latticeWarmupFrames=u(e.latticeWarmupFrames,0,240,d.latticeWarmupFrames)),void 0!==e.parallaxLinearWarmupFrames&&(d.parallaxLinearWarmupFrames=u(e.parallaxLinearWarmupFrames,0,240,d.parallaxLinearWarmupFrames)),void 0!==e.parallaxPerspectiveWarmupFrames&&(d.parallaxPerspectiveWarmupFrames=u(e.parallaxPerspectiveWarmupFrames,0,240,d.parallaxPerspectiveWarmupFrames)),P(),void 0!==e.maxBalls&&(d.maxBalls=e.maxBalls),void 0!==e.repelRadius&&(d.repelRadius=e.repelRadius),void 0!==e.repelPower&&(d.repelPower=e.repelPower),void 0!==e.repelSoft&&(d.repelSoft=e.repelSoft),void 0!==e.repelSoftness&&(d.repelSoft=e.repelSoftness),void 0!==e.cursorInfluenceRadiusVw?d.cursorInfluenceRadiusVw=p(e.cursorInfluenceRadiusVw,0,80,d.cursorInfluenceRadiusVw):void 0!==e.repelRadius&&(d.cursorInfluenceRadiusVw=p(e.repelRadius/10,0,80,d.cursorInfluenceRadiusVw)),void 0!==e.responsiveScaleMobile&&(d.responsiveScaleMobile=e.responsiveScaleMobile),w(),void 0!==e.kaleidoscopeBallCount&&(d.kaleidoscopeBallCount=p(e.kaleidoscopeBallCount,10,300,d.kaleidoscopeBallCount)),void 0!==e.kaleidoscopeDotSizeVh&&(d.kaleidoscopeDotSizeVh=p(e.kaleidoscopeDotSizeVh,.1,6,d.kaleidoscopeDotSizeVh)),void 0!==e.kaleidoscopeDotAreaMul&&(d.kaleidoscopeDotAreaMul=p(e.kaleidoscopeDotAreaMul,.1,2,d.kaleidoscopeDotAreaMul)),void 0!==e.kaleidoscope1BallCount&&(d.kaleidoscope1BallCount=p(e.kaleidoscope1BallCount,3,300,d.kaleidoscope1BallCount)),void 0!==e.kaleidoscope1Wedges&&(d.kaleidoscope1Wedges=p(e.kaleidoscope1Wedges,3,24,d.kaleidoscope1Wedges)),void 0!==e.kaleidoscope1Speed&&(d.kaleidoscope1Speed=p(e.kaleidoscope1Speed,.2,2,d.kaleidoscope1Speed)),void 0!==e.kaleidoscope1DotSizeVh&&(d.kaleidoscope1DotSizeVh=p(e.kaleidoscope1DotSizeVh,.1,6,d.kaleidoscope1DotSizeVh)),void 0!==e.kaleidoscope1DotAreaMul&&(d.kaleidoscope1DotAreaMul=p(e.kaleidoscope1DotAreaMul,.1,2,d.kaleidoscope1DotAreaMul)),void 0!==e.kaleidoscope2BallCount&&(d.kaleidoscope2BallCount=p(e.kaleidoscope2BallCount,3,300,d.kaleidoscope2BallCount)),void 0!==e.kaleidoscope2Wedges&&(d.kaleidoscope2Wedges=p(e.kaleidoscope2Wedges,3,24,d.kaleidoscope2Wedges)),void 0!==e.kaleidoscope2Speed&&(d.kaleidoscope2Speed=p(e.kaleidoscope2Speed,.2,2,d.kaleidoscope2Speed)),void 0!==e.kaleidoscope2DotSizeVh&&(d.kaleidoscope2DotSizeVh=p(e.kaleidoscope2DotSizeVh,.1,6,d.kaleidoscope2DotSizeVh)),void 0!==e.kaleidoscope2DotAreaMul&&(d.kaleidoscope2DotAreaMul=p(e.kaleidoscope2DotAreaMul,.1,2,d.kaleidoscope2DotAreaMul)),void 0!==e.kaleidoscope3BallCount&&(d.kaleidoscope3BallCount=p(e.kaleidoscope3BallCount,3,300,d.kaleidoscope3BallCount)),void 0!==e.kaleidoscope3Wedges&&(d.kaleidoscope3Wedges=p(e.kaleidoscope3Wedges,3,24,d.kaleidoscope3Wedges)),void 0!==e.kaleidoscope3Speed&&(d.kaleidoscope3Speed=p(e.kaleidoscope3Speed,.2,2,d.kaleidoscope3Speed)),void 0!==e.kaleidoscope3DotSizeVh&&(d.kaleidoscope3DotSizeVh=p(e.kaleidoscope3DotSizeVh,.1,6,d.kaleidoscope3DotSizeVh)),void 0!==e.kaleidoscope3DotAreaMul&&(d.kaleidoscope3DotAreaMul=p(e.kaleidoscope3DotAreaMul,.1,2,d.kaleidoscope3DotAreaMul)),void 0!==e.kaleidoscopeWedges?d.kaleidoscopeWedges=p(e.kaleidoscopeWedges,3,24,d.kaleidoscopeWedges):void 0!==e.kaleidoscopeSegments&&(d.kaleidoscopeWedges=p(e.kaleidoscopeSegments,3,24,d.kaleidoscopeWedges)),void 0!==e.kaleidoscopeMirror&&(d.kaleidoscopeMirror=p(e.kaleidoscopeMirror,0,1,d.kaleidoscopeMirror)),void 0!==e.kaleidoscopeSpeed)d.kaleidoscopeSpeed=p(e.kaleidoscopeSpeed,.2,2,d.kaleidoscopeSpeed);else if(void 0!==e.kaleidoscopeSwirlStrength){const t=p(e.kaleidoscopeSwirlStrength,0,800,52);d.kaleidoscopeSpeed=p(.2+t/800*1.8,.2,2,d.kaleidoscopeSpeed)}void 0!==e.critterCount&&(d.critterCount=e.critterCount),void 0!==e.critterSpeed&&(d.critterSpeed=e.critterSpeed),void 0!==e.critterMaxSpeed&&(d.critterMaxSpeed=e.critterMaxSpeed),void 0!==e.critterStepHz&&(d.critterStepHz=e.critterStepHz),void 0!==e.critterStepSharpness&&(d.critterStepSharpness=e.critterStepSharpness),void 0!==e.critterTurnNoise&&(d.critterTurnNoise=e.critterTurnNoise),void 0!==e.critterTurnDamp&&(d.critterTurnDamp=e.critterTurnDamp),void 0!==e.critterTurnSeek&&(d.critterTurnSeek=e.critterTurnSeek),void 0!==e.critterAvoidRadius&&(d.critterAvoidRadius=e.critterAvoidRadius),void 0!==e.critterAvoidForce&&(d.critterAvoidForce=e.critterAvoidForce),void 0!==e.critterEdgeAvoid&&(d.critterEdgeAvoid=e.critterEdgeAvoid),void 0!==e.critterMousePull&&(d.critterMousePull=e.critterMousePull),void 0!==e.layoutMinContentPaddingPx&&(d.layoutMinContentPaddingPx=p(e.layoutMinContentPaddingPx,0,200,d.layoutMinContentPaddingPx)),void 0!==e.layoutMinWallRadiusPx&&(d.layoutMinWallRadiusPx=p(e.layoutMinWallRadiusPx,0,400,d.layoutMinWallRadiusPx)),void 0!==e.critterMouseRadiusVw&&(d.critterMouseRadiusVw=e.critterMouseRadiusVw),void 0!==e.critterRestitution&&(d.critterRestitution=e.critterRestitution),void 0!==e.critterFriction&&(d.critterFriction=e.critterFriction),void 0!==e.neuralBallCount&&(d.neuralBallCount=p(e.neuralBallCount,8,260,d.neuralBallCount)),void 0!==e.neuralLinkDistanceVw&&(d.neuralLinkDistanceVw=p(e.neuralLinkDistanceVw,1,50,d.neuralLinkDistanceVw)),void 0!==e.neuralLineOpacity&&(d.neuralLineOpacity=p(e.neuralLineOpacity,0,1,d.neuralLineOpacity)),void 0!==e.neuralWanderStrength&&(d.neuralWanderStrength=p(e.neuralWanderStrength,0,4e3,d.neuralWanderStrength)),void 0!==e.neuralMaxLinksPerBall&&(d.neuralMaxLinksPerBall=p(e.neuralMaxLinksPerBall,0,16,d.neuralMaxLinksPerBall)),void 0!==e.neuralDamping&&(d.neuralDamping=p(e.neuralDamping,.8,1,d.neuralDamping)),void 0!==e.latticeBallCount&&(d.latticeBallCount=p(e.latticeBallCount,8,260,d.latticeBallCount)),void 0!==e.latticeSpacingVw&&(d.latticeSpacingVw=p(e.latticeSpacingVw,1,40,d.latticeSpacingVw)),void 0!==e.latticeStiffness&&(d.latticeStiffness=p(e.latticeStiffness,0,20,d.latticeStiffness)),void 0!==e.latticeDamping&&(d.latticeDamping=p(e.latticeDamping,.5,1,d.latticeDamping)),void 0!==e.latticeDisruptRadius&&(d.latticeDisruptRadius=p(e.latticeDisruptRadius,50,800,d.latticeDisruptRadius)),void 0!==e.latticeDisruptPower&&(d.latticeDisruptPower=p(e.latticeDisruptPower,0,20,d.latticeDisruptPower)),void 0!==e.latticeMeshWaveStrength&&(d.latticeMeshWaveStrength=p(e.latticeMeshWaveStrength,0,50,d.latticeMeshWaveStrength)),void 0!==e.latticeMeshWaveSpeed&&(d.latticeMeshWaveSpeed=p(e.latticeMeshWaveSpeed,0,3,d.latticeMeshWaveSpeed)),void 0!==e.latticeAlignment&&(d.latticeAlignment=String(e.latticeAlignment)),void 0!==e.parallaxLinearDotCount&&(d.parallaxLinearDotCount=p(e.parallaxLinearDotCount,20,220,d.parallaxLinearDotCount)),void 0!==e.parallaxLinearGridJitter&&(d.parallaxLinearGridJitter=p(e.parallaxLinearGridJitter,0,1,d.parallaxLinearGridJitter)),void 0!==e.parallaxLinearFarSpeed&&(d.parallaxLinearFarSpeed=p(e.parallaxLinearFarSpeed,0,1.5,d.parallaxLinearFarSpeed)),void 0!==e.parallaxLinearMidSpeed&&(d.parallaxLinearMidSpeed=p(e.parallaxLinearMidSpeed,0,1.5,d.parallaxLinearMidSpeed)),void 0!==e.parallaxLinearNearSpeed&&(d.parallaxLinearNearSpeed=p(e.parallaxLinearNearSpeed,0,1.5,d.parallaxLinearNearSpeed)),void 0!==e.parallaxLinearGridX&&(d.parallaxLinearGridX=u(e.parallaxLinearGridX,3,40,d.parallaxLinearGridX)),void 0!==e.parallaxLinearGridY&&(d.parallaxLinearGridY=u(e.parallaxLinearGridY,3,40,d.parallaxLinearGridY)),void 0!==e.parallaxLinearGridZ&&(d.parallaxLinearGridZ=u(e.parallaxLinearGridZ,2,20,d.parallaxLinearGridZ)),void 0!==e.parallaxLinearSpanX&&(d.parallaxLinearSpanX=p(e.parallaxLinearSpanX,.2,3,d.parallaxLinearSpanX)),void 0!==e.parallaxLinearSpanY&&(d.parallaxLinearSpanY=p(e.parallaxLinearSpanY,.2,3,d.parallaxLinearSpanY)),void 0!==e.parallaxLinearZNear&&(d.parallaxLinearZNear=p(e.parallaxLinearZNear,10,1200,d.parallaxLinearZNear)),void 0!==e.parallaxLinearZFar&&(d.parallaxLinearZFar=p(e.parallaxLinearZFar,50,3e3,d.parallaxLinearZFar)),void 0!==e.parallaxLinearFocalLength&&(d.parallaxLinearFocalLength=p(e.parallaxLinearFocalLength,80,2e3,d.parallaxLinearFocalLength)),void 0!==e.parallaxLinearParallaxStrength&&(d.parallaxLinearParallaxStrength=p(e.parallaxLinearParallaxStrength,0,2e3,d.parallaxLinearParallaxStrength)),void 0!==e.parallaxLinearDotSizeMul&&(d.parallaxLinearDotSizeMul=p(e.parallaxLinearDotSizeMul,.1,6,d.parallaxLinearDotSizeMul)),void 0!==e.parallaxLinearFollowStrength&&(d.parallaxLinearFollowStrength=p(e.parallaxLinearFollowStrength,1,80,d.parallaxLinearFollowStrength)),void 0!==e.parallaxLinearDamping&&(d.parallaxLinearDamping=p(e.parallaxLinearDamping,1,80,d.parallaxLinearDamping)),void 0!==e.parallaxPerspectiveDotCount&&(d.parallaxPerspectiveDotCount=p(e.parallaxPerspectiveDotCount,40,420,d.parallaxPerspectiveDotCount)),void 0!==e.parallaxPerspectiveDepthMul&&(d.parallaxPerspectiveDepthMul=p(e.parallaxPerspectiveDepthMul,.5,3,d.parallaxPerspectiveDepthMul)),void 0!==e.parallaxPerspectiveFocalLength&&(d.parallaxPerspectiveFocalLength=p(e.parallaxPerspectiveFocalLength,80,1e3,d.parallaxPerspectiveFocalLength)),void 0!==e.parallaxPerspectiveFollowStrength&&(d.parallaxPerspectiveFollowStrength=p(e.parallaxPerspectiveFollowStrength,1,40,d.parallaxPerspectiveFollowStrength)),void 0!==e.parallaxPerspectiveDamping&&(d.parallaxPerspectiveDamping=p(e.parallaxPerspectiveDamping,1,40,d.parallaxPerspectiveDamping)),void 0!==e.parallaxPerspectiveZ1&&(d.parallaxPerspectiveZ1=p(e.parallaxPerspectiveZ1,200,2e3,d.parallaxPerspectiveZ1)),void 0!==e.parallaxPerspectiveZ2&&(d.parallaxPerspectiveZ2=p(e.parallaxPerspectiveZ2,150,1500,d.parallaxPerspectiveZ2)),void 0!==e.parallaxPerspectiveZ3&&(d.parallaxPerspectiveZ3=p(e.parallaxPerspectiveZ3,100,1e3,d.parallaxPerspectiveZ3)),void 0!==e.parallaxPerspectiveZ4&&(d.parallaxPerspectiveZ4=p(e.parallaxPerspectiveZ4,40,600,d.parallaxPerspectiveZ4)),void 0!==e.parallaxPerspectiveZ5&&(d.parallaxPerspectiveZ5=p(e.parallaxPerspectiveZ5,10,300,d.parallaxPerspectiveZ5)),void 0!==e.parallaxPerspectiveGridX&&(d.parallaxPerspectiveGridX=u(e.parallaxPerspectiveGridX,3,50,d.parallaxPerspectiveGridX)),void 0!==e.parallaxPerspectiveGridY&&(d.parallaxPerspectiveGridY=u(e.parallaxPerspectiveGridY,3,50,d.parallaxPerspectiveGridY)),void 0!==e.parallaxPerspectiveGridZ&&(d.parallaxPerspectiveGridZ=u(e.parallaxPerspectiveGridZ,2,25,d.parallaxPerspectiveGridZ)),void 0!==e.parallaxPerspectiveSpanX&&(d.parallaxPerspectiveSpanX=p(e.parallaxPerspectiveSpanX,.2,3,d.parallaxPerspectiveSpanX)),void 0!==e.parallaxPerspectiveSpanY&&(d.parallaxPerspectiveSpanY=p(e.parallaxPerspectiveSpanY,.2,3,d.parallaxPerspectiveSpanY)),void 0!==e.parallaxPerspectiveZNear&&(d.parallaxPerspectiveZNear=p(e.parallaxPerspectiveZNear,10,1200,d.parallaxPerspectiveZNear)),void 0!==e.parallaxPerspectiveZFar&&(d.parallaxPerspectiveZFar=p(e.parallaxPerspectiveZFar,50,4e3,d.parallaxPerspectiveZFar)),void 0!==e.parallaxPerspectiveParallaxStrength&&(d.parallaxPerspectiveParallaxStrength=p(e.parallaxPerspectiveParallaxStrength,0,2e3,d.parallaxPerspectiveParallaxStrength)),void 0!==e.parallaxPerspectiveRandomness&&(d.parallaxPerspectiveRandomness=p(e.parallaxPerspectiveRandomness,0,1,d.parallaxPerspectiveRandomness)),void 0!==e.parallaxPerspectiveDotSizeMul&&(d.parallaxPerspectiveDotSizeMul=p(e.parallaxPerspectiveDotSizeMul,.1,6,d.parallaxPerspectiveDotSizeMul));for(const[t,a]of Object.entries(e||{})){if(!(t in d))continue;if("config"===t)continue;if("soundConfig"===t||"soundPreset"===t)continue;if("function"==typeof d[t])continue;const e=Array.isArray(a),n=null===a||["string","number","boolean"].includes(typeof a);(e||n)&&void 0!==a&&(d[t]=a)}void 0!==e.brandLogoImpactMul&&(d.brandLogoImpactMul=p(e.brandLogoImpactMul,0,.05,d.brandLogoImpactMul)),void 0!==e.brandLogoSquashMul&&(d.brandLogoSquashMul=p(e.brandLogoSquashMul,0,3,d.brandLogoSquashMul)),void 0!==e.brandLogoOvershoot&&(d.brandLogoOvershoot=p(e.brandLogoOvershoot,0,.8,d.brandLogoOvershoot)),void 0!==e.brandLogoAnticipation&&(d.brandLogoAnticipation=p(e.brandLogoAnticipation,0,.6,d.brandLogoAnticipation)),void 0!==e.brandLogoTiltDeg&&(d.brandLogoTiltDeg=p(e.brandLogoTiltDeg,0,5,d.brandLogoTiltDeg)),void 0!==e.brandLogoSkewDeg&&(d.brandLogoSkewDeg=p(e.brandLogoSkewDeg,0,5,d.brandLogoSkewDeg)),void 0!==e.brandLogoPressMs&&(d.brandLogoPressMs=p(e.brandLogoPressMs,20,300,d.brandLogoPressMs)),void 0!==e.brandLogoHoldMs&&(d.brandLogoHoldMs=p(e.brandLogoHoldMs,0,300,d.brandLogoHoldMs)),void 0!==e.brandLogoReleaseMs&&(d.brandLogoReleaseMs=p(e.brandLogoReleaseMs,40,800,d.brandLogoReleaseMs)),void 0!==e.containerBorder&&(d.containerBorder=e.containerBorder),void 0!==e.simulationPadding&&(d.simulationPadding=e.simulationPadding),void 0!==e.contentPadding&&(d.contentPadding=e.contentPadding),void 0!==e.containerInnerShadowOpacity&&(d.containerInnerShadowOpacity=e.containerInnerShadowOpacity),void 0!==e.containerInnerShadowBlur&&(d.containerInnerShadowBlur=e.containerInnerShadowBlur),void 0!==e.containerInnerShadowSpread&&(d.containerInnerShadowSpread=e.containerInnerShadowSpread),void 0!==e.containerInnerShadowOffsetY&&(d.containerInnerShadowOffsetY=e.containerInnerShadowOffsetY),void 0!==e.frameColor&&(d.frameColor=e.frameColor),void 0!==e.wallThickness&&(d.wallThickness=e.wallThickness),void 0!==e.wallRadius&&(d.wallRadius=e.wallRadius,d.cornerRadius=e.wallRadius),void 0!==e.wallInset&&(d.wallInset=e.wallInset),void 0!==e.wallInset&&(d.wallInset=e.wallInset),void 0!==e.ballSpacing&&(d.ballSpacing=e.ballSpacing),void 0!==e.wallPreset&&(d.wallPreset=e.wallPreset),void 0!==e.wallSoftness&&(d.wallSoftness=e.wallSoftness),void 0!==e.wallBounciness&&(d.wallBounciness=e.wallBounciness),void 0!==e.wallWobbleMaxDeform&&(d.wallWobbleMaxDeform=e.wallWobbleMaxDeform),void 0!==e.wallWobbleStiffness&&(d.wallWobbleStiffness=e.wallWobbleStiffness),void 0!==e.wallWobbleDamping&&(d.wallWobbleDamping=e.wallWobbleDamping),void 0!==e.wallWobbleSigma&&(d.wallWobbleSigma=e.wallWobbleSigma),void 0!==e.wallWobbleCornerClamp&&(d.wallWobbleCornerClamp=e.wallWobbleCornerClamp),void 0!==e.wallWobbleImpactThreshold&&(d.wallWobbleImpactThreshold=e.wallWobbleImpactThreshold),void 0!==e.wallWobbleSettlingSpeed&&(d.wallWobbleSettlingSpeed=e.wallWobbleSettlingSpeed),void 0!==e.gateOverlayEnabled&&(d.gateOverlayEnabled=e.gateOverlayEnabled),void 0!==e.gateOverlayOpacity&&(d.gateOverlayOpacity=e.gateOverlayOpacity),void 0!==e.gateOverlayBlurPx&&(d.gateOverlayBlurPx=e.gateOverlayBlurPx),void 0!==e.gateOverlayTransitionMs&&(d.gateOverlayTransitionMs=e.gateOverlayTransitionMs),void 0!==e.gateOverlayTransitionOutMs&&(d.gateOverlayTransitionOutMs=e.gateOverlayTransitionOutMs),void 0!==e.ghostLayerEnabled&&(d.ghostLayerEnabled=!!e.ghostLayerEnabled),void 0!==e.ghostLayerOpacity&&(d.ghostLayerOpacity=p(e.ghostLayerOpacity,0,1,d.ghostLayerOpacity)),void 0!==e.ghostLayerUsePerThemeOpacity&&(d.ghostLayerUsePerThemeOpacity=!!e.ghostLayerUsePerThemeOpacity),void 0!==e.ghostLayerOpacityLight&&(d.ghostLayerOpacityLight=p(e.ghostLayerOpacityLight,0,1,d.ghostLayerOpacityLight)),void 0!==e.ghostLayerOpacityDark&&(d.ghostLayerOpacityDark=p(e.ghostLayerOpacityDark,0,1,d.ghostLayerOpacityDark)),void 0!==e.orbit3dMoonCount&&(d.orbit3dMoonCount=p(e.orbit3dMoonCount,1,1e3,d.orbit3dMoonCount)),void 0!==e.orbit3dGravity&&(d.orbit3dGravity=p(e.orbit3dGravity,1e3,5e5,d.orbit3dGravity)),void 0!==e.orbit3dMoonMass&&(d.orbit3dMoonMass=p(e.orbit3dMoonMass,.1,100,d.orbit3dMoonMass)),void 0!==e.orbit3dVelocityMult&&(d.orbit3dVelocityMult=p(e.orbit3dVelocityMult,10,1e3,d.orbit3dVelocityMult)),void 0!==e.orbit3dTargetOrbit&&(d.orbit3dTargetOrbit=p(e.orbit3dTargetOrbit,1,100,d.orbit3dTargetOrbit)),void 0!==e.orbit3dMinOrbit&&(d.orbit3dMinOrbit=p(e.orbit3dMinOrbit,1,100,d.orbit3dMinOrbit)),void 0!==e.orbit3dMaxOrbit&&(d.orbit3dMaxOrbit=p(e.orbit3dMaxOrbit,1,200,d.orbit3dMaxOrbit)),void 0!==e.orbit3dDepthScale&&(d.orbit3dDepthScale=p(e.orbit3dDepthScale,0,1.5,d.orbit3dDepthScale)),void 0!==e.orbit3dDamping&&(d.orbit3dDamping=p(e.orbit3dDamping,.01,.2,d.orbit3dDamping)),void 0!==e.orbit3d2MoonCount&&(d.orbit3d2MoonCount=p(e.orbit3d2MoonCount,1,300,d.orbit3d2MoonCount)),void 0!==e.orbit3d2Gravity&&(d.orbit3d2Gravity=p(e.orbit3d2Gravity,1e3,5e5,d.orbit3d2Gravity)),void 0!==e.orbit3d2VelocityMult&&(d.orbit3d2VelocityMult=p(e.orbit3d2VelocityMult,.1,2,d.orbit3d2VelocityMult)),void 0!==e.orbit3d2MinOrbit&&(d.orbit3d2MinOrbit=p(e.orbit3d2MinOrbit,1,50,d.orbit3d2MinOrbit)),void 0!==e.orbit3d2MaxOrbit&&(d.orbit3d2MaxOrbit=p(e.orbit3d2MaxOrbit,1,50,d.orbit3d2MaxOrbit)),void 0!==e.orbit3d2DepthScale&&(d.orbit3d2DepthScale=p(e.orbit3d2DepthScale,0,.95,d.orbit3d2DepthScale)),void 0!==e.orbit3d2Damping&&(d.orbit3d2Damping=p(e.orbit3d2Damping,0,1,d.orbit3d2Damping)),void 0!==e.orbit3d2FollowSmoothing&&(d.orbit3d2FollowSmoothing=p(e.orbit3d2FollowSmoothing,1,200,d.orbit3d2FollowSmoothing)),void 0!==e.orbit3d2Softening&&(d.orbit3d2Softening=p(e.orbit3d2Softening,1,100,d.orbit3d2Softening));const t=m();void 0!==e.containerBorderVw&&(d.containerBorderVw=p(e.containerBorderVw,0,20,d.containerBorderVw)),void 0!==e.simulationPaddingVw&&(d.simulationPaddingVw=p(e.simulationPaddingVw,0,20,d.simulationPaddingVw)),void 0!==e.contentPaddingVw&&(d.contentPaddingVw=p(e.contentPaddingVw,0,40,d.contentPaddingVw)),void 0!==e.contentPaddingHorizontalRatio&&(d.contentPaddingHorizontalRatio=p(e.contentPaddingHorizontalRatio,.1,3,d.contentPaddingHorizontalRatio)),void 0!==e.wallRadiusVw&&(d.wallRadiusVw=p(e.wallRadiusVw,0,40,d.wallRadiusVw)),void 0!==e.wallThicknessVw&&(d.wallThicknessVw=p(e.wallThicknessVw,0,20,d.wallThicknessVw)),Number.isFinite(d.containerBorderVw)&&d.containerBorderVw>0||(d.containerBorderVw=h(d.containerBorder,t)),Number.isFinite(d.simulationPaddingVw)&&d.simulationPaddingVw>=0||(d.simulationPaddingVw=h(d.simulationPadding,t)),Number.isFinite(d.contentPaddingVw)&&d.contentPaddingVw>0||(d.contentPaddingVw=h(d.contentPadding,t)),Number.isFinite(d.wallRadiusVw)&&d.wallRadiusVw>0||(d.wallRadiusVw=h(d.wallRadius,t)),Number.isFinite(d.wallThicknessVw)&&d.wallThicknessVw>0||(d.wallThicknessVw=h(d.wallThickness,t)),f()}function b(){return d}function x(e,t,a){d.canvas=e,d.ctx=t,d.container=a}function M(e){d.currentMode=e}function S(){d.balls.length=0}function w(){const e=navigator.userAgent||"",t=/iPad/.test(e)||/Mac/.test(e)&&navigator.maxTouchPoints>1,a=/iPhone/.test(e);t||a?(d.isMobile=!0,d.responsiveScale=d.responsiveScaleMobile,console.log(`✓ Mobile device detected - ball scale: ${d.responsiveScale}x`)):(d.isMobile=!1,d.responsiveScale=1),P()}function P(){const e=(d.R_MIN_BASE+d.R_MAX_BASE)/2*(d.sizeScale*d.responsiveScale);d.R_MED=Math.max(1,e);const t=p(d.sizeVariationCap,0,.5,.12),a=p(d.sizeVariationGlobalMul,0,2,1),n=p(t*a,0,.5,t);d.R_MIN=Math.max(1,d.R_MED*(1-n)),d.R_MAX=Math.max(d.R_MIN,d.R_MED*(1+n))}var L=Object.freeze({__proto__:null,applyLayoutCSSVars:y,applyLayoutFromVwToPx:f,clearBalls:S,detectResponsiveScale:w,getBalls:function(){return d.balls},getConfig:function(){return d.config},getEffectiveDPR:function(){return s},getGlobals:b,getLayoutViewportWidthPx:m,getState:function(){return d},initState:v,pxToVw:h,setCanvas:x,setEffectiveDPR:c,setMode:M,updateBallSizes:P,vwToPx:g});const C={industrialTeal:{label:"Industrial Teal",light:["#b7bcb7","#d0d0d0","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#6b726b","#3d453d","#8a928a","#00e6c3","#d5d5d5","#ff6b47","#5b9aff","#ffb84d"]},sunsetCoral:{label:"Sunset Coral",light:["#bdbbb8","#e8e6e3","#ffffff","#ff3b3b","#000000","#00f5d4","#1e40af","#fb923c"],dark:["#716f6b","#3f3d3a","#8e8c88","#ff6b6b","#d8d8d8","#00ffe7","#6ba3ff","#ffb570"]},violetPunch:{label:"Violet Punch",light:["#b8b7c2","#e6e5ed","#ffffff","#9333ea","#000000","#dc2626","#0ea5e9","#facc15"],dark:["#6d6c7a","#3a3845","#8b8a98","#c266ff","#dad6e8","#ff5c5c","#42d4ff","#fff066"]},citrusBlast:{label:"Citrus Blast",light:["#bfbdb5","#eae8df","#ffffff","#ea580c","#000000","#e11d48","#2563eb","#059669"],dark:["#74726a","#403e38","#918f87","#ff8c4d","#dbd9d1","#ff5c7a","#6ba3ff","#00d699"]},cobaltSpark:{label:"Cobalt Spark",light:["#b5b8be","#e3e6eb","#ffffff","#1d4ed8","#000000","#ea580c","#db2777","#d97706"],dark:["#696d75","#3a3e45","#878b93","#6b9dff","#d6dae2","#ff8c5c","#ff66b3","#ffc266"]}},E=[.5,.25,.12,.06,.03,.02,.01,.01],F=[3,5,6,7];function I(e,t,a){const n=Number(e);if(!Number.isFinite(n))return t;const r=Math.floor(n);return r<t?t:r>a?a:r}function T(e){return Array.isArray(e)&&e.every(e=>Number.isFinite(Number(e)))}function k(e){const t=String(e||"").trim();if(!t)return null;const a="#"===t[0]?t.slice(1):t;if(3!==a.length&&6!==a.length)return null;const n=3===a.length?a[0]+a[0]+a[1]+a[1]+a[2]+a[2]:a,r=parseInt(n,16);return Number.isFinite(r)?{r:(r>>16&255)/255,g:(r>>8&255)/255,b:(255&r)/255}:null}function D(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function A(e){const t=k(e);return t?.2126*D(t.r)+.7152*D(t.g)+.0722*D(t.b):1}function R(e){const t=k(e);if(!t)return 0;const a=Math.max(t.r,t.g,t.b),n=Math.min(t.r,t.g,t.b);return a<=0?0:(a-n)/a}function O(e,t){const a=t||b(),n=e&&e.length?e:[],r=Math.min(7,n.length-1);if(r<0)return[];const i=Number.isFinite(Number(a.cursorColorLumaMax))?Number(a.cursorColorLumaMax):.62,o=T(a.cursorColorAllowIndices)?a.cursorColorAllowIndices.map(e=>I(e,0,7)):[],l=T(a.cursorColorDenyIndices)?a.cursorColorDenyIndices.map(e=>I(e,0,7)):[],s=new Set(l),c=o.length?new Set(o):null,d=[];for(let e=0;e<=r;e++){if(s.has(e))continue;if(c&&!c.has(e))continue;const t=n[e];t&&(A(t)>i||R(t)<.18||d.push(e))}if(d.length)return d;const p=[];for(const e of F)e<=r&&!s.has(e)&&(!c||c.has(e))&&p.push(e);if(p.length)return p;for(let e=0;e<=r;e++)s.has(e)||c&&!c.has(e)||p.push(e);return p}function B(e,{forceMode:t}={}){const a=b(),n=a.currentColors,r=O(n,a),i=I(e,0,7),o=r.includes(i)?i:r[0]??i,l=function(e,t){const a=e&&e.length?e:[];return a[I(t,0,Math.max(0,Math.min(7,a.length-1)))]||"#000000"}(n,o);return t&&(a.cursorColorMode=t),a.cursorColorIndex=o,a.cursorColorHex=l,function(e){try{document.documentElement.style.setProperty("--cursor-color",String(e||"").trim()||"#000000")}catch(e){}}(l),{index:o,hex:l}}function V(e="auto"){const t=b();if("auto"!==t.cursorColorMode)return B(t.cursorColorIndex,{forceMode:t.cursorColorMode}),!1;const a=O(t.currentColors,t);if(!a.length)return!1;const n=Number.isFinite(Number(t._lastCursorColorIndex))?Number(t._lastCursorColorIndex):-1;let r=a[Math.random()*a.length|0];return a.length>1&&r===n&&(r=a[Math.random()*a.length|0],r===n&&(r=a[(a.indexOf(n)+1)%a.length])),t._lastCursorColorIndex=r,B(r,{forceMode:"auto"}),!0}function _(e){const t=b(),a=C[e];return a?t.isDarkMode?a.dark:a.light:C.industrialTeal.light}function W(){const e=b().currentColors;if(!e||0===e.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let a=0;for(let n=0;n<Math.min(e.length,E.length);n++)if(a+=E[n],t<=a)return e[n];return e[Math.min(e.length-1,7)]}function z(e){const t=b().currentColors;return t&&0!==t.length?t[Math.max(0,Math.min(7,Math.floor(e)))]||"#ffffff":(console.warn("No colors available, using fallback"),"#ffffff")}function K(e){const t=b();t.currentTemplate=e,t.currentColors=_(e),"auto"!==t.cursorColorMode&&"manual"!==t.cursorColorMode&&(t.cursorColorMode="auto"),B(t.cursorColorIndex,{forceMode:t.cursorColorMode}),function(){const e=b(),t=e.balls,a=e.currentColors;if(t.length>0&&a&&a.length>0){const e=Math.min(8,a.length,t.length),n=Math.floor(Math.random()*e);for(let r=0;r<e;r++)t[r].color=a[(n+r)%e];for(let a=e;a<t.length;a++)t[a].color=W();return}for(let e=0;e<t.length;e++)t[e].color=W()}(),function(e){try{const t=document.documentElement,a=(e&&e.length?e:[]).slice(0,8);for(let e=0;e<8;e++){const n=a[e]||"#ffffff";t.style.setProperty(`--ball-${e+1}`,n)}}catch(e){}}(t.currentColors),function(){const e=b().currentColors;for(let t=1;t<=8;t++){const a=document.getElementById(`color${t}`),n=document.getElementById(`color${t}Val`);a&&e[t-1]&&(a.value=e[t-1],n&&(n.textContent=e[t-1].toUpperCase()))}}();try{window.dispatchEvent(new CustomEvent("bb:paletteChanged",{detail:{template:e}}))}catch(e){}}function N(){const e=document.getElementById("colorSelect");if(!e)return;e.innerHTML="";for(const[t,a]of Object.entries(C)){const n=document.createElement("option");n.value=t,n.textContent=a.label,e.appendChild(n)}const t=b();e.value=t.currentTemplate}var G=Object.freeze({__proto__:null,COLOR_TEMPLATES:C,applyColorTemplate:K,applyCursorColorIndex:B,getColorByIndex:z,getCurrentPalette:_,getCursorCandidateIndices:O,maybeAutoPickCursorColor:V,pickRandomColor:W,populateColorSelect:N});function $(e,t=.15){return e*(1+2*(Math.random()-.5)*t)}const q={attackTime:.005,decayTime:.075,harmonicGain:0,filterBaseFreq:580,filterVelocityRange:400,filterQ:.18,filterMinHz:350,filterMaxHz:2800,pitchMinHz:145,pitchMaxHz:280,pitchCurve:1,reverbDecay:.14,reverbWetMix:.08,reverbHighDamp:.8,minGain:.008,maxGain:.09,masterGain:.28,voiceGainMax:.14,minTimeBetweenSounds:.012,maxPan:.15,noiseTransientEnabled:!0,noiseTransientGain:.045,noiseTransientDecay:.008,noiseTransientFilterMin:500,noiseTransientFilterMax:1800,noiseTransientQ:1.2,sparkleGain:0,sparkleRatioMin:2.3,sparkleRatioMax:4.1,sparkleDecayMul:.65,variancePitch:.06,varianceDecay:.2,varianceGain:.15,varianceFilter:.18,varianceNoise:.25,velocityNoiseScale:1.8,velocityBrightnessScale:1.4,velocityDecayScale:.65,intensityExponent:1.5,toneSafetyMinHz:130,toneSafetyMaxHz:480,toneSafetyExponent:2.2,toneSafetyHighGainAtten:.25,toneSafetyLowGainAtten:.06,toneSafetyHighBrightAtten:.45,collisionMinImpact:.58,highShelfFreq:2200,highShelfGain:-6};let H=null;const X={organicImpact:{label:"Organic Impact",description:"Warm, natural thuds with intensity dynamics",...q},glassMarbles:{label:"Glass Marbles",description:"Clear, glassy impacts with more presence",...q,pitchMinHz:260,pitchMaxHz:780,pitchCurve:1.05,filterBaseFreq:850,filterVelocityRange:600,noiseTransientGain:.065,noiseTransientFilterMin:650,noiseTransientFilterMax:2200,noiseTransientQ:1.6,decayTime:.055,intensityExponent:1.3,highShelfGain:-4.5},crystalPebbles:{label:"Crystal Pebbles ★",description:"Crisp, close, soothing micro-chimes (non-repetitive)",...q,pitchMinHz:420,pitchMaxHz:1600,pitchCurve:1.15,filterBaseFreq:1300,filterVelocityRange:1700,filterQ:.22,filterMaxHz:6200,decayTime:.04,intensityExponent:1.65,collisionMinImpact:.7,minTimeBetweenSounds:.018,noiseTransientGain:.02,noiseTransientDecay:.006,noiseTransientFilterMin:1200,noiseTransientFilterMax:7e3,noiseTransientQ:2.8,sparkleGain:.12,sparkleRatioMin:2.6,sparkleRatioMax:4.4,sparkleDecayMul:.55,reverbWetMix:.04,reverbDecay:.1,highShelfGain:-4,masterGain:.24},woodenBeads:{label:"Wooden Beads ★",description:"Ultra-soft, muted thuds (recommended)",...q,filterBaseFreq:420,filterVelocityRange:200,noiseTransientGain:.025,noiseTransientFilterMin:380,noiseTransientFilterMax:1400,noiseTransientQ:1.1,decayTime:.095,intensityExponent:1.7,collisionMinImpact:.62,highShelfGain:-7.5,reverbWetMix:.12},rubberBalls:{label:"Rubber Balls",description:"Bouncy, playful with longer decay",...q,pitchMinHz:160,pitchMaxHz:360,filterBaseFreq:520,filterVelocityRange:350,noiseTransientGain:.035,noiseTransientFilterMin:450,noiseTransientFilterMax:1600,noiseTransientQ:1.2,decayTime:.12,intensityExponent:1.4,reverbWetMix:.14,highShelfGain:-5},metallicClick:{label:"Metallic Click",description:"Crisp, percussive impacts",...q,pitchMinHz:220,pitchMaxHz:620,pitchCurve:1.1,filterBaseFreq:720,filterVelocityRange:550,noiseTransientGain:.08,noiseTransientFilterMin:700,noiseTransientFilterMax:2400,noiseTransientQ:1.8,noiseTransientDecay:.006,decayTime:.045,intensityExponent:1.2,highShelfGain:-3.5,collisionMinImpact:.5}};let Y="crystalPebbles";H={...X[Y]},delete H.label,delete H.description;let Z=null,U=null,j=null,J=null,Q=null,ee=null,te=null,ae=null,ne=!1,re=!1;const ie="bravia-balls:sound-state";function oe(){try{"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent(ie,{detail:Me()}))}catch(e){}}const le=8;let se=[],ce=0,de=new Map,pe=!1,ue=null,me=!1;function he(){if(!me&&(me=!0,"undefined"!=typeof window&&window.matchMedia)){const e=window.matchMedia("(prefers-reduced-motion: reduce)");pe=e.matches,e.addEventListener("change",e=>{pe=e.matches})}}async function ge(){if(re)return!0;try{const e=window.AudioContext||window.webkitAudioContext;if(!e)return console.warn("Web Audio API not supported"),!1;Z=new e({latencyHint:"interactive",sampleRate:44100}),"suspended"===Z.state&&await Z.resume(),function(){U=Z.createGain(),U.gain.value=H.masterGain,ee=Z.createDynamicsCompressor(),ee.threshold.value=-6,ee.knee.value=10,ee.ratio.value=16,ee.attack.value=5e-4,ee.release.value=.08,ae=Z.createBiquadFilter(),ae.type="highshelf",ae.frequency.value=H.highShelfFreq,ae.gain.value=H.highShelfGain,ae.Q.value=.7,te=Z.createWaveShaper(),te.curve=function(e=.55){const t=1024,a=new Float32Array(t),n=1+8*e;for(let e=0;e<t;e++){const r=2*e/(t-1)-1;a[e]=Math.tanh(n*r)/Math.tanh(n)}return a}(.55),te.oversample="2x",J=Z.createGain(),J.gain.value=1-H.reverbWetMix,Q=Z.createGain(),Q.gain.value=H.reverbWetMix,j=function(){const e=Z.createGain(),t=Z.createGain(),a=[.029,.037,.053,.067].map(e=>{const t=Z.createDelay(.1);return t.delayTime.value=e*H.reverbDecay,t}),n=a.map(()=>{const e=Z.createGain();return e.gain.value=.4,e}),r=Z.createBiquadFilter();return r.type="lowpass",r.frequency.value=2e3*(1-H.reverbHighDamp),r.Q.value=.5,a.forEach((t,i)=>{e.connect(t),t.connect(n[i]),n[i].connect(r),n[i].connect(a[(i+1)%a.length])}),r.connect(t),e.connect(t),e._output=t,e}();const e=j._output;J.connect(te),Q.connect(j),e.connect(te),te.connect(ae),ae.connect(ee),ee.connect(U),U.connect(Z.destination),function(){se=[];for(let e=0;e<le;e++){const t={id:e,inUse:!1,startTime:0,filter:Z.createBiquadFilter(),envelope:Z.createGain(),panner:Z.createStereoPanner(),reverbSend:Z.createGain(),noiseFilter:Z.createBiquadFilter(),noiseEnvelope:Z.createGain(),osc:null,harmonicOsc:null,sparkleOsc:null,noiseSource:null};t.filter.type="lowpass",t.noiseFilter.type="bandpass",t.noiseFilter.Q.value=1.2,t.filter.connect(t.envelope),t.envelope.connect(t.panner),t.panner.connect(J),t.panner.connect(t.reverbSend),t.reverbSend.connect(Q),t.noiseFilter.connect(t.noiseEnvelope),t.noiseEnvelope.connect(t.panner),se.push(t)}}()}(),re=!0,ne=!0,oe();const t=1e3*(Z.baseLatency||0);return console.log(`✓ Audio unlocked (${t.toFixed(1)}ms base latency)`),!0}catch(e){return console.error("Failed to unlock audio:",e),!1}}function fe(e,t,a=.5,n=null){if(!ne||!re||!Z||pe)return;if(t<H.collisionMinImpact)return;const r=Z.currentTime;if(r-ce<.005)return;if(null!==n){if(r-(de.get(n)||0)<H.minTimeBetweenSounds)return;de.set(n,r)}if(ce=r,de.size>200){const e=r-.5;for(const[t,a]of de)a<e&&de.delete(t)}const i=function(){for(let e=0;e<le;e++)if(!se[e].inUse)return se[e];let e=se[0];for(let t=1;t<le;t++)se[t].startTime<e.startTime&&(e=se[t]);return ve(e),e}();i&&function(e,t,a,n,r){e.inUse=!0,e.startTime=r;const i=Math.max(0,Math.min(1,a)),o=Math.pow(i,H.intensityExponent),l=$(t,H.variancePitch),s=$(H.decayTime,H.varianceDecay)*(1-o*(1-H.velocityDecayScale)),c=s+.02;let d=H.minGain+(H.maxGain-H.minGain)*o;d*=$(1,H.varianceGain);const p=1+(H.velocityBrightnessScale-1)*o;let u=H.filterBaseFreq+H.filterVelocityRange*Math.pow(o,1.3);u*=$(1,H.varianceFilter)*p;const m=2*(n-.5)*H.maxPan,h=.12+.5*(1-o);({gain:d,filterFreq:u}=function(e,t,a){const n=be((e-H.toneSafetyMinHz)/(H.toneSafetyMaxHz-H.toneSafetyMinHz),0,1),r=H.toneSafetyExponent,i=Math.pow(n,r),o=Math.pow(1-n,r),l=be(1-H.toneSafetyHighGainAtten*i-H.toneSafetyLowGainAtten*o,.6,1);let s=Math.min(t*l,H.voiceGainMax);const c=be(1-H.toneSafetyHighBrightAtten*i,.55,1);return{gain:s,filterFreq:be(a*c,H.filterMinHz,H.filterMaxHz)}}(l,d,u)),e.filter.frequency.value=u,e.filter.Q.value=H.filterQ,e.panner.pan.value=m,e.reverbSend.gain.value=h,e.noiseFilter.Q.value=be(H.noiseTransientQ||1.2,.5,8),e.envelope.gain.cancelScheduledValues(r),e.envelope.gain.setValueAtTime(d,r),e.envelope.gain.exponentialRampToValueAtTime(.001,r+s);const g=Z.createOscillator();if(g.type="sine",g.frequency.value=l,e.osc=g,g.connect(e.filter),(H.harmonicGain||0)>.001){const t=Z.createOscillator();t.type="sine",t.frequency.value=2*l;const a=Z.createGain();a.gain.cancelScheduledValues(r),a.gain.setValueAtTime(d*H.harmonicGain,r),a.gain.exponentialRampToValueAtTime(.001,r+s),e.harmonicOsc=t,t.connect(a),a.connect(e.filter),t.onended=()=>{try{a.disconnect()}catch(e){}},t.start(r),t.stop(r+c)}else e.harmonicOsc=null;if((H.sparkleGain||0)>.001){const t=Z.createOscillator();t.type="sine";const a=H.sparkleRatioMin||2.3,n=H.sparkleRatioMax||4.1,i=be(a+Math.random()*(n-a),1.2,10);t.frequency.value=l*$(i,.02);const o=Z.createGain(),p=Math.max(.012,s*be(H.sparkleDecayMul||.65,.25,.95));o.gain.cancelScheduledValues(r),o.gain.setValueAtTime(d*H.sparkleGain,r),o.gain.exponentialRampToValueAtTime(.001,r+p),e.sparkleOsc=t,t.connect(o),o.connect(e.filter),t.onended=()=>{try{o.disconnect()}catch(e){}},t.start(r),t.stop(r+c)}else e.sparkleOsc=null;if(H.noiseTransientEnabled&&o>.25){const t=function(){if(!ue){const e=2*Z.sampleRate;ue=Z.createBuffer(1,e,Z.sampleRate);const t=ue.getChannelData(0);let a=0,n=0,r=0;for(let i=0;i<e;i++){const e=2*Math.random()-1;a=.99765*a+.099046*e,n=.963*n+.2965164*e,r=.57*r+1.0526913*e,t[i]=.25*(a+n+r+.1848*e)}}const e=Z.createBufferSource();return e.buffer=ue,e.loopStart=1.5*Math.random(),e.loopEnd=e.loopStart+.1,e.loop=!1,e}();e.noiseSource=t;const a=Math.pow(o,1.4),n=H.noiseTransientFilterMin+(H.noiseTransientFilterMax-H.noiseTransientFilterMin)*a;e.noiseFilter.frequency.value=$(n,H.varianceNoise);const i=H.noiseTransientGain*H.velocityNoiseScale*a*d,l=$(H.noiseTransientDecay,H.varianceNoise);e.noiseEnvelope.gain.cancelScheduledValues(r),e.noiseEnvelope.gain.setValueAtTime(i,r),e.noiseEnvelope.gain.exponentialRampToValueAtTime(.001,r+l),t.connect(e.noiseFilter),t.start(r),t.stop(r+l+.01)}else e.noiseSource=null;g.start(r),g.stop(r+c),g.onended=()=>ve(e)}(i,function(e){const t=1-be((e-8)/47,0,1),a=be(H.pitchMinHz||145,40,6e3),n=be(H.pitchMaxHz||280,a+10,12e3),r=be(H.pitchCurve||1,.5,2.5);return(a+Math.pow(t,r)*(n-a))*$(1,1.5*(H.variancePitch||.06))}(e),Math.max(0,Math.min(1,t)),a,r)}function ye({intensity:e=.82,radius:t=18,xPosition:a=.72}={}){fe(t,e,a,null)}function ve(e){if(e.osc){try{e.osc.stop(),e.osc.disconnect()}catch(e){}e.osc=null}if(e.harmonicOsc){try{e.harmonicOsc.stop(),e.harmonicOsc.disconnect()}catch(e){}e.harmonicOsc=null}if(e.sparkleOsc){try{e.sparkleOsc.stop(),e.sparkleOsc.disconnect()}catch(e){}e.sparkleOsc=null}if(e.noiseSource){try{e.noiseSource.stop(),e.noiseSource.disconnect()}catch(e){}e.noiseSource=null}e.inUse=!1}function be(e,t,a){return e<t?t:e>a?a:e}function xe(){return!!re&&(ne=!ne,oe(),ne)}function Me(){return{isUnlocked:re,isEnabled:ne,activeSounds:se.filter(e=>e.inUse).length,poolSize:le}}function Se(){return{...H}}function we(e){for(const[t,a]of Object.entries(e))t in H&&(H[t]=a);Q&&J&&"reverbWetMix"in e&&(Q.gain.value=H.reverbWetMix,J.gain.value=1-H.reverbWetMix),ae&&("highShelfFreq"in e||"highShelfGain"in e)&&(ae.frequency.value=H.highShelfFreq,ae.gain.value=H.highShelfGain),U&&"masterGain"in e&&(U.gain.value=H.masterGain)}function Pe(e){const t=X[e];if(!t)return!1;Y=e;const{label:a,description:n,...r}=t;return we(r),!0}function Le(){return Y}const Ce=new Map;function Ee(){const e=b(),t=e.balls,a=e.canvas,n=e.R_MAX,i=(e.ballSpacing||0)*(e.DPR||1),o=t.length;if(o<2)return[];const l=Math.max(1,2*n),s=Math.ceil(a.width/l)+1;Ce.clear();for(let e=0;e<o;e++){const a=t[e],n=a.x/l|0,r=(a.y/l|0)*s+n;let i=Ce.get(r);i||(i=[],Ce.set(r,i)),i.push(e)}const c=[];for(const[e,a]of Ce){const n=e/s|0,o=e%s;for(let e=-1;e<=1;e++)for(let l=-1;l<=1;l++){const d=(n+e)*s+(o+l),p=Ce.get(d);if(p)for(let e=0;e<a.length;e++){const n=a[e];for(let e=0;e<p.length;e++){const a=p[e];if(a<=n)continue;const o=t[n],l=t[a],s=l.x-o.x,d=l.y-o.y,u=o.r+l.r+i,m=s*s+d*d;if(m<u*u){const e=u-Math.sqrt(Math.max(m,r.MIN_DISTANCE_EPSILON));c.push({i:n,j:a,overlap:e})}}}}}return c.sort((e,t)=>t.overlap-e.overlap),c}function Fe(e=10){const t=b(),a=t.balls,n=Ee(),i=t.REST,o=.5*t.DPR,l=(t.ballSpacing||0)*(t.DPR||1);for(let s=0;s<e;s++)for(let e=0;e<n.length;e++){const{i:c,j:d}=n[e],p=a[c],u=a[d];if(p.isSleeping&&u.isSleeping)continue;p.isSleeping&&p.wake(),u.isSleeping&&u.wake();const m=u.x-p.x,h=u.y-p.y,g=p.r+u.r+l,f=m*m+h*h;if(0===f||f>g*g)continue;const y=Math.sqrt(f),v=m/y,b=h/y,x=g-y,M=1/Math.max(p.m,.001),S=1/Math.max(u.m,.001),w=.8*Math.max(x-o,0)/(M+S),P=w*v,L=w*b;p.x-=P*M,p.y-=L*M,u.x+=P*S,u.y+=L*S;const C=u.vx-p.vx,E=u.vy-p.vy,F=C*v+E*b;if(F<0){const e=-(1+(Math.abs(F)<30?0:i))*F/(M+S),a=e*v,n=e*b;p.vx-=a*M,p.vy-=n*M,u.vx+=a*S,u.vy+=n*S;const o=C-F*v,l=E-F*b,d=Math.hypot(o,l);if(d>.001){const e=o*-b+l*v>=0?1:-1,t=r.SPIN_GAIN_TANGENT;p.omega-=e*t*d/Math.max(p.r,1),u.omega+=e*t*d/Math.max(u.r,1)}const m=Math.min(1,Math.abs(F)/(50*(p.r+u.r))),h=Math.min(t.getSquashMax(),.8*m);p.squashAmount=Math.max(p.squashAmount,.8*h),p.squashNormalAngle=Math.atan2(-b,-v),u.squashAmount=Math.max(u.squashAmount,.8*h),u.squashNormalAngle=Math.atan2(b,v),0===s&&fe((p.r+u.r)/2,m,(p.x+u.x)/2/(t.canvas?.width||1),`${c}-${e}`)}}}const Ie=12;class Te{constructor(){this.deformations=new Float32Array(Ie),this.velocities=new Float32Array(Ie),this.pressure=new Float32Array(Ie)}impact(e,t){const a=b(),n=Math.max(0,Math.min(.45,a.wallWobbleCornerClamp??.1)),r=11*Math.max(n,Math.min(1-n,e)),i=(a.wallWobbleMaxDeform??45)*t,o=Math.max(.25,a.wallWobbleSigma??2);for(let e=1;e<11;e++){const t=Math.abs(e-r),a=Math.exp(-t*t/(2*o*o)),n=Math.min(e,11-e),l=Math.min(1,n/2);this.velocities[e]+=i*a*l}}addPressure(e,t){const a=Math.max(0,Math.min(.45,.1)),n=11*Math.max(a,Math.min(1-a,e)),r=Math.max(1,Math.floor(n-2)),i=Math.min(10,Math.ceil(n+2));for(let e=r;e<=i;e++){const a=Math.abs(e-n),r=Math.max(0,1-a/3);this.pressure[e]=Math.min(1,this.pressure[e]+t*r)}}clearPressure(){this.pressure.fill(0)}step(e){const t=b(),a=Math.max(1,t.wallWobbleStiffness??2200),n=Math.max(0,t.wallWobbleDamping??35),r=Math.max(0,t.wallWobbleMaxDeform??45),i=Math.max(0,Math.min(100,t.wallWobbleSettlingSpeed??50))/100,o=2*Math.sqrt(a),l=5+30*i;this.deformations[0]=0,this.deformations[11]=0,this.velocities[0]=0,this.velocities[11]=0,this.pressure[0]=0,this.pressure[11]=0;const s=.5+1.5*i;for(let t=1;t<11;t++){const i=Math.abs(this.velocities[t]),c=Math.abs(this.deformations[t]),d=n*(1+1*Math.max(0,Math.min(1,1-c/20)))*(1+this.pressure[t]*l),p=Math.min(d,.95*o),u=-a*this.deformations[t]-p*this.velocities[t];this.velocities[t]+=u*e,this.deformations[t]+=this.velocities[t]*e,this.deformations[t]=Math.max(0,Math.min(r,this.deformations[t]));const m=this.pressure[t]>.5?.3:this.pressure[t]>.1?.8:2,h=this.pressure[t]>.5?.5:this.pressure[t]>.1?3:10;c<m*s&&i<h*s&&(this.deformations[t]=0,this.velocities[t]=0)}}getDeformAt(e){const t=11*Math.max(0,Math.min(1,e)),a=Math.floor(t),n=Math.min(a+1,11),r=t-a,i=r*r*(3-2*r);return this.deformations[a]*(1-i)+this.deformations[n]*i}getMaxDeformation(){let e=0;for(let t=0;t<Ie;t++)this.deformations[t]>e&&(e=this.deformations[t]);return e}hasDeformation(){return this.getMaxDeformation()>2}reset(){this.deformations.fill(0),this.velocities.fill(0),this.pressure.fill(0)}}const ke={top:new Te,bottom:new Te,left:new Te,right:new Te,clearAllPressure(){this.top.clearPressure(),this.bottom.clearPressure(),this.left.clearPressure(),this.right.clearPressure()},step(e){this.top.step(e),this.bottom.step(e),this.left.step(e),this.right.step(e)},reset(){this.top.reset(),this.bottom.reset(),this.left.reset(),this.right.reset()},hasAnyDeformation(){return this.top.hasDeformation()||this.bottom.hasDeformation()||this.left.hasDeformation()||this.right.hasDeformation()}};function De(e,t,a){e.startsWith("corner")||("top"===e?ke.top.impact(t,a):"bottom"===e?ke.bottom.impact(t,a):"left"===e?ke.left.impact(t,a):"right"===e&&ke.right.impact(t,a))}function Ae(e,t,a=1){e.startsWith("corner")||("top"===e?ke.top.addPressure(t,a):"bottom"===e?ke.bottom.addPressure(t,a):"left"===e?ke.left.addPressure(t,a):"right"===e&&ke.right.addPressure(t,a))}let Re=0;class Oe{constructor(e,t,a,n){const r=b();this.x=e,this.y=t,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=a,this.rBase=a,this.m=r.ballMassKg,this.color=n,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1,this.isSleeping=!1,this.sleepTimer=0,this._soundId="ball-"+Re++}step(e,a){const n=b(),{currentMode:i,G:o,gravityScale:l,FRICTION:s,MASS_BASELINE_KG:c}=n;this.t+=e,this.age+=e;const d=i===t.PIT||i===t.PIT_THROWS;if(this.isSleeping&&d){const e=n.mouseX,t=n.mouseY,a=(n.repelRadius||710)*n.DPR*1.2,r=this.x-e,i=this.y-t;r*r+i*i<a*a&&this.wake()}if(this.isSleeping)return;i!==t.WEIGHTLESS&&(this.vy+=o*l*e);const p=Math.max(.25,this.m/c),u=Math.sqrt(this.vx*this.vx+this.vy*this.vy),m=(i===t.WEIGHTLESS||i===t.ORBIT_3D||i===t.ORBIT_3D_2?0:s)*(1+1*Math.max(0,Math.min(1,1-u/100))),h=Math.max(0,1-m/p);if(this.vx*=h,this.vy*=h,i!==t.ORBIT_3D&&i!==t.ORBIT_3D_2){const e=2;Math.abs(this.vx)<e&&(this.vx=0),Math.abs(this.vy)<e&&i===t.WEIGHTLESS&&(this.vy=0)}0!==this.driftAx&&this.age<this.driftTime?this.vx+=this.driftAx*e/p:0!==this.driftAx&&(this.driftAx=0),a&&a(this,e),this.x+=this.vx*e,this.y+=this.vy*e;const g=Math.abs(this.omega),f=Math.max(0,Math.min(1,1-g/2)),y=r.SPIN_DAMP_PER_S*(1+.5*f),v=Math.max(0,1-y*e);this.omega*=v,this.theta+=this.omega*e,Math.abs(this.omega)<.01&&(this.omega=0);const x=Math.min(1,r.SQUASH_DECAY_PER_S*e);this.squashAmount+=(0-this.squashAmount)*x,this.squash=1-this.squashAmount,d&&this.updateSleepState(e,n)}updateSleepState(e,t){const a=Math.sqrt(this.vx*this.vx+this.vy*this.vy),n=Math.abs(this.omega),i=t.canvas;i&&this.y+this.r>=i.height-1&&a<r.SLEEP_VELOCITY_THRESHOLD&&n<r.SLEEP_ANGULAR_THRESHOLD?(this.sleepTimer+=e,this.sleepTimer>=r.TIME_TO_SLEEP&&(this.vx=0,this.vy=0,this.omega=0,this.isSleeping=!0)):this.sleepTimer=0}wake(){this.isSleeping=!1,this.sleepTimer=0}walls(e,a,n,i){const o=b(),{REST:l,MASS_BASELINE_KG:s,MASS_REST_EXP:c,currentMode:d,DPR:p}=o,u=void 0!==i?i:l,m=o.wallWobbleImpactThreshold??r.WALL_REST_VEL_THRESHOLD,h="function"==typeof o.getCanvasCornerRadius?o.getCanvasCornerRadius():o.cornerRadius??o.wallRadius??42,g=Math.max(0,h)*(p||1),f=Math.max(0,o.wallInset??3)*(p||1),y=Math.max(0,g-f);let v=!1;const x=[{cx:g,cy:g},{cx:e-g,cy:g},{cx:g,cy:a-g},{cx:e-g,cy:a-g}];for(let n=0;n<x.length;n++){if((d===t.PIT||d===t.PIT_THROWS)&&n<2)continue;const r=x[n],i=n%2==0?this.x<g:this.x>e-g,o=n<2?this.y<g:this.y>a-g;if(i&&o){const e=this.x-r.cx,t=this.y-r.cy,a=Math.sqrt(e*e+t*t),n=y-this.r;if(a>n&&n>0){v=!0;const r=a-n,i=e/a,o=t/a;this.x-=i*r,this.y-=o*r;const l=this.vx*i+this.vy*o;l>0&&(this.vx-=(1+u)*l*i,this.vy-=(1+u)*l*o)}}}const M=f,S=e-f,w=f,P=a-f;if(this.y+this.r>P){v=!0,this.y=P-this.r;const t=this.vy,a=this.vx-this.omega*this.r,i=Math.max(.25,this.m/s);this.omega+=a/this.r*r.SPIN_GAIN/i;const l=Math.abs(this.vx),d=Math.max(0,Math.min(1,1-l/80)),p=r.ROLL_FRICTION_PER_S*(1+1*d),h=Math.max(0,1-p*n/i);this.vx*=h,Math.abs(this.vx)<3&&(this.vx=0);const g=Math.abs(t)<m?0:u;this.vy=-this.vy*(g*Math.pow(s/this.m,c));const f=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(o.getSquashMax(),.8*f),this.squashNormalAngle=-Math.PI/2;const y=this.vx/this.r;this.omega+=(y-this.omega)*Math.min(1,r.GROUND_COUPLING_PER_S*n),Math.abs(this.omega)<.05&&(this.omega=0),fe(this.r,.7*f,this.x/e,this._soundId),!this.isSleeping&&t>0&&t>=m&&De("bottom",this.x/e,f);const b=this.isSleeping?1:Math.min(1,(m-Math.abs(t))/m);b>.1&&Ae("bottom",this.x/e,b)}if(d!==t.PIT&&d!==t.PIT_THROWS&&this.y-this.r<w){v=!0,this.y=w+this.r;const t=this.vy;this.vy=-this.vy*u;const a=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(o.getSquashMax(),.8*a),this.squashNormalAngle=Math.PI/2,fe(this.r,.7*a,this.x/e,this._soundId),!this.isSleeping&&t<0&&Math.abs(t)>=m&&De("top",this.x/e,a);const n=this.isSleeping?1:Math.min(1,(m-Math.abs(t))/m);n>.1&&Ae("top",this.x/e,n)}if(this.x+this.r>S){v=!0,this.x=S-this.r;const e=this.vx,t=this.vy-this.omega*this.r,n=Math.max(.25,this.m/s);this.omega+=t/this.r*(.5*r.SPIN_GAIN)/n,this.vx=-this.vx*(l*Math.pow(s/this.m,c));const i=Math.min(1,Math.abs(e)/(70*this.r));this.squashAmount=Math.min(o.getSquashMax(),.8*i),this.squashNormalAngle=Math.PI,fe(this.r,.6*i,1,this._soundId),!this.isSleeping&&e>0&&e>=m&&De("right",this.y/a,i);const d=this.isSleeping?1:Math.min(1,(m-Math.abs(e))/m);d>.1&&Ae("right",this.y/a,d)}if(this.x-this.r<M){v=!0,this.x=M+this.r;const e=this.vx,t=this.vy-this.omega*this.r,n=Math.max(.25,this.m/s);this.omega+=t/this.r*(.5*r.SPIN_GAIN)/n,this.vx=-this.vx*(l*Math.pow(s/this.m,c));const i=Math.min(1,Math.abs(e)/(70*this.r));this.squashAmount=Math.min(o.getSquashMax(),.8*i),this.squashNormalAngle=0,fe(this.r,.6*i,0,this._soundId),!this.isSleeping&&e<0&&Math.abs(e)>=m&&De("left",this.y/a,i);const d=this.isSleeping?1:Math.min(1,(m-Math.abs(e))/m);d>.1&&Ae("left",this.y/a,d)}v&&this.isSleeping&&this.wake()}draw(e){const t=this.squashAmount>.001,a=this.alpha<1;if(t||a){if(e.save(),e.translate(this.x,this.y),t){e.rotate(this.theta+this.squashNormalAngle);const t=1-.3*this.squashAmount,a=1+.3*this.squashAmount;e.scale(t,a),e.rotate(-this.squashNormalAngle)}else e.rotate(this.theta);a&&(e.globalAlpha=this.alpha),e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI),e.fillStyle=this.color,e.fill(),e.restore()}else e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.r,0,2*Math.PI),e.fill()}}function Be(e,t,a){return e<t?t:e>a?a:e}function Ve(e,t,a){return e+(t-e)*a}function _e(e,a){switch(a){case t.PIT:return e.sizeVariationPit??0;case t.PIT_THROWS:return e.sizeVariationPitThrows??0;case t.FLIES:return e.sizeVariationFlies??0;case t.WEIGHTLESS:return e.sizeVariationWeightless??0;case t.WATER:return e.sizeVariationWater??0;case t.VORTEX:return e.sizeVariationVortex??0;case t.PING_PONG:return e.sizeVariationPingPong??0;case t.MAGNETIC:return e.sizeVariationMagnetic??0;case t.BUBBLES:return e.sizeVariationBubbles??0;case t.KALEIDOSCOPE:case t.KALEIDOSCOPE_1:case t.KALEIDOSCOPE_2:case t.KALEIDOSCOPE_3:return e.sizeVariationKaleidoscope??0;case t.ORBIT_3D:return e.sizeVariationOrbit3d??0;case t.ORBIT_3D_2:return e.sizeVariationOrbit3d2??0;case t.CRITTERS:return e.sizeVariationCritters??0;case t.NEURAL:return e.sizeVariationNeural??0;case t.LATTICE:return e.sizeVariationLattice??0;case t.PARALLAX_LINEAR:return e.sizeVariationParallaxLinear??0;case t.PARALLAX_PERSPECTIVE:return e.sizeVariationParallaxPerspective??0;default:return 0}}function We(e,t){const a=Be(Number(e.sizeVariationCap??.12),0,.5),n=Be(Number(e.sizeVariationGlobalMul??1),0,2),r=Be(Number(_e(e,t)??0),0,1);return Be(a*n*r,0,.5)}function ze(e,t){const{minR:a,maxR:n,medR:r}=function(e,t){const a=Math.max(1,e.R_MED||.5*(e.R_MIN+e.R_MAX)||10),n=Be(Number(e.sizeVariationCap??.12),0,.5),r=Be(Number(e.sizeVariationGlobalMul??1),0,2),i=Be(Number(_e(e,t)??0),0,1),o=Be(n*r*i,0,.5);return{minR:Math.max(1,a*(1-o)),maxR:Math.max(1,a*(1+o)),medR:a}}(e,t);return n-a<1e-6?r:Ve(a,n,Math.random())}const Ke=[];function Ne(e,t){const a=b(),n=a.waterDrag||.015;e.vx*=1-n,e.vy*=1-n,e.omega*=1-.5*n;for(let a=0;a<Ke.length;a++){const n=Ke[a],r=e.x-n.x,i=e.y-n.y,o=Math.sqrt(r*r+i*i),l=40,s=n.radius-l,c=n.radius+l;if(o>s&&o<c){const a=Math.abs(o-n.radius),s=n.strength*(1-a/l);if(o>.1){const a=r/o,n=i/o;e.vx+=a*s*t,e.vy+=n*s*t}}}const r=a.waterDriftStrength||25;e.vx+=Math.sin(.5*e.t+.01*e.x)*r*t,e.vy+=Math.cos(.7*e.t+.01*e.y)*r*t}function Ge(e){const t=b().waterRippleSpeed||300;for(let a=Ke.length-1;a>=0;a--){const n=Ke[a];n.radius+=t*e,n.age+=e,n.strength*=.96,(n.age>3||n.strength<10)&&Ke.splice(a,1)}}function $e(e,t,a=1){const n=(b().waterRippleStrength||15e3)*Math.min(a,5);Ke.push({x:e,y:t,radius:0,strength:n,age:0})}function qe(e,a,n){n||(n=W());const r=b(),i=ze(r,r.currentMode||t.PIT),o=new Oe(e,a,i,n),l=e<.5*r.canvas.width?1:-1,s=(c=i/(.5*(r.R_MIN+r.R_MAX)),Math.max(.6,Math.min(1.4,c)));var c;const d=140*s,p=180*s;return o.vx=l*(d+Math.random()*p),o.vy=120*-Math.random(),o.driftAx=l*(360+420*Math.random())*s,o.driftTime=.22+.28*Math.random(),r.balls.push(o),o}function He(e,t){const a=b(),n=-1e9===a.mouseX?.5*a.canvas.width:a.mouseX,r=-1e9===a.mouseY?.5*a.canvas.height:a.mouseY,i=n-e.x,o=r-e.y,l=Math.sqrt(i*i+o*o+1),s=i/l,c=o/l;e.vx+=4e3*s*t,e.vy+=4e3*c*t;const d=120*a.DPR;let p=0,u=0,m=0;for(let t=0;t<a.balls.length;t++){const n=a.balls[t];if(n===e)continue;const r=e.x-n.x,i=e.y-n.y,o=r*r+i*i;if(o<d*d&&o>0){const e=Math.sqrt(o),t=1-e/d;p+=r/e*t,u+=i/e*t,m++}}if(m>0){const a=15e3;e.vx+=p/m*a*t,e.vy+=u/m*a*t}e.vx+=1e3*(Math.random()-.5)*t,e.vy+=1e3*(Math.random()-.5)*t}function Xe(e,t){const a=b(),n=a.repelPower,r=a.repelRadius,i=a.mouseX,o=a.mouseY;if(!a.repellerEnabled||n<=0||r<=0)return;const l=r*a.DPR,s=e.x-i,c=e.y-o,d=s*s+c*c;if(d>l*l)return;const p=Math.max(Math.sqrt(d),1e-4),u=s/p,m=c/p,h=Math.max(0,1-p/l),g=20*n*Math.pow(h,a.repelSoft||3.4),f=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=u*g*t/f,e.vy+=m*g*t/f}function Ye(e,t,a){return Math.max(t,Math.min(a,e))}function Ze(e,t){return e+Math.random()*(t-e)}function Ue(e){const t=0|e.spawnedTotal;return e.spawnedTotal=t+1,t<8?z(t):void 0}function je(e,t,a,{speedMul:n=1,spreadMul:r=1}={}){const i=e.canvas.width,o=e.canvas.height,l=e.DPR,s=(e.wallThickness||20)*l,c=Math.max(1,i-2*s),d=.35*-o,p=.05*-o,u=Ye(e.pitThrowInletInset??.06,0,.2),m=0===a?s+c*u:i-s-c*u,h=Ye(e.pitThrowSpawnSpread??.02,0,.12),g=Ye(h*r,0,.18),f=m+Ze(-c*g,c*g),y=Ze(d,p),v=Ye(e.pitThrowTargetYFrac??.36,.12,.7),b=Ye(e.pitThrowCrossBias??.12,0,.35),x=Ye(e.pitThrowAimJitter??.04,0,.2),M=Ye(x*r,0,.25),S=i*(.5+(0===a?b:-b)+Ze(-M,M)),w=o*v,P=Ye(e.pitThrowSpeed??650,50,4e3),L=Ye(e.pitThrowSpeedJitter??.22,0,.8),C=Ye(e.pitThrowAngleJitter??.16,0,.8),E=qe(f,y,t),F=S-f,I=w-y,T=Math.max(1e-4,Math.sqrt(F*F+I*I));let k=F/T,D=I/T;const A=Ze(-Math.PI,Math.PI)*C,R=Math.cos(A),O=Math.sin(A),B=k*O+D*R;k=k*R-D*O,D=B;const V=P*n*(1+Ze(-L,L));return E.vx=k*V,E.vy=D*V,E.driftAx=0,E.driftTime=0,E}function Je(e){const t=b();if(!t||"pit-throws"!==t.currentMode)return;const a=Math.max(0,0|(t.maxBalls??300));if(a<=0)return;if(t.balls.length>=a)return;const n=t._pitThrows;if(!n)return;const r=Ye(t.pitThrowIntervalMs??70,10,2e3)/1e3,i=Ye(t.pitThrowBatchSize??12,1,100),o=Ye(t.pitThrowColorPauseMs??400,0,3e3)/1e3,l=Ye(t.pitThrowPairChance??.35,0,1),s=Ye(t.pitThrowPairStaggerMs??18,0,300)/1e3,c=Ye(t.pitThrowSpeedVar??.18,0,1),d=Ye(t.pitThrowSpreadVar??.25,0,1);n.cooldown-=e,n.cooldown<0&&(n.cooldown=0);let p=0;for(n.queueA>=0&&(n.queueA-=e),n.queueB>=0&&(n.queueB-=e);p<6&&t.balls.length<a;){let e=!1;if(n.queueA>=0&&n.queueA<=0){const a=1+Ze(-c,c),r=1+Ze(-d,d);je(t,n.queueColorA,n.queueSideA,{speedMul:a,spreadMul:r}),n.queueA=-1,p++,e=!0}if(p>=6||t.balls.length>=a)break;if(n.queueB>=0&&n.queueB<=0){const a=1+Ze(-c,c),r=1+Ze(-d,d);je(t,n.queueColorB,n.queueSideB,{speedMul:a,spreadMul:r}),n.queueB=-1,p++,e=!0}if(!e)break}if(!(n.cooldown>0))for(n.batchPaused&&(n.batchPaused=!1,n.batchCount=0,n.side=1-n.side);p<6&&t.balls.length<a;){if(o>0&&n.batchCount>=i){n.cooldown=o,n.batchPaused=!0;break}const e=n.side,u=1+Ze(-c,c),m=1+Ze(-d,d);if(je(t,Ue(n),e,{speedMul:u,spreadMul:m}),p++,n.batchCount++,Math.random()<l&&t.balls.length<a&&n.batchCount<i){const t=Ue(n);n.queueA<0&&(n.queueA=s,n.queueColorA=t,n.queueSideA=e,n.batchCount++)}n.cooldown=r;break}}function Qe(e,t){const a=b();if(!a.mouseInCanvas)return;const n=a.weightlessRepelRadius??0,r=a.weightlessRepelPower??0;if(n<=0||r<=0)return;const i=n*(a.DPR||1),o=e.x-a.mouseX,l=e.y-a.mouseY,s=o*o+l*l;if(s>i*i)return;const c=Math.max(Math.sqrt(s),1e-4),d=o/c,p=l/c,u=Math.max(0,1-c/i),m=a.weightlessRepelSoft??2.2,h=20*r*Math.pow(u,m),g=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=d*h*t/g,e.vy+=p*h*t/g}let et,tt,at=r.DPR;function nt(){et=document.getElementById("c"),et?(tt=et.getContext("2d",{alpha:!0,desynchronized:!0,willReadFrequently:!1}),tt||(tt=et.getContext("2d"),console.warn("⚠️ Desynchronized mode unavailable, using standard context")),function(){const e=window.devicePixelRatio||1;(navigator.connection?.saveData||navigator.hardwareConcurrency<=4||/Android|iPhone|iPad|iPod/i.test(navigator.userAgent))&&e>1.5?(at=1.5,console.log("⚡ Adaptive DPR: Reduced to 1.5x for performance")):at=Math.min(e,2),c(at)}(),tt.imageSmoothingEnabled=!1,window.addEventListener("resize",rt),console.log(`✓ Renderer optimized (DPR: ${at.toFixed(2)}, desync: ${tt.getContextAttributes?.()?.desynchronized??"unknown"})`)):console.error("Canvas not found")}function rt(){if(!et)return;const e=b();try{f(),y()}catch(e){}const t=e.container||document.getElementById("bravia-balls"),a=t?t.clientWidth:window.innerWidth,n=t?t.clientHeight:window.innerHeight,r=at;et.width=Math.floor(a*r),et.height=Math.floor(n*r),et.style.width=a+"px",et.style.height=n+"px",tt&&(tt.imageSmoothingEnabled=!1),function(e){const t=b();if(!t.canvasShadowEnabled)return void(e.style.filter="");const a=t.shadowOffsetX||1,n=t.shadowOffsetY||1,r=t.shadowBlur||0,i=t.shadowColor||"#000000",o=t.shadowOpacity||.29,l=t.shadow2Enabled?` drop-shadow(0 0 ${t.shadow2Blur||4}px rgba(0,0,0,${t.shadow2Opacity||.1}))`:"";e.style.filter=`drop-shadow(${a}px ${n}px ${r}px ${function(e,t){const a=e.replace("#",""),n=parseInt(a,16);return`rgba(${n>>16&255}, ${n>>8&255}, ${255&n}, ${t})`}(i,o)})${l}`}(et)}function it(){return et}function ot(){return tt}function lt(e,a){const n=b();if(n.currentMode!==t.VORTEX)return;const r=n.mouseX,i=n.mouseY;if(!n.mouseInCanvas)return;const o=n.vortexSwirlStrength||420,l=n.vortexRadialPull||180,s=n.vortexSpeedMultiplier??1,c=n.vortexRadius??0,d=n.vortexFalloffCurve??1,p=n.vortexRotationDirection??1,u=n.vortexCoreStrength??1,m=n.vortexAccelerationZone??0,h=n.vortexOutwardPush??0,g=e.x-r,f=e.y-i,y=g*g+f*f,v=Math.max(8,Math.sqrt(y));if(c>0&&v>c){if(h>0){const t=g/v,n=f/v,r=h*((v-c)/c);e.vx+=t*r*a,e.vy+=n*r*a}return}let x;if(c>0){const e=Math.min(1,v/c);x=Math.pow(1-e,d)}else{const e=1/(1+v*(n.vortexFalloffRate??.0015));x=Math.pow(e,d)}const M=1+(u-1)*(1-Math.min(1,v/(c||400))),S=o*x*M*s,w=l*x*M*s;let P=1;if(m>0){const e=Math.abs(v-m),t=.3*m;e<t&&(P=1+.5*(1-e/t))}const L=g/v,C=f/v,E=-C*p,F=L*p,I=S*P;e.vx+=E*I*a,e.vy+=F*I*a;const T=w*P;e.vx-=L*T*a,e.vy-=C*T*a;const k=Math.max(0,Math.min(1,n.vortexDrag??.005));e.vx*=1-k,e.vy*=1-k}function st(e,a){const n=b();if(n.currentMode!==t.PING_PONG)return;if(!e.isPingPong)return;if(n.mouseInCanvas){const t=(n.pingPongCursorRadius||100)*n.DPR,a=n.mouseX,r=n.mouseY,i=e.x-a,o=e.y-r,l=Math.sqrt(i*i+o*o),s=t+e.r;if(l<s&&l>.1){const t=s-l,a=i/l,n=o/l;e.x+=a*t*1.1,e.y+=n*t*1.1;const r=e.vx*a+e.vy*n;r<0&&(e.vx-=2*r*a,e.vy-=2*r*n,e.omega+=.02*r)}}const r=n.pingPongSpeed||400;if(Math.abs(e.vx)<.9*r){const t=e.vx>=0?1:-1;e.vx=t*r}const i=Math.max(0,Math.min(1,n.pingPongVerticalDamp??.995));e.vy*=i}function ct(e,a){const n=b();if(n.currentMode!==t.MAGNETIC)return;if(!n.mouseInCanvas)return;const r=n.mouseX,i=n.mouseY,o=r-e.x,l=i-e.y,s=Math.max(30,Math.sqrt(o*o+l*l)),c=(n.magneticStrength||65e3)/(s*s)*1e3,d=o/s,p=l/s,u=e.charge||1;e.vx+=d*c*u*a,e.vy+=p*c*u*a;const m=n.magneticMaxVelocity||2800,h=Math.sqrt(e.vx*e.vx+e.vy*e.vy);h>m&&(e.vx=e.vx/h*m,e.vy=e.vy/h*m),e.vx*=.998,e.vy*=.998}function dt(e){const a=b();if(a.currentMode===t.MAGNETIC)for(let e=0;e<a.balls.length;e++)a.balls[e].alpha=1}function pt(e,a,n,r=!1){const i=b(),o=ze(i,t.BUBBLES),l=new Oe(e,a,r?o:.1,n);return l.isBubble=!0,l.baseRadius=o,l.targetRadius=o,l.wobblePhase=Math.random()*Math.PI*2,l.wobbleFreq=2+3*Math.random(),l.vx=20*(Math.random()-.5),l.vy=-50-50*Math.random(),l.spawning=!r,l.spawnProgress=r?1:0,l.dissipating=!1,l.dissipateProgress=0,l.alpha=1,i.balls.push(l),l}function ut(e){const a=b(),n=a.canvas;if(!n)return;const r=n.width,i=n.height;e.x=Math.random()*r,e.y=i+60+30*Math.random(),e.vx=20*(Math.random()-.5),e.vy=-50-50*Math.random(),e.wobblePhase=Math.random()*Math.PI*2,e.wobbleFreq=2+3*Math.random(),e.color=W(),e.targetRadius=ze(a,t.BUBBLES),e.baseRadius=e.targetRadius,e.r=.1,e.rBase=.1,e.spawning=!0,e.spawnProgress=0,e.dissipating=!1,e.dissipateProgress=0,e.alpha=1}function mt(e,a){const n=b();if(n.currentMode!==t.BUBBLES)return;if(!e.isBubble)return;const r=n.canvas;if(!r)return;if(e.spawning){e.spawnProgress+=3*a;const t=1-Math.pow(1-Math.min(1,e.spawnProgress),3);e.r=e.targetRadius*t,e.rBase=e.r,e.spawnProgress>=1&&(e.spawning=!1,e.r=e.targetRadius,e.rBase=e.targetRadius)}if(e.dissipating){e.dissipateProgress+=3*a;const t=Math.pow(e.dissipateProgress,2);return e.r=e.targetRadius*Math.max(0,1-t),e.rBase=e.r,e.alpha=Math.max(0,1-.5*t),e.vy*=.92,e.vx*=.92,void(e.dissipateProgress>=1&&ut(e))}const i=n.bubblesRiseSpeed||150,o=.01*(n.bubblesWobble||40),l=i*n.DPR;e.vy-=l*a,e.wobblePhase+=e.wobbleFreq*a;const s=Math.sin(e.wobblePhase)*o*100;if(e.vx+=s*a,e.vx*=.92,e.vy*=.96,n.mouseInCanvas){const t=e.x-n.mouseX,r=e.y-n.mouseY,i=Math.sqrt(t*t+r*r),o=(n.bubblesDeflectRadius||200)*n.DPR;if(i<o&&i>1){const n=i/o,l=3e3*Math.pow(1-n,3),s=t/i,c=r/i;if(e.vx+=s*l*a,e.vy+=c*l*a,i<.3*o){const t=500*(1-i/(.3*o));e.vx+=s*t*a,e.vy+=c*t*a}}}const c=2*e.targetRadius;e.y<c&&!e.dissipating&&!e.spawning&&(e.dissipating=!0,e.dissipateProgress=0),(e.x<4*-e.r||e.x>r.width+4*e.r)&&ut(e)}function ht(e){}const gt=2*Math.PI,ft=1e-6;let yt=0;function vt(e,t,a){return Math.max(t,Math.min(a,e))}function bt(e){const t=e.canvas;return t?vt(Math.min(t.width,t.height)/1e3,.35,3):1}function xt(e,t,a,n){for(let r=0;r<e.length;r++){const i=e[r],o=t-i.x,l=a-i.y,s=n+i.r;if(o*o+l*l<s*s)return!0}return!1}function Mt(e,t,a,n=10){const r=n*n,i=2*n;return e.v+=(t-e.x)*r*a,e.v*=Math.max(0,1-i*a),e.x+=e.v*a,e.x}function St(e,t,a,n){const r=b(),i=Math.max(2,r.wallInset||3)*(r.DPR||1),o=i+e.r,l=t-i-e.r,s=i+e.r,c=a-i-e.r,d=.92,p=Math.max(0,1-.15*n);e.x<o?(e.x=o,e.vx=Math.abs(e.vx)*d*p):e.x>l&&(e.x=l,e.vx=-Math.abs(e.vx)*d*p),e.y<s?(e.y=s,e.vy=Math.abs(e.vy)*d*p):e.y>c&&(e.y=c,e.vy=-Math.abs(e.vy)*d*p)}function wt(e){return e.currentMode===t.KALEIDOSCOPE_1?{count:e.kaleidoscope1BallCount??18,wedges:e.kaleidoscope1Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope1Speed??.8,complexity:.55}:e.currentMode===t.KALEIDOSCOPE_2?{count:e.kaleidoscope2BallCount??36,wedges:e.kaleidoscope2Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope2Speed??1.15,complexity:.95}:e.currentMode===t.KALEIDOSCOPE_3?{count:e.kaleidoscope3BallCount??54,wedges:e.kaleidoscope3Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope3Speed??1.55,complexity:1.35}:{count:e.kaleidoscopeBallCount??23,wedges:e.kaleidoscopeWedges??e.kaleidoscopeSegments??12,speed:e.kaleidoscopeSpeed??1,complexity:.75}}function Pt(e,a){const n=b();S();const r=n.canvas;if(!r)return;const i=r.width,o=r.height,l=.5*i,s=.5*o,c=bt(n),d=vt(e,3,n.maxBalls||300),p=Math.min(i,o),u=.05*p,m=2.8*p,h=[];function g(e){const r=function(e,a){const n=e?.canvas,r=n?.height||0;if(!r)return ze(e,a);const i=Be(Number(a===t.KALEIDOSCOPE_1?e.kaleidoscope1DotSizeVh??e.kaleidoscopeDotSizeVh??.95:a===t.KALEIDOSCOPE_2?e.kaleidoscope2DotSizeVh??e.kaleidoscopeDotSizeVh??.95:a===t.KALEIDOSCOPE_3?e.kaleidoscope3DotSizeVh??e.kaleidoscopeDotSizeVh??.95:e.kaleidoscopeDotSizeVh??.95),.1,6),o=Be(Number(a===t.KALEIDOSCOPE_1?e.kaleidoscope1DotAreaMul??e.kaleidoscopeDotAreaMul??.7:a===t.KALEIDOSCOPE_2?e.kaleidoscope2DotAreaMul??e.kaleidoscopeDotAreaMul??.7:a===t.KALEIDOSCOPE_3?e.kaleidoscope3DotAreaMul??e.kaleidoscopeDotAreaMul??.7:e.kaleidoscopeDotAreaMul??.7),.1,2),l=Math.max(1,.01*i*r*Math.sqrt(o)),s=We(e,a),c=Math.max(1,l*(1-s)),d=Math.max(1,l*(1+s));return d-c<1e-6?l:Ve(c,d,Math.random())}(n,a),i=1.2*m,o=l-i,d=l+i,p=s-i,g=s+i;for(let t=0;t<90;t++){const t=Math.random()*gt,a=u+Math.random()*(m-u),i=vt(l+Math.cos(t)*a,o,d),f=vt(s+Math.sin(t)*a,p,g);if(!xt(h,i,f,r+n.ballSpacing*n.DPR)){h.push({x:i,y:f,r:r+n.ballSpacing*n.DPR});const a=new Oe(i,f,r,e);a._kaleiSeed=Math.random()*gt;const o=i-l,d=f-s;a._kaleiR0=Math.sqrt(o*o+d*d);const p=(12+12*Math.random())*c;return a.vx=-Math.sin(t)*p,a.vy=Math.cos(t)*p,a.driftAx=0,a.driftTime=0,void n.balls.push(a)}}const f=Math.random()*gt,y=u+Math.random()*(m-u),v=l+Math.cos(f)*y,b=s+Math.sin(f)*y,x=new Oe(v,b,r,e);x._kaleiSeed=Math.random()*gt;const M=v-l,S=b-s;x._kaleiR0=Math.sqrt(M*M+S*S);const w=(12+12*Math.random())*c;x.vx=-Math.sin(f)*w,x.vy=Math.cos(f)*w,x.driftAx=0,x.driftTime=0,n.balls.push(x)}Math.max(2,n.wallInset||3),n.DPR;const f=Math.min(8,d);for(let e=0;e<f;e++)g(z(e));for(let e=f;e<d;e++)g(W())}function Lt(e){return e===t.KALEIDOSCOPE||e===t.KALEIDOSCOPE_1||e===t.KALEIDOSCOPE_2||e===t.KALEIDOSCOPE_3}function Ct(e){return wt(e).complexity}function Et(e,t){const a=b();if(!Lt(a.currentMode))return;const n=a.canvas;if(!n)return;const r=.5*n.width,i=.5*n.height,o=bt(a),l=vt(wt(a).speed??1,.2,2),s=performance.now(),c=s-(a.lastPointerMoveMs||0)<120;void 0===a._kaleiActivity&&(a._kaleiActivity=0);const d=c?1:0,p=d>a._kaleiActivity?.45:.65,u=1-Math.exp(-t/Math.max(1e-4,p));a._kaleiActivity+=(d-a._kaleiActivity)*u;const m=a._kaleiActivity,h=.008*Ct(a);if(m<.01){const a=3e-4*s,n=(e._kaleiSeed??0)+.02*e.age+a,r=Math.cos(n)*h*8,i=Math.sin(n)*h*8;return e.vx+=r*t,e.vy+=i*t,e.vx*=.96,void(e.vy*=.96)}const g=e.x-r,f=e.y-i,y=Math.max(ft,Math.sqrt(g*g+f*f)),v=g/y,x=f/y,M=-x,S=v,w=30*o*l*m,P=-(y-(void 0!==e._kaleiR0?e._kaleiR0:y))*(2.5*l*m);e.vx+=(M*w+v*P)*t,e.vy+=(S*w+x*P)*t,e.vx*=.992,e.vy*=.992}function Ft(e,t){const a=b(),n=-1e9===a.mouseX?.5*a.canvas.width:a.mouseX,r=-1e9===a.mouseY?.5*a.canvas.height:a.mouseY,i=n-e.x,o=r-e.y,l=Math.sqrt(i*i+o*o+1),s=i/l,c=o/l,d=-o/l,p=i/l;if(l<40){const a=100*(40-l);e.vx-=s*a*t,e.vy-=c*a*t}const u=a.orbit3dGravity??5e3,m=.015*u;e.vx+=d*m*t,e.vy+=p*m*t;const h=.003*u/(1+l/100);e.vx+=s*h*t,e.vy+=c*h*t;const g=60*a.DPR;let f=0,y=0,v=0;for(let t=0;t<a.balls.length;t++){const n=a.balls[t];if(n===e)continue;const r=e.x-n.x,i=e.y-n.y,o=r*r+i*i;if(o<g*g&&o>0){const e=Math.sqrt(o),t=1-e/g;f+=r/e*t,y+=i/e*t,v++}}if(v>0){const a=8e3;e.vx+=f/v*a*t,e.vy+=y/v*a*t}const x=2*(a.orbit3dVelocityMult??150),M=Math.sqrt(e.vx*e.vx+e.vy*e.vy);M>x&&(e.vx=e.vx/M*x,e.vy=e.vy/M*x);const S=1-(a.orbit3dDamping??.02);e.vx*=S,e.vy*=S;const w=Math.atan2(o,i),P=a.orbit3dDepthScale??.8;e.z=e.orbitDepth+.2*Math.sin(2*w),e.z=Math.max(0,Math.min(1,e.z)),e.r=Math.max(2,e.rBase*(.5+e.z*P))}function It(e,t){const a=b(),n=-1e9===a.mouseX?.5*a.canvas.width:a.mouseX,r=-1e9===a.mouseY?.5*a.canvas.height:a.mouseY,i=n-e.x,o=r-e.y,l=Math.sqrt(i*i+o*o+1),s=i/l,c=o/l,d=-o/l,p=i/l;if(l<80){const a=100*(80-l);e.vx-=s*a*t,e.vy-=c*a*t}const u=a.orbit3d2Gravity??8e4,m=.015*u;e.vx+=d*m*t,e.vy+=p*m*t;const h=.003*u/(1+l/100);e.vx+=s*h*t,e.vy+=c*h*t;const g=100*a.DPR;let f=0,y=0,v=0;for(let t=0;t<a.balls.length;t++){const n=a.balls[t];if(n===e)continue;const r=e.x-n.x,i=e.y-n.y,o=r*r+i*i;if(o<g*g&&o>0){const e=Math.sqrt(o),t=1-e/g;f+=r/e*t,y+=i/e*t,v++}}if(v>0){const a=8e3;e.vx+=f/v*a*t,e.vy+=y/v*a*t}const x=Math.sqrt(e.vx*e.vx+e.vy*e.vy);x>300&&(e.vx=e.vx/x*300,e.vy=e.vy/x*300);const M=1-(a.orbit3d2Damping??.02);e.vx*=M,e.vy*=M;const S=Math.atan2(o,i),w=a.orbit3d2DepthScale??.6;e.z=e.orbitDepth+.2*Math.sin(2*S),e.z=Math.max(0,Math.min(1,e.z)),e.r=Math.max(2,e.rBase*(.5+e.z*w))}function Tt(e,t,a){return e<t?t:e>a?a:e}function kt(e){return e>Math.PI?e-=2*Math.PI:e<-Math.PI&&(e+=2*Math.PI),e}function Dt(e,t){const a=b(),n=a.canvas;if(!n)return;const r=Math.max(0,a.critterSpeed||0),i=Math.max(50,a.critterMaxSpeed||0),o=Math.max(0,a.critterStepHz||0),l=a.critterStepSharpness??2.4,s=Math.max(0,a.critterTurnNoise||0),c=Math.max(.1,a.critterTurnDamp||0),d=Math.max(0,a.critterTurnSeek||0),p=Math.max(0,(a.critterAvoidRadius||0)*(a.DPR||1)),u=Math.max(0,a.critterAvoidForce||0),m=Math.max(0,a.critterEdgeAvoid||0),h=Math.max(0,a.critterMousePull||0),g=Math.max(0,a.critterMouseRadiusVw||0);let f=e._critterHeading||0,y=e._critterTurn||0,v=e._critterPhase||0,x=e._critterLastPhase??v,M=e._critterPause||0;const S=e._critterWander||0;M>0?M=Math.max(0,M-t):Math.random()<.25*t&&(M=.03+.09*Math.random());let w=0,P=0;if(m>0){const t=n.width,r=n.height,i=Math.max(24*(a.DPR||1),.08*Math.min(t,r)),o=e.x,l=e.y;o<i?w+=1-o/i:o>t-i&&(w-=1-(t-o)/i),l<i?P+=1-l/i:l>r-i&&(P-=1-(r-l)/i);const s=1.35*m;w*=s,P*=s}let L=0;if(h>0&&-1e9!==a.mouseX){const t=(window.innerWidth||n.width)/100,r=Math.max(1,g*t)*(a.DPR||1),i=e.x-a.mouseX,o=e.y-a.mouseY,l=i*i+o*o;if(l<r*r){const e=Math.sqrt(l)+1e-6,t=1-e/r;L=t;const a=h*(.85+.65*t);w+=i/e*a,P+=o/e*a;const n=.25*t*a;w+=-o/e*n,P+=i/e*n,M=0}}if(p>0&&u>0){const n=a.balls,r=p*p;let i=0,o=0,l=0;for(let t=0;t<n.length;t++){const a=n[t];if(a===e)continue;const s=e.x-a.x,c=e.y-a.y,d=s*s+c*c;if(d>0&&d<r){const e=Math.sqrt(d),t=1-e/p,a=t*t,n=1/(e+1e-6);i+=s*n*a,o+=c*n*a,l++}}if(l>0){const a=1/l;w+=i*a*1.15,P+=o*a*1.15,e.vx+=i*a*(.65*u)*t,e.vy+=o*a*(.65*u)*t}}const C=1+1.35*L*h;y+=((2*Math.random()-1)*(s*C)+.35*S*s)*t,w*w+P*P>1e-6&&(y+=kt(Math.atan2(P,w)-f)*(d*t)),y*=Math.exp(-c*t),f=kt(f+y*t),o>0&&(x=v,v+=o*t,v-=0|v);const E=M>0?0:function(e,t){const a=(n=Tt(n=e<.5?2*e:2-2*e,0,1))*n*(3-2*n);var n;const r=Tt(t,.5,6);return Math.pow(a,r)}(v,l),F=1+.95*L*h;if(M<=0&&v>.82){const t=(v-.82)/.18*.1*(.65+.35*F);t>e.squashAmount&&(e.squashAmount=t,e.squashNormalAngle=-Math.PI/2)}if(M<=0&&o>0&&v<x){const t=Math.max(.25,e.m/(a.MASS_BASELINE_KG||129)),n=r*(.55+.55*E)*F*(.85+.3*Math.random()),i=Math.cos(f),o=Math.sin(f),l=-o,s=i,c=.18*(2*Math.random()-1)*(.35+.65*L)*n;e.vx+=(i*n+l*c)/t,e.vy+=(o*n+s*c)/t,e.squashAmount=Math.max(e.squashAmount,.2+.15*L),e.squashNormalAngle=Math.PI/2}const I=r*(.08+.25*E)*F;e.vx+=Math.cos(f)*I*t,e.vy+=Math.sin(f)*I*t;const T=e.vx,k=e.vy,D=T*T+k*k;if(D>i*i){const t=i/(Math.sqrt(D)+1e-6);e.vx=T*t,e.vy=k*t}e._critterHeading=f,e._critterTurn=y,e._critterPhase=v,e._critterLastPhase=x,e._critterPause=M,e.theta=f}let At=0;function Rt(e,t){const a=b(),n=Math.max(.25,e.m/a.MASS_BASELINE_KG),r=Math.max(0,a.neuralWanderStrength??420),i=(e._neuralPhase??0)+1.35*t;e._neuralPhase=i;const o=Math.sin(1.7*i+.3)*r,l=Math.cos(1.1*i+1.2)*r;e.vx+=o*t/n,e.vy+=l*t/n,At+=t;const s=a.balls,c=s.length;if(c>1){const r=At>.18;if(r&&(At=0),r||void 0===a._neuralCx){let e=0,t=0;for(let a=0;a<c;a++)e+=s[a].x,t+=s[a].y;a._neuralCx=e/c,a._neuralCy=t/c}const i=a._neuralCx,o=a._neuralCy,l=Math.max(0,Math.min(1,a.neuralCohesion??.18)),d=i-e.x,p=o-e.y;e.vx+=d*l*t/n,e.vy+=p*l*t/n}const d=Math.max(0,Math.min(1,a.neuralDamping??.985)),p=Math.pow(d,60*t);e.vx*=p,e.vy*=p}function Ot(e){}function Bt(e,t){const a=b(),n=a.canvas;if(!n)return;const r=a.mouseX,i=a.mouseY;if(!1!==a.repellerEnabled&&-1e9!==r&&a.mouseInCanvas){const n=(a.latticeDisruptRadius??600)*a.DPR,o=a.latticeDisruptPower??25,l=e.x-r,s=e.y-i,c=l*l+s*s;if(c<n*n){const r=Math.max(Math.sqrt(c),1e-4),i=l/r,d=s/r,p=Math.max(0,1-r/n),u=80*o*Math.pow(p,1.8),m=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=i*u*t/m,e.vy+=d*u*t/m}}void 0!==e.latticeHomeX&&void 0!==e.latticeHomeY||(e.latticeHomeX=e.x,e.latticeHomeY=e.y);const o=.001*performance.now(),l=a.latticeMeshWaveStrength??12,s=a.latticeMeshWaveSpeed??.8,c=Math.sin(o*s+.004*e.latticeHomeX)*l,d=Math.cos(o*s*.7+.004*e.latticeHomeY)*l,p=.015*Math.sin(o*s*.5),u=.5*n.width,m=.5*n.height,h=(e.latticeHomeX-u)*p,g=(e.latticeHomeY-m)*p,f=e.latticeHomeX+c+h,y=e.latticeHomeY+d+g,v=f-e.x,x=y-e.y,M=Math.max(0,a.latticeStiffness??2.2),S=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=v*M*t/S,e.vy+=x*M*t/S;const w=Math.max(0,Math.min(1,a.latticeDamping??.92)),P=Math.pow(w,60*t);e.vx*=P,e.vy*=P}function Vt(e,t){if(!e._parallax3D)return;const a=b(),n=a.canvas;if(!n)return;const r=.5*n.width,i=.5*n.height;let o=0,l=0;a.mouseInCanvas&&(o=Math.max(-1,Math.min(1,(a.mouseX-r)/(.5*n.width))),l=Math.max(-1,Math.min(1,(a.mouseY-i)/(.5*n.height))));const s=Math.max(100,a.parallaxLinearFocalLength??400),c=Math.max(0,a.parallaxLinearParallaxStrength??120),{x:d,y:p,z:u}=e._parallax3D,m=s/(s+u),h=r+(d+o*c)*m,g=i+(p+l*c)*m,f=Math.max(.1,Math.min(6,a.parallaxLinearDotSizeMul??1.8)),y=Number.isFinite(e._parallaxSizeMul)?e._parallaxSizeMul:1;e.r=.32*(a.R_MED||20)*2.4*(a.DPR||1)*f*y*m,e.x=h,e.y=g,e.vx=0,e.vy=0}function _t(e,t){if(!e._parallax3D)return;const a=b(),n=a.canvas;if(!n)return;const r=.5*n.width,i=.5*n.height;let o=0,l=0;a.mouseInCanvas&&(o=Math.max(-1,Math.min(1,(a.mouseX-r)/(.5*n.width))),l=Math.max(-1,Math.min(1,(a.mouseY-i)/(.5*n.height))));const s=Math.max(100,a.parallaxPerspectiveFocalLength??400),c=Math.max(0,a.parallaxPerspectiveParallaxStrength??150),{x:d,y:p,z:u}=e._parallax3D,m=s/(s+u),h=r+(d+o*c)*m,g=i+(p+l*c)*m,f=Math.max(.1,Math.min(6,a.parallaxPerspectiveDotSizeMul??1.8)),y=Number.isFinite(e._parallaxSizeMul)?e._parallaxSizeMul:1;e.r=.3*(a.R_MED||20)*2*(a.DPR||1)*f*y*m,e.x=h,e.y=g,e.vx=0,e.vy=0}function Wt(e){const a=b(),n=a.currentMode;if(a.currentMode===t.CRITTERS&&e!==t.CRITTERS&&(void 0!==a._restBeforeCritters&&(a.REST=a._restBeforeCritters,delete a._restBeforeCritters),void 0!==a._frictionBeforeCritters&&(a.FRICTION=a._frictionBeforeCritters,delete a._frictionBeforeCritters),void 0!==a._ballSpacingBeforeCritters&&(a.ballSpacing=a._ballSpacingBeforeCritters,delete a._ballSpacingBeforeCritters)),M(e),e!==n)try{V?.("mode")}catch(e){}if(console.log(`Switching to mode: ${e}`),function(e){const t=document.getElementById("announcer");t&&(t.textContent="",setTimeout(()=>{t.textContent=e},10))}(`Switched to ${{pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero Gravity",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope","kaleidoscope-1":"Kaleidoscope I","kaleidoscope-2":"Kaleidoscope II","kaleidoscope-3":"Kaleidoscope III","orbit-3d":"Orbit 3D","orbit-3d-2":"Orbit 3D (Tight Swarm)",critters:"Critters",neural:"Neural Network",lattice:"Crystal Lattice","parallax-linear":"Parallax (Linear)","parallax-perspective":"Parallax (Perspective)"}[e]||e} mode`),a.container){const n=a.container.classList.contains("dark-mode");a.container.className="",e!==t.PIT&&e!==t.PIT_THROWS||a.container.classList.add("mode-pit"),(n||a.isDarkMode)&&a.container.classList.add("dark-mode")}rt(),e===t.PIT?(a.gravityMultiplier=a.gravityMultiplierPit,a.G=a.GE*a.gravityMultiplier,a.repellerEnabled=!0,function(){const e=b();S(),function(e,t){const a=e.canvas.width,n=e.canvas.height,r=e.DPR,i=-.65*n,o=(e.wallThickness||20)*r,l=o,s=a-o,c=s-l,d=Math.max(1,.22*c),p=l+c*(2/3),u=Math.max(l,p-.5*d),m=Math.min(s,p+.5*d),h=Math.max(0,0|t);for(let e=0;e<8&&e<h;e++){const t=qe(u+Math.random()*(m-u),i+Math.random()*(0-i),z(e));t.vx=100*(Math.random()-.5),t.vy=50*Math.random()+50,t.driftAx=0,t.driftTime=0}for(let e=8;e<h;e++){const e=qe(u+Math.random()*(m-u),i+Math.random()*(0-i));e.vx=100*(Math.random()-.5),e.vy=50*Math.random()+50,e.driftAx=0,e.driftTime=0}}(e,e.maxBalls??300)}()):e===t.PIT_THROWS?(a.gravityMultiplier=a.gravityMultiplierPit,a.G=a.GE*a.gravityMultiplier,a.repellerEnabled=!0,function(){const e=b();S(),e._pitThrows={spawnedTotal:0,side:0,cooldown:0,batchCount:0,batchPaused:!1,queueA:-1,queueB:-1,queueColorA:void 0,queueColorB:void 0,queueSideA:0,queueSideB:1},je(e,Ue(e._pitThrows),e._pitThrows.side),e._pitThrows.side=1-e._pitThrows.side}()):e===t.FLIES?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,function(){const e=b();S();const t=.5*e.canvas.width,a=.5*e.canvas.height,n=150*e.DPR;for(let e=0;e<8;e++){const r=Math.random()*Math.PI*2,i=Math.random()*n,o=qe(t+Math.cos(r)*i,a+Math.sin(r)*i,z(e)),l=.5+.5*Math.random(),s=Math.random()*Math.PI*2,c=300*l;o.vx=Math.cos(s)*c,o.vy=Math.sin(s)*c,o.driftAx=0,o.driftTime=0}for(let e=8;e<60;e++){const e=Math.random()*Math.PI*2,r=Math.random()*n,i=qe(t+Math.cos(e)*r,a+Math.sin(e)*r),o=.5+.5*Math.random(),l=Math.random()*Math.PI*2,s=300*o;i.vx=Math.cos(l)*s,i.vy=Math.sin(l)*s,i.driftAx=0,i.driftTime=0}}()):e===t.WEIGHTLESS?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,function(){const e=b();S();const t=e.weightlessCount,a=e.canvas.width,n=e.canvas.height,r=40*e.DPR;for(let i=0;i<8&&i<t;i++){const t=qe(r+Math.random()*(a-2*r),r+Math.random()*(n-2*r),z(i)),o=Math.random()*Math.PI*2,l=e.weightlessInitialSpeed*(.7+.3*Math.random());t.vx=Math.cos(o)*l,t.vy=Math.sin(o)*l,t.driftAx=0,t.driftTime=0}for(let i=8;i<t;i++){const t=qe(r+Math.random()*(a-2*r),r+Math.random()*(n-2*r)),i=Math.random()*Math.PI*2,o=e.weightlessInitialSpeed*(.7+.3*Math.random());t.vx=Math.cos(i)*o,t.vy=Math.sin(i)*o,t.driftAx=0,t.driftTime=0}}()):e===t.WATER?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,function(){const e=b();S(),Ke.length=0;const a=e.canvas;if(!a)return;const n=a.width,r=a.height,i=e.waterBallCount||100;for(let a=0;a<8&&a<i;a++){const i=Math.random()*n,o=Math.random()*r,l=ze(e,t.WATER),s=z(a),c=new Oe(i,o,l,s),d=e.waterInitialVelocity||120;c.vx=(Math.random()-.5)*d,c.vy=(Math.random()-.5)*d,e.balls.push(c)}for(let a=8;a<i;a++){const a=Math.random()*n,i=Math.random()*r,o=ze(e,t.WATER),l=W(),s=new Oe(a,i,o,l),c=e.waterInitialVelocity||120;s.vx=(Math.random()-.5)*c,s.vy=(Math.random()-.5)*c,e.balls.push(s)}}()):e===t.VORTEX?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,function(){const e=b();S();const a=e.canvas;if(!a)return;const n=a.width,r=a.height,i=Math.min(e.vortexBallCount||180,e.maxBalls||500),o=80*(e.vortexSpeedMultiplier??1);for(let a=0;a<8&&a<i;a++){const i=Math.random()*n,l=Math.random()*r,s=ze(e,t.VORTEX),c=z(a),d=new Oe(i,l,s,c);d.vx=(Math.random()-.5)*o,d.vy=(Math.random()-.5)*o,e.balls.push(d)}for(let a=8;a<i;a++){const a=Math.random()*n,i=Math.random()*r,l=ze(e,t.VORTEX),s=W(),c=new Oe(a,i,l,s);c.vx=(Math.random()-.5)*o,c.vy=(Math.random()-.5)*o,e.balls.push(c)}}()):e===t.PING_PONG?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,function(){const e=b();S();const a=e.canvas;if(!a)return;const n=a.width,r=a.height,i=Math.min(e.pingPongBallCount||80,e.maxBalls||300),o=e.pingPongSpeed||400;for(let a=0;a<8&&a<i;a++){const i=Math.random()*n,l=.15*r+Math.random()*r*.7,s=ze(e,t.PING_PONG),c=z(a),d=new Oe(i,l,s,c),p=Math.random()>.5?1:-1;d.vx=p*(.8*o+Math.random()*o*.4),d.vy=0,d.isPingPong=!0,e.balls.push(d)}for(let a=8;a<i;a++){const a=Math.random()*n,i=.15*r+Math.random()*r*.7,l=ze(e,t.PING_PONG),s=W(),c=new Oe(a,i,l,s),d=Math.random()>.5?1:-1;c.vx=d*(.8*o+Math.random()*o*.4),c.vy=0,c.isPingPong=!0,e.balls.push(c)}}()):e===t.MAGNETIC?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,function(){const e=b();S();const a=e.canvas;if(!a)return;const n=a.width,r=a.height,i=Math.min(e.magneticBallCount||180,e.maxBalls||300);for(let a=0;a<8&&a<i;a++){const i=Math.random()*n,o=Math.random()*r,l=ze(e,t.MAGNETIC),s=z(a),c=new Oe(i,o,l,s);c.vx=100*(Math.random()-.5),c.vy=100*(Math.random()-.5),c.charge=Math.random()>.5?1:-1,c.baseAlpha=1,e.balls.push(c)}for(let a=8;a<i;a++){const a=Math.random()*n,i=Math.random()*r,o=ze(e,t.MAGNETIC),l=W(),s=new Oe(a,i,o,l);s.vx=100*(Math.random()-.5),s.vy=100*(Math.random()-.5),s.charge=Math.random()>.5?1:-1,s.baseAlpha=1,e.balls.push(s)}}()):e===t.BUBBLES?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,function(){const e=b();e.balls.length=0;const t=e.canvas;if(!t)return;const a=t.width,n=t.height,r=e.bubblesMaxCount||200;for(let e=0;e<8&&e<r;e++)pt(Math.random()*a,Math.random()*n,z(e),!0);for(let e=8;e<r;e++)pt(Math.random()*a,Math.random()*n,W(),!0)}()):e===t.KALEIDOSCOPE?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,Pt(b().kaleidoscopeBallCount??23,t.KALEIDOSCOPE)):e===t.KALEIDOSCOPE_1?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,Pt(b().kaleidoscope1BallCount??18,t.KALEIDOSCOPE_1)):e===t.KALEIDOSCOPE_2?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,Pt(b().kaleidoscope2BallCount??36,t.KALEIDOSCOPE_2)):e===t.KALEIDOSCOPE_3?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,Pt(b().kaleidoscope3BallCount??54,t.KALEIDOSCOPE_3)):e===t.ORBIT_3D?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,function(){const e=b();S();const t=Math.max(1,0|(e.orbit3dMoonCount??80)),a=e.canvas.width,n=e.canvas.height;for(let r=0;r<t;r++){const t=Math.random()*Math.PI*2,i=.15*Math.min(a,n)+Math.random()*Math.min(a,n)*.1,o=qe(.5*a+Math.cos(t)*i,.5*n+Math.sin(t)*i,r<8?z(r):W());if(!o)continue;const l=(e.orbit3dVelocityMult??150)*(.9+.2*Math.random());o.vx=-Math.sin(t)*l,o.vy=Math.cos(t)*l,o.orbitDepth=Math.random()}}()):e===t.ORBIT_3D_2?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,function(){const e=b();S();const t=Math.max(1,0|(e.orbit3d2MoonCount??100)),a=e.canvas.width,n=e.canvas.height;for(let r=0;r<t;r++){const t=Math.random()*Math.PI*2,i=.35*Math.min(a,n)+Math.random()*Math.min(a,n)*.15,o=qe(.5*a+Math.cos(t)*i,.5*n+Math.sin(t)*i,r<8?z(r):W());if(!o)continue;const l=150*(e.orbit3d2VelocityMult??1.1);o.vx=-Math.sin(t)*l,o.vy=Math.cos(t)*l,o.orbitDepth=Math.random()}}()):e===t.CRITTERS?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,void 0===a._restBeforeCritters&&(a._restBeforeCritters=a.REST),void 0===a._frictionBeforeCritters&&(a._frictionBeforeCritters=a.FRICTION),a.REST=a.critterRestitution??a.REST,a.FRICTION=a.critterFriction??a.FRICTION,void 0===a._ballSpacingBeforeCritters&&(a._ballSpacingBeforeCritters=a.ballSpacing),a.ballSpacing=Math.min(a.ballSpacing||0,1),function(){const e=b();S();const a=e.canvas.width,n=e.canvas.height;e.DPR;const r=Math.max(10,Math.min(260,0|e.critterCount));for(let i=0;i<8&&i<r;i++){const r=qe(Math.random()*a|0,Math.random()*n|0,z(i)),o=ze(e,t.CRITTERS);r.r=o,r.rBase=o,r.m=Math.max(1,o*o*.12),r.vx=0,r.vy=0,r._critterHeading=Math.random()*Math.PI*2,r._critterTurn=0,r._critterPhase=Math.random(),r._critterLastPhase=r._critterPhase,r._critterWander=2*Math.random()-1,r._critterPause=0}for(let i=8;i<r;i++){const r=qe(Math.random()*a|0,Math.random()*n|0,W()),i=ze(e,t.CRITTERS);r.r=i,r.rBase=i,r.m=Math.max(1,i*i*.12),r.vx=0,r.vy=0,r._critterHeading=Math.random()*Math.PI*2,r._critterTurn=0,r._critterPhase=Math.random(),r._critterLastPhase=r._critterPhase,r._critterWander=2*Math.random()-1,r._critterPause=0}}()):e===t.NEURAL?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!0,function(){const e=b(),a=e.canvas;if(!a)return;S();const n=Math.max(8,Math.min(e.neuralBallCount??80,260)),r=a.width,i=a.height,o=40*(e.DPR||1),l=Math.min(8,n);for(let a=0;a<l;a++){const n=qe(o+Math.random()*(r-2*o),o+Math.random()*(i-2*o),z(a)),l=ze(e,t.NEURAL);n.r=l,n.rBase=l,n.m=Math.max(1,l*l*.12),n.vx=0,n.vy=0,n.driftAx=0,n.driftTime=0,n._neuralPhase=Math.random()*Math.PI*2}for(let a=l;a<n;a++){const a=qe(o+Math.random()*(r-2*o),o+Math.random()*(i-2*o),W()),n=ze(e,t.NEURAL);a.r=n,a.rBase=n,a.m=Math.max(1,n*n*.12),a.vx=0,a.vy=0,a.driftAx=0,a.driftTime=0,a._neuralPhase=Math.random()*Math.PI*2}}()):e===t.LATTICE?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!0,function(){const e=b();S();const t=e.canvas,a=t.width,n=t.height,r=Math.max(8,function(e,t){return.01*t*Math.max(1,Math.min(e.width,e.height))}(t,e.latticeSpacingVw??8.5)),i=.8660254037844386*r,o=Math.ceil(a/r)+2,l=Math.ceil(n/i)+2,s=e.latticeAlignment??"center",c=(o-1)*r,d=(l-1)*i;let p,u;"center"===s?(p=.5*(a-c),u=.5*(n-d)):"top-left"===s?(p=.5*-r,u=.5*-i):"top-center"===s?(p=.5*(a-c),u=.5*-i):"top-right"===s?(p=a-c+.5*r,u=.5*-i):(p=.5*(a-c),u=.5*(n-d));const m=.25*r;let h=0;for(let e=0;e<l;e++){const t=1&e?.5*r:0,l=u+e*i;for(let i=0;i<o;i++){const o=p+i*r+t;if(o>=-m&&o<=a+m&&l>=-m&&l<=n+m){const t=qe(o,l,z(h%8));t.latticeHomeX=o,t.latticeHomeY=l,t.latticeRow=e,t.latticeCol=i,t.vx=0,t.vy=0,t.driftAx=0,t.driftTime=0,h++}}}}()):e===t.PARALLAX_LINEAR?(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,function(){const e=b(),a=e.canvas;if(!a)return;S();const n=a.width,r=a.height,i=Math.max(3,Math.min(40,e.parallaxLinearGridX??14)),o=Math.max(3,Math.min(40,e.parallaxLinearGridY??10)),l=Math.max(2,Math.min(20,e.parallaxLinearGridZ??7)),s=Math.max(.2,Math.min(3,e.parallaxLinearSpanX??1.35)),c=Math.max(.2,Math.min(3,e.parallaxLinearSpanY??1.35)),d=-.5*n*s,p=-.5*r*c,u=n*s/Math.max(1,i-1),m=r*c/Math.max(1,o-1),h=Math.max(10,e.parallaxLinearZNear??50),g=(Math.max(h+100,e.parallaxLinearZFar??800)-h)/Math.max(1,l-1),f=Math.max(80,e.parallaxLinearFocalLength??420),y=Math.max(.1,Math.min(6,e.parallaxLinearDotSizeMul??1.8)),v=.32*(e.R_MED||20)*2.4*(e.DPR||1)*y,x=We(e,t.PARALLAX_LINEAR),M=.5*n,w=.5*r;let P=0;for(let e=l-1;e>=0;e--){const t=h+e*g,a=e/Math.max(1,l-1);for(let n=0;n<o;n++)for(let r=0;r<i;r++){const i=d+r*u,o=p+n*m,l=t,s=f/(f+l),c=M+i*s,h=w+o*s,g=v*s,y=Math.max(.25,Math.min(1,.4+.6*(1-a))),b=qe(c,h,z(P+2*e&7));b.r=g,b.vx=0,b.vy=0,b.alpha=y,b._parallax3D={x:i,y:o,z:l,baseScale:s},b._parallaxSizeMul=x<=1e-6?1:1+(2*Math.random()-1)*x,b._isParallax=!0,P++}}}()):e===t.PARALLAX_PERSPECTIVE&&(a.gravityMultiplier=0,a.G=0,a.repellerEnabled=!1,function(){const e=b(),a=e.canvas;if(!a)return;S();const n=a.width,r=a.height,i=Math.max(3,Math.min(50,e.parallaxPerspectiveGridX??16)),o=Math.max(3,Math.min(50,e.parallaxPerspectiveGridY??12)),l=Math.max(2,Math.min(25,e.parallaxPerspectiveGridZ??8)),s=Math.max(.2,Math.min(3,e.parallaxPerspectiveSpanX??1.45)),c=Math.max(.2,Math.min(3,e.parallaxPerspectiveSpanY??1.45)),d=-.5*n*s,p=-.5*r*c,u=n*s/Math.max(1,i-1),m=r*c/Math.max(1,o-1),h=Math.max(10,e.parallaxPerspectiveZNear??40),g=(Math.max(h+100,e.parallaxPerspectiveZFar??1200)-h)/Math.max(1,l-1),f=Math.max(0,Math.min(1,e.parallaxPerspectiveRandomness??.6)),y=Math.max(80,e.parallaxPerspectiveFocalLength??420),v=Math.max(.1,Math.min(6,e.parallaxPerspectiveDotSizeMul??1.8)),x=.3*(e.R_MED||20)*2*(e.DPR||1)*v,M=We(e,t.PARALLAX_PERSPECTIVE),w=.5*n,P=.5*r;let L=0;for(let e=l-1;e>=0;e--){const t=h+e*g,a=e/Math.max(1,l-1);for(let n=0;n<o;n++)for(let r=0;r<i;r++){const i=p+n*m,o=t,l=d+r*u+(Math.random()-.5)*u*f,s=i+(Math.random()-.5)*m*f,c=o+(Math.random()-.5)*g*f*.5,h=y/(y+c),v=w+l*h,b=P+s*h,S=x*h,C=Math.max(.2,Math.min(1,.3+.7*(1-a))),E=qe(v,b,z(L+3*e&7));E.r=S,E.vx=0,E.vy=0,E.alpha=C,E._parallax3D={x:l,y:s,z:c,baseScale:h},E._parallaxSizeMul=M<=1e-6?1:1+(2*Math.random()-1)*M,E._isParallax=!0,L++}}}()),console.log(`Mode ${e} initialized with ${a.balls.length} balls`);const r=Math.max(0,Math.round(function(e,a){switch(e){case t.PIT:return a.pitWarmupFrames??10;case t.PIT_THROWS:return a.pitThrowsWarmupFrames??10;case t.FLIES:return a.fliesWarmupFrames??10;case t.WEIGHTLESS:return a.weightlessWarmupFrames??10;case t.WATER:return a.waterWarmupFrames??10;case t.VORTEX:return a.vortexWarmupFrames??10;case t.PING_PONG:return a.pingPongWarmupFrames??10;case t.MAGNETIC:return a.magneticWarmupFrames??10;case t.BUBBLES:return a.bubblesWarmupFrames??10;case t.KALEIDOSCOPE:return a.kaleidoscopeWarmupFrames??10;case t.KALEIDOSCOPE_1:return a.kaleidoscope1WarmupFrames??10;case t.KALEIDOSCOPE_2:return a.kaleidoscope2WarmupFrames??10;case t.KALEIDOSCOPE_3:return a.kaleidoscope3WarmupFrames??10;case t.ORBIT_3D:return a.orbit3dWarmupFrames??10;case t.ORBIT_3D_2:return a.orbit3d2WarmupFrames??10;case t.CRITTERS:return a.crittersWarmupFrames??10;case t.NEURAL:return a.neuralWarmupFrames??10;case t.LATTICE:return a.latticeWarmupFrames??10;case t.PARALLAX_LINEAR:return a.parallaxLinearWarmupFrames??10;case t.PARALLAX_PERSPECTIVE:return a.parallaxPerspectiveWarmupFrames??10;default:return 10}}(e,a)||0));if(a.warmupFramesRemaining=r,"undefined"!=typeof window&&e!==n)try{window.dispatchEvent(new CustomEvent("bb:modeChanged",{detail:{prevMode:n,mode:e}}))}catch(e){}}function zt(){const e=b();try{V?.("reset")}catch(e){}Wt(e.currentMode)}function Kt(){const e=b();return e.currentMode===t.FLIES?He:e.currentMode===t.PIT||e.currentMode===t.PIT_THROWS?Xe:e.currentMode===t.WEIGHTLESS?Qe:e.currentMode===t.WATER?Ne:e.currentMode===t.VORTEX?lt:e.currentMode===t.PING_PONG?st:e.currentMode===t.MAGNETIC?ct:e.currentMode===t.BUBBLES?mt:e.currentMode===t.KALEIDOSCOPE||e.currentMode===t.KALEIDOSCOPE_1||e.currentMode===t.KALEIDOSCOPE_2||e.currentMode===t.KALEIDOSCOPE_3?Et:e.currentMode===t.ORBIT_3D?Ft:e.currentMode===t.ORBIT_3D_2?It:e.currentMode===t.CRITTERS?Dt:e.currentMode===t.NEURAL?Rt:e.currentMode===t.LATTICE?Bt:e.currentMode===t.PARALLAX_LINEAR?Vt:e.currentMode===t.PARALLAX_PERSPECTIVE?_t:null}function Nt(){const e=b();return e.currentMode===t.WATER?Ge:e.currentMode===t.PIT_THROWS?Je:e.currentMode===t.MAGNETIC?dt:e.currentMode===t.BUBBLES?ht:null}function Gt(){return b().currentMode===t.NEURAL?{preRender:Ot}:null}var $t=Object.freeze({__proto__:null,MODES:t,getForceApplicator:Kt,getModeRenderer:Gt,getModeUpdater:Nt,resetCurrentMode:zt,setMode:Wt});let qt=0,Ht=null,Xt=null,Yt=null,Zt=0,Ut=0;function jt(){try{return!!window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches}catch(e){return!1}}function Jt(e,t,a){return e<t?t:e>a?a:e}const Qt=r.PHYSICS_DT;let ea=0;const ta=42,aa=1/60;function na(e,t){const a=[{x:ta,y:ta},{x:t.width-ta,y:ta},{x:ta,y:t.height-ta},{x:t.width-ta,y:t.height-ta}];for(let t=0;t<a.length;t++){const n=a[t].x,r=a[t].y,i=e.x-n,o=e.y-r,l=Math.max(1,Math.hypot(i,o));if(l<ta+e.r){const t=(ta+e.r-l)/(ta+e.r)*1800,a=i/l,n=o/l;e.vx+=a*t*Qt,e.vy+=n*t*Qt}}}function ra(e,a){const n=b(),i=n.balls,o=n.canvas;if(!o)return;if(0===i.length)return;if(n.currentMode===t.KALEIDOSCOPE||n.currentMode===t.KALEIDOSCOPE_1||n.currentMode===t.KALEIDOSCOPE_2||n.currentMode===t.KALEIDOSCOPE_3){const t=Math.min(.033,Math.max(0,e)),r=i.length;for(let e=0;e<r;e++)i[e].step(t,a);!function({iterations:e=4,positionalCorrectionPercent:t=.25,positionalCorrectionSlopPx:a=null,maxCorrectionPx:n=null,enableSound:r=!0}={}){const i=b(),o=i.balls,l=Ee(),s=i.REST,c=t,d=a??.5*i.DPR,p=(i.ballSpacing||0)*(i.DPR||1),u=n??2*(i.DPR||1);for(let t=0;t<e;t++)for(let e=0;e<l.length;e++){const{i:a,j:n}=l[e],m=o[a],h=o[n];if(m.isSleeping&&h.isSleeping)continue;m.isSleeping&&m.wake(),h.isSleeping&&h.wake();const g=h.x-m.x,f=h.y-m.y,y=m.r+h.r+p,v=g*g+f*f;if(0===v||v>y*y)continue;const b=Math.sqrt(v),x=g/b,M=f/b,S=y-b,w=1/Math.max(m.m,.001),P=1/Math.max(h.m,.001);let L=c*Math.max(S-d,0)/(w+P);L>u&&(L=u);const C=L*x,E=L*M;m.x-=C*w,m.y-=E*w,h.x+=C*P,h.y+=E*P;const F=(h.vx-m.vx)*x+(h.vy-m.vy)*M;if(F<0){const e=-(1+(Math.abs(F)<30?0:s))*F/(w+P),o=e*x,l=e*M;if(m.vx-=o*w,m.vy-=l*w,h.vx+=o*P,h.vy+=l*P,r&&0===t){const e=(m.r+h.r)/2,t=(m.x+h.x)/2/(i.canvas?.width||1);fe(e,Math.min(1,Math.abs(F)/(50*(m.r+h.r))),t,`${a}-${n}`)}}}}({iterations:3,positionalCorrectionPercent:.22,maxCorrectionPx:1.25*(n.DPR||1),enableSound:!1});for(let e=0;e<r;e++)St(i[e],o.width,o.height,t);return void(ea=0)}ea+=e;let l=0;for(;ea>=Qt&&l<r.MAX_PHYSICS_STEPS;){const e=i.length;for(let t=0;t<e;t++)i[t].step(Qt,a);if(n.currentMode===t.KALEIDOSCOPE||n.currentMode===t.KALEIDOSCOPE_1||n.currentMode===t.KALEIDOSCOPE_2||n.currentMode===t.KALEIDOSCOPE_3?Fe(6):n.currentMode!==t.FLIES&&n.currentMode!==t.ORBIT_3D&&n.currentMode!==t.PARALLAX_LINEAR&&n.currentMode!==t.PARALLAX_PERSPECTIVE&&Fe(10),ke.clearAllPressure(),n.currentMode!==t.ORBIT_3D&&n.currentMode!==t.ORBIT_3D_2&&n.currentMode!==t.PARALLAX_LINEAR&&n.currentMode!==t.PARALLAX_PERSPECTIVE&&n.currentMode!==t.LATTICE){const e=n.currentMode===t.WEIGHTLESS?n.weightlessBounce:n.REST,a=i.length;for(let t=0;t<a;t++)na(i[t],o),i[t].walls(o.width,o.height,Qt,e)}ea-=Qt,l++}const s=Nt();s&&s(e),ke.step(e),ea>Qt*r.ACCUMULATOR_RESET_THRESHOLD&&(ea=0)}const ia=(()=>{try{return{log:console.log?.bind(console)??(()=>{}),info:console.info?.bind(console)??(()=>{}),warn:console.warn?.bind(console)??(()=>{}),error:console.error?.bind(console)??(()=>{}),debug:console.debug?.bind(console)??(()=>{}),groupCollapsed:console.groupCollapsed?.bind(console)??(()=>{}),groupEnd:console.groupEnd?.bind(console)??(()=>{}),table:console.table?.bind(console)??(()=>{})}}catch(e){return{log:()=>{},info:()=>{},warn:()=>{},error:()=>{},debug:()=>{},groupCollapsed:()=>{},groupEnd:()=>{},table:()=>{}}}})();let oa=null,la=0,sa="undefined"!=typeof performance&&performance.now?performance.now():Date.now(),ca=!1;function da(){return null===oa&&(oa=function(){try{return!1}catch(e){}try{if("8001"===String(globalThis?.location?.port??""))return!0}catch(e){}try{if(Array.from(document.scripts||[]).some(e=>{if("module"!==(e.getAttribute("type")||"").toLowerCase())return!1;const t=e.getAttribute("src")||"";return/(^|\/)main\.js(\?|#|$)/.test(t)}))return!0}catch(e){}return!1}()),oa}const pa=["#b7bcb7","#d0d0d0","#ffffff","#00695c","#1a1a1a","#ff4013","#0d5cb6","#ffa000"],ua=[.5,.25,.12,.06,.03,.02,.01,.01];function ma(){const e=Math.random();let t=0;for(let a=0;a<ua.length;a++)if(t+=ua[a],e<=t)return pa[a];return pa[0]}function ha({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"],silence:a=!1}={}){if(!ca){ca=!0;try{ia.log("%c"+e,"color: #888; font-style: italic;"),ia.log("");const a=function(e,t=3){const{colorAssignments:a}=function(e,t=3){const a=[];for(let n=0;n<e.length;n++){const r=e[n];for(let e=0;e<r.length;e+=t){const i=r.slice(e,e+t);a.push({row:n,col:e,visible:i.trim().length>0})}}const n=a.map((e,t)=>e.visible?t:-1).filter(e=>e>=0),r=new Array(a.length).fill(null),i=function(e){for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e}([...n]);for(let e=0;e<Math.min(8,i.length);e++)r[i[e]]=pa[e];for(const e of n)null===r[e]&&(r[e]=ma());for(let e=0;e<a.length;e++)null===r[e]&&(r[e]="transparent");return{clusters:a,colorAssignments:r}}(e,t),n=[];let r=0;for(const i of e){let e="";const o=[];for(let n=0;n<i.length;n+=t){e+="%c"+i.slice(n,n+t);const l=a[r];o.push(`color: ${l}; font-family: monospace; font-weight: bold;`),r++}n.push([e,...o])}return n}(t,3);for(const e of a)ia.log(...e);ia.log("");const n=(new Date).getFullYear();ia.log("%c© "+n+" Alexander Beck Studio. All rights reserved. Unauthorized reproduction prohibited.","color: #555; font-size: 10px;")}catch(e){}if(a)try{console.log=()=>{},console.info=()=>{},console.warn=()=>{},console.debug=()=>{},console.table=()=>{},console.group=()=>{},console.groupCollapsed=()=>{},console.groupEnd=()=>{}}catch(e){}}}function ga(e,t){if(!da())return;const a=("undefined"!=typeof performance&&performance.now?performance.now():Date.now())-sa;la+=1,ia.log(`[${String(la).padStart(2,"0")}] +${a.toFixed(1)}ms ${e}`)}function fa(e){if(da())try{performance.mark(e)}catch(e){}}function ya(e,t,a){if(!da())return null;try{performance.measure(e,t,a);const n=performance.getEntriesByName(e),r=n&&n.length?n[n.length-1]:null;return r?r.duration:null}catch(e){return null}}function va(e,t){return getComputedStyle(document.documentElement).getPropertyValue(e).trim()||t}let ba=null,xa=null;function Ma(){const e=navigator.userAgent||"",t=/Android/.test(e),a=/iPhone|iPad|iPod/.test(e)||/Mac/.test(e)&&navigator.maxTouchPoints>1,n=t||a,r=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||window.matchMedia&&window.matchMedia("(display-mode: minimal-ui)").matches||!0===navigator.standalone;return n||r}function Sa(e){const t=document.documentElement;t.style.setProperty("--wall-color",e),t.style.setProperty("--frame-color-light",e),t.style.setProperty("--frame-color-dark",e)}function wa(e){if(ba&&xa){const t=document.documentElement;return t.style.setProperty("--frame-color-light",ba),t.style.setProperty("--frame-color-dark",xa),void t.style.setProperty("--wall-color",e?xa:ba)}Sa(va(e?"--frame-color-dark":"--frame-color-light","#0a0a0a"))}function Pa(e,t){ba&&xa||(ba=va("--frame-color-light","#0a0a0a"),xa=va("--frame-color-dark","#0a0a0a")),Sa(va(e?"--wall-color-browser-dark":"--wall-color-browser-light",e?"#202124":"#f1f3f4"))}let La="auto",Ca="light",Ea=!1;function Fa(e,t){return getComputedStyle(document.documentElement).getPropertyValue(e).trim()||t}function Ia(e){La=e;let t=!1;t="auto"===e?"dark"===Ca||function(){const e=b();if(!e.autoDarkModeEnabled)return!1;const t=Number.isFinite(e.autoDarkNightStartHour)?e.autoDarkNightStartHour:18,a=Number.isFinite(e.autoDarkNightEndHour)?e.autoDarkNightEndHour:6,n=(new Date).getHours();return t!==a&&(t<a?n>=t&&n<a:n>=t||n<a)}():"dark"===e,function(e){const t=b();t.isDarkMode=e,document.documentElement.style.colorScheme=e?"dark":"light",e?(t.container?.classList.add("dark-mode"),document.body.classList.add("dark-mode"),document.documentElement.classList.add("dark-mode")):(t.container?.classList.remove("dark-mode"),document.body.classList.remove("dark-mode"),document.documentElement.classList.remove("dark-mode")),function(e){const t=b(),a=String(t.chromeHarmonyMode||"auto"),n=function(){const e=navigator.userAgent||"",t=navigator.vendor||"";return{isFirefox:/Firefox\//.test(e),isSafari:/Safari\//.test(e)&&/Apple/.test(t)&&!/Chrome\//.test(e)&&!/Chromium\//.test(e),isChromium:/Chrome\//.test(e)||/Chromium\//.test(e)||/Edg\//.test(e),ua:e}}();if("site"===a)return wa(e),{mode:a,family:n,themeColorLikelyApplied:Ma()};if("browser"===a)return Pa(e),{mode:a,family:n,themeColorLikelyApplied:Ma()};const r=Ma();n.isSafari?wa(e):n.isChromium&&!r?Pa(e):wa(e)}(e),function(e){const t=Fa("--chrome-bg-light","#f5f5f5"),a=Fa("--chrome-bg-dark","#0a0a0a"),n=e?a:t;let r=document.querySelector('meta[name="theme-color"]');r||(r=document.createElement("meta"),r.name="theme-color",document.head.appendChild(r)),r.content=n;let i=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: light)"]');i||(i=document.createElement("meta"),i.name="theme-color",i.media="(prefers-color-scheme: light)",document.head.appendChild(i)),i.content=t;let o=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: dark)"]');o||(o=document.createElement("meta"),o.name="theme-color",o.media="(prefers-color-scheme: dark)",document.head.appendChild(o)),o.content=a}(e),K(t.currentTemplate),function(){const e=document.getElementById("themeAuto"),t=document.getElementById("themeLight"),a=document.getElementById("themeDark");if(!e||!t||!a)return;[e,t,a].forEach(e=>e.classList.remove("active")),"auto"===La?e.classList.add("active"):"light"===La?t.classList.add("active"):a.classList.add("active");const n=document.getElementById("themeStatus");if(n){const e=b();n.textContent="auto"===La?e.isDarkMode?"🌙 Auto (Dark)":"☀️ Auto (Light)":"light"===La?"☀️ Light Mode":"🌙 Dark Mode"}}()}(t);try{localStorage.setItem("theme-preference",e)}catch(e){}ga(`🎨 Theme set to: ${e} (rendering: ${t?"dark":"light"})`)}function Ta(){if(Ea)return;Ea=!0,Ca=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",ga(`🖥️ System prefers: ${Ca}`);let e="auto";try{const t=localStorage.getItem("theme-preference");"auto"!==t&&"light"!==t&&"dark"!==t||(e=t)}catch(e){}Ia(e);const t=document.getElementById("themeAuto"),a=document.getElementById("themeLight"),n=document.getElementById("themeDark");t&&t.addEventListener("click",()=>Ia("auto")),a&&a.addEventListener("click",()=>Ia("light")),n&&n.addEventListener("click",()=>Ia("dark")),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{Ca=e.matches?"dark":"light",ga(`🖥️ System preference changed to: ${Ca}`),"auto"===La&&Ia("auto")}),window.setInterval(()=>{"auto"===La&&Ia("auto")},6e4),ga("✓ Modern dark mode initialized")}var ka=Object.freeze({__proto__:null,getCurrentTheme:function(){return La},initializeDarkMode:Ta,setTheme:Ia});function Da(){console.log("⚠️ localStorage is disabled")}function Aa(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(Da,500)}let Ra=null;const Oa="panel_control_visibility";let Ba={};function Va(){try{localStorage.setItem(Oa,JSON.stringify(Ba))}catch(e){}}function _a(e){return!1!==Ba[e]}function Wa(e,t=!0){const a=o[e];if(!a)return;const n=b();for(const[e,t]of Object.entries(a))"label"!==e&&void 0!==n[e]&&(n[e]=t);n.parallaxLinearPreset=e,t&&Promise.resolve().then(function(){return $t}).then(({resetCurrentMode:e})=>e());try{Za()}catch(e){}console.log(`Applied parallax linear preset: ${a.label}`)}function za(e,t=!0){const a=l[e];if(!a)return;const n=b();for(const[e,t]of Object.entries(a))"label"!==e&&void 0!==n[e]&&(n[e]=t);n.parallaxPerspectivePreset=e,t&&Promise.resolve().then(function(){return $t}).then(({resetCurrentMode:e})=>e());try{Za()}catch(e){}console.log(`Applied parallax perspective preset: ${a.label}`)}function Ka(e){return{id:e,label:"Warmup Frames",stateKey:e,type:"range",min:0,max:240,step:1,default:10,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0,hint:"Pre-runs physics before first render to avoid visible settling on mode start."}}function Na(e,t){try{if("function"==typeof e?.format)return e.format(t)}catch(e){}return String(t??"")}!function(){try{const e=localStorage.getItem(Oa);e&&(Ba=JSON.parse(e))}catch(e){Ba={}}}();const Ga={environment:{title:"Browser",icon:"🧭",defaultOpen:!1,controls:[{id:"chromeHarmonyMode",label:"Chrome Harmony",stateKey:"chromeHarmonyMode",type:"select",options:[{value:"auto",label:"Auto (adapt only when needed)"},{value:"site",label:"Site (benchmark)"},{value:"browser",label:"Browser (force adapt)"}],default:"site",format:e=>String(e),parse:e=>String(e),hint:"If desktop browsers ignore theme-color, the wall adapts to match the browser UI palette.",onChange:e=>{Promise.resolve().then(function(){return ka}).then(({getCurrentTheme:e,setTheme:t})=>{t(e())}).catch(()=>{})}},{id:"autoDarkModeEnabled",label:"Auto Dark (Night)",stateKey:"autoDarkModeEnabled",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,hint:"In Auto theme, prefer Dark during the night window (privacy-first: local clock only).",onChange:()=>{Promise.resolve().then(function(){return ka}).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}},{id:"autoDarkNightStartHour",label:"Night Starts",stateKey:"autoDarkNightStartHour",type:"range",min:0,max:23,step:1,default:18,format:e=>`${Math.round(e)}:00`,parse:e=>parseInt(e,10),onChange:()=>{Promise.resolve().then(function(){return ka}).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}},{id:"autoDarkNightEndHour",label:"Night Ends",stateKey:"autoDarkNightEndHour",type:"range",min:0,max:23,step:1,default:6,format:e=>`${Math.round(e)}:00`,parse:e=>parseInt(e,10),onChange:()=>{Promise.resolve().then(function(){return ka}).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}}]},balls:{title:"Balls",icon:"🎱",defaultOpen:!1,controls:[{id:"sizeGlobal",label:"Size",stateKey:"sizeScale",type:"range",min:.1,max:6,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat,onChange:(e,t)=>{Promise.resolve().then(function(){return L}).then(({updateBallSizes:t})=>{t();const a=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=a,e.rBase=a})}),Promise.resolve().then(function(){return On}).then(({updateCursorSize:e})=>{e()})}},{id:"responsiveScaleMobile",label:"Mobile Scale",stateKey:"responsiveScaleMobile",type:"range",min:.5,max:1.5,step:.05,default:.75,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Ball size multiplier for iPad/iPhone (requires reload)",onChange:(e,t)=>{Promise.resolve().then(function(){return L}).then(({detectResponsiveScale:t})=>{t();const a=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=a,e.rBase=a})})}},{id:"ballSoftnessGlobal",label:"Softness",stateKey:"ballSoftness",type:"range",min:0,max:100,step:1,default:20,format:e=>String(e),parse:e=>parseInt(e,10)},{id:"ballSpacing",label:"Spacing",stateKey:"ballSpacing",type:"range",min:0,max:10,step:.5,default:2.5,format:e=>e.toFixed(1)+"px",parse:parseFloat}]},cursor:{title:"Cursor",icon:"👆",defaultOpen:!1,controls:[{id:"cursorSize",label:"Size",stateKey:"cursorSize",type:"range",min:.1,max:3,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,onChange:(e,t)=>{Promise.resolve().then(function(){return On}).then(({updateCursorSize:e})=>{e()})}},{id:"cursorInfluenceRadiusVw",label:"Influence Radius",stateKey:"cursorInfluenceRadiusVw",type:"range",min:0,max:80,step:.5,default:14,format:e=>`${e.toFixed(1)}vw`,parse:parseFloat,hint:"Universal cursor interaction zone (scales with viewport width)."}]},trail:{title:"Trail",icon:"✨",defaultOpen:!1,controls:[{id:"mouseTrailEnabled",label:"Enabled",stateKey:"mouseTrailEnabled",type:"checkbox",default:!0},{id:"mouseTrailLength",label:"Length",stateKey:"mouseTrailLength",type:"range",min:4,max:96,step:1,default:18,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),hint:"Max samples kept (higher = smoother, slightly more work)"},{id:"mouseTrailSize",label:"Size",stateKey:"mouseTrailSize",type:"range",min:.5,max:10,step:.1,default:1.3,format:e=>e.toFixed(1)+"px",parse:parseFloat},{id:"mouseTrailFadeMs",label:"Fade",stateKey:"mouseTrailFadeMs",type:"range",min:40,max:1200,step:10,default:220,format:e=>`${Math.round(e)}ms`,parse:e=>parseInt(e,10)},{id:"mouseTrailOpacity",label:"Opacity",stateKey:"mouseTrailOpacity",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat}]},logo:{title:"Logo",icon:"◎",defaultOpen:!1,controls:[{id:"brandLogoImpactMul",label:"Click Depth",stateKey:"brandLogoImpactMul",type:"range",min:0,max:.12,step:.001,default:.014,format:e=>e.toFixed(3),parse:parseFloat,hint:"How far the logo “presses in” on simulation change.",onChange:(e,t)=>{const a=document.getElementById("brand-logo");a&&a.style.setProperty("--abs-brand-logo-impact-mul",String(t))}},{id:"brandLogoSquashMul",label:"Squash",stateKey:"brandLogoSquashMul",type:"range",min:0,max:7.5,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Squash & stretch amount during the click-in (Disney-ish).",onChange:(e,t)=>{const a=document.getElementById("brand-logo");a&&(a.style.setProperty("--abs-brand-logo-squash-x-mul",String(.009*t)),a.style.setProperty("--abs-brand-logo-squash-y-mul",String(.015*t)))}},{id:"brandLogoOvershoot",label:"Bounce Out",stateKey:"brandLogoOvershoot",type:"range",min:0,max:1.8,step:.01,default:.22,format:e=>e.toFixed(2),parse:parseFloat,hint:"How much it “pops past rest” on release (higher = bouncier)."},{id:"brandLogoReleaseMs",label:"Bounce Duration",stateKey:"brandLogoReleaseMs",type:"range",min:60,max:1440,step:5,default:220,format:e=>`${Math.round(e)}ms`,parse:e=>parseInt(e,10),hint:"How long the release takes (longer = softer)."},{id:"brandLogoTiltDeg",label:"Tilt",stateKey:"brandLogoTiltDeg",type:"range",min:0,max:6,step:.05,default:0,format:e=>`${e.toFixed(2)}°`,parse:parseFloat,hint:"Tiny rotation tied to the click (follow-through).",onChange:(e,t)=>{const a=document.getElementById("brand-logo");a&&a.style.setProperty("--abs-brand-logo-tilt-deg",String(t))}},{id:"brandLogoAnticipation",label:"Anticipation",stateKey:"brandLogoAnticipation",type:"range",min:0,max:1.2,step:.01,default:0,format:e=>e.toFixed(2),parse:parseFloat,hint:"Micro pre-pop before the click-in (0 = off)."}]},overlay:{title:"Overlay",icon:"🌫️",defaultOpen:!1,controls:[{id:"gateOverlayEnabled",label:"Enabled",stateKey:"gateOverlayEnabled",type:"checkbox",default:!0},{id:"gateOverlayOpacity",label:"White Wash",stateKey:"gateOverlayOpacity",type:"range",min:0,max:.1,step:.001,default:.01,format:e=>e.toFixed(3),parse:parseFloat,onChange:(e,t)=>{Promise.resolve().then(function(){return Hn}).then(({updateOverlayOpacity:e})=>{e(t)})}},{id:"gateOverlayTransitionMs",label:"Anim In Speed",stateKey:"gateOverlayTransitionMs",type:"range",min:200,max:1500,step:50,default:800,format:e=>`${Math.round(e)}ms`,parse:e=>parseInt(e,10),hint:"Duration for blur & depth zoom when opening",onChange:(e,t)=>{Promise.resolve().then(function(){return Hn}).then(({updateOverlayTransition:e})=>{e(t)})}},{id:"gateOverlayTransitionOutMs",label:"Anim Out Speed",stateKey:"gateOverlayTransitionOutMs",type:"range",min:200,max:1200,step:50,default:600,format:e=>`${Math.round(e)}ms`,parse:e=>parseInt(e,10),hint:"Duration for blur & depth zoom when closing",onChange:(e,t)=>{Promise.resolve().then(function(){return Hn}).then(({updateOverlayTransitionOut:e})=>{e(t)})}},{id:"gateOverlayContentDelayMs",label:"Content Delay",stateKey:"gateOverlayContentDelayMs",type:"range",min:0,max:1e3,step:50,default:200,format:e=>`${Math.round(e)}ms`,parse:e=>parseInt(e,10),hint:"Wait before showing dialog content",onChange:(e,t)=>{Promise.resolve().then(function(){return Hn}).then(({updateGateContentDelay:e})=>{e(t)})}},{id:"gateDepthScale",label:"Depth Scale",stateKey:"gateDepthScale",type:"range",min:.9,max:1,step:.001,default:.96,format:e=>e.toFixed(3),parse:parseFloat,hint:"Scene scale when gate opens (0.9-1.0)",onChange:(e,t)=>{Promise.resolve().then(function(){return Hn}).then(({updateGateDepthScale:e})=>{e(t)})}},{id:"gateDepthTranslateY",label:"Depth Shift",stateKey:"gateDepthTranslateY",type:"range",min:0,max:30,step:1,default:8,format:e=>`${Math.round(e)}px`,parse:parseInt,hint:"Vertical shift when gate opens",onChange:(e,t)=>{Promise.resolve().then(function(){return Hn}).then(({updateGateDepthTranslateY:e})=>{e(t)})}},{id:"logoOpacityInactive",label:"Logo Opacity Closed",stateKey:"logoOpacityInactive",type:"range",min:0,max:1,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,hint:"Logo opacity when gate is closed (1 = fully visible)",onChange:(e,t)=>{Promise.resolve().then(function(){return Hn}).then(({updateLogoOpacityInactive:e})=>{e(t)})}},{id:"logoOpacityActive",label:"Logo Opacity Open",stateKey:"logoOpacityActive",type:"range",min:0,max:1,step:.05,default:.2,format:e=>e.toFixed(2),parse:parseFloat,hint:"Logo opacity when gate is active (0.2 = more faded)",onChange:(e,t)=>{Promise.resolve().then(function(){return Hn}).then(({updateLogoOpacityActive:e})=>{e(t)})}},{id:"logoBlurInactive",label:"Logo Blur Closed",stateKey:"logoBlurInactive",type:"range",min:0,max:20,step:.5,default:0,format:e=>`${e.toFixed(1)}px`,parse:parseFloat,hint:"Logo blur when gate is closed (0 = sharp)",onChange:(e,t)=>{Promise.resolve().then(function(){return Hn}).then(({updateLogoBlurInactive:e})=>{e(t)})}},{id:"logoBlurActive",label:"Logo Blur Open",stateKey:"logoBlurActive",type:"range",min:0,max:30,step:.5,default:12,format:e=>`${e.toFixed(1)}px`,parse:parseFloat,hint:"Logo blur when gate is active (12px = soft blur)",onChange:(e,t)=>{Promise.resolve().then(function(){return Hn}).then(({updateLogoBlurActive:e})=>{e(t)})}}]},effects:{title:"Effects",icon:"✨",defaultOpen:!1,controls:[{id:"ghostLayerEnabled",label:"Ghost Trails",stateKey:"ghostLayerEnabled",type:"checkbox",default:!1},{id:"ghostLayerOpacity",label:"Trail Fade",stateKey:"ghostLayerOpacity",type:"range",min:.05,max:1,step:.01,default:.7,format:e=>e.toFixed(2),parse:parseFloat,hint:"Higher = shorter trails"},{id:"ghostLayerUsePerThemeOpacity",label:"Per-Theme Fade",stateKey:"ghostLayerUsePerThemeOpacity",type:"checkbox",default:!1,group:"Advanced",groupCollapsed:!0,hint:"Use separate fade values for Light vs Dark mode"},{id:"ghostLayerOpacityLight",label:"Fade (Light)",stateKey:"ghostLayerOpacityLight",type:"range",min:.05,max:1,step:.01,default:.7,format:e=>e.toFixed(2),parse:parseFloat,group:"Advanced",hint:"Higher = shorter trails"},{id:"ghostLayerOpacityDark",label:"Fade (Dark)",stateKey:"ghostLayerOpacityDark",type:"range",min:.05,max:1,step:.01,default:.7,format:e=>e.toFixed(2),parse:parseFloat,group:"Advanced",hint:"Higher = shorter trails"}]},frame:{title:"Frame",icon:"🖼️",defaultOpen:!1,controls:[{id:"frameColor",label:"Color",stateKey:"frameColor",type:"color",default:"#0a0a0a",onChange:(e,t)=>{const a=document.documentElement;a.style.setProperty("--frame-color-light",t),a.style.setProperty("--frame-color-dark",t),a.style.setProperty("--wall-color",t),a.style.setProperty("--chrome-bg",t),a.style.setProperty("--chrome-bg-light",t),a.style.setProperty("--chrome-bg-dark",t);const n=document.querySelector('meta[name="theme-color"]');n&&(n.content=t)}}]},shadow:{title:"Inner Shadow",icon:"🌑",defaultOpen:!1,controls:[{id:"containerInnerShadowOpacity",label:"Strength",stateKey:"containerInnerShadowOpacity",type:"range",min:0,max:.4,step:.01,default:.12,format:e=>e.toFixed(2),parse:parseFloat,cssVar:"--container-inner-shadow-opacity"},{id:"containerInnerShadowBlur",label:"Blur",stateKey:"containerInnerShadowBlur",type:"range",min:0,max:250,step:5,default:80,format:e=>`${Math.round(e)}px`,parse:e=>parseInt(e,10),cssVar:"--container-inner-shadow-blur"},{id:"containerInnerShadowSpread",label:"Spread",stateKey:"containerInnerShadowSpread",type:"range",min:-50,max:50,step:1,default:-10,format:e=>`${Math.round(e)}px`,parse:e=>parseInt(e,10),cssVar:"--container-inner-shadow-spread"},{id:"containerInnerShadowOffsetY",label:"Offset Y",stateKey:"containerInnerShadowOffsetY",type:"range",min:-60,max:60,step:1,default:0,format:e=>`${Math.round(e)}px`,parse:e=>parseInt(e,10),cssVar:"--container-inner-shadow-offset-y"}]},wall:{title:"Wall",icon:"🏗️",defaultOpen:!1,controls:[{id:"wallPreset",label:"Material",stateKey:"wallPreset",type:"select",options:Object.keys(i).map(e=>({value:e,label:e.charAt(0).toUpperCase()+e.slice(1)})),default:"rubber",format:e=>e.charAt(0).toUpperCase()+e.slice(1),onChange:(e,t)=>{!function(e,t){const a=i[e];a&&(Object.assign(t,a),t.wallPreset=e)}(t,e),Za()}},{id:"frameColor",label:"Color",stateKey:"frameColor",type:"color",default:"#0a0a0a",onChange:(e,t)=>{const a=document.documentElement;a.style.setProperty("--frame-color-light",t),a.style.setProperty("--frame-color-dark",t),a.style.setProperty("--wall-color",t);const n=document.querySelector('meta[name="theme-color"]');n&&(n.content=t)}},{id:"wallThicknessVw",label:"Thickness",stateKey:"wallThicknessVw",type:"range",min:0,max:8,step:.1,default:1.3,format:e=>`${e.toFixed(1)}vw`,parse:parseFloat,onChange:(e,t)=>{Promise.resolve().then(function(){return L}).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars(),Promise.resolve().then(function(){return Hn}).then(({updateBlurFromWallThickness:e})=>{e()})})}},{id:"wallRadiusVw",label:"Corner Radius",stateKey:"wallRadiusVw",type:"range",min:0,max:12,step:.1,default:3.7,format:e=>`${e.toFixed(1)}vw`,parse:parseFloat,onChange:(e,t)=>{Promise.resolve().then(function(){return L}).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars()})}},{id:"wallInset",label:"Collision Inset",stateKey:"wallInset",type:"range",min:0,max:20,step:1,default:2,format:e=>`${e}px`,parse:e=>parseInt(e,10),hint:"Physics padding inside the visual wall"},{id:"wallWobbleMaxDeform",label:"Strength (Max Deform)",stateKey:"wallWobbleMaxDeform",type:"range",min:0,max:150,step:1,default:45,format:e=>`${e}px`,parse:e=>parseInt(e,10),group:"Advanced Physics",groupCollapsed:!0},{id:"wallWobbleStiffness",label:"Stiffness",stateKey:"wallWobbleStiffness",type:"range",min:50,max:3e3,step:10,default:2200,format:e=>String(e),parse:e=>parseInt(e,10),group:"Advanced Physics"},{id:"wallWobbleDamping",label:"Damping",stateKey:"wallWobbleDamping",type:"range",min:0,max:80,step:1,default:35,format:e=>String(e),parse:e=>parseInt(e,10),group:"Advanced Physics"},{id:"wallWobbleSigma",label:"Impact Spread",stateKey:"wallWobbleSigma",type:"range",min:.5,max:4,step:.1,default:2,format:e=>e.toFixed(1),parse:parseFloat,group:"Advanced Physics"},{id:"wallWobbleCornerClamp",label:"Corner Stickiness",stateKey:"wallWobbleCornerClamp",type:"range",min:0,max:1,step:.01,default:.6,format:e=>e.toFixed(2),parse:parseFloat,group:"Advanced Physics"},{id:"wallWobbleImpactThreshold",label:"Impact Threshold",stateKey:"wallWobbleImpactThreshold",type:"range",min:20,max:200,step:1,default:140,format:e=>`${e} px/s`,parse:e=>parseInt(e,10),group:"Advanced Physics",hint:"Minimum velocity to trigger wall wobble"},{id:"wallWobbleSettlingSpeed",label:"Settling Speed",stateKey:"wallWobbleSettlingSpeed",type:"range",min:0,max:100,step:1,default:75,format:e=>`${e}%`,parse:e=>parseInt(e,10),group:"Advanced Physics",hint:"How aggressively walls stop moving"}]},noise:{title:"Noise",icon:"📺",defaultOpen:!1,controls:[{id:"noiseSizeBase",label:"Back Size",stateKey:"noiseSizeBase",type:"range",min:50,max:200,step:5,default:100,format:e=>String(e),parse:e=>parseInt(e,10),cssVar:"--noise-size-base"},{id:"noiseSizeTop",label:"Front Size",stateKey:"noiseSizeTop",type:"range",min:40,max:150,step:5,default:80,format:e=>String(e),parse:e=>parseInt(e,10),cssVar:"--noise-size-top"},{id:"noiseBackOpacity",label:"Back Opacity (Light)",stateKey:"noiseBackOpacity",type:"range",min:0,max:.15,step:.001,default:.02,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-back-opacity"},{id:"noiseFrontOpacity",label:"Front Opacity (Light)",stateKey:"noiseFrontOpacity",type:"range",min:0,max:.15,step:.001,default:.05,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-front-opacity"},{id:"noiseBackOpacityDark",label:"Back Opacity (Dark)",stateKey:"noiseBackOpacityDark",type:"range",min:0,max:.15,step:.001,default:.06,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-back-opacity-dark"},{id:"noiseFrontOpacityDark",label:"Front Opacity (Dark)",stateKey:"noiseFrontOpacityDark",type:"range",min:0,max:.15,step:.001,default:.04,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-front-opacity-dark"}]},critters:{title:"Critters",icon:"🪲",mode:"critters",defaultOpen:!1,controls:[{id:"critterCount",label:"Count",stateKey:"critterCount",type:"range",min:10,max:260,step:5,default:90,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"critterSpeed",label:"Speed",stateKey:"critterSpeed",type:"range",min:0,max:1800,step:10,default:680,format:e=>`${Math.round(e)}`,parse:parseFloat},{id:"critterMaxSpeed",label:"Max Speed",stateKey:"critterMaxSpeed",type:"range",min:200,max:4e3,step:25,default:1400,format:e=>`${Math.round(e)}`,parse:parseFloat},{id:"critterStepHz",label:"Step Rate",stateKey:"critterStepHz",type:"range",min:0,max:16,step:.1,default:5,format:e=>e.toFixed(1)+" Hz",parse:parseFloat},{id:"critterStepSharpness",label:"Step Sharpness",stateKey:"critterStepSharpness",type:"range",min:.5,max:6,step:.1,default:2.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnNoise",label:"Wander",stateKey:"critterTurnNoise",type:"range",min:0,max:8,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnDamp",label:"Turn Inertia",stateKey:"critterTurnDamp",type:"range",min:.5,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnSeek",label:"Steering",stateKey:"critterTurnSeek",type:"range",min:0,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterAvoidRadius",label:"Avoid Radius",stateKey:"critterAvoidRadius",type:"range",min:0,max:260,step:5,default:90,format:e=>`${Math.round(e)}px`,parse:parseFloat},{id:"critterAvoidForce",label:"Avoid Force",stateKey:"critterAvoidForce",type:"range",min:0,max:25e3,step:250,default:9500,format:e=>String(Math.round(e)),parse:parseFloat},{id:"critterEdgeAvoid",label:"Edge Avoid",stateKey:"critterEdgeAvoid",type:"range",min:0,max:3,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat},{id:"critterMousePull",label:"Mouse Fear",stateKey:"critterMousePull",type:"range",min:0,max:4,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Flee strength inside the mouse zone"},{id:"critterMouseRadiusVw",label:"Mouse Zone",stateKey:"critterMouseRadiusVw",type:"range",min:0,max:80,step:1,default:30,format:e=>`${Math.round(e)}vw`,parse:parseFloat},{id:"critterRestitution",label:"Bounciness",stateKey:"critterRestitution",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat,hint:"Mode-only override",onChange:(e,t)=>{"critters"===e.currentMode&&(e.REST=t)}},{id:"critterFriction",label:"Friction",stateKey:"critterFriction",type:"range",min:0,max:.06,step:.001,default:.018,format:e=>e.toFixed(3),parse:parseFloat,hint:"Mode-only override",onChange:(e,t)=>{"critters"===e.currentMode&&(e.FRICTION=t)}},Ka("crittersWarmupFrames")]},pit:{title:"Ball Pit",icon:"🎯",mode:"pit",defaultOpen:!1,controls:[{id:"gravityPit",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange:(e,t)=>{"pit"===e.currentMode&&(e.G=e.GE*t)}},{id:"weightPit",label:"Weight",stateKey:"ballMassKg",type:"range",min:10,max:200,step:1,default:129,format:e=>e.toFixed(0),parse:parseFloat,onChange:(e,t)=>{e.balls.forEach(e=>{e.m=t})}},{id:"restitution",label:"Bounciness",stateKey:"REST",type:"range",min:0,max:1,step:.01,default:.69,format:e=>e.toFixed(2),parse:parseFloat},{id:"friction",label:"Air Friction",stateKey:"FRICTION",type:"range",min:0,max:.01,step:5e-4,default:.006,format:e=>e.toFixed(4),parse:parseFloat},{id:"repelPower",label:"Repel Power",stateKey:"repelPower",type:"range",min:0,max:1e4,step:100,default:8500,format:e=>Math.round(e).toString(),parse:parseFloat,onChange:(e,t)=>{const a=Math.max(0,Math.min(1e4,t))/1e4;e.repelPower=12e3*Math.pow(2,12*(a-.5))*2}},Ka("pitWarmupFrames")]},pitThrows:{title:"Ball Pit (Throws)",icon:"🎯",mode:"pit-throws",defaultOpen:!1,controls:[{id:"gravityPitThrows",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange:(e,t)=>{"pit-throws"===e.currentMode&&(e.G=e.GE*t)}},{id:"pitThrowsSpeed",label:"Throw Speed",stateKey:"pitThrowSpeed",type:"range",min:100,max:2e3,step:25,default:650,format:e=>String(Math.round(e)),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpeedVar",label:"Speed Variance",stateKey:"pitThrowSpeedVar",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsInterval",label:"Throw Interval",stateKey:"pitThrowIntervalMs",type:"range",min:10,max:500,step:5,default:70,format:e=>`${Math.round(e)}ms`,parse:parseFloat},{id:"pitThrowsColorPause",label:"Color Pause",stateKey:"pitThrowColorPauseMs",type:"range",min:0,max:1200,step:10,default:180,format:e=>`${Math.round(e)}ms`,parse:parseFloat},{id:"pitThrowsPairChance",label:"Pair Chance",stateKey:"pitThrowPairChance",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsPairStagger",label:"Pair Stagger",stateKey:"pitThrowPairStaggerMs",type:"range",min:0,max:120,step:1,default:18,format:e=>`${Math.round(e)}ms`,parse:parseFloat},{id:"pitThrowsBatchSize",label:"Batch Size",stateKey:"pitThrowBatchSize",type:"range",min:1,max:60,step:1,default:18,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"pitThrowsTargetYFrac",label:"Throw Aim (Y)",stateKey:"pitThrowTargetYFrac",type:"range",min:.12,max:.7,step:.01,default:.36,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAngleJitter",label:"Angle Jitter",stateKey:"pitThrowAngleJitter",type:"range",min:0,max:.6,step:.01,default:.16,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpreadVar",label:"Spread Variance",stateKey:"pitThrowSpreadVar",type:"range",min:0,max:.8,step:.01,default:.25,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsSpeedJitter",label:"Speed Jitter",stateKey:"pitThrowSpeedJitter",type:"range",min:0,max:.8,step:.01,default:.22,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsInletInset",label:"Inlet Inset",stateKey:"pitThrowInletInset",type:"range",min:0,max:.2,step:.005,default:.06,format:e=>e.toFixed(3),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpawnSpread",label:"Spawn Spread",stateKey:"pitThrowSpawnSpread",type:"range",min:0,max:.12,step:.0025,default:.02,format:e=>e.toFixed(4),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAimJitter",label:"Aim Jitter",stateKey:"pitThrowAimJitter",type:"range",min:0,max:.2,step:.005,default:.04,format:e=>e.toFixed(3),parse:parseFloat},{id:"pitThrowsCrossBias",label:"Cross Aim",stateKey:"pitThrowCrossBias",type:"range",min:0,max:.3,step:.005,default:.12,format:e=>e.toFixed(3),parse:parseFloat},Ka("pitThrowsWarmupFrames")]},flies:{title:"Flies",icon:"🕊️",mode:"flies",defaultOpen:!1,controls:[{id:"fliesBallCount",label:"Ball Count",stateKey:"fliesBallCount",type:"range",min:20,max:150,step:5,default:60,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"attractPower",label:"Attraction",stateKey:"attractionPower",type:"range",min:100,max:8e3,step:50,default:5e3,format:e=>Math.round(e).toString(),parse:parseFloat},{id:"swarmSpeed",label:"Swarm Speed",stateKey:"swarmSpeed",type:"range",min:.2,max:5,step:.1,default:.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"fliesSeparation",label:"Separation",stateKey:"fliesSeparation",type:"range",min:5e3,max:3e4,step:1e3,default:15e3,format:e=>Math.round(e).toString(),parse:parseFloat},Ka("fliesWarmupFrames")]},weightless:{title:"Zero-G",icon:"🌌",mode:"weightless",defaultOpen:!1,controls:[{id:"weightlessCount",label:"Ball Count",stateKey:"weightlessCount",type:"range",min:20,max:200,step:10,default:80,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"weightlessSpeed",label:"Initial Speed",stateKey:"weightlessInitialSpeed",type:"range",min:100,max:600,step:25,default:250,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"weightlessBounce",label:"Bounce",stateKey:"weightlessBounce",type:"range",min:.5,max:1,step:.05,default:.95,format:e=>e.toFixed(2),parse:parseFloat},{id:"weightlessRepelPower",label:"Cursor Blast Power",stateKey:"weightlessRepelPower",type:"range",min:0,max:6e5,step:1e4,default:22e4,format:e=>Math.round(e).toString(),parse:parseFloat},{id:"weightlessRepelSoft",label:"Cursor Blast Falloff",stateKey:"weightlessRepelSoft",type:"range",min:.5,max:6,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},Ka("weightlessWarmupFrames")]},water:{title:"Water",icon:"🌊",mode:"water",defaultOpen:!1,controls:[{id:"waterBallCount",label:"Ball Count",stateKey:"waterBallCount",type:"range",min:50,max:400,step:10,default:300,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"waterDrag",label:"Water Resistance",stateKey:"waterDrag",type:"range",min:.001,max:.05,step:.001,default:.015,format:e=>e.toFixed(3),parse:parseFloat},{id:"waterRippleStrength",label:"Ripple Strength",stateKey:"waterRippleStrength",type:"range",min:5e3,max:3e4,step:1e3,default:18e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"waterMotion",label:"Drift Strength",stateKey:"waterDriftStrength",type:"range",min:0,max:80,step:1,default:40,format:e=>e.toFixed(0),parse:parseFloat,onChange:(e,t)=>{e.waterInitialVelocity=5*t},reinitMode:!0},Ka("waterWarmupFrames")]},vortex:{title:"Vortex",icon:"🌀",mode:"vortex",defaultOpen:!1,controls:[{id:"vortexBallCount",label:"Ball Count",stateKey:"vortexBallCount",type:"range",min:50,max:500,step:10,default:180,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"vortexSwirl",label:"Swirl Strength",stateKey:"vortexSwirlStrength",type:"range",min:100,max:3e3,step:50,default:420,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexPull",label:"Radial Pull",stateKey:"vortexRadialPull",type:"range",min:0,max:2e3,step:20,default:180,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexSpeedMultiplier",label:"Speed Multiplier",stateKey:"vortexSpeedMultiplier",type:"range",min:.1,max:3,step:.1,default:1,format:e=>e.toFixed(1),parse:parseFloat},{id:"vortexRadius",label:"Vortex Radius",stateKey:"vortexRadius",type:"range",min:0,max:800,step:20,default:0,format:e=>0===e?"Unlimited":e.toFixed(0)+"px",parse:parseFloat,tooltip:"Maximum effective radius (0 = unlimited, uses distance falloff)"},{id:"vortexFalloffCurve",label:"Falloff Curve",stateKey:"vortexFalloffCurve",type:"range",min:.3,max:3,step:.1,default:1,format:e=>e.toFixed(1),parse:parseFloat,tooltip:"Falloff shape: 1.0 = linear, 2.0 = quadratic (sharper), 0.5 = gentle"},{id:"vortexRotationDirection",label:"Rotation Direction",stateKey:"vortexRotationDirection",type:"range",min:-1,max:1,step:2,default:1,format:e=>1===e?"Counterclockwise":"Clockwise",parse:parseFloat},{id:"vortexCoreStrength",label:"Core Strength",stateKey:"vortexCoreStrength",type:"range",min:.5,max:3,step:.1,default:1,format:e=>e.toFixed(1)+"x",parse:parseFloat,tooltip:"Strength multiplier at vortex center"},{id:"vortexAccelerationZone",label:"Acceleration Zone",stateKey:"vortexAccelerationZone",type:"range",min:0,max:400,step:20,default:0,format:e=>0===e?"Disabled":e.toFixed(0)+"px",parse:parseFloat,tooltip:"Radius where extra acceleration occurs (0 = disabled)"},{id:"vortexOutwardPush",label:"Outward Push",stateKey:"vortexOutwardPush",type:"range",min:0,max:1e3,step:20,default:0,format:e=>0===e?"Disabled":e.toFixed(0),parse:parseFloat,tooltip:"Outward force at edges (only when radius is set)"},{id:"vortexDrag",label:"Drag",stateKey:"vortexDrag",type:"range",min:.001,max:.05,step:.001,default:.005,format:e=>e.toFixed(3),parse:parseFloat},Ka("vortexWarmupFrames")]},"ping-pong":{title:"Ping Pong",icon:"🏓",mode:"ping-pong",defaultOpen:!1,controls:[{id:"pingPongBallCount",label:"Ball Count",stateKey:"pingPongBallCount",type:"range",min:10,max:100,step:5,default:35,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"pingPongSpeed",label:"Ball Speed",stateKey:"pingPongSpeed",type:"range",min:200,max:1600,step:50,default:800,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"pingPongCursorRadius",label:"Cursor Radius",stateKey:"pingPongCursorRadius",type:"range",min:30,max:200,step:5,default:100,format:e=>e.toFixed(0),parse:parseFloat},{id:"pingPongVerticalDamp",label:"Vertical Damping",stateKey:"pingPongVerticalDamp",type:"range",min:.8,max:.999,step:.001,default:.995,format:e=>e.toFixed(3),parse:parseFloat},Ka("pingPongWarmupFrames")]},magnetic:{title:"Magnetic",icon:"🧲",mode:"magnetic",defaultOpen:!1,controls:[{id:"magneticBallCount",label:"Ball Count",stateKey:"magneticBallCount",type:"range",min:50,max:300,step:10,default:180,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"magneticStrength",label:"Strength",stateKey:"magneticStrength",type:"range",min:1e4,max:1e5,step:5e3,default:65e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticVelocity",label:"Max Velocity",stateKey:"magneticMaxVelocity",type:"range",min:500,max:4e3,step:100,default:2800,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticDamping",label:"Damping",stateKey:"magneticDamping",type:"range",min:.8,max:.999,step:.001,default:.98,format:e=>e.toFixed(3),parse:parseFloat},Ka("magneticWarmupFrames")]},bubbles:{title:"Bubbles",icon:"🫧",mode:"bubbles",defaultOpen:!1,controls:[{id:"bubblesRate",label:"Bubble Rate",stateKey:"bubblesSpawnRate",type:"range",min:1,max:20,step:1,default:8,format:e=>String(e),parse:e=>parseInt(e,10)},{id:"bubblesSpeed",label:"Rise Speed",stateKey:"bubblesRiseSpeed",type:"range",min:50,max:400,step:25,default:150,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesWobble",label:"Wobble",stateKey:"bubblesWobble",type:"range",min:0,max:100,step:5,default:40,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesMax",label:"Max Bubbles",stateKey:"bubblesMaxCount",type:"range",min:50,max:300,step:10,default:150,format:e=>String(e),parse:e=>parseInt(e,10)},Ka("bubblesWarmupFrames")]},tilt:{title:"Tilt",icon:"⚖️",mode:"tilt",defaultOpen:!1,controls:[{id:"tiltBallCount",label:"Particle Count",stateKey:"tiltBallCount",type:"range",min:100,max:500,step:10,default:300,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"tiltMaxAngle",label:"Max Angle",stateKey:"tiltMaxAngle",type:"range",min:.5,max:10,step:.5,default:2,format:e=>e.toFixed(1)+"°",parse:parseFloat},{id:"tiltLerpSpeed",label:"Smoothness",stateKey:"tiltLerpSpeed",type:"range",min:.01,max:.5,step:.01,default:.08,format:e=>e.toFixed(2),parse:parseFloat},{id:"tiltGlassMass",label:"Particle Mass",stateKey:"tiltGlassBallMass",type:"range",min:.02,max:.3,step:.01,default:.08,format:e=>e.toFixed(2)+"x",parse:parseFloat,reinitMode:!0},{id:"tiltFriction",label:"Friction",stateKey:"tiltFriction",type:"range",min:.002,max:.02,step:.001,default:.008,format:e=>e.toFixed(3),parse:parseFloat}]},kaleidoscope:{title:"Kaleidoscope",icon:"🪞",mode:"kaleidoscope",defaultOpen:!1,controls:[{id:"kaleiBallCount",label:"Ball Count",stateKey:"kaleidoscopeBallCount",type:"range",min:15,max:120,step:1,default:23,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"kaleiWedges",label:"Wedges",stateKey:"kaleidoscopeWedges",type:"range",min:4,max:16,step:1,default:12,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10)},{id:"kaleiMirror",label:"Mirror",type:"range",min:0,max:1,step:1,default:1,format:e=>e?"On":"Off",parse:e=>parseInt(e,10)},{id:"kaleiSpeed",label:"Speed",stateKey:"kaleidoscopeSpeed",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat},{id:"kaleiDotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscopeDotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kaleiDotAreaMul",label:"Dot Area",stateKey:"kaleidoscopeDotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},Ka("kaleidoscopeWarmupFrames")]},kaleidoscope1:{title:"Kaleidoscope I (Variant)",icon:"🪞",mode:"kaleidoscope-1",defaultOpen:!1,controls:[{id:"kalei1BallCount",label:"Ball Count",stateKey:"kaleidoscope1BallCount",type:"range",min:6,max:180,step:1,default:18,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei1Wedges",label:"Wedges",stateKey:"kaleidoscope1Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10)},{id:"kalei1Speed",label:"Speed",stateKey:"kaleidoscope1Speed",type:"range",min:.2,max:2,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei1DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope1DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei1DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope1DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},Ka("kaleidoscope1WarmupFrames")]},kaleidoscope2:{title:"Kaleidoscope II (Variant)",icon:"🪞",mode:"kaleidoscope-2",defaultOpen:!1,controls:[{id:"kalei2BallCount",label:"Ball Count",stateKey:"kaleidoscope2BallCount",type:"range",min:10,max:260,step:2,default:36,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei2Wedges",label:"Wedges",stateKey:"kaleidoscope2Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10)},{id:"kalei2Speed",label:"Speed",stateKey:"kaleidoscope2Speed",type:"range",min:.2,max:2,step:.05,default:1.15,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei2DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope2DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei2DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope2DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},Ka("kaleidoscope2WarmupFrames")]},kaleidoscope3:{title:"Kaleidoscope III (Variant)",icon:"🪞",mode:"kaleidoscope-3",defaultOpen:!1,controls:[{id:"kalei3BallCount",label:"Ball Count",stateKey:"kaleidoscope3BallCount",type:"range",min:12,max:300,step:3,default:54,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei3Wedges",label:"Wedges",stateKey:"kaleidoscope3Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10)},{id:"kalei3Speed",label:"Speed",stateKey:"kaleidoscope3Speed",type:"range",min:.2,max:2,step:.05,default:1.55,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei3DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope3DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei3DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope3DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},Ka("kaleidoscope3WarmupFrames")]},orbit3d:{title:"Orbit 3D: Zero Gravity",icon:"🌪️",mode:"orbit-3d",defaultOpen:!1,controls:[{id:"orbit3dMoonCount",label:"Body Count",stateKey:"orbit3dMoonCount",type:"range",min:10,max:200,step:10,default:80,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"orbit3dGravity",label:"Gravity Pull",stateKey:"orbit3dGravity",type:"range",min:1e3,max:1e4,step:500,default:5e3,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3dVelocityMult",label:"Orbital Speed",stateKey:"orbit3dVelocityMult",type:"range",min:50,max:300,step:10,default:150,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3dDepthScale",label:"Depth Effect",stateKey:"orbit3dDepthScale",type:"range",min:0,max:1.5,step:.1,default:.8,format:e=>e.toFixed(1),parse:parseFloat},{id:"orbit3dDamping",label:"Stability",stateKey:"orbit3dDamping",type:"range",min:.005,max:.05,step:.005,default:.02,format:e=>e.toFixed(3),parse:parseFloat},{id:"sizeVariationOrbit3d",label:"Size Variation",stateKey:"sizeVariationOrbit3d",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},Ka("orbit3dWarmupFrames")]},orbit3d2:{title:"Orbit 3D (Tight Swarm)",icon:"🌪️",mode:"orbit-3d-2",defaultOpen:!1,controls:[{id:"orbit3d2MoonCount",label:"Moon Count",stateKey:"orbit3d2MoonCount",type:"range",min:20,max:200,step:10,default:100,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"orbit3d2Gravity",label:"Gravity (G×M)",stateKey:"orbit3d2Gravity",type:"range",min:1e4,max:3e5,step:1e4,default:8e4,format:e=>`${Math.round(e/1e3)}k`,parse:parseFloat,reinitMode:!0},{id:"orbit3d2VelocityMult",label:"Initial Velocity",stateKey:"orbit3d2VelocityMult",type:"range",min:.5,max:1.5,step:.05,default:1.1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"orbit3d2MinOrbit",label:"Min Orbit (vw)",stateKey:"orbit3d2MinOrbit",type:"range",min:2,max:15,step:1,default:4,format:e=>e+"vw",parse:parseFloat,reinitMode:!0},{id:"orbit3d2MaxOrbit",label:"Max Orbit (vw)",stateKey:"orbit3d2MaxOrbit",type:"range",min:3,max:25,step:1,default:12,format:e=>e+"vw",parse:parseFloat,reinitMode:!0},{id:"orbit3d2DepthScale",label:"Depth Effect",stateKey:"orbit3d2DepthScale",type:"range",min:0,max:.8,step:.05,default:.6,format:e=>e.toFixed(2),parse:parseFloat},{id:"orbit3d2Damping",label:"Damping",stateKey:"orbit3d2Damping",type:"range",min:0,max:.2,step:.005,default:.01,format:e=>e.toFixed(3),parse:parseFloat},{id:"orbit3d2FollowSmoothing",label:"Cursor Follow Speed",stateKey:"orbit3d2FollowSmoothing",type:"range",min:1,max:200,step:1,default:40,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3d2Softening",label:"Gravity Softening",stateKey:"orbit3d2Softening",type:"range",min:1,max:100,step:1,default:15,format:e=>Math.round(e),parse:parseFloat},{id:"sizeVariationOrbit3d2",label:"Size Variation",stateKey:"sizeVariationOrbit3d2",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},Ka("orbit3d2WarmupFrames")]},lattice:{title:"Crystal Lattice",icon:"💎",mode:"lattice",defaultOpen:!1,controls:[{id:"sizeVariationLattice",label:"Size Variation",stateKey:"sizeVariationLattice",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"latticeSpacingVw",label:"Spacing (vw)",stateKey:"latticeSpacingVw",type:"range",min:1,max:20,step:.25,default:8.5,format:e=>e.toFixed(2)+"vw",parse:parseFloat,reinitMode:!0},{id:"latticeStiffness",label:"Stiffness",stateKey:"latticeStiffness",type:"range",min:0,max:10,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},{id:"latticeDamping",label:"Damping",stateKey:"latticeDamping",type:"range",min:.5,max:1,step:.01,default:.92,format:e=>e.toFixed(2),parse:parseFloat},{id:"latticeDisruptRadius",label:"Mesh Stretch Radius",stateKey:"latticeDisruptRadius",type:"range",min:50,max:1e3,step:25,default:600,format:e=>String(Math.round(e))+"px",parse:parseFloat},{id:"latticeDisruptPower",label:"Mesh Stretch Power",stateKey:"latticeDisruptPower",type:"range",min:0,max:50,step:1,default:25,format:e=>e.toFixed(1),parse:parseFloat},{id:"latticeMeshWaveStrength",label:"Wave Amplitude",stateKey:"latticeMeshWaveStrength",type:"range",min:0,max:50,step:1,default:12,format:e=>String(Math.round(e))+"px",parse:parseFloat},{id:"latticeMeshWaveSpeed",label:"Wave Speed",stateKey:"latticeMeshWaveSpeed",type:"range",min:0,max:3,step:.1,default:.8,format:e=>e.toFixed(1)+"x",parse:parseFloat},{id:"latticeAlignment",label:"Grid Alignment",stateKey:"latticeAlignment",type:"select",options:[{value:"center",label:"Center (Fill)"},{value:"top-left",label:"Top-Left"},{value:"top-center",label:"Top-Center"},{value:"top-right",label:"Top-Right"}],default:"center",format:e=>String(e),parse:e=>String(e),reinitMode:!0},Ka("latticeWarmupFrames")]},neural:{title:"Neural Network",icon:"🧠",mode:"neural",defaultOpen:!1,controls:[{id:"neuralBallCount",label:"Ball Count",stateKey:"neuralBallCount",type:"range",min:8,max:260,step:1,default:80,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"sizeVariationNeural",label:"Size Variation",stateKey:"sizeVariationNeural",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"neuralWanderStrength",label:"Wander Strength",stateKey:"neuralWanderStrength",type:"range",min:0,max:2e3,step:10,default:420,format:e=>String(Math.round(e)),parse:parseFloat},{id:"neuralDamping",label:"Damping",stateKey:"neuralDamping",type:"range",min:.8,max:1,step:.005,default:.985,format:e=>e.toFixed(3),parse:parseFloat},{id:"neuralCohesion",label:"Cohesion",stateKey:"neuralCohesion",type:"range",min:0,max:1,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},Ka("neuralWarmupFrames")]},parallaxLinear:{title:"Parallax (Linear)",icon:"🫧",mode:"parallax-linear",defaultOpen:!1,controls:[{id:"parallaxLinearPreset",label:"Preset",stateKey:"parallaxLinearPreset",type:"select",options:Object.keys(o).map(e=>({value:e,label:o[e].label})),default:"default",format:e=>o[e]?.label||e,onChange:e=>{Wa(e,!0)}},{id:"parallaxLinearDotSizeMul",label:"Dot Size",stateKey:"parallaxLinearDotSizeMul",type:"range",min:.2,max:6,step:.1,default:1.8,format:e=>e.toFixed(1)+"×",parse:parseFloat,reinitMode:!0},{id:"sizeVariationParallaxLinear",label:"Size Variation",stateKey:"sizeVariationParallaxLinear",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"parallaxLinearGridX",label:"Grid X (Cols)",stateKey:"parallaxLinearGridX",type:"range",min:3,max:40,step:1,default:14,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearGridY",label:"Grid Y (Rows)",stateKey:"parallaxLinearGridY",type:"range",min:3,max:40,step:1,default:10,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearGridZ",label:"Grid Z (Layers)",stateKey:"parallaxLinearGridZ",type:"range",min:2,max:20,step:1,default:7,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearSpanX",label:"Span X",stateKey:"parallaxLinearSpanX",type:"range",min:.2,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0,hint:"World-space width as a multiple of the viewport width. Use >1 to fill edge-to-edge."},{id:"parallaxLinearSpanY",label:"Span Y",stateKey:"parallaxLinearSpanY",type:"range",min:.2,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0,hint:"World-space height as a multiple of the viewport height."},{id:"parallaxLinearZNear",label:"Z Near",stateKey:"parallaxLinearZNear",type:"range",min:10,max:1200,step:10,default:50,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearZFar",label:"Z Far",stateKey:"parallaxLinearZFar",type:"range",min:50,max:3e3,step:25,default:900,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearFocalLength",label:"Focal Length",stateKey:"parallaxLinearFocalLength",type:"range",min:80,max:2e3,step:10,default:420,format:e=>`${Math.round(e)}px`,parse:e=>parseInt(e,10)},{id:"parallaxLinearParallaxStrength",label:"Parallax Strength",stateKey:"parallaxLinearParallaxStrength",type:"range",min:0,max:2e3,step:10,default:260,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10)},Ka("parallaxLinearWarmupFrames")]},parallaxPerspective:{title:"Parallax (Perspective)",icon:"🫧",mode:"parallax-perspective",defaultOpen:!1,controls:[{id:"parallaxPerspectivePreset",label:"Preset",stateKey:"parallaxPerspectivePreset",type:"select",options:Object.keys(l).map(e=>({value:e,label:l[e].label})),default:"default",format:e=>l[e]?.label||e,onChange:e=>{za(e,!0)}},{id:"parallaxPerspectiveRandomness",label:"Randomness",stateKey:"parallaxPerspectiveRandomness",type:"range",min:0,max:1,step:.05,default:.6,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0,hint:"0 = perfect grid. 1 = full jitter from grid vertices."},{id:"parallaxPerspectiveDotSizeMul",label:"Dot Size",stateKey:"parallaxPerspectiveDotSizeMul",type:"range",min:.2,max:6,step:.1,default:1.8,format:e=>e.toFixed(1)+"×",parse:parseFloat,reinitMode:!0},{id:"sizeVariationParallaxPerspective",label:"Size Variation",stateKey:"sizeVariationParallaxPerspective",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveGridX",label:"Grid X (Cols)",stateKey:"parallaxPerspectiveGridX",type:"range",min:3,max:50,step:1,default:16,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveGridY",label:"Grid Y (Rows)",stateKey:"parallaxPerspectiveGridY",type:"range",min:3,max:50,step:1,default:12,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveGridZ",label:"Grid Z (Layers)",stateKey:"parallaxPerspectiveGridZ",type:"range",min:2,max:25,step:1,default:8,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveSpanX",label:"Span X",stateKey:"parallaxPerspectiveSpanX",type:"range",min:.2,max:3,step:.05,default:1.45,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveSpanY",label:"Span Y",stateKey:"parallaxPerspectiveSpanY",type:"range",min:.2,max:3,step:.05,default:1.45,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveZNear",label:"Z Near",stateKey:"parallaxPerspectiveZNear",type:"range",min:10,max:1200,step:10,default:40,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveZFar",label:"Z Far",stateKey:"parallaxPerspectiveZFar",type:"range",min:50,max:4e3,step:50,default:1200,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveFocalLength",label:"Focal Length",stateKey:"parallaxPerspectiveFocalLength",type:"range",min:80,max:2e3,step:10,default:420,format:e=>`${Math.round(e)}px`,parse:e=>parseInt(e,10)},{id:"parallaxPerspectiveParallaxStrength",label:"Parallax Strength",stateKey:"parallaxPerspectiveParallaxStrength",type:"range",min:0,max:2e3,step:10,default:280,format:e=>String(Math.round(e)),parse:e=>parseInt(e,10)},Ka("parallaxPerspectiveWarmupFrames")]}};function $a(){const e=[];for(const t of Object.values(Ga))for(const a of t.controls)e.push({...a,section:t.title});return e}function qa(e){if(!_a(e.id))return"";const t=e.id+"Slider",a=e.id+"Val",n=e.id+"Picker";if("color"===e.type)return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${e.default}</span>\n        </div>\n        <input type="color" id="${n}" value="${e.default}" aria-label="${e.label}" />\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`;if("select"===e.type){const n=(Array.isArray(e.options)?e.options:[]).map(t=>{const a=String(t.value),n=String(t.label??t.value);return`<option value="${a}" ${String(e.default)===a?"selected":""}>${n}</option>`}).join(""),r=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${Na(e,e.default)}</span>\n        </div>\n        <select id="${t}" class="control-select" aria-label="${e.label}">\n          ${n}\n        </select>\n      </label>\n      ${r}`}if("checkbox"===e.type){const n=e.default?"checked":"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${e.default?"On":"Off"}</span>\n        </div>\n        <input type="checkbox" id="${t}" ${n} aria-label="${e.label}">\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`}const r=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${Na(e,e.default)}</span>\n        </div>\n        <input type="range" id="${t}" min="${e.min}" max="${e.max}" step="${e.step}" value="${e.default}">\n      </label>\n      ${r}`}function Ha(e,t){const a=t.controls.filter(e=>_a(e.id));if(0===a.length)return"";let n=null,r="";for(const e of a)e.group&&e.group!==n?(null!==n&&(r+="</div>"),r+=`<div class="section-title" style="margin-top: 12px;">${e.group}</div><div class="group">`,n=e.group):e.group||null===n||(r+="</div>",n=null),r+=qa(e);null!==n&&(r+="</div>");const i=t.defaultOpen?"open":"",o=`\n    <summary class="panel-section-header">\n      ${t.icon?`<span class="section-icon">${t.icon}</span>`:""}\n      <span class="section-label">${t.title}</span>\n    </summary>`,l=`<div class="panel-section-content">${r}</div>`;return t.mode?`\n      <div id="${t.mode}Controls" class="mode-controls">\n        <details class="panel-section-accordion" ${i}>\n          ${o}\n          ${l}\n        </details>\n      </div>`:`\n    <details class="panel-section-accordion" ${i}>\n      ${o}\n      ${l}\n    </details>`}function Xa(){try{for(const[,e]of Object.entries(Ga)){if(!e?.mode)continue;const t=Array.isArray(e.controls)?e.controls.length:0;t<4&&console.warn(`[panel] Mode "${e.mode}" has only ${t} controls; add at least 4 parameters.`)}}catch(e){}const e=Object.entries(Ga).filter(([,e])=>e?.mode).map(([e,t])=>Ha(0,t)).join("");let t=`\n    \x3c!-- Screen reader announcements --\x3e\n    <div role="status" aria-live="polite" aria-atomic="true" class="sr-only" id="announcer"></div>\n\n    \x3c!-- Theme --\x3e\n    <details class="panel-section-accordion" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎨</span>\n        <span class="section-label">Theme</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="theme-segment-control" role="group" aria-label="Theme selector">\n          <button id="themeAuto" class="theme-segment-btn" aria-label="Auto theme">Auto</button>\n          <button id="themeLight" class="theme-segment-btn active" aria-label="Light theme">Light</button>\n          <button id="themeDark" class="theme-segment-btn" aria-label="Dark theme">Dark</button>\n        </div>\n        <div id="themeStatus" class="panel-status">☀️ Light Mode</div>\n      </div>\n    </details>\n\n    \x3c!-- Mode --\x3e\n    <details class="panel-section-accordion" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎛️</span>\n        <span class="section-label">Mode</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="mode-switcher" role="group" aria-label="Simulation mode selector">\n          ${(()=>{const e={pit:"🎯",bubbles:"🫧",critters:"🪲",flies:"🕊️","pit-throws":"🎯",water:"🌊",vortex:"🌀",magnetic:"🧲","ping-pong":"🏓",weightless:"🌌",kaleidoscope:"🪞","kaleidoscope-1":"🪞","kaleidoscope-2":"🪞","kaleidoscope-3":"🪞","orbit-3d":"🌪️","orbit-3d-2":"🌪️",lattice:"💎",neural:"🧠"},t={pit:"Pit",bubbles:"Bubbles",critters:"Critters",flies:"Flies","pit-throws":"Throws",water:"Water",vortex:"Vortex",magnetic:"Magnet","ping-pong":"Pong",weightless:"Zero-G",kaleidoscope:"Kalei","kaleidoscope-1":"Kalei I","kaleidoscope-2":"Kalei II","kaleidoscope-3":"Kalei III","orbit-3d":"Orbit","orbit-3d-2":"Swarm",lattice:"Lattice",neural:"Neural"};let r="";return a.forEach(a=>{const i=t[a]||a;r+=`<button class="mode-button" data-mode="${a}" aria-label="${n[a]||i} mode">${e[a]||"⚪"} ${i}</button>`}),r})()}\n        </div>\n        ${e}\n      </div>\n    </details>`;for(const[e,a]of Object.entries(Ga))a.mode||(t+=Ha(0,a));return t+='\n    <details class="panel-section-accordion">\n      <summary class="panel-section-header">\n        <span class="section-icon">🌈</span>\n        <span class="section-label">Colors</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Color Template</span>\n            <span class="control-value"></span>\n          </div>\n          <select id="colorSelect"></select>\n        </label>\n      </div>\n    </details>',t+='\n    <div class="panel-section panel-section--action">\n      <button id="saveConfigBtn" class="primary">💾 Save Config</button>\n    </div>\n    <div class="panel-footer">\n      <kbd>R</kbd> reset · <kbd>/</kbd> panel · <kbd>9</kbd> kalei · Critters + Throws have no key (yet)\n    </div>',t}function Ya(){const e=b();for(const[t,a]of Object.entries(Ga))for(const t of a.controls){const n=t.id+"Val",r=document.getElementById(n);if("color"===t.type){const a=t.id+"Picker",n=document.getElementById(a);if(!n)continue;n.addEventListener("input",()=>{const a=n.value;t.stateKey&&(e[t.stateKey]=a),t.onChange&&t.onChange(e,a),r&&(r.textContent=a),Aa()});continue}if("select"===t.type){const a=t.id+"Slider",n=document.getElementById(a);if(!n)continue;n.addEventListener("change",()=>{const a=t.parse?t.parse(n.value):n.value;if(t.stateKey&&(e[t.stateKey]=a),t.onChange&&t.onChange(e,a),r){const n=t.stateKey?e[t.stateKey]:a;r.textContent=t.format?t.format(n):String(n)}Aa()});continue}if("checkbox"===t.type){const n=t.id+"Slider",i=document.getElementById(n);if(!i)continue;i.addEventListener("change",()=>{const n=!!i.checked;t.stateKey&&(e[t.stateKey]=n),t.onChange&&t.onChange(e,n),r&&(r.textContent=n?"On":"Off"),t.reinitMode&&e.currentMode===a.mode&&Promise.resolve().then(function(){return $t}).then(({resetCurrentMode:e})=>e?.()).catch(()=>{}),Aa()});continue}const i=t.id+"Slider",o=document.getElementById(i);o&&o.addEventListener("input",()=>{const n=t.parse(o.value);if(t.stateKey&&(e[t.stateKey]=n),t.onChange&&t.onChange(e,n),r){const a=t.stateKey?e[t.stateKey]:n;r.textContent=t.format(a)}if(t.cssVar&&Ra){const e={};e[t.cssVar.replace("--","").replace(/-([a-z])/g,(e,t)=>t.toUpperCase())]=n,Ra(e)}t.reinitMode&&e.currentMode===a.mode&&Promise.resolve().then(function(){return $t}).then(({resetCurrentMode:e})=>e?.()).catch(()=>{}),Aa()})}}function Za(){const e=b();for(const t of Object.values(Ga))for(const a of t.controls){const t=a.id+"Slider",n=a.id+"Val",r=document.getElementById(t),i=document.getElementById(n);if(!r||!a.stateKey)continue;const o=e[a.stateKey];void 0!==o&&("checkbox"===a.type?(r.checked=!!o,i&&(i.textContent=o?"On":"Off")):(r.value=o,i&&(i.textContent=a.format(o))))}}var Ua=Object.freeze({__proto__:null,CONTROL_SECTIONS:Ga,applyParallaxLinearPreset:Wa,applyParallaxPerspectivePreset:za,bindRegisteredControls:Ya,generatePanelHTML:Xa,getAllControls:$a,getControlById:function(e){for(const t of Object.values(Ga)){const a=t.controls.find(t=>t.id===e);if(a)return a}return null},getVisibilityState:function(){return{...Ba}},isControlVisible:_a,resetVisibility:function(){Ba={},Va()},setApplyVisualCSSVars:function(e){Ra=e},setControlVisible:function(e,t){Ba[e]=t,Va()},syncSlidersToState:Za});function ja(){Ya(),document.querySelectorAll(".mode-button").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const a=e.getAttribute("data-mode");console.log("Mode button clicked:",a),Wt(a),Ja(a)})}),N();const e=document.getElementById("colorSelect");e&&e.addEventListener("change",()=>{K(e.value),Aa()});const t=document.getElementById("themeAuto"),a=document.getElementById("themeLight"),n=document.getElementById("themeDark");[t,a,n].forEach(e=>{e&&e.addEventListener("click",()=>{[t,a,n].forEach(e=>e?.classList.remove("active")),e.classList.add("active")})})}function Ja(e){document.querySelectorAll(".mode-button").forEach(t=>{const a=t.getAttribute("data-mode")===e;t.classList.toggle("active",a)}),document.querySelectorAll(".mode-controls").forEach(e=>e.classList.remove("active"));const t=e+"Controls",a=document.getElementById(t);a&&a.classList.add("active");const r=document.getElementById("announcer");if(r){const t={critters:"Critters",pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero-G",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope","kaleidoscope-1":"Kaleidoscope I","kaleidoscope-2":"Kaleidoscope II","kaleidoscope-3":"Kaleidoscope III","orbit-3d":"Orbit 3D","orbit-3d-2":"Orbit 3D (Tight Swarm)",lattice:"Crystal Lattice",neural:"Neural Network"};r.textContent=`Switched to ${t[e]||e} mode`}try{const t=document.getElementById("edge-chapter-text");t&&(t.textContent=n?.[e]||"—")}catch(e){}}var Qa=Object.freeze({__proto__:null,setupControls:ja,updateModeButtonsUI:Ja});const en=Xa(),tn={core:{title:"Core",controls:[{id:"masterGain",label:"Master Volume",min:10,max:100,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"collisionMinImpact",label:"Silence Threshold",min:20,max:85,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e}]},envelope:{title:"Envelope",controls:[{id:"decayTime",label:"Click Length",min:20,max:180,step:1,format:e=>`${Math.round(e)}ms`,toConfig:e=>e/1e3,fromConfig:e=>1e3*e}]},tone:{title:"Tone",controls:[{id:"filterBaseFreq",label:"Brightness",min:300,max:6e3,step:50,format:e=>`${Math.round(e)}Hz`,toConfig:e=>e,fromConfig:e=>e},{id:"harmonicGain",label:"Warmth",min:0,max:50,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"filterQ",label:"Resonance",min:10,max:200,step:5,format:e=>`${(e/100).toFixed(2)}`,toConfig:e=>e/100,fromConfig:e=>100*e}]},crystal:{title:"Crystal",controls:[{id:"pitchMinHz",label:"Pitch Low",min:80,max:1200,step:10,format:e=>`${Math.round(e)}Hz`,toConfig:e=>e,fromConfig:e=>e},{id:"pitchMaxHz",label:"Pitch High",min:200,max:4e3,step:20,format:e=>`${Math.round(e)}Hz`,toConfig:e=>e,fromConfig:e=>e},{id:"pitchCurve",label:"Pitch Curve",min:70,max:160,step:1,format:e=>`${(e/100).toFixed(2)}×`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleGain",label:"Sparkle",min:0,max:35,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMin",label:"Sparkle Min",min:120,max:600,step:10,format:e=>`${(e/100).toFixed(2)}×`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMax",label:"Sparkle Max",min:160,max:800,step:10,format:e=>`${(e/100).toFixed(2)}×`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleDecayMul",label:"Sparkle Decay",min:20,max:95,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"noiseTransientQ",label:"Sparkle Q",min:60,max:600,step:5,format:e=>`${(e/100).toFixed(2)}`,toConfig:e=>e/100,fromConfig:e=>100*e}]},space:{title:"Space",controls:[{id:"reverbWetMix",label:"Reverb Mix",min:0,max:50,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"reverbDecay",label:"Room Size",min:5,max:80,step:1,format:e=>`${(e/100).toFixed(2)}s`,toConfig:e=>e/100,fromConfig:e=>100*e}]},dynamics:{title:"Dynamics",controls:[{id:"minGain",label:"Min Hit Volume",min:0,max:20,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"maxGain",label:"Max Hit Volume",min:5,max:50,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e}]},realism:{title:"Realism",controls:[{id:"noiseTransientGain",label:"Impact Snap",min:0,max:80,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"varianceGain",label:"Volume Variance",min:0,max:50,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"variancePitch",label:"Pitch Variance",min:0,max:25,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"velocityNoiseScale",label:"Hard Hit Crack",min:100,max:500,step:10,format:e=>`${(e/100).toFixed(1)}×`,toConfig:e=>e/100,fromConfig:e=>100*e}]}};function an(e,t){const a=t();for(const t of Object.values(tn))for(const n of t.controls){const t=e.querySelector(`#sound_${n.id}`),r=e.querySelector(`#sound_${n.id}_val`);if(!t||void 0===a[n.id])continue;const i=n.fromConfig(a[n.id]);t.value=i,r&&(r.textContent=n.format(i))}}let nn=null,rn=null;const on="panel_dock_position_v2",ln="master_panel_collapsed",sn="panel_dock_size";function cn(e){try{localStorage.setItem("panel_dock_hidden",String(e))}catch(e){}}let dn=!1,pn=0,un=0,mn=0,hn=0;function gn(){try{const e=document.getElementById("controlPanel");e&&e.remove();const t=document.getElementById("soundPanel");t&&t.remove()}catch(e){}return nn=document.createElement("div"),nn.className="panel-dock",nn.id="panelDock",nn.classList.add("hidden"),cn(!0),rn=function(){const e=document.createElement("div");e.id="masterPanel",e.className=function(){try{const e=localStorage.getItem(ln);return null===e||"true"===e}catch(e){return!0}}()?"panel collapsed":"panel",e.setAttribute("role","region"),e.setAttribute("aria-label","Settings");const t=document.createElement("div");t.className="panel-header";const a=da()?"DEV MODE":"BUILD MODE";t.innerHTML=`\n    <div class="mac-titlebar">\n      <div class="mac-traffic" aria-hidden="true">\n        <span class="mac-dot mac-dot--red"></span>\n        <span class="mac-dot mac-dot--yellow"></span>\n        <span class="mac-dot mac-dot--green"></span>\n      </div>\n      <div class="panel-title mac-title">Settings</div>\n      <div class="mac-right">\n        <span class="panel-mode-pill" role="status" aria-label="Runtime mode">${a}</span>\n        <button class="collapse-btn mac-collapse" aria-label="Collapse panel" title="Collapse">▾</button>\n      </div>\n    </div>\n  `;const n=document.createElement("div");n.className="panel-content",n.innerHTML=function(){const e=b(),t=Number(e.containerBorderVw||0),a=Number(e.wallRadiusVw||0),n=Number(e.contentPaddingVw||0),r=m(),i=e.layoutViewportWidthPx>0?`${Math.round(e.layoutViewportWidthPx)}px`:`Auto (${Math.round(r)}px)`,o=Math.max(0,Math.round(e.containerBorder??0)),l=Math.max(0,Math.round(e.wallRadius??e.cornerRadius??0)),s=Math.max(0,Math.round(e.contentPadding??0)),c=Math.max(0,Math.round(e.wallInset??3)),d=Math.max(0,Math.round(e.layoutMinContentPaddingPx??0)),p=Number(e.contentPaddingHorizontalRatio||1),u=Math.max(0,Math.round(e.layoutMinWallRadiusPx??0));return`\n    \x3c!-- ═══════════════════════════════════════════════════════════════════════\n         LAYOUT SECTION - Frame & Content Spacing\n         ═══════════════════════════════════════════════════════════════════════ --\x3e\n    <details class="panel-section-accordion" id="layoutSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">📐</span>\n        <span class="section-label">Layout</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Frame</span>\n            <span class="control-value" id="frameValue">${t.toFixed(2)}vw · ${o}px</span>\n          </div>\n          <input type="range" id="layoutFrame" min="0" max="8" step="0.05" value="${t||0}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Content Padding</span>\n            <span class="control-value" id="contentPadValue">${n.toFixed(2)}vw · ${s}px (min ${d}px)</span>\n          </div>\n          <input type="range" id="contentPadding" min="0" max="12" step="0.05" value="${n||0}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Horizontal Ratio</span>\n            <span class="control-value" id="contentPadHorizRatioValue">${p.toFixed(2)}× → ${Math.round(s*p)}px</span>\n          </div>\n          <input type="range" id="contentPadHorizRatio" min="0.5" max="2.5" step="0.05" value="${p}" />\n          <div class="control-hint">Horizontal padding = base × ratio</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Min Content Padding</span>\n            <span class="control-value" id="minContentPadValue">${d}px</span>\n          </div>\n          <input type="range" id="layoutMinContentPaddingPx" min="0" max="64" step="1" value="${d}" />\n          <div class="control-hint">Clamp target on smallest viewports (px).</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Radius</span>\n            <span class="control-value" id="radiusValue">${a.toFixed(2)}vw · ${l}px (min ${u}px)</span>\n          </div>\n          <input type="range" id="layoutRadius" min="0" max="20" step="0.05" value="${a||0}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Min Radius</span>\n            <span class="control-value" id="minRadiusValue">${u}px</span>\n          </div>\n          <input type="range" id="layoutMinWallRadiusPx" min="0" max="120" step="1" value="${u}" />\n          <div class="control-hint">Clamp target on smallest viewports (px).</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Viewport Width</span>\n            <span class="control-value" id="viewportWidthValue">${i}</span>\n          </div>\n          <input type="range" id="layoutViewportWidth" min="0" max="2400" step="10" value="${Math.round(e.layoutViewportWidthPx||0)}" />\n          <div class="control-hint">0 = Auto (uses current window width)</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Wall Inset</span>\n            <span class="control-value" id="wallInsetValue">${c}px</span>\n          </div>\n          <input type="range" id="layoutWallInset" min="0" max="20" value="${c}" />\n        </label>\n      </div>\n    </details>\n\n    \x3c!-- ═══════════════════════════════════════════════════════════════════════\n         SOUND SECTION\n         ═══════════════════════════════════════════════════════════════════════ --\x3e\n    <details class="panel-section-accordion" id="soundSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">🔊</span>\n        <span class="section-label">Sound</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="sound-enable-row">\n          <button id="soundEnableBtn" class="sound-enable-btn" aria-label="Enable sound" title="Enable sound">🔇</button>\n        </div>\n        <div id="soundControlsWrapper" class="sound-controls" style="display: none;">\n          <div class="sound-perf" aria-label="Sound performance controls">\n            <button type="button" id="soundTapBtn" class="sound-perf__btn" aria-label="Play test hit">▶︎</button>\n            <button type="button" id="soundResetBtn" class="sound-perf__btn" aria-label="Reset to preset">↺</button>\n            <button type="button" id="soundShuffleBtn" class="sound-perf__btn" aria-label="Shuffle (subtle) sound">🎲</button>\n            <span class="sound-perf__hint">wheel adjusts · shift/alt = fine</span>\n          </div>\n          <label class="control-row">\n            <span class="control-label">Preset</span>\n            <select id="soundPresetSelect" class="control-select"></select>\n          </label>\n          <p id="presetDescription" class="control-hint"></p>\n          ${function(){let e="";for(const[t,a]of Object.entries(tn)){e+='<div class="sound-dock__section">',e+=`<div class="sound-dock__section-title">${a.title}</div>`,e+='<div class="sound-dock__group">';for(const t of a.controls)e+=`\n        <label class="sound-dock__row">\n          <span class="sound-dock__label">${t.label}</span>\n          <input type="range" \n            id="sound_${t.id}" \n            class="sound-dock__slider" \n            min="${t.min}" \n            max="${t.max}" \n            step="${t.step}">\n          <span class="sound-dock__val" id="sound_${t.id}_val">${t.format(t.fromConfig(0))}</span>\n        </label>`;e+="</div></div>"}return e}()}\n        </div>\n      </div>\n    </details>\n\n    \x3c!-- ═══════════════════════════════════════════════════════════════════════\n         CONTROLS SECTION - Theme & Mode\n         ═══════════════════════════════════════════════════════════════════════ --\x3e\n    <details class="panel-section-accordion" id="controlsSection" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">⚙️</span>\n        <span class="section-label">Controls</span>\n      </summary>\n      <div class="panel-section-content">\n        ${en}\n      </div>\n    </details>\n  `}(),e.appendChild(t),e.appendChild(n);const r=function(){try{const e=localStorage.getItem(sn);if(!e)return null;const t=JSON.parse(e);if(!t||"object"!=typeof t)return null;const a=Number(t.width),n=Number(t.height);return Number.isFinite(a)&&Number.isFinite(n)?{width:Math.round(a),height:Math.round(n)}:null}catch(e){return null}}();r&&(e.style.width=`${r.width}px`,e.style.height=`${r.height}px`,e.style.maxHeight="none");const i=t.querySelector(".collapse-btn");return i&&i.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),function(e){e.classList.toggle("collapsed"),function(e){try{localStorage.setItem(ln,String(e))}catch(e){}}(e.classList.contains("collapsed"))}(e)}),setTimeout(()=>{ja(),function(){const e=document.getElementById("saveConfigBtn");e&&e.addEventListener("click",()=>{const e=b(),t={};try{const a=$a();for(const n of a){if(!n||!n.stateKey)continue;const a=e[n.stateKey];void 0!==a&&(t[n.stateKey]=a)}}catch(e){}t.gravityMultiplier=e.gravityMultiplierPit,t.restitution=e.REST,t.friction=e.FRICTION,t.ballMass=e.ballMassKg,t.ballScale=e.sizeScale,t.sizeScale=e.sizeScale,t.sizeVariation=e.sizeVariation,t.repelSoft=e.repelSoft,t.repelSoftness=e.repelSoft,t.layoutViewportWidthPx=e.layoutViewportWidthPx||0,t.containerBorderVw=e.containerBorderVw,t.simulationPaddingVw=e.simulationPaddingVw,t.contentPaddingVw=e.contentPaddingVw,t.contentPaddingHorizontalRatio=e.contentPaddingHorizontalRatio,t.wallRadiusVw=e.wallRadiusVw,t.wallThicknessVw=e.wallThicknessVw,t.layoutMinContentPaddingPx=Math.max(0,Math.round(e.layoutMinContentPaddingPx??0)),t.layoutMinWallRadiusPx=Math.max(0,Math.round(e.layoutMinWallRadiusPx??0)),t.wallInset=e.wallInset;try{t.soundPreset=Le(),t.soundConfig=Se()}catch(e){}t.chromeHarmonyMode=e.chromeHarmonyMode,t.autoDarkModeEnabled=e.autoDarkModeEnabled,t.autoDarkNightStartHour=e.autoDarkNightStartHour,t.autoDarkNightEndHour=e.autoDarkNightEndHour,t.enableLOD=!1;const a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(a),n.download="default-config.json",document.body.appendChild(n),n.click(),document.body.removeChild(n)})}(),function(e){const t=e.querySelector("#soundEnableBtn"),a=e.querySelector("#soundControlsWrapper"),n=e.querySelector("#soundPresetSelect"),r=e.querySelector("#presetDescription"),i=e.querySelector("#soundSection"),o=e.querySelector("#soundTapBtn"),l=e.querySelector("#soundResetBtn"),s=e.querySelector("#soundShuffleBtn"),c=(e,t,a)=>e<t?t:e>a?a:e,d=(e,t)=>e+2*(Math.random()-.5)*t,p=(e,{openIfEnabled:n=!1}={})=>{if(!t)return;const r=e||Me(),o=!(!r.isUnlocked||!r.isEnabled),l=!!r.isUnlocked;t.innerHTML=l&&o?'<i class="ti ti-volume-2" aria-hidden="true"></i>':'<i class="ti ti-volume-off" aria-hidden="true"></i>',t.setAttribute("aria-label",l?o?"Sound on":"Sound off":"Enable sound"),t.title=l?o?"Sound on":"Sound off":"Enable sound",t.classList.toggle("enabled",o),a&&(a.style.display=o?"":"none"),n&&o&&i&&!i.open&&(i.open=!0)};if(o&&o.addEventListener("click",()=>{ye({intensity:.86,radius:18,xPosition:.72})}),l&&l.addEventListener("click",()=>{const t=Le();Pe(t),r&&X[t]&&(r.textContent=X[t].description),an(e,Se)}),s&&s.addEventListener("click",()=>{const t=Se();we({filterBaseFreq:c(d(t.filterBaseFreq,120),300,8e3),filterQ:c(d(t.filterQ,.04),.05,.9),pitchCurve:c(d(t.pitchCurve,.06),.6,1.8),sparkleGain:c(d(t.sparkleGain,.03),0,.35),sparkleDecayMul:c(d(t.sparkleDecayMul,.05),.25,.95),noiseTransientQ:c(d(t.noiseTransientQ,.25),.6,6),reverbWetMix:c(d(t.reverbWetMix,.02),0,.35),reverbDecay:c(d(t.reverbDecay,.03),.05,.4),collisionMinImpact:c(d(t.collisionMinImpact,.03),.45,.9),variancePitch:c(d(t.variancePitch,.01),0,.2),varianceGain:c(d(t.varianceGain,.02),0,.35)}),an(e,Se),ye({intensity:.86,radius:18,xPosition:.72})}),t&&t.addEventListener("click",async()=>{const e=Me();if(e.isUnlocked){const t=xe();p({...e,isEnabled:t})}else await ge()&&p(null,{openIfEnabled:!0})}),n){for(const[e,t]of Object.entries(X)){const a=document.createElement("option");a.value=e,a.textContent=t.label,n.appendChild(a)}n.value=Le(),r&&X[Le()]&&(r.textContent=X[Le()].description),n.addEventListener("change",()=>{Pe(n.value),r&&X[n.value]&&(r.textContent=X[n.value].description),an(e,Se)})}(function(e,t,a){const n=(e,t,a)=>e<t?t:e>a?a:e;for(const t of Object.values(tn))for(const r of t.controls){const t=e.querySelector(`#sound_${r.id}`),i=e.querySelector(`#sound_${r.id}_val`);if(!t)continue;const o=e=>{const o=parseFloat(t.min),l=parseFloat(t.max),s=n(e,o,l);t.value=String(s);const c=r.toConfig(s);i&&(i.textContent=r.format(s)),a({[r.id]:c})};t.addEventListener("input",()=>{o(parseFloat(t.value))}),t.addEventListener("wheel",e=>{if(e.ctrlKey)return;const a=(parseFloat(t.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),n=e.deltaY<0?1:-1,r=parseFloat(t.value);e.preventDefault(),o(r+n*a)},{passive:!1}),i&&i.addEventListener("wheel",e=>{if(e.ctrlKey)return;const a=(parseFloat(t.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),n=e.deltaY<0?1:-1,r=parseFloat(t.value);e.preventDefault(),o(r+n*a)},{passive:!1})}})(e,0,we),an(e,Se),p(),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(ie,e=>{p(e&&e.detail?e.detail:null)})}(e),function(e){const t=e.querySelector("#layoutFrame"),a=e.querySelector("#frameValue"),n=e.querySelector("#contentPadding"),r=e.querySelector("#contentPadValue"),i=e.querySelector("#contentPadHorizRatio"),o=e.querySelector("#contentPadHorizRatioValue"),l=e.querySelector("#layoutMinContentPaddingPx"),s=e.querySelector("#minContentPadValue"),c=e.querySelector("#layoutRadius"),d=e.querySelector("#radiusValue"),p=e.querySelector("#layoutMinWallRadiusPx"),u=e.querySelector("#minRadiusValue"),h=e.querySelector("#layoutViewportWidth"),g=e.querySelector("#viewportWidthValue"),v=e.querySelector("#layoutWallInset"),x=e.querySelector("#wallInsetValue"),M=b(),S=({triggerResize:e=!1}={})=>{if(f(),y(),a&&(a.textContent=`${(M.containerBorderVw||0).toFixed(2)}vw · ${Math.round(M.containerBorder||0)}px`),r){const e=Math.max(0,Math.round(M.layoutMinContentPaddingPx??0));r.textContent=`${(M.contentPaddingVw||0).toFixed(2)}vw · ${Math.round(M.contentPadding||0)}px (min ${e}px)`}if(o){const e=M.contentPaddingHorizontalRatio||1;o.textContent=`${e.toFixed(2)}× → ${Math.round(M.contentPaddingX||M.contentPadding)}px`}if(d){const e=Math.max(0,Math.round(M.layoutMinWallRadiusPx??0));d.textContent=`${(M.wallRadiusVw||0).toFixed(2)}vw · ${Math.round(M.wallRadius||0)}px (min ${e}px)`}if(s&&(s.textContent=`${Math.max(0,Math.round(M.layoutMinContentPaddingPx??0))}px`),u&&(u.textContent=`${Math.max(0,Math.round(M.layoutMinWallRadiusPx??0))}px`),g){const e=m();g.textContent=M.layoutViewportWidthPx>0?`${Math.round(M.layoutViewportWidthPx)}px`:`Auto (${Math.round(e)}px)`}e&&rt(),document.dispatchEvent(new CustomEvent("layout-updated"))};t&&a&&t.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(M.containerBorderVw=t,M.wallThicknessVw=t,S({triggerResize:!0}))}),n&&r&&n.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(M.contentPaddingVw=t,S())}),i&&o&&i.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(M.contentPaddingHorizontalRatio=Math.max(.1,t),S())}),l&&s&&l.addEventListener("input",e=>{const t=parseInt(e.target.value,10);Number.isFinite(t)&&(M.layoutMinContentPaddingPx=Math.max(0,t),S({triggerResize:!0}))}),c&&d&&c.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(M.wallRadiusVw=t,S())}),p&&u&&p.addEventListener("input",e=>{const t=parseInt(e.target.value,10);Number.isFinite(t)&&(M.layoutMinWallRadiusPx=Math.max(0,t),S({triggerResize:!0}))}),h&&g&&h.addEventListener("input",e=>{const t=parseInt(e.target.value,10);M.layoutViewportWidthPx=Number.isFinite(t)?Math.max(0,t):0,S({triggerResize:!0})}),v&&x&&v.addEventListener("input",e=>{const t=parseInt(e.target.value,10);x.textContent=`${t}px`,M.wallInset=t})}(e)},0),e}(),nn.appendChild(rn),document.body.insertBefore(nn,document.body.firstChild),function(){if(!rn)return;const e=rn.querySelector(".panel-header");e&&(e.addEventListener("mousedown",fn),e.addEventListener("touchstart",fn,{passive:!1}),document.addEventListener("mousemove",yn),document.addEventListener("mouseup",vn),document.addEventListener("touchmove",yn,{passive:!1}),document.addEventListener("touchend",vn),function(){try{if(!nn)return;const e=JSON.parse(localStorage.getItem(on)||"{}");e.custom&&(nn.style.position="fixed",nn.style.left=e.left,nn.style.top=e.top,nn.style.right="auto")}catch(e){}}())}(),function(){if(!rn)return;if("undefined"==typeof ResizeObserver)return;let e=0;const t=new ResizeObserver(()=>{rn&&(rn.classList.contains("collapsed")||(window.clearTimeout(e),e=window.setTimeout(()=>{!function(e){try{if(!e)return;if(e.classList.contains("collapsed"))return;const t=e.getBoundingClientRect(),a={width:Math.round(t.width),height:Math.round(t.height)};localStorage.setItem(sn,JSON.stringify(a))}catch(e){}}(rn)},150)))});try{t.observe(rn)}catch(e){}}(),nn}function fn(e){if(e.target.closest("button")||e.target.closest("input")||e.target.closest("select"))return;if(!nn)return;const t=e.touches?e.touches[0].clientX:e.clientX,a=e.touches?e.touches[0].clientY:e.clientY,n=nn.getBoundingClientRect();pn=t,un=a,mn=n.left,hn=n.top,dn=!1}function yn(e){if(0===pn&&0===un)return;if(!nn)return;const t=e.touches?e.touches[0].clientX:e.clientX,a=e.touches?e.touches[0].clientY:e.clientY,n=t-pn,r=a-un;if(!dn&&(Math.abs(n)>5||Math.abs(r)>5)&&(dn=!0,nn.classList.add("dragging"),nn.style.position="fixed",nn.style.top=`${hn}px`,nn.style.left=`${mn}px`,nn.style.right="auto"),dn){let t=mn+n,a=hn+r;const i=nn.getBoundingClientRect();t=Math.max(0,Math.min(window.innerWidth-i.width,t)),a=Math.max(0,Math.min(window.innerHeight-i.height,a)),nn.style.left=`${t}px`,nn.style.top=`${a}px`,e.preventDefault()}}function vn(){dn&&(dn=!1,nn&&nn.classList.remove("dragging"),bn()),pn=0,un=0,setTimeout(()=>{},10)}function bn(){try{if(!nn)return;const e={left:nn.style.left,top:nn.style.top,custom:!0};localStorage.setItem(on,JSON.stringify(e))}catch(e){}}function xn(){if(nn){nn.style.position="",nn.style.left="",nn.style.top="",nn.style.right="";try{localStorage.removeItem(on)}catch(e){}}}const Mn=xn;function Sn(){if(!nn)try{gn()}catch(e){return}const e=nn.classList.toggle("hidden");if(cn(e),!e)try{!function(){if(!nn)return;const e=!!nn.style.left,t=!!nn.style.top;if(!e&&!t)return;const a=nn.getBoundingClientRect(),n=window.innerWidth||0,r=window.innerHeight||0;if(!n||!r)return;const i=10;if(a.right<i||a.left>n-i||a.bottom<i||a.top>r-i)return void xn();const o=(e,t,a)=>e<t?t:e>a?a:e,l=o(a.left,i,Math.max(i,n-a.width-i)),s=o(a.top,i,Math.max(i,r-a.height-i));nn.style.position="fixed",nn.style.left=`${Math.round(l)}px`,nn.style.top=`${Math.round(s)}px`,nn.style.right="auto",bn()}()}catch(e){}}var wn=Object.freeze({__proto__:null,collapsePanel:function(){rn&&rn.classList.add("collapsed")},createPanelDock:gn,expandPanel:function(){rn&&rn.classList.remove("collapsed")},getControlPanel:function(){return rn},getDock:function(){return nn},getSoundPanel:function(){return rn},resetDockPosition:Mn,resetPanelPositions:xn,toggleDock:Sn});let Pn=!1;function Ln(e){const n=b(),r=n?.currentMode||t.PIT_THROWS,i=a;if(!i||!i.length)return;const o=i.indexOf(r),l=i[((o>=0?o:0)+e+i.length)%i.length];Wt(l),Ja(l)}let Cn=null,En=!1,Fn=!1,In=0;function Tn(){En||(Cn=document.createElement("div"),Cn.id="custom-cursor",Cn.setAttribute("aria-hidden","true"),document.body.appendChild(Cn),Cn.style.display="none",En=!0,kn())}function kn(){if(!Cn)return;const e=b(),t=(e.R_MIN+e.R_MAX)/2*e.cursorSize;In=2*t,Cn.style.width=`${In}px`,Cn.style.height=`${In}px`,Cn.style.borderRadius="50%",Cn.style.marginLeft="0",Cn.style.marginTop="0",Fn||(Cn.style.transform="translate(-50%, -50%) scale(1)",Cn.style.opacity="1")}function Dn(e,t){if(!Cn)return;const a=Fn;Fn=function(e,t){const a=document.getElementById("bravia-balls");if(!a)return!1;const n=a.getBoundingClientRect();return e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom}(e,t),Cn.style.left=`${e}px`,Cn.style.top=`${t}px`,document.body.style.cursor="none",Fn?(Cn.style.display="block",a?Cn.style.transform.includes("scale(0.25)")||(Cn.style.transform="translate(-50%, -50%) scale(0.25)",Cn.style.opacity="1"):(Cn.style.transform="translate(-50%, -50%) scale(1)",Cn.style.opacity="1",Cn.offsetHeight,requestAnimationFrame(()=>{Cn.style.transform="translate(-50%, -50%) scale(0.25)",Cn.style.opacity="1"}))):(Cn.style.display="none",a&&(Cn.style.transform="translate(-50%, -50%) scale(1)",Cn.style.opacity="1"))}function An(){Cn&&(Cn.style.display="none",document.body.style.cursor="none",Fn=!1)}function Rn(){Cn&&(Fn=!1)}var On=Object.freeze({__proto__:null,hideCursor:An,setupCustomCursor:Tn,showCursor:Rn,updateCursorPosition:Dn,updateCursorSize:kn});let Bn=null,Vn=!0;function _n(){try{const e=getComputedStyle(document.documentElement).getPropertyValue("--wall-thickness").trim();if(e)return parseFloat(e)||12}catch(e){}const e=b();return e?.wallThickness||12}function Wn(){if(!Bn)return;const e=_n()/2;Bn.style.setProperty("--gate-overlay-blur",`${e}px`)}function zn(e){if(Bn=document.getElementById("gate-overlay"),!Bn)return void console.warn("Gate Overlay: #gate-overlay element not found");if(Vn=!1!==e.gateOverlayEnabled,!Vn)return console.log("Gate Overlay: Disabled by config"),void(Bn.style.display="none");Bn.style.display="";const t=e.gateOverlayOpacity??.01,a=e.gateOverlayTransitionMs??400,n=e.gateOverlayTransitionOutMs??250,r=e.gateOverlayContentDelayMs??200,i=e.gateDepthScale??.96,o=e.gateDepthTranslateY??8,l=e.logoOpacityInactive??1,s=e.logoOpacityActive??.2,c=e.logoBlurInactive??0,d=e.logoBlurActive??12,p=document.documentElement;p.style.setProperty("--gate-depth-scale",i),p.style.setProperty("--gate-depth-translate-y",`${o}px`),p.style.setProperty("--gate-depth-duration",`${a}ms`),p.style.setProperty("--gate-depth-out-duration",`${n}ms`),p.style.setProperty("--gate-content-delay",`${r}ms`),p.style.setProperty("--logo-opacity-inactive",l),p.style.setProperty("--logo-opacity-active-target",s),p.style.setProperty("--logo-opacity-active",l),p.style.setProperty("--logo-blur-inactive",`${c}px`),p.style.setProperty("--logo-blur-active-target",`${d}px`),p.style.setProperty("--logo-blur-active",`${c}px`),Wn(),Bn.style.setProperty("--gate-overlay-opacity",t),Bn.style.setProperty("--gate-overlay-transition-duration",`${a}ms`),Bn.style.setProperty("--gate-overlay-transition-out-duration",`${n}ms`),Bn.classList.remove("active"),Bn.setAttribute("aria-hidden","true"),Bn.addEventListener("click",Kn),window.addEventListener("resize",Wn),document.addEventListener("layout-updated",Wn);const u=_n()/2;console.log(`Gate Overlay: Initialized (opacity: ${t}, blur: ${u}px [auto from wall thickness], transition: ${a}ms, logo: opacity ${l}→${s}, blur ${c}px→${d}px)`)}function Kn(e){if(e.target.closest("button"))return;if(e.target.closest("input"))return;if(e.target.closest("a"))return;if(e.target.closest("select"))return;if(e.target.closest("textarea"))return;const t="cv-gate"===e.target.id||"portfolio-gate"===e.target.id||"contact-gate"===e.target.id||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description");(e.target===Bn||t)&&document.dispatchEvent(new CustomEvent("gate-overlay-dismiss",{detail:{instant:!0}}))}function Nn(e){const t=document.documentElement,a=document.getElementById("brand-logo");if(e){const e=getComputedStyle(t).getPropertyValue("--gate-depth-scale").trim()||"0.96",n=getComputedStyle(t).getPropertyValue("--gate-depth-translate-y").trim()||"8px",r=getComputedStyle(t).getPropertyValue("--logo-opacity-active-target").trim()||t.style.getPropertyValue("--logo-opacity-active-target")||"0.2",i=getComputedStyle(t).getPropertyValue("--logo-blur-active-target").trim()||t.style.getPropertyValue("--logo-blur-active-target")||"12px";t.style.setProperty("--gate-depth-scale-active",e),t.style.setProperty("--gate-depth-ty-active",n),t.style.setProperty("--logo-opacity-active",r),t.style.setProperty("--logo-blur-active",i),a&&a.classList.add("gate-depth-active")}else{const e=getComputedStyle(t).getPropertyValue("--logo-opacity-inactive").trim()||"1",n=getComputedStyle(t).getPropertyValue("--logo-blur-inactive").trim()||"0px";t.style.setProperty("--gate-depth-scale-active","1"),t.style.setProperty("--gate-depth-ty-active","0px"),t.style.setProperty("--logo-opacity-active",e),t.style.setProperty("--logo-blur-active",n),a&&a.classList.remove("gate-depth-active")}}function Gn(){if(!Bn||!Vn)return;Wn(),Bn.setAttribute("aria-hidden","false"),Bn.offsetWidth,Bn.classList.add("active");const e=document.getElementById("custom-cursor");e&&(e.classList.add("gate-active"),e.style.display="block"),Nn(!0)}function $n(){if(!Bn||!Vn)return;Bn.classList.remove("active"),Bn.setAttribute("aria-hidden","true");const e=document.getElementById("custom-cursor");e&&e.classList.remove("gate-active"),Nn(!1)}function qn(){return!!Bn&&Bn.classList.contains("active")}var Hn=Object.freeze({__proto__:null,hideOverlay:$n,initGateOverlay:zn,isOverlayActive:qn,showOverlay:Gn,updateGateContentDelay:function(e){document.documentElement.style.setProperty("--gate-content-delay",`${e}ms`)},updateGateDepthScale:function(e){document.documentElement.style.setProperty("--gate-depth-scale",e)},updateGateDepthTranslateY:function(e){document.documentElement.style.setProperty("--gate-depth-translate-y",`${e}px`)},updateLogoBlurActive:function(e){const t=document.documentElement;t.style.setProperty("--logo-blur-active-target",`${e}px`),qn()&&t.style.setProperty("--logo-blur-active",`${e}px`)},updateLogoBlurInactive:function(e){const t=document.documentElement;t.style.setProperty("--logo-blur-inactive",`${e}px`),qn()||t.style.setProperty("--logo-blur-active",`${e}px`)},updateLogoOpacityActive:function(e){const t=document.documentElement,a=e;t.style.setProperty("--logo-opacity-active-target",a),qn()&&t.style.setProperty("--logo-opacity-active",a)},updateLogoOpacityInactive:function(e){const t=document.documentElement;t.style.setProperty("--logo-opacity-inactive",e),qn()||t.style.setProperty("--logo-opacity-active",e)},updateOverlayOpacity:function(e){Bn&&Bn.style.setProperty("--gate-overlay-opacity",e)},updateOverlayTransition:function(e){Bn&&(Bn.style.setProperty("--gate-overlay-transition-duration",`${e}ms`),document.documentElement.style.setProperty("--gate-depth-duration",`${e}ms`))},updateOverlayTransitionOut:function(e){Bn&&(Bn.style.setProperty("--gate-overlay-transition-out-duration",`${e}ms`),document.documentElement.style.setProperty("--gate-depth-out-duration",`${e}ms`))}});let Xn=0,Yn=0,Zn=0,Un=0,jn=0;function Jn(){const e=b().currentMode,t=a,n=t.indexOf(e),r=t[((n>=0?n:0)+1)%t.length];Promise.resolve().then(function(){return $t}).then(({setMode:e})=>{e(r)}),Promise.resolve().then(function(){return Qa}).then(({updateModeButtonsUI:e})=>{e(r)})}let Qn=0,er=0,tr=0,ar=0,nr=performance.now()/1e3,rr=0,ir=!0,or=null;const lr=1e3/60;let sr=[],cr=0;function dr(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.offsetWidth,e.classList.add(`page-flash--${t}`),setTimeout(()=>{e.classList.remove(`page-flash--${t}`)},"success"===t?600:300)}function pr(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.offsetWidth,e.classList.add(`page-flash--${t}`),setTimeout(()=>{e.classList.remove(`page-flash--${t}`)},"success"===t?600:300)}const ur="alexander@beck.fyi",mr='<i class="ti ti-volume-off" aria-hidden="true"></i>';let hr=null;async function gr(){Me().isUnlocked?fr(xe()):await ge()?fr(!0):(hr&&(hr.innerHTML=mr,hr.setAttribute("aria-label","Audio unavailable"),hr.title="Audio unavailable"),setTimeout(()=>{fr(!1)},2e3))}function fr(e){hr&&(hr.setAttribute("data-enabled",e?"true":"false"),hr.setAttribute("aria-pressed",e?"true":"false"),hr.setAttribute("aria-label",e?"Sound on":"Sound off"),hr.title=e?"Sound on":"Sound off",hr.innerHTML=e?'<i class="ti ti-volume-2" aria-hidden="true"></i>':mr)}const yr=new Map([["apple music",'<i class="ti ti-brand-apple" aria-hidden="true"></i>'],["instagram",'<i class="ti ti-brand-instagram" aria-hidden="true"></i>'],["linkedin",'<i class="ti ti-brand-linkedin" aria-hidden="true"></i>']]),vr="--abs-brand-logo-impact",br="--abs-brand-logo-squash",xr="--abs-brand-logo-impact-dur";let Mr=null,Sr=!1,wr=0,Pr=0;function Lr(e){const t=document.documentElement;void 0!==e.containerInnerShadowOpacity&&t.style.setProperty("--container-inner-shadow-opacity",String(e.containerInnerShadowOpacity)),void 0!==e.containerInnerShadowBlur&&t.style.setProperty("--container-inner-shadow-blur",`${e.containerInnerShadowBlur}px`),void 0!==e.containerInnerShadowSpread&&t.style.setProperty("--container-inner-shadow-spread",`${e.containerInnerShadowSpread}px`),void 0!==e.containerInnerShadowOffsetY&&t.style.setProperty("--container-inner-shadow-offset-y",`${e.containerInnerShadowOffsetY}px`),void 0!==e.noiseSizeBase&&t.style.setProperty("--noise-size-base",`${e.noiseSizeBase}px`),void 0!==e.noiseSizeTop&&t.style.setProperty("--noise-size-top",`${e.noiseSizeTop}px`),void 0!==e.noiseBackOpacity&&(t.style.setProperty("--noise-back-opacity",String(e.noiseBackOpacity)),t.style.setProperty("--noise-back-opacity-light",String(e.noiseBackOpacity))),void 0!==e.noiseFrontOpacity&&(t.style.setProperty("--noise-front-opacity",String(e.noiseFrontOpacity)),t.style.setProperty("--noise-front-opacity-light",String(e.noiseFrontOpacity))),void 0!==e.noiseBackOpacityDark&&t.style.setProperty("--noise-back-opacity-dark",String(e.noiseBackOpacityDark)),void 0!==e.noiseFrontOpacityDark&&t.style.setProperty("--noise-front-opacity-dark",String(e.noiseFrontOpacityDark))}return async function(){if(document.documentElement.classList.add("js-enabled"),da()?ha():function({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"]}={}){da()||ha({sentence:e,ascii:t,silence:!0})}(),da())try{const e=await Promise.resolve().then(function(){return Ua});e.setApplyVisualCSSVars?.(Lr)}catch(e){}try{da()&&ia.groupCollapsed("BouncyBalls bootstrap"),fa("bb:start"),ga("🚀 Initializing modular bouncy balls...");const e=await async function(){try{try{if("undefined"!=typeof window&&window.__RUNTIME_CONFIG__&&"object"==typeof window.__RUNTIME_CONFIG__)return window.__RUNTIME_CONFIG__}catch(e){}const e=["config/default-config.json","js/config.json","../public/js/config.json"];for(const t of e)try{const e=await fetch(t,{cache:"no-cache"});if(e.ok)return await e.json()}catch(e){}throw new Error("No config found")}catch(e){return console.warn("Config load failed, using defaults"),{gravityMultiplier:1.05,ballMass:91,maxBalls:300}}}();v(e),fa("bb:config"),ga("✓ Config loaded");try{const e=b();"undefined"!=typeof window&&(window.REST=e.REST,window.FRICTION=e.FRICTION,window.MAX_BALLS=e.maxBalls,window.repelRadius=e.repelRadius,window.repelPower=e.repelPower)}catch(e){}y(),ga("✓ Layout applied"),Lr(e),ga("✓ Visual effects configured"),function(){const e=document.querySelector(".noise");if(!e)return;const t=e.closest("#bravia-balls")||document.getElementById("bravia-balls")||e.parentElement||document.body,a=getComputedStyle(e),n=a.backgroundImage&&"none"!==a.backgroundImage?a.backgroundImage:null;if(!document.querySelector(".noise-2")){const e=document.createElement("div");e.className="noise-2",n&&(e.style.backgroundImage=n),t.appendChild(e),console.log("✓ Created .noise-2 element")}if(!document.querySelector(".noise-3")){const e=document.createElement("div");e.className="noise-3",n&&(e.style.backgroundImage=n),t.appendChild(e),console.log("✓ Created .noise-3 element")}}(),nt();const a=it(),n=ot(),i=document.getElementById("bravia-balls");if(!a||!n||!i)throw new Error("Missing DOM elements");try{a.setAttribute("role","application"),a.getAttribute("aria-label")||a.setAttribute("aria-label","Interactive bouncy balls physics simulation")}catch(e){}x(a,n,i),rt(),fa("bb:renderer"),ga("✓ Canvas initialized (container-relative sizing)"),b().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),function(){const e=b(),a=e.canvas;if(void 0===e.clickCycleEnabled&&(e.clickCycleEnabled=!1),!a)return void console.error("Canvas not available for pointer setup");const n=e.DPR;function i(e){return!(!e||!e.closest)&&Boolean(e.closest("#panelDock")||e.closest("#masterPanel")||e.closest("#dockToggle")||e.closest(".panel-dock")||e.closest(".panel"))}function o(e,t){const r=a.getBoundingClientRect();return{x:(e-r.left)*n,y:(t-r.top)*n,inBounds:e>=r.left&&e<=r.right&&t>=r.top&&t<=r.bottom}}function l(a,n,r,{isMouseLike:l}={isMouseLike:!0}){if(l?Dn(a,n):An(),e.currentMode!==t.ORBIT_3D&&e.currentMode!==t.ORBIT_3D_2&&i(r))return;if(qn())return;const s=o(a,n),c=performance.now(),d=c-Zn;if(d>0&&Zn>0){const e=s.x-Xn,t=s.y-Yn;Un=Math.sqrt(e*e+t*t)/d}e.mouseX=s.x,e.mouseY=s.y,e.mouseInCanvas=s.inBounds,"undefined"!=typeof window&&(window.mouseInCanvas=s.inBounds);const p=Math.hypot(s.x-(e.lastPointerMoveX??s.x),s.y-(e.lastPointerMoveY??s.y));if(p>.5&&(e.lastPointerMoveMs=c,e.lastPointerMoveX=s.x,e.lastPointerMoveY=s.y),l&&p>.5&&function(e,t,a,n){const r=b();if(!r?.mouseTrailEnabled)return;if(!n)return;if(jt())return;if(function(e){const t=Math.max(0,0|e);t<=0||qt===t&&Ht&&Xt&&Yt||(qt=t,Ht=new Float32Array(qt),Xt=new Float32Array(qt),Yt=new Float64Array(qt),Zt=0,Ut=0)}(Jt(0|(r.mouseTrailLength??18),4,96)),!qt)return;const i=r.DPR||1,o=Jt(Number(r.mouseTrailSize??1.3),.5,10)*i,l=Math.max(.35,.55*o),s=l*l;if(Ut>0){const n=(Zt-1+qt)%qt;if(function(e,t,a,n){const r=e-a,i=t-n;return r*r+i*i}(e,t,Ht[n],Xt[n])<s)return void(Yt[n]=a)}Ht[Zt]=e,Xt[Zt]=t,Yt[Zt]=a,Zt=(Zt+1)%qt,Ut<qt&&Ut++}(s.x,s.y,c,s.inBounds),e.currentMode===t.WATER&&s.inBounds&&Un>.3&&c-Qn>80){const e=Math.min(2*Un,3);$e(s.x,s.y,e),Qn=c}Xn=s.x,Yn=s.y,Zn=c}document.addEventListener("mousemove",e=>{window.PointerEvent||l(e.clientX,e.clientY,e.target,{isMouseLike:!0})},{passive:!0}),document.addEventListener("pointermove",e=>{const t="mouse"===e.pointerType||"pen"===e.pointerType;l(e.clientX,e.clientY,e.target,{isMouseLike:t})},{passive:!0}),document.addEventListener("click",t=>{i(t.target)||t.target.closest("a")||t.target.closest("button")||t.target.closest("input")||t.target.closest("select")||t.target.closest("textarea")||qn()||o(t.clientX,t.clientY).inBounds&&e.clickCycleEnabled&&Jn()}),document.addEventListener("touchmove",a=>{if(!qn()&&a.touches&&a.touches[0]){const n=o(a.touches[0].clientX,a.touches[0].clientY);e.mouseX=n.x,e.mouseY=n.y,e.mouseInCanvas=n.inBounds;const r=performance.now();Math.hypot(n.x-(e.lastPointerMoveX??n.x),n.y-(e.lastPointerMoveY??n.y))>.5&&(e.lastPointerMoveMs=r,e.lastPointerMoveX=n.x,e.lastPointerMoveY=n.y),e.currentMode===t.WATER&&n.inBounds&&r-Qn>80&&($e(n.x,n.y,2),Qn=r)}},{passive:!0}),document.addEventListener("touchstart",t=>{if(!i(t.target)&&!qn()&&(An(),!t.target.closest("a")&&!t.target.closest("button")&&!t.target.closest("input")&&!t.target.closest("select")&&!t.target.closest("textarea")&&t.touches&&t.touches[0])){if(!o(t.touches[0].clientX,t.touches[0].clientY).inBounds)return;const a=performance.now();a-jn<300&&e.clickCycleEnabled&&Jn(),jn=a}},{passive:!0}),document.addEventListener("mouseleave",()=>{e.mouseX=r.OFFSCREEN_MOUSE,e.mouseY=r.OFFSCREEN_MOUSE,e.mouseInCanvas=!1,Un=0,"undefined"!=typeof window&&(window.mouseInCanvas=!1),An()}),document.addEventListener("mouseenter",()=>{Rn()}),document.addEventListener("touchend",()=>{e.mouseX=r.OFFSCREEN_MOUSE,e.mouseY=r.OFFSCREEN_MOUSE,e.mouseInCanvas=!1},{passive:!0}),console.log("✓ Unified pointer system configured (document-level)"),e.__pointerReady=!0,"undefined"!=typeof window&&(window.__pointerReady=!0)}(),ga("✓ Pointer tracking configured"),Tn(),fa("bb:input"),ga("✓ Custom cursor initialized"),function(){if("undefined"==typeof window||"undefined"==typeof document)return;let e=null;try{e=b()}catch(e){}if(Mr=document.querySelector("#brand-logo")||null,Mr){if(Mr.style.setProperty(vr,"0"),Mr.style.setProperty(br,"0"),Mr.style.setProperty(xr,"100ms"),e){void 0!==e.brandLogoImpactMul&&Mr.style.setProperty("--abs-brand-logo-impact-mul",String(e.brandLogoImpactMul));const t=Number(e.brandLogoSquashMul);Number.isFinite(t)&&(Mr.style.setProperty("--abs-brand-logo-squash-x-mul",String(.009*t)),Mr.style.setProperty("--abs-brand-logo-squash-y-mul",String(.015*t))),void 0!==e.brandLogoTiltDeg&&Mr.style.setProperty("--abs-brand-logo-tilt-deg",String(e.brandLogoTiltDeg)),void 0!==e.brandLogoSkewDeg&&Mr.style.setProperty("--abs-brand-logo-skew-deg",String(e.brandLogoSkewDeg))}(function(){try{return Boolean(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)}catch(e){return!1}})()||(Sr=!0,window.addEventListener("bb:modeChanged",e=>{const t=e?.detail||{};!function(e=1){if(!Sr||!Mr)return;let t=null;try{t=b()}catch(e){}const a=Math.max(0,Math.min(1,Number(e)||0)),n=++wr;Pr&&(window.clearTimeout(Pr),Pr=0),Mr.style.setProperty(xr,"1ms"),Mr.style.setProperty(vr,"0"),Mr.style.setProperty(br,"0"),Mr.offsetWidth;const r=t?.brandLogoPressMs??75,i=t?.brandLogoHoldMs??55,o=t?.brandLogoReleaseMs??220,l=t?.brandLogoOvershoot??.22,s=t?.brandLogoAnticipation??0;s>0&&(Mr.style.setProperty(xr,"45ms"),Mr.style.setProperty(vr,String(-Math.min(.6,s)*a)),Mr.style.setProperty(br,"0")),window.requestAnimationFrame(()=>{Sr&&Mr&&n===wr&&(Mr.style.setProperty(xr,`${Math.round(r)}ms`),Mr.style.setProperty(vr,String(a)),Mr.style.setProperty(br,String(a)))}),Pr=window.setTimeout(()=>{Pr=0,Sr&&Mr&&n===wr&&(Mr.style.setProperty(xr,`${Math.round(o)}ms`),Mr.style.setProperty(vr,String(-Math.abs(Number(l)||0)*a)),Mr.style.setProperty(br,"0"),window.requestAnimationFrame(()=>{Sr&&Mr&&n===wr&&Mr.style.setProperty(vr,"0")}))},Math.max(0,Math.round(i)))}(t.prevMode&&t.mode&&t.prevMode!==t.mode?1:.75)},{passive:!0}))}}(),console.log("⚠️ localStorage is disabled - using defaults"),he();try{!function(e){const t=e&&"object"==typeof e?e:null;if(!t)return;if("string"==typeof t.soundPreset&&Pe(t.soundPreset),t.soundConfig&&"object"==typeof t.soundConfig)return void we(t.soundConfig);const a={};let n=!1;for(const[e,r]of Object.entries(t))e in H&&(a[e]=r,n=!0);n&&we(a)}(e)}catch(e){}if(ga("✓ Sound engine primed (awaiting user unlock)"),da())try{const e=await Promise.resolve().then(function(){return wn});e.createPanelDock?.();const t=await Promise.resolve().then(function(){return G});t.populateColorSelect?.()}catch(e){}fa("bb:ui"),ga(da()?"✓ Panel dock created (Sound + Controls)":"✓ UI initialized (panel disabled in production)"),Ta(),fa("bb:theme"),Pn||(Pn=!0,window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName))return;const t=e.key.toLowerCase();if("/"===t||"Slash"===e.code)return e.preventDefault(),void Sn();if("r"!==t)return"ArrowRight"===e.key?(e.preventDefault(),void Ln(1)):"ArrowLeft"===e.key?(e.preventDefault(),void Ln(-1)):void 0;e.preventDefault(),zt();try{Ja(b().currentMode)}catch(e){}})),ga("✓ Keyboard shortcuts registered"),zn(e),ga("✓ Gate overlay system initialized"),function(){const e=document.getElementById("cv-gate-trigger"),t=document.getElementById("brand-logo"),a=document.getElementById("cv-gate"),n=document.getElementById("portfolio-gate"),r=document.getElementById("contact-gate"),i=Array.from(document.querySelectorAll(".cv-digit")),o=document.getElementById("page-flash"),l=document.getElementById("cv-gate-label");if(!e||!t||!a||0===i.length)return void console.warn("CV Gate: Missing required elements");l&&(l.innerHTML='\n            <div class="gate-nav">\n                <button type="button" class="gate-back" data-gate-back aria-label="Back">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>BACK</span>\n                </button>\n            </div>\n            <h2 class="gate-title">Download Bio/CV</h2>\n            <p class="gate-description">Because spam bots don\'t deserve nice things—and neither do recruiters who don\'t read portfolios. This keeps my inbox slightly more civilized.</p>\n        ');const s=o||function(){const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e}();let c=!1;const d=()=>a&&a.classList.contains("active")||n&&n.classList.contains("active")||r&&r.classList.contains("active"),p=(e=!1)=>{c=!1,i.forEach(e=>e.value=""),e?(a.style.transition="none",t.style.transition="none",a.classList.remove("active"),a.setAttribute("aria-hidden","true"),a.classList.add("hidden"),t.classList.remove("fade-out-up"),d()||$n(),requestAnimationFrame(()=>{a.style.removeProperty("transition"),t.style.removeProperty("transition")})):(a.classList.remove("active"),a.setAttribute("aria-hidden","true"),t.classList.remove("fade-out-up"),setTimeout(()=>{c||a.classList.add("hidden"),d()||$n()},400))};try{const e=l?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",p)}catch(e){}a.addEventListener("click",e=>{(e.target===a||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&p(!0)});const u=()=>{const e=i.map(e=>e.value).join("");4===e.length&&("1111"===e?(dr(s,"success"),setTimeout(()=>{window.location.href="cv.html"},500)):(dr(s,"error"),setTimeout(()=>{i.forEach(e=>e.value=""),i[0].focus()},350)))};e.addEventListener("click",e=>{e.preventDefault();const o=d();n&&n.classList.contains("active")&&(n.classList.remove("active"),n.setAttribute("aria-hidden","true"),setTimeout(()=>{n.classList.add("hidden")},400)),r&&r.classList.contains("active")&&(r.classList.remove("active"),r.setAttribute("aria-hidden","true"),setTimeout(()=>{r.classList.add("hidden")},400)),c=!0,o||Gn(),t.classList.add("fade-out-up"),a.classList.remove("hidden"),a.setAttribute("aria-hidden","false"),a.offsetWidth,a.classList.add("active"),i[0].focus()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&c&&p()}),document.addEventListener("gate-overlay-dismiss",e=>{if(c){const t=e.detail?.instant||!1;p(t)}}),i.forEach((e,t)=>{e.addEventListener("keydown",a=>{"Backspace"===a.key&&""===e.value&&(t>0?i[t-1].focus():p())}),e.addEventListener("input",e=>{const a=e.target.value;if(/^\d*$/.test(a)){if(1===a.length)t<i.length-1?i[t+1].focus():u();else if(a.length>1){const n=a.split("");e.target.value=n[0];let r=t+1;for(let e=1;e<n.length&&r<i.length;e++)i[r].value=n[e],r++;r<i.length?i[r].focus():u()}}else e.target.value=a.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})}(),ga("✓ CV password gate initialized"),function(){const e=document.getElementById("portfolio-gate-trigger"),t=document.getElementById("brand-logo"),a=document.getElementById("portfolio-gate"),n=document.getElementById("cv-gate"),r=document.getElementById("contact-gate"),i=Array.from(document.querySelectorAll(".portfolio-digit")),o=document.getElementById("page-flash"),l=document.getElementById("portfolio-gate-label");if(!e||!t||!a||0===i.length)return void console.warn("Portfolio Gate: Missing required elements");l&&(l.innerHTML='\n            <div class="gate-nav">\n                <button type="button" class="gate-back" data-gate-back aria-label="Back">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>BACK</span>\n                </button>\n            </div>\n            <h2 class="gate-title">View Portfolio</h2>\n            <p class="gate-description">Good work deserves good context. This small step ensures you\'re here with intention, not just browsing. Quality takes time—yours and mine.</p>\n        ');const s=o||function(){const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e}();let c=!1;const d=()=>a&&a.classList.contains("active")||n&&n.classList.contains("active")||r&&r.classList.contains("active"),p=(e=!1)=>{c=!1,i.forEach(e=>e.value=""),e?(a.style.transition="none",t.style.transition="none",a.classList.remove("active"),a.setAttribute("aria-hidden","true"),a.classList.add("hidden"),t.classList.remove("fade-out-up"),d()||$n(),requestAnimationFrame(()=>{a.style.removeProperty("transition"),t.style.removeProperty("transition")})):(a.classList.remove("active"),a.setAttribute("aria-hidden","true"),t.classList.remove("fade-out-up"),setTimeout(()=>{c||a.classList.add("hidden"),d()||$n()},400))};try{const e=l?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",p)}catch(e){}a.addEventListener("click",e=>{(e.target===a||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&p(!0)});const u=()=>{const e=i.map(e=>e.value).join("");4===e.length&&("1234"===e?(pr(s,"success"),setTimeout(()=>{window.location.href="portfolio.html"},500)):(pr(s,"error"),setTimeout(()=>{i.forEach(e=>e.value=""),i[0].focus()},350)))};e.addEventListener("click",e=>{e.preventDefault();const o=d();n&&n.classList.contains("active")&&(n.classList.remove("active"),n.setAttribute("aria-hidden","true"),setTimeout(()=>{n.classList.add("hidden")},400)),r&&r.classList.contains("active")&&(r.classList.remove("active"),r.setAttribute("aria-hidden","true"),setTimeout(()=>{r.classList.add("hidden")},400)),c=!0,o||Gn(),t.classList.add("fade-out-up"),a.classList.remove("hidden"),a.setAttribute("aria-hidden","false"),a.offsetWidth,a.classList.add("active"),i[0].focus()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&c&&p()}),document.addEventListener("gate-overlay-dismiss",e=>{if(c){const t=e.detail?.instant||!1;p(t)}}),i.forEach((e,t)=>{e.addEventListener("keydown",a=>{"Backspace"===a.key&&""===e.value&&(t>0?i[t-1].focus():p())}),e.addEventListener("input",e=>{const a=e.target.value;if(/^\d*$/.test(a)){if(1===a.length)t<i.length-1?i[t+1].focus():u();else if(a.length>1){const n=a.split("");e.target.value=n[0];let r=t+1;for(let e=1;e<n.length&&r<i.length;e++)i[r].value=n[e],r++;r<i.length?i[r].focus():u()}}else e.target.value=a.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})}(),ga("✓ Portfolio password gate initialized"),function(){const e=[document.getElementById("contact-email"),document.getElementById("contact-email-inline")].filter(Boolean),t=document.getElementById("brand-logo"),a=document.getElementById("contact-gate"),n=document.getElementById("contact-gate-label"),r=document.getElementById("contact-gate-inputs"),i=document.getElementById("cv-gate"),o=document.getElementById("portfolio-gate");if(!(e.length&&t&&a&&n&&r))return void console.warn("Contact Gate: Missing required elements");n.innerHTML='\n    <div class="gate-nav">\n      <button type="button" class="gate-back" data-gate-back aria-label="Back">\n        <i class="ti ti-arrow-left" aria-hidden="true"></i>\n        <span>BACK</span>\n      </button>\n    </div>\n    <h2 class="gate-title">Get in touch</h2>\n    <p class="gate-description">\n      For collaborations, product design work, AI prototyping, or anything that needs a crisp creative + technical brain.\n    </p>\n  ',r.innerHTML=`\n    <div class="contact-email-row" data-email-row>\n      <button type="button" class="contact-email-value" data-copy-email aria-label="Copy email address">\n        <span class="contact-email-text">${ur}</span>\n      </button>\n      <button type="button" class="contact-email-copy" data-copy-email-icon aria-label="Copy email address">\n        <i class="ti ti-copy" aria-hidden="true"></i>\n      </button>\n    </div>\n    <div class="contact-copy-status" data-copy-status aria-live="polite"></div>\n  `;const l=n.querySelector("[data-gate-back]"),s=r.querySelector("[data-copy-email]"),c=r.querySelector("[data-copy-email-icon]"),d=r.querySelector("[data-email-row]"),p=r.querySelector("[data-copy-status]"),u=r.querySelector(".contact-email-copy i");let m=!1,h=null;const g=()=>a&&a.classList.contains("active")||i&&i.classList.contains("active")||o&&o.classList.contains("active"),f=e=>{if(s&&c&&p){if(h&&window.clearTimeout(h),"copied"===e)return d?.classList?.add?.("is-copied"),d?.classList?.remove?.("is-error"),p.textContent="Copied",u&&(u.className="ti ti-check"),void(h=window.setTimeout(()=>f("idle"),1200));if("error"===e)return d?.classList?.add?.("is-error"),d?.classList?.remove?.("is-copied"),p.textContent="Copy failed",u&&(u.className="ti ti-alert-triangle"),void(h=window.setTimeout(()=>f("idle"),1200));d?.classList?.remove?.("is-copied","is-error"),p.textContent="",u&&(u.className="ti ti-copy")}},y=e=>{e?.preventDefault?.();const n=g();i&&i.classList.contains("active")&&(i.classList.remove("active"),i.setAttribute("aria-hidden","true"),setTimeout(()=>i.classList.add("hidden"),400)),o&&o.classList.contains("active")&&(o.classList.remove("active"),o.setAttribute("aria-hidden","true"),setTimeout(()=>o.classList.add("hidden"),400)),m=!0,n||Gn(),f("idle"),t.classList.add("fade-out-up"),a.classList.remove("hidden"),a.setAttribute("aria-hidden","false"),a.offsetWidth,a.classList.add("active"),s?.focus?.()},v=(e=!1)=>{m=!1,f("idle"),e?(a.style.transition="none",t.style.transition="none",a.classList.remove("active"),a.setAttribute("aria-hidden","true"),a.classList.add("hidden"),t.classList.remove("fade-out-up"),g()||$n(),requestAnimationFrame(()=>{a.style.removeProperty("transition"),t.style.removeProperty("transition")})):(a.classList.remove("active"),a.setAttribute("aria-hidden","true"),t.classList.remove("fade-out-up"),setTimeout(()=>{m||a.classList.add("hidden"),g()||$n()},400))};e.forEach(e=>e.addEventListener("click",y,{capture:!0})),l?.addEventListener("click",v),a.addEventListener("click",e=>{(e.target===a||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&v(!0)});const b=async e=>{const t=await async function(e){try{if(navigator?.clipboard?.writeText)return await navigator.clipboard.writeText(e),!0}catch(e){}try{const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly","true"),t.style.position="fixed",t.style.left="-9999px",t.style.top="0",document.body.appendChild(t),t.select();const a=!0===document.execCommand?.("copy");return document.body.removeChild(t),a}catch(e){return!1}}(ur);f(t?"copied":"error")};s?.addEventListener("click",b),c?.addEventListener("click",b),document.addEventListener("keydown",e=>{"Escape"===e.key&&m&&v()}),document.addEventListener("gate-overlay-dismiss",e=>{if(m){const t=e.detail?.instant||!1;v(t)}})}(),ga("✓ Contact gate initialized"),function(){const e=document.getElementById("social-links");if(!e)return;if(e.querySelector("i.ti"))return;const t=Array.from(e.querySelectorAll("a.footer_icon-link[aria-label]"));for(const e of t){const t=(e.getAttribute("aria-label")||"").trim().toLowerCase(),a=yr.get(t);if(!a)continue;const n=e.querySelector("svg");n?(e.insertAdjacentHTML("afterbegin",a),n.remove()):e.insertAdjacentHTML("afterbegin",a)}}(),function(){const e=document.getElementById("time-display");if(!e)return;const t=new Intl.DateTimeFormat("en-GB",{timeZone:"Europe/London",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});function a(){const a=new Date;e.textContent=t.format(a).toUpperCase()}a(),setInterval(a,1e3)}(),function(){try{const e=document.getElementById("cv-gate-trigger");e&&!e.querySelector(".footer-link-nowrap")&&"download bio/cv"===(e.textContent||"").trim().replace(/\s+/g," ").toLowerCase()&&(e.innerHTML='Download <span class="footer-link-nowrap">Bio/CV</span>')}catch(e){}}(),function(){if(he(),"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return console.log("⏸ Sound toggle hidden (prefers-reduced-motion)"),null;hr=document.createElement("button"),hr.className="sound-toggle",hr.id="sound-toggle",hr.type="button",hr.setAttribute("aria-label","Toggle collision sounds"),hr.setAttribute("aria-pressed","false"),hr.setAttribute("data-enabled","false"),hr.innerHTML=mr,hr.title="Sound off",hr.addEventListener("click",gr);const e=document.getElementById("fade-content"),t=document.getElementById("sound-toggle-slot"),a=document.getElementById("top-elements-soundRow"),n=document.getElementById("social-links"),r=document.querySelector(".ui-meta-right"),i=!!t,o=n&&(!e||e.contains(n)),l="undefined"!=typeof window&&"function"==typeof window.matchMedia&&window.matchMedia("(max-width: 600px)").matches,s=e=>{if(!e)return!1;try{hr.parentElement&&hr.parentElement!==e&&hr.parentElement.removeChild(hr)}catch(e){}if(e.classList.contains("ui-meta-right")){const t=e.querySelector("time");if(t)return e.insertBefore(hr,t),!0}return e.appendChild(hr),!0};if(l&&a)hr.classList.add("sound-toggle--top"),hr.classList.add("sound-toggle--topwide"),s(a);else if(i)hr.classList.add("sound-toggle--top"),s(t);else if(r)s(r);else if(o){const e=document.createElement("li");e.className="margin-bottom_none sound-toggle-item",hr.classList.add("sound-toggle--social"),e.appendChild(hr),n.appendChild(e)}else e?e.appendChild(hr):document.body.appendChild(hr);try{if("undefined"!=typeof window&&"function"==typeof window.matchMedia){const e=window.matchMedia("(max-width: 600px)"),t=()=>{const t=document.getElementById("top-elements-soundRow"),a=document.getElementById("sound-toggle-slot"),n=e.matches&&!!t;hr.classList.toggle("sound-toggle--topwide",n),n?s(t):a&&s(a)};"function"==typeof e.addEventListener?e.addEventListener("change",t):"function"==typeof e.addListener&&e.addListener(t)}}catch(e){}console.log("✓ Sound toggle created");try{const e=Me();fr(!(!e.isUnlocked||!e.isEnabled))}catch(e){}"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(ie,e=>{const t=e&&e.detail?e.detail:null;t&&fr(!(!t.isUnlocked||!t.isEnabled))})}(),ga("✓ Sound toggle button created"),ga("✓ Theme toggle button created");const o=t.PIT;V?.("startup"),Wt(o);try{const e=await Promise.resolve().then(function(){return Qa});e.updateModeButtonsUI?.(o)}catch(e){}fa("bb:mode"),ga("✓ Mode initialized");const l=()=>Kt();(function(e){function a(n){if(!ir)return void(or=null);const r=n-rr;if(r<lr)return void(or=requestAnimationFrame(a));rr=n-r%lr,function(e){if(sr.push(e),sr.length>30&&sr.shift(),30===sr.length){const e=1e3/(sr.reduce((e,t)=>e+t,0)/30);e<30&&cr<2?(cr++,console.log(`⚡ Adaptive throttle increased to level ${cr} (avg FPS: ${e.toFixed(1)})`)):e>55&&cr>0&&(cr--,console.log(`⚡ Adaptive throttle decreased to level ${cr} (avg FPS: ${e.toFixed(1)})`))}}(r);const i=n/1e3;let o=Math.min(.033,i-nr);nr=i,(cr<2||Math.random()>.5)&&async function(e,t){const a=b(),n=a.canvas,r=a.balls;if(!n)return;if(!r||0===r.length)return;const i=Math.max(0,Math.round(a.warmupFramesRemaining||0));if(i>0){a.warmupFramesRemaining=0,ea=0;for(let e=0;e<i;e++)ra(aa,t)}else ra(e,t)}(o,e),function(){const e=b(),a=e.ctx,n=e.balls,r=e.canvas;if(!a||!r)return;if(e.ghostLayerEnabled){const t=e.ghostLayerUsePerThemeOpacity?e.isDarkMode?e.ghostLayerOpacityDark:e.ghostLayerOpacityLight:e.ghostLayerOpacity;t>=1?a.clearRect(0,0,r.width,r.height):t>0&&(a.save(),a.globalCompositeOperation="destination-out",a.globalAlpha=t,a.fillRect(0,0,r.width,r.height),a.restore())}else a.clearRect(0,0,r.width,r.height);e.currentMode;const i=Gt();if(i&&i.preRender&&i.preRender(a),e.currentMode===t.KALEIDOSCOPE||e.currentMode===t.KALEIDOSCOPE_1||e.currentMode===t.KALEIDOSCOPE_2||e.currentMode===t.KALEIDOSCOPE_3)!function(e){const t=b();if(!Lt(t.currentMode))return;const a=t.canvas;if(!a)return;const n=function(){const e=performance.now(),t=yt||e;return yt=e,vt((e-t)/1e3,0,.05)}(),r=t.balls,i=a.width,o=a.height,l=bt(t),s=wt(t).wedges??12,c=vt(Math.round(s),3,24),d=Boolean(t.kaleidoscopeMirror??!0),p=function(e){return.5*e.width}(a),u=function(e){return.5*e.height}(a),m=gt/c,h=Math.max(1e-5,1e-4*m),g=t.mouseInCanvas?t.mouseX:p,f=t.mouseInCanvas?t.mouseY:u,y=g-p,v=f-u,x=Math.atan2(v,y),M=vt(Math.hypot(y,v)/Math.max(1,.5*Math.min(i,o)),0,1);t._kaleiMorph||(t._kaleiMorph={phase:{x:0,v:0},panX:{x:0,v:0},panY:{x:0,v:0},lastMouseX:g,lastMouseY:f,lastInCanvas:Boolean(t.mouseInCanvas)});const S=t._kaleiMorph,w=Boolean(t.mouseInCanvas),P=Math.hypot(g-S.lastMouseX,f-S.lastMouseY)>.5||w!==S.lastInCanvas,L=vt(wt(t).speed??1,.2,2),C=Ct(t),E=.65*L*C,F=y*E*(t.mouseInCanvas?1:0),I=v*E*(t.mouseInCanvas?1:0),T=x*(.7*C)*(t.mouseInCanvas?1:0);P?(S.lastMouseX=g,S.lastMouseY=f,S.lastInCanvas=w,Mt(S.phase,T,n,4.5),Mt(S.panX,F,n,5),Mt(S.panY,I,n,5)):(S.phase.v=0,S.panX.v=0,S.panY.v=0);const k=S.phase.x,D=S.panX.x,A=S.panY.x,R=.22+.18*vt((L-.2)/1.8,0,1),O=1-R+2*R*(1-M);for(let t=0;t<r.length;t++){const a=r[t],n=a.x-p+D,i=a.y-u+A,o=3.5*l,s=Math.hypot(n,i)*o*O;if(s<ft)continue;const g=d?2*m:m;let f=Math.atan2(i,n)+k;f=(f%g+g)%g,d&&f>m&&(f=g-f),f=vt(f,h,m-h);for(let t=0;t<c;t++){const n=t*m+f,r=p+Math.cos(n)*s,i=u+Math.sin(n)*s;a.alpha<1&&(e.globalAlpha=a.alpha),e.fillStyle=a.color,e.beginPath(),e.arc(r,i,a.r,0,gt),e.fill(),a.alpha<1&&(e.globalAlpha=1)}}}(a);else for(let e=0;e<n.length;e++)n[e].draw(a);i&&i.postRender&&i.postRender(a),function(e){const t=b();if(!t?.mouseTrailEnabled)return;if(jt())return;if(!e||!Ut||!qt)return;const a=performance.now(),n=Jt(Number(t.mouseTrailFadeMs??220),40,2e3),r=Jt(Number(t.mouseTrailOpacity??.35),0,1);if(r<=0)return;const i=t.DPR||1,o=Jt(Number(t.mouseTrailSize??1.3),.5,10)*i;for(;Ut>0&&!(a-Yt[(Zt-Ut+qt)%qt]<=n);)Ut--;if(!Ut)return;if(Ut<2)return;const l=function(){const e=b();return e&&"string"==typeof e.cursorColorHex&&e.cursorColorHex?e.cursorColorHex:"#000000"}(),s=e.globalAlpha,c=e.globalCompositeOperation,d=e.lineCap,p=e.lineJoin,u=e.strokeStyle,m=e.lineWidth;e.globalCompositeOperation="source-over",e.lineCap="round",e.lineJoin="round",e.strokeStyle=l,e.lineWidth=o,e.globalAlpha=r;const h=Ut,g=(Zt-h+qt)%qt;e.beginPath();const f=Ht[g],y=Xt[g];if(e.moveTo(f,y),2===h){const t=Ht[(g+1)%qt],a=Xt[(g+1)%qt];e.lineTo(t,a)}else{for(let t=1;t<h-1;t++){const a=(g+t)%qt,n=(g+t+1)%qt,r=Ht[a],i=Xt[a],o=.5*(r+Ht[n]),l=.5*(i+Xt[n]);e.quadraticCurveTo(r,i,o,l)}const t=(g+h-1)%qt;e.lineTo(Ht[t],Xt[t])}e.stroke(),e.globalAlpha=s,e.globalCompositeOperation=c,e.lineCap=d,e.lineJoin=p,e.strokeStyle=u,e.lineWidth=m}(a),function(e,t,a){const n=b(),r=function(){try{return getComputedStyle(document.documentElement).getPropertyValue("--wall-color").trim()||"#0a0a0a"}catch{return"#0a0a0a"}}(),i=(n.wallThickness||12)*(n.DPR||1);if(e.save(),e.fillStyle=r,ke.bottom.hasDeformation()){e.beginPath(),e.moveTo(0,a+i);for(let n=0;n<=Ie;n++){const r=n/Ie,i=r*t,o=ke.bottom.getDeformAt(r);e.lineTo(i,a-o)}e.lineTo(t,a+i),e.closePath(),e.fill()}if(ke.top.hasDeformation()){e.beginPath(),e.moveTo(0,-i);for(let a=0;a<=Ie;a++){const n=a/Ie,r=n*t,i=ke.top.getDeformAt(n);e.lineTo(r,i)}e.lineTo(t,-i),e.closePath(),e.fill()}if(ke.left.hasDeformation()){e.beginPath(),e.moveTo(-i,0);for(let t=0;t<=Ie;t++){const n=t/Ie,r=n*a,i=ke.left.getDeformAt(n);e.lineTo(i,r)}e.lineTo(-i,a),e.closePath(),e.fill()}if(ke.right.hasDeformation()){e.beginPath(),e.moveTo(t+i,0);for(let n=0;n<=Ie;n++){const r=n/Ie,i=r*a,o=ke.right.getDeformAt(r);e.lineTo(t-o,i)}e.lineTo(t+i,a),e.closePath(),e.fill()}e.restore()}(a,r.width,r.height)}(),function(e){if(tr++,e-er>1e3){ar=tr,tr=0,er=e;const t=document.getElementById("render-fps");t&&(t.textContent=String(ar))}}(performance.now()),or=requestAnimationFrame(a)}document.addEventListener("visibilitychange",()=>{ir=!document.hidden,ir?(nr=performance.now()/1e3,rr=performance.now(),console.log("▶️ Animation resumed"),or||(or=requestAnimationFrame(a))):(console.log("⏸️ Animation paused (tab hidden)"),or&&(cancelAnimationFrame(or),or=null))}),or=requestAnimationFrame(a),console.log("✓ Render loop started (60fps throttle, visibility-aware)")})((e,t)=>{const a=l();a&&a(e,t)}),fa("bb:end"),ga("✅ Bouncy Balls running (modular)");const s=[{phase:"config",ms:ya("bb:m:config","bb:start","bb:config")},{phase:"renderer",ms:ya("bb:m:renderer","bb:config","bb:renderer")},{phase:"input",ms:ya("bb:m:input","bb:renderer","bb:input")},{phase:"ui",ms:ya("bb:m:ui","bb:input","bb:ui")},{phase:"theme",ms:ya("bb:m:theme","bb:ui","bb:theme")},{phase:"mode+loop",ms:ya("bb:m:mode","bb:theme","bb:mode")},{phase:"total",ms:ya("bb:m:total","bb:start","bb:end")}].filter(e=>"number"==typeof e.ms);s.length&&function(e){if(da())try{ia.table(e)}catch(e){}}(s.map(e=>({...e,ms:Number(e.ms.toFixed(2))}))),da()&&ia.groupEnd();const c=400,d=3e3,p="cubic-bezier(0.16, 1, 0.3, 1)",u=c+d+750,m=(e,t)=>{e.style.opacity="1",console.warn(`⚠️ Fade failsafe: forcing #fade-content visible (${t})`)};setTimeout(()=>{const e=document.getElementById("fade-content");if(!e)return void console.warn("⚠️ #fade-content not found (fade skipped)");if(window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches)return e&&(e.style.opacity="1"),void console.log("✓ Page fade-in skipped (prefers-reduced-motion)");if(e&&"function"!=typeof e.animate)return void m(e,"WAAPI unsupported");const t=(e=>e&&"function"==typeof e.animate?e.animate([{opacity:0},{opacity:1}],{duration:d,easing:p,fill:"forwards"}):null)(e);t?.addEventListener?.("finish",()=>{e&&(e.style.opacity="1"),console.log("✓ Page fade-in finished")}),t?.addEventListener?.("cancel",()=>{e&&m(e,"animation canceled")}),console.log("✓ Page fade-in started (WAAPI)"),setTimeout(()=>{e&&"0"===window.getComputedStyle(e).opacity&&m(e,"opacity still 0 after failsafe window")},u)},c)}catch(e){console.error("❌ Initialization failed:",e),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${e.message}\n${e.stack}</pre>\n    </div>`}}(),e.applyFramePaddingCSSVars=function(){y()},e.applyVisualCSSVars=Lr,e}({});
