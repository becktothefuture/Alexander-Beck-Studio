(()=>{const t="pit",e="flies",n="trail",i="weightless",o="boulders",a={[t]:{desktop:!0,mobile:!0},[e]:{desktop:!0,mobile:!0},[n]:{desktop:!0,mobile:!1},[i]:{desktop:!0,mobile:!0},[o]:{desktop:!0,mobile:!0}};let l=t,s=40,r=1.1,d=!0,h=1e3,c=150,u=1,m=8,f=2,g=150,p=30,y=.8,x=.3,v=[],M=400,E=.98,b=300,I=800,w=120,B=1,S=.3,C=1.2,V=.3,L=.95;const R=-1e9,F=1e-4,T=.25;function P(){return 0===s?0:s/40*.2}const q=document.getElementById("c"),A=q.getContext("2d",{alpha:!0}),k=document.getElementById("controlPanel"),z=Math.max(1,Math.min(2,window.devicePixelRatio||1));let N=50,U=-50,G=100,D=50;function O(){const t=1.5*window.innerHeight;q.width=Math.floor(window.innerWidth*z),q.height=Math.floor(t*z)}O(),window.addEventListener("resize",()=>{O(),dt(),ht()});const W=1960;let H=1.1,$=W*H,_=.88,Y=.003,j=.03,Z=400;const X=.5*z,J=6,K=24;let Q=1,tt=.15,et=1,nt=null,it=11.2;const ot=.15;let at=1;function lt(){at=Math.max(.5,Math.min(3,Math.pow(it/1,.35)))}lt();let st=J*Q,rt=K*Q;function dt(){et=(q.clientWidth||window.innerWidth)<=768?.4:1;const t=Q*et;if(null===nt)return nt=t,st=J*t,void(rt=K*t);const e=t/nt;if(1!==e){for(let t=0;t<_t.length;t++)l!==o&&(_t[t].r*=e);nt=t}st=J*t,rt=K*t}function ht(){At=[];const t=document.querySelector(qt);if(!t)return;const e=t.getBoundingClientRect(),n=q.getBoundingClientRect(),i=function(t){const e=document.createElement("span");e.style.cssText=window.getComputedStyle(t).cssText,e.style.position="absolute",e.style.visibility="hidden",e.style.whiteSpace="nowrap",e.textContent="ABCDEFGHIJKLMNOPQRSTUVWXYZ",document.body.appendChild(e);const n=e.getBoundingClientRect().height;return document.body.removeChild(e),n}(t),o=.5*(e.height-i),a={x:(e.left-n.left)*z,y:(e.top-n.top+o)*z,width:e.width*z,height:i*z};a.width>0&&a.height>0&&a.x<q.width&&a.y<q.height&&a.x+a.width>0&&a.y+a.height>0&&At.push(a)}let ct=!0,ut=0,mt=1;const ft={industrialTeal:{label:"Industrial Teal",colors:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"]},modern:{label:"Modern European",colors:["#9ca3af","#d1d5db","#ffffff","#ff3b30","#000000","#00e5ff","#1976d2","#ffc107"]},corporate:{label:"Corporate Modern",colors:["#a0a8b1","#d2d8de","#ffffff","#1a73e8","#000000","#ff5722","#7b1fa2","#ffa000"]},minimal:{label:"Helvetica Minimal",colors:["#bdbdbd","#e0e0e0","#ffffff","#6b7280","#000000","#40e0d0","#303f9f","#ff9800"]},euroBlue:{label:"European Blue",colors:["#9aa6b2","#d4dde5","#ffffff","#0a66c2","#000000","#ff4081","#388e3c","#ffb300"]},scandi:{label:"Scandinavian Bright",colors:["#aab2b7","#e6eaee","#ffffff","#74b9ff","#000000","#e91e63","#1976d2","#4caf50"]},neonCyan:{label:"Graphite Neon Cyan",colors:["#9aa0a6","#d5d9dd","#ffffff","#00e5ff","#000000","#ff9800","#9c27b0","#4caf50"]},coralTech:{label:"Coral Tech",colors:["#9da3a9","#d8dde2","#ffffff","#ff6b6b","#000000","#00e676","#3f51b5","#ff5722"]},violetMidnight:{label:"Violet Midnight",colors:["#9fa3b1","#d9dce3","#ffffff","#7c3aed","#000000","#e91e63","#388e3c","#ffb300"]},mintSage:{label:"Mint Sage",colors:["#a0a7a2","#dbe0dd","#ffffff","#00c896","#000000","#ff1744","#3f51b5","#ff9800"]},slateAzure:{label:"Slate Azure",colors:["#9aa3ad","#d8dee6","#ffffff","#3b82f6","#000000","#ff4081","#388e3c","#ffc107"]},vaporPop:{label:"Vapor Pop",colors:["#9ea0a8","#d6d7dc","#ffffff","#ff00e5","#000000","#00bcd4","#673ab7","#ff5722"]},cyberMagenta:{label:"Cyber Magenta",colors:["#9c9fad","#d6d9e3","#ffffff","#ff007a","#000000","#40e0d0","#1976d2","#ff9800"]},streetLime:{label:"Street Lime",colors:["#9aa19a","#d6dbd6","#ffffff","#baff00","#000000","#e91e63","#3f51b5","#ff6f00"]},cmykPop:{label:"CMYK Pop",colors:["#9f9f9f","#d9d9d9","#ffffff","#ffd400","#000000","#ff1744","#7b1fa2","#4caf50"]}};let gt="industrialTeal",pt=["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],yt=5,xt=pt[yt]||"#ff4013";function vt(t=pt){try{const e=document.documentElement,n=(t&&t.length?t:pt).slice(0,8);for(let t=0;t<8;t++){const i=n[t]||"#ffffff";e.style.setProperty(`--ball-${t+1}`,i)}}catch(t){}}const Mt=[.5,.25,.12,.06,.03,.02,.01,.01];function Et(){try{if(!pt||0===pt.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let e=0;for(let n=0;n<Math.min(pt.length,Mt.length);n++)if(e+=Mt[n],t<=e)return pt[n];return pt[Math.min(pt.length-1,7)]}catch(t){return console.error("Error picking random color:",t),"#ffffff"}}let bt=255,It=274e3,wt=4.4,Bt=R,St=R,Ct=!1,Vt=!1;("ontouchstart"in window||navigator.maxTouchPoints>0)&&(Vt=!0);const Lt="bouncyBallsSettings";function Rt(){const t={currentMode:l,gravityMultiplierPit:r,repellerEnabledPit:d,attractionPower:h,orbitRadius:c,swarmSpeed:u,sparkleEmissionRate:m,sparkleLifetime:f,sparkleVelocitySpread:g,sparkleDriftStrength:p,sparkleParticleScale:y,weightlessInitialSpeed:M,weightlessBounce:E,weightlessMaxBalls:b,weightlessRepellerPower:I,weightlessRepellerRadius:w,restitution:_,friction:Y,sizeScale:Q,sizeVariation:tt,ballMassKg:it,ballSoftness:s,repelPower:It,repelRadius:bt,repelSoft:wt,cornerRadius:Pt,motionBlur:kt,trailSubtlety:zt,currentTemplate:gt,cursorBallColor:xt};try{localStorage.setItem(Lt,JSON.stringify(t)),console.log("âœ“ Settings saved")}catch(t){console.warn("Could not save settings:",t)}}function Ft(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(Rt,500)}const Tt=1e3;let Pt=0;const qt="#hero-text";let At=[],kt=.025,zt=1.8,Nt=0,Ut=0,Gt=0,Dt=0,Ot=0;const Wt=document.getElementById("render-fps"),Ht=document.getElementById("physics-fps");class $t{constructor(t,e,n,i){this.x=t,this.y=e,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=n,this.rBase=n,this.m=it,this.color=i,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1}step(o){this.t+=o,this.age+=o,this.vy+=$*at*o;const a=Math.max(.25,this.m/1),s=Math.max(0,1-Y/a);this.vx*=s,this.vy*=s,0!==this.driftAx&&this.age<this.driftTime?this.vx+=this.driftAx*o/a:0!==this.driftAx&&(this.driftAx=0),function(o,a){l!==t?l!==e?l!==n?l===i&&function(t,e){if(Bt===R||St===R)return;if(I<=0||w<=0)return;const n=w*z,i=t.x-Bt,o=t.y-St,a=i*i+o*o;if(a>n*n)return;const l=Math.max(Math.sqrt(a),F),s=i/l,r=o/l,d=Math.max(0,1-l/n),h=I*d;t.vx+=s*h*e,t.vy+=r*h*e}(o,a):function(t,e){p>0&&(t.vx+=(Math.random()-.5)*p*e,t.vy+=(Math.random()-.5)*p*e),t.vx*=.98,t.vy*=.98;const n=(performance.now()/1e3-t.spawnTime)/t.lifetime,i=Math.max(0,1-n);t.r=t.rBase*i*y}(o,a):function(t,e){if(Bt===R||St===R)return;const n=Bt-t.x,i=St-t.y,o=n*n+i*i,a=Math.sqrt(o+1),l=n/a,s=i/a,r=4*h;t.vx+=l*r*e,t.vy+=s*r*e;const d=80*z;let c=0,m=0,f=0;for(let e=0;e<_t.length;e++){const n=_t[e];if(n===t)continue;const i=t.x-n.x,o=t.y-n.y,a=i*i+o*o;if(a<d*d&&a>0){const t=Math.sqrt(a),e=1-t/d;c+=i/t*e,m+=o/t*e,f++}}if(f>0){const n=15e3;t.vx+=c/f*n*e,t.vy+=m/f*n*e}if(Math.random()<.05){const e=Math.random()*Math.PI*2,n=800;t.vx+=Math.cos(e)*n,t.vy+=Math.sin(e)*n}t.vx+=1200*(Math.random()-.5)*e,t.vy+=1200*(Math.random()-.5)*e;const g=.5+1.5*Math.random(),p=1200*u*g*e;t.vx+=-s*p,t.vy+=l*p;const y=1400,x=Math.sqrt(t.vx*t.vx+t.vy*t.vy);x>y&&(t.vx=t.vx/x*y,t.vy=t.vy/x*y),t.vx*=.99,t.vy*=.99}(o,a):function(t,e){if(!Ct)return;if(It<=0||bt<=0)return;const n=bt*z,i=t.x-Bt,o=t.y-St,a=i*i+o*o;if(a>n*n)return;const l=Math.max(Math.sqrt(a),F),s=i/l,r=o/l,d=Math.max(0,1-l/n),h=20*It*Math.pow(d,wt),c=Math.max(.25,t.m/1);t.vx+=s*h*e/c,t.vy+=r*h*e/c;t.vx+=10*(Math.random()-.5)*e,t.vy+=10*(Math.random()-.5)*e}(o,a)}(this,o),this.x+=this.vx*o,this.y+=this.vy*o;const r=Math.max(0,1-2*o);this.omega*=r,this.theta+=this.omega*o,this.theta>Math.PI?this.theta-=2*Math.PI:this.theta<-Math.PI&&(this.theta+=2*Math.PI);const d=Math.min(1,18*o);this.squashAmount+=(0-this.squashAmount)*d,this.squash=1-this.squashAmount}walls(t,e,n,i=_){const o=i;if(0===Pt){if(this.y+this.r>e){this.y=e-this.r;const t=this.vy,i=this.vx-this.omega*this.r,a=Math.max(.25,this.m/1);this.omega+=i/this.r*T/a;const l=Math.max(0,1-1.5*n/a);this.vx*=l;const s=Math.abs(t)<70?0:o;this.vy=-this.vy*(s*Math.pow(1/this.m,ot));const r=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(P(),.8*r),this.squash=1-this.squashAmount,this.squashNormalAngle=-Math.PI/2;const d=this.vx/this.r;this.omega+=(d-this.omega)*Math.min(1,8*n)}const i=e/3;if(this.y-this.r<i){this.y=i+this.r;const t=this.vy;this.vy=-this.vy*o;const e=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(P(),.8*e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI/2}if(this.x+this.r>t){this.x=t-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*o;const e=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(P(),.8*e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*o;const t=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(P(),.8*t),this.squash=1-this.squashAmount,this.squashNormalAngle=0}}else this.handleRoundedWallCollision(t,e);this.checkTextCollisions(n)}checkTextCollisions(t){for(let t=0;t<At.length;t++){const e=At[t],n=Math.max(e.x,Math.min(this.x,e.x+e.width)),i=Math.max(e.y,Math.min(this.y,e.y+e.height)),o=this.x-n,a=this.y-i,l=Math.sqrt(o*o+a*a);if(l<this.r)if(0===l){const t=this.x-e.x,n=e.x+e.width-this.x,i=this.y-e.y,o=e.y+e.height-this.y,a=Math.min(t,n,i,o);a===t?(this.x=e.x-this.r,this.vx=-Math.abs(this.vx)*_):a===n?(this.x=e.x+e.width+this.r,this.vx=Math.abs(this.vx)*_):a===i?(this.y=e.y-this.r,this.vy=-Math.abs(this.vy)*_):(this.y=e.y+e.height+this.r,this.vy=Math.abs(this.vy)*_)}else{const t=this.r-l,e=o/l,n=a/l;this.x+=e*t,this.y+=n*t;const i=this.vx*e+this.vy*n;if(i<0){this.vx-=2*i*e*_,this.vy-=2*i*n*_;const t=Math.min(1,Math.abs(i)/(70*this.r));this.squash=1-P()*t,this.squashDirX=Math.abs(e)>Math.abs(n)?1:0,this.squashDirY=Math.abs(n)>Math.abs(e)?1:0}}}}handleRoundedWallCollision(t,e){const n=Pt,i=[{x:n,y:n},{x:t-n,y:n},{x:t-n,y:e-n},{x:n,y:e-n}];for(let o=0;o<i.length;o++){const a=i[o],l=this.x-a.x,s=this.y-a.y,r=Math.sqrt(l*l+s*s);if(this.isInCornerRegion(a,t,e,n)&&r+this.r>n){const t=n-(r-this.r);if(t>0&&r>0){const e=l/r,n=s/r;this.x+=e*t,this.y+=n*t;const i=this.vx*e+this.vy*n;this.vx-=2*i*e*_,this.vy-=2*i*n*_;const o=Math.min(1,Math.abs(i)/(90*this.r));this.squashAmount=Math.min(P(),.8*o),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.atan2(n,e)}}}if(this.y+this.r>e&&(this.x<n||this.x>t-n)&&(this.y=e-this.r,this.vy=-this.vy*(_*Math.pow(1/this.m,ot))),this.y-this.r<0&&(this.x<n||this.x>t-n)&&(this.y=this.r,this.vy=-this.vy*_),this.x+this.r>t&&(this.y<n||this.y>e-n)){this.x=t-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(_*Math.pow(1/this.m,ot));const e=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(P(),e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0&&(this.y<n||this.y>e-n)){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(_*Math.pow(1/this.m,ot));const t=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(P(),t),this.squash=1-this.squashAmount,this.squashNormalAngle=0}this.y+this.r>e&&this.x>=n&&this.x<=t-n&&(this.y=e-this.r,this.vy=-this.vy*(_*Math.pow(1/this.m,ot))),this.y-this.r<0&&this.x>=n&&this.x<=t-n&&(this.y=this.r,this.vy=-this.vy*(_*Math.pow(1/this.m,ot))),this.x+this.r>t&&this.y>=n&&this.y<=e-n&&(this.x=t-this.r,this.vx=-this.vx*(_*Math.pow(1/this.m,ot))),this.x-this.r<0&&this.y>=n&&this.y<=e-n&&(this.x=this.r,this.vx=-this.vx*(_*Math.pow(1/this.m,ot)))}isInCornerRegion(t,e,n,i){return t.x===i&&t.y===i?this.x<=i&&this.y<=i:t.x===e-i&&t.y===i?this.x>=e-i&&this.y<=i:t.x===e-i&&t.y===n-i?this.x>=e-i&&this.y>=n-i:t.x===i&&t.y===n-i&&this.x<=i&&this.y>=n-i}draw(t){if(t.save(),t.translate(this.x,this.y),this.isSparkle){const e=performance.now()/1e3-this.spawnTime,n=Math.min(1,e/this.lifetime),i=Math.max(0,1-n);if(x>0){const e=this.r*(1.5+2*x),n=i*x*.3;t.beginPath(),t.arc(0,0,e,0,2*Math.PI);const o=t.createRadialGradient(0,0,0,0,0,e),a=this.color,l=a.replace(/[\d\.]+\)$/g,`${n})`),s=a.replace(/[\d\.]+\)$/g,.5*n+")");o.addColorStop(0,l),o.addColorStop(.7,s),o.addColorStop(1,a.replace(/[\d\.]+\)$/g,"0)")),t.fillStyle=o,t.fill()}t.beginPath(),t.arc(0,0,this.r,0,2*Math.PI),t.fillStyle=this.color.replace(/[\d\.]+\)$/g,`${i})`),t.fill(),x>.2&&(t.beginPath(),t.arc(.3*this.r,.3*-this.r,.15*this.r,0,2*Math.PI),t.fillStyle=`rgba(255, 255, 255, ${i*x*.8})`,t.fill())}else{const e=Math.min(P(),Math.max(0,this.squashAmount));if(e>.001){const n=1+e,i=1/n;t.rotate(this.squashNormalAngle),t.scale(n,i),t.rotate(-this.squashNormalAngle)}t.beginPath(),t.arc(0,0,this.r,0,2*Math.PI),t.fillStyle=this.color,t.fill()}t.restore()}}const _t=[];function Yt(t,e,n){return Math.max(e,Math.min(n,t))}function jt(t,e){return t+Math.random()*(e-t)}function Zt(t,e,n=Et()){const i=(st+rt)/2;let o;if(0===tt)o=i;else{const t=.1*i;o=jt(Math.max(1,i-t),i+t)}const a=new $t(t,e,o,n),l=.5*q.width,s=ct?mt>=0?1:-1:t<l?1:-1,r=Yt(o/(.5*(st+rt)),.6,1.4),d=140*r,h=180*r;return a.vx=s*(d+Math.random()*h),a.vy=120*-Math.random(),a.driftAx=s*(360+420*Math.random())*r,a.driftTime=.22+.28*Math.random(),_t.push(a),a}let Xt=0,Jt=0,Kt=!1;function Qt(){_t.length=0,Xt=0,Jt=0,Kt=!0}let te=0;function ee(){const t=q.clientWidth,e=q.clientHeight,n=Yt(G/100*t,0,t);let i=Yt(N/100*t,0,t);if(ct){const e=.2*t,n=i;i=Yt(i+Math.sin(ut)*e,0,t),mt=i>=n?1:-1}const o=Math.min(40,.1*n),a=Yt(i-n/2-o,-o,t),l=Yt(i+n/2+o,-o,t),s=U/100*e,r=s+D/100*e,d=Math.random();return{x:(a+(l-a)*(mt>0?Math.pow(d,.7):1-Math.pow(1-d,.7)))*z,y:jt(s*z,r*z)-(rt+2+jt(0,10*z))}}const ne=[];let ie=0;function oe(){if(ie<ne.length)return ne[ie++];{const t=new $t(0,0,0,"#ffffff");return t.isSparkle=!0,t.active=!1,ne.push(t),t}}function ae(){ie=0;for(let t=0;t<ne.length;t++)ne[t].active=!1}const le=new Map;function se(t=6){const e=function(){const t=_t.length;if(t<2)return[];const e=Math.max(1,2*rt),n=Math.ceil(q.width/e)+1;le.clear();for(let i=0;i<t;i++){const t=_t[i],o=t.x/e|0,a=(t.y/e|0)*n+o;let l=le.get(a);l||(l=[],le.set(a,l)),l.push(i)}const i=[];for(const[t,e]of le){const o=t/n|0,a=t%n;for(let t=-1;t<=1;t++)for(let l=-1;l<=1;l++){const s=(o+t)*n+(a+l),r=le.get(s);if(r)for(let t=0;t<e.length;t++){const n=e[t];for(let t=0;t<r.length;t++){const e=r[t];if(e<=n)continue;const o=_t[n],a=_t[e],l=a.x-o.x,s=a.y-o.y,d=o.r+a.r,h=l*l+s*s;if(h<d*d){const t=d-Math.sqrt(Math.max(h,1e-6));i.push({i:n,j:e,overlap:t})}}}}}return i.sort((t,e)=>e.overlap-t.overlap),i}();for(let n=0;n<t;n++)for(let t=0;t<e.length;t++){const{i:n,j:i}=e[t],o=_t[n],a=_t[i],l=a.x-o.x,s=a.y-o.y,r=o.r+a.r,d=l*l+s*s;if(0===d||d>r*r)continue;const h=Math.sqrt(d),c=l/h,u=s/h,m=r-h,f=1/Math.max(o.m,.001),g=1/Math.max(a.m,.001),p=.8*Math.max(m-X,0)/(f+g),y=p*c,x=p*u;o.x-=y*f,o.y-=x*f,a.x+=y*g,a.y+=x*g;const v=a.vx-o.vx,M=a.vy-o.vy,E=v*c+M*u;if(E<0){const t=-(1+(Math.abs(E)<30?0:_))*E/(f+g),e=t*c,n=t*u;o.vx-=e*f,o.vy-=n*f,a.vx+=e*g,a.vy+=n*g;const i=v-E*c,l=M-E*u,s=Math.hypot(i,l);if(s>.001){const t=i*-u+l*c>=0?1:-1,e=.18;o.omega-=t*e*s/Math.max(o.r,1),a.omega+=t*e*s/Math.max(a.r,1)}const r=Math.min(1,Math.abs(E)/(50*(o.r+a.r))),d=Math.min(P(),.8*r);o.squashAmount=Math.max(o.squashAmount,.8*d),o.squashNormalAngle=Math.atan2(-u,-c),a.squashAmount=Math.max(a.squashAmount,.8*d),a.squashNormalAngle=Math.atan2(u,c)}}}let re=performance.now()/1e3,de=0;const he=1/120;console.log("High refresh mode enabled - using requestAnimationFrame"),requestAnimationFrame(function t(a){const s=a/1e3;let r=Math.min(.008,s-re);re=s,de+=r,Nt++,(Wt||Ht)&&s-Gt>=1&&(Wt&&Nt!==Dt&&(Dt=Nt,Wt.textContent=Dt.toString()),Ht&&Ut!==Ot&&(Ot=Ut,Ht.textContent=Ot.toString()),Nt=0,Ut=0,Gt=s),function(t){if(l!==n)if(l!==o){if(l!==i)for(te+=t;te>=j;){const t=(Math.random()-.5)*j*.5;te-=j+t,ut+=2*Math.PI*.12*(j+t);const e=ee(),n=Math.random()<.35?3:1;for(let t=0;t<n;t++)if(_t.length<Z){const n=8*t*(Math.random()<.5?1:-1);Zt(e.x+n,e.y-12*t)}}}else(function(){if(!Kt||Xt>=pt.length)return!1;const t=performance.now()/1e3,e=Math.max(S,.3);return t-Jt>=e})()&&function(){if(Xt>=pt.length||!Kt)return!1;const t=q.width/pt.length,e=Math.min(.2*q.height,.2*q.width),n=15*z;let i;if(0===B)i=e-Xt/(pt.length-1)*(e-n);else{const t=Xt/(pt.length-1)+(Math.random()-.5)*B*.3;i=e-Math.max(0,Math.min(1,t))*(e-n)}const o=t*Xt+.5*t;for(let t=0;t<_t.length;t++){const e=_t[t];if(Math.sqrt(Math.pow(e.x-o,2)+Math.pow(e.y- -100,2))<1.5*(e.r+i))return!1}const a=Math.min(.3*t,100),l=(Math.random()-.5)*a*2,s=Math.max(i+20,Math.min(q.width-i-20,o+l)),r=new $t(s,-i-150,i,pt[rainbowDropIndex]);r.m=5*it,r.vx=40*(Math.random()-.5),r.vy=0,r.driftAx=0,r.driftTime=0,_t.push(r),Xt++,Jt=performance.now()/1e3}();else!function(){if(Bt===R||St===R)return;if(v.length<2)return;const t=performance.now()/1e3;if(ue>0&&t-ue>.1)return;const e=v[v.length-1],n=v[v.length-2],i=Math.max(.001,e.time-n.time),o=(e.x-n.x)/i,a=(e.y-n.y)/i,l=Math.sqrt(o*o+a*a);if(l<50)return;const s=m;for(let t=0;t<s;t++){const t=oe();t.x=Bt,t.y=St,t.isSparkle=!0,t.spawnTime=performance.now()/1e3,t.lifetime=f,t.active=!0,t.color=pt[Math.floor(Math.random()*pt.length)];const e=Math.random()*Math.PI*2+(Math.random()-.5)*Math.PI*.5,n=Math.min(2,Math.max(.5,l/100)),i=g*n*(.3+.7*Math.random());t.vx=Math.cos(e)*i,t.vy=Math.sin(e)*i,t.r=(st+rt)/2*y,t.rBase=t.r,t.theta=Math.random()*Math.PI*2,_t.push(t)}}()}(r),Nt%60==0&&ht();let d=0;for(;de>=he&&d<2;){for(let t=0;t<_t.length;t++)_t[t].step(he);if(l!==e&&l!==n&&se(3),l!==n){const t=l===i?E:l===o?V:_;for(let e=0;e<_t.length;e++)_t[e].walls(q.width,q.height,he,t)}de-=he,d++,Ut++}if(l===n)for(let t=_t.length-1;t>=0;t--){const e=_t[t];e.isSparkle&&e.r<=.5&&(e.active=!1,_t.splice(t,1))}if(de>3*he&&(de=0),kt>0&&zt>0){const t=1.5,e=3,n=.35;let i=1+(n+(.0015-n)*Math.max(0,Math.min(1,kt/t))-1)*Math.max(0,Math.min(1,zt/e));i=Math.max(.001,Math.min(1,i)),A.fillStyle=`rgba(0,0,0,${i})`,A.globalCompositeOperation="destination-out",A.fillRect(0,0,q.width,q.height),A.globalCompositeOperation="source-over"}else A.clearRect(0,0,q.width,q.height);Pt>0&&function(t,e,n){const i=Pt;t.strokeStyle="rgba(255, 255, 255, 0.1)",t.lineWidth=2,t.beginPath(),t.moveTo(i,0),t.lineTo(e-i,0),t.arcTo(e,0,e,i,i),t.lineTo(e,n-i),t.arcTo(e,n,e-i,n,i),t.lineTo(i,n),t.arcTo(0,n,0,n-i,i),t.lineTo(0,i),t.arcTo(0,0,i,0,i),t.closePath(),t.stroke()}(A,q.width,q.height);for(let t=0;t<_t.length;t++)_t[t].draw(A);if(function(t){if(Vt)return;if(Bt===R||St===R)return;if(l===n)return;const e=Bt,i=St,o=(st+rt)/2;t.beginPath(),t.arc(e,i,o,0,2*Math.PI),t.fillStyle="rgba(255, 255, 255, 0.9)",t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.6)",t.lineWidth=2,t.stroke()}(A),!Vt){A.save(),A.font="14px system-ui, -apple-system, sans-serif",A.fillStyle="rgba(255, 255, 255, 0.3)",A.textAlign="left",A.textBaseline="bottom";const t=l.charAt(0).toUpperCase()+l.slice(1);A.fillText(t+" Mode",10,q.height-10),A.restore()}requestAnimationFrame(t)}),window.addEventListener("keydown",a=>{const s=a.key.toLowerCase();"r"===s&&(function(){if(l===o)Qt();else if(l===i)Zn();else for(let t=0;t<_t.length;t++){const e=_t[t],n=ee();e.x=n.x,e.y=n.y;const i=.5*q.width,o=ct?mt>=0?1:-1:e.x<i?1:-1,a=Yt(e.r/(.5*(st+rt)),.6,1.4),l=140*a,s=180*a,r=120;e.vx=o*(l+Math.random()*s),e.vy=-Math.random()*r,e.age=0,e.driftAx=o*(360+420*Math.random())*a,e.driftTime=.22+.28*Math.random()}}(),a.preventDefault()),"/"===s&&k&&(a.preventDefault(),k.classList.toggle("hidden")),"1"===s&&Xn(t),"2"===s&&Xn(e),"3"===s&&Xn(n),"4"===s&&Xn(i),"5"===s&&Xn(o)}),function(t=160){for(let e=0;e<t&&_t.length<Z;e++){const t=ee();Zt(t.x,t.y)}}(200);let ce={x:0,y:0},ue=0,me=null,fe={x:0,y:0};q.addEventListener("mousemove",e=>{const i=q.getBoundingClientRect();if(Bt=(e.clientX-i.left)*z,St=(e.clientY-i.top)*z,l===t&&It>0&&bt>0&&(Ct=!0),l===o)if(me){const t=L,e=Bt-me.x,n=St-me.y;me.vx=e*(1-t),me.vy=n*(1-t),me.x=Bt-fe.x,me.y=St-fe.y;for(let t=0;t<_t.length;t++){if(_t[t]===me)continue;const e=_t[t],n=me.x-e.x,i=me.y-e.y,o=Math.sqrt(n*n+i*i),a=me.r+e.r;if(o<a){const t=.5*(a-o),l=n/o,s=i/o;me.x+=l*t,me.y+=s*t,e.x-=l*t,e.y-=s*t;const r=(me.vx-e.vx)*l+(me.vy-e.vy)*s;if(r<0)continue;const d=2*r/(me.m+e.m);me.vx-=d*e.m*l,me.vy-=d*e.m*s,e.vx+=d*me.m*l,e.vy+=d*me.m*s}}}else for(let t=0;t<_t.length;t++){const e=_t[t],n=Bt-e.x,i=St-e.y;if(Math.sqrt(n*n+i*i)<=e.r)break}if(l===n){const t=performance.now()/1e3,e=Bt-ce.x,n=St-ce.y;Math.sqrt(e*e+n*n)>2?(v.push({x:Bt,y:St,time:t}),v.length>6&&v.shift(),ce={x:Bt,y:St},ue=0):ue=t}}),q.addEventListener("mouseleave",()=>{Bt=R,St=R,l===n&&(v=[],ue=0,ae()),me=null}),q.addEventListener("mousedown",t=>{if(l===o){const e=q.getBoundingClientRect(),n=(t.clientX-e.left)*z,i=(t.clientY-e.top)*z;for(let t=0;t<_t.length;t++){const e=_t[t],o=n-e.x,a=i-e.y;if(Math.sqrt(o*o+a*a)<=e.r){me=e,fe.x=n-e.x,fe.y=i-e.y;break}}}}),q.addEventListener("mouseup",()=>{me=null});const ge=document.getElementById("restitutionSlider"),pe=document.getElementById("frictionSlider"),ye=document.getElementById("emitterSlider"),xe=document.getElementById("sizeSliderGlobal"),ve=document.getElementById("sizeVariationSliderGlobal"),Me=(document.getElementById("weightSliderGlobal"),document.getElementById("ballSoftnessSliderGlobal")),Ee=document.getElementById("sizeValGlobal"),be=document.getElementById("sizeVariationValGlobal"),Ie=(document.getElementById("weightValGlobal"),document.getElementById("ballSoftnessValGlobal")),we=(document.getElementById("sizeSliderPit"),document.getElementById("sizeVariationSliderPit"),document.getElementById("weightSliderPit"),document.getElementById("ballSoftnessSliderPit"),document.getElementById("sizeValPit"),document.getElementById("sizeVariationValPit"),document.getElementById("weightValPit"),document.getElementById("ballSoftnessValPit"),document.getElementById("sizeSliderFlies"),document.getElementById("sizeVariationSliderFlies"),document.getElementById("weightSliderFlies"),document.getElementById("ballSoftnessSliderFlies"),document.getElementById("sizeValFlies"),document.getElementById("sizeVariationValFlies"),document.getElementById("weightValFlies"),document.getElementById("ballSoftnessValFlies"),document.getElementById("sizeSliderZeroG"),document.getElementById("sizeVariationSliderZeroG"),document.getElementById("weightSliderZeroG"),document.getElementById("ballSoftnessSliderZeroG"),document.getElementById("sizeValZeroG"),document.getElementById("sizeVariationValZeroG"),document.getElementById("weightValZeroG"),document.getElementById("ballSoftnessValZeroG"),document.getElementById("maxBallsSlider")),Be=document.getElementById("spawnYSlider"),Se=document.getElementById("spawnWidthSlider"),Ce=document.getElementById("spawnCenterSlider"),Ve=document.getElementById("spawnHeightSlider"),Le=document.getElementById("repelSizeSlider"),Re=document.getElementById("repelPowerSlider"),Fe=document.getElementById("repelSoftSlider"),Te=document.getElementById("colorSelect"),Pe=document.getElementById("color1"),qe=document.getElementById("color2"),Ae=document.getElementById("color3"),ke=document.getElementById("color4"),ze=document.getElementById("color5"),Ne=document.getElementById("color6"),Ue=document.getElementById("color7"),Ge=document.getElementById("color8"),De=document.getElementById("cursorColorSelect"),Oe=document.getElementById("color1Val"),We=document.getElementById("color2Val"),He=document.getElementById("color3Val"),$e=document.getElementById("color4Val"),_e=document.getElementById("color5Val"),Ye=document.getElementById("color6Val"),je=document.getElementById("color7Val"),Ze=document.getElementById("color8Val");[Oe,We,He,$e,_e,Ye,je,Ze].forEach(t=>{t&&t.setAttribute("title","Click to copy")});const Xe=document.getElementById("cornerRadiusSlider"),Je=document.getElementById("cornerRadiusVal"),Ke=document.getElementById("trailFadeSlider"),Qe=document.getElementById("trailFadeVal"),tn=document.getElementById("trailSubtletySlider"),en=document.getElementById("trailSubtletyVal"),nn=document.getElementById("restitutionVal"),on=document.getElementById("frictionVal"),an=document.getElementById("emitterVal"),ln=document.getElementById("maxBallsVal"),sn=document.getElementById("spawnYVal"),rn=document.getElementById("spawnWidthVal"),dn=document.getElementById("spawnCenterVal"),hn=document.getElementById("spawnHeightVal"),cn=document.getElementById("repelSizeVal"),un=document.getElementById("repelPowerVal"),mn=document.getElementById("repelSoftVal");function fn(){return{gravityMultiplier:H,restitution:_,friction:Y,ballMass:it,emitRate:j,maxBalls:Z,ballScale:Q,ballVariation:tt,spawnX:N,spawnY:U,spawnWidth:G,spawnHeight:D,sweepEnabled:ct,repelRadius:bt,repelPower:It,repelSoftness:wt,trailFade:kt,trailSubtlety:zt,colors:pt.slice(),colorWeights:Mt.slice(),currentTemplate:gt,cursorColorIndex:yt}}const gn=document.getElementById("saveConfigBtn"),pn=document.getElementById("buildBtn"),yn=document.getElementById("configOutput");function xn(t,e){t&&t.addEventListener("click",async()=>{const n="function"==typeof e?e():String(e||"").trim();try{await navigator.clipboard.writeText(n);const e=t.textContent;t.textContent="COPIED",t.style.color="#3ddc84",setTimeout(()=>{t.textContent=e,t.style.color="#888"},900)}catch(t){console.warn("Clipboard unavailable")}})}gn&&pn&&yn&&(gn.addEventListener("click",()=>{const t=(e=fn(),`// Generated configuration from frontend\nconst CONFIG = ${JSON.stringify(e,null,2)};`);var e;yn.style.display="block",yn.textContent=t,navigator.clipboard.writeText(t).then(()=>{const t=gn.textContent;gn.textContent="âœ… Copied!",setTimeout(()=>{gn.textContent=t},1200)}).catch(()=>{console.warn("Clipboard copy failed");const t=gn.textContent;gn.textContent="âš ï¸ Copy failed",setTimeout(()=>{gn.textContent=t},1200)})}),pn.addEventListener("click",()=>{const t=fn();yn.style.display="block",yn.innerHTML="\n<strong>ðŸš€ Build Instructions:</strong><br>\n1. Run: <code>npm run build</code><br>\n2. Your current config will be baked into <code>public/js/bouncy-balls-embed.js</code>";const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download="current-config.json",i.click(),URL.revokeObjectURL(n)})),ge&&ge.addEventListener("input",()=>{_=parseFloat(ge.value),nn&&(nn.textContent=_.toFixed(2)),Ft()}),pe&&pe.addEventListener("input",()=>{Y=parseFloat(pe.value),on&&(on.textContent=Y.toFixed(4)),Ft()}),ye&&ye.addEventListener("input",()=>{j=parseFloat(ye.value),an&&(an.textContent=j.toFixed(3)),Ft()}),function(t){if(!t)return;const{size:e,sizeVal:n,sizeVar:i,sizeVarVal:a,soft:r,softVal:d}=t;e&&e.addEventListener("input",()=>{const t=parseFloat(e.value);n&&(n.textContent=t.toFixed(1)),Q=t,dt();for(let t=0;t<_t.length;t++)_t[t].m=l===o?5*it:it;Ft()}),i&&i.addEventListener("input",()=>{const t=parseFloat(i.value);a&&(a.textContent=t.toFixed(1)),tt=t,Ft()}),r&&r.addEventListener("input",()=>{const t=parseInt(r.value,10);d&&(d.textContent=String(t)),s=t,Ft()})}({size:xe,sizeVal:Ee,sizeVar:ve,sizeVarVal:be,soft:Me,softVal:Ie}),we&&we.addEventListener("input",()=>{Z=parseInt(we.value,10),ln&&(ln.textContent=Z.toString()),_t.length>Z&&(_t.length=Z)}),ve&&ve.addEventListener("input",()=>{tt=parseFloat(ve.value),be&&(be.textContent=tt.toFixed(1)),In()});const vn=document.getElementById("weightPitSlider"),Mn=document.getElementById("weightPitVal"),En=document.getElementById("weightWeightlessSlider"),bn=document.getElementById("weightWeightlessVal");function In(){const t=(st+rt)/2;for(let e=0;e<_t.length;e++){const n=_t[e];if(0===tt)n.r=t;else{const e=.1*t,i=Math.max(1,t-e),o=t+e;n.r=jt(i,o)}n.m=it}}document.getElementById("weightRainbowSlider"),document.getElementById("weightRainbowVal"),Be&&Be.addEventListener("input",()=>{U=parseFloat(Be.value),sn&&(sn.textContent=U.toFixed(0)),O()}),Se&&Se.addEventListener("input",()=>{G=parseFloat(Se.value),rn&&(rn.textContent=G.toFixed(0))}),Ce&&Ce.addEventListener("input",()=>{N=parseFloat(Ce.value),dn&&(dn.textContent=N.toFixed(0))}),Ve&&Ve.addEventListener("input",()=>{D=parseFloat(Ve.value),hn&&(hn.textContent=D.toFixed(0))}),Le&&Le.addEventListener("input",()=>{bt=parseFloat(Le.value),cn&&(cn.textContent=bt.toFixed(0)),Ct=Ct||It>0&&bt>0}),Re&&Re.addEventListener("input",()=>{It=function(t){const e=Math.max(0,Math.min(Tt,Number(t)))/Tt;return 2*Math.pow(2,12*(e-.5))*12e3}(Re.value),un&&(un.textContent=Math.round(It).toString()),Si&&"off"!==Si.value&&(Ct=It>0&&bt>0)}),Fe&&Fe.addEventListener("input",()=>{wt=parseFloat(Fe.value),mn&&(mn.textContent=wt.toFixed(1))}),Te&&Te.addEventListener("change",()=>{const t=ft[Te.value];t&&(gt=Te.value,pt=t.colors.slice(),xt=pt[yt]||xt,Pe&&Oe&&(Pe.value=pt[0],Oe.textContent=pt[0].toUpperCase()),qe&&We&&(qe.value=pt[1],We.textContent=pt[1].toUpperCase()),Ae&&He&&(Ae.value=pt[2],He.textContent=pt[2].toUpperCase()),ke&&$e&&(ke.value=pt[3],$e.textContent=pt[3].toUpperCase()),ze&&_e&&(ze.value=pt[4],_e.textContent=pt[4].toUpperCase()),Ne&&Ye&&(Ne.value=pt[5],Ye.textContent=pt[5].toUpperCase()),Ue&&je&&(Ue.value=pt[6],je.textContent=pt[6].toUpperCase()),Ge&&Ze&&(Ge.value=pt[7],Ze.textContent=pt[7].toUpperCase()),vi(),vt())});const wn=Array.from(document.querySelectorAll(".mode-button")),Bn=document.getElementById("pitControls"),Sn=document.getElementById("fliesControls"),Cn=document.getElementById("trailControls"),Vn=document.getElementById("weightlessControls"),Ln=document.getElementById("boulderControls"),Rn=document.getElementById("gravityPitSlider"),Fn=document.getElementById("gravityPitVal"),Tn=document.getElementById("repellerEnabledPit"),Pn=document.getElementById("attractPowerSlider"),qn=document.getElementById("attractPowerVal"),An=document.getElementById("orbitRadiusSlider"),kn=document.getElementById("orbitRadiusVal"),zn=document.getElementById("swarmSpeedSlider"),Nn=document.getElementById("swarmSpeedVal"),Un=document.getElementById("sparkleEmissionSlider"),Gn=document.getElementById("sparkleEmissionVal"),Dn=document.getElementById("sparkleLifetimeSlider"),On=document.getElementById("sparkleLifetimeVal"),Wn=document.getElementById("sparkleSpreadSlider"),Hn=document.getElementById("sparkleSpreadVal"),$n=document.getElementById("sparkleDriftSlider"),_n=document.getElementById("sparkleDriftVal"),Yn=document.getElementById("sparkleScaleSlider"),jn=document.getElementById("sparkleScaleVal");function Zn(){_t.length=0;const t=b,e=q.width,n=q.height,i=e/n,o=Math.ceil(Math.sqrt(t*i)),a=Math.ceil(t/o),l=(e-80)/(o-1),s=(n-80)/(a-1),r=[];for(let i=0;i<a;i++)for(let a=0;a<o&&!(r.length>=t);a++){const t=40+a*l,o=40+i*s,d=(Math.random()-.5)*l*.3,h=(Math.random()-.5)*s*.3;r.push({x:Math.max(20,Math.min(e-20,t+d)),y:Math.max(20,Math.min(n-20,o+h))})}for(let t=0;t<r.length;t++){const e=r[t],n=Zt(e.x,e.y),i=Math.random()*Math.PI*2,o=M*(.5+.5*Math.random());n.vx=Math.cos(i)*o,n.vy=Math.sin(i)*o,n.driftAx=0,n.driftTime=0}console.log(`Weightless scene initialized: ${_t.length} balls distributed evenly across viewport`)}function Xn(a){l=a,l===t?(H=r,$=W*H,Ct=d&&It>0&&bt>0,ct=!0):l===e?(H=0,$=W*H,Ct=!1,ct=!1):l===n?(H=0,$=W*H,Ct=!1,ct=!1,v=[],_t.length=0,ae()):l===i?(H=0,$=W*H,Ct=!1,ct=!1,Zn()):l===o&&(H=C,$=W*H,Ct=!1,ct=!1,Qt()),Bn&&Bn.classList.toggle("active",l===t),Sn&&Sn.classList.toggle("active",l===e),Cn&&Cn.classList.toggle("active",l===n),Vn&&Vn.classList.toggle("active",l===i),Ln&&Ln.classList.toggle("active",l===o),wn.forEach(t=>t.classList.toggle("active",t.getAttribute("data-mode")===l))}wn.forEach(t=>t.addEventListener("click",()=>{Xn(t.getAttribute("data-mode")),function(){const t=parseFloat(xe.value);for(let e=0;e<_t.length;e++)l!==o&&(_t[e].r=t,_t[e].rBase=t)}(),Ft()})),Rn&&Rn.addEventListener("input",()=>{r=parseFloat(Rn.value),Fn&&(Fn.textContent=r.toFixed(1)),Ft(),l===t&&(H=r,$=W*H)}),vn&&vn.addEventListener("input",()=>{it=parseFloat(vn.value),Mn&&(Mn.textContent=it.toFixed(2));for(let t=0;t<_t.length;t++)_t[t].m=l===o?5*it:it;lt(),Ft()}),Tn&&Tn.addEventListener("change",()=>{d=!!Tn.checked,l===t&&(Ct=d&&It>0&&bt>0)}),Pn&&Pn.addEventListener("input",()=>{h=parseFloat(Pn.value),qn&&(qn.textContent=Math.round(h).toString())}),An&&An.addEventListener("input",()=>{c=parseFloat(An.value),kn&&(kn.textContent=Math.round(c).toString())}),zn&&zn.addEventListener("input",()=>{u=parseFloat(zn.value),Nn&&(Nn.textContent=u.toFixed(1))}),Un&&Un.addEventListener("input",()=>{m=parseInt(Un.value,10),Gn&&(Gn.textContent=m.toString()),Ft()}),Dn&&Dn.addEventListener("input",()=>{f=parseFloat(Dn.value),On&&(On.textContent=f.toFixed(1)),Ft()}),Wn&&Wn.addEventListener("input",()=>{g=parseInt(Wn.value,10),Hn&&(Hn.textContent=g.toString()),Ft()}),$n&&$n.addEventListener("input",()=>{p=parseInt($n.value,10),_n&&(_n.textContent=p.toString()),Ft()}),Yn&&Yn.addEventListener("input",()=>{y=parseFloat(Yn.value),jn&&(jn.textContent=y.toFixed(2)),Ft()});const Jn=document.getElementById("trailIntensitySlider"),Kn=document.getElementById("trailIntensityVal");Jn&&Jn.addEventListener("input",()=>{x=parseFloat(Jn.value),Kn&&(Kn.textContent=x.toFixed(2)),Ft()});const Qn=document.getElementById("weightlessSpeedSlider"),ti=document.getElementById("weightlessSpeedVal"),ei=document.getElementById("weightlessBounceSlider"),ni=document.getElementById("weightlessBounceVal"),ii=document.getElementById("weightlessMaxBallsSlider"),oi=document.getElementById("weightlessMaxBallsVal"),ai=document.getElementById("weightlessRepelPowerSlider"),li=document.getElementById("weightlessRepelPowerVal"),si=document.getElementById("weightlessRepelRadiusSlider"),ri=document.getElementById("weightlessRepelRadiusVal");Qn&&Qn.addEventListener("input",()=>{M=parseFloat(Qn.value),ti&&(ti.textContent=Math.round(M).toString())}),En&&En.addEventListener("input",()=>{it=parseFloat(En.value),bn&&(bn.textContent=it.toFixed(2));for(let t=0;t<_t.length;t++)_t[t].m=l===o?5*it:it;lt(),Ft()}),ei&&ei.addEventListener("input",()=>{E=parseFloat(ei.value),ni&&(ni.textContent=E.toFixed(2))}),ii&&ii.addEventListener("input",()=>{b=parseInt(ii.value,10),oi&&(oi.textContent=b.toString()),l===i&&Zn()}),ai&&ai.addEventListener("input",()=>{I=parseFloat(ai.value),li&&(li.textContent=Math.round(I).toString())}),si&&si.addEventListener("input",()=>{w=parseFloat(si.value),ri&&(ri.textContent=Math.round(w).toString())});const di=document.getElementById("boulderRandomnessSlider"),hi=document.getElementById("boulderRandomnessVal"),ci=document.getElementById("boulderDropDelaySlider"),ui=document.getElementById("boulderDropDelayVal"),mi=document.getElementById("boulderGravitySlider"),fi=document.getElementById("boulderGravityVal"),gi=document.getElementById("boulderBounceSlider"),pi=document.getElementById("boulderBounceVal"),yi=document.getElementById("boulderDragSlider"),xi=document.getElementById("boulderDragVal");function vi(){for(let t=0;t<_t.length;t++)_t[t].color=Et()}di&&di.addEventListener("input",()=>{B=parseFloat(di.value),hi&&(hi.textContent=B.toFixed(1))}),weightBoulderSlider&&weightBoulderSlider.addEventListener("input",()=>{it=parseFloat(weightBoulderSlider.value),weightBoulderVal&&(weightBoulderVal.textContent=it.toFixed(2));for(let t=0;t<_t.length;t++)_t[t].m=5*it;lt(),Ft()}),ci&&ci.addEventListener("input",()=>{S=parseFloat(ci.value),ui&&(ui.textContent=S.toFixed(2))}),mi&&mi.addEventListener("input",()=>{C=parseFloat(mi.value),fi&&(fi.textContent=C.toFixed(1)),l===o&&(H=C,$=W*H)}),gi&&gi.addEventListener("input",()=>{V=parseFloat(gi.value),pi&&(pi.textContent=V.toFixed(2))}),yi&&yi.addEventListener("input",()=>{L=parseFloat(yi.value),xi&&(xi.textContent=L.toFixed(2))}),Pe&&Pe.addEventListener("input",()=>{pt[0]=Pe.value,Oe&&(Oe.textContent=Pe.value.toUpperCase()),vi(),vt()}),qe&&qe.addEventListener("input",()=>{pt[1]=qe.value,We&&(We.textContent=qe.value.toUpperCase()),vi(),vt()}),Ae&&Ae.addEventListener("input",()=>{pt[2]=Ae.value,He&&(He.textContent=Ae.value.toUpperCase()),vi(),vt()}),ke&&ke.addEventListener("input",()=>{pt[3]=ke.value,$e&&($e.textContent=ke.value.toUpperCase()),vi(),vt()}),ze&&ze.addEventListener("input",()=>{pt[4]=ze.value,_e&&(_e.textContent=ze.value.toUpperCase()),vi(),vt()}),Ne&&Ne.addEventListener("input",()=>{pt[5]=Ne.value,Ye&&(Ye.textContent=Ne.value.toUpperCase()),vi(),vt()}),Ue&&Ue.addEventListener("input",()=>{pt[6]=Ue.value,je&&(je.textContent=Ue.value.toUpperCase()),vi(),vt()}),Ge&&Ge.addEventListener("input",()=>{pt[7]=Ge.value,Ze&&(Ze.textContent=Ge.value.toUpperCase()),vi(),vt()}),De&&De.addEventListener("change",()=>{const t=Math.max(1,Math.min(8,parseInt(De.value,10)))-1;yt=t,xt=pt[yt]||xt}),xn(Oe,()=>Pe.value.toUpperCase()),xn(We,()=>qe.value.toUpperCase()),xn(He,()=>Ae.value.toUpperCase()),xn($e,()=>ke.value.toUpperCase()),xn(_e,()=>ze.value.toUpperCase()),xn(Ye,()=>Ne.value.toUpperCase()),xn(je,()=>Ue.value.toUpperCase()),xn(Ze,()=>Ge.value.toUpperCase()),Xe&&Xe.addEventListener("input",()=>{Pt=parseFloat(Xe.value),Je&&(Je.textContent=Pt.toFixed(0))}),Ke&&Ke.addEventListener("input",()=>{kt=parseFloat(Ke.value),Qe&&(Qe.textContent=kt.toFixed(3))}),tn&&tn.addEventListener("input",()=>{zt=parseFloat(tn.value),en&&(en.textContent=zt.toFixed(2)+"Ã—")});const Mi={rubberPlayground:{label:"Rubber â€“ Playground",G:1960,REST:.9,FRICTION:.0025,sizeScale:1.8,maxBalls:450,sizeVariation:.2},rubberRacquet:{label:"Rubber â€“ Racquetball",G:3320,REST:.97,FRICTION:.0035,sizeScale:.7,maxBalls:350,sizeVariation:.3},rubberSuperball:{label:"Rubber â€“ Superball",G:1960,REST:.95,FRICTION:.0015,sizeScale:1.2,maxBalls:450,sizeVariation:.05},rubberSoft:{label:"Rubber â€“ Soft",G:1960,REST:.86,FRICTION:.0035,sizeScale:2.2,maxBalls:350,sizeVariation:.25},rubberHeavy:{label:"Rubber â€“ Heavy",G:1960,REST:.88,FRICTION:.003,sizeScale:2,maxBalls:400,sizeVariation:.15}},Ei={fullRain:{label:"Full Rain (top-half)",EMIT_INTERVAL:.03,xCenter:50,y:-50,w:100,h:50},narrowStrip:{label:"Narrow Strip Top",EMIT_INTERVAL:.05,xCenter:50,y:-40,w:20,h:10},leftGutter:{label:"Left Gutter",EMIT_INTERVAL:.045,xCenter:10,y:-60,w:18,h:20},rightGutter:{label:"Right Gutter",EMIT_INTERVAL:.045,xCenter:90,y:-60,w:18,h:20},centerFountain:{label:"Center Fountain",EMIT_INTERVAL:.02,xCenter:50,y:-30,w:30,h:20},stormBurst:{label:"Storm Burst",EMIT_INTERVAL:.005,xCenter:50,y:-80,w:100,h:30},slowSnow:{label:"Slow Snow",EMIT_INTERVAL:.2,xCenter:50,y:-30,w:100,h:20},edgeDrizzle:{label:"Edge Drizzle",EMIT_INTERVAL:.08,xCenter:15,y:-40,w:30,h:15},twinColumns:{label:"Twin Columns",EMIT_INTERVAL:.03,xCenter:30,y:-50,w:10,h:40},focusedBeam:{label:"Focused Beam",EMIT_INTERVAL:.015,xCenter:50,y:-70,w:6,h:12}},bi={off:{label:"Off",r:710,p:274e3,s:4.4},gentle:{label:"Gentle Breeze",r:120,p:2500,s:2.5},pushField:{label:"Push Field",r:240,p:8e4,s:2},tractor:{label:"Tractor Push",r:320,p:14e4,s:1.6},magnet:{label:"Magnet Repel",r:200,p:18e4,s:3},pulse:{label:"Pulse Strong",r:280,p:22e4,s:1.2},wideSoft:{label:"Wide Soft",r:500,p:8e4,s:4.5},needle:{label:"Needle Point",r:80,p:26e4,s:.8},wall:{label:"Invisible Wall",r:700,p:16e4,s:5},singularity:{label:"Singularity",r:600,p:3e5,s:.5}};function Ii(t,e,n){t.innerHTML="";for(const[i,o]of Object.entries(e)){const e=document.createElement("option");e.value=i,e.textContent=o.label||i,i===n&&(e.selected=!0),t.appendChild(e)}}const wi=document.getElementById("physicsSelect"),Bi=document.getElementById("spawnSelect"),Si=document.getElementById("repellerSelect");function Ci(t,e,n,i=0){t&&(t.value=String(n)),e&&(e.textContent=i>0?n.toFixed(i):n.toString())}function Vi(t){const e=Mi[t];if(!e)return;_=e.REST,Y=e.FRICTION,Z=e.maxBalls,tt=e.sizeVariation;const n=e.sizeScale;Q=n,dt();for(let t=0;t<_t.length;t++)_t[t].m=l===o?5*it:it;_t.length>Z&&(_t.length=Z),Ci(ge,nn,_,2),Ci(pe,on,Y,4),Ci(xe,Ee,Q,1),Ci(we,ln,Z,0),Ci(ve,be,tt,1),In()}function Li(t){const e=Ei[t];e&&(j=e.EMIT_INTERVAL,N=e.xCenter,U=e.y,G=e.w,D=e.h,Ci(ye,an,j,3),Ci(Ce,dn,N,0),Ci(Be,sn,U,0),Ci(Se,rn,G,0),Ci(Ve,hn,D,0))}function Ri(t){const e=bi[t];if(!e)return;bt=e.r,It=1*e.p,Ct="off"!==t,Ci(Le,cn,bt,0);const n=function(t){const e=Math.max(1,Number(t))/24e3,n=.5+Math.log2(e)/12;return Math.round(Math.max(0,Math.min(1,n))*Tt)}(It);Re&&(Re.value=String(n)),un&&(un.textContent=Math.round(It).toString()),Ci(Fe,mn,wt,1)}wi&&Ii(wi,Mi,"rubberRacquet"),Bi&&Ii(Bi,Ei,"fullRain"),Si&&Ii(Si,bi,"off"),Te&&Ii(Te,ft,"industrialTeal"),Vi("rubberRacquet"),Li("fullRain"),Ri("off");const Fi=ft[gt];Pe&&Oe&&(Pe.value=Fi.colors[0],Oe.textContent=Fi.colors[0].toUpperCase()),qe&&We&&(qe.value=Fi.colors[1],We.textContent=Fi.colors[1].toUpperCase()),Ae&&He&&(Ae.value=Fi.colors[2],He.textContent=Fi.colors[2].toUpperCase()),ke&&$e&&(ke.value=Fi.colors[3],$e.textContent=Fi.colors[3].toUpperCase()),ze&&_e&&(ze.value=Fi.colors[4],_e.textContent=Fi.colors[4].toUpperCase()),Ne&&Ye&&(Ne.value=Fi.colors[5],Ye.textContent=Fi.colors[5].toUpperCase()),Ue&&je&&(Ue.value=Fi.colors[6],je.textContent=Fi.colors[6].toUpperCase()),Ge&&Ze&&(Ge.value=Fi.colors[7],Ze.textContent=Fi.colors[7].toUpperCase()),vt(Fi.colors),wi&&wi.addEventListener("change",()=>Vi(wi.value)),Bi&&Bi.addEventListener("change",()=>Li(Bi.value)),Si&&Si.addEventListener("change",()=>Ri(Si.value)),dt(),ht(),function(){try{const t=localStorage.getItem(Lt);if(t){const e=JSON.parse(t);return e.currentMode&&(l=e.currentMode),void 0!==e.gravityMultiplierPit&&(r=e.gravityMultiplierPit),void 0!==e.repellerEnabledPit&&(d=e.repellerEnabledPit),e.attractionPower&&(h=e.attractionPower),e.orbitRadius&&(c=e.orbitRadius),e.swarmSpeed&&(u=e.swarmSpeed),void 0!==e.sparkleEmissionRate&&(m=e.sparkleEmissionRate),void 0!==e.sparkleLifetime&&(f=e.sparkleLifetime),void 0!==e.sparkleVelocitySpread&&(g=e.sparkleVelocitySpread),void 0!==e.sparkleDriftStrength&&(p=e.sparkleDriftStrength),void 0!==e.sparkleParticleScale&&(y=e.sparkleParticleScale),e.weightlessInitialSpeed&&(M=e.weightlessInitialSpeed),e.weightlessBounce&&(E=e.weightlessBounce),e.weightlessMaxBalls&&(b=e.weightlessMaxBalls),void 0!==e.weightlessRepellerPower&&(I=e.weightlessRepellerPower),void 0!==e.weightlessRepellerRadius&&(w=e.weightlessRepellerRadius),e.restitution&&(_=e.restitution),void 0!==e.friction&&(Y=e.friction),e.sizeScale&&(Q=e.sizeScale),void 0!==e.sizeVariation&&(tt=e.sizeVariation),e.ballMassKg&&(it=e.ballMassKg),e.repelPower&&(It=e.repelPower),e.repelRadius&&(bt=e.repelRadius),e.repelSoft&&(wt=e.repelSoft),void 0!==e.cornerRadius&&(Pt=e.cornerRadius),void 0!==e.motionBlur&&(kt=e.motionBlur),e.trailSubtlety&&(zt=e.trailSubtlety),e.currentTemplate&&(gt=e.currentTemplate),e.cursorBallColor&&(xt=e.cursorBallColor),console.log("âœ“ Settings loaded"),!0}}catch(t){console.warn("Could not load settings:",t)}}(),function(){const t=Vt?"mobile":"desktop",e=document.getElementById("trailModeButton");e&&!a[n][t]&&(e.style.display="none")}(),Xn(l),window.addEventListener("beforeunload",Rt)})();