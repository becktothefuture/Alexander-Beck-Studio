!(function(e){function t(e,t=""){const a=(e+"").startsWith("--")?e:"--"+e,n=(()=>{try{if("undefined"==typeof window)return null;const e=window.__TOKENS__;return e&&"object"==typeof e?e:null}catch(e){return null}})(),o=(e=>{try{return"undefined"==typeof document?"":getComputedStyle(document.documentElement).getPropertyValue(e).trim()}catch(t){return""}})(a);if(o&&!o.includes("var("))return o;if(n){const e=((e,t)=>{const a=(e||"")+"";if(!a.includes("var("))return a.trim();if(!t)return a.trim();const n=/var\((--[a-z0-9-_]+)(?:\s*,\s*([^)]+))?\)/gi;let o=a,i=0;for(;o.includes("var(")&&8>i;)o=o.replace(n,(e,a,n)=>{const o=t.resolved?.[a]??t.cssVars?.[a];return null!=o?(o+"").trim():n?(n+"").trim():""}),i+=1;return o.trim()})(n.resolved?.[a]??n.cssVars?.[a]??o,n);if(e&&!e.includes("var("))return e}return o&&!o.includes("var(")?o:t}function a(e,a){const n=t(e,""),o=parseFloat(n);return Number.isFinite(o)?o:a}function n(e,a){const n=t(e,"");if(!n)return a;const o=parseFloat((n+"").replace(/px$/i,""));return Number.isFinite(o)?o:a}function o(e,a){const n=t(e,"");if(!n)return a;const o=(n+"").trim().toLowerCase(),i=parseFloat(o);return Number.isFinite(i)?o.endsWith("ms")?i:o.endsWith("s")?1e3*i:i:a}function i(e){zn=e}function r(e,t,a,n){const o=+e;return Number.isFinite(o)?Math.min(a,Math.max(t,o)):n}function l(e,t,a,n){const o=r(e,t,a,n);return Math.round(o)}function s(){const e=+Bn.layoutViewportWidthPx;return Number.isFinite(e)&&e>0?e:Math.max(1,window.innerWidth||1)}function c(e,t){const a=Math.max(1,t||s()),n=+e;return Number.isFinite(n)?n/a*100:0}function d(e,t){const a=Math.max(1,t||s()),n=+e;return Number.isFinite(n)?n/100*a:0}function p(){const e=s(),t=Number.isFinite(Bn.wallThicknessVw)&&Bn.wallThicknessVw>0?Bn.wallThicknessVw:0,a=t>0?t:Number.isFinite(Bn.containerBorderVw)?Bn.containerBorderVw:0;Bn.containerBorderVw=a;const n=d(a,e),o=d(Bn.simulationPaddingVw,e),i=d(Bn.contentPaddingVw,e),r=d(Bn.wallRadiusVw,e),l=Math.max(0,Math.round(Bn.layoutMinContentPaddingPx||0)),c=Math.max(0,Math.round(Bn.layoutMinWallRadiusPx||0)),p=d(t>0?t:a,e),u=Bn.isMobile||Bn.isMobileViewport?Math.max(.5,Bn.mobileWallThicknessXFactor||1):1;Bn.containerBorder=Math.round(n),Bn.containerBorderX=Math.round(n*u),Bn.simulationPadding=Math.round(o),Bn.contentPadding=Math.max(l,Math.round(i));const h=Math.max(.1,Bn.contentPaddingHorizontalRatio||1);Bn.contentPaddingY=Bn.contentPadding,Bn.contentPaddingX=Math.round(Bn.contentPadding*h),Bn.wallRadius=Math.max(c,Math.round(r)),Bn.cornerRadius=Bn.wallRadius,Bn.wallThickness=Math.round(p*u);const f=Math.max(0,d(Bn.cursorInfluenceRadiusVw||0,e));Bn.cursorInfluenceRadiusPx=Math.round(f),Bn.repelRadius=Math.round(f),Bn.weightlessRepelRadius=Math.round(f),Bn.pingPongCursorRadius=Math.round(f),Bn.bubblesDeflectRadius=Math.round(f)}function u(){const e=document.documentElement,t=Bn.isMobile||Bn.isMobileViewport,a=t?Math.max(.5,Bn.mobileWallThicknessXFactor||1):1;e.style.setProperty("--container-border",Bn.containerBorder+"px"),e.style.setProperty("--container-border-x",Bn.containerBorderX+"px"),e.style.setProperty("--container-border-y",Bn.containerBorder+"px"),e.style.setProperty("--simulation-padding",Bn.simulationPadding+"px"),e.style.setProperty("--content-padding",Bn.contentPadding+"px"),e.style.setProperty("--content-padding-x",Bn.contentPaddingX+"px"),e.style.setProperty("--content-padding-y",Bn.contentPaddingY+"px"),e.style.setProperty("--wall-radius",Bn.wallRadius+"px"),e.style.setProperty("--wall-thickness",Bn.wallThickness+"px");const n=Bn.containerBorderVw||1.3;e.style.setProperty("--container-border-vw",""+n),e.style.setProperty("--container-border-x-vw",""+n*a),e.style.setProperty("--wall-thickness-vw",""+(Number.isFinite(Bn.wallThicknessVw)&&Bn.wallThicknessVw>0?Bn.wallThicknessVw:Bn.containerBorderVw)*a);const o=Bn.edgeLabelInsetAdjustPx||0;e.style.setProperty("--edge-label-inset",Bn.containerBorder+8+o+"px"),e.style.setProperty("--edge-label-inset-adjust",o+"px"),e.style.setProperty("--edge-label-mobile-display",t&&Bn.mobileEdgeLabelsVisible?"flex":"none")}function h(e){if(Bn.config={...e},void 0!==e.layoutViewportWidthPx&&(Bn.layoutViewportWidthPx=r(e.layoutViewportWidthPx,0,4096,0)),e.ballMass&&(Bn.ballMassKg=e.ballMass),void 0!==e.gravityMultiplier&&(Bn.gravityMultiplier=e.gravityMultiplier,Bn.gravityMultiplierPit=e.gravityMultiplier),e.restitution&&(Bn.REST=e.restitution),e.friction&&(Bn.FRICTION=e.friction),void 0!==e.ballScale&&(Bn.sizeScale=e.ballScale),void 0!==e.sizeScale&&(Bn.sizeScale=e.sizeScale),void 0!==e.sizeVariationGlobalMul&&(Bn.sizeVariationGlobalMul=r(e.sizeVariationGlobalMul,0,2,Bn.sizeVariationGlobalMul)),void 0!==e.sizeVariationCap&&(Bn.sizeVariationCap=r(e.sizeVariationCap,0,.2,Bn.sizeVariationCap)),void 0!==e.sizeVariationPit&&(Bn.sizeVariationPit=r(e.sizeVariationPit,0,1,Bn.sizeVariationPit)),void 0!==e.sizeVariationPitThrows&&(Bn.sizeVariationPitThrows=r(e.sizeVariationPitThrows,0,1,Bn.sizeVariationPitThrows)),void 0!==e.sizeVariationFlies&&(Bn.sizeVariationFlies=r(e.sizeVariationFlies,0,1,Bn.sizeVariationFlies)),void 0!==e.sizeVariationWeightless&&(Bn.sizeVariationWeightless=r(e.sizeVariationWeightless,0,1,Bn.sizeVariationWeightless)),void 0!==e.sizeVariationWater&&(Bn.sizeVariationWater=r(e.sizeVariationWater,0,1,Bn.sizeVariationWater)),void 0!==e.sizeVariationVortex&&(Bn.sizeVariationVortex=r(e.sizeVariationVortex,0,1,Bn.sizeVariationVortex)),void 0!==e.sizeVariationPingPong&&(Bn.sizeVariationPingPong=r(e.sizeVariationPingPong,0,1,Bn.sizeVariationPingPong)),void 0!==e.sizeVariationMagnetic&&(Bn.sizeVariationMagnetic=r(e.sizeVariationMagnetic,0,1,Bn.sizeVariationMagnetic)),void 0!==e.sizeVariationBubbles&&(Bn.sizeVariationBubbles=r(e.sizeVariationBubbles,0,1,Bn.sizeVariationBubbles)),void 0!==e.sizeVariationKaleidoscope&&(Bn.sizeVariationKaleidoscope=r(e.sizeVariationKaleidoscope,0,1,Bn.sizeVariationKaleidoscope)),void 0!==e.sizeVariationOrbit3d&&(Bn.sizeVariationOrbit3d=r(e.sizeVariationOrbit3d,0,1,Bn.sizeVariationOrbit3d)),void 0!==e.sizeVariationCritters&&(Bn.sizeVariationCritters=r(e.sizeVariationCritters,0,1,Bn.sizeVariationCritters)),void 0!==e.sizeVariationNeural&&(Bn.sizeVariationNeural=r(e.sizeVariationNeural,0,1,Bn.sizeVariationNeural)),void 0!==e.sizeVariationLattice&&(Bn.sizeVariationLattice=r(e.sizeVariationLattice,0,1,Bn.sizeVariationLattice)),void 0!==e.sizeVariationParallaxLinear&&(Bn.sizeVariationParallaxLinear=r(e.sizeVariationParallaxLinear,0,1,Bn.sizeVariationParallaxLinear)),void 0!==e.sizeVariationParallaxPerspective&&(Bn.sizeVariationParallaxPerspective=r(e.sizeVariationParallaxPerspective,0,1,Bn.sizeVariationParallaxPerspective)),void 0!==e.sizeVariation&&(Bn.sizeVariation=e.sizeVariation),Array.isArray(e.colorDistribution)){const t=e.colorDistribution,a=Array.isArray(Bn.colorDistribution)?Bn.colorDistribution:[],n=[];for(let e=0;7>e;e++){const o=a[e]||{},i=t[e]||{},r="string"==typeof i.label&&i.label.trim()?i.label.trim():"string"==typeof o.label?o.label:"Discipline "+(e+1),s=l(i.colorIndex,0,7,l(o.colorIndex,0,7,0)),c=l(i.weight,0,100,l(o.weight,0,100,0));n.push({label:r,colorIndex:s,weight:c})}Bn.colorDistribution=n}if(void 0!==e.pitWarmupFrames&&(Bn.pitWarmupFrames=l(e.pitWarmupFrames,0,240,Bn.pitWarmupFrames)),void 0!==e.pitThrowsWarmupFrames&&(Bn.pitThrowsWarmupFrames=l(e.pitThrowsWarmupFrames,0,240,Bn.pitThrowsWarmupFrames)),void 0!==e.fliesWarmupFrames&&(Bn.fliesWarmupFrames=l(e.fliesWarmupFrames,0,240,Bn.fliesWarmupFrames)),void 0!==e.weightlessWarmupFrames&&(Bn.weightlessWarmupFrames=l(e.weightlessWarmupFrames,0,240,Bn.weightlessWarmupFrames)),void 0!==e.waterWarmupFrames&&(Bn.waterWarmupFrames=l(e.waterWarmupFrames,0,240,Bn.waterWarmupFrames)),void 0!==e.vortexWarmupFrames&&(Bn.vortexWarmupFrames=l(e.vortexWarmupFrames,0,240,Bn.vortexWarmupFrames)),void 0!==e.pingPongWarmupFrames&&(Bn.pingPongWarmupFrames=l(e.pingPongWarmupFrames,0,240,Bn.pingPongWarmupFrames)),void 0!==e.magneticWarmupFrames&&(Bn.magneticWarmupFrames=l(e.magneticWarmupFrames,0,240,Bn.magneticWarmupFrames)),void 0!==e.bubblesWarmupFrames&&(Bn.bubblesWarmupFrames=l(e.bubblesWarmupFrames,0,240,Bn.bubblesWarmupFrames)),void 0!==e.kaleidoscopeWarmupFrames&&(Bn.kaleidoscopeWarmupFrames=l(e.kaleidoscopeWarmupFrames,0,240,Bn.kaleidoscopeWarmupFrames)),void 0!==e.kaleidoscope1WarmupFrames&&(Bn.kaleidoscope1WarmupFrames=l(e.kaleidoscope1WarmupFrames,0,240,Bn.kaleidoscope1WarmupFrames)),void 0!==e.kaleidoscope2WarmupFrames&&(Bn.kaleidoscope2WarmupFrames=l(e.kaleidoscope2WarmupFrames,0,240,Bn.kaleidoscope2WarmupFrames)),void 0!==e.kaleidoscope3WarmupFrames&&(Bn.kaleidoscope3WarmupFrames=l(e.kaleidoscope3WarmupFrames,0,240,Bn.kaleidoscope3WarmupFrames)),void 0!==e.orbit3dWarmupFrames&&(Bn.orbit3dWarmupFrames=l(e.orbit3dWarmupFrames,0,240,Bn.orbit3dWarmupFrames)),void 0!==e.orbit3d2WarmupFrames&&(Bn.orbit3d2WarmupFrames=l(e.orbit3d2WarmupFrames,0,240,Bn.orbit3d2WarmupFrames)),void 0!==e.crittersWarmupFrames&&(Bn.crittersWarmupFrames=l(e.crittersWarmupFrames,0,240,Bn.crittersWarmupFrames)),void 0!==e.neuralWarmupFrames&&(Bn.neuralWarmupFrames=l(e.neuralWarmupFrames,0,240,Bn.neuralWarmupFrames)),void 0!==e.latticeWarmupFrames&&(Bn.latticeWarmupFrames=l(e.latticeWarmupFrames,0,240,Bn.latticeWarmupFrames)),void 0!==e.parallaxLinearWarmupFrames&&(Bn.parallaxLinearWarmupFrames=l(e.parallaxLinearWarmupFrames,0,240,Bn.parallaxLinearWarmupFrames)),void 0!==e.parallaxPerspectiveWarmupFrames&&(Bn.parallaxPerspectiveWarmupFrames=l(e.parallaxPerspectiveWarmupFrames,0,240,Bn.parallaxPerspectiveWarmupFrames)),v(),void 0!==e.maxBalls&&(Bn.maxBalls=e.maxBalls),void 0!==e.repelRadius&&(Bn.repelRadius=e.repelRadius),void 0!==e.repelPower&&(Bn.repelPower=e.repelPower),void 0!==e.repelSoft&&(Bn.repelSoft=e.repelSoft),void 0!==e.repelSoftness&&(Bn.repelSoft=e.repelSoftness),void 0!==e.cursorInfluenceRadiusVw?Bn.cursorInfluenceRadiusVw=r(e.cursorInfluenceRadiusVw,0,80,Bn.cursorInfluenceRadiusVw):void 0!==e.repelRadius&&(Bn.cursorInfluenceRadiusVw=r(e.repelRadius/10,0,80,Bn.cursorInfluenceRadiusVw)),void 0!==e.responsiveScaleMobile&&(Bn.responsiveScaleMobile=e.responsiveScaleMobile),void 0!==e.mobileObjectReductionFactor&&(Bn.mobileObjectReductionFactor=r(e.mobileObjectReductionFactor,0,1,Bn.mobileObjectReductionFactor)),y(),void 0!==e.kaleidoscopeBallCount&&(Bn.kaleidoscopeBallCount=r(e.kaleidoscopeBallCount,10,300,Bn.kaleidoscopeBallCount)),void 0!==e.kaleidoscopeDotSizeVh&&(Bn.kaleidoscopeDotSizeVh=r(e.kaleidoscopeDotSizeVh,.1,6,Bn.kaleidoscopeDotSizeVh)),void 0!==e.kaleidoscopeDotAreaMul&&(Bn.kaleidoscopeDotAreaMul=r(e.kaleidoscopeDotAreaMul,.1,2,Bn.kaleidoscopeDotAreaMul)),void 0!==e.kaleidoscopeSpawnAreaMul&&(Bn.kaleidoscopeSpawnAreaMul=r(e.kaleidoscopeSpawnAreaMul,.2,2,Bn.kaleidoscopeSpawnAreaMul)),void 0!==e.kaleidoscopeSizeVariance&&(Bn.kaleidoscopeSizeVariance=r(e.kaleidoscopeSizeVariance,0,1,Bn.kaleidoscopeSizeVariance)),void 0!==e.kaleidoscope1BallCount&&(Bn.kaleidoscope1BallCount=r(e.kaleidoscope1BallCount,3,300,Bn.kaleidoscope1BallCount)),void 0!==e.kaleidoscope1Wedges&&(Bn.kaleidoscope1Wedges=r(e.kaleidoscope1Wedges,3,24,Bn.kaleidoscope1Wedges)),void 0!==e.kaleidoscope1Speed&&(Bn.kaleidoscope1Speed=r(e.kaleidoscope1Speed,.2,2,Bn.kaleidoscope1Speed)),void 0!==e.kaleidoscope1DotSizeVh&&(Bn.kaleidoscope1DotSizeVh=r(e.kaleidoscope1DotSizeVh,.1,6,Bn.kaleidoscope1DotSizeVh)),void 0!==e.kaleidoscope1DotAreaMul&&(Bn.kaleidoscope1DotAreaMul=r(e.kaleidoscope1DotAreaMul,.1,2,Bn.kaleidoscope1DotAreaMul)),void 0!==e.kaleidoscope1SpawnAreaMul&&(Bn.kaleidoscope1SpawnAreaMul=r(e.kaleidoscope1SpawnAreaMul,.2,2,Bn.kaleidoscope1SpawnAreaMul)),void 0!==e.kaleidoscope1SizeVariance&&(Bn.kaleidoscope1SizeVariance=r(e.kaleidoscope1SizeVariance,0,1,Bn.kaleidoscope1SizeVariance)),void 0!==e.kaleidoscope2BallCount&&(Bn.kaleidoscope2BallCount=r(e.kaleidoscope2BallCount,3,300,Bn.kaleidoscope2BallCount)),void 0!==e.kaleidoscope2Wedges&&(Bn.kaleidoscope2Wedges=r(e.kaleidoscope2Wedges,3,24,Bn.kaleidoscope2Wedges)),void 0!==e.kaleidoscope2Speed&&(Bn.kaleidoscope2Speed=r(e.kaleidoscope2Speed,.2,2,Bn.kaleidoscope2Speed)),void 0!==e.kaleidoscope2DotSizeVh&&(Bn.kaleidoscope2DotSizeVh=r(e.kaleidoscope2DotSizeVh,.1,6,Bn.kaleidoscope2DotSizeVh)),void 0!==e.kaleidoscope2DotAreaMul&&(Bn.kaleidoscope2DotAreaMul=r(e.kaleidoscope2DotAreaMul,.1,2,Bn.kaleidoscope2DotAreaMul)),void 0!==e.kaleidoscope2SpawnAreaMul&&(Bn.kaleidoscope2SpawnAreaMul=r(e.kaleidoscope2SpawnAreaMul,.2,2,Bn.kaleidoscope2SpawnAreaMul)),void 0!==e.kaleidoscope2SizeVariance&&(Bn.kaleidoscope2SizeVariance=r(e.kaleidoscope2SizeVariance,0,1,Bn.kaleidoscope2SizeVariance)),void 0!==e.kaleidoscope3BallCount&&(Bn.kaleidoscope3BallCount=r(e.kaleidoscope3BallCount,3,300,Bn.kaleidoscope3BallCount)),void 0!==e.kaleidoscope3Wedges&&(Bn.kaleidoscope3Wedges=r(e.kaleidoscope3Wedges,3,24,Bn.kaleidoscope3Wedges)),void 0!==e.kaleidoscope3Speed&&(Bn.kaleidoscope3Speed=r(e.kaleidoscope3Speed,.2,2,Bn.kaleidoscope3Speed)),void 0!==e.kaleidoscope3DotSizeVh&&(Bn.kaleidoscope3DotSizeVh=r(e.kaleidoscope3DotSizeVh,.1,6,Bn.kaleidoscope3DotSizeVh)),void 0!==e.kaleidoscope3DotAreaMul&&(Bn.kaleidoscope3DotAreaMul=r(e.kaleidoscope3DotAreaMul,.1,2,Bn.kaleidoscope3DotAreaMul)),void 0!==e.kaleidoscope3SpawnAreaMul&&(Bn.kaleidoscope3SpawnAreaMul=r(e.kaleidoscope3SpawnAreaMul,.2,2,Bn.kaleidoscope3SpawnAreaMul)),void 0!==e.kaleidoscope3SizeVariance&&(Bn.kaleidoscope3SizeVariance=r(e.kaleidoscope3SizeVariance,0,1,Bn.kaleidoscope3SizeVariance)),void 0!==e.kaleidoscopeWedges?Bn.kaleidoscopeWedges=r(e.kaleidoscopeWedges,3,24,Bn.kaleidoscopeWedges):void 0!==e.kaleidoscopeSegments&&(Bn.kaleidoscopeWedges=r(e.kaleidoscopeSegments,3,24,Bn.kaleidoscopeWedges)),void 0!==e.kaleidoscopeMirror&&(Bn.kaleidoscopeMirror=r(e.kaleidoscopeMirror,0,1,Bn.kaleidoscopeMirror)),void 0!==e.kaleidoscopeSpeed)Bn.kaleidoscopeSpeed=r(e.kaleidoscopeSpeed,.2,2,Bn.kaleidoscopeSpeed);else if(void 0!==e.kaleidoscopeSwirlStrength){const t=r(e.kaleidoscopeSwirlStrength,0,800,52);Bn.kaleidoscopeSpeed=r(.2+t/800*1.8,.2,2,Bn.kaleidoscopeSpeed)}void 0!==e.critterCount&&(Bn.critterCount=e.critterCount),void 0!==e.critterSpeed&&(Bn.critterSpeed=e.critterSpeed),void 0!==e.critterMaxSpeed&&(Bn.critterMaxSpeed=e.critterMaxSpeed),void 0!==e.critterStepHz&&(Bn.critterStepHz=e.critterStepHz),void 0!==e.critterStepSharpness&&(Bn.critterStepSharpness=e.critterStepSharpness),void 0!==e.critterTurnNoise&&(Bn.critterTurnNoise=e.critterTurnNoise),void 0!==e.critterTurnDamp&&(Bn.critterTurnDamp=e.critterTurnDamp),void 0!==e.critterTurnSeek&&(Bn.critterTurnSeek=e.critterTurnSeek),void 0!==e.critterAvoidRadius&&(Bn.critterAvoidRadius=e.critterAvoidRadius),void 0!==e.critterAvoidForce&&(Bn.critterAvoidForce=e.critterAvoidForce),void 0!==e.critterEdgeAvoid&&(Bn.critterEdgeAvoid=e.critterEdgeAvoid),void 0!==e.critterMousePull&&(Bn.critterMousePull=e.critterMousePull),Bn.layoutMinContentPaddingPx=void 0!==e.layoutMinContentPaddingPx?r(e.layoutMinContentPaddingPx,0,200,Bn.layoutMinContentPaddingPx):n("--layout-min-content-padding",Bn.layoutMinContentPaddingPx),Bn.layoutMinWallRadiusPx=void 0!==e.layoutMinWallRadiusPx?r(e.layoutMinWallRadiusPx,0,400,Bn.layoutMinWallRadiusPx):n("--layout-min-wall-radius",Bn.layoutMinWallRadiusPx),void 0!==e.critterMouseRadiusVw&&(Bn.critterMouseRadiusVw=e.critterMouseRadiusVw),void 0!==e.critterRestitution&&(Bn.critterRestitution=e.critterRestitution),void 0!==e.critterFriction&&(Bn.critterFriction=e.critterFriction),void 0!==e.neuralBallCount&&(Bn.neuralBallCount=r(e.neuralBallCount,8,260,Bn.neuralBallCount)),void 0!==e.neuralLinkDistanceVw&&(Bn.neuralLinkDistanceVw=r(e.neuralLinkDistanceVw,1,50,Bn.neuralLinkDistanceVw)),void 0!==e.neuralLineOpacity&&(Bn.neuralLineOpacity=r(e.neuralLineOpacity,0,1,Bn.neuralLineOpacity)),void 0!==e.neuralWanderStrength&&(Bn.neuralWanderStrength=r(e.neuralWanderStrength,0,4e3,Bn.neuralWanderStrength)),void 0!==e.neuralMaxLinksPerBall&&(Bn.neuralMaxLinksPerBall=r(e.neuralMaxLinksPerBall,0,16,Bn.neuralMaxLinksPerBall)),void 0!==e.neuralDamping&&(Bn.neuralDamping=r(e.neuralDamping,.8,1,Bn.neuralDamping)),void 0!==e.latticeBallCount&&(Bn.latticeBallCount=r(e.latticeBallCount,8,260,Bn.latticeBallCount)),void 0!==e.latticeSpacingVw&&(Bn.latticeSpacingVw=r(e.latticeSpacingVw,1,40,Bn.latticeSpacingVw)),void 0!==e.latticeStiffness&&(Bn.latticeStiffness=r(e.latticeStiffness,0,20,Bn.latticeStiffness)),void 0!==e.latticeDamping&&(Bn.latticeDamping=r(e.latticeDamping,.5,1,Bn.latticeDamping)),void 0!==e.latticeDisruptRadius&&(Bn.latticeDisruptRadius=r(e.latticeDisruptRadius,50,800,Bn.latticeDisruptRadius)),void 0!==e.latticeDisruptPower&&(Bn.latticeDisruptPower=r(e.latticeDisruptPower,0,20,Bn.latticeDisruptPower)),void 0!==e.latticeMeshWaveStrength&&(Bn.latticeMeshWaveStrength=r(e.latticeMeshWaveStrength,0,50,Bn.latticeMeshWaveStrength)),void 0!==e.latticeMeshWaveSpeed&&(Bn.latticeMeshWaveSpeed=r(e.latticeMeshWaveSpeed,0,3,Bn.latticeMeshWaveSpeed)),void 0!==e.latticeAlignment&&(Bn.latticeAlignment=e.latticeAlignment+""),void 0!==e.parallaxLinearDotCount&&(Bn.parallaxLinearDotCount=r(e.parallaxLinearDotCount,20,220,Bn.parallaxLinearDotCount)),void 0!==e.parallaxLinearGridJitter&&(Bn.parallaxLinearGridJitter=r(e.parallaxLinearGridJitter,0,1,Bn.parallaxLinearGridJitter)),void 0!==e.parallaxLinearFarSpeed&&(Bn.parallaxLinearFarSpeed=r(e.parallaxLinearFarSpeed,0,1.5,Bn.parallaxLinearFarSpeed)),void 0!==e.parallaxLinearMidSpeed&&(Bn.parallaxLinearMidSpeed=r(e.parallaxLinearMidSpeed,0,1.5,Bn.parallaxLinearMidSpeed)),void 0!==e.parallaxLinearNearSpeed&&(Bn.parallaxLinearNearSpeed=r(e.parallaxLinearNearSpeed,0,1.5,Bn.parallaxLinearNearSpeed)),void 0!==e.parallaxLinearGridX&&(Bn.parallaxLinearGridX=l(e.parallaxLinearGridX,3,40,Bn.parallaxLinearGridX)),void 0!==e.parallaxLinearGridY&&(Bn.parallaxLinearGridY=l(e.parallaxLinearGridY,3,40,Bn.parallaxLinearGridY)),void 0!==e.parallaxLinearGridZ&&(Bn.parallaxLinearGridZ=l(e.parallaxLinearGridZ,2,20,Bn.parallaxLinearGridZ)),void 0!==e.parallaxLinearSpanX&&(Bn.parallaxLinearSpanX=r(e.parallaxLinearSpanX,.2,3,Bn.parallaxLinearSpanX)),void 0!==e.parallaxLinearSpanY&&(Bn.parallaxLinearSpanY=r(e.parallaxLinearSpanY,.2,3,Bn.parallaxLinearSpanY)),void 0!==e.parallaxLinearZNear&&(Bn.parallaxLinearZNear=r(e.parallaxLinearZNear,10,1200,Bn.parallaxLinearZNear)),void 0!==e.parallaxLinearZFar&&(Bn.parallaxLinearZFar=r(e.parallaxLinearZFar,50,3e3,Bn.parallaxLinearZFar)),void 0!==e.parallaxLinearFocalLength&&(Bn.parallaxLinearFocalLength=r(e.parallaxLinearFocalLength,80,2e3,Bn.parallaxLinearFocalLength)),void 0!==e.parallaxLinearParallaxStrength&&(Bn.parallaxLinearParallaxStrength=r(e.parallaxLinearParallaxStrength,0,2e3,Bn.parallaxLinearParallaxStrength)),void 0!==e.parallaxLinearDotSizeMul&&(Bn.parallaxLinearDotSizeMul=r(e.parallaxLinearDotSizeMul,.1,6,Bn.parallaxLinearDotSizeMul)),void 0!==e.parallaxLinearFollowStrength&&(Bn.parallaxLinearFollowStrength=r(e.parallaxLinearFollowStrength,1,80,Bn.parallaxLinearFollowStrength)),void 0!==e.parallaxLinearDamping&&(Bn.parallaxLinearDamping=r(e.parallaxLinearDamping,1,80,Bn.parallaxLinearDamping)),void 0!==e.parallaxPerspectiveDotCount&&(Bn.parallaxPerspectiveDotCount=r(e.parallaxPerspectiveDotCount,40,420,Bn.parallaxPerspectiveDotCount)),void 0!==e.parallaxPerspectiveDepthMul&&(Bn.parallaxPerspectiveDepthMul=r(e.parallaxPerspectiveDepthMul,.5,3,Bn.parallaxPerspectiveDepthMul)),void 0!==e.parallaxPerspectiveFocalLength&&(Bn.parallaxPerspectiveFocalLength=r(e.parallaxPerspectiveFocalLength,80,1e3,Bn.parallaxPerspectiveFocalLength)),void 0!==e.parallaxPerspectiveFollowStrength&&(Bn.parallaxPerspectiveFollowStrength=r(e.parallaxPerspectiveFollowStrength,1,40,Bn.parallaxPerspectiveFollowStrength)),void 0!==e.parallaxPerspectiveDamping&&(Bn.parallaxPerspectiveDamping=r(e.parallaxPerspectiveDamping,1,40,Bn.parallaxPerspectiveDamping)),void 0!==e.parallaxPerspectiveZ1&&(Bn.parallaxPerspectiveZ1=r(e.parallaxPerspectiveZ1,200,2e3,Bn.parallaxPerspectiveZ1)),void 0!==e.parallaxPerspectiveZ2&&(Bn.parallaxPerspectiveZ2=r(e.parallaxPerspectiveZ2,150,1500,Bn.parallaxPerspectiveZ2)),void 0!==e.parallaxPerspectiveZ3&&(Bn.parallaxPerspectiveZ3=r(e.parallaxPerspectiveZ3,100,1e3,Bn.parallaxPerspectiveZ3)),void 0!==e.parallaxPerspectiveZ4&&(Bn.parallaxPerspectiveZ4=r(e.parallaxPerspectiveZ4,40,600,Bn.parallaxPerspectiveZ4)),void 0!==e.parallaxPerspectiveZ5&&(Bn.parallaxPerspectiveZ5=r(e.parallaxPerspectiveZ5,10,300,Bn.parallaxPerspectiveZ5)),void 0!==e.parallaxPerspectiveGridX&&(Bn.parallaxPerspectiveGridX=l(e.parallaxPerspectiveGridX,3,50,Bn.parallaxPerspectiveGridX)),void 0!==e.parallaxPerspectiveGridY&&(Bn.parallaxPerspectiveGridY=l(e.parallaxPerspectiveGridY,3,50,Bn.parallaxPerspectiveGridY)),void 0!==e.parallaxPerspectiveGridZ&&(Bn.parallaxPerspectiveGridZ=l(e.parallaxPerspectiveGridZ,2,25,Bn.parallaxPerspectiveGridZ)),void 0!==e.parallaxPerspectiveSpanX&&(Bn.parallaxPerspectiveSpanX=r(e.parallaxPerspectiveSpanX,.2,3,Bn.parallaxPerspectiveSpanX)),void 0!==e.parallaxPerspectiveSpanY&&(Bn.parallaxPerspectiveSpanY=r(e.parallaxPerspectiveSpanY,.2,3,Bn.parallaxPerspectiveSpanY)),void 0!==e.parallaxPerspectiveZNear&&(Bn.parallaxPerspectiveZNear=r(e.parallaxPerspectiveZNear,10,1200,Bn.parallaxPerspectiveZNear)),void 0!==e.parallaxPerspectiveZFar&&(Bn.parallaxPerspectiveZFar=r(e.parallaxPerspectiveZFar,50,4e3,Bn.parallaxPerspectiveZFar)),void 0!==e.parallaxPerspectiveParallaxStrength&&(Bn.parallaxPerspectiveParallaxStrength=r(e.parallaxPerspectiveParallaxStrength,0,2e3,Bn.parallaxPerspectiveParallaxStrength)),void 0!==e.parallaxPerspectiveRandomness&&(Bn.parallaxPerspectiveRandomness=r(e.parallaxPerspectiveRandomness,0,1,Bn.parallaxPerspectiveRandomness)),void 0!==e.parallaxPerspectiveDotSizeMul&&(Bn.parallaxPerspectiveDotSizeMul=r(e.parallaxPerspectiveDotSizeMul,.1,6,Bn.parallaxPerspectiveDotSizeMul));for(const[t,a]of Object.entries(e||{}))t in Bn&&"config"!==t&&"soundConfig"!==t&&"soundPreset"!==t&&"function"!=typeof Bn[t]&&(Array.isArray(a)||null===a||["string","number","boolean"].includes(typeof a))&&void 0!==a&&(Bn[t]=a);if(void 0!==e.sceneImpactEnabled&&(Bn.sceneImpactEnabled=!!e.sceneImpactEnabled),void 0!==e.sceneImpactMul?Bn.sceneImpactMul=r(e.sceneImpactMul,0,.05,Bn.sceneImpactMul):void 0!==e.brandLogoImpactMul&&(Bn.sceneImpactMul=r(e.brandLogoImpactMul,0,.05,Bn.sceneImpactMul)),void 0!==e.sceneImpactMobileMulFactor&&(Bn.sceneImpactMobileMulFactor=r(e.sceneImpactMobileMulFactor,.25,3,Bn.sceneImpactMobileMulFactor)),void 0!==e.sceneImpactLogoCompMul&&(Bn.sceneImpactLogoCompMul=r(e.sceneImpactLogoCompMul,.25,6,Bn.sceneImpactLogoCompMul)),void 0!==e.sceneImpactOvershoot?Bn.sceneImpactOvershoot=r(e.sceneImpactOvershoot,0,.8,Bn.sceneImpactOvershoot):void 0!==e.brandLogoOvershoot&&(Bn.sceneImpactOvershoot=r(e.brandLogoOvershoot,0,.8,Bn.sceneImpactOvershoot)),void 0!==e.sceneImpactAnticipation?Bn.sceneImpactAnticipation=r(e.sceneImpactAnticipation,0,.6,Bn.sceneImpactAnticipation):void 0!==e.brandLogoAnticipation&&(Bn.sceneImpactAnticipation=r(e.brandLogoAnticipation,0,.6,Bn.sceneImpactAnticipation)),void 0!==e.sceneImpactPressMs?Bn.sceneImpactPressMs=r(e.sceneImpactPressMs,20,300,Bn.sceneImpactPressMs):void 0!==e.brandLogoPressMs&&(Bn.sceneImpactPressMs=r(e.brandLogoPressMs,20,300,Bn.sceneImpactPressMs)),void 0!==e.sceneImpactReleaseMs?Bn.sceneImpactReleaseMs=r(e.sceneImpactReleaseMs,40,1200,Bn.sceneImpactReleaseMs):void 0!==e.brandLogoReleaseMs&&(Bn.sceneImpactReleaseMs=r(e.brandLogoReleaseMs,40,1200,Bn.sceneImpactReleaseMs)),void 0!==e.sceneChangeSoundEnabled&&(Bn.sceneChangeSoundEnabled=!!e.sceneChangeSoundEnabled),void 0!==e.sceneChangeSoundIntensity&&(Bn.sceneChangeSoundIntensity=r(e.sceneChangeSoundIntensity,0,1,Bn.sceneChangeSoundIntensity)),void 0!==e.sceneChangeSoundRadius&&(Bn.sceneChangeSoundRadius=r(e.sceneChangeSoundRadius,6,60,Bn.sceneChangeSoundRadius)),void 0!==e.containerBorder&&(Bn.containerBorder=e.containerBorder),void 0!==e.simulationPadding&&(Bn.simulationPadding=e.simulationPadding),void 0!==e.contentPadding&&(Bn.contentPadding=e.contentPadding),Bn.bgLight=void 0!==e.bgLight?e.bgLight:t("--bg-light",Bn.bgLight),Bn.bgDark=void 0!==e.bgDark?e.bgDark:t("--bg-dark",Bn.bgDark),Bn.frameColorLight=void 0!==e.frameColorLight?e.frameColorLight:t("--frame-color-light",Bn.frameColorLight),Bn.frameColorDark=void 0!==e.frameColorDark?e.frameColorDark:t("--frame-color-dark",Bn.frameColorDark),void 0!==e.frameColor?(Bn.frameColor=e.frameColor,Bn.frameColorLight=e.frameColor,Bn.frameColorDark=e.frameColor):Bn.frameColor=Bn.frameColorLight,Bn.textColorLight=void 0!==e.textColorLight?e.textColorLight:t("--text-color-light",Bn.textColorLight),Bn.textColorLightMuted=void 0!==e.textColorLightMuted?e.textColorLightMuted:t("--text-color-light-muted",Bn.textColorLightMuted),Bn.textColorDark=void 0!==e.textColorDark?e.textColorDark:t("--text-color-dark",Bn.textColorDark),Bn.textColorDarkMuted=void 0!==e.textColorDarkMuted?e.textColorDarkMuted:t("--text-color-dark-muted",Bn.textColorDarkMuted),Bn.edgeLabelColorLight=void 0!==e.edgeLabelColorLight?e.edgeLabelColorLight:t("--edge-label-color-light",Bn.edgeLabelColorLight),Bn.edgeLabelColorDark=void 0!==e.edgeLabelColorDark?e.edgeLabelColorDark:t("--edge-label-color-dark",Bn.edgeLabelColorDark),void 0!==e.edgeLabelInsetAdjustPx&&(Bn.edgeLabelInsetAdjustPx=r(e.edgeLabelInsetAdjustPx,-500,500,Bn.edgeLabelInsetAdjustPx)),Bn.linkHoverColor=void 0!==e.linkHoverColor?e.linkHoverColor:t("--link-hover-color",Bn.linkHoverColor),Bn.logoColorLight=void 0!==e.logoColorLight?e.logoColorLight:t("--logo-color-light",Bn.logoColorLight),Bn.logoColorDark=void 0!==e.logoColorDark?e.logoColorDark:t("--logo-color-dark",Bn.logoColorDark),Bn.portfolioLogoColorLight=void 0!==e.portfolioLogoColorLight?e.portfolioLogoColorLight:t("--portfolio-logo-color-light",Bn.portfolioLogoColorLight),Bn.portfolioLogoColorDark=void 0!==e.portfolioLogoColorDark?e.portfolioLogoColorDark:t("--portfolio-logo-color-dark",Bn.portfolioLogoColorDark),void 0!==e.noiseBackOpacity&&(Bn.noiseBackOpacity=r(e.noiseBackOpacity,0,.3,Bn.noiseBackOpacity)),void 0!==e.noiseFrontOpacity&&(Bn.noiseFrontOpacity=r(e.noiseFrontOpacity,0,.3,Bn.noiseFrontOpacity)),void 0!==e.noiseBackOpacityDark&&(Bn.noiseBackOpacityDark=r(e.noiseBackOpacityDark,0,.5,Bn.noiseBackOpacityDark)),void 0!==e.noiseFrontOpacityDark&&(Bn.noiseFrontOpacityDark=r(e.noiseFrontOpacityDark,0,.5,Bn.noiseFrontOpacityDark)),void 0!==e.noiseEnabled&&(Bn.noiseEnabled=!!e.noiseEnabled),void 0!==e.noiseSeed&&(Bn.noiseSeed=l(e.noiseSeed,0,999999,Bn.noiseSeed)),void 0!==e.noiseTextureSize&&(Bn.noiseTextureSize=l(e.noiseTextureSize,64,512,Bn.noiseTextureSize)),void 0!==e.noiseDistribution){const t=e.noiseDistribution+"";Bn.noiseDistribution="uniform"===t||"gaussian"===t?t:Bn.noiseDistribution}if(void 0!==e.noiseMonochrome&&(Bn.noiseMonochrome=!!e.noiseMonochrome),void 0!==e.noiseChroma&&(Bn.noiseChroma=r(e.noiseChroma,0,1,Bn.noiseChroma)),void 0!==e.noiseMotion){const t=e.noiseMotion+"";Bn.noiseMotion="jitter"===t||"drift"===t||"static"===t?t:Bn.noiseMotion}void 0!==e.noiseMotionAmount&&(Bn.noiseMotionAmount=r(e.noiseMotionAmount,0,2.5,Bn.noiseMotionAmount)),void 0!==e.noiseSpeedBackMs&&(Bn.noiseSpeedBackMs=l(e.noiseSpeedBackMs,0,1e4,Bn.noiseSpeedBackMs)),void 0!==e.noiseSpeedFrontMs&&(Bn.noiseSpeedFrontMs=l(e.noiseSpeedFrontMs,0,1e4,Bn.noiseSpeedFrontMs)),void 0!==e.noiseFlicker&&(Bn.noiseFlicker=r(e.noiseFlicker,0,1,Bn.noiseFlicker)),void 0!==e.noiseFlickerSpeedMs&&(Bn.noiseFlickerSpeedMs=l(e.noiseFlickerSpeedMs,0,5e3,Bn.noiseFlickerSpeedMs)),void 0!==e.noiseBlurPx&&(Bn.noiseBlurPx=r(e.noiseBlurPx,0,6,Bn.noiseBlurPx)),void 0!==e.noiseContrast&&(Bn.noiseContrast=r(e.noiseContrast,.25,5,Bn.noiseContrast)),void 0!==e.noiseBrightness&&(Bn.noiseBrightness=r(e.noiseBrightness,.25,3,Bn.noiseBrightness)),void 0!==e.noiseSaturation&&(Bn.noiseSaturation=r(e.noiseSaturation,0,3,Bn.noiseSaturation)),void 0!==e.noiseHue&&(Bn.noiseHue=r(e.noiseHue,0,360,Bn.noiseHue)),void 0!==e.noiseSizeBase&&(Bn.noiseSizeBase=r(e.noiseSizeBase,20,400,Bn.noiseSizeBase)),void 0!==e.noiseSizeTop&&(Bn.noiseSizeTop=r(e.noiseSizeTop,20,600,Bn.noiseSizeTop)),void 0!==e.noiseTopOpacity&&(Bn.noiseTopOpacity=r(e.noiseTopOpacity,0,.25,Bn.noiseTopOpacity)),void 0!==e.detailNoiseOpacity&&(Bn.detailNoiseOpacity=r(e.detailNoiseOpacity,0,1,Bn.detailNoiseOpacity)),void 0!==e.wallThickness&&(Bn.wallThickness=e.wallThickness),void 0!==e.wallRadius&&(Bn.wallRadius=e.wallRadius,Bn.cornerRadius=e.wallRadius),void 0!==e.wallInset&&(Bn.wallInset=e.wallInset),void 0!==e.wallInset&&(Bn.wallInset=e.wallInset),void 0!==e.ballSpacing&&(Bn.ballSpacing=e.ballSpacing),void 0!==e.wallPreset&&(Bn.wallPreset=e.wallPreset),void 0!==e.wallSoftness&&(Bn.wallSoftness=e.wallSoftness),void 0!==e.wallBounciness&&(Bn.wallBounciness=e.wallBounciness),void 0!==e.wallWobbleMaxDeform&&(Bn.wallWobbleMaxDeform=e.wallWobbleMaxDeform),void 0!==e.wallWobbleStiffness&&(Bn.wallWobbleStiffness=e.wallWobbleStiffness),void 0!==e.wallWobbleDamping&&(Bn.wallWobbleDamping=e.wallWobbleDamping),void 0!==e.wallWobbleSigma&&(Bn.wallWobbleSigma=e.wallWobbleSigma),void 0!==e.wallWobbleCornerClamp&&(Bn.wallWobbleCornerClamp=e.wallWobbleCornerClamp),void 0!==e.wallWobbleMaxVel&&(Bn.wallWobbleMaxVel=e.wallWobbleMaxVel),void 0!==e.wallWobbleMaxImpulse&&(Bn.wallWobbleMaxImpulse=e.wallWobbleMaxImpulse),void 0!==e.wallWobbleMaxEnergyPerStep&&(Bn.wallWobbleMaxEnergyPerStep=e.wallWobbleMaxEnergyPerStep),void 0!==e.wallWobbleImpactThreshold&&(Bn.wallWobbleImpactThreshold=e.wallWobbleImpactThreshold),void 0!==e.wallWobbleSettlingSpeed&&(Bn.wallWobbleSettlingSpeed=e.wallWobbleSettlingSpeed),void 0!==e.wallPhysicsSamples&&(Bn.wallPhysicsSamples=e.wallPhysicsSamples),void 0!==e.wallPhysicsSkipInactive&&(Bn.wallPhysicsSkipInactive=e.wallPhysicsSkipInactive),void 0!==e.wallPhysicsUpdateHz&&(Bn.wallPhysicsUpdateHz=e.wallPhysicsUpdateHz),void 0!==e.wallPhysicsMaxSubstepHz&&(Bn.wallPhysicsMaxSubstepHz=e.wallPhysicsMaxSubstepHz),void 0!==e.wallPhysicsInterpolation&&(Bn.wallPhysicsInterpolation=e.wallPhysicsInterpolation),void 0!==e.wallPhysicsAdaptiveSamples&&(Bn.wallPhysicsAdaptiveSamples=e.wallPhysicsAdaptiveSamples),void 0!==e.wallPhysicsMinSamples&&(Bn.wallPhysicsMinSamples=e.wallPhysicsMinSamples),void 0!==e.wallVisualDeformMul&&(Bn.wallVisualDeformMul=e.wallVisualDeformMul),void 0!==e.wallRenderDecimation&&(Bn.wallRenderDecimation=e.wallRenderDecimation),void 0!==e.wallColorLight&&(Bn.frameColorLight=e.wallColorLight,Bn.frameColor=e.wallColorLight),void 0!==e.wallColorDark&&(Bn.frameColorDark=e.wallColorDark,e.wallColorLight||(Bn.frameColor=e.wallColorDark)),void 0!==e.gateOverlayEnabled&&(Bn.gateOverlayEnabled=e.gateOverlayEnabled),void 0!==e.gateOverlayOpacity&&(Bn.gateOverlayOpacity=e.gateOverlayOpacity),void 0!==e.gateOverlayBlurPx&&(Bn.gateOverlayBlurPx=e.gateOverlayBlurPx),void 0!==e.gateOverlayTransitionMs&&(Bn.gateOverlayTransitionMs=e.gateOverlayTransitionMs),void 0!==e.gateOverlayTransitionOutMs&&(Bn.gateOverlayTransitionOutMs=e.gateOverlayTransitionOutMs),void 0!==e.orbit3dMoonCount&&(Bn.orbit3dMoonCount=r(e.orbit3dMoonCount,1,1e3,Bn.orbit3dMoonCount)),void 0!==e.orbit3dGravity&&(Bn.orbit3dGravity=r(e.orbit3dGravity,1e3,5e5,Bn.orbit3dGravity)),void 0!==e.orbit3dMoonMass&&(Bn.orbit3dMoonMass=r(e.orbit3dMoonMass,.1,100,Bn.orbit3dMoonMass)),void 0!==e.orbit3dVelocityMult&&(Bn.orbit3dVelocityMult=r(e.orbit3dVelocityMult,10,1e3,Bn.orbit3dVelocityMult)),void 0!==e.orbit3dTargetOrbit&&(Bn.orbit3dTargetOrbit=r(e.orbit3dTargetOrbit,1,100,Bn.orbit3dTargetOrbit)),void 0!==e.orbit3dMinOrbit&&(Bn.orbit3dMinOrbit=r(e.orbit3dMinOrbit,1,100,Bn.orbit3dMinOrbit)),void 0!==e.orbit3dMaxOrbit&&(Bn.orbit3dMaxOrbit=r(e.orbit3dMaxOrbit,1,200,Bn.orbit3dMaxOrbit)),void 0!==e.orbit3dDepthScale&&(Bn.orbit3dDepthScale=r(e.orbit3dDepthScale,0,1.5,Bn.orbit3dDepthScale)),void 0!==e.orbit3dDamping&&(Bn.orbit3dDamping=r(e.orbit3dDamping,.01,.2,Bn.orbit3dDamping)),void 0!==e.orbit3d2MoonCount&&(Bn.orbit3d2MoonCount=r(e.orbit3d2MoonCount,1,300,Bn.orbit3d2MoonCount)),void 0!==e.orbit3d2Gravity&&(Bn.orbit3d2Gravity=r(e.orbit3d2Gravity,1e3,5e5,Bn.orbit3d2Gravity)),void 0!==e.orbit3d2VelocityMult&&(Bn.orbit3d2VelocityMult=r(e.orbit3d2VelocityMult,.1,2,Bn.orbit3d2VelocityMult)),void 0!==e.orbit3d2MinOrbit&&(Bn.orbit3d2MinOrbit=r(e.orbit3d2MinOrbit,1,50,Bn.orbit3d2MinOrbit)),void 0!==e.orbit3d2MaxOrbit&&(Bn.orbit3d2MaxOrbit=r(e.orbit3d2MaxOrbit,1,50,Bn.orbit3d2MaxOrbit)),void 0!==e.orbit3d2DepthScale&&(Bn.orbit3d2DepthScale=r(e.orbit3d2DepthScale,0,.95,Bn.orbit3d2DepthScale)),void 0!==e.orbit3d2Damping&&(Bn.orbit3d2Damping=r(e.orbit3d2Damping,0,1,Bn.orbit3d2Damping)),void 0!==e.orbit3d2FollowSmoothing&&(Bn.orbit3d2FollowSmoothing=r(e.orbit3d2FollowSmoothing,1,200,Bn.orbit3d2FollowSmoothing)),void 0!==e.orbit3d2Softening&&(Bn.orbit3d2Softening=r(e.orbit3d2Softening,1,100,Bn.orbit3d2Softening));const o=s();if(void 0!==e.containerBorderVw&&(Bn.containerBorderVw=r(e.containerBorderVw,0,20,Bn.containerBorderVw)),void 0!==e.simulationPaddingVw&&(Bn.simulationPaddingVw=r(e.simulationPaddingVw,0,20,Bn.simulationPaddingVw)),void 0!==e.contentPaddingVw&&(Bn.contentPaddingVw=r(e.contentPaddingVw,0,40,Bn.contentPaddingVw)),void 0!==e.contentPaddingHorizontalRatio&&(Bn.contentPaddingHorizontalRatio=r(e.contentPaddingHorizontalRatio,.1,3,Bn.contentPaddingHorizontalRatio)),void 0!==e.mobileWallThicknessXFactor&&(Bn.mobileWallThicknessXFactor=r(e.mobileWallThicknessXFactor,.5,3,Bn.mobileWallThicknessXFactor)),void 0!==e.mobileEdgeLabelsVisible&&(Bn.mobileEdgeLabelsVisible=!!e.mobileEdgeLabelsVisible),void 0!==e.wallRadiusVw&&(Bn.wallRadiusVw=r(e.wallRadiusVw,0,40,Bn.wallRadiusVw)),void 0!==e.wallThicknessVw&&(Bn.wallThicknessVw=r(e.wallThicknessVw,0,20,Bn.wallThicknessVw)),!Number.isFinite(Bn.containerBorderVw)||0>=Bn.containerBorderVw){const e=a("--container-border-vw",null);Number.isFinite(e)&&e>0&&(Bn.containerBorderVw=e)}if(!Number.isFinite(Bn.wallRadiusVw)||0>=Bn.wallRadiusVw){const e=a("--wall-radius-vw",null);Number.isFinite(e)&&e>0&&(Bn.wallRadiusVw=e)}if(!Number.isFinite(Bn.wallThicknessVw)||0>=Bn.wallThicknessVw){const e=a("--wall-thickness-vw",null);Number.isFinite(e)&&e>0&&(Bn.wallThicknessVw=e)}Number.isFinite(Bn.containerBorderVw)&&Bn.containerBorderVw>0||(Bn.containerBorderVw=c(Bn.containerBorder,o)),Number.isFinite(Bn.simulationPaddingVw)&&Bn.simulationPaddingVw>=0||(Bn.simulationPaddingVw=c(Bn.simulationPadding,o)),Number.isFinite(Bn.contentPaddingVw)&&Bn.contentPaddingVw>0||(Bn.contentPaddingVw=c(Bn.contentPadding,o)),Number.isFinite(Bn.wallRadiusVw)&&Bn.wallRadiusVw>0||(Bn.wallRadiusVw=c(Bn.wallRadius,o)),Number.isFinite(Bn.wallThicknessVw)&&Bn.wallThicknessVw>0||(Bn.wallThicknessVw=c(Bn.wallThickness,o)),p()}function f(){return Bn}function m(e){const t=f(),a=Math.round(+e||0);return Math.max(0,t.isMobile?Math.round(a*Math.max(0,Math.min(1,+(t.mobileObjectReductionFactor??.7)))):a)}function b(e,t,a){Bn.canvas=e,Bn.ctx=t,Bn.container=a}function g(e){Bn.currentMode=e}function M(){Bn.balls.length=0}function y(){const e=navigator.userAgent||"",t=/iPad/.test(e)||/Mac/.test(e)&&navigator.maxTouchPoints>1,a=/iPhone/.test(e);let n=!1;try{n=!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(s){}const o=!(!t&&!a),i=n,r=o,l=o||n?Bn.responsiveScaleMobile:1;if(Bn.isMobile!==r||Bn.isMobileViewport!==i||Math.abs((Bn.responsiveScale??1)-l)>1e-6){Bn.isMobile=r,Bn.isMobileViewport=i,Bn.responsiveScale=l,(Bn.isMobile||Bn.isMobileViewport)&&console.log(`✓ Mobile scaling active - ball scale: ${Bn.responsiveScale}x (${Bn.isMobile?"device":"viewport"})`),v();try{const e=(Bn.R_MIN+Bn.R_MAX)/2;if(Number.isFinite(e)&&e>0&&Array.isArray(Bn.balls)&&Bn.balls.length)for(let t=0;Bn.balls.length>t;t++){const a=Bn.balls[t];a&&(a.r=e,a.rBase=e)}}catch(s){}}}function v(){Bn.R_MED=Math.max(1,(Bn.R_MIN_BASE+Bn.R_MAX_BASE)/2*Bn.sizeScale*Bn.responsiveScale);const e=r(Bn.sizeVariationCap,0,.2,.12),t=r(Bn.sizeVariationGlobalMul,0,2,1),a=r(e*t,0,.2,e);Bn.R_MIN=Math.max(1,Bn.R_MED*(1-a)),Bn.R_MAX=Math.max(Bn.R_MIN,Bn.R_MED*(1+a))}function w(e){const t=+e;return Number.isFinite(t)?0>t?0:t>1?1:t:0}function x(e){const t=((e||"")+"").trim();if(!t)return null;const a="#"===t[0]?t.slice(1):t;if(3!==a.length&&6!==a.length)return null;const n=parseInt(3===a.length?a[0]+a[0]+a[1]+a[1]+a[2]+a[2]:a,16);return Number.isFinite(n)?{r:n>>16&255,g:n>>8&255,b:255&n}:null}function S({r:e,g:t,b:a}){return"#"+((255&e)<<16|(255&t)<<8|255&a).toString(16).padStart(6,"0")}function k(e,{satMul:t=0,valMul:a=0}={}){const n=x(e);if(!n)return((e||"")+"").trim()||"#ffffff";const o=(({r:e,g:t,b:a})=>{const n=w(e),o=w(t),i=w(a),r=Math.max(n,o,i),l=r-Math.min(n,o,i);let s=0;return l>0&&(s=r===n?(o-i)/l%6:r===o?(i-n)/l+2:(n-o)/l+4,s*=60,0>s&&(s+=360)),{h:s,s:r>0?l/r:0,v:r}})({r:n.r/255,g:n.g/255,b:n.b/255}),i=(e=>Math.max(0,Math.min(.88,+e||0)))(o.s*(1+(+t||0))),r=w(o.v*(1+(+a||0))),l=(({h:e,s:t,v:a})=>{const n=(+e%360+360)%360,o=w(t),i=w(a),r=i*o,l=r*(1-Math.abs(n/60%2-1)),s=i-r;let c=0,d=0,p=0;return 60>n?(c=r,d=l,p=0):120>n?(c=l,d=r,p=0):180>n?(c=0,d=r,p=l):240>n?(c=0,d=l,p=r):300>n?(c=l,d=0,p=r):(c=r,d=0,p=l),{r:c+s,g:d+s,b:p+s}})({h:o.h,s:i,v:r});return S({r:Math.round(255*l.r),g:Math.round(255*l.g),b:Math.round(255*l.b)})}function C(e,t,a){return Math.round(e+(t-e)*a)}function P(e,t,a){const n=w(a),o=x(e),i=x(t);return o||i?o?i?S({r:C(o.r,i.r,n),g:C(o.g,i.g,n),b:C(o.b,i.b,n)}):e+"":t+"":"#ffffff"}function F(e){const t=+e;return Number.isFinite(t)?0>t?0:t>255?255:t:0}function T(e,t,a=1){const n=Math.max(1,+a||1),o=x(e),i=x(t);return o||i?o&&i?S({r:F(o.r+(i.r-o.r)*n),g:F(o.g+(i.g-o.g)*n),b:F(o.b+(i.b-o.b)*n)}):t+"":"#ffffff"}function D(e,t,a=.5){const n=w(a),o=[,,,,,,,,];for(let i=0;8>i;i++)o[i]=P(e?.[i],t?.[i],n);return o}function I(e,t,a=1.25){const n=[,,,,,,,,];for(let i=0;8>i;i++)n[i]=t?.[i];const o=[3,5,6,7];for(let i=0;o.length>i;i++){const r=o[i];n[r]=T(e?.[r],t?.[r],a)}return n}function L(e,t){const a=[,,,,,,,,];for(let o=0;8>o;o++)a[o]=e?.[o];const n=[3,5,6,7];for(let o=0;n.length>o;o++){const e=n[o];a[e]=k(a[e],t)}return a}function A(e,t,a,n=t){const o=+e;if(!Number.isFinite(o))return n;const i=Math.floor(o);return t>i?t:i>a?a:i}function K(e,t,a){const n=+e;if(!Number.isFinite(n))return t;const o=Math.floor(n);return t>o?t:o>a?a:o}function O(e){return Array.isArray(e)&&e.every(e=>Number.isFinite(+e))}function W(e){const t=((e||"")+"").trim();if(!t)return null;const a="#"===t[0]?t.slice(1):t;if(3!==a.length&&6!==a.length)return null;const n=parseInt(3===a.length?a[0]+a[0]+a[1]+a[1]+a[2]+a[2]:a,16);return Number.isFinite(n)?{r:(n>>16&255)/255,g:(n>>8&255)/255,b:(255&n)/255}:null}function E(e){return e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92}function R(e){const t=W(e);return t?.2126*E(t.r)+.7152*E(t.g)+.0722*E(t.b):1}function z(e){const t=W(e);if(!t)return 0;const a=Math.max(t.r,t.g,t.b);return a>0?(a-Math.min(t.r,t.g,t.b))/a:0}function B(e,t){const a=t||f(),n=e&&e.length?e:[],o=Math.min(7,n.length-1);if(0>o)return[];const i=Number.isFinite(+a.cursorColorLumaMax)?+a.cursorColorLumaMax:.62,r=O(a.cursorColorAllowIndices)?a.cursorColorAllowIndices.map(e=>K(e,0,7)):[],l=O(a.cursorColorDenyIndices)?a.cursorColorDenyIndices.map(e=>K(e,0,7)):[],s=new Set(l),c=r.length?new Set(r):null,d=[];for(let u=0;o>=u;u++){if(s.has(u))continue;if(c&&!c.has(u))continue;const e=n[u];e&&(R(e)>i||.18>z(e)||d.push(u))}if(d.length)return d;const p=[];for(const u of qn)u>o||s.has(u)||c&&!c.has(u)||p.push(u);if(p.length)return p;for(let u=0;o>=u;u++)s.has(u)||c&&!c.has(u)||p.push(u);return p}function V(e,{forceMode:t}={}){const a=f(),n=a.currentColors,o=B(n,a),i=K(e,0,7),r=o.includes(i)?i:o[0]??i,l=((e,t)=>{const a=e&&e.length?e:[];return a[K(t,0,Math.max(0,Math.min(7,a.length-1)))]||"#000000"})(n,r);return t&&(a.cursorColorMode=t),a.cursorColorIndex=r,a.cursorColorHex=l,(e=>{try{document.documentElement.style.setProperty("--cursor-color",(e+"").trim()||"#000000")}catch(t){}})(l),{index:r,hex:l}}function $(){const e=f();if("auto"!==e.cursorColorMode)return V(e.cursorColorIndex,{forceMode:e.cursorColorMode}),!1;const t=B(e.currentColors,e);if(!t.length)return!1;const a=Number.isFinite(+e.o)?+e.o:-1;let n=t[Math.random()*t.length|0];return t.length>1&&n===a&&(n=t[Math.random()*t.length|0],n===a&&(n=t[(t.indexOf(a)+1)%t.length])),e.o=n,V(n,{forceMode:"auto"}),!0}function N(e){const t=f(),a=jn[e];return a?t.isDarkMode?a.dark:a.light:jn.industrialTeal.light}function _(){const e=f(),t=e.currentColors;if(!t||0===t.length)return console.warn("No colors available, using fallback"),"#ffffff";const a=(e=>{const t=e?.colorDistribution;return Array.isArray(t)?t:null})(e);if(a&&a.length){let e=0;for(let t=0;a.length>t;t++){const n=+a[t]?.weight;Number.isFinite(n)&&n>0&&(e+=n)}if(e>0){let n=Math.random()*e;for(let e=0;a.length>e;e++){const o=a[e],i=+o?.weight;if(Number.isFinite(i)&&i>0&&(n-=i,0>=n))return t[A(o?.colorIndex,0,7,0)]||t[0]||"#ffffff"}const o=a[a.length-1];return t[A(o?.colorIndex,0,7,0)]||t[0]||"#ffffff"}}const n=Math.random();let o=0;const i=Math.min(t.length,8,8);for(let r=0;i>r;r++)if(o+=Xn[r],o>=n)return t[r];return t[Math.min(t.length-1,7)]||"#ffffff"}function G(e){const t=f();t.currentTemplate=e,t.currentColors=N(e);try{localStorage.setItem(Yn,(e||"")+"")}catch(a){}try{const t=document.getElementById("colorSelect");t&&(t.value=e)}catch(a){}"auto"!==t.cursorColorMode&&"manual"!==t.cursorColorMode&&(t.cursorColorMode="auto"),V(t.cursorColorIndex,{forceMode:t.cursorColorMode}),(()=>{const e=f().balls;for(let t=0;e.length>t;t++)e[t].color=_()})(),(e=>{try{const t=document.documentElement,a=(e&&e.length?e:[]).slice(0,8);for(let e=0;8>e;e++)t.style.setProperty("--ball-"+(e+1),a[e]||"#ffffff")}catch(a){}})(t.currentColors),(()=>{const e=f().currentColors;for(let t=1;8>=t;t++){const a=document.getElementById("color"+t),n=document.getElementById(`color${t}Val`);a&&e[t-1]&&(a.value=e[t-1],n&&(n.textContent=e[t-1].toUpperCase()))}})();try{window.dispatchEvent(new CustomEvent("bb:paletteChanged",{detail:{template:e}}))}catch(a){}}function H(){const e=document.getElementById("colorSelect");if(!e)return;e.innerHTML="";for(const a of Zn){const t=jn[a];if(!t)continue;const n=document.createElement("option");n.value=a,n.textContent=t.label,e.appendChild(n)}const t=f();e.value=t.currentTemplate}function j(){const e=f(),t=Zn.length?Zn:Object.keys(jn);if(!t.length)return null;let a=null;try{a=localStorage.getItem(Yn)}catch(i){}const n="string"==typeof a?t.indexOf(a):-1,o=t[0>n?Math.random()*t.length|0:(n+1)%t.length];e.currentTemplate=o;try{localStorage.setItem(Yn,o)}catch(i){}return o}function Z(e,t=.15){return e*(1+2*(Math.random()-.5)*t)}function Y(){try{"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent(fo,{detail:ae()}))}catch(e){}}function X(){if(!wo&&(wo=!0,"undefined"!=typeof window&&window.matchMedia)){const e=window.matchMedia("(prefers-reduced-motion: reduce)");yo=e.matches,e.addEventListener("change",e=>{yo=e.matches})}}async function q(){if(ho)return!0;try{const e=window.AudioContext||window.webkitAudioContext;return e?(ao=new e({latencyHint:"interactive",sampleRate:44100}),"suspended"===ao.state&&await ao.resume(),(()=>{no=ao.createGain(),no.gain.value=Qn.masterGain,lo=ao.createDynamicsCompressor(),lo.threshold.value=-6,lo.knee.value=10,lo.ratio.value=16,lo.attack.value=5e-4,lo.release.value=.08,co=ao.createBiquadFilter(),co.type="highshelf",co.frequency.value=Qn.highShelfFreq,co.gain.value=Qn.highShelfGain,co.Q.value=.7,so=ao.createWaveShaper(),so.curve=((e=.55)=>{const t=1024,a=new Float32Array(t),n=1+8*e;for(let o=0;t>o;o++)a[o]=Math.tanh(n*(2*o/(t-1)-1))/Math.tanh(n);return a})(.55),so.oversample="2x",io=ao.createGain(),io.gain.value=1-Qn.reverbWetMix,ro=ao.createGain(),ro.gain.value=Qn.reverbWetMix,oo=(()=>{const e=ao.createGain(),t=ao.createGain(),a=[.029,.037,.053,.067].map(e=>{const t=ao.createDelay(.1);return t.delayTime.value=e*Qn.reverbDecay,t}),n=a.map(()=>{const e=ao.createGain();return e.gain.value=.4,e}),o=ao.createBiquadFilter();return o.type="lowpass",o.frequency.value=2e3*(1-Qn.reverbHighDamp),o.Q.value=.5,a.forEach((t,i)=>{e.connect(t),t.connect(n[i]),n[i].connect(o),n[i].connect(a[(i+1)%a.length])}),o.connect(t),e.connect(t),e.l=t,e})();const e=oo.l;io.connect(so),ro.connect(oo),e.connect(so),so.connect(co),co.connect(lo),lo.connect(no),no.connect(ao.destination),(()=>{if(ao){if(po)try{po.disconnect()}catch(e){}else po=ao.createGain(),po.gain.value=1;po.connect(lo||ao.destination)}})(),(()=>{bo=[];for(let e=0;mo>e;e++){const t={id:e,inUse:!1,startTime:0,filter:ao.createBiquadFilter(),envelope:ao.createGain(),panner:ao.createStereoPanner(),reverbSend:ao.createGain(),noiseFilter:ao.createBiquadFilter(),noiseEnvelope:ao.createGain(),osc:null,harmonicOsc:null,sparkleOsc:null,noiseSource:null};t.filter.type="lowpass",t.noiseFilter.type="bandpass",t.noiseFilter.Q.value=1.2,t.filter.connect(t.envelope),t.envelope.connect(t.panner),t.panner.connect(io),t.panner.connect(t.reverbSend),t.reverbSend.connect(ro),t.noiseFilter.connect(t.noiseEnvelope),t.noiseEnvelope.connect(t.panner),bo.push(t)}})()})(),ho=!0,uo=!0,Y(),console.log(`✓ Audio unlocked (${(1e3*(ao.baseLatency||0)).toFixed(1)}ms base latency)`),!0):(console.warn("Web Audio API not supported"),!1)}catch(e){return console.error("Failed to unlock audio:",e),!1}}function U(e,t,a=.5,n=null){if(!uo||!ho||!ao||yo)return;if(Qn.collisionMinImpact>t)return;const o=ao.currentTime;if(.005>o-go)return;if(null!==n){const e=Mo.get(n)||0;if(Qn.minTimeBetweenSounds>o-e)return;Mo.set(n,o)}if(go=o,Mo.size>200){const e=o-.5;for(const[t,a]of Mo)e>a&&Mo.delete(t)}const i=(()=>{for(let t=0;mo>t;t++)if(!bo[t].inUse)return bo[t];let e=bo[0];for(let t=1;mo>t;t++)e.startTime>bo[t].startTime&&(e=bo[t]);return Q(e),e})();i&&((e,t,a,n,o)=>{e.inUse=!0,e.startTime=o;const i=Math.pow(Math.max(0,Math.min(1,a)),Qn.intensityExponent),r=Z(t,Qn.variancePitch),l=Z(Qn.decayTime,Qn.varianceDecay)*(1-i*(1-Qn.velocityDecayScale)),s=l+.02;let c=Qn.minGain+(Qn.maxGain-Qn.minGain)*i;c*=Z(1,Qn.varianceGain);const d=1+(Qn.velocityBrightnessScale-1)*i;let p=Qn.filterBaseFreq+Qn.filterVelocityRange*Math.pow(i,1.3);p*=Z(1,Qn.varianceFilter)*d;const u=2*(n-.5)*Qn.maxPan,h=.12+.5*(1-i);({gain:c,filterFreq:p}=((e,t,a)=>{const n=ee((e-Qn.toneSafetyMinHz)/(Qn.toneSafetyMaxHz-Qn.toneSafetyMinHz),0,1),o=Qn.toneSafetyExponent,i=Math.pow(n,o),r=ee(1-Qn.toneSafetyHighGainAtten*i-Qn.toneSafetyLowGainAtten*Math.pow(1-n,o),.6,1);let l=Math.min(t*r,Qn.voiceGainMax);const s=ee(1-Qn.toneSafetyHighBrightAtten*i,.55,1);return{gain:l,filterFreq:ee(a*s,Qn.filterMinHz,Qn.filterMaxHz)}})(r,c,p)),e.filter.frequency.value=p,e.filter.Q.value=Qn.filterQ,e.panner.pan.value=u,e.reverbSend.gain.value=h,e.noiseFilter.Q.value=ee(Qn.noiseTransientQ||1.2,.5,8),e.envelope.gain.cancelScheduledValues(o),e.envelope.gain.setValueAtTime(c,o),e.envelope.gain.exponentialRampToValueAtTime(.001,o+l);const f=ao.createOscillator();if(f.type="sine",f.frequency.value=r,e.osc=f,f.connect(e.filter),(Qn.harmonicGain||0)>.001){const t=ao.createOscillator();t.type="sine",t.frequency.value=2*r;const a=ao.createGain();a.gain.cancelScheduledValues(o),a.gain.setValueAtTime(c*Qn.harmonicGain,o),a.gain.exponentialRampToValueAtTime(.001,o+l),e.harmonicOsc=t,t.connect(a),a.connect(e.filter),t.onended=()=>{try{a.disconnect()}catch(e){}},t.start(o),t.stop(o+s)}else e.harmonicOsc=null;if((Qn.sparkleGain||0)>.001){const t=ao.createOscillator();t.type="sine";const a=Qn.sparkleRatioMin||2.3,n=Qn.sparkleRatioMax||4.1,i=ee(a+Math.random()*(n-a),1.2,10);t.frequency.value=r*Z(i,.02);const d=ao.createGain(),p=Math.max(.012,l*ee(Qn.sparkleDecayMul||.65,.25,.95));d.gain.cancelScheduledValues(o),d.gain.setValueAtTime(c*Qn.sparkleGain,o),d.gain.exponentialRampToValueAtTime(.001,o+p),e.sparkleOsc=t,t.connect(d),d.connect(e.filter),t.onended=()=>{try{d.disconnect()}catch(e){}},t.start(o),t.stop(o+s)}else e.sparkleOsc=null;if(Qn.noiseTransientEnabled&&i>.25){const t=(()=>{if(!vo){const e=2*ao.sampleRate;vo=ao.createBuffer(1,e,ao.sampleRate);const t=vo.getChannelData(0);let a=0,n=0,o=0;for(let i=0;e>i;i++){const e=2*Math.random()-1;a=.99765*a+.099046*e,n=.963*n+.2965164*e,o=.57*o+1.0526913*e,t[i]=.25*(a+n+o+.1848*e)}}const e=ao.createBufferSource();return e.buffer=vo,e.loopStart=1.5*Math.random(),e.loopEnd=e.loopStart+.1,e.loop=!1,e})();e.noiseSource=t;const a=Math.pow(i,1.4);e.noiseFilter.frequency.value=Z(Qn.noiseTransientFilterMin+(Qn.noiseTransientFilterMax-Qn.noiseTransientFilterMin)*a,Qn.varianceNoise);const n=Qn.noiseTransientGain*Qn.velocityNoiseScale*a*c,r=Z(Qn.noiseTransientDecay,Qn.varianceNoise);e.noiseEnvelope.gain.cancelScheduledValues(o),e.noiseEnvelope.gain.setValueAtTime(n,o),e.noiseEnvelope.gain.exponentialRampToValueAtTime(.001,o+r),t.connect(e.noiseFilter),t.start(o),t.stop(o+r+.01)}else e.noiseSource=null;f.start(o),f.stop(o+s),f.onended=()=>Q(e)})(i,(e=>{const t=1-ee((e-8)/47,0,1),a=ee(Qn.pitchMinHz||145,40,6e3),n=ee(Qn.pitchMaxHz||280,a+10,12e3),o=ee(Qn.pitchCurve||1,.5,2.5);return(a+Math.pow(t,o)*(n-a))*Z(1,1.5*(Qn.variancePitch||.06))})(e),Math.max(0,Math.min(1,t)),a,o)}function J({intensity:e=.82,radius:t=18,xPosition:a=.72}={}){U(t,e,a,null)}function Q(e){if(e.osc){try{e.osc.stop(),e.osc.disconnect()}catch(t){}e.osc=null}if(e.harmonicOsc){try{e.harmonicOsc.stop(),e.harmonicOsc.disconnect()}catch(t){}e.harmonicOsc=null}if(e.sparkleOsc){try{e.sparkleOsc.stop(),e.sparkleOsc.disconnect()}catch(t){}e.sparkleOsc=null}if(e.noiseSource){try{e.noiseSource.stop(),e.noiseSource.disconnect()}catch(t){}e.noiseSource=null}e.inUse=!1}function ee(e,t,a){return t>e?t:e>a?a:e}function te(){return!!ho&&(uo=!uo,Y(),uo)}function ae(){return{isUnlocked:ho,isEnabled:uo,activeSounds:bo.filter(e=>e.inUse).length,poolSize:mo}}function ne(){return{...Qn}}function oe(e){for(const[t,a]of Object.entries(e))t in Qn&&(Qn[t]=a);ro&&io&&"reverbWetMix"in e&&(ro.gain.value=Qn.reverbWetMix,io.gain.value=1-Qn.reverbWetMix),co&&("highShelfFreq"in e||"highShelfGain"in e)&&(co.frequency.value=Qn.highShelfFreq,co.gain.value=Qn.highShelfGain),no&&"masterGain"in e&&(no.gain.value=Qn.masterGain)}function ie(e){const t=eo[e];if(!t)return!1;to=e;const{label:a,description:n,...o}=t;return oe(o),!0}function re(){return to}function le(){const e=f(),t=e.balls,a=e.canvas,n=e.R_MAX,o=e.ballSpacing||0,i=t.length;if(So.length=0,2>i)return So;const r=!1!==e.physicsSpatialGridOptimization;if(r){let e=!1;for(let a=0;i>a;a++){const n=t[a];if(n&&!n.isSleeping){e=!0;break}}if(!e)return So}const l=Math.max(1,2*n*(1+o)),s=Math.ceil(a.width/l)+1;if(r)for(const c of xo.values())c.length=0;else xo.clear();for(let c=0;i>c;c++){const e=t[c],a=(e.y/l|0)*s+(e.x/l|0);let n=xo.get(a);n||(n=[],xo.set(a,n)),n.push(c)}for(const[c,d]of xo){if(0===d.length)continue;const e=c/s|0,a=c%s;for(let n=-1;1>=n;n++)for(let i=-1;1>=i;i++){const r=xo.get((e+n)*s+(a+i));if(r&&0!==r.length)for(let e=0;d.length>e;e++){const a=d[e];for(let e=0;r.length>e;e++){const n=r[e];if(a>=n)continue;const i=t[a],l=t[n],s=l.x-i.x,c=l.y-i.y,d=i.r+l.r+(i.r+l.r)/2*o,p=s*s+c*c;if(d*d>p){const e=d-Math.sqrt(Math.max(p,On.MIN_DISTANCE_EPSILON)),t=So.length;let o=ko[t];o||(o={i:0,j:0,overlap:0},ko[t]=o),o.i=a,o.j=n,o.overlap=e,So.push(o)}}}}}return So.sort((e,t)=>t.overlap-e.overlap),So}function se(e=10){const t=f(),a=t.balls,n=le(),o=t.REST,i=.5*t.DPR,r=t.ballSpacing||0,l=!!t.physicsSkipSleepingCollisions;for(let s=0;e>s;s++)for(let e=0;n.length>e;e++){const{i:c,j:d}=n[e],p=a[c],u=a[d],h=u.x-p.x,f=u.y-p.y,m=p.r+u.r+(p.r+u.r)/2*r,b=h*h+f*f;if(0===b||b>m*m)continue;const g=Math.sqrt(b),M=h/g,y=f/g,v=m-g,w=1/Math.max(p.m,.001),x=1/Math.max(u.m,.001),S=p.isSleeping&&u.isSleeping,k=.8*Math.max(v-i,0)/(w+x),C=k*M,P=k*y;p.x-=C*w,p.y-=P*w,u.x+=C*x,u.y+=P*x;const F="pit"===t.currentMode||"pit-throws"===t.currentMode;if(F&&-.3>y?u.hasSupport=!0:F&&y>.3&&(p.hasSupport=!0),l&&S)continue;if(S)continue;const T=u.vx-p.vx,D=u.vy-p.vy,I=T*M+D*y,L=-15*(t.DPR||1)>I;if((!p.isSleeping||L)&&(!u.isSleeping||L)&&(p.isSleeping&&p.wake(),u.isSleeping&&u.wake(),0>I)){const e=-(1+(30>Math.abs(I)?0:o))*I/(w+x),a=e*M,n=e*y;p.vx-=a*w,p.vy-=n*w,u.vx+=a*x,u.vy+=n*x;const i=T-I*M,r=D-I*y,l=Math.hypot(i,r);if(l>.001){const e=0>i*-y+r*M?-1:1,t=On.SPIN_GAIN_TANGENT;p.omega-=e*t*l/Math.max(p.r,1),u.omega+=e*t*l/Math.max(u.r,1)}const d=Math.min(1,Math.abs(I)/(50*(p.r+u.r))),h=Math.min(t.getSquashMax(),.8*d);p.squashAmount=Math.max(p.squashAmount,.8*h),p.squashNormalAngle=Math.atan2(-y,-M),u.squashAmount=Math.max(u.squashAmount,.8*h),u.squashNormalAngle=Math.atan2(y,M),0===s&&U((p.r+u.r)/2,d,(p.x+u.x)/2/(t.canvas?.width||1),`${c}-${e}`)}}}function ce(){try{const e=document.documentElement,t=document.body,a=document.getElementById("bravia-balls"),n=(e,t)=>{if(!e)return"";try{return getComputedStyle(e).getPropertyValue(t).trim()||getComputedStyle(e).getPropertyValue(t).trim()}catch(a){return""}};let o=n(e,"--wall-color");return o||(o=e.classList.contains("dark-mode")||t.classList.contains("dark-mode")?n(e,"--wall-color-dark")||n(e,"--frame-color-dark"):n(e,"--wall-color-light")||n(e,"--frame-color-light")),o||(o=n(t,"--wall-color")||n(a,"--wall-color")),o||"#0a0a0a"}catch{return"#0a0a0a"}}function de(e,t,a){return t>e?t:e>a?a:e}function pe(e,t,a){return e+(t-e)*a}function ue(e,t){switch(t){case Ln.PIT:return e.sizeVariationPit??0;case Ln.PIT_THROWS:return e.sizeVariationPitThrows??0;case Ln.FLIES:return e.sizeVariationFlies??0;case Ln.WEIGHTLESS:return e.sizeVariationWeightless??0;case Ln.WATER:return e.sizeVariationWater??0;case Ln.VORTEX:return e.sizeVariationVortex??0;case Ln.PING_PONG:return e.sizeVariationPingPong??0;case Ln.MAGNETIC:return e.sizeVariationMagnetic??0;case Ln.BUBBLES:return e.sizeVariationBubbles??0;case Ln.KALEIDOSCOPE:case Ln.KALEIDOSCOPE_1:case Ln.KALEIDOSCOPE_2:case Ln.KALEIDOSCOPE_3:return e.sizeVariationKaleidoscope??0;case Ln.ORBIT_3D:return e.sizeVariationOrbit3d??0;case Ln.ORBIT_3D_2:return e.sizeVariationOrbit3d2??0;case Ln.CRITTERS:return e.sizeVariationCritters??0;case Ln.NEURAL:return e.sizeVariationNeural??0;case Ln.LATTICE:return e.sizeVariationLattice??0;case Ln.PARALLAX_LINEAR:return e.sizeVariationParallaxLinear??0;case Ln.PARALLAX_PERSPECTIVE:return e.sizeVariationParallaxPerspective??0;default:return 0}}function he(e,t){const a=de(+(e.sizeVariationCap??.12),0,Oo),n=de(+(e.sizeVariationGlobalMul??1),0,2),o=de(+(ue(e,t)??0),0,1);return de(a*n*o,0,Oo)}function fe(e,t){const a=Number.isFinite(e?.R_MIN)?Math.max(1,e.R_MIN):0,n=Number.isFinite(e?.R_MAX)?Math.max(a||1,e.R_MAX):0;if(a>0&&n>0)return de(t,a,n);const o=Math.max(1,e?.R_MED||t||1);return de(t,.8*o,1.2*o)}function me(e,t){const{minR:a,maxR:n,medR:o}=((e,t)=>{const a=Math.max(1,e.R_MED||.5*(e.R_MIN+e.R_MAX)||10),n=de(+(e.sizeVariationCap??.12),0,Oo),o=de(+(e.sizeVariationGlobalMul??1),0,2),i=de(+(ue(e,t)??0),0,1),r=de(n*o*i,0,Oo);return{minR:Math.max(1,a*(1-r)),maxR:Math.max(1,a*(1+r)),medR:a}})(e,t);return 1e-6>n-a?o:pe(a,n,Math.random())}function be(e,t){const a=f(),n=a.waterDrag||.015;e.vx*=1-n,e.vy*=1-n,e.omega*=1-.5*n;const o=a.DPR||1;for(let r=0;Wo.length>r;r++){const a=Wo[r],n=e.x-a.x,i=e.y-a.y,l=Math.sqrt(n*n+i*i),s=40*o;if(l>a.radius-s&&a.radius+s>l){const o=a.strength*(1-Math.abs(l-a.radius)/s);if(l>.1){const a=i/l;e.vx+=n/l*o*t,e.vy+=a*o*t}}}const i=a.waterDriftStrength||25;e.vx+=Math.sin(.5*e.t+.01*e.x)*i*t,e.vy+=Math.cos(.7*e.t+.01*e.y)*i*t}function ge(e){const t=f().waterRippleSpeed||300;for(let a=Wo.length-1;a>=0;a--){const n=Wo[a];n.radius+=t*e,n.age+=e,n.strength*=.96,(n.age>3||10>n.strength)&&Wo.splice(a,1)}}function Me(e,t,a=1){const n=f();Wo.push({x:e,y:t,radius:0,strength:(n.waterRippleStrength||15e3)*Math.min(a,5),age:0})}function ye(e,t,a){a||(a=_());const n=f(),o=me(n,n.currentMode||Ln.PIT),i=new Ko(e,t,o,a),r=.5*n.canvas.width>e?1:-1,l=Math.max(.6,Math.min(1.4,o/(.5*(n.R_MIN+n.R_MAX)))),s=180*l;return i.vx=r*(140*l+Math.random()*s),i.vy=120*-Math.random(),i.driftAx=r*(360+420*Math.random())*l,i.driftTime=.22+.28*Math.random(),n.balls.push(i),i}function ve(e,t){const a=f(),n=(-1e9===a.mouseX?.5*a.canvas.width:a.mouseX)-e.x,o=(-1e9===a.mouseY?.5*a.canvas.height:a.mouseY)-e.y,i=Math.sqrt(n*n+o*o+1),r=o/i;e.vx+=n/i*4e3*t,e.vy+=4e3*r*t;const l=120*a.DPR;let s=0,c=0,d=0;for(let p=0;a.balls.length>p;p++){const t=a.balls[p];if(t===e)continue;const n=e.x-t.x,o=e.y-t.y,i=n*n+o*o;if(l*l>i&&i>0){const e=Math.sqrt(i),t=1-e/l;s+=n/e*t,c+=o/e*t,d++}}if(d>0){const a=15e3;e.vx+=s/d*a*t,e.vy+=c/d*a*t}e.vx+=1e3*(Math.random()-.5)*t,e.vy+=1e3*(Math.random()-.5)*t}function we(e,t){const a=f(),n=a.repelPower,o=a.repelRadius;if(!a.repellerEnabled||0>=n||0>=o)return;const i=o*a.DPR,r=e.x-a.mouseX,l=e.y-a.mouseY,s=r*r+l*l;if(s>i*i)return;const c=Math.max(Math.sqrt(s),1e-4),d=r/c,p=l/c,u=20*n*Math.pow(Math.max(0,1-c/i),a.repelSoft||3.4),h=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=d*u*t/h,e.vy+=p*u*t/h}function xe(e,t,a){return Math.max(t,Math.min(a,e))}function Se(e,t){return e+Math.random()*(t-e)}function ke(e){e.spawnedTotal=1+(0|e.spawnedTotal)}function Ce(e,t,a,{speedMul:n=1,spreadMul:o=1}={}){const i=e.canvas.width,r=e.canvas.height,l=e.DPR,s=(e.wallThickness||20)*l,c=Math.max(1,i-2*s),d=.35*-r,p=.05*-r,u=xe(e.pitThrowInletInset??.06,0,.2),h=0===a?s+c*u:i-s-c*u,f=xe(e.pitThrowSpawnSpread??.02,0,.12),m=xe(f*o,0,.18),b=h+Se(-c*m,c*m),g=Se(d,p),M=xe(e.pitThrowTargetYFrac??.36,.12,.7),y=xe(e.pitThrowCrossBias??.12,0,.35),v=xe(e.pitThrowAimJitter??.04,0,.2),w=xe(v*o,0,.25),x=i*(.5+(0===a?y:-y)+Se(-w,w)),S=r*M,k=xe(e.pitThrowSpeed??650,50,4e3)*l,C=xe(e.pitThrowSpeedJitter??.22,0,.8),P=xe(e.pitThrowAngleJitter??.16,0,.8),F=ye(b,g,t),T=x-b,D=S-g,I=Math.max(1e-4,Math.sqrt(T*T+D*D));let L=T/I,A=D/I;const K=Se(-Math.PI,Math.PI)*P,O=Math.cos(K),W=Math.sin(K),E=L*W+A*O;L=L*O-A*W,A=E;const R=k*n*(1+Se(-C,C));return F.vx=L*R,F.vy=A*R,F.driftAx=0,F.driftTime=0,F}function Pe(e){const t=f();if(!t||"pit-throws"!==t.currentMode)return;const a=Math.max(0,m(t.maxBalls??300));if(0>=a)return;if(t.balls.length>=a)return;const n=t.p;if(!n)return;const o=xe(t.pitThrowIntervalMs??70,10,2e3)/1e3,i=xe(t.pitThrowBatchSize??12,1,100),r=xe(t.pitThrowColorPauseMs??400,0,3e3)/1e3,l=xe(t.pitThrowPairChance??.35,0,1),s=xe(t.pitThrowPairStaggerMs??18,0,300)/1e3,c=xe(t.pitThrowSpeedVar??.18,0,1),d=xe(t.pitThrowSpreadVar??.25,0,1);n.cooldown-=e,0>n.cooldown&&(n.cooldown=0);let p=0;for(0>n.queueA||(n.queueA-=e),0>n.queueB||(n.queueB-=e);6>p&&a>t.balls.length;){let e=!1;if(n.queueA>=0&&0>=n.queueA){const a=1+Se(-c,c),o=1+Se(-d,d);Ce(t,n.queueColorA,n.queueSideA,{speedMul:a,spreadMul:o}),n.queueA=-1,p++,e=!0}if(p>=6||t.balls.length>=a)break;if(n.queueB>=0&&0>=n.queueB){const a=1+Se(-c,c),o=1+Se(-d,d);Ce(t,n.queueColorB,n.queueSideB,{speedMul:a,spreadMul:o}),n.queueB=-1,p++,e=!0}if(!e)break}if(0>=n.cooldown)for(n.batchPaused&&(n.batchPaused=!1,n.batchCount=0,n.side=1-n.side);6>p&&a>t.balls.length;){if(r>0&&n.batchCount>=i){n.cooldown=r,n.batchPaused=!0;break}const e=n.side,u=1+Se(-c,c),h=1+Se(-d,d);if(Ce(t,ke(n),e,{speedMul:u,spreadMul:h}),p++,n.batchCount++,l>Math.random()&&a>t.balls.length&&i>n.batchCount){const t=ke(n);0>n.queueA&&(n.queueA=s,n.queueColorA=t,n.queueSideA=e,n.batchCount++)}n.cooldown=o;break}}function Fe(e,t){const a=f();if(!a.mouseInCanvas)return;const n=a.weightlessRepelRadius??0,o=a.weightlessRepelPower??0;if(0>=n||0>=o)return;const i=n*(a.DPR||1),r=e.x-a.mouseX,l=e.y-a.mouseY,s=r*r+l*l;if(s>i*i)return;const c=Math.max(Math.sqrt(s),1e-4),d=r/c,p=l/c,u=20*o*Math.pow(Math.max(0,1-c/i),a.weightlessRepelSoft??2.2),h=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=d*u*t/h,e.vy+=p*u*t/h}function Te(){if(Eo=document.getElementById("c"),!Eo)return void console.error("Canvas not found");Ro=Eo.getContext("2d",{alpha:!0,desynchronized:!0,willReadFrequently:!1}),Ro||(Ro=Eo.getContext("2d"),console.warn("⚠️ Desynchronized mode unavailable, using standard context")),(()=>{const e=window.devicePixelRatio||1;(navigator.connection?.saveData||4>=navigator.hardwareConcurrency||/Android|iPhone|iPad|iPod/i.test(navigator.userAgent))&&e>1.5?(zo=1.5,console.log("⚡ Adaptive DPR: Reduced to 1.5x for performance")):zo=Math.min(e,2),i(zo)})(),Ro.imageSmoothingEnabled=!1;const e=()=>{$o&&cancelAnimationFrame($o),$o=requestAnimationFrame(()=>{De(),$o=null})};if(window.addEventListener("resize",e),window.addEventListener("orientationchange",()=>{setTimeout(De,100),setTimeout(De,300)}),window.visualViewport&&(window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e)),"undefined"!=typeof ResizeObserver){const t=document.getElementById("bravia-balls");t&&new ResizeObserver(()=>{e()}).observe(t)}console.log(`✓ Renderer optimized (DPR: ${zo.toFixed(2)}, desync: ${Ro.getContextAttributes?.()?.desynchronized??"unknown"})`)}function De(){if(!Eo)return;const e=f();try{const e=window.visualViewport,t=e&&"number"==typeof e.height?e.height:window.innerHeight,a=e&&"number"==typeof e.width?e.width:window.innerWidth,n=t>0?t:window.innerHeight,o=a>0?a:window.innerWidth,i=e&&"number"==typeof e.offsetTop?e.offsetTop:0,r=e&&"number"==typeof e.offsetLeft?e.offsetLeft:0,l=Number.isFinite(i)?i:0,s=Number.isFinite(r)?r:0;let c=l+n/2,d=s+o/2;d>0||(d=window.innerWidth/2),c>0||(c=window.innerHeight/2);const p=document.documentElement?.style;p?.setProperty("--abs-viewport-h",n+"px"),p?.setProperty("--abs-vv-offset-top",l+"px"),p?.setProperty("--abs-vv-offset-left",s+"px"),p?.setProperty("--abs-vv-h",n+"px"),p?.setProperty("--abs-vv-w",o+"px"),p?.setProperty("--abs-vv-center-x",d+"px"),p?.setProperty("--abs-vv-center-y",c+"px")}catch(d){}try{p(),u()}catch(d){}try{y()}catch(d){}const t=e.container||document.getElementById("bravia-balls"),a=t?t.clientWidth:window.innerWidth,n=t?t.clientHeight:window.innerHeight;if(0>=a||0>=n)return;const o=a,i=n,r=zo,l=Math.floor(o*r),s=Math.floor(i*r);if(0>=l||0>=s)return;if(l===Bo&&s===Vo)return;if(Bo>0&&Vo>0&&e.balls&&e.balls.length>0){const t=l/Bo,a=s/Vo;if(t>.1&&10>t&&a>.1&&10>a){const n=e.balls;for(let e=0;n.length>e;e++){const o=n[e];if(!o)continue;o.x*=t,o.y*=a;const i=o.r||10;o.x=Math.max(i,Math.min(l-i,o.x)),o.y=Math.max(i,Math.min(s-i,o.y)),o.isSleeping&&(o.isSleeping=!1,o.sleepTimer=0)}}}Bo=l,Vo=s;const c=Eo.width!==l||Eo.height!==s;if(c&&(Eo.width=l,Eo.height=s,Ro&&(Ro.imageSmoothingEnabled=!1)),Eo.style.width=o+"px",Eo.style.height=i+"px",c&&((e=>{e.style.filter=""})(Eo),No))try{No()}catch(d){}try{const t=0;(Eo.width!==_o||Eo.height!==Go||Math.abs(t-Ho)>.001)&&(_o=Eo.width,Go=Eo.height,Ho=t,e.canvasClipPath=((e,t,a)=>{const n=Math.max(0,Math.min(a,.5*Math.min(e,t)));if("undefined"==typeof Path2D)return null;const o=new Path2D;return n>0?(o.moveTo(n,0),o.lineTo(e-n,0),o.arcTo(e,0,e,n,n),o.lineTo(e,t-n),o.arcTo(e,t,e-n,t,n),o.lineTo(n,t),o.arcTo(0,t,0,t-n,n),o.lineTo(0,n),o.arcTo(0,0,n,0,n),o.closePath(),o):(o.rect(0,0,e,t),o)})(Eo.width,Eo.height,t))}catch(d){}}function Ie(){return Eo}function Le(){return Ro}function Ae(e,t){const a=f();if(a.currentMode!==Ln.VORTEX)return;if(!a.mouseInCanvas)return;const n=a.vortexSwirlStrength||420,o=a.vortexRadialPull||180,i=a.vortexSpeedMultiplier??1,r=a.vortexRadius??0,l=a.vortexFalloffCurve??1,s=a.vortexRotationDirection??1,c=a.vortexCoreStrength??1,d=a.vortexAccelerationZone??0,p=a.vortexOutwardPush??0,u=e.x-a.mouseX,h=e.y-a.mouseY,m=Math.max(8,Math.sqrt(u*u+h*h));if(r>0&&m>r){if(p>0){const a=h/m,n=p*((m-r)/r);e.vx+=u/m*n*t,e.vy+=a*n*t}return}let b;b=Math.pow(r>0?1-Math.min(1,m/r):1/(1+m*(a.vortexFalloffRate??.0015)),l);const g=1+(c-1)*(1-Math.min(1,m/(r||400))),M=n*b*g*i,y=o*b*g*i;let v=1;if(d>0){const e=Math.abs(m-d),t=.3*d;t>e&&(v=1+.5*(1-e/t))}const w=u/m,x=h/m,S=w*s,k=M*v;e.vx+=-x*s*k*t,e.vy+=S*k*t;const C=y*v;e.vx-=w*C*t,e.vy-=x*C*t;const P=Math.max(0,Math.min(1,a.vortexDrag??.005));e.vx*=1-P,e.vy*=1-P}function Ke(e){const t=f();if(t.currentMode!==Ln.PING_PONG)return;if(!e.isPingPong)return;if(t.mouseInCanvas){const a=Math.max(0,t.pingPongCursorRadius||0)*t.DPR,n=e.x-t.mouseX,o=e.y-t.mouseY,i=Math.sqrt(n*n+o*o),r=a+e.r;if(r>i&&i>.1){const t=r-i,a=n/i,l=o/i;e.x+=a*t*1.1,e.y+=l*t*1.1;const s=e.vx*a+e.vy*l;0>s&&(e.vx-=2*s*a,e.vy-=2*s*l,e.omega+=.02*s)}}const a=t.pingPongSpeed||400;.9*a>Math.abs(e.vx)&&(e.vx=(0>e.vx?-1:1)*a),e.vy*=Math.max(0,Math.min(1,t.pingPongVerticalDamp??.995))}function Oe(e,t){const a=f();if(a.currentMode!==Ln.MAGNETIC)return;if(!a.mouseInCanvas)return;const n=a.mouseX-e.x,o=a.mouseY-e.y,i=a.DPR||1,r=Math.max(30*i,Math.sqrt(n*n+o*o)),l=(a.magneticStrength||65e3)/(r*r)*1e3,s=o/r,c=e.charge||1;e.vx+=n/r*l*c*t,e.vy+=s*l*c*t;const d=(a.magneticMaxVelocity||2800)*i,p=Math.sqrt(e.vx*e.vx+e.vy*e.vy);p>d&&(e.vx=e.vx/p*d,e.vy=e.vy/p*d),e.vx*=.998,e.vy*=.998}function We(){const e=f();if(e.currentMode===Ln.MAGNETIC)for(let t=0;e.balls.length>t;t++)e.balls[t].alpha=1}function Ee(e,t,a,n=!1){const o=f(),i=o.DPR||1,r=me(o,Ln.BUBBLES),l=new Ko(e,t,n?r:.1,a);return l.isBubble=!0,l.baseRadius=r,l.targetRadius=r,l.wobblePhase=Math.random()*Math.PI*2,l.wobbleFreq=2+3*Math.random(),l.vx=20*(Math.random()-.5)*i,l.vy=(-50-50*Math.random())*i,l.spawning=!n,l.spawnProgress=n?1:0,l.dissipating=!1,l.dissipateProgress=0,l.alpha=1,o.balls.push(l),l}function Re(e){const t=f(),a=t.canvas;if(!a)return;const n=t.DPR||1,o=a.width,i=a.height;e.x=Math.random()*o,e.y=i+(60+30*Math.random())*n,e.vx=20*(Math.random()-.5)*n,e.vy=(-50-50*Math.random())*n,e.wobblePhase=Math.random()*Math.PI*2,e.wobbleFreq=2+3*Math.random(),e.color=_(),e.targetRadius=me(t,Ln.BUBBLES),e.baseRadius=e.targetRadius,e.r=.1,e.rBase=.1,e.spawning=!0,e.spawnProgress=0,e.dissipating=!1,e.dissipateProgress=0,e.alpha=1}function ze(e,t){const a=f();if(a.currentMode!==Ln.BUBBLES)return;if(!e.isBubble)return;const n=a.canvas;if(!n)return;if(e.spawning&&(e.spawnProgress+=3*t,e.r=e.targetRadius*(1-Math.pow(1-Math.min(1,e.spawnProgress),3)),e.rBase=e.r,1>e.spawnProgress||(e.spawning=!1,e.r=e.targetRadius,e.rBase=e.targetRadius)),e.dissipating){e.dissipateProgress+=3*t;const a=Math.pow(e.dissipateProgress,2);return e.r=e.targetRadius*Math.max(0,1-a),e.rBase=e.r,e.alpha=Math.max(0,1-.5*a),e.vy*=.92,e.vx*=.92,void(1>e.dissipateProgress||Re(e))}const o=.01*(a.bubblesWobble||40);if(e.vy-=(a.bubblesRiseSpeed||150)*a.DPR*t,e.wobblePhase+=e.wobbleFreq*t,e.vx+=Math.sin(e.wobblePhase)*o*100*t,e.vx*=.92,e.vy*=.96,a.mouseInCanvas){const n=e.x-a.mouseX,o=e.y-a.mouseY,i=Math.sqrt(n*n+o*o),r=Math.max(0,a.bubblesDeflectRadius||0)*a.DPR;if(r>i&&i>1){const a=3e3*Math.pow(1-i/r,3),l=n/i,s=o/i;if(e.vx+=l*a*t,e.vy+=s*a*t,.3*r>i){const a=500*(1-i/(.3*r));e.vx+=l*a*t,e.vy+=s*a*t}}}e.y>=2*e.targetRadius||e.dissipating||e.spawning||(e.dissipating=!0,e.dissipateProgress=0),(4*-e.r>e.x||e.x>n.width+4*e.r)&&Re(e)}function Be(){}function Ve(e,t,a){return Math.max(t,Math.min(a,e))}function $e(e){const t=e.canvas;return t?Ve(Math.min(t.width,t.height)/1e3,.35,3):1}function Ne(e,t,a,n){for(let o=0;e.length>o;o++){const i=e[o],r=t-i.x,l=a-i.y,s=n+i.r;if(s*s>r*r+l*l)return!0}return!1}function _e(e,t,a,n=10){const o=2*n;return e.v+=n*n*(t-e.x)*a,e.v*=Math.max(0,1-o*a),e.x+=e.v*a,e.x}function Ge(e,t,a,n){const o=f(),i=Math.max(2,o.wallInset||3)*(o.DPR||1),r=i+e.r,l=t-i-e.r,s=i+e.r,c=a-i-e.r,d=.92,p=Math.max(0,1-.15*n);r>e.x?(e.x=r,e.vx=Math.abs(e.vx)*d*p):e.x>l&&(e.x=l,e.vx=-Math.abs(e.vx)*d*p),s>e.y?(e.y=s,e.vy=Math.abs(e.vy)*d*p):e.y>c&&(e.y=c,e.vy=-Math.abs(e.vy)*d*p)}function He(e){return e.currentMode===Ln.KALEIDOSCOPE_1?{count:e.kaleidoscope1BallCount??18,wedges:e.kaleidoscope1Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope1Speed??.8,complexity:.55,spawnAreaMul:e.kaleidoscope1SpawnAreaMul??1,sizeVariance:e.kaleidoscope1SizeVariance??.3}:e.currentMode===Ln.KALEIDOSCOPE_2?{count:e.kaleidoscope2BallCount??36,wedges:e.kaleidoscope2Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope2Speed??1.15,complexity:.95,spawnAreaMul:e.kaleidoscope2SpawnAreaMul??1,sizeVariance:e.kaleidoscope2SizeVariance??.3}:e.currentMode===Ln.KALEIDOSCOPE_3?{count:e.kaleidoscope3BallCount??54,wedges:e.kaleidoscope3Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope3Speed??1.55,complexity:1.35,spawnAreaMul:e.kaleidoscope3SpawnAreaMul??1,sizeVariance:e.kaleidoscope3SizeVariance??.3}:{count:e.kaleidoscopeBallCount??23,wedges:e.kaleidoscopeWedges??e.kaleidoscopeSegments??12,speed:e.kaleidoscopeSpeed??1,complexity:.75,spawnAreaMul:e.kaleidoscopeSpawnAreaMul??1,sizeVariance:e.kaleidoscopeSizeVariance??.3}}function je(e,t){function a(e){const a=((e,t)=>{const a=e?.canvas,n=a?.height||0;if(!n)return me(e,t);const o=de(t===Ln.KALEIDOSCOPE_1?+(e.kaleidoscope1DotSizeVh??e.kaleidoscopeDotSizeVh??.95):t===Ln.KALEIDOSCOPE_2?+(e.kaleidoscope2DotSizeVh??e.kaleidoscopeDotSizeVh??.95):t===Ln.KALEIDOSCOPE_3?+(e.kaleidoscope3DotSizeVh??e.kaleidoscopeDotSizeVh??.95):+(e.kaleidoscopeDotSizeVh??.95),.1,6),i=de(t===Ln.KALEIDOSCOPE_1?+(e.kaleidoscope1DotAreaMul??e.kaleidoscopeDotAreaMul??.7):t===Ln.KALEIDOSCOPE_2?+(e.kaleidoscope2DotAreaMul??e.kaleidoscopeDotAreaMul??.7):t===Ln.KALEIDOSCOPE_3?+(e.kaleidoscope3DotAreaMul??e.kaleidoscopeDotAreaMul??.7):+(e.kaleidoscopeDotAreaMul??.7),.1,2),r=Math.max(1,.01*o*n*Math.sqrt(i)),l=de(.5*(t===Ln.KALEIDOSCOPE_1?+(e.kaleidoscope1SizeVariance??e.kaleidoscopeSizeVariance??.3):t===Ln.KALEIDOSCOPE_2?+(e.kaleidoscope2SizeVariance??e.kaleidoscopeSizeVariance??.3):t===Ln.KALEIDOSCOPE_3?+(e.kaleidoscope3SizeVariance??e.kaleidoscopeSizeVariance??.3):+(e.kaleidoscopeSizeVariance??.3)),0,Oo),s=Math.max(1,r*(1-l)),c=Math.max(1,r*(1+l));return fe(e,1e-6>c-s?r:pe(s,c,Math.random()))})(n,t),o=1.2*b,i=l-o,r=l+o,d=s-o,p=s+o;for(let t=0;90>t;t++){const t=Math.random()*jo,o=m+Math.random()*(b-m),u=Ve(l+Math.cos(t)*o,i,r),h=Ve(s+Math.sin(t)*o,d,p),f=a*(1+(n.ballSpacing||0));if(!Ne(g,u,h,f)){g.push({x:u,y:h,r:f});const o=new Ko(u,h,a,e);o.u=Math.random()*jo;const i=u-l,r=h-s;o.M=Math.sqrt(i*i+r*r);const d=(12+12*Math.random())*c;return o.vx=-Math.sin(t)*d,o.vy=Math.cos(t)*d,o.driftAx=0,o.driftTime=0,void n.balls.push(o)}}const u=Math.random()*jo,h=m+Math.random()*(b-m),f=l+Math.cos(u)*h,M=s+Math.sin(u)*h,y=new Ko(f,M,a,e);y.u=Math.random()*jo;const v=f-l,w=M-s;y.M=Math.sqrt(v*v+w*w);const x=(12+12*Math.random())*c;y.vx=-Math.sin(u)*x,y.vy=Math.cos(u)*x,y.driftAx=0,y.driftTime=0,n.balls.push(y)}const n=f();M();const o=n.canvas;if(!o)return;const i=o.width,r=o.height,l=.5*i,s=.5*r,c=$e(n),d=n.maxBalls||300,p=Ve(Math.max(0,0|e),0,d);if(0>=p)return;const u=Ve(He(n).spawnAreaMul??1,.2,2),h=Math.min(i,r),m=.05*h,b=2.8*h*u,g=[],y=Math.min(8,p);for(let f=0;y>f;f++)a(_());for(let f=y;p>f;f++)a(_())}function Ze(e){return e===Ln.KALEIDOSCOPE||e===Ln.KALEIDOSCOPE_1||e===Ln.KALEIDOSCOPE_2||e===Ln.KALEIDOSCOPE_3}function Ye(e){return He(e).complexity}function Xe(e,t){const a=f();if(!Ze(a.currentMode))return;const n=a.canvas;if(!n)return;const o=.5*n.width,i=.5*n.height,r=$e(a),l=Ve(He(a).speed??1,.2,2),s=performance.now(),c=120>s-(a.lastPointerMoveMs||0);void 0===a.S&&(a.S=0);const d=c?1:0;a.S+=(d-a.S)*(1-Math.exp(-t/Math.max(1e-4,d>a.S?.45:.65)));const p=a.S,u=.008*Ye(a);if(.01>p){const a=(e.u??0)+.02*e.age+3e-4*s,n=Math.cos(a)*u*8,o=Math.sin(a)*u*8;return e.vx+=n*t,e.vy+=o*t,e.vx*=.96,void(e.vy*=.96)}const h=e.x-o,m=e.y-i,b=Math.max(Zo,Math.sqrt(h*h+m*m)),g=h/b,M=m/b,y=g,v=30*r*l*p,w=-2.5*(b-(void 0!==e.M?e.M:b))*l*p;e.vx+=(-M*v+g*w)*t,e.vy+=(y*v+M*w)*t,e.vx*=.992,e.vy*=.992}function qe(e,t){const a=f(),n=(-1e9===a.mouseX?.5*a.canvas.width:a.mouseX)-e.x,o=(-1e9===a.mouseY?.5*a.canvas.height:a.mouseY)-e.y,i=Math.sqrt(n*n+o*o+1),r=n/i,l=o/i,s=-o/i,c=n/i,d=a.DPR||1,p=40*d;if(p>i){const a=100*(p-i);e.vx-=r*a*t,e.vy-=l*a*t}const u=a.orbit3dGravity??5e3,h=.015*u;e.vx+=s*h*t,e.vy+=c*h*t;const m=.003*u/(1+i/(100*d));e.vx+=r*m*t,e.vy+=l*m*t;const b=60*a.DPR;let g=0,M=0,y=0;for(let f=0;a.balls.length>f;f++){const t=a.balls[f];if(t===e)continue;const n=e.x-t.x,o=e.y-t.y,i=n*n+o*o;if(b*b>i&&i>0){const e=Math.sqrt(i),t=1-e/b;g+=n/e*t,M+=o/e*t,y++}}if(y>0){const a=8e3;e.vx+=g/y*a*t,e.vy+=M/y*a*t}const v=2*(a.orbit3dVelocityMult??150)*d,w=Math.sqrt(e.vx*e.vx+e.vy*e.vy);w>v&&(e.vx=e.vx/w*v,e.vy=e.vy/w*v);const x=1-(a.orbit3dDamping??.02);e.vx*=x,e.vy*=x;const S=a.orbit3dDepthScale??.8;e.z=e.orbitDepth+.2*Math.sin(2*Math.atan2(o,n)),e.z=Math.max(0,Math.min(1,e.z)),e.r=fe(a,Math.max(2,e.rBase*(.5+e.z*S)))}function Ue(e,t){const a=f(),n=(-1e9===a.mouseX?.5*a.canvas.width:a.mouseX)-e.x,o=(-1e9===a.mouseY?.5*a.canvas.height:a.mouseY)-e.y,i=Math.sqrt(n*n+o*o+1),r=n/i,l=o/i,s=-o/i,c=n/i,d=a.DPR||1,p=80*d;if(p>i){const a=100*(p-i);e.vx-=r*a*t,e.vy-=l*a*t}const u=a.orbit3d2Gravity??8e4,h=.015*u;e.vx+=s*h*t,e.vy+=c*h*t;const m=.003*u/(1+i/(100*d));e.vx+=r*m*t,e.vy+=l*m*t;const b=100*a.DPR;let g=0,M=0,y=0;for(let f=0;a.balls.length>f;f++){const t=a.balls[f];if(t===e)continue;const n=e.x-t.x,o=e.y-t.y,i=n*n+o*o;if(b*b>i&&i>0){const e=Math.sqrt(i),t=1-e/b;g+=n/e*t,M+=o/e*t,y++}}if(y>0){const a=8e3;e.vx+=g/y*a*t,e.vy+=M/y*a*t}const v=300*d,w=Math.sqrt(e.vx*e.vx+e.vy*e.vy);w>v&&(e.vx=e.vx/w*v,e.vy=e.vy/w*v);const x=1-(a.orbit3d2Damping??.02);e.vx*=x,e.vy*=x;const S=a.orbit3d2DepthScale??.6;e.z=e.orbitDepth+.2*Math.sin(2*Math.atan2(o,n)),e.z=Math.max(0,Math.min(1,e.z)),e.r=fe(a,Math.max(2,e.rBase*(.5+e.z*S)))}function Je(e,t,a){return t>e?t:e>a?a:e}function Qe(e){return e>Math.PI?e-=2*Math.PI:-Math.PI>e&&(e+=2*Math.PI),e}function et(e,t){const a=f(),n=a.canvas;if(!n)return;const o=a.DPR||1,i=Math.max(0,a.critterSpeed||0),r=Math.max(50,a.critterMaxSpeed||0)*o,l=Math.max(0,a.critterStepHz||0),s=a.critterStepSharpness??2.4,c=Math.max(0,a.critterTurnNoise||0),d=Math.max(.1,a.critterTurnDamp||0),p=Math.max(0,a.critterTurnSeek||0),u=Math.max(0,(a.critterAvoidRadius||0)*(a.DPR||1)),h=Math.max(0,a.critterAvoidForce||0),m=Math.max(0,a.critterEdgeAvoid||0),b=Math.max(0,a.critterMousePull||0),g=Math.max(0,a.critterMouseRadiusVw||0);let M=e.k||0,y=e.C||0,v=e.P||0,w=e.F??v,x=e.T||0;const S=e.D||0;x>0?x=Math.max(0,x-t):.25*t>Math.random()&&(x=.03+.09*Math.random());let k=0,C=0;if(m>0){const t=n.width,o=n.height,i=Math.max(24*(a.DPR||1),.08*Math.min(t,o)),r=e.x,l=e.y;i>r?k+=1-r/i:r>t-i&&(k-=1-(t-r)/i),i>l?C+=1-l/i:l>o-i&&(C-=1-(o-l)/i);const s=1.35*m;k*=s,C*=s}let P=0;if(b>0&&-1e9!==a.mouseX){const t=(window.innerWidth||n.width)/100,o=Math.max(1,g*t)*(a.DPR||1),i=e.x-a.mouseX,r=e.y-a.mouseY,l=i*i+r*r;if(o*o>l){const e=Math.sqrt(l)+1e-6,t=1-e/o;P=t;const a=b*(.85+.65*t);k+=i/e*a,C+=r/e*a;const n=.25*t*a;k+=-r/e*n,C+=i/e*n,x=0}}if(u>0&&h>0){const n=a.balls,o=u*u;let i=0,r=0,l=0;for(let t=0;n.length>t;t++){const a=n[t];if(a===e)continue;const s=e.x-a.x,c=e.y-a.y,d=s*s+c*c;if(d>0&&o>d){const e=Math.sqrt(d),t=1-e/u,a=t*t,n=1/(e+1e-6);i+=s*n*a,r+=c*n*a,l++}}if(l>0){const a=1/l;k+=i*a*1.15,C+=r*a*1.15,e.vx+=i*a*.65*h*t,e.vy+=r*a*.65*h*t}}y+=(c*(1+1.35*P*b)*(2*Math.random()-1)+.35*S*c)*t,k*k+C*C>1e-6&&(y+=Qe(Math.atan2(C,k)-M)*p*t),y*=Math.exp(-d*t),M=Qe(M+y*t),l>0&&(w=v,v+=l*t,v-=0|v);const F=x>0?0:((e,t)=>{const a=(n=Je(n=.5>e?2*e:2-2*e,0,1))*n*(3-2*n);var n;const o=Je(t,.5,6);return Math.pow(a,o)})(v,s),T=1+.95*P*b;if(0>=x&&v>.82){const t=(v-.82)/.18*.1*(.65+.35*T);t>e.squashAmount&&(e.squashAmount=t,e.squashNormalAngle=-Math.PI/2)}if(0>=x&&l>0&&w>v){const t=Math.max(.25,e.m/(a.MASS_BASELINE_KG||129)),n=i*(.55+.55*F)*T*(.85+.3*Math.random()),o=Math.cos(M),r=Math.sin(M),l=-r,s=o,c=.18*(2*Math.random()-1)*(.35+.65*P)*n;e.vx+=(o*n+l*c)/t,e.vy+=(r*n+s*c)/t,e.squashAmount=Math.max(e.squashAmount,.2+.15*P),e.squashNormalAngle=Math.PI/2}const D=i*(.08+.25*F)*T;e.vx+=Math.cos(M)*D*t,e.vy+=Math.sin(M)*D*t;const I=e.vx,L=e.vy,A=I*I+L*L;if(A>r*r){const t=r/(Math.sqrt(A)+1e-6);e.vx=I*t,e.vy=L*t}e.k=M,e.C=y,e.P=v,e.F=w,e.T=x,e.theta=M}function tt(e,t){const a=f(),n=Math.max(.25,e.m/a.MASS_BASELINE_KG),o=Math.max(0,a.neuralWanderStrength??420),i=(e.I??0)+1.35*t;e.I=i;const r=Math.sin(1.7*i+.3)*o,l=Math.cos(1.1*i+1.2)*o;e.vx+=r*t/n,e.vy+=l*t/n,Xo+=t;const s=a.balls,c=s.length;if(c>1){const o=Xo>.18;if(o&&(Xo=0),o||void 0===a.L){let e=0,t=0;for(let a=0;c>a;a++)e+=s[a].x,t+=s[a].y;a.L=e/c,a.A=t/c}const i=a.L,r=a.A,l=Math.max(0,Math.min(1,a.neuralCohesion??.18)),d=r-e.y;e.vx+=(i-e.x)*l*t/n,e.vy+=d*l*t/n}const d=Math.pow(Math.max(0,Math.min(1,a.neuralDamping??.985)),60*t);e.vx*=d,e.vy*=d}function at(){}function nt(e,t){const a=f(),n=a.canvas;if(!n)return;const o=a.mouseX;if(!1!==a.repellerEnabled&&-1e9!==o&&a.mouseInCanvas){const n=(a.latticeDisruptRadius??600)*a.DPR,i=a.latticeDisruptPower??25,r=e.x-o,l=e.y-a.mouseY,s=r*r+l*l;if(n*n>s){const o=Math.max(Math.sqrt(s),1e-4),c=r/o,d=l/o,p=80*i*Math.pow(Math.max(0,1-o/n),1.8),u=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=c*p*t/u,e.vy+=d*p*t/u}}void 0!==e.latticeHomeX&&void 0!==e.latticeHomeY||(e.latticeHomeX=e.x,e.latticeHomeY=e.y);const i=.001*performance.now(),r=a.latticeMeshWaveStrength??12,l=a.latticeMeshWaveSpeed??.8,s=Math.sin(i*l+.004*e.latticeHomeX)*r,c=Math.cos(i*l*.7+.004*e.latticeHomeY)*r,d=.015*Math.sin(i*l*.5),p=e.latticeHomeX+s+(e.latticeHomeX-.5*n.width)*d-e.x,u=e.latticeHomeY+c+(e.latticeHomeY-.5*n.height)*d-e.y,h=Math.max(0,a.latticeStiffness??2.2),m=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=p*h*t/m,e.vy+=u*h*t/m;const b=Math.pow(Math.max(0,Math.min(1,a.latticeDamping??.92)),60*t);e.vx*=b,e.vy*=b}function ot(e){if(!e.K)return;const t=f(),a=t.canvas;if(!a)return;const n=.5*a.width,o=.5*a.height;let i=0,r=0;t.mouseInCanvas&&(i=Math.max(-1,Math.min(1,(t.mouseX-n)/(.5*a.width))),r=Math.max(-1,Math.min(1,(t.mouseY-o)/(.5*a.height))));const l=Math.max(100,t.parallaxLinearFocalLength??400),s=Math.max(0,t.parallaxLinearParallaxStrength??120),{x:c,y:d,z:p}=e.K,u=l/(l+p),h=n+(c+i*s)*u,m=o+(d+r*s)*u;e.r=fe(t,.768*(t.R_MED||20)*(t.DPR||1)*Math.max(.1,Math.min(6,t.parallaxLinearDotSizeMul??1.8))*(Number.isFinite(e.O)?e.O:1)*u),e.x=h,e.y=m,e.vx=0,e.vy=0}function it(e){if(!e.K)return;const t=f(),a=t.canvas;if(!a)return;const n=.5*a.width,o=.5*a.height;let i=0,r=0;t.mouseInCanvas&&(i=Math.max(-1,Math.min(1,(t.mouseX-n)/(.5*a.width))),r=Math.max(-1,Math.min(1,(t.mouseY-o)/(.5*a.height))));const l=Math.max(100,t.parallaxPerspectiveFocalLength??400),s=Math.max(0,t.parallaxPerspectiveParallaxStrength??150),{x:c,y:d,z:p}=e.K,u=l/(l+p),h=n+(c+i*s)*u,m=o+(d+r*s)*u;e.r=fe(t,.6*(t.R_MED||20)*(t.DPR||1)*Math.max(.1,Math.min(6,t.parallaxPerspectiveDotSizeMul??1.8))*(Number.isFinite(e.O)?e.O:1)*u),e.x=h,e.y=m,e.vx=0,e.vy=0}function rt(e){const t=f(),a=t.currentMode;if(t.currentMode===Ln.CRITTERS&&e!==Ln.CRITTERS&&(void 0!==t.W&&(t.REST=t.W,delete t.W),void 0!==t.R&&(t.FRICTION=t.R,delete t.R),void 0!==t.B&&(t.ballSpacing=t.B,delete t.B)),g(e),e!==a)try{$?.()}catch(o){}if(console.log("Switching to mode: "+e),(e=>{const t=document.getElementById("announcer");t&&(t.textContent="",setTimeout(()=>{t.textContent=e},10))})(`Switched to ${{pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero Gravity",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope","kaleidoscope-1":"Kaleidoscope I","kaleidoscope-2":"Kaleidoscope II","kaleidoscope-3":"Kaleidoscope III","orbit-3d":"Orbit 3D","orbit-3d-2":"Orbit 3D (Tight Swarm)",critters:"Critters",neural:"Neural Network",lattice:"Crystal Lattice","parallax-linear":"Parallax (Linear)","parallax-perspective":"Parallax (Perspective)"}[e]||e} mode`),t.container){const a=t.container.classList.contains("dark-mode");t.container.className="",e!==Ln.PIT&&e!==Ln.PIT_THROWS||t.container.classList.add("mode-pit"),(a||t.isDarkMode)&&t.container.classList.add("dark-mode")}De(),e===Ln.PIT?(t.gravityMultiplier=t.gravityMultiplierPit,t.G=t.GE*t.gravityMultiplier,t.repellerEnabled=!0,(()=>{const e=f();M(),((e,t)=>{const a=e.DPR,n=-.65*e.canvas.height,o=(e.wallThickness||20)*a,i=o,r=e.canvas.width-o,l=r-i,s=Math.max(1,.22*l),c=i+l*(2/3),d=Math.max(i,c-.5*s),p=Math.min(r,c+.5*s),u=Math.max(0,0|t),h=100*a,f=50*a;for(let m=0;u>m;m++){const e=ye(d+Math.random()*(p-d),n+Math.random()*(0-n));e.vx=(Math.random()-.5)*h,e.vy=Math.random()*f+f,e.driftAx=0,e.driftTime=0}})(e,m(e.maxBalls??300))})()):e===Ln.PIT_THROWS?(t.gravityMultiplier=t.gravityMultiplierPit,t.G=t.GE*t.gravityMultiplier,t.repellerEnabled=!0,(()=>{const e=f();M(),m(e.maxBalls??300)>0&&(e.p={spawnedTotal:0,side:0,cooldown:0,batchCount:0,batchPaused:!1,queueA:-1,queueB:-1,queueColorA:void 0,queueColorB:void 0,queueSideA:0,queueSideB:1},Ce(e,ke(e.p),e.p.side),e.p.side=1-e.p.side)})()):e===Ln.FLIES?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M();const t=m(e.fliesBallCount??60);if(0>=t)return;const a=.5*e.canvas.width,n=.5*e.canvas.height,o=150*e.DPR,i=300*e.DPR;for(let r=0;8>r;r++){const e=Math.random()*Math.PI*2,t=Math.random()*o,r=ye(a+Math.cos(e)*t,n+Math.sin(e)*t,_()),l=.5+.5*Math.random(),s=Math.random()*Math.PI*2,c=i*l;r.vx=Math.cos(s)*c,r.vy=Math.sin(s)*c,r.driftAx=0,r.driftTime=0}for(let r=8;t>r;r++){const e=Math.random()*Math.PI*2,t=Math.random()*o,r=ye(a+Math.cos(e)*t,n+Math.sin(e)*t),l=.5+.5*Math.random(),s=Math.random()*Math.PI*2,c=i*l;r.vx=Math.cos(s)*c,r.vy=Math.sin(s)*c,r.driftAx=0,r.driftTime=0}})()):e===Ln.WEIGHTLESS?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M();const t=m(e.weightlessCount);if(0>=t)return;const a=e.canvas.width,n=e.canvas.height,o=e.DPR||1,i=40*o,r=e.weightlessInitialSpeed*o;for(let l=0;t>l;l++){const e=ye(i+Math.random()*(a-2*i),i+Math.random()*(n-2*i)),t=Math.random()*Math.PI*2,o=r*(.7+.3*Math.random());e.vx=Math.cos(t)*o,e.vy=Math.sin(t)*o,e.driftAx=0,e.driftTime=0}})()):e===Ln.WATER?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M(),Wo.length=0;const t=e.canvas;if(!t)return;const a=t.width,n=t.height,o=m(e.waterBallCount||100);if(0>=o)return;const i=(e.waterInitialVelocity||120)*(e.DPR||1);for(let r=0;8>r&&o>r;r++){const t=Math.random()*a,o=Math.random()*n,r=me(e,Ln.WATER),l=_(),s=new Ko(t,o,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}for(let r=8;o>r;r++){const t=Math.random()*a,o=Math.random()*n,r=me(e,Ln.WATER),l=_(),s=new Ko(t,o,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}})()):e===Ln.VORTEX?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M();const t=e.canvas;if(!t)return;const a=t.width,n=t.height,o=m(Math.min(e.vortexBallCount||180,e.maxBalls||500));if(0>=o)return;const i=80*(e.vortexSpeedMultiplier??1)*(e.DPR||1);for(let r=0;8>r&&o>r;r++){const t=Math.random()*a,o=Math.random()*n,r=me(e,Ln.VORTEX),l=_(),s=new Ko(t,o,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}for(let r=8;o>r;r++){const t=Math.random()*a,o=Math.random()*n,r=me(e,Ln.VORTEX),l=_(),s=new Ko(t,o,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}})()):e===Ln.PING_PONG?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M();const t=e.canvas;if(!t)return;const a=t.width,n=t.height,o=m(Math.min(e.pingPongBallCount||80,e.maxBalls||300));if(0>=o)return;const i=e.pingPongSpeed||400;for(let r=0;8>r&&o>r;r++){const t=Math.random()*a,o=.15*n+Math.random()*n*.7,r=me(e,Ln.PING_PONG),l=_(),s=new Ko(t,o,r,l);s.vx=(Math.random()>.5?1:-1)*(.8*i+Math.random()*i*.4),s.vy=0,s.isPingPong=!0,e.balls.push(s)}for(let r=8;o>r;r++){const t=Math.random()*a,o=.15*n+Math.random()*n*.7,r=me(e,Ln.PING_PONG),l=_(),s=new Ko(t,o,r,l);s.vx=(Math.random()>.5?1:-1)*(.8*i+Math.random()*i*.4),s.vy=0,s.isPingPong=!0,e.balls.push(s)}})()):e===Ln.MAGNETIC?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M();const t=e.canvas;if(!t)return;const a=t.width,n=t.height,o=m(Math.min(e.magneticBallCount||180,e.maxBalls||300));if(0>=o)return;const i=100*(e.DPR||1);for(let r=0;8>r&&o>r;r++){const t=Math.random()*a,o=Math.random()*n,r=me(e,Ln.MAGNETIC),l=_(),s=new Ko(t,o,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,s.charge=Math.random()>.5?1:-1,s.baseAlpha=1,e.balls.push(s)}for(let r=8;o>r;r++){const t=Math.random()*a,o=Math.random()*n,r=me(e,Ln.MAGNETIC),l=_(),s=new Ko(t,o,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,s.charge=Math.random()>.5?1:-1,s.baseAlpha=1,e.balls.push(s)}})()):e===Ln.BUBBLES?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();e.balls.length=0;const t=e.canvas;if(!t)return;const a=t.width,n=t.height,o=m(e.bubblesMaxCount||200);if(o>0){for(let e=0;8>e&&o>e;e++)Ee(Math.random()*a,Math.random()*n,_(),!0);for(let e=8;o>e;e++)Ee(Math.random()*a,Math.random()*n,_(),!0)}})()):e===Ln.KALEIDOSCOPE?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,je(m(f().kaleidoscopeBallCount??23),Ln.KALEIDOSCOPE)):e===Ln.KALEIDOSCOPE_1?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,je(m(f().kaleidoscope1BallCount??18),Ln.KALEIDOSCOPE_1)):e===Ln.KALEIDOSCOPE_2?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,je(m(f().kaleidoscope2BallCount??36),Ln.KALEIDOSCOPE_2)):e===Ln.KALEIDOSCOPE_3?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,je(m(f().kaleidoscope3BallCount??54),Ln.KALEIDOSCOPE_3)):e===Ln.ORBIT_3D?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M();const t=m(Math.max(0,0|(e.orbit3dMoonCount??80)));if(0>=t)return;const a=e.canvas.width,n=e.canvas.height;for(let o=0;t>o;o++){const t=Math.random()*Math.PI*2,o=.15*Math.min(a,n)+Math.random()*Math.min(a,n)*.1,i=ye(.5*a+Math.cos(t)*o,.5*n+Math.sin(t)*o,_());if(!i)continue;const r=e.DPR||1,l=(e.orbit3dVelocityMult??150)*(.9+.2*Math.random())*r;i.vx=-Math.sin(t)*l,i.vy=Math.cos(t)*l,i.orbitDepth=Math.random()}})()):e===Ln.ORBIT_3D_2?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f();M();const t=m(Math.max(0,0|(e.orbit3d2MoonCount??100)));if(0>=t)return;const a=e.canvas.width,n=e.canvas.height;for(let o=0;t>o;o++){const t=Math.random()*Math.PI*2,o=.35*Math.min(a,n)+Math.random()*Math.min(a,n)*.15,i=ye(.5*a+Math.cos(t)*o,.5*n+Math.sin(t)*o,_());if(!i)continue;const r=150*(e.orbit3d2VelocityMult??1.1)*(e.DPR||1);i.vx=-Math.sin(t)*r,i.vy=Math.cos(t)*r,i.orbitDepth=Math.random()}})()):e===Ln.CRITTERS?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,void 0===t.W&&(t.W=t.REST),void 0===t.R&&(t.R=t.FRICTION),t.REST=t.critterRestitution??t.REST,t.FRICTION=t.critterFriction??t.FRICTION,void 0===t.B&&(t.B=t.ballSpacing),t.ballSpacing=Math.min(t.ballSpacing||0,1),(()=>{const e=f();M();const t=e.canvas.width,a=e.canvas.height,n=m(Math.max(10,Math.min(260,0|e.critterCount)));if(n>0){for(let o=0;8>o&&n>o;o++){const n=ye(Math.random()*t|0,Math.random()*a|0,_()),o=me(e,Ln.CRITTERS);n.r=o,n.rBase=o,n.m=Math.max(1,o*o*.12),n.vx=0,n.vy=0,n.k=Math.random()*Math.PI*2,n.C=0,n.P=Math.random(),n.F=n.P,n.D=2*Math.random()-1,n.T=0}for(let o=8;n>o;o++){const n=ye(Math.random()*t|0,Math.random()*a|0,_()),o=me(e,Ln.CRITTERS);n.r=o,n.rBase=o,n.m=Math.max(1,o*o*.12),n.vx=0,n.vy=0,n.k=Math.random()*Math.PI*2,n.C=0,n.P=Math.random(),n.F=n.P,n.D=2*Math.random()-1,n.T=0}}})()):e===Ln.NEURAL?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!0,(()=>{const e=f(),t=e.canvas;if(!t)return;M();const a=m(Math.max(8,Math.min(e.neuralBallCount??80,260)));if(0>=a)return;const n=t.width,o=t.height,i=40*(e.DPR||1),r=Math.min(8,a);for(let l=0;r>l;l++){const t=ye(i+Math.random()*(n-2*i),i+Math.random()*(o-2*i),_()),a=me(e,Ln.NEURAL);t.r=a,t.rBase=a,t.m=Math.max(1,a*a*.12),t.vx=0,t.vy=0,t.driftAx=0,t.driftTime=0,t.I=Math.random()*Math.PI*2}for(let l=r;a>l;l++){const t=ye(i+Math.random()*(n-2*i),i+Math.random()*(o-2*i),_()),a=me(e,Ln.NEURAL);t.r=a,t.rBase=a,t.m=Math.max(1,a*a*.12),t.vx=0,t.vy=0,t.driftAx=0,t.driftTime=0,t.I=Math.random()*Math.PI*2}})()):e===Ln.LATTICE?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!0,(()=>{const e=f();M();const t=e.canvas,a=t.width,n=t.height,o=Math.max(8,((e,t)=>.01*t*Math.max(1,Math.min(e.width,e.height)))(t,e.latticeSpacingVw??8.5)),i=.8660254037844386*o,r=Math.ceil(a/o)+2,l=Math.ceil(n/i)+2,s=e.isMobile?Math.max(0,Math.min(1,+(e.mobileObjectReductionFactor??.7))):1;if(e.isMobile&&0>=s)return;const c=Math.sqrt(s),d=Math.max(0,Math.round(r*c)),p=Math.max(0,Math.round(l*c));if(0>=d||0>=p)return;const u=e.latticeAlignment??"center",h=(d-1)*o,m=(p-1)*i;let b,g;"center"===u?(b=.5*(a-h),g=.5*(n-m)):"top-left"===u?(b=.5*-o,g=.5*-i):"top-center"===u?(b=.5*(a-h),g=.5*-i):"top-right"===u?(b=a-h+.5*o,g=.5*-i):(b=.5*(a-h),g=.5*(n-m));const y=.25*o;for(let f=0;p>f;f++){const e=1&f?.5*o:0,t=g+f*i;for(let i=0;d>i;i++){const r=b+i*o+e;if(!(-y>r||r>a+y||-y>t||t>n+y)){const e=ye(r,t,_());e.latticeHomeX=r,e.latticeHomeY=t,e.latticeRow=f,e.latticeCol=i,e.vx=0,e.vy=0,e.driftAx=0,e.driftTime=0}}}})()):e===Ln.PARALLAX_LINEAR?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f(),t=e.canvas;if(!t)return;M();const a=t.width,n=t.height,o=m(Math.max(0,Math.min(40,Math.round(e.parallaxLinearGridX??14)))),i=m(Math.max(0,Math.min(40,Math.round(e.parallaxLinearGridY??10)))),r=m(Math.max(0,Math.min(20,Math.round(e.parallaxLinearGridZ??7))));if(0>=o||0>=i||0>=r)return;const l=Math.max(.2,Math.min(3,e.parallaxLinearSpanX??1.35)),s=Math.max(.2,Math.min(3,e.parallaxLinearSpanY??1.35)),c=-.5*a*l,d=-.5*n*s,p=a*l/Math.max(1,o-1),u=n*s/Math.max(1,i-1),h=Math.max(10,e.parallaxLinearZNear??50),b=(Math.max(h+100,e.parallaxLinearZFar??800)-h)/Math.max(1,r-1),g=Math.max(80,e.parallaxLinearFocalLength??420),y=.768*(e.R_MED||20)*(e.DPR||1)*Math.max(.1,Math.min(6,e.parallaxLinearDotSizeMul??1.8)),v=he(e,Ln.PARALLAX_LINEAR),w=.5*a,x=.5*n;for(let f=r-1;f>=0;f--){const t=h+f*b;for(let a=0;i>a;a++)for(let n=0;o>n;n++){const o=c+n*p,i=d+a*u,r=t,l=g/(g+r),s=y*l,h=1,f=ye(w+o*l,x+i*l,_());f.r=fe(e,s),f.vx=0,f.vy=0,f.alpha=h,f.K={x:o,y:i,z:r,baseScale:l},f.O=v>1e-6?1+(2*Math.random()-1)*v:1,f.V=!0}}})()):e===Ln.PARALLAX_PERSPECTIVE&&(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=f(),t=e.canvas;if(!t)return;M();const a=t.width,n=t.height,o=m(Math.max(0,Math.min(50,Math.round(e.parallaxPerspectiveGridX??16)))),i=m(Math.max(0,Math.min(50,Math.round(e.parallaxPerspectiveGridY??12)))),r=m(Math.max(0,Math.min(25,Math.round(e.parallaxPerspectiveGridZ??8))));if(0>=o||0>=i||0>=r)return;const l=Math.max(.2,Math.min(3,e.parallaxPerspectiveSpanX??1.45)),s=Math.max(.2,Math.min(3,e.parallaxPerspectiveSpanY??1.45)),c=-.5*a*l,d=-.5*n*s,p=a*l/Math.max(1,o-1),u=n*s/Math.max(1,i-1),h=Math.max(10,e.parallaxPerspectiveZNear??40),b=(Math.max(h+100,e.parallaxPerspectiveZFar??1200)-h)/Math.max(1,r-1),g=Math.max(0,Math.min(1,e.parallaxPerspectiveRandomness??.6)),y=Math.max(80,e.parallaxPerspectiveFocalLength??420),v=.6*(e.R_MED||20)*(e.DPR||1)*Math.max(.1,Math.min(6,e.parallaxPerspectiveDotSizeMul??1.8)),w=he(e,Ln.PARALLAX_PERSPECTIVE),x=.5*a,S=.5*n;for(let f=r-1;f>=0;f--){const t=h+f*b;for(let a=0;i>a;a++)for(let n=0;o>n;n++){const o=d+a*u,i=t,r=c+n*p+(Math.random()-.5)*p*g,l=o+(Math.random()-.5)*u*g,s=i+(Math.random()-.5)*b*g*.5,h=y/(y+s),f=v*h,m=1,M=ye(x+r*h,S+l*h,_());M.r=fe(e,f),M.vx=0,M.vy=0,M.alpha=m,M.K={x:r,y:l,z:s,baseScale:h},M.O=w>1e-6?1+(2*Math.random()-1)*w:1,M.V=!0}}})()),console.log(`Mode ${e} initialized with ${t.balls.length} balls`);const n=Math.max(0,Math.round(((e,t)=>{switch(e){case Ln.PIT:return t.pitWarmupFrames??10;case Ln.PIT_THROWS:return t.pitThrowsWarmupFrames??10;case Ln.FLIES:return t.fliesWarmupFrames??10;case Ln.WEIGHTLESS:return t.weightlessWarmupFrames??10;case Ln.WATER:return t.waterWarmupFrames??10;case Ln.VORTEX:return t.vortexWarmupFrames??10;case Ln.PING_PONG:return t.pingPongWarmupFrames??10;case Ln.MAGNETIC:return t.magneticWarmupFrames??10;case Ln.BUBBLES:return t.bubblesWarmupFrames??10;case Ln.KALEIDOSCOPE:return t.kaleidoscopeWarmupFrames??10;case Ln.KALEIDOSCOPE_1:return t.kaleidoscope1WarmupFrames??10;case Ln.KALEIDOSCOPE_2:return t.kaleidoscope2WarmupFrames??10;case Ln.KALEIDOSCOPE_3:return t.kaleidoscope3WarmupFrames??10;case Ln.ORBIT_3D:return t.orbit3dWarmupFrames??10;case Ln.ORBIT_3D_2:return t.orbit3d2WarmupFrames??10;case Ln.CRITTERS:return t.crittersWarmupFrames??10;case Ln.NEURAL:return t.neuralWarmupFrames??10;case Ln.LATTICE:return t.latticeWarmupFrames??10;case Ln.PARALLAX_LINEAR:return t.parallaxLinearWarmupFrames??10;case Ln.PARALLAX_PERSPECTIVE:return t.parallaxPerspectiveWarmupFrames??10;default:return 10}})(e,t)||0));if(t.warmupFramesRemaining=n,"undefined"!=typeof window&&e!==a)try{window.dispatchEvent(new CustomEvent("bb:modeChanged",{detail:{prevMode:a,mode:e}}))}catch(o){}}function lt(){const e=f();try{$?.()}catch(t){}rt(e.currentMode)}function st(){const e=f();return e.currentMode===Ln.FLIES?ve:e.currentMode===Ln.PIT||e.currentMode===Ln.PIT_THROWS?we:e.currentMode===Ln.WEIGHTLESS?Fe:e.currentMode===Ln.WATER?be:e.currentMode===Ln.VORTEX?Ae:e.currentMode===Ln.PING_PONG?Ke:e.currentMode===Ln.MAGNETIC?Oe:e.currentMode===Ln.BUBBLES?ze:e.currentMode===Ln.KALEIDOSCOPE||e.currentMode===Ln.KALEIDOSCOPE_1||e.currentMode===Ln.KALEIDOSCOPE_2||e.currentMode===Ln.KALEIDOSCOPE_3?Xe:e.currentMode===Ln.ORBIT_3D?qe:e.currentMode===Ln.ORBIT_3D_2?Ue:e.currentMode===Ln.CRITTERS?et:e.currentMode===Ln.NEURAL?tt:e.currentMode===Ln.LATTICE?nt:e.currentMode===Ln.PARALLAX_LINEAR?ot:e.currentMode===Ln.PARALLAX_PERSPECTIVE?it:null}function ct(){const e=f();return e.currentMode===Ln.WATER?ge:e.currentMode===Ln.PIT_THROWS?Pe:e.currentMode===Ln.MAGNETIC?We:e.currentMode===Ln.BUBBLES?Be:null}function dt(){return f().currentMode===Ln.NEURAL?{preRender:at}:null}function pt(){const e=f();return e?.cursorColorHex&&"string"==typeof e.cursorColorHex?e.cursorColorHex:"#000000"}function ut(){Jo||(Uo=document.createElement("div"),Uo.id="custom-cursor",Uo.setAttribute("aria-hidden","true"),document.body.appendChild(Uo),Uo.style.display="none",Uo.style.opacity="0",Jo=!0,ht(),(()=>{if(ai||!Uo)return;ai=!0;const e=f(),t=(e.entranceWallTransitionDelay||300)+.3*(e.entranceWallTransitionDuration||800)+(e.entranceElementDuration||200)+300,a="cubic-bezier(0.16, 1, 0.3, 1)";window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches?setTimeout(()=>{Uo&&(Uo.style.opacity="1")},t):setTimeout(()=>{if(Uo){if("function"!=typeof Uo.animate)return Uo.style.opacity="1",void(Uo.style.transition="opacity 800ms "+a);Qo&&(Uo.style.display="block"),ni=Uo.animate([{opacity:0},{opacity:1}],{duration:800,easing:a,fill:"forwards"}),ni?.addEventListener?.("finish",()=>{Uo&&(Uo.style.opacity="1")}),ni?.addEventListener?.("cancel",()=>{Uo&&(Uo.style.opacity="1")})}},t)})())}function ht(){if(!Uo)return;const e=f(),t=.5*(e.R_MIN+e.R_MAX)*e.cursorSize*2;Uo.style.width=t+"px",Uo.style.height=t+"px",Uo.style.borderRadius="50%",Uo.style.marginLeft="0",Uo.style.marginTop="0",Qo||(Uo.style.transform="translate(-50%, -50%) scale(1)")}function ft(e,t){if(!Uo)return;if((()=>{try{return!!document?.body?.classList?.contains?.("abs-link-hovering")}catch(e){return!1}})())return void(Uo.style.display="none");const a=Qo;Qo=((e,t)=>{const a=document.getElementById("bravia-balls");if(!a)return!1;const n=performance.now();return ei&&100>=n-ti||(ei=a.getBoundingClientRect(),ti=n),!(ei.left>e||e>ei.right||ei.top>t||t>ei.bottom)})(e,t),Uo.style.left=e+"px",Uo.style.top=t+"px",document.body.style.cursor="none",Qo?(Uo.style.display="block",a?Uo.style.transform!==oi&&(Uo.style.transform=oi):(Uo.style.transform=ii,requestAnimationFrame(()=>{Uo.style.transform=oi}))):(Uo.style.display="none",a&&(Uo.style.transform=ii,Uo.style.backgroundColor="",Uo.style.filter=""))}function mt(){Uo&&(Uo.style.display="none",document.body.style.cursor="none",Qo=!1)}function bt(){Uo&&(Qo=!1)}function gt(){const e=(()=>{try{return!!document?.body?.classList?.contains?.("abs-link-hovering")}catch(e){return!1}})();return e&&!hi&&(pi=0,ui=0),hi=e,e}function Mt(){try{return!!window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches}catch(e){return!1}}function yt(e,t,a){return t>e?t:e>a?a:e}function vt(e,t){const a=[{x:bi,y:bi},{x:t.width-bi,y:bi},{x:bi,y:t.height-bi},{x:t.width-bi,y:t.height-bi}];for(let n=0;a.length>n;n++){const t=e.x-a[n].x,o=e.y-a[n].y,i=Math.max(1,Math.hypot(t,o));if(bi+e.r>i){const a=(bi+e.r-i)/(bi+e.r)*1800,n=o/i;e.vx+=t/i*a*fi,e.vy+=n*a*fi}}}function wt(e,t){const a=f(),n=a.balls,o=a.canvas;if(!o)return;if(0===n.length)return;if(a.currentMode===Ln.KALEIDOSCOPE||a.currentMode===Ln.KALEIDOSCOPE_1||a.currentMode===Ln.KALEIDOSCOPE_2||a.currentMode===Ln.KALEIDOSCOPE_3){const i=Math.min(.033,Math.max(0,e)),r=n.length;for(let e=0;r>e;e++)n[e].step(i,t);(({iterations:e=4,positionalCorrectionPercent:t=.25,positionalCorrectionSlopPx:a=null,maxCorrectionPx:n=null,enableSound:o=!0}={})=>{const i=f(),r=i.balls,l=le(),s=i.REST,c=t,d=a??.5*i.DPR,p=i.ballSpacing||0,u=n??2*(i.DPR||1);for(let h=0;e>h;h++)for(let e=0;l.length>e;e++){const{i:t,j:a}=l[e],n=r[t],f=r[a];if(n.isSleeping&&f.isSleeping)continue;n.isSleeping&&n.wake(),f.isSleeping&&f.wake();const m=f.x-n.x,b=f.y-n.y,g=n.r+f.r+(n.r+f.r)/2*p,M=m*m+b*b;if(0===M||M>g*g)continue;const y=Math.sqrt(M),v=m/y,w=b/y,x=g-y,S=1/Math.max(n.m,.001),k=1/Math.max(f.m,.001);let C=c*Math.max(x-d,0)/(S+k);C>u&&(C=u);const P=C*v,F=C*w;n.x-=P*S,n.y-=F*S,f.x+=P*k,f.y+=F*k;const T=(f.vx-n.vx)*v+(f.vy-n.vy)*w;if(0>T){const e=-(1+(30>Math.abs(T)?0:s))*T/(S+k),r=e*v,l=e*w;if(n.vx-=r*S,n.vy-=l*S,f.vx+=r*k,f.vy+=l*k,o&&0===h){const e=(n.r+f.r)/2,o=(n.x+f.x)/2/(i.canvas?.width||1);U(e,Math.min(1,Math.abs(T)/(50*(n.r+f.r))),o,`${t}-${a}`)}}}})({iterations:3,positionalCorrectionPercent:.22,maxCorrectionPx:1.25*(a.DPR||1),enableSound:!1});for(let e=0;r>e;e++)Ge(n[e],o.width,o.height,i);return void(mi=0)}mi+=e;let i=0;for(Lo.clearPressureFrame();mi>=fi&&On.MAX_PHYSICS_STEPS>i;){const e=n.length;for(let a=0;e>a;a++)n[a].step(fi,t);const r=Math.max(1,Math.min(20,Math.round(+(a.physicsCollisionIterations??10)||10)));if(a.currentMode===Ln.KALEIDOSCOPE||a.currentMode===Ln.KALEIDOSCOPE_1||a.currentMode===Ln.KALEIDOSCOPE_2||a.currentMode===Ln.KALEIDOSCOPE_3?se(6):a.currentMode!==Ln.FLIES&&a.currentMode!==Ln.ORBIT_3D&&a.currentMode!==Ln.PARALLAX_LINEAR&&a.currentMode!==Ln.PARALLAX_PERSPECTIVE&&se(r),Lo.resetStepBudgets(),a.currentMode!==Ln.ORBIT_3D&&a.currentMode!==Ln.ORBIT_3D_2&&a.currentMode!==Ln.PARALLAX_LINEAR&&a.currentMode!==Ln.PARALLAX_PERSPECTIVE&&a.currentMode!==Ln.LATTICE){const e=a.currentMode===Ln.WEIGHTLESS?a.weightlessBounce:a.REST,t=a.currentMode===Ln.PIT||a.currentMode===Ln.PIT_THROWS,i=n.length;for(let a=0;i>a;a++)t||vt(n[a],o),n[a].walls(o.width,o.height,fi,e)}if(a.currentMode===Ln.PIT||a.currentMode===Ln.PIT_THROWS){se(3);const e=a.REST,t=n.length;for(let a=0;t>a;a++)n[a].walls(o.width,o.height,fi,e,{registerEffects:!1});const i=a.DPR||1,r=(Number.isFinite(a.sleepVelocityThreshold)?a.sleepVelocityThreshold:12)*i,l=Number.isFinite(a.sleepAngularThreshold)?a.sleepAngularThreshold:.18,s=a.timeToSleep??.25;for(let a=0;t>a;a++){const e=n[a];if(!e||e.isSleeping)continue;const t=Math.sqrt(e.vx*e.vx+e.vy*e.vy),o=Math.abs(e.omega);(e.isGrounded||e.hasSupport)&&r>t&&l>o?(e.vx*=.5,e.vy*=.5,e.omega*=.5,2*i>t&&(e.vx=0,e.vy=0),.02>o&&(e.omega=0),e.sleepTimer+=fi,s>e.sleepTimer||(e.vx=0,e.vy=0,e.omega=0,e.isSleeping=!0)):e.sleepTimer=0}}if(!1!==a.physicsSkipSleepingSteps){const e=a.currentMode;if(e!==Ln.FLIES&&e!==Ln.ORBIT_3D&&e!==Ln.ORBIT_3D_2&&e!==Ln.PARALLAX_LINEAR&&e!==Ln.PARALLAX_PERSPECTIVE&&e!==Ln.KALEIDOSCOPE&&e!==Ln.KALEIDOSCOPE_1&&e!==Ln.KALEIDOSCOPE_2&&e!==Ln.KALEIDOSCOPE_3&&e!==Ln.PIT&&e!==Ln.PIT_THROWS){const e=a.DPR||1,t=Math.max(0,+(a.physicsSleepThreshold??12)||0)*e,o=Math.max(0,+(a.physicsSleepTime??.25)||0),i=Number.isFinite(a.sleepAngularThreshold)?a.sleepAngularThreshold:.18;if(t>0&&o>0){const e=n.length;for(let a=0;e>a;a++){const e=n[a];e&&!e.isSleeping&&(t>Math.sqrt(e.vx*e.vx+e.vy*e.vy)&&i>Math.abs(e.omega)?(e.sleepTimer+=fi,o>e.sleepTimer||(e.vx=0,e.vy=0,e.omega=0,e.isSleeping=!0)):e.sleepTimer=0)}}}}mi-=fi,i++}const r=ct();r&&r(e),Lo.step(e),mi>fi*On.ACCUMULATOR_RESET_THRESHOLD&&(mi=0)}async function xt(e,t){const a=f(),n=a.balls;if(!a.canvas)return;if(!n||0===n.length)return;const o=Math.max(0,Math.round(a.warmupFramesRemaining||0));if(o>0){a.warmupFramesRemaining=0,mi=0;for(let e=0;o>e;e++)wt(gi,t)}else wt(e,t)}function St(){const e=f(),t=e.ctx,a=e.balls,n=e.canvas;if(!t||!n)return;t.clearRect(0,0,n.width,n.height);const o=e.canvasClipPath;if(o){t.save();try{t.clip(o)}catch(r){}}const i=dt();if(i&&i.preRender&&i.preRender(t),e.currentMode===Ln.KALEIDOSCOPE||e.currentMode===Ln.KALEIDOSCOPE_1||e.currentMode===Ln.KALEIDOSCOPE_2||e.currentMode===Ln.KALEIDOSCOPE_3)(e=>{const t=f();if(!Ze(t.currentMode))return;const a=t.canvas;if(!a)return;const n=(()=>{const e=performance.now(),t=Yo||e;return Yo=e,Ve((e-t)/1e3,0,.05)})(),o=t.balls,i=a.width,r=a.height,l=$e(t),s=He(t).wedges??12,c=Ve(Math.round(s),3,24),d=!!(t.kaleidoscopeMirror??1),p=(e=>.5*e.width)(a),u=(e=>.5*e.height)(a),h=jo/c,m=Math.max(1e-5,1e-4*h),b=t.mouseInCanvas?t.mouseX:p,g=t.mouseInCanvas?t.mouseY:u,M=b-p,y=g-u,v=Math.atan2(y,M),w=Ve(Math.hypot(M,y)/Math.max(1,.5*Math.min(i,r)),0,1);t.$||(t.$={phase:{x:0,v:0},panX:{x:0,v:0},panY:{x:0,v:0},lastMouseX:b,lastMouseY:g,lastInCanvas:!!t.mouseInCanvas});const x=t.$,S=!!t.mouseInCanvas,k=Math.hypot(b-x.lastMouseX,g-x.lastMouseY)>.5||S!==x.lastInCanvas,C=Ve(He(t).speed??1,.2,2),P=Ye(t),F=.65*C*P,T=M*F*(t.mouseInCanvas?1:0),D=y*F*(t.mouseInCanvas?1:0),I=.7*v*P*(t.mouseInCanvas?1:0);k?(x.lastMouseX=b,x.lastMouseY=g,x.lastInCanvas=S,_e(x.phase,I,n,4.5),_e(x.panX,T,n,5),_e(x.panY,D,n,5)):(x.phase.v=0,x.panX.v=0,x.panY.v=0);const L=x.phase.x,A=x.panX.x,K=x.panY.x,O=.22+.18*Ve((C-.2)/1.8,0,1),W=1-O+2*O*(1-w);for(let f=0;o.length>f;f++){const t=o[f],a=t.x-p+A,n=t.y-u+K,i=3.5*l,r=Math.hypot(a,n)*i*W;if(Zo>r)continue;const s=d?2*h:h;let b=Math.atan2(n,a)+L;b=(b%s+s)%s,d&&b>h&&(b=s-b),b=Ve(b,m,h-m);for(let o=0;c>o;o++){const a=o*h+b,n=p+Math.cos(a)*r,i=u+Math.sin(a)*r;1>t.alpha&&(e.globalAlpha=t.alpha),e.fillStyle=t.color,e.beginPath(),e.arc(n,i,t.r,0,jo),e.fill(),1>t.alpha&&(e.globalAlpha=1)}}})(t);else for(let l=0;a.length>l;l++)a[l].draw(t);i&&i.postRender&&i.postRender(t),o&&t.restore(),(e=>{if(gt())return;const t=f();if(!t?.mouseTrailEnabled)return;if(Mt())return;if(!e||!ui||!li)return;const a=performance.now(),n=yt(+(t.mouseTrailFadeMs??220),40,2e3),o=yt(+(t.mouseTrailOpacity??.35),0,1);if(0>=o)return;const i=t.DPR||1,r=yt(+(t.mouseTrailSize??1.3),.5,10)*i;for(;ui>0&&a-di[(pi-ui+li)%li]>n;)ui--;if(!ui)return;if(2>ui)return;const l=pt(),s=e.globalAlpha,c=e.globalCompositeOperation,d=e.lineCap,p=e.lineJoin,u=e.strokeStyle,h=e.lineWidth;e.globalCompositeOperation="source-over",e.lineCap="round",e.lineJoin="round",e.strokeStyle=l,e.lineWidth=r,e.globalAlpha=o;const m=ui,b=(pi-m+li)%li;if(e.beginPath(),e.moveTo(si[b],ci[b]),2===m)e.lineTo(si[(b+1)%li],ci[(b+1)%li]);else{for(let a=1;m-1>a;a++){const t=(b+a)%li,n=(b+a+1)%li,o=si[t],i=ci[t];e.quadraticCurveTo(o,i,.5*(o+si[n]),.5*(i+ci[n]))}const t=(b+m-1)%li;e.lineTo(si[t],ci[t])}e.stroke(),e.globalAlpha=s,e.globalCompositeOperation=c,e.lineCap=d,e.lineJoin=p,e.strokeStyle=u,e.lineWidth=h})(t),((e,t,a)=>{const n=f();if(!e)return;const o=Do||ce(),i=n.DPR||1,l=Math.max(0,Math.min(10,+(n.wallVisualDeformMul??1)||1)),s="function"==typeof n.getCanvasCornerRadius?n.getCanvasCornerRadius():n.cornerRadius??n.wallRadius??0,c=Math.max(0,(+s||0)*i),d=Math.max(0,(+n.wallThickness||0)*i),p=Math.max(1,t-2*d),u=Math.max(1,a-2*d),h=Math.max(0,Math.min(c,.5*p,.5*u));Lo.ringPhysics.ensureGeometry(p,u,h),Lo.ringRender.ensureGeometry(p,u,h);const m=Math.max(2,2*i);e.save(),e.fillStyle=o,e.beginPath(),e.moveTo(-m,-m),e.lineTo(t+m,-m),e.lineTo(t+m,a+m),e.lineTo(-m,a+m),e.closePath();const b=Lo.ringPhysics,g=Lo.ringRender,M=b.n,y=g.n;if(y>0&&M>0){const o=!1!==n.wallPhysicsInterpolation?Math.max(0,Math.min(1,Lo.N||0)):1,r=g.renderDeformations,s=Lo._,c=Lo.H;if(s&&c&&s.length===y&&c.length===y)for(let e=0;y>e;e++){const t=s[e];r[e]=t+(c[e]-t)*o}else{const e=b.deformations,t=g.deformations;for(let a=0;y>a;a++){const n=a/y*M,o=Math.floor(n)%M,i=n-o;t[a]=(1-i)*e[o]+i*e[(o+1)%M]}for(let a=0;y>a;a++)r[a]=(t[(a-2+y)%y]+4*t[(a-1+y)%y]+6*t[a]+4*t[(a+1)%y]+t[(a+2)%y])*(1/16)}const p=g.baseX,u=g.baseY,h=g.normX,f=g.normY,m=Math.min(Math.max(0,.18*Math.max(1,Math.min(t,a))),Math.max(0,+(n.wallWobbleMaxDeform??Po)||Po)*i*1*l),v=e=>{const t=r[e]*i*1*l;return t>0?t>m?m:t:0},w=e=>p[e]+h[e]*v(e)+d,x=e=>u[e]+f[e]*v(e)+d;e.moveTo(w(y-1),x(y-1));for(let t=y-2;t>=0;t--)e.lineTo(w(t),x(t));e.closePath()}try{e.fill("evenodd")}catch(r){e.fill()}e.restore()})(t,n.width,n.height)}function kt(){Do=ce()}function Ct(){return null===vi&&(vi=(()=>{try{return!1}catch(e){}try{if("8001"==(globalThis?.location?.port??"")+"")return!0}catch(e){}try{if(Array.from(document.scripts||[]).some(e=>{if("module"!==(e.getAttribute("type")||"").toLowerCase())return!1;const t=e.getAttribute("src")||"";return/(^|\/)main\.js(\?|#|$)/.test(t)}))return!0}catch(e){}return!1})()),vi}function Pt(e){const t=Math.random();let a=0;for(let n=0;8>n;n++)if(a+=Ci[n],a>=t)return e[n];return e[0]}function Ft({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"],silence:a=!1}={}){if(!Si){Si=!0;try{yi.log("%c"+e,"color: #888; font-style: italic;"),yi.log("");try{const e=((e,t=3)=>{const{colorAssignments:a}=((e,t=3)=>{let a;try{a=(()=>{try{const e=f(),t=e?.currentColors;if(Array.isArray(t)&&t.length>=8)return t.slice(0,8)}catch(e){}return ki})(),Array.isArray(a)&&a.length>=8||(a=ki)}catch(l){a=ki}const n=[];for(let s=0;e.length>s;s++){const a=e[s];for(let e=0;a.length>e;e+=t){const o=a.slice(e,e+t);n.push({row:s,col:e,visible:o.trim().length>0})}}const o=n.map((e,t)=>e.visible?t:-1).filter(e=>e>=0),i=Array(n.length).fill(null),r=(e=>{for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e})([...o]);for(let s=0;Math.min(8,r.length)>s;s++){const e=Math.min(s,a.length-1);i[r[s]]=a[e]||ki[e]}for(const s of o)null===i[s]&&(i[s]=Pt(a));for(let s=0;n.length>s;s++)null===i[s]&&(i[s]="transparent");return{clusters:n,colorAssignments:i}})(e,t),n=[];let o=0;for(const i of e){let e="";const r=[];for(let n=0;i.length>n;n+=t)e+="%c"+i.slice(n,n+t),r.push(`color: ${a[o]}; font-family: monospace; font-weight: bold; font-size: 12px; letter-spacing: 0;`),o++;n.push([e,...r])}return n})(t,3);for(const t of e)yi.log(...t)}catch(n){for(const e of t)yi.log(e)}yi.log("");const a=(new Date).getFullYear();yi.log("%c© "+a+" Alexander Beck Studio. All rights reserved. Unauthorized reproduction prohibited.","color: #555; font-size: 10px;")}catch(o){}if(a)try{console.log=()=>{},console.info=()=>{},console.warn=()=>{},console.debug=()=>{},console.table=()=>{},console.group=()=>{},console.groupCollapsed=()=>{},console.groupEnd=()=>{}}catch(o){}}}function Tt(e){if(!Ct())return;const t=("undefined"!=typeof performance&&performance.now?performance.now():Date.now())-xi;wi+=1,yi.log(`[${(wi+"").padStart(2,"0")}] +${t.toFixed(1)}ms ${e}`)}function Dt(e){if(Ct())try{performance.mark(e)}catch(t){}}function It(e,t,a){if(!Ct())return null;try{performance.measure(e,t,a);const n=performance.getEntriesByName(e),o=n&&n.length?n[n.length-1]:null;return o?o.duration:null}catch(n){return null}}function Lt(){const e=navigator.userAgent||"",t=/Android/.test(e),a=/iPhone|iPad|iPod/.test(e)||/Mac/.test(e)&&navigator.maxTouchPoints>1,n=t||a,o=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||window.matchMedia&&window.matchMedia("(display-mode: minimal-ui)").matches||!0===navigator.standalone;return n||o}function At(){if(Pi&&Fi){const e=document.documentElement;return e.style.setProperty("--frame-color-light",Pi),void e.style.setProperty("--frame-color-dark",Fi)}const e=f(),a=document.documentElement,n=e?.frameColorLight||e?.frameColor||t("--frame-color-light","#0a0a0a"),o=e?.frameColorDark||e?.frameColor||t("--frame-color-dark","#0a0a0a");a.style.setProperty("--frame-color-light",n),a.style.setProperty("--frame-color-dark",o)}function Kt(e){(()=>{if(Pi&&Fi)return;const e=f();Pi=e?.frameColorLight||e?.frameColor||t("--frame-color-light","#0a0a0a"),Fi=e?.frameColorDark||e?.frameColor||t("--frame-color-dark","#0a0a0a")})(),(e=>{const t=document.documentElement;t.style.setProperty("--frame-color-light",e),t.style.setProperty("--frame-color-dark",e)})(t(e?"--wall-color-browser-dark":"--wall-color-browser-light",e?"#202124":"#f1f3f4"))}function Ot(e){Ti=e;let a=!1;a="auto"===e?"dark"===Di||(()=>{const e=f();if(!e.autoDarkModeEnabled)return!1;const t=Number.isFinite(e.autoDarkNightStartHour)?e.autoDarkNightStartHour:18,a=Number.isFinite(e.autoDarkNightEndHour)?e.autoDarkNightEndHour:6,n=(new Date).getHours();return t!==a&&(a>t?n>=t&&a>n:n>=t||a>n)})():"dark"===e,(e=>{const a=f();a.isDarkMode=e,document.documentElement.style.colorScheme=e?"dark":"light",e?(a.container?.classList.add("dark-mode"),document.body.classList.add("dark-mode"),document.documentElement.classList.add("dark-mode")):(a.container?.classList.remove("dark-mode"),document.body.classList.remove("dark-mode"),document.documentElement.classList.remove("dark-mode")),(e=>{const t=(f().chromeHarmonyMode||"auto")+"",a=(()=>{const e=navigator.userAgent||"",t=navigator.vendor||"";return{isFirefox:/Firefox\//.test(e),isSafari:/Safari\//.test(e)&&/Apple/.test(t)&&!/Chrome\//.test(e)&&!/Chromium\//.test(e),isChromium:/Chrome\//.test(e)||/Chromium\//.test(e)||/Edg\//.test(e),ua:e}})();if("site"===t)return At(),{mode:t,family:a,themeColorLikelyApplied:Lt()};if("browser"===t)return Kt(e),{mode:t,family:a,themeColorLikelyApplied:Lt()};const n=Lt();a.isSafari?At():a.isChromium&&!n?Kt(e):At()})(e),(e=>{const a=f(),n=a?.frameColorLight||t("--frame-color-light","#0a0a0a"),o=a?.frameColorDark||t("--frame-color-dark","#0a0a0a"),i=e?o:n;let r=document.querySelector('meta[name="theme-color"]');r||(r=document.createElement("meta"),r.name="theme-color",document.head.appendChild(r)),r.content=i;let l=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: light)"]');l||(l=document.createElement("meta"),l.name="theme-color",l.media="(prefers-color-scheme: light)",document.head.appendChild(l)),l.content=n;let s=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: dark)"]');s||(s=document.createElement("meta"),s.name="theme-color",s.media="(prefers-color-scheme: dark)",document.head.appendChild(s)),s.content=o})(e),kt(),G(a.currentTemplate),(()=>{const e=document.getElementById("themeAuto"),t=document.getElementById("themeLight"),a=document.getElementById("themeDark");if(!e||!t||!a)return;[e,t,a].forEach(e=>e.classList.remove("active")),"auto"===Ti?e.classList.add("active"):"light"===Ti?t.classList.add("active"):a.classList.add("active");const n=document.getElementById("themeStatus");if(n){const e=f();n.textContent="auto"===Ti?e.isDarkMode?"🌙 Auto (Dark)":"☀️ Auto (Light)":"light"===Ti?"☀️ Light Mode":"🌙 Dark Mode"}})()})(a);try{localStorage.setItem("theme-preference",e)}catch(n){}Tt(`🎨 Theme set to: ${e} (rendering: ${a?"dark":"light"})`)}function Wt(){if(Ii)return;Ii=!0,(()=>{const e=f(),t=document.documentElement;e?.bgLight&&(t.style.setProperty("--bg-light",e.bgLight),t.style.setProperty("--chrome-bg-light",e.bgLight)),e?.bgDark&&(t.style.setProperty("--bg-dark",e.bgDark),t.style.setProperty("--chrome-bg-dark",e.bgDark)),e?.frameColorLight&&t.style.setProperty("--frame-color-light",e.frameColorLight),e?.frameColorDark&&t.style.setProperty("--frame-color-dark",e.frameColorDark);const a=e.isDarkMode?e?.frameColorDark:e?.frameColorLight;if(a){const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=a),t.style.setProperty("--chrome-bg",a)}e?.textColorLight&&t.style.setProperty("--text-color-light",e.textColorLight),e?.textColorLightMuted&&t.style.setProperty("--text-color-light-muted",e.textColorLightMuted),e?.textColorDark&&t.style.setProperty("--text-color-dark",e.textColorDark),e?.textColorDarkMuted&&t.style.setProperty("--text-color-dark-muted",e.textColorDarkMuted),e?.edgeLabelColorLight&&t.style.setProperty("--edge-label-color-light",e.edgeLabelColorLight),e?.edgeLabelColorDark&&t.style.setProperty("--edge-label-color-dark",e.edgeLabelColorDark),Number.isFinite(e?.edgeLabelInsetAdjustPx)&&t.style.setProperty("--edge-label-inset-adjust",e.edgeLabelInsetAdjustPx+"px"),e?.linkHoverColor&&t.style.setProperty("--link-hover-color",e.linkHoverColor),e?.logoColorLight&&t.style.setProperty("--logo-color-light",e.logoColorLight),e?.logoColorDark&&t.style.setProperty("--logo-color-dark",e.logoColorDark),e?.portfolioLogoColorLight&&t.style.setProperty("--portfolio-logo-color-light",e.portfolioLogoColorLight),e?.portfolioLogoColorDark&&t.style.setProperty("--portfolio-logo-color-dark",e.portfolioLogoColorDark)})(),Di=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",Tt("🖥️ System prefers: "+Di);let e="auto";try{const t=localStorage.getItem("theme-preference");"auto"!==t&&"light"!==t&&"dark"!==t||(e=t)}catch(o){}Ot(e);const t=document.getElementById("themeAuto"),a=document.getElementById("themeLight"),n=document.getElementById("themeDark");t&&t.addEventListener("click",()=>Ot("auto")),a&&a.addEventListener("click",()=>Ot("light")),n&&n.addEventListener("click",()=>Ot("dark")),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{Di=e.matches?"dark":"light",Tt("🖥️ System preference changed to: "+Di),"auto"===Ti&&Ot("auto")}),window.setInterval(()=>{"auto"===Ti&&Ot("auto")},6e4),Tt("✓ Modern dark mode initialized")}function Et(){Ot("light"===Ti?"dark":"light")}function Rt(e){const t={};if(!e||"object"!=typeof e)return t;for(const a of _i)({}).hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}function zt(e,t,a,n){const o="number"==typeof e?e:+e;return Number.isFinite(o)?Math.min(a,Math.max(t,o)):n}function Bt(e,t,a,n){const o="number"==typeof e?e:+e;return Number.isFinite(o)?Math.min(a,Math.max(t,Math.round(o))):n}function Vt(e,t=0){return zt(e,0,1,t)}function $t(e,t,a){return t.includes(e)?e:a}function Nt(e,t){try{const a=getComputedStyle(document.documentElement).getPropertyValue(e).trim(),n=Number.parseFloat(a);return Number.isFinite(n)?n:t}catch{return t}}function _t(e){let t=e>>>0;return()=>{t+=1831565813;let e=t;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}function Gt(e){const t=(e()+e()+e())/3;return Math.max(0,Math.min(1,.5+1.15*(t-.5)))}function Ht(e){const t=document.documentElement;t.style.setProperty("--abs-noise-enabled",e.noiseEnabled?"1":"0");const a=e.noiseMotion,n="drift"===a?"linear":"steps(1, end)";t.style.setProperty("--abs-noise-keyframes","static"===a?"none":"drift"===a?"abs-noise-drift":"abs-noise-jitter"),t.style.setProperty("--abs-noise-timing",n),t.style.setProperty("--abs-noise-speed-back",Math.max(0,Math.round(e.noiseSpeedBackMs))+"ms"),t.style.setProperty("--abs-noise-speed-front",Math.max(0,Math.round(e.noiseSpeedFrontMs))+"ms"),t.style.setProperty("--abs-noise-motion-amount",e.noiseMotionAmount+""),t.style.setProperty("--abs-noise-flicker",e.noiseFlicker+""),t.style.setProperty("--abs-noise-flicker-speed",Math.max(0,Math.round(e.noiseFlickerSpeedMs))+"ms");const o=zt(e.noiseBlurPx,0,6,0);t.style.setProperty("--abs-noise-blur",o.toFixed(2)+"px"),t.style.setProperty("--abs-noise-filter",o>0?`blur(${o.toFixed(2)}px)`:"none");const i=zt(e.noiseMotionAmount,0,2.5,1),r="static"!==e.noiseMotion&&i>0,l=zt(.55*zt(e.noiseSizeTop,20,600,150),24,120,82),s=r?l*i:0;t.style.setProperty("--abs-noise-overscan",`-${Math.ceil(s+(o>0?6*o:0)+32)}px`);const c=_t((2772082231^e.noiseSeed)>>>0);for(let p=1;40>=p;p++){const e=.9*(2*c()-1)*s,a=.9*(2*c()-1)*s;t.style.setProperty(`--abs-noise-j${p}-x`,Math.round(e)+"px"),t.style.setProperty(`--abs-noise-j${p}-y`,Math.round(a)+"px")}const d=c()*Math.PI*2;t.style.setProperty("--abs-noise-drift-x",Math.round(Math.cos(d)*s)+"px"),t.style.setProperty("--abs-noise-drift-y",Math.round(Math.sin(d)*s)+"px"),t.style.setProperty("--noise-size-base",Math.round(e.noiseSizeBase)+"px"),t.style.setProperty("--noise-size-top",Math.round(e.noiseSizeTop)+"px"),t.style.setProperty("--noise-back-opacity-light",e.noiseBackOpacity+""),t.style.setProperty("--noise-front-opacity-light",e.noiseFrontOpacity+""),t.style.setProperty("--noise-back-opacity-dark",e.noiseBackOpacityDark+""),t.style.setProperty("--noise-front-opacity-dark",e.noiseFrontOpacityDark+""),t.style.setProperty("--noise-top-opacity",e.noiseTopOpacity+""),t.style.setProperty("--detail-noise-opacity",(e.detailNoiseOpacity??1)+"")}function jt(e={}){const t=Nt("--noise-size-base",100),a=Nt("--noise-size-top",150),n=Nt("--noise-back-opacity-light",.025),o=Nt("--noise-front-opacity-light",.055),i=Nt("--noise-back-opacity-dark",.12),r=Nt("--noise-front-opacity-dark",.08),l=Nt("--noise-top-opacity",.01),s={noiseSeed:Bt(e.noiseSeed,0,999999,1337),noiseTextureSize:Bt(e.noiseTextureSize,64,512,256),noiseDistribution:$t(e.noiseDistribution,["uniform","gaussian"],"gaussian"),noiseMonochrome:void 0===e.noiseMonochrome||!!e.noiseMonochrome,noiseChroma:Vt(e.noiseChroma,.35),noiseEnabled:void 0===e.noiseEnabled||!!e.noiseEnabled,noiseMotion:$t(e.noiseMotion,["jitter","drift","static"],"jitter"),noiseMotionAmount:zt(e.noiseMotionAmount,0,2.5,1),noiseSpeedBackMs:Bt(e.noiseSpeedBackMs,0,1e4,1800),noiseSpeedFrontMs:Bt(e.noiseSpeedFrontMs,0,1e4,1100),noiseFlicker:zt(e.noiseFlicker,0,1,.12),noiseFlickerSpeedMs:Bt(e.noiseFlickerSpeedMs,0,5e3,220),noiseBlurPx:zt(e.noiseBlurPx,0,6,0),noiseContrast:zt(e.noiseContrast,.25,5,1.35),noiseBrightness:zt(e.noiseBrightness,.25,3,1),noiseSaturation:zt(e.noiseSaturation,0,3,1),noiseHue:zt(e.noiseHue,0,360,0),noiseSizeBase:zt(e.noiseSizeBase,20,400,t),noiseSizeTop:zt(e.noiseSizeTop,20,600,a),noiseBackOpacity:zt(e.noiseBackOpacity,0,.3,n),noiseFrontOpacity:zt(e.noiseFrontOpacity,0,.3,o),noiseBackOpacityDark:zt(e.noiseBackOpacityDark,0,.5,i),noiseFrontOpacityDark:zt(e.noiseFrontOpacityDark,0,.5,r),noiseTopOpacity:zt(e.noiseTopOpacity,0,.25,l),detailNoiseOpacity:zt(e.detailNoiseOpacity,0,1,1)};return s.noiseMonochrome&&(s.noiseChroma=Vt(s.noiseChroma,.35)),s}function Zt(e,{force:t=!1}={}){const a=JSON.stringify({seed:e.noiseSeed,size:e.noiseTextureSize,distribution:e.noiseDistribution,monochrome:e.noiseMonochrome,chroma:e.noiseChroma,contrast:(+e.noiseContrast).toFixed(3),brightness:(+e.noiseBrightness).toFixed(3),saturation:(+e.noiseSaturation).toFixed(3),hue:(+e.noiseHue).toFixed(1)});if(e.noiseEnabled)(t||a!==Ni)&&(Ni=a,$i&&window.clearTimeout($i),$i=window.setTimeout(async()=>{$i=null;const t=++Vi,a=await(async({size:e,seed:t,distribution:a,monochrome:n,chroma:o,contrast:i,brightness:r,saturation:l,hue:s})=>{const c=(e=>(Oi||(Oi=document.createElement("canvas"),Wi=Oi.getContext("2d",{willReadFrequently:!0})),Wi?(Oi.width!==e&&(Oi.width=e),Oi.height!==e&&(Oi.height=e),zi!==e&&(zi=e,Ei=null,Ri=null),Wi):null))(e);if(!c)return null;Ei||(Ei=c.createImageData(e,e),Ri=new Uint32Array(Ei.data.buffer));const d=Ri,p=_t(t),u="gaussian"===a,h=Vt(o,0),f=1-h,m=zt(i,.25,5,1),b=zt(r,.25,3,1),g=zt(l,0,3,1),M=zt(s,0,360,0),y=1!==m||1!==b,v=1!==g,w=0!==M,x=.213,S=.715,k=.072;let C=1,P=0,F=0,T=0,D=1,I=0,L=0,A=0,K=1;if(w){const e=M*Math.PI/180,t=Math.cos(e),a=Math.sin(e);C=x+.787*t-a*x,P=S-t*S-a*S,F=k-t*k+.928*a,T=x-t*x+.143*a,D=S+t*(1-S)+.14*a,I=k-t*k-.283*a,L=x-t*x-.787*a,A=S-t*S+a*S,K=k+.928*t+a*k}for(let W=0;d.length>W;W++){const e=u?Gt(p):p();let t=e,a=e,o=e;if(n||(t=e*f+(u?Gt(p):p())*h,a=e*f+(u?Gt(p):p())*h,o=e*f+(u?Gt(p):p())*h),y&&(t=(t-.5)*m+.5,a=(a-.5)*m+.5,o=(o-.5)*m+.5,t*=b,a*=b,o*=b),v){const e=t*x+a*S+o*k;t=e*(1-g)+t*g,a=e*(1-g)+a*g,o=e*(1-g)+o*g}if(w){const e=t*T+a*D+o*I,n=t*L+a*A+o*K;t=t*C+a*P+o*F,a=e,o=n}const i=Math.max(0,Math.min(255,Math.round(255*t))),r=Math.max(0,Math.min(255,Math.round(255*a)));d[W]=255<<24|Math.max(0,Math.min(255,Math.round(255*o)))<<16|r<<8|i}c.putImageData(Ei,0,0);const O=await(async e=>await new Promise(t=>{try{e.toBlob(e=>t(e),"image/png")}catch(a){t(null)}}))(Oi);return O?URL.createObjectURL(O):null})({size:e.noiseTextureSize,seed:e.noiseSeed,distribution:e.noiseDistribution,monochrome:e.noiseMonochrome,chroma:e.noiseChroma,contrast:e.noiseContrast,brightness:e.noiseBrightness,saturation:e.noiseSaturation,hue:e.noiseHue});if(t===Vi){if(a)try{document.documentElement.style.setProperty("--abs-noise-texture",`url("${a}")`),Bi&&URL.revokeObjectURL(Bi),Bi=a}catch(n){URL.revokeObjectURL(a)}}else a&&URL.revokeObjectURL(a)},140));else{$i&&window.clearTimeout($i),$i=null,Vi++,Ni="";try{document.documentElement.style.setProperty("--abs-noise-texture","none")}catch(n){}if(Bi)try{URL.revokeObjectURL(Bi)}catch(n){}Bi=null}}function Yt(e={}){const t=Ki||jt({});return jt({...t,...Rt(e)})}function Xt(e={}){Ki=Yt(e),Ai=!0,Ht(Ki),Zt(Ki,{force:!0})}function qt(e={}){Ai||Xt(e),Ki=Yt(e),Ht(Ki),Zt(Ki)}function Ut(){console.log("⚠️ localStorage is disabled")}function Jt(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(Ut,500)}function Qt(e){return!1!==Gi[e]}function ea(e){return{id:e,label:"Warmup Frames",stateKey:e,type:"range",min:0,max:240,step:1,default:10,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0,hint:"Pre-runs physics before first render to avoid visible settling on mode start."}}function ta(e,t){try{if("function"==typeof e?.format)return e.format(t)}catch(a){}return(t??"")+""}function aa(e){if("divider"===e.type)return`<div class="control-divider"><span class="control-divider-label">${e.label||""}</span></div>`;if(!Qt(e.id))return"";const t=e.id+"Slider",a=e.id+"Val",n=e.id+"Picker";if("colorDistribution"===e.type){const t=(Array.isArray(e.labels)?e.labels:[]).map((e,t)=>{const a=((e||"")+"").trim();return`\n        <div class="color-dist-row" data-color-dist-row="${t}">\n          <div class="color-dist-row-label">${a}</div>\n          <div class="color-dist-row-controls">\n            <span class="color-dist-swatch" id="${"colorDistSwatch"+t}" aria-hidden="true"></span>\n            <select id="${"colorDistColor"+t}" class="control-select color-dist-select" aria-label="${a} color"></select>\n            <input type="range" id="${"colorDistWeight"+t}" min="0" max="100" step="1" value="0" aria-label="${a} weight">\n            <span class="color-dist-weight" id="${"colorDistWeightVal"+t}">0%</span>\n          </div>\n        </div>`}).join("");return`\n      <div class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="colorDistTotalVal">100%</span>\n        </div>\n        <div class="color-dist-grid" id="colorDistGrid">\n          ${t}\n        </div>\n        <div class="color-dist-actions">\n          <button type="button" class="secondary" id="colorDistResetBtn" aria-label="Reset color distribution to defaults">Reset Defaults</button>\n        </div>\n      </div>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`}if("color"===e.type)return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${e.default}</span>\n        </div>\n        <input type="color" id="${n}" value="${e.default}" aria-label="${e.label}" />\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`;if("select"===e.type){const n=(Array.isArray(e.options)?e.options:[]).map(t=>{const a=t.value+"";return`<option value="${a}" ${e.default+""===a?"selected":""}>${(t.label??t.value)+""}</option>`}).join(""),o=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${ta(e,e.default)}</span>\n        </div>\n        <select id="${t}" class="control-select" aria-label="${e.label}">\n          ${n}\n        </select>\n      </label>\n      ${o}`}if("checkbox"===e.type)return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${e.default?"On":"Off"}</span>\n        </div>\n        <input type="checkbox" id="${t}" ${e.default?"checked":""} aria-label="${e.label}">\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`;const o=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${ta(e,e.default)}</span>\n        </div>\n        <input type="range" id="${t}" min="${e.min}" max="${e.max}" step="${e.step}" value="${e.default}">\n      </label>\n      ${o}`}function na(e,t){const a=t.controls.filter(e=>Qt(e.id));if(0===a.length)return"";let n=null,o="";for(const s of a)s.group&&s.group!==n?(null!==n&&(o+="</div>"),o+=`<div class="section-title" style="margin-top: 12px;">${s.group}</div><div class="group ${s.groupLayout||""}">`,n=s.group):s.group||null===n||(o+="</div>",n=null),o+=aa(s);null!==n&&(o+="</div>");const i=t.defaultOpen?"open":"",r=`\n    <summary class="panel-section-header">\n      ${t.icon?`<span class="section-icon">${t.icon}</span>`:""}\n      <span class="section-label">${t.title}</span>\n    </summary>`,l=`<div class="panel-section-content">${o}</div>`;return t.mode?`\n      <div id="${t.mode}Controls" class="mode-controls">\n        <details class="panel-section-accordion" ${i}>\n          ${r}\n          ${l}\n        </details>\n      </div>`:`\n    <details class="panel-section-accordion" ${i}>\n      ${r}\n      ${l}\n    </details>`}function oa({open:e=!0}={}){return`\n    <details class="panel-section-accordion" ${e?"open":""}>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎨</span>\n        <span class="section-label">Theme</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="theme-segment-control" role="group" aria-label="Theme selector">\n          <button id="themeAuto" class="theme-segment-btn" aria-label="Auto theme">Auto</button>\n          <button id="themeLight" class="theme-segment-btn active" aria-label="Light theme">Light</button>\n          <button id="themeDark" class="theme-segment-btn" aria-label="Dark theme">Dark</button>\n        </div>\n        <div id="themeStatus" class="panel-status">☀️ Light Mode</div>\n      </div>\n    </details>`}function ia({open:e=!1}={}){return`\n    <details class="panel-section-accordion" ${e?"open":""}>\n      <summary class="panel-section-header">\n        <span class="section-icon">🌈</span>\n        <span class="section-label">Palette</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Color Template</span>\n            <span class="control-value"></span>\n          </div>\n          <select id="colorSelect"></select>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Rotate on Reload</span>\n            <span class="control-value"></span>\n          </div>\n          <input id="paletteRotateOnReload" type="checkbox" />\n        </label>\n      </div>\n    </details>`}function ra(){let e="",t=null;for(const a of Hi){if(!Zi[a])continue;const n=ji[a]||null;n&&n!==t?(null!==t&&(e+="</div>"),e+=`\n        <div class="panel-category-group">\n          <div class="panel-category-label">${n}</div>`,t=n):n||null===t||(e+="</div>",t=null),e+=na(0,Zi[a])}return null!==t&&(e+="</div>"),e}function la(){let e=`\n    <div role="status" aria-live="polite" aria-atomic="true" class="sr-only" id="announcer"></div>\n    ${(()=>{const e=Object.entries(Zi).filter(([,e])=>e?.mode).map(([e,t])=>na(0,t)).join("");return`\n    <details class="panel-section-accordion" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎛️</span>\n        <span class="section-label">Mode</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="mode-switcher" role="group" aria-label="Simulation mode selector">\n          ${(()=>{const e={pit:"🎯",bubbles:"🫧",critters:"🪲",flies:"🕊️","pit-throws":"🎯",water:"🌊",vortex:"🌀",magnetic:"🧲","ping-pong":"🏓",weightless:"🌌",kaleidoscope:"🪞","kaleidoscope-1":"🪞","kaleidoscope-2":"🪞","kaleidoscope-3":"🪞","orbit-3d":"🌪️","orbit-3d-2":"🌪️",lattice:"💎",neural:"🧠"},t={pit:"Pit",bubbles:"Bubbles",critters:"Critters",flies:"Flies","pit-throws":"Throws",water:"Water",vortex:"Vortex",magnetic:"Magnet","ping-pong":"Pong",weightless:"Zero-G",kaleidoscope:"Kalei","kaleidoscope-1":"Kalei I","kaleidoscope-2":"Kalei II","kaleidoscope-3":"Kalei III","orbit-3d":"Orbit","orbit-3d-2":"Swarm",lattice:"Lattice",neural:"Neural"};let a="";return An.forEach(n=>{const o=t[n]||n;a+=`<button class="mode-button" data-mode="${n}" aria-label="${Kn[n]||o} mode">${e[n]||"⚪"} ${o}</button>`}),a})()}\n        </div>\n        ${e}\n      </div>\n    </details>`})()}\n  `;for(const[t,a]of Object.entries(Zi))a?.mode||Hi.includes(t)||(e+=na(0,a));return e}function sa(e={}){const t=f(),a=!1!==e.runOnChange;for(const n of Object.values(Zi))for(const e of n.controls){if("colorDistribution"===e.type)continue;const n=e.id+"Val",o=document.getElementById("color"===e.type?e.id+"Picker":e.id+"Slider"),i=document.getElementById(n);if(!o||!e.stateKey)continue;const r=t[e.stateKey];void 0!==r&&("checkbox"===e.type?(o.checked=!!r,i&&(i.textContent=r?"On":"Off")):"color"===e.type?(o.value=r,i&&(i.textContent=r)):(o.value=r,i&&(i.textContent=e.format?e.format(r):r+"")),a&&e.onChange&&"wallPreset"!==e.id&&e.onChange(t,r))}}function ca(){(()=>{const e=f();for(const[a,n]of Object.entries(Zi))for(const o of n.controls){const i=document.getElementById(o.id+"Val");if("colorDistribution"===o.type){const l=Array.isArray(o.labels)?o.labels:[],s=document.getElementById("colorDistResetBtn");function c(e){return((e||"")+"").trim().toLowerCase()}function d(e,t,a,n=t){const o=+e;if(!Number.isFinite(o))return n;const i=Math.floor(o);return t>i?t:i>a?a:i}function p(e){const t=[];for(let a=0;8>a;a++)t.push({value:a+"",label:`Ball ${a+1}${e[a]?" — "+e[a]:""}`});return t}function u(t){const a=Array.isArray(e.colorDistribution)?e.colorDistribution:[],n=new Map;for(const e of a)n.set(c(e?.label),e);const o=Array.isArray(t)?t:a,i=[],r=new Set;for(let e=0;l.length>e;e++){const t=((l[e]||"")+"").trim(),a=c(t),s=o.find(e=>c(e?.label)===a)||n.get(a)||{};let p=d(s?.colorIndex,0,7,d(n.get(a)?.colorIndex,0,7,0));if(r.has(p))for(let e=0;8>e;e++)if(!r.has(e)){p=e;break}r.add(p);const u=d(s?.weight,0,100,d(n.get(a)?.weight,0,100,0));i.push({label:t,colorIndex:p,weight:u})}return i}function h(e,t=0){const a=e.map(e=>d(e,0,100,0));let n=0;for(let l=0;a.length>l;l++)n+=a[l];if(100===n)return a;if(0===n)return a[t]=100,a;const o=Array(a.length).fill(0);let i=0;for(let l=0;a.length>l;l++){const e=Math.round(a[l]/n*100);o[l]=e,i+=e}let r=100-i;for(;0!==r;)if(r>0){let e=0;for(let t=1;o.length>t;t++)o[t]>o[e]&&(e=t);o[e]+=1,r-=1}else{let e=-1;for(let t=0;o.length>t;t++)o[t]>0&&(-1===e||o[t]>o[e])&&(e=t);if(-1===e)break;o[e]-=1,r+=1}return o.map(e=>d(e,0,100,0))}function m(e,t,a){const n=e.map(e=>d(e?.weight,0,100,0));return n[t]=d(a,0,100,n[t]),100===n.reduce((e,t)=>e+t,0)?n:h(n,t)}function b(){const t={pit:null,"pit-throws":null,flies:e.fliesBallCount,weightless:e.weightlessCount,water:e.waterBallCount,vortex:e.vortexBallCount,"ping-pong":e.pingPongBallCount,magnetic:e.magneticBallCount,bubbles:e.bubblesMaxCount,kaleidoscope:e.kaleidoscopeBallCount,"kaleidoscope-1":e.kaleidoscope1BallCount,"kaleidoscope-2":e.kaleidoscope2BallCount,"kaleidoscope-3":e.kaleidoscope3BallCount,critters:e.critterCount,neural:e.neuralBallCount,lattice:e.latticeBallCount,orbit3d:e.orbit3dMoonCount,orbit3d2:e.orbit3d2MoonCount}[e.currentMode];return Number.isFinite(+t)?+t:null}function g(){Promise.resolve().then(()=>al).then(({applyExpertiseLegendColors:e})=>e?.()).catch(()=>{}),Promise.resolve().then(()=>Un).then(({pickRandomColor:t})=>{if("function"!=typeof t)return;const a=e.balls||[];for(let e=0;a.length>e;e++)a[e].color=t()}).catch(()=>{})}function M(){const t=u(e.colorDistribution),a=h(t.map(e=>e.weight),0);for(let e=0;t.length>e;e++)t[e].weight=a[e];e.colorDistribution=t;const n={};for(let e=0;t.length>e;e++)n[t[e].colorIndex]=t[e].label;const o=p(n),i=b();for(let e=0;l.length>e;e++){const a=t[e]||{colorIndex:0,weight:0},r=document.getElementById("colorDistSwatch"+e),l=document.getElementById("colorDistColor"+e),s=document.getElementById("colorDistWeight"+e),c=document.getElementById("colorDistWeightVal"+e);if(l){l.innerHTML="";for(const e of o){const t=document.createElement("option");t.value=e.value,t.textContent=e.label;const o=d(e.value,0,7,0);n[o]&&!(o===a.colorIndex)&&(t.disabled=!0),l.appendChild(t)}l.value=a.colorIndex+""}if(s&&(s.value=d(a.weight,0,100,0)+""),c){const e=d(a.weight,0,100,0),t=null!=i?Math.round(e/100*i):null;c.textContent=null!=t?`${e}% (≈${t})`:e+"%"}if(r){const e=d(a.colorIndex,0,7,0);r.style.backgroundColor=`var(--ball-${e+1})`}}const r=document.getElementById("colorDistTotalVal");if(r){let e=0;for(let a=0;t.length>a;a++)e+=t[a].weight;r.textContent=e+"%"}}try{M()}catch(t){}s&&s.addEventListener("click",()=>{const t=e?.config?.colorDistribution;e.colorDistribution=u(t);const a=h(e.colorDistribution.map(e=>e.weight),0);for(let n=0;e.colorDistribution.length>n;n++)e.colorDistribution[n].weight=a[n];M(),g(),Jt()});for(let y=0;l.length>y;y++){const v=document.getElementById("colorDistColor"+y),w=document.getElementById("colorDistWeight"+y);v&&v.addEventListener("change",()=>{const t=d(v.value,0,7,0),a=u(e.colorDistribution);a[y].colorIndex=t,e.colorDistribution=a,M(),g(),Jt()}),w&&w.addEventListener("input",()=>{const t=d(w.value,0,100,0),a=u(e.colorDistribution),n=m(a,y,t);for(let e=0;a.length>e;e++)a[e].weight=n[e];e.colorDistribution=a,M(),g(),Jt()})}continue}if("color"===o.type){const x=document.getElementById(o.id+"Picker");if(!x)continue;x.addEventListener("input",()=>{const t=x.value;o.stateKey&&(e[o.stateKey]=t),o.onChange&&o.onChange(e,t),i&&(i.textContent=t),Jt()});continue}if("select"===o.type){const S=document.getElementById(o.id+"Slider");if(!S)continue;S.addEventListener("change",()=>{const t=o.parse?o.parse(S.value):S.value;if(o.stateKey&&(e[o.stateKey]=t),o.onChange&&o.onChange(e,t),i){const a=o.stateKey?e[o.stateKey]:t;i.textContent=o.format?o.format(a):a+""}Jt()});continue}if("checkbox"===o.type){const k=document.getElementById(o.id+"Slider");if(!k)continue;k.addEventListener("change",()=>{const t=!!k.checked;o.stateKey&&(e[o.stateKey]=t),o.onChange&&o.onChange(e,t),i&&(i.textContent=t?"On":"Off"),o.reinitMode&&e.currentMode===n.mode&&Promise.resolve().then(()=>qo).then(({resetCurrentMode:e})=>e?.()).catch(()=>{}),Jt()});continue}const r=document.getElementById(o.id+"Slider");r&&r.addEventListener("input",()=>{const t=o.parse(r.value);o.stateKey&&(e[o.stateKey]=t),o.onChange&&o.onChange(e,t),i&&(i.textContent=o.format(o.stateKey?e[o.stateKey]:t)),o.reinitMode&&e.currentMode===n.mode&&Promise.resolve().then(()=>qo).then(({resetCurrentMode:e})=>e?.()).catch(()=>{}),Jt()})}})(),H();const e=document.getElementById("colorSelect");e&&e.addEventListener("change",()=>{G(e.value),Jt()});const t=document.getElementById("themeAuto"),a=document.getElementById("themeLight"),n=document.getElementById("themeDark");[t,a,n].forEach(e=>{e&&e.addEventListener("click",()=>{[t,a,n].forEach(e=>e?.classList.remove("active")),e.classList.add("active")})})}function da(){ca(),document.querySelectorAll(".mode-button").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const a=e.getAttribute("data-mode");console.log("Mode button clicked:",a),Promise.resolve().then(()=>qo).then(({setMode:e})=>{e(a),pa(a)}).catch(()=>{})})})}function pa(e){document.querySelectorAll(".mode-button").forEach(t=>{const a=t.getAttribute("data-mode")===e;t.classList.toggle("active",a)}),document.querySelectorAll(".mode-controls").forEach(e=>e.classList.remove("active"));const t=document.getElementById(e+"Controls");t&&t.classList.add("active");const a=document.getElementById("announcer");a&&(a.textContent=`Switched to ${{critters:"Critters",pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero-G",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope","kaleidoscope-1":"Kaleidoscope I","kaleidoscope-2":"Kaleidoscope II","kaleidoscope-3":"Kaleidoscope III","orbit-3d":"Orbit 3D","orbit-3d-2":"Orbit 3D (Tight Swarm)",lattice:"Crystal Lattice",neural:"Neural Network"}[e]||e} mode`);try{const t=document.getElementById("edge-chapter-text");t&&(t.textContent=Kn?.[e]||"—")}catch(n){}}function ua(e,t){const a=t();for(const n of Object.values(qi))for(const t of n.controls){const n=e.querySelector("#sound_"+t.id),o=e.querySelector(`#sound_${t.id}_val`);if(!n||void 0===a[t.id])continue;const i=t.fromConfig(a[t.id]);n.value=i,o&&(o.textContent=t.format(i))}}function ha(e){try{localStorage.setItem(er,e+"")}catch(t){}}function fa(e){if(e.target.closest("button")||e.target.closest("input")||e.target.closest("select"))return;if(!Ui)return;const t=e.touches?e.touches[0].clientX:e.clientX,a=e.touches?e.touches[0].clientY:e.clientY,n=Ui.getBoundingClientRect();or=t,ir=a,rr=n.left,lr=n.top,nr=!1}function ma(e){if(0===or&&0===ir)return;if(!Ui)return;const t=(e.touches?e.touches[0].clientX:e.clientX)-or,a=(e.touches?e.touches[0].clientY:e.clientY)-ir;if(nr||5>=Math.abs(t)&&5>=Math.abs(a)||(nr=!0,Ui.classList.add("dragging"),Ui.style.position="fixed",Ui.style.top=lr+"px",Ui.style.left=rr+"px",Ui.style.right="auto"),nr){let n=rr+t,o=lr+a;const i=Ui.getBoundingClientRect();n=Math.max(0,Math.min(window.innerWidth-i.width,n)),o=Math.max(0,Math.min(window.innerHeight-i.height,o)),Ui.style.left=n+"px",Ui.style.top=o+"px",e.preventDefault()}}function ba(){nr&&(nr=!1,Ui&&Ui.classList.remove("dragging"),ga()),or=0,ir=0,setTimeout(()=>{},10)}function ga(){try{if(!Ui)return;localStorage.setItem(Qi,JSON.stringify({left:Ui.style.left,top:Ui.style.top,custom:!0}))}catch(e){}}function Ma(){if(!Ui)try{((e={})=>{if(!document.querySelector('link[href*="panel.css"]')){const e=document.createElement("link");e.rel="stylesheet",e.href="css/panel.css",document.head.appendChild(e)}const t=e.page||"home",a=e.pageLabel||("portfolio"===t?"Portfolio":"Home"),n=e.pageHTML||Xi,o=!!e.includePageSaveButton,i=e.pageSaveButtonId||"savePortfolioConfigBtn",r=e.footerHint||("portfolio"===t?"<kbd>/</kbd> panel":"<kbd>R</kbd> reset · <kbd>/</kbd> panel · <kbd>9</kbd> kalei · Critters + Throws have no key (yet)"),l=e.panelTitle||"Settings",c=e.modeLabel||(Ct()?"DEV MODE":"BUILD MODE"),d=!!e.bindShortcut,h="function"==typeof e.setupPageControls?e.setupPageControls:null;try{const e=document.getElementById("controlPanel");e&&e.remove();const t=document.getElementById("soundPanel");t&&t.remove()}catch(b){}Ui=document.createElement("div"),Ui.className="panel-dock",Ui.id="panelDock";let m=(({defaultHidden:e=!0}={})=>{try{const t=localStorage.getItem(er);return null===t?!!e:"true"===t}catch(b){return!!e}})({defaultHidden:"portfolio"===t||!Ct()});try{m=!0}catch(b){}Ui.classList.toggle("hidden",!!m),ha(!!m),Ji=(({page:e,panelTitle:t,modeLabel:a,pageLabel:n,pageHTML:o,includePageSaveButton:i,pageSaveButtonId:r,footerHint:l,setupPageControls:c}={})=>{const d=document.createElement("div");d.id="masterPanel",d.className=(()=>{try{const e=localStorage.getItem(tr);return null===e||"true"===e}catch(b){return!0}})()?"panel collapsed":"panel",d.setAttribute("role","region"),d.setAttribute("aria-label","Settings");const h=document.createElement("div");h.className="panel-header",h.innerHTML=`\n    <div class="mac-titlebar">\n      <div class="mac-traffic" aria-hidden="true">\n        <span class="mac-dot mac-dot--red"></span>\n        <span class="mac-dot mac-dot--yellow"></span>\n        <span class="mac-dot mac-dot--green"></span>\n      </div>\n      <div class="panel-title mac-title">${t}</div>\n      <div class="mac-right">\n        <span class="panel-mode-pill" role="status" aria-label="Runtime mode">${a}</span>\n        <button class="collapse-btn mac-collapse" aria-label="Collapse panel" title="Collapse">▾</button>\n      </div>\n    </div>\n  `;const m=document.createElement("div");m.className="panel-content",m.innerHTML=(({pageLabel:e="Home",pageHTML:t=Xi,includePageSaveButton:a=!1,pageSaveButtonId:n="savePortfolioConfigBtn",footerHint:o="<kbd>R</kbd> reset · <kbd>/</kbd> panel · <kbd>9</kbd> kalei · Critters + Throws have no key (yet)"}={})=>{const i=f(),r=+(i.contentPaddingVw||0),l=s(),c=i.layoutViewportWidthPx>0?Math.round(i.layoutViewportWidthPx)+"px":`Auto (${Math.round(l)}px)`,d=Math.max(0,Math.round(i.contentPadding??0)),p=Math.max(0,Math.round(i.wallInset??3)),u=Math.max(0,Math.round(i.layoutMinContentPaddingPx??0)),h=+(i.contentPaddingHorizontalRatio||1),m=`\n    <details class="panel-section-accordion" id="layoutSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">📐</span>\n        <span class="section-label">Layout</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Content Padding</span>\n            <span class="control-value" id="contentPadValue">${r.toFixed(2)}vw · ${d}px (min ${u}px)</span>\n          </div>\n          <input type="range" id="contentPadding" min="0" max="12" step="0.05" value="${r||0}" />\n          <div class="control-hint">Layout-only spacing between wall and content</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Horizontal Ratio</span>\n            <span class="control-value" id="contentPadHorizRatioValue">${h.toFixed(2)}× → ${Math.round(d*h)}px</span>\n          </div>\n          <input type="range" id="contentPadHorizRatio" min="0.5" max="2.5" step="0.05" value="${h}" />\n          <div class="control-hint">Horizontal padding = base × ratio</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Min Content Padding</span>\n            <span class="control-value" id="minContentPadValue">${u}px</span>\n          </div>\n          <input type="range" id="layoutMinContentPaddingPx" min="0" max="64" step="1" value="${u}" />\n          <div class="control-hint">Clamp target on smallest viewports (px).</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Viewport Width</span>\n            <span class="control-value" id="viewportWidthValue">${c}</span>\n          </div>\n          <input type="range" id="layoutViewportWidth" min="0" max="2400" step="10" value="${Math.round(i.layoutViewportWidthPx||0)}" />\n          <div class="control-hint">0 = Auto (uses current window width)</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Wall Inset</span>\n            <span class="control-value" id="wallInsetValue">${p}px</span>\n          </div>\n          <input type="range" id="layoutWallInset" min="0" max="20" value="${p}" />\n        </label>\n      </div>\n    </details>\n  `,b=`\n    <details class="panel-section-accordion" id="soundSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">🔊</span>\n        <span class="section-label">Sound</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="sound-enable-row">\n          <button id="soundEnableBtn" class="sound-enable-btn" aria-label="Enable sound" title="Enable sound">🔇</button>\n        </div>\n        <div id="soundControlsWrapper" class="sound-controls" style="display: none;">\n          <div class="sound-perf" aria-label="Sound performance controls">\n            <button type="button" id="soundTapBtn" class="sound-perf__btn" aria-label="Play test hit">▶︎</button>\n            <button type="button" id="soundResetBtn" class="sound-perf__btn" aria-label="Reset to preset">↺</button>\n            <button type="button" id="soundShuffleBtn" class="sound-perf__btn" aria-label="Shuffle (subtle) sound">🎲</button>\n            <span class="sound-perf__hint">wheel adjusts · shift/alt = fine</span>\n          </div>\n          <label class="control-row">\n            <span class="control-label">Preset</span>\n            <select id="soundPresetSelect" class="control-select"></select>\n          </label>\n          <p id="presetDescription" class="control-hint"></p>\n          ${(()=>{let e="";for(const[t,a]of Object.entries(qi)){e+='<div class="sound-dock__section">',e+=`<div class="sound-dock__section-title">${a.title}</div>`,e+='<div class="sound-dock__group">';for(const t of a.controls)e+=`\n        <label class="sound-dock__row">\n          <span class="sound-dock__label">${t.label}</span>\n          <input type="range" \n            id="sound_${t.id}" \n            class="sound-dock__slider" \n            min="${t.min}" \n            max="${t.max}" \n            step="${t.step}">\n          <span class="sound-dock__val" id="sound_${t.id}_val">${t.format(t.fromConfig(0))}</span>\n        </label>`;e+="</div></div>"}return e})()}\n        </div>\n      </div>\n    </details>\n  `,g=`\n    <details class="panel-section-accordion" id="pageSection" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">⚙️</span>\n        <span class="section-label">${e}</span>\n      </summary>\n      <div class="panel-section-content">\n        ${t}\n      </div>\n    </details>\n  `,M=`\n    <div class="panel-section panel-section--action">\n      <button id="saveRuntimeConfigBtn" class="primary">💾 Save Config</button>\n      ${a?`<button id="${n}" class="primary">💾 Save ${e} Config</button>`:""}\n    </div>\n    <div class="panel-footer">${o}</div>\n  `;return`\n    ${oa({open:!0})}\n    ${ra()}\n    ${m}\n    ${b}\n    ${ia({open:!1})}\n    ${g}\n    ${M}\n  `})({pageLabel:n,pageHTML:o,includePageSaveButton:i,pageSaveButtonId:r,footerHint:l}),d.appendChild(h),d.appendChild(m);const g=(()=>{try{const e=localStorage.getItem(ar);if(!e)return null;const t=JSON.parse(e);if(!t||"object"!=typeof t)return null;const a=+t.width,n=+t.height;return Number.isFinite(a)&&Number.isFinite(n)?{width:Math.round(a),height:Math.round(n)}:null}catch(b){return null}})();if(g){const e=.8*window.innerHeight;(Math.abs(g.width-368)>5||Math.abs(g.height-e)>5)&&(d.style.width=g.width+"px",d.style.height=g.height+"px",d.style.maxHeight="none")}const M=h.querySelector(".collapse-btn");return M&&M.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),(t=>{t.classList.toggle("collapsed"),(t=>{try{localStorage.setItem(tr,t+"")}catch(e){}})(t.classList.contains("collapsed"))})(d)}),setTimeout(()=>{"home"===e?da():ca(),(()=>{const e=document.getElementById("saveRuntimeConfigBtn");e&&e.addEventListener("click",()=>{const e=f(),t={};try{const a=(()=>{const e=[];for(const t of Object.values(Zi))for(const a of t.controls)e.push({...a,section:t.title});return e})();for(const n of a){if(!n||!n.stateKey)continue;const a=e[n.stateKey];void 0!==a&&(t[n.stateKey]=a)}}catch(b){}t.gravityMultiplier=e.gravityMultiplierPit,t.restitution=e.REST,t.friction=e.FRICTION,t.ballMass=e.ballMassKg,t.ballScale=e.sizeScale,t.sizeScale=e.sizeScale,t.sizeVariation=e.sizeVariation,t.repelSoft=e.repelSoft,t.repelSoftness=e.repelSoft,t.layoutViewportWidthPx=e.layoutViewportWidthPx||0,t.containerBorderVw=e.containerBorderVw,t.simulationPaddingVw=e.simulationPaddingVw,t.contentPaddingVw=e.contentPaddingVw,t.contentPaddingHorizontalRatio=e.contentPaddingHorizontalRatio,t.wallRadiusVw=e.wallRadiusVw,t.wallThicknessVw=e.wallThicknessVw,t.layoutMinContentPaddingPx=Math.max(0,Math.round(e.layoutMinContentPaddingPx??0)),t.layoutMinWallRadiusPx=Math.max(0,Math.round(e.layoutMinWallRadiusPx??0)),t.wallInset=e.wallInset;try{t.soundPreset=re(),t.soundConfig=ne()}catch(b){}t.chromeHarmonyMode=e.chromeHarmonyMode,t.autoDarkModeEnabled=e.autoDarkModeEnabled,t.autoDarkNightStartHour=e.autoDarkNightStartHour,t.autoDarkNightEndHour=e.autoDarkNightEndHour,t.enableLOD=!1;const a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(a),n.download="default-config.json",document.body.appendChild(n),n.click(),document.body.removeChild(n)})})(),(e=>{const t=e.querySelector("#soundEnableBtn"),a=e.querySelector("#soundControlsWrapper"),n=e.querySelector("#soundPresetSelect"),o=e.querySelector("#presetDescription"),i=e.querySelector("#soundSection"),r=e.querySelector("#soundTapBtn"),l=e.querySelector("#soundResetBtn"),s=e.querySelector("#soundShuffleBtn"),c=(e,t,a)=>t>e?t:e>a?a:e,d=(e,t)=>e+2*(Math.random()-.5)*t,p=(e,{openIfEnabled:n=!1}={})=>{if(!t)return;const o=e||ae(),r=!(!o.isUnlocked||!o.isEnabled),l=!!o.isUnlocked;t.innerHTML=l&&r?'<i class="ti ti-volume-2" aria-hidden="true"></i>':'<i class="ti ti-volume-off" aria-hidden="true"></i>',t.setAttribute("aria-label",l?r?"Sound on":"Sound off":"Enable sound"),t.title=l?r?"Sound on":"Sound off":"Enable sound",t.classList.toggle("enabled",r),a&&(a.style.display=r?"":"none"),n&&r&&i&&!i.open&&(i.open=!0)};if(r&&r.addEventListener("click",()=>{J({intensity:.86,radius:18,xPosition:.72})}),l&&l.addEventListener("click",()=>{const t=re();ie(t),o&&eo[t]&&(o.textContent=eo[t].description),ua(e,ne)}),s&&s.addEventListener("click",()=>{const t=ne();oe({filterBaseFreq:c(d(t.filterBaseFreq,120),300,8e3),filterQ:c(d(t.filterQ,.04),.05,.9),pitchCurve:c(d(t.pitchCurve,.06),.6,1.8),sparkleGain:c(d(t.sparkleGain,.03),0,.35),sparkleDecayMul:c(d(t.sparkleDecayMul,.05),.25,.95),noiseTransientQ:c(d(t.noiseTransientQ,.25),.6,6),reverbWetMix:c(d(t.reverbWetMix,.02),0,.35),reverbDecay:c(d(t.reverbDecay,.03),.05,.4),collisionMinImpact:c(d(t.collisionMinImpact,.03),.45,.9),variancePitch:c(d(t.variancePitch,.01),0,.2),varianceGain:c(d(t.varianceGain,.02),0,.35)}),ua(e,ne),J({intensity:.86,radius:18,xPosition:.72})}),t&&t.addEventListener("click",async()=>{const e=ae();if(e.isUnlocked){const t=te();p({...e,isEnabled:t})}else await q()&&p(null,{openIfEnabled:!0})}),n){for(const[e,t]of Object.entries(eo)){const a=document.createElement("option");a.value=e,a.textContent=t.label,n.appendChild(a)}n.value=re(),o&&eo[re()]&&(o.textContent=eo[re()].description),n.addEventListener("change",()=>{ie(n.value),o&&eo[n.value]&&(o.textContent=eo[n.value].description),ua(e,ne)})}((e,t,a)=>{for(const n of Object.values(qi))for(const t of n.controls){const n=e.querySelector("#sound_"+t.id),o=e.querySelector(`#sound_${t.id}_val`);if(!n)continue;const i=e=>{const i=(r=e,l=parseFloat(n.min),s=parseFloat(n.max),l>r?l:r>s?s:r);var r,l,s;n.value=i+"";const c=t.toConfig(i);o&&(o.textContent=t.format(i)),a({[t.id]:c})};n.addEventListener("input",()=>{i(parseFloat(n.value))}),n.addEventListener("wheel",e=>{if(e.ctrlKey)return;const t=(parseFloat(n.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),a=0>e.deltaY?1:-1,o=parseFloat(n.value);e.preventDefault(),i(o+a*t)},{passive:!1}),o&&o.addEventListener("wheel",e=>{if(e.ctrlKey)return;const t=(parseFloat(n.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),a=0>e.deltaY?1:-1,o=parseFloat(n.value);e.preventDefault(),i(o+a*t)},{passive:!1})}})(e,0,oe),ua(e,ne),p(),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(fo,e=>{p(e&&e.detail?e.detail:null)})})(d),(e=>{const t=e.querySelector("#contentPadding"),a=e.querySelector("#contentPadValue"),n=e.querySelector("#contentPadHorizRatio"),o=e.querySelector("#contentPadHorizRatioValue"),i=e.querySelector("#layoutMinContentPaddingPx"),r=e.querySelector("#minContentPadValue"),l=e.querySelector("#layoutViewportWidth"),c=e.querySelector("#viewportWidthValue"),d=e.querySelector("#layoutWallInset"),h=e.querySelector("#wallInsetValue"),m=f(),g=({triggerResize:e=!1}={})=>{if(p(),u(),a){const e=Math.max(0,Math.round(m.layoutMinContentPaddingPx??0));a.textContent=`${(m.contentPaddingVw||0).toFixed(2)}vw · ${Math.round(m.contentPadding||0)}px (min ${e}px)`}if(o&&(o.textContent=`${(m.contentPaddingHorizontalRatio||1).toFixed(2)}× → ${Math.round(m.contentPaddingX||m.contentPadding)}px`),r&&(r.textContent=Math.max(0,Math.round(m.layoutMinContentPaddingPx??0))+"px"),c){const e=s();c.textContent=m.layoutViewportWidthPx>0?Math.round(m.layoutViewportWidthPx)+"px":`Auto (${Math.round(e)}px)`}if(e)try{De()}catch(b){}document.dispatchEvent(new CustomEvent("layout-updated"))};t&&a&&t.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(m.contentPaddingVw=t,g({triggerResize:!0}))}),n&&o&&n.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(m.contentPaddingHorizontalRatio=Math.max(.1,t),g())}),i&&r&&i.addEventListener("input",e=>{const t=parseInt(e.target.value,10);Number.isFinite(t)&&(m.layoutMinContentPaddingPx=Math.max(0,t),g({triggerResize:!0}))}),l&&c&&l.addEventListener("input",e=>{const t=parseInt(e.target.value,10);m.layoutViewportWidthPx=Number.isFinite(t)?Math.max(0,t):0,g({triggerResize:!0})}),d&&h&&d.addEventListener("input",e=>{const t=parseInt(e.target.value,10);h.textContent=t+"px",m.wallInset=t})})(d);try{c?.(d)}catch(b){}},0),d})({page:t,panelTitle:l,modeLabel:c,pageLabel:a,pageHTML:n,includePageSaveButton:o,pageSaveButtonId:i,footerHint:r,setupPageControls:h}),Ui.appendChild(Ji),document.body.insertBefore(Ui,document.body.firstChild),Ji&&(Ji.addEventListener("mousedown",e=>{const t=Ji.getBoundingClientRect();e.clientY-t.top>12||e.target.closest("button")||e.target.closest("input")||e.target.closest("select")||fa(e)}),Ji.addEventListener("touchstart",e=>{const t=Ji.getBoundingClientRect();e.touches[0].clientY-t.top>12||e.target.closest("button")||e.target.closest("input")||e.target.closest("select")||fa(e)},{passive:!1}),document.addEventListener("mousemove",ma),document.addEventListener("mouseup",ba),document.addEventListener("touchmove",ma,{passive:!1}),document.addEventListener("touchend",ba),(()=>{try{if(!Ui)return;const e=JSON.parse(localStorage.getItem(Qi)||"{}");e.custom&&(Ui.style.position="fixed",Ui.style.left=e.left,Ui.style.top=e.top,Ui.style.right="auto")}catch(b){}})()),(()=>{if(!Ji)return;if("undefined"==typeof ResizeObserver)return;let e=0;const t=new ResizeObserver(()=>{Ji&&(Ji.classList.contains("collapsed")||(window.clearTimeout(e),e=window.setTimeout(()=>{(e=>{try{if(!e)return;if(e.classList.contains("collapsed"))return;const t=e.getBoundingClientRect();localStorage.setItem(ar,JSON.stringify({width:Math.round(t.width),height:Math.round(t.height)}))}catch(b){}})(Ji)},150)))});try{t.observe(Ji)}catch(b){}})(),d&&(sr||(sr=!0,window.addEventListener("keydown",e=>{try{const t=e.target?.tagName,a=["INPUT","TEXTAREA","SELECT"].includes(t),n=!!e.target?.closest?.(".panel-dock");if(a&&!n)return}catch(b){}"/"!==(e.key?.toLowerCase?.()||"")&&"Slash"!==e.code||(e.preventDefault(),Ma())})))})()}catch(t){return}const e=Ui.classList.toggle("hidden");if(ha(e),!e)try{(()=>{if(!Ui)return;if(!Ui.style.left&&!Ui.style.top)return;const e=Ui.getBoundingClientRect(),a=window.innerWidth||0,n=window.innerHeight||0;if(!a||!n)return;const o=10;if(o>e.right||e.left>a-o||o>e.bottom||e.top>n-o)return void(()=>{if(Ui){Ui.style.position="",Ui.style.left="",Ui.style.top="",Ui.style.right="";try{localStorage.removeItem(Qi)}catch(t){}}})();const i=(e,t,a)=>t>e?t:e>a?a:e,r=i(e.left,o,Math.max(o,a-e.width-o)),l=i(e.top,o,Math.max(o,n-e.height-o));Ui.style.position="fixed",Ui.style.left=Math.round(r)+"px",Ui.style.top=Math.round(l)+"px",Ui.style.right="auto",ga()})()}catch(t){}}function ya(e){const t=f(),a=An;if(!a||!a.length)return;const n=a.indexOf(t?.currentMode||Ln.PIT_THROWS),o=a[((0>n?0:n)+e+a.length)%a.length];rt(o),pa(o)}function va(){if(!dr)return null;if(ur&&ur.isConnected)return ur;let e=document.getElementById("gate-modal-host");return e||(e=document.createElement("div"),e.id="gate-modal-host",e.className="gate-modal-host",dr.appendChild(e)),ur=e,ur}function wa(e){if(!dr||!e)return;const t=va();t&&(hr.has(e)||hr.set(e,{parent:e.parentNode,nextSibling:e.nextSibling}),t.appendChild(e))}function xa(e){if(!e)return;const t=hr.get(e);if(t&&t.parent)try{t.nextSibling&&t.nextSibling.parentNode===t.parent?t.parent.insertBefore(e,t.nextSibling):t.parent.appendChild(e)}catch(a){}}function Sa(){const e=t("--wall-thickness","");if(e&&!/calc\(|vw|vh|vmin|vmax|%/i.test(e)){const t=parseFloat(e);if(Number.isFinite(t)&&t>0)return t}const a=f();return a?.wallThickness||12}function ka(){if(!dr)return;const e=Sa();dr.style.setProperty("--gate-overlay-blur",e/2+"px")}function Ca(e){if(dr=document.getElementById("gate-overlay"),!dr)return void console.warn("Gate Overlay: #gate-overlay element not found");if(pr=!1!==e.gateOverlayEnabled,!pr)return console.log("Gate Overlay: Disabled by config"),void(dr.style.display="none");dr.style.display="",va();const t=e.gateOverlayOpacity??a("--gate-overlay-opacity",.01),i=e.gateOverlayTransitionMs??o("--gate-overlay-transition-duration",800),r=e.gateOverlayTransitionOutMs??o("--gate-overlay-transition-out-duration",600),l=e.gateOverlayContentDelayMs??o("--gate-content-delay",200),s=e.gateDepthScale??a("--gate-depth-scale",.96),c=e.gateDepthTranslateY??n("--gate-depth-translate-y",8),d=e.logoOpacityInactive??a("--logo-opacity-inactive",1),p=e.logoOpacityActive??a("--logo-opacity-active-target",.2),u=e.logoBlurInactive??n("--logo-blur-inactive",0),h=e.logoBlurActive??n("--logo-blur-active-target",12),f=document.documentElement;f.style.setProperty("--gate-depth-scale",s),f.style.setProperty("--gate-depth-translate-y",c+"px"),f.style.setProperty("--gate-depth-duration",i+"ms"),f.style.setProperty("--gate-depth-out-duration",r+"ms"),f.style.setProperty("--gate-content-delay",l+"ms"),f.style.setProperty("--logo-opacity-inactive",d),f.style.setProperty("--logo-opacity-active-target",p),f.style.setProperty("--logo-opacity-active",d),f.style.setProperty("--logo-blur-inactive",u+"px"),f.style.setProperty("--logo-blur-active-target",h+"px"),f.style.setProperty("--logo-blur-active",u+"px"),ka(),dr.style.setProperty("--gate-overlay-opacity",t),dr.style.setProperty("--gate-overlay-transition-duration",i+"ms"),dr.style.setProperty("--gate-overlay-transition-out-duration",r+"ms"),dr.classList.remove("active"),dr.setAttribute("aria-hidden","true"),dr.addEventListener("click",Pa),window.addEventListener("resize",ka),document.addEventListener("layout-updated",ka);const m=Sa()/2;console.log(`Gate Overlay: Initialized (opacity: ${t}, blur: ${m}px [auto from wall thickness], transition: ${i}ms, logo: opacity ${d}→${p}, blur ${u}px→${h}px)`)}function Pa(e){if(e.target.closest("button"))return;if(e.target.closest("input"))return;if(e.target.closest("a"))return;if(e.target.closest("select"))return;if(e.target.closest("textarea"))return;const t="cv-gate"===e.target.id||"portfolio-gate"===e.target.id||"contact-gate"===e.target.id||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description");(e.target===dr||"gate-modal-host"===e.target?.id||t)&&document.dispatchEvent(new CustomEvent("gate-overlay-dismiss",{detail:{instant:!0}}))}function Fa(e){const t=document.documentElement,a=document.getElementById("abs-scene");if(e){const e=getComputedStyle(t).getPropertyValue("--gate-depth-scale").trim()||"0.96",n=getComputedStyle(t).getPropertyValue("--gate-depth-translate-y").trim()||"8px",o=getComputedStyle(t).getPropertyValue("--logo-opacity-active-target").trim()||t.style.getPropertyValue("--logo-opacity-active-target")||"0.2",i=getComputedStyle(t).getPropertyValue("--logo-blur-active-target").trim()||t.style.getPropertyValue("--logo-blur-active-target")||"12px";t.style.setProperty("--gate-depth-scale-active",e),t.style.setProperty("--gate-depth-ty-active",n),t.style.setProperty("--logo-opacity-active",o),t.style.setProperty("--logo-blur-active",i),a&&a.classList.add("gate-depth-active")}else{const e=getComputedStyle(t).getPropertyValue("--logo-opacity-inactive").trim()||"1",n=getComputedStyle(t).getPropertyValue("--logo-blur-inactive").trim()||"0px";t.style.setProperty("--gate-depth-scale-active","1"),t.style.setProperty("--gate-depth-ty-active","0px"),t.style.setProperty("--logo-opacity-active",e),t.style.setProperty("--logo-blur-active",n),a&&a.classList.remove("gate-depth-active")}}function Ta(){if(!dr||!pr)return;ka(),dr.setAttribute("aria-hidden","false"),dr.classList.add("active");const e=document.getElementById("custom-cursor");if(e){let a=!1;try{a=!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(t){}a?(e.classList.remove("gate-active"),e.style.display="none"):(e.classList.add("gate-active"),e.style.display="block")}Fa(!0)}function Da(){if(!dr||!pr)return;dr.classList.remove("active"),dr.setAttribute("aria-hidden","true");const e=document.getElementById("custom-cursor");e&&e.classList.remove("gate-active"),Fa(!1)}function Ia(){return!!dr&&dr.classList.contains("active")}function La(e){const t=+e?.sceneImpactMul,a=Number.isFinite(t)?t:0,n=+e?.sceneImpactMobileMulFactor,o=Number.isFinite(n)&&n>0?n:1;return a*((e=>{if(e?.isMobile||e?.isMobileViewport)return!0;try{return!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(t){return!1}})(e)?o:1)}function Aa(){if(!Mr)return;let e=null;try{e=f()}catch(n){}if(!e)return;const t=La(e);Mr.style.setProperty("--abs-scene-impact-mul",t+"");const a=+e.sceneImpactLogoCompMul;Number.isFinite(a)&&a>0&&Mr.style.setProperty("--abs-scene-impact-logo-comp-mul",a+"")}function Ka(e,t){const a=La(t),n=Math.max(0,+e||0)*a,o=1/Math.max(.001,1-n),i=+t?.sceneImpactLogoCompMul;return Math.max(.5,Math.min(4,o*(1+((Number.isFinite(i)&&i>0?i:1)-1)*n)))}function Oa(){wr&&(window.clearTimeout(wr),wr=0),xr&&(window.clearTimeout(xr),xr=0)}function Wa(e=1,t={}){if(!yr||!Mr)return;const a=f();if(!1===a?.sceneImpactEnabled)return;const n=!1!==t?.scheduleRelease,o=Math.max(0,Math.min(1,+e||0)),i=++vr;Oa(),Mr.classList.add("abs-scene--animating"),t?.armManual&&(Sr=!0);const r=a?.sceneImpactPressMs??75,l=a?.sceneImpactReleaseMs??220,s=Math.max(1,Math.round(.8*(+r||0))),c=Math.max(1,Math.round(1.2*(+l||0)));Mr.style.setProperty(br,Math.round(s)+"ms"),window.requestAnimationFrame(()=>{yr&&Mr&&i===vr&&(Mr.style.setProperty(mr,o+""),Mr.style.setProperty(gr,Ka(o,a)+""))}),n&&(wr=window.setTimeout(()=>{Ra({token:i,releaseMs:c})},0),xr=window.setTimeout(()=>{xr=0,Mr&&Mr.classList.remove("abs-scene--animating")},Math.max(0,Math.round(c)+80)))}function Ea(){if(!yr||!Mr)return;const e=f();return!1!==e?.sceneImpactEnabled?Ra({token:vr,releaseMs:Math.max(1,Math.round(1.2*(+(e?.sceneImpactReleaseMs??220)||0)))}):void 0}function Ra({token:e,releaseMs:t}){Oa(),yr&&Mr&&e===vr&&(Mr.style.setProperty(br,Math.round(t)+"ms"),window.requestAnimationFrame(()=>{yr&&Mr&&e===vr&&(Mr.style.setProperty(mr,"0"),Mr.style.setProperty(gr,"1"))}),xr=window.setTimeout(()=>{xr=0,Mr&&Mr.classList.remove("abs-scene--animating")},Math.max(0,Math.round(t)+80)))}function za(){Cr||"undefined"==typeof window||"undefined"==typeof document||(kr=document.createElement("div"),kr.id="cursor-pulse-container",kr.setAttribute("aria-hidden","true"),kr.style.cssText="\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n    z-index: 29999; /* Just below cursor (30000) */\n  ",document.body.appendChild(kr),Cr=!0)}function Ba(e,t){if(!(Cr&&kr||(za(),kr)))return;const a=f();if(!1===a?.cursorPulseEnabled)return;if(window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches)return;const n=a?.cursorPulseDuration??500,o=a?.cursorPulseIntensity??.4,i=a?.cursorPulseFadeStart??.6,r=window.innerWidth,l=window.innerHeight,s=1.1*Math.max(Math.hypot(e,t),Math.hypot(r-e,t),Math.hypot(e,l-t),Math.hypot(r-e,l-t)),c=document.createElement("div");c.className="cursor-pulse-gradient";const d=`pulse-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;c.id=d,c.style.cssText=`\n    position: absolute;\n    left: ${e}px;\n    top: ${t}px;\n    width: ${2*s}px;\n    height: ${2*s}px;\n    border-radius: 50%;\n    background: radial-gradient(\n      circle at center,\n      rgba(255, 255, 255, ${o}) 0%,\n      rgba(255, 255, 255, ${.5*o}) ${50*i}%,\n      rgba(255, 255, 255, 0) 100%\n    );\n    transform: translate(-50%, -50%) scale(0);\n    pointer-events: none;\n    will-change: transform, opacity;\n  `,kr.appendChild(c),Pr.add(d);const p=c.animate([{transform:"translate(-50%, -50%) scale(0)",opacity:1},{transform:"translate(-50%, -50%) scale(1)",opacity:.8},{transform:"translate(-50%, -50%) scale(1)",opacity:0}],{duration:n,easing:"cubic-bezier(0.25, 0.1, 0.25, 1)",fill:"forwards"});p.addEventListener("finish",()=>{c.parentNode&&c.parentNode.removeChild(c),Pr.delete(d)}),p.addEventListener("cancel",()=>{c.parentNode&&c.parentNode.removeChild(c),Pr.delete(d)})}function Va(){const e=document.getElementById("custom-cursor");if(!e)return null;const t=e.getBoundingClientRect();return{x:t.left+t.width/2,y:t.top+t.height/2}}function $a(){const e=f(),t=An,a=t.indexOf(e.currentMode),n=t[((0>a?0:a)+1)%t.length],o=Va();o?Ba(o.x,o.y):(Ar>0||Kr>0)&&Ba(Ar,Kr),Promise.resolve().then(()=>qo).then(({setMode:e})=>{e(n)}),Promise.resolve().then(()=>Yi).then(({updateModeButtonsUI:e})=>{e(n)})}function Na(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function _a(){try{const e="undefined"!=typeof window?window.__TEXT__:null;return Na(e)?e:null}catch(e){return null}}function Ga(e,t=""){const a=Jr||_a();if(!a)return t;if(!e)return t;const n=(e+"").split(".").filter(Boolean);let o=a;for(const i of n){if(!Na(o)&&!Array.isArray(o))return t;if(o=o?.[i],null==o)return t}return o}function Ha(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.classList.add("page-flash--"+t),setTimeout(()=>{e.classList.remove("page-flash--"+t)},"success"===t?600:300)}function ja(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.classList.add("page-flash--"+t),setTimeout(()=>{e.classList.remove("page-flash--"+t)},"success"===t?600:300)}async function Za(){ae().isUnlocked?Ya(te()):await q()?Ya(!0):(el&&(el.innerHTML=Qr,el.setAttribute("aria-label","Audio unavailable"),el.title="Audio unavailable"),setTimeout(()=>{Ya(!1)},2e3))}function Ya(e){el&&(el.setAttribute("data-enabled",e?"true":"false"),el.setAttribute("aria-pressed",e?"true":"false"),el.setAttribute("aria-label",e?"Sound on":"Sound off"),el.title=e?"Sound on":"Sound off",el.innerHTML=e?'<i class="ti ti-volume-2" aria-hidden="true"></i>':Qr)}function Xa(e){return((e||"")+"").trim().toLowerCase()}function qa(e,t,a,n=t){const o=+e;if(!Number.isFinite(o))return n;const i=Math.floor(o);return t>i?t:i>a?a:i}function Ua(e){const t=f(),a=Xa(e),n=Array.isArray(t.colorDistribution)?t.colorDistribution:null;if(!n)return null;for(let o=0;n.length>o;o++){const e=n[o];if(Xa(e?.label)===a)return"bg-ball-"+(qa(e?.colorIndex,0,7,0)+1)}return null}function Ja(){const e=document.getElementById("expertise-legend");if(!e)return;const t=Array.from(e.querySelectorAll(".legend__item"));for(const a of t){const e=a.querySelector("span"),t=a.querySelector(".circle");if(!e||!t)continue;const n=Ua(Xa(e.textContent));if(n){for(const e of Array.from(t.classList))(e.startsWith("bg-ball-")||e.startsWith("bg-story-"))&&t.classList.remove(e);t.classList.add(n)}}}function Qa(e){const t=Number.parseFloat(((e||"")+"").trim());return Number.isFinite(t)?t:0}function en(e){return 0>e?0:e>1?1:e}function tn(e){const t=Number.parseInt(e,16);return Number.isFinite(t)?t:0}function an(e){const t=((e||"")+"").trim();if(!t)return null;if("#"===t[0]){const e=t.slice(1).trim();return 3===e.length?{r:tn(e[0]+e[0]),g:tn(e[1]+e[1]),b:tn(e[2]+e[2])}:6===e.length?{r:tn(e.slice(0,2)),g:tn(e.slice(2,4)),b:tn(e.slice(4,6))}:null}const a=t.match(/rgba?\(([^)]+)\)/i);if(a){const e=a[1].split(",").map(e=>Qa(e));if(e.length>=3)return{r:Math.round(e[0]),g:Math.round(e[1]),b:Math.round(e[2])}}return null}function nn(e){const t=en(e/255);return t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92}function on({r:e,g:t,b:a}){return.2126*nn(e)+.7152*nn(t)+.0722*nn(a)}function rn(e,t){const a=on(e),n=on(t);return(Math.max(a,n)+.05)/(Math.min(a,n)+.05)}function ln(e,t,a){const n=en(a);return{r:Math.round(e.r+(t.r-e.r)*n),g:Math.round(e.g+(t.g-e.g)*n),b:Math.round(e.b+(t.b-e.b)*n)}}function sn({r:e,g:t,b:a},n){return`rgb(${e} ${t} ${a} / ${en(n)})`}function cn(e){return!(!e||!e.closest||!(e.closest("#panelDock")||e.closest("#masterPanel")||e.closest("#dockToggle")||e.closest(".panel-dock")||e.closest(".panel")))}function dn(e){if(!e||!e.closest)return null;const t=e.closest('a, button, [role="button"]');if(!t)return null;try{if(t.classList?.contains?.("slide"))return null;if(t.closest?.(".slide"))return null}catch(a){}return t}function pn(e){try{e?.style?.removeProperty?.(cl),e?.style?.removeProperty?.(fl),e?.style?.removeProperty?.(ml)}catch(t){}}function un(e){const t=(()=>{const e=document.getElementById("custom-cursor");if(!e)return 0;const t=window.getComputedStyle(e),a=Math.max(Qa(t.width),Qa(t.height));return a>0?.25*a:0})();if(t>0)try{e.style.setProperty(cl,t+"px")}catch(a){}else pn(e)}function hn(e){try{if(document.body.classList.contains("portfolio-page"))return"ui";if(document.body.classList.contains("detail-open"))return"ui"}catch(t){}if((()=>{try{const e=document.getElementById("gate-overlay");return!!e&&(e.classList.contains("active")||"false"===e.getAttribute("aria-hidden"))}catch(t){return!1}})())return"ui";try{if(e?.closest?.(".project-detail"))return"ui";if(e?.closest?.("#gate-overlay"))return"ui";if(e?.closest?.(".gate-modal-host"))return"ui";if(e?.closest?.("#cv-gate")||e?.closest?.("#portfolio-gate")||e?.closest?.("#contact-gate"))return"ui"}catch(t){}return"index"}function fn(){try{const e=an(getComputedStyle(document.documentElement).getPropertyValue("--cursor-color").trim());if(e)return e}catch(e){}return null}function mn(){try{document.body.classList.remove(rl)}catch(e){}if(ol){try{ol.classList.remove(pl),ol.classList.remove(ul),ol.classList.remove(hl),ol.classList.remove("abs-cursor-pulse"),ol.querySelectorAll?.("."+dl)?.forEach?.(e=>e.remove())}catch(e){}pn(ol)}ol=null;try{document.body.classList.remove(ll),document.body.classList.remove(sl)}catch(e){}}function bn(){il||(il=!0,requestAnimationFrame(()=>{il=!1,ol&&un(ol)}))}function gn(e){const t=dn(e.target);t&&(cn(t)||(t=>{if(!t)return;ol&&ol!==t&&pn(ol),ol=t;const a=hn(ol);(t=>{try{document.body.classList.toggle(ll,"index"===t),document.body.classList.toggle(sl,"ui"===t)}catch(e){}})(a);try{ol.classList.add(pl),ol.classList.toggle(ul,"index"===a),ol.classList.toggle(hl,"ui"===a)}catch(e){}un(ol);try{ol.getBoundingClientRect?.()}catch(e){}if("index"===a){const t=fn(),a=(()=>{const t=[document.querySelector(".wall-frame"),document.getElementById("bravia-balls"),document.getElementById("fade-content"),document.body,document.documentElement].filter(Boolean);for(const a of t)try{const e=getComputedStyle(a).backgroundColor,t=an(e);if(!t)continue;if(0===t.r&&0===t.g&&0===t.b&&e.includes("rgba")&&/,\s*0(\.0+)?\s*\)/.test(e))continue;return t}catch(e){}return{r:245,g:245,b:245}})();if(t){const n=.12,o=((e,t)=>{const a={r:255,g:255,b:255},n={r:0,g:0,b:0},o=a=>{let n=null;for(let o=0;20>=o;o+=1){const i=o/20,r=ln(e,a,i),l=rn(r,t);if(l>=4.5){n={rgb:r,t:i,cr:l};break}}return n},i=o(a),r=o(n);if(i&&r)return i.t>r.t?r.rgb:i.rgb;if(i)return i.rgb;if(r)return r.rgb;const l=rn(e,t),s=rn(a,t),c=rn(n,t);return 4.5>l?c>s?n:a:e})(t,ln(a,t,n));try{ol.style.setProperty(fl,sn(t,n)),ol.style.setProperty(ml,(({r:e,g:t,b:a})=>`rgb(${e} ${t} ${a})`)(o))}catch(e){}}else pn(ol)}else try{ol.style.removeProperty(fl),ol.style.removeProperty(ml)}catch(e){}try{document.body.classList.add(rl)}catch(e){}})(t))}function Mn(e){const t=dn(e.target);if(!t||t!==ol)return;const a=e.relatedTarget;a&&t.contains(a)||mn()}function yn(){ol&&bn()}function vn(e){const t=dn(e.target);if(!t)return;if(cn(t))return;if(ol&&t!==ol)return;if(!ol)return;bn();const a=hn(ol);((t,a)=>{if(t)try{const n=document.createElement("span");n.className=dl,n.setAttribute("aria-hidden","true");const o=fn(),i="index"===a?.22:.18,r=o?sn(o,i):`rgb(var(--abs-rgb-black) / ${i})`;n.style.setProperty("--abs-pulse-color",r),n.style.setProperty("--abs-pulse-ms","520ms"),n.style.setProperty("--abs-pulse-size",`var(${cl}, 24px)`),n.style.setProperty("--abs-pulse-mode",a),t.appendChild(n);const l=()=>{try{n.remove()}catch(e){}};n.addEventListener("animationend",l,{once:!0}),window.setTimeout(l,640)}catch(e){}})(ol,a)}function wn(e,t){e&&(e.textContent=(t??"")+"")}function xn(e,t,a){if(e&&null!=a)try{e.setAttribute(t,a+"")}catch(n){}}async function Sn({timeoutMs:e=4e3,fontFaces:t=gl}={}){const a=document.documentElement;if(a&&a.classList.add("fonts-loading"),!document.fonts||!document.fonts.ready)return a&&a.classList.remove("fonts-loading"),!1;let n;const o=new Promise(t=>{n=window.setTimeout(()=>t(!1),e)}),i=Promise.all(t.map(e=>document.fonts.load(e).catch(()=>null))).then(()=>document.fonts.ready).then(()=>!0).catch(()=>!1),r=await Promise.race([i,o]);return n&&window.clearTimeout(n),a&&a.classList.remove("fonts-loading"),r}function kn(e){const t=document.documentElement;void 0!==e.topLogoWidthVw&&t.style.setProperty("--top-logo-width-vw",e.topLogoWidthVw+""),void 0!==e.noiseSizeBase&&t.style.setProperty("--noise-size-base",e.noiseSizeBase+"px"),void 0!==e.noiseSizeTop&&t.style.setProperty("--noise-size-top",e.noiseSizeTop+"px"),void 0!==e.noiseBackOpacity&&(t.style.setProperty("--noise-back-opacity",e.noiseBackOpacity+""),t.style.setProperty("--noise-back-opacity-light",e.noiseBackOpacity+"")),void 0!==e.noiseFrontOpacity&&(t.style.setProperty("--noise-front-opacity",e.noiseFrontOpacity+""),t.style.setProperty("--noise-front-opacity-light",e.noiseFrontOpacity+"")),void 0!==e.noiseBackOpacityDark&&t.style.setProperty("--noise-back-opacity-dark",e.noiseBackOpacityDark+""),void 0!==e.noiseFrontOpacityDark&&t.style.setProperty("--noise-front-opacity-dark",e.noiseFrontOpacityDark+"")}function Cn(){const e=window.innerWidth/window.innerHeight;return e>1.1?"landscape":.9>e?"portrait":"square"}function Pn(){const e=Cn();let t;document.documentElement.classList.remove("aspect-landscape","aspect-square","aspect-portrait"),document.documentElement.classList.add("aspect-"+e),window.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>{const t=Cn();t!==e&&(document.documentElement.classList.remove("aspect-landscape","aspect-square","aspect-portrait"),document.documentElement.classList.add("aspect-"+t))},150)})}function Fn(){const e=(()=>{const e=f();switch(Cn()){case"landscape":return e.entrancePerspectiveLandscape||1200;case"portrait":return e.entrancePerspectivePortrait||800;default:return e.entrancePerspectiveSquare||1e3}})();document.documentElement.style.setProperty("--entrance-perspective",e+"px")}function Tn(){const e=document.documentElement,t=f();let a=getComputedStyle(e).getPropertyValue("--wall-color").trim();a&&"#ffffff"!==a||(a=t.frameColor||"#0a0a0a"),e.dataset.originalWallColor=a,e.style.setProperty("--wall-color","#ffffff","important"),e.style.setProperty("background","#ffffff","important"),e.style.setProperty("background-color","#ffffff","important"),e.classList.add("entrance-pre-transition")}function Dn(){const e=f(),t=document.documentElement,a=e.entranceWallTransitionDelay||300,n=e.entranceWallTransitionDuration||800,o=document.getElementById("bravia-balls");if(!o)return console.warn("⚠️ #bravia-balls not found, falling back to simple transition"),void setTimeout(()=>{t.classList.remove("entrance-pre-transition"),t.classList.add("entrance-transitioning");const a=t.dataset.originalWallColor||e.frameColor||"#0a0a0a";t.style.setProperty("--wall-color",a),t.style.setProperty("background",a),t.style.setProperty("background-color",a),setTimeout(()=>{t.classList.remove("entrance-transitioning"),t.classList.add("entrance-complete"),t.style.removeProperty("--wall-color")},n)},a);const i=document.body.classList.contains("portfolio-page")?e.wallRadius&&"number"==typeof e.wallRadius&&e.wallRadius>0?e.wallRadius+"px":"42px":"0px",r=e.entranceWallInitialScale||1.1,l=e.entranceWallEasing||"cubic-bezier(0.16, 1, 0.3, 1)",s=o.style.transition;setTimeout(()=>{t.classList.remove("entrance-pre-transition"),t.classList.add("entrance-transitioning");const a=t.dataset.originalWallColor||e.frameColor||"#0a0a0a";if(t.style.setProperty("--wall-color",a),t.style.setProperty("background",a),t.style.setProperty("background-color",a),o.style.transition="none",o.style.transform=`scale(${r})`,o.style.transformOrigin="center center",o.style.borderRadius="0px",o.style.opacity="1",o.style.visibility="visible","function"==typeof o.animate){const e=o.animate([{transform:`scale(${r})`},{transform:"scale(1)"}],{duration:n,easing:l,fill:"forwards"}),a=o.animate([{borderRadius:"0px"},{borderRadius:i}],{duration:n,easing:l,fill:"forwards"});let c=!1,d=!1;const p=()=>{c&&d&&(o.style.transform="scale(1)",o.style.borderRadius=i,o.style.opacity="1",setTimeout(()=>{o.style.transition=s||"",t.classList.remove("entrance-transitioning"),t.classList.add("entrance-complete"),t.style.removeProperty("--wall-color")},50))};e.addEventListener("finish",()=>{c=!0,p()}),e.addEventListener("cancel",()=>{c=!0,p()}),a.addEventListener("finish",()=>{d=!0,p()}),a.addEventListener("cancel",()=>{d=!0,p()})}else requestAnimationFrame(()=>{o.style.transition=`transform ${n}ms ${l}, border-radius ${n}ms ${l}`,requestAnimationFrame(()=>{o.style.transform="scale(1)",o.style.borderRadius=i})}),setTimeout(()=>{o.style.transition=s||"",t.classList.remove("entrance-transitioning"),t.classList.add("entrance-complete"),t.style.removeProperty("--wall-color")},n+50)},a)}function In(e,t={}){const a=f();if(!e||"function"!=typeof e.animate)return e.style.opacity="1",null;const n=t.delay||0,o=t.duration||a.entranceElementDuration||200,i=t.scaleStart||a.entranceElementScaleStart||.95,r=t.scaleEnd||1,l=t.translateZStart||a.entranceElementTranslateZStart||-20,s=t.translateZEnd||0,c=t.easing||a.entranceElementEasing||"ease-out";e.style.opacity="0",e.style.transform=`translateZ(${l}px) scale(${i})`,e.style.willChange="opacity, transform",setTimeout(()=>{const t=e.animate([{opacity:0,transform:`translateZ(${l}px) scale(${i})`},{opacity:1,transform:`translateZ(${s}px) scale(${r})`}],{duration:o,easing:c,fill:"forwards"});return t.addEventListener("finish",()=>{e.style.opacity="1",e.style.transform=`translateZ(${s}px) scale(${r})`,e.style.willChange="auto"}),t.addEventListener("cancel",()=>{e.style.opacity="1",e.style.transform=`translateZ(${s}px) scale(${r})`,e.style.willChange="auto"}),t},n)}const Ln={PIT:"pit",PIT_THROWS:"pit-throws",FLIES:"flies",WEIGHTLESS:"weightless",WATER:"water",VORTEX:"vortex",PING_PONG:"ping-pong",MAGNETIC:"magnetic",BUBBLES:"bubbles",KALEIDOSCOPE:"kaleidoscope",KALEIDOSCOPE_1:"kaleidoscope-1",KALEIDOSCOPE_2:"kaleidoscope-2",KALEIDOSCOPE_3:"kaleidoscope-3",CRITTERS:"critters",ORBIT_3D:"orbit-3d",ORBIT_3D_2:"orbit-3d-2",NEURAL:"neural",LATTICE:"lattice",PARALLAX_LINEAR:"parallax-linear",PARALLAX_PERSPECTIVE:"parallax-perspective"},An=[Ln.PIT,Ln.FLIES,Ln.LATTICE,Ln.BUBBLES,Ln.PIT_THROWS,Ln.MAGNETIC,Ln.WATER,Ln.PING_PONG,Ln.NEURAL,Ln.VORTEX,Ln.ORBIT_3D,Ln.WEIGHTLESS,Ln.PARALLAX_LINEAR,Ln.CRITTERS,Ln.ORBIT_3D_2,Ln.PARALLAX_PERSPECTIVE,Ln.KALEIDOSCOPE_1,Ln.KALEIDOSCOPE_2,Ln.KALEIDOSCOPE_3,Ln.KALEIDOSCOPE],Kn={[Ln.PIT]:"SOURCE MATERIAL",[Ln.FLIES]:"IDEA SPARK",[Ln.LATTICE]:"SYSTEM FRAME",[Ln.BUBBLES]:"NOISE SIGNAL",[Ln.PIT_THROWS]:"PROTOTYPE LOOP",[Ln.MAGNETIC]:"DESIGN FORCES",[Ln.WATER]:"USER FLOW",[Ln.PING_PONG]:"FEEDBACK CYCLE",[Ln.NEURAL]:"CONNECTION MAP",[Ln.VORTEX]:"EMERGENT ORDER",[Ln.ORBIT_3D]:"SYSTEM DYNAMICS",[Ln.WEIGHTLESS]:"OPEN SPACE",[Ln.PARALLAX_LINEAR]:"PERSPECTIVE SHIFT",[Ln.CRITTERS]:"BEHAVIOR MODEL",[Ln.ORBIT_3D_2]:"EDGE CASES",[Ln.PARALLAX_PERSPECTIVE]:"CONTEXT FIELD",[Ln.KALEIDOSCOPE_1]:"VOCAB SEED",[Ln.KALEIDOSCOPE_2]:"VOCAB FLOW",[Ln.KALEIDOSCOPE_3]:"VOCAB BLOOM",[Ln.KALEIDOSCOPE]:"VISUAL LANGUAGE"},On={DPR:Math.max(1,Math.min(2,window.devicePixelRatio||1)),OFFSCREEN_MOUSE:-1e9,MIN_DISTANCE_EPSILON:1e-6,ACCUMULATOR_RESET_THRESHOLD:3,MAX_PHYSICS_STEPS:4,SPIN_DAMP_PER_S:3,SPIN_GAIN:.25,SPIN_GAIN_TANGENT:.18,ROLL_FRICTION_PER_S:2.5,SQUASH_MAX_BASE:.2,SQUASH_DECAY_PER_S:18,WALL_REST_VEL_THRESHOLD:70,GROUND_COUPLING_PER_S:12,SLEEP_VELOCITY_THRESHOLD:12,SLEEP_ANGULAR_THRESHOLD:.18,TIME_TO_SLEEP:.25,PHYSICS_DT:1/120},Wn={rubber:{label:"Rubber (balanced)",description:"Balanced rubber ring with clear bounce and crisp ripples.",values:{wallWobbleMaxDeform:50,wallWobbleStiffness:2100,wallWobbleDamping:34,wallWobbleSigma:2.2,wallWobbleCornerClamp:.6,wallWobbleImpactThreshold:110,wallWobbleSettlingSpeed:70,wallWobbleMaxVel:900,wallWobbleMaxImpulse:240,wallWobbleMaxEnergyPerStep:24e3,wallInset:3}},pudding:{label:"Pudding (thick, soft)",description:"Overdamped, broad blobs. Big squish, quick settling, minimal ringing.",values:{wallWobbleMaxDeform:85,wallWobbleStiffness:520,wallWobbleDamping:82,wallWobbleSigma:5.2,wallWobbleCornerClamp:.25,wallWobbleImpactThreshold:55,wallWobbleSettlingSpeed:94,wallWobbleMaxVel:650,wallWobbleMaxImpulse:180,wallWobbleMaxEnergyPerStep:22e3,wallInset:3}},trampoline:{label:"Trampoline (snappy)",description:"High elasticity and low viscosity. Fast rebound with lively oscillation.",values:{wallWobbleMaxDeform:60,wallWobbleStiffness:2900,wallWobbleDamping:14,wallWobbleSigma:2.4,wallWobbleCornerClamp:.55,wallWobbleImpactThreshold:95,wallWobbleSettlingSpeed:35,wallWobbleMaxVel:1200,wallWobbleMaxImpulse:320,wallWobbleMaxEnergyPerStep:3e4,wallInset:3}},jelly:{label:"Jelly (slow wobble)",description:"Soft and springy with slow, smooth undulation. More “gel sheet”.",values:{wallWobbleMaxDeform:95,wallWobbleStiffness:820,wallWobbleDamping:16,wallWobbleSigma:3.6,wallWobbleCornerClamp:.4,wallWobbleImpactThreshold:75,wallWobbleSettlingSpeed:28,wallWobbleMaxVel:900,wallWobbleMaxImpulse:260,wallWobbleMaxEnergyPerStep:26e3,wallInset:3}},stiff:{label:"Stiff (rigid-ish)",description:"Small deformation with heavy damping: feels like thick industrial gasket.",values:{wallWobbleMaxDeform:28,wallWobbleStiffness:3200,wallWobbleDamping:62,wallWobbleSigma:1.7,wallWobbleCornerClamp:.8,wallWobbleImpactThreshold:160,wallWobbleSettlingSpeed:92,wallWobbleMaxVel:700,wallWobbleMaxImpulse:160,wallWobbleMaxEnergyPerStep:2e4,wallInset:3}},steel:{label:"Steel (almost solid)",description:"Barely moves; impact gating high. Useful as a near-static control case.",values:{wallWobbleMaxDeform:10,wallWobbleStiffness:3600,wallWobbleDamping:75,wallWobbleSigma:1.2,wallWobbleCornerClamp:.9,wallWobbleImpactThreshold:190,wallWobbleSettlingSpeed:98,wallWobbleMaxVel:500,wallWobbleMaxImpulse:90,wallWobbleMaxEnergyPerStep:16e3,wallInset:3}},latex:{label:"Latex (tight snap)",description:"Taut membrane: smaller blobs, higher tension, crisp rebounds.",values:{wallWobbleMaxDeform:55,wallWobbleStiffness:2600,wallWobbleDamping:22,wallWobbleSigma:1.8,wallWobbleCornerClamp:.7,wallWobbleImpactThreshold:105,wallWobbleSettlingSpeed:55,wallWobbleMaxVel:1100,wallWobbleMaxImpulse:300,wallWobbleMaxEnergyPerStep:28e3,wallInset:3}},memoryFoam:{label:"Memory Foam (slow sink)",description:"Very soft with heavy damping: sinks in and slowly recovers.",values:{wallWobbleMaxDeform:120,wallWobbleStiffness:420,wallWobbleDamping:88,wallWobbleSigma:6,wallWobbleCornerClamp:.2,wallWobbleImpactThreshold:45,wallWobbleSettlingSpeed:96,wallWobbleMaxVel:520,wallWobbleMaxImpulse:150,wallWobbleMaxEnergyPerStep:22e3,wallInset:3}},hydraulic:{label:"Hydraulic (damped)",description:"Medium squish with very high viscosity: controlled, “mechanical” response.",values:{wallWobbleMaxDeform:70,wallWobbleStiffness:1400,wallWobbleDamping:78,wallWobbleSigma:3,wallWobbleCornerClamp:.55,wallWobbleImpactThreshold:85,wallWobbleSettlingSpeed:90,wallWobbleMaxVel:650,wallWobbleMaxImpulse:200,wallWobbleMaxEnergyPerStep:24e3,wallInset:3}},gelSheet:{label:"Gel Sheet (wide ripples)",description:"Wide, slow waves with moderate bounce. Feels like a gel panel.",values:{wallWobbleMaxDeform:95,wallWobbleStiffness:1e3,wallWobbleDamping:28,wallWobbleSigma:4.8,wallWobbleCornerClamp:.35,wallWobbleImpactThreshold:70,wallWobbleSettlingSpeed:45,wallWobbleMaxVel:900,wallWobbleMaxImpulse:260,wallWobbleMaxEnergyPerStep:26e3,wallDeformPhysicsPrecision:75,wallInset:3}}},En={default:{label:"Default (Full View Grid)",parallaxLinearDotSizeMul:1.8,sizeVariationParallaxLinear:0,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:7,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:50,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:260},dense:{label:"Dense (More Vertices)",parallaxLinearDotSizeMul:1.6,sizeVariationParallaxLinear:.1,parallaxLinearGridX:18,parallaxLinearGridY:13,parallaxLinearGridZ:9,parallaxLinearSpanX:1.25,parallaxLinearSpanY:1.25,parallaxLinearZNear:45,parallaxLinearZFar:1e3,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:240},deep:{label:"Deep Field (Stronger Depth)",parallaxLinearDotSizeMul:1.7,sizeVariationParallaxLinear:.08,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:10,parallaxLinearSpanX:1.45,parallaxLinearSpanY:1.45,parallaxLinearZNear:30,parallaxLinearZFar:1500,parallaxLinearFocalLength:520,parallaxLinearParallaxStrength:320},calm:{label:"Calm (Slow Camera)",parallaxLinearDotSizeMul:1.8,sizeVariationParallaxLinear:.05,parallaxLinearGridX:12,parallaxLinearGridY:9,parallaxLinearGridZ:6,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:60,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:160},minimal:{label:"Minimal (Big Dots)",parallaxLinearDotSizeMul:2.4,sizeVariationParallaxLinear:.15,parallaxLinearGridX:10,parallaxLinearGridY:7,parallaxLinearGridZ:4,parallaxLinearSpanX:1.6,parallaxLinearSpanY:1.6,parallaxLinearZNear:70,parallaxLinearZFar:800,parallaxLinearFocalLength:380,parallaxLinearParallaxStrength:220}},Rn={default:{label:"Default (Nebula Grid)",parallaxPerspectiveDotSizeMul:1.8,sizeVariationParallaxPerspective:0,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:8,parallaxPerspectiveSpanX:1.45,parallaxPerspectiveSpanY:1.45,parallaxPerspectiveZNear:40,parallaxPerspectiveZFar:1200,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:280,parallaxPerspectiveRandomness:.6},calm:{label:"Calm Mist",parallaxPerspectiveDotSizeMul:1.9,sizeVariationParallaxPerspective:.08,parallaxPerspectiveGridX:14,parallaxPerspectiveGridY:10,parallaxPerspectiveGridZ:6,parallaxPerspectiveSpanX:1.4,parallaxPerspectiveSpanY:1.4,parallaxPerspectiveZNear:60,parallaxPerspectiveZFar:900,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:180,parallaxPerspectiveRandomness:.25},deep:{label:"Deep Space",parallaxPerspectiveDotSizeMul:1.6,sizeVariationParallaxPerspective:.06,parallaxPerspectiveGridX:18,parallaxPerspectiveGridY:13,parallaxPerspectiveGridZ:12,parallaxPerspectiveSpanX:1.55,parallaxPerspectiveSpanY:1.55,parallaxPerspectiveZNear:30,parallaxPerspectiveZFar:2200,parallaxPerspectiveFocalLength:520,parallaxPerspectiveParallaxStrength:340,parallaxPerspectiveRandomness:.55},wild:{label:"Wild Nebula",parallaxPerspectiveDotSizeMul:1.7,sizeVariationParallaxPerspective:.18,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:10,parallaxPerspectiveSpanX:1.6,parallaxPerspectiveSpanY:1.6,parallaxPerspectiveZNear:20,parallaxPerspectiveZFar:1600,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:360,parallaxPerspectiveRandomness:.9},minimal:{label:"Minimal Stars",parallaxPerspectiveDotSizeMul:2.6,sizeVariationParallaxPerspective:.22,parallaxPerspectiveGridX:10,parallaxPerspectiveGridY:7,parallaxPerspectiveGridZ:5,parallaxPerspectiveSpanX:1.75,parallaxPerspectiveSpanY:1.75,parallaxPerspectiveZNear:70,parallaxPerspectiveZFar:1100,parallaxPerspectiveFocalLength:380,parallaxPerspectiveParallaxStrength:220,parallaxPerspectiveRandomness:.35}};let zn=Math.max(1,Math.min(2,window.devicePixelRatio||1));const Bn={config:{},currentMode:Ln.CRITTERS,warmupFramesRemaining:0,balls:[],canvas:null,ctx:null,container:null,mouseX:On.OFFSCREEN_MOUSE,mouseY:On.OFFSCREEN_MOUSE,mouseInCanvas:!1,lastPointerMoveMs:0,lastPointerMoveX:On.OFFSCREEN_MOUSE,lastPointerMoveY:On.OFFSCREEN_MOUSE,GE:1960,G:0,gravityScale:1,gravityMultiplier:0,gravityMultiplierPit:1.1,pitThrowSpeed:650,pitThrowSpeedJitter:.22,pitThrowAngleJitter:.16,pitThrowBatchSize:18,pitThrowIntervalMs:70,pitThrowColorPauseMs:180,pitThrowTargetYFrac:.36,pitThrowInletInset:.06,pitThrowCrossBias:.12,pitThrowSpawnSpread:.02,pitThrowAimJitter:.04,pitThrowPairChance:.35,pitThrowPairStaggerMs:18,pitThrowSpeedVar:.18,pitThrowSpreadVar:.25,REST:.31,FRICTION:.011,ballMassKg:240,MASS_BASELINE_KG:240,MASS_REST_EXP:.15,MASS_GRAVITY_EXP:.35,get DPR(){return zn},sizeScale:1.2,sizeVariationGlobalMul:1,sizeVariationCap:.12,sizeVariationPit:0,sizeVariationPitThrows:0,sizeVariationFlies:0,sizeVariationWeightless:0,sizeVariationWater:0,sizeVariationVortex:.2,sizeVariationPingPong:0,sizeVariationMagnetic:0,sizeVariationBubbles:.2,sizeVariationKaleidoscope:0,sizeVariationOrbit3d:0,sizeVariationCritters:.2,sizeVariationNeural:0,sizeVariationLattice:0,sizeVariationParallaxLinear:0,sizeVariationParallaxPerspective:0,pitWarmupFrames:10,pitThrowsWarmupFrames:10,fliesWarmupFrames:10,weightlessWarmupFrames:10,waterWarmupFrames:10,vortexWarmupFrames:10,pingPongWarmupFrames:10,magneticWarmupFrames:10,bubblesWarmupFrames:10,kaleidoscopeWarmupFrames:10,kaleidoscope1WarmupFrames:10,kaleidoscope2WarmupFrames:10,kaleidoscope3WarmupFrames:10,orbit3dWarmupFrames:10,orbit3d2WarmupFrames:10,crittersWarmupFrames:10,neuralWarmupFrames:10,latticeWarmupFrames:10,parallaxLinearWarmupFrames:10,parallaxPerspectiveWarmupFrames:10,sizeVariation:0,responsiveScale:1,responsiveScaleMobile:.75,isMobile:!1,isMobileViewport:!1,mobileObjectReductionFactor:.7,R_MIN_BASE:6,R_MAX_BASE:24,R_MED:0,R_MIN:0,R_MAX:0,cursorSize:1,cursorColorMode:"auto",cursorColorIndex:5,cursorColorHex:"#ff4013",cursorColorLumaMax:.62,cursorColorAllowIndices:[],cursorColorDenyIndices:[],mouseTrailEnabled:!0,mouseTrailLength:18,mouseTrailSize:1.3,mouseTrailFadeMs:220,mouseTrailOpacity:.35,ballSoftness:20,ballSpacing:.08,sleepVelocityThreshold:12,sleepAngularThreshold:.18,timeToSleep:.25,physicsCollisionIterations:10,physicsSkipSleepingCollisions:!0,physicsSleepThreshold:12,physicsSleepTime:.25,physicsSkipSleepingSteps:!0,physicsSpatialGridOptimization:!0,wallPhysicsSamples:48,wallPhysicsSkipInactive:!0,wallPhysicsUpdateHz:30,wallPhysicsMaxSubstepHz:60,wallPhysicsInterpolation:!0,wallPhysicsAdaptiveSamples:!0,wallPhysicsMinSamples:24,wallVisualDeformMul:1,wallRenderDecimation:2,critterCount:90,critterSpeed:680,critterMaxSpeed:1400,critterStepHz:5,critterStepSharpness:2.4,critterTurnNoise:2.2,critterTurnDamp:10,critterTurnSeek:10,critterAvoidRadius:90,critterAvoidForce:9500,critterEdgeAvoid:1,critterMousePull:1,critterMouseRadiusVw:30,critterRestitution:.18,critterFriction:.018,cornerRadius:42,layoutViewportWidthPx:0,containerBorderVw:0,simulationPaddingVw:0,contentPaddingVw:0,contentPaddingHorizontalRatio:1,mobileWallThicknessXFactor:1.4,mobileEdgeLabelsVisible:!0,wallRadiusVw:0,wallThicknessVw:0,noiseBackOpacity:.015,noiseFrontOpacity:.045,noiseBackOpacityDark:.06,noiseFrontOpacityDark:.08,noiseEnabled:!0,noiseSeed:1337,noiseTextureSize:256,noiseDistribution:"gaussian",noiseMonochrome:!0,noiseChroma:.35,noiseMotion:"jitter",noiseMotionAmount:1.2,noiseSpeedBackMs:1400,noiseSpeedFrontMs:900,noiseFlicker:.08,noiseFlickerSpeedMs:180,noiseBlurPx:0,noiseContrast:1.2,noiseBrightness:1.15,noiseSaturation:1,noiseHue:0,noiseSizeBase:65,noiseSizeTop:85,noiseTopOpacity:0,detailNoiseOpacity:1,layoutMinContentPaddingPx:16,layoutMinWallRadiusPx:28,wallInset:3,vortexSwirlStrength:420,vortexRadialPull:180,vortexBallCount:180,vortexSpeedMultiplier:1,vortexRadius:0,vortexFalloffCurve:1,vortexRotationDirection:1,vortexCoreStrength:1,vortexAccelerationZone:0,vortexOutwardPush:0,vortexFalloffRate:.0015,magneticBallCount:180,magneticStrength:65e3,magneticMaxVelocity:2800,magneticExplosionInterval:5,bubblesSpawnRate:8,bubblesRiseSpeed:150,bubblesWobble:40,bubblesMaxCount:200,bubblesDeflectRadius:0,pingPongBallCount:35,pingPongSpeed:800,pingPongCursorRadius:0,currentColors:["#b7bcb7","#d0d0d0","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],currentTemplate:"industrialTeal",paletteRotateOnReload:!1,colorDistribution:[{label:"AI Integration",colorIndex:0,weight:30},{label:"UI/UX Design",colorIndex:4,weight:18},{label:"Creative Strategy",colorIndex:3,weight:15},{label:"Frontend Development",colorIndex:2,weight:12},{label:"Brand Identity",colorIndex:5,weight:10},{label:"3D Design",colorIndex:6,weight:10},{label:"Art Direction",colorIndex:7,weight:5}],fliesBallCount:60,attractionPower:5e3,orbitRadius:180,swarmSpeed:.4,fliesSeparation:15e3,weightlessCount:80,weightlessInitialSpeed:250,weightlessBounce:.97,weightlessRepelRadius:220,weightlessRepelPower:22e4,weightlessRepelSoft:2.2,kaleidoscopeBallCount:23,kaleidoscopeWedges:12,kaleidoscopeMirror:1,kaleidoscopeSpeed:1,kaleidoscopeDotSizeVh:.95,kaleidoscopeDotAreaMul:.7,kaleidoscopeSpawnAreaMul:1,kaleidoscopeSizeVariance:.3,kaleidoscope1BallCount:18,kaleidoscope1Wedges:8,kaleidoscope1Speed:.8,kaleidoscope1DotSizeVh:.95,kaleidoscope1DotAreaMul:.7,kaleidoscope1SpawnAreaMul:1,kaleidoscope1SizeVariance:.3,kaleidoscope2BallCount:36,kaleidoscope2Wedges:8,kaleidoscope2Speed:1.15,kaleidoscope2DotSizeVh:.95,kaleidoscope2DotAreaMul:.7,kaleidoscope2SpawnAreaMul:1,kaleidoscope2SizeVariance:.3,kaleidoscope3BallCount:54,kaleidoscope3Wedges:8,kaleidoscope3Speed:1.55,kaleidoscope3DotSizeVh:.95,kaleidoscope3DotAreaMul:.7,kaleidoscope3SpawnAreaMul:1,kaleidoscope3SizeVariance:.3,orbit3dPreset:"serene",orbit3dMoonCount:80,orbit3dGravity:5e3,orbit3dMoonMass:1,orbit3dVelocityMult:150,orbit3dTargetOrbit:12,orbit3dMinOrbit:3,orbit3dMaxOrbit:3,orbit3dDepthScale:.8,orbit3dDamping:.02,orbit3d2MoonCount:60,orbit3d2Gravity:3e3,orbit3d2VelocityMult:200,orbit3d2MinOrbit:5,orbit3d2MaxOrbit:30,orbit3d2DepthScale:.5,orbit3d2Damping:.98,orbit3d2MoonMass:1,orbit3d2MaxSpeed:800,neuralBallCount:80,neuralLinkDistanceVw:14,neuralLineOpacity:.22,neuralWanderStrength:420,neuralMaxLinksPerBall:4,neuralDamping:.985,latticeBallCount:90,latticeSpacingVw:8.5,latticeStiffness:2.2,latticeDamping:.92,latticeDisruptRadius:600,latticeDisruptPower:25,latticeMeshWaveStrength:12,latticeMeshWaveSpeed:.8,latticeAlignment:"center",parallaxLinearDotCount:95,parallaxLinearRowPattern:"thirds",parallaxLinearSpacingPattern:"even",parallaxLinearFarPct:.42,parallaxLinearMidPct:.32,parallaxLinearFarSpeed:.15,parallaxLinearMidSpeed:.5,parallaxLinearNearSpeed:1,parallaxLinearFollowStrength:16,parallaxLinearDamping:12,parallaxPerspectiveDotCount:240,parallaxPerspectiveDepthMul:1.6,parallaxPerspectiveFocalLength:400,parallaxPerspectiveFollowStrength:16,parallaxPerspectiveDamping:12,parallaxPerspectiveZ1:1200,parallaxPerspectiveZ2:700,parallaxPerspectiveZ3:350,parallaxPerspectiveZ4:120,parallaxPerspectiveZ5:35,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:7,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:50,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:260,parallaxLinearDotSizeMul:1.8,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:8,parallaxPerspectiveSpanX:1.45,parallaxPerspectiveSpanY:1.45,parallaxPerspectiveZNear:40,parallaxPerspectiveZFar:1200,parallaxPerspectiveParallaxStrength:280,parallaxPerspectiveRandomness:.6,parallaxPerspectiveDotSizeMul:1.8,waterBallCount:300,waterDrag:.015,waterRippleSpeed:300,waterRippleStrength:18e3,waterDriftStrength:40,waterInitialVelocity:200,vortexDrag:.005,pingPongVerticalDamp:.995,magneticDamping:.98,repelRadius:120,repelPower:274e3,repelSoft:3.4,repellerEnabled:!1,cursorInfluenceRadiusVw:14,cursorInfluenceRadiusPx:140,emitterTimer:0,autoDarkModeEnabled:!0,isDarkMode:!1,chromeHarmonyMode:"site",autoDarkNightStartHour:18,autoDarkNightEndHour:6,clickCycleEnabled:!0,sceneImpactEnabled:!0,sceneImpactMul:.005,sceneImpactMobileMulFactor:1,sceneImpactLogoCompMul:1.8,sceneImpactOvershoot:.22,sceneImpactAnticipation:0,sceneImpactPressMs:0,sceneImpactReleaseMs:620,sceneChangeSoundEnabled:!0,sceneChangeSoundIntensity:.35,sceneChangeSoundRadius:18,brandLogoImpactMul:.014,brandLogoSquashMul:1,brandLogoOvershoot:.22,brandLogoAnticipation:0,brandLogoTiltDeg:0,brandLogoSkewDeg:0,brandLogoPressMs:75,brandLogoHoldMs:55,brandLogoReleaseMs:220,containerBorder:20,containerBorderX:20,simulationPadding:0,contentPadding:40,contentPaddingX:40,contentPaddingY:40,bgLight:"#f5f5f5",bgDark:"#0a0a0a",frameColor:"#0a0a0a",frameColorLight:"#0a0a0a",frameColorDark:"#0a0a0a",textColorLight:"#161616",textColorLightMuted:"#2f2f2f",textColorDark:"#7a8fa3",textColorDarkMuted:"#9db0c4",edgeLabelColorLight:"#2f2f2f",edgeLabelColorDark:"#8a9ba8",edgeLabelInsetAdjustPx:0,linkHoverColor:"#ff4013",logoColorLight:"#161616",logoColorDark:"#b8c5d3",portfolioLogoColorLight:"#161616",portfolioLogoColorDark:"#374862",topLogoWidthVw:35,homeMainLinksBelowLogoPx:40,wallThickness:12,wallRadius:42,wallInset:3,wallPreset:"pudding",wallSoftness:50,wallBounciness:50,wallWobbleMaxDeform:70,wallWobbleStiffness:420,wallWobbleDamping:92,wallWobbleSigma:5.5,wallWobbleCornerClamp:.25,wallWobbleMaxVel:620,wallWobbleMaxImpulse:160,wallWobbleMaxEnergyPerStep:2e4,wallWobbleImpactThreshold:60,wallWobbleSettlingSpeed:94,gateOverlayEnabled:!0,gateOverlayOpacity:.01,gateOverlayBlurPx:16,gateOverlayTransitionMs:800,gateOverlayTransitionOutMs:600,gateOverlayContentDelayMs:200,gateDepthScale:.96,gateDepthTranslateY:8,logoOpacityInactive:1,logoOpacityActive:.2,logoBlurInactive:0,logoBlurActive:12,entranceEnabled:!0,entranceWallTransitionDelay:300,entranceWallTransitionDuration:800,entranceWallInitialScale:1.1,entranceWallEasing:"cubic-bezier(0.16, 1, 0.3, 1)",entranceElementDuration:200,entranceElementScaleStart:.95,entranceElementTranslateZStart:-20,entranceElementEasing:"ease-out",entrancePerspectiveLandscape:1200,entrancePerspectiveSquare:1e3,entrancePerspectivePortrait:800,linkTextPadding:30,linkIconPadding:24,linkColorInfluence:1,linkImpactScale:.95,linkImpactBlur:10,linkImpactDuration:150,getSquashMax(){return 0===this.ballSoftness?0:On.SQUASH_MAX_BASE*(this.ballSoftness/40)},getCanvasCornerRadius(){return Math.max(0,this.cornerRadius-this.simulationPadding)}};var Vn=Object.freeze({__proto__:null,applyLayoutCSSVars:u,applyLayoutFromVwToPx:p,clearBalls:M,detectResponsiveScale:y,getBalls:()=>Bn.balls,getConfig:()=>Bn.config,getEffectiveDPR:()=>zn,getGlobals:f,getLayoutViewportWidthPx:s,getMobileAdjustedCount:m,getState:()=>Bn,initState:h,pxToVw:c,setCanvas:b,setEffectiveDPR:i,setMode:g,updateBallSizes:v,vwToPx:d});const $n=.85,Nn={label:"Industrial Teal",light:["#9cb0a9","#b1c1bf","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#5b8378","#345d51","#8a928a","#00e6c3","#d5d5d5","#ff6b47","#5b9aff","#ffb84d"]},_n=1.35,Gn={satMul:.1,valMul:.03},Hn={satMul:.14,valMul:.07},jn={industrialTeal:Nn,industrialRust:{label:"Industrial Rust",light:L(D(Nn.light,I(Nn.light,["#b7aaa0","#d0c5be","#ffffff","#a33a22","#000000","#00695c","#1f4bb8","#ff8a1f"],_n),$n),Gn),dark:L(D(Nn.dark,I(Nn.dark,["#7f6f64","#54433a","#b6b1aa","#ff6a3d","#d5d5d5","#00e6c3","#6aa0ff","#ffb15a"],_n),$n),Hn)},industrialSlate:{label:"Industrial Slate",light:L(D(Nn.light,I(Nn.light,["#a9adb3","#c6c9cd","#ffffff","#1f2937","#000000","#00a8cc","#7c3aed","#ff5d2e"],_n),$n),Gn),dark:L(D(Nn.dark,I(Nn.dark,["#6f7780","#3f4851","#98a2b3","#7dd3fc","#d5d5d5","#22d3ee","#c084fc","#ff7a45"],_n),$n),Hn)},industrialAmber:{label:"Industrial Amber",light:L(D(Nn.light,I(Nn.light,["#bdb1a1","#d6cdc2","#ffffff","#d97706","#000000","#00695c","#6b46c1","#ff4013"],_n),$n),Gn),dark:L(D(Nn.dark,I(Nn.dark,["#82745d","#5a4b35","#a9a193","#fbbf24","#d5d5d5","#00e6c3","#c4b5fd","#ff6b47"],_n),$n),Hn)},industrialViolet:{label:"Industrial Violet",light:L(D(Nn.light,I(Nn.light,["#b0a7b8","#cec7d6","#ffffff","#6b46c1","#000000","#00695c","#7fbf2a","#d94666"],_n),$n),Gn),dark:L(D(Nn.dark,I(Nn.dark,["#7a6f83","#52475b","#a7a0b0","#c084fc","#d5d5d5","#00e6c3","#bef264","#fb7185"],_n),$n),Hn)},industrialForest:{label:"Industrial Forest",light:L(D(Nn.light,I(Nn.light,["#a4b0a2","#c0c9bd","#ffffff","#166534","#000000","#00695c","#f59e0b","#7c3aed"],_n),$n),Gn),dark:L(D(Nn.dark,I(Nn.dark,["#637563","#3d4f3f","#98a593","#4ade80","#d5d5d5","#00e6c3","#fcd34d","#c4b5fd"],_n),$n),Hn)},industrialSteel:{label:"Industrial Steel",light:L(D(Nn.light,I(Nn.light,["#a6a9af","#c3c6cc","#ffffff","#334155","#000000","#0ea5e9","#c2410c","#65a30d"],_n),$n),Gn),dark:L(D(Nn.dark,I(Nn.dark,["#6f737a","#464a52","#98a2ab","#94a3b8","#d5d5d5","#38bdf8","#fb923c","#a3e635"],_n),$n),Hn)}},Zn=["industrialTeal","industrialRust","industrialSlate","industrialAmber","industrialViolet","industrialForest","industrialSteel"],Yn="abs_palette_chapter",Xn=[.5,.25,.12,.06,.03,.02,.01,.01],qn=[3,5,6,7];var Un=Object.freeze({__proto__:null,COLOR_TEMPLATES:jn,PALETTE_CHAPTER_ORDER:Zn,applyColorTemplate:G,applyCursorColorIndex:V,getCurrentPalette:N,getCursorCandidateIndices:B,maybeAutoPickCursorColor:$,pickRandomColor:_,populateColorSelect:H,rotatePaletteChapterOnReload:j});const Jn={attackTime:.005,decayTime:.075,harmonicGain:0,filterBaseFreq:580,filterVelocityRange:400,filterQ:.18,filterMinHz:350,filterMaxHz:2800,pitchMinHz:145,pitchMaxHz:280,pitchCurve:1,reverbDecay:.14,reverbWetMix:.08,reverbHighDamp:.8,minGain:.008,maxGain:.09,masterGain:.28,voiceGainMax:.14,minTimeBetweenSounds:.012,maxPan:.15,noiseTransientEnabled:!0,noiseTransientGain:.045,noiseTransientDecay:.008,noiseTransientFilterMin:500,noiseTransientFilterMax:1800,noiseTransientQ:1.2,sparkleGain:0,sparkleRatioMin:2.3,sparkleRatioMax:4.1,sparkleDecayMul:.65,variancePitch:.06,varianceDecay:.2,varianceGain:.15,varianceFilter:.18,varianceNoise:.25,velocityNoiseScale:1.8,velocityBrightnessScale:1.4,velocityDecayScale:.65,intensityExponent:1.5,toneSafetyMinHz:130,toneSafetyMaxHz:480,toneSafetyExponent:2.2,toneSafetyHighGainAtten:.25,toneSafetyLowGainAtten:.06,toneSafetyHighBrightAtten:.45,collisionMinImpact:.58,highShelfFreq:2200,highShelfGain:-6};let Qn=null;const eo={organicImpact:{label:"Organic Impact",description:"Warm, natural thuds with intensity dynamics",...Jn},glassMarbles:{label:"Glass Marbles",description:"Clear, glassy impacts with more presence",...Jn,pitchMinHz:260,pitchMaxHz:780,pitchCurve:1.05,filterBaseFreq:850,filterVelocityRange:600,noiseTransientGain:.065,noiseTransientFilterMin:650,noiseTransientFilterMax:2200,noiseTransientQ:1.6,decayTime:.055,intensityExponent:1.3,highShelfGain:-4.5},crystalPebbles:{label:"Crystal Pebbles ★",description:"Crisp, close, soothing micro-chimes (non-repetitive)",...Jn,pitchMinHz:420,pitchMaxHz:1600,pitchCurve:1.15,filterBaseFreq:1300,filterVelocityRange:1700,filterQ:.22,filterMaxHz:6200,decayTime:.04,intensityExponent:1.65,collisionMinImpact:.7,minTimeBetweenSounds:.018,noiseTransientGain:.02,noiseTransientDecay:.006,noiseTransientFilterMin:1200,noiseTransientFilterMax:7e3,noiseTransientQ:2.8,sparkleGain:.12,sparkleRatioMin:2.6,sparkleRatioMax:4.4,sparkleDecayMul:.55,reverbWetMix:.04,reverbDecay:.1,highShelfGain:-4,masterGain:.24},woodenBeads:{label:"Wooden Beads ★",description:"Ultra-soft, muted thuds (recommended)",...Jn,filterBaseFreq:420,filterVelocityRange:200,noiseTransientGain:.025,noiseTransientFilterMin:380,noiseTransientFilterMax:1400,noiseTransientQ:1.1,decayTime:.095,intensityExponent:1.7,collisionMinImpact:.62,highShelfGain:-7.5,reverbWetMix:.12},rubberBalls:{label:"Rubber Balls",description:"Bouncy, playful with longer decay",...Jn,pitchMinHz:160,pitchMaxHz:360,filterBaseFreq:520,filterVelocityRange:350,noiseTransientGain:.035,noiseTransientFilterMin:450,noiseTransientFilterMax:1600,noiseTransientQ:1.2,decayTime:.12,intensityExponent:1.4,reverbWetMix:.14,highShelfGain:-5},metallicClick:{label:"Metallic Click",description:"Crisp, percussive impacts",...Jn,pitchMinHz:220,pitchMaxHz:620,pitchCurve:1.1,filterBaseFreq:720,filterVelocityRange:550,noiseTransientGain:.08,noiseTransientFilterMin:700,noiseTransientFilterMax:2400,noiseTransientQ:1.8,noiseTransientDecay:.006,decayTime:.045,intensityExponent:1.2,highShelfGain:-3.5,collisionMinImpact:.5}};let to="crystalPebbles";Qn={...eo[to]},delete Qn.label,delete Qn.description;let ao=null,no=null,oo=null,io=null,ro=null,lo=null,so=null,co=null,po=null,uo=!1,ho=!1;const fo="bravia-balls:sound-state",mo=8;let bo=[],go=0,Mo=new Map,yo=!1,vo=null,wo=!1;const xo=new Map,So=[],ko=[],Co=384,Po=45,Fo=1/30,To=.25;let Do=null;class Io{constructor(e){const t=Math.max(8,Math.round(e||Co));this.n=t,this.deformations=new Float32Array(t),this.velocities=new Float32Array(t),this.pressure=new Float32Array(t),this.renderDeformations=new Float32Array(t),this.Z=0,this.Y=0,this.X=0,this.q=0,this.U=0,this.J=0,this.ee=0,this.te=0,this.ae=0,this.ne=0,this.oe=0,this.ie=0,this.re=0,this.le=0,this.se=0,this.baseX=new Float32Array(t),this.baseY=new Float32Array(t),this.normX=new Float32Array(t),this.normY=new Float32Array(t),this.cornerMask=new Float32Array(t),this.ce=0,this.de=0,this.pe=!1,this.ue=0}ensureSampleCount(e){const t=Math.max(8,Math.round(+e||Co));if(t===this.n)return;const a=this.n,n=this.deformations,o=this.velocities,i=this.pressure,r=new Float32Array(t),l=new Float32Array(t),s=new Float32Array(t),c=new Float32Array(t);if(a>0){let e=0,c=0;for(let d=0;t>d;d++){const p=d/t*a,u=Math.floor(p)%a,h=p-u,f=(u+1)%a,m=(1-h)*n[u]+h*n[f],b=(1-h)*o[u]+h*o[f],g=(1-h)*i[u]+h*i[f];r[d]=m,l[d]=b,s[d]=g,m>e&&(e=m);const M=Math.abs(b);M>c&&(c=M)}this.ce=e,this.de=c,this.pe=e>0||c>0}else this.ce=0,this.de=0,this.pe=!1;this.n=t,this.deformations=r,this.velocities=l,this.pressure=s,this.renderDeformations=c,this.baseX=new Float32Array(t),this.baseY=new Float32Array(t),this.normX=new Float32Array(t),this.normY=new Float32Array(t),this.cornerMask=new Float32Array(t),this.Z=0,this.Y=0,this.X=0,this.q=0,this.U=0,this.J=0,this.ee=0,this.te=0,this.ae=0,this.ne=0,this.oe=0,this.ie=0,this.re=0,this.le=0,this.se=0}clearPressure(){this.pressure.fill(0)}reset(){this.deformations.fill(0),this.velocities.fill(0),this.pressure.fill(0),this.renderDeformations.fill(0),this.ce=0,this.de=0,this.pe=!1,this.ue=0}hasDeformation(){return this.ce>2}ensureGeometry(e,t,a){const n=Math.max(1,0|e),o=Math.max(1,0|t),i=Math.max(0,Math.min(+a||0,.5*Math.min(n,o)));if(n===this.Z&&o===this.Y&&.001>Math.abs(i-this.X))return;if(this.Z=n,this.Y=o,this.X=i,0>=i){const e=n,t=o,a=2*(e+t);this.q=e,this.U=t,this.J=0,this.ee=a,this.ne=0,this.ae=e/2,this.te=e/2+t,this.oe=e/2+t+e,this.ie=0,this.re=0,this.le=0,this.se=0;for(let i=0;this.n>i;i++){const r=(i/this.n*a+e/2)%a;if(e/2>r)this.baseX[i]=n/2+r,this.baseY[i]=o,this.normX[i]=0,this.normY[i]=-1;else if(e/2+t>r){const t=r-e/2;this.baseX[i]=n,this.baseY[i]=t,this.normX[i]=-1,this.normY[i]=0}else if(e/2+t+e>r)this.baseX[i]=n-(r-(e/2+t)),this.baseY[i]=0,this.normX[i]=0,this.normY[i]=1;else if(e/2+t+e+t>r){const a=r-(e/2+t+e);this.baseX[i]=0,this.baseY[i]=o-a,this.normX[i]=1,this.normY[i]=0}else this.baseX[i]=r-(e/2+t+e+t),this.baseY[i]=o,this.normX[i]=0,this.normY[i]=-1;this.cornerMask[i]=0}return}const r=Math.max(0,n-2*i),l=Math.max(0,o-2*i),s=.5*Math.PI*i,c=2*(r+l)+4*s;this.q=r,this.U=l,this.J=s,this.ee=c,this.ne=0,this.se=r/2,this.ae=r/2+s,this.re=r/2+s+l,this.te=r/2+s+l+s,this.ie=r/2+s+l+s+r,this.oe=r/2+s+l+s+r+s,this.le=r/2+s+l+s+r+s+l;const d=n,p=o,u=i,h=this.n,f=(e,t,a,n,o,i)=>{const r=n+(o-n)*i,l=Math.cos(r),s=Math.sin(r);return{x:e+a*l,y:t+a*s,nx:-l,ny:-s}},m=r/2,b=m+s,g=b+l,M=g+s,y=M+r,v=y+s,w=v+l,x=w+s,S=u+r/2,k=d-u,C=u;for(let P=0;h>P;P++){let e=(P/h*c+r/2)%c,t=0,a=0,n=0,o=0,i=0;if(m>e)t=S+e,a=p,n=0,o=-1;else if(b>e){const r=f(d-u,p-u,u,Math.PI/2,0,(e-m)/s);t=r.x,a=r.y,n=r.nx,o=r.ny,i=1}else if(g>e)t=d,a=p-u-(e-b),n=-1,o=0;else if(M>e){const r=f(d-u,u,u,0,-Math.PI/2,(e-g)/s);t=r.x,a=r.y,n=r.nx,o=r.ny,i=1}else if(y>e)t=k-(e-M),a=0,n=0,o=1;else if(v>e){const r=f(u,u,u,3*Math.PI/2,Math.PI,(e-y)/s);t=r.x,a=r.y,n=r.nx,o=r.ny,i=1}else if(w>e)t=0,a=u+(e-v),n=1,o=0;else if(x>e){const r=f(u,p-u,u,Math.PI,Math.PI/2,(e-w)/s);t=r.x,a=r.y,n=r.nx,o=r.ny,i=1}else t=C+(e-x),a=p,n=0,o=-1;this.baseX[P]=t,this.baseY[P]=a,this.normX[P]=n,this.normY[P]=o,this.cornerMask[P]=i?1:0}}tFromPoint(e,t){const a=this.Z,n=this.Y;if(0===this.n||0>=a||0>=n)return 0;const o=a,i=n,r=this.X,l=e>o-r&&r>t,s=r>e&&t>i-r,c=e>o-r&&t>i-r;let d=0;if(r>e&&r>t){const a=e-r,n=t-r;if(Math.sqrt(a*a+n*n)>0){const e=this.ie/this.ee,t=(this.ie+this.J)/this.ee;d=e+Math.max(0,Math.min(1,(Math.atan2(n,a)-Math.PI)/(Math.PI/2)))*(t-e)}else d=this.ie/this.ee}else if(l){const a=e-(o-r),n=t-r;if(Math.sqrt(a*a+n*n)>0){const e=this.re/this.ee,t=(this.re+this.J)/this.ee;d=e+Math.max(0,Math.min(1,(Math.atan2(n,a)+Math.PI/2)/(Math.PI/2)))*(t-e)}else d=this.re/this.ee}else if(c){const a=e-(o-r),n=t-(i-r);if(Math.sqrt(a*a+n*n)>0){const e=this.se/this.ee,t=(this.se+this.J)/this.ee;d=e+Math.max(0,Math.min(1,Math.atan2(n,a)/(Math.PI/2)))*(t-e)}else d=this.se/this.ee}else if(s){const a=e-r,n=t-(i-r);if(Math.sqrt(a*a+n*n)>0){const e=this.le/this.ee,t=1;d=e+Math.max(0,Math.min(1,(Math.atan2(n,a)-Math.PI/2)/(Math.PI/2)))*(t-e),1>d||(d-=1)}else d=this.le/this.ee}else if(r>t)d=(this.te+Math.max(0,Math.min(this.q,e-r)))/this.ee;else if(e>o-r)d=(this.ae+Math.max(0,Math.min(this.U,t-r)))/this.ee;else if(t>i-r){const t=o-r-e;t>this.q/2?(d=(this.ne+(this.q/2+(this.q/2-(e-r))))/this.ee,1>d||(d-=1)):d=(this.ne+(this.q/2-t))/this.ee}else r>e&&(d=(this.oe+Math.max(0,Math.min(this.U,i-r-t)))/this.ee);return(d%1+1)%1}getDeformationAtPoint(e,t){const a=this.n;if(0===a)return 0;const n=this.tFromPoint(e,t)*a,o=Math.floor(n)%a,i=n-o;return(1-i)*this.deformations[o]+i*this.deformations[(o+1)%a]}impactAtPoint(e,t,a){const n=this.tFromPoint(e,t);this.impactAtT(n,a)}addPressureAtPoint(e,t,a,n={}){const o=this.tFromPoint(e,t);this.addPressureAtT(o,a,n)}tFromWall(e,t){const a=this.Z,n=this.Y,o=this.X,i=this.q,r=this.U,l=this.ee;if(0>=l)return 0;const s=Math.max(0,Math.min(1,+t||0));return"top"===e?(this.te+Math.max(0,Math.min(i,s*a-o)))/l:"right"===e?(this.ae+Math.max(0,Math.min(r,s*n-o)))/l:"bottom"===e?(this.ne+Math.max(0,Math.min(i,a-o-s*a)))/l:"left"===e?(this.oe+Math.max(0,Math.min(r,n-o-s*n)))/l:0}impactAtT(e,t){const a=f(),n=this.n;if(0>=n)return;const o=Math.max(0,a.wallWobbleMaxDeform??Po)*Math.max(0,Math.min(1,+t||0));if(0>=o)return;const i=Math.max(.25,Math.min(6,a.wallWobbleSigma??2)),r=((+e||0)%1+1)%1*n,l=Math.max(0,+(a.wallWobbleMaxImpulse??220)||0),s=Math.max(0,+(a.wallWobbleMaxVel??800)||0),c=Math.max(0,+(a.wallWobbleMaxEnergyPerStep??2e4)||0),d=Math.max(2,Math.min(n,Math.min(24,Math.ceil(3*i))));for(let p=-d;d>=p;p++){const e=((Math.round(r)+p)%n+n)%n,t=Math.abs(r-e),a=Math.min(t,n-t);let d=o*Math.exp(-a*a/(2*i*i));l>0&&d>l&&(d=l);const u=this.pressure[e]||0;if(u>0&&(d*=Math.max(To,1-.65*u)),c>0){const e=c-this.ue;if(0>=e)break;d>e&&(d=e)}let h=this.velocities[e]+d;if(s>0){const t=this.pressure[e]||0,a=t>0?s*Math.max(To,1-.55*t):s;h>a?h=a:-a>h&&(h=-a)}this.velocities[e]=h,c>0&&(this.ue+=Math.abs(d))}this.pe=!0}addPressureAtT(e,t,a={}){const n=this.n;if(0>=n)return;const o=Math.max(0,Math.min(1,+t||0));if(0>=o)return;const i=Math.round(((+e||0)%1+1)%1*n)%n,r=a.fast?1:3;for(let l=-r;r>=l;l++){const e=((i+l)%n+n)%n,t=this.pressure[e]+o*Math.max(0,1-Math.abs(l)/(r+1));this.pressure[e]=t>1?1:t}this.pe=!0}step(e){const t=f(),a=this.n;if(0>=a)return;const n=Math.min(Fo,Math.max(0,+e||0));if(0>=n)return;if(!this.pe){let e=!1;const o=200,i=3,r=5;for(let l=0;a>l;l++)if(this.deformations[l]>.001||Math.abs(this.velocities[l])>.001){e=!0;const a=1>this.baseY[l]&&!this.cornerMask[l]&&this.normY[l]>.7,s=!this.cornerMask[l]&&this.X+2>this.baseX[l]&&this.X+2>this.baseY[l],c=s||!this.cornerMask[l]&&this.baseX[l]>this.Z-this.X-1&&this.X+1>this.baseY[l],d=this.cornerMask[l]&&this.X+3>this.baseX[l]&&this.X+3>this.baseY[l],p=d||this.cornerMask[l]&&this.baseX[l]>this.Z-this.X-2&&this.X+2>this.baseY[l];this.velocities[l]+=(-(d||s?o*i*r:a||c||p?o*i:o)*this.deformations[l]-20*this.velocities[l])*n,this.deformations[l]+=this.velocities[l]*n;const u=Math.max(0,t.wallWobbleMaxDeform??Po);-u>this.deformations[l]?(this.deformations[l]=-u,this.velocities[l]=0):this.deformations[l]>u&&(this.deformations[l]=u,this.velocities[l]=0);const h=a||c||p,f=d||s;(f?.01:h?.02:.1)>this.deformations[l]&&(f?.2:h?.3:1)>Math.abs(this.velocities[l])&&(this.deformations[l]=0,this.velocities[l]=0)}return this.pe=e,void(e||(this.ce=0,this.de=0))}const o=Math.max(1,t.wallWobbleStiffness??2200),i=Math.max(0,t.wallWobbleDamping??35),r=Math.max(0,t.wallWobbleMaxDeform??Po),l=Math.max(0,+(t.wallWobbleMaxVel??800)||0),s=1+5*Math.max(0,Math.min(1,+t.wallWobbleCornerClamp||0)),c=.18*o,d=Math.max(0,Math.min(100,t.wallWobbleSettlingSpeed??50))/100,p=5+30*d,u=.5+1.5*d;let h=0,m=0;for(let f=0;a>f;f++){const e=0===f?a-1:f-1,t=f===a-1?0:f+1,d=this.deformations[f],b=this.velocities[f],g=this.cornerMask[f]?1:0,M=g&&this.X+3>this.baseX[f]&&this.X+3>this.baseY[f]?3:g&&this.baseX[f]>this.Z-this.X-2&&this.X+2>this.baseY[f]?2:1,y=o*(g?s*M:g?M:!g&&1>this.baseY[f]&&this.normY[f]>.7||!g&&this.X+2>this.baseX[f]&&this.X+2>this.baseY[f]||!g&&this.baseX[f]>this.Z-this.X-1&&this.X+1>this.baseY[f]?4:2),v=Math.abs(d),w=Math.abs(b),x=this.pressure[f];let S=b+(-y*d+c*(this.deformations[e]+this.deformations[t]-2*d)-Math.min(i*(1+1*Math.max(0,Math.min(1,1-v/20)))*(1+x*p),1.9*Math.sqrt(y+2*c))*b)*n;if(l>0){const e=this.pressure[f]||0,t=e>0?l*Math.max(To,1-.55*e):l;S>t?S=t:-t>S&&(S=-t)}let k=d+S*n,C=!1,P=!1;-r>k&&(k=-r,C=!0),k>r&&(k=r,P=!0),C&&0>S&&(S=0),P&&S>0&&(S=0);const F=!g&&1>this.baseY[f]&&this.normY[f]>.7||!g&&this.X+2>this.baseX[f]&&this.X+2>this.baseY[f]||!g&&this.baseX[f]>this.Z-this.X-1&&this.X+1>this.baseY[f]||g&&this.X+3>this.baseX[f]&&this.X+3>this.baseY[f]||g&&this.baseX[f]>this.Z-this.X-2&&this.X+2>this.baseY[f]?5:this.cornerMask[f]?1:3,T=(x>.5?.5:x>.1?3:10)*u*F;(x>.5?.3:x>.1?.8:2)*u*F>Math.abs(k)&&T>w?(this.deformations[f]=0,this.velocities[f]=0):(this.deformations[f]=k,this.velocities[f]=S),this.deformations[f]>h&&(h=this.deformations[f]);const D=Math.abs(this.velocities[f]);D>m&&(m=D)}Number.isFinite(h)&&Number.isFinite(m)?(this.ce=h,this.de=m,this.pe=h>0||m>0):this.reset()}}const Lo={ringPhysics:new Io(Co),ringRender:new Io(Co),he:0,fe:0,me:1/30,be:0,N:0,ge:null,_:null,H:null,Me:null,resetStepBudgets(){this.he=0,this.fe=0,this.ringPhysics.ue=0},clearPressureFrame(){this.ringPhysics.clearPressure()},step(e){const t=f(),a=!1!==t.wallPhysicsAdaptiveSamples,n=Math.max(8,Math.min(48,Math.round(+(t.wallPhysicsMinSamples??24)||24))),o=Math.min(Co,Math.round(+(t.wallPhysicsSamples??Co)||Co));if(!1!==t.wallPhysicsSkipInactive&&!this.ringPhysics.pe)return this.ringPhysics.step(e),this.ringRender.step(e),void(this.N=1);const i=1/Math.max(10,Math.min(60,+(t.wallPhysicsUpdateHz??30)||30)),r=!1!==t.wallPhysicsInterpolation;if(this.be+=e,i>this.be)this.N=r?Math.max(0,Math.min(1,this.be/i)):1;else{if(a){const e=this.ringPhysics.n;let t=e;t=this.ringPhysics.pe?5>(this.ringPhysics.ce||0)&&2>(this.ringPhysics.de||0)?Math.max(n,Math.min(o,e-1)):Math.min(o,Math.max(n,e+1)):Math.max(n,Math.min(o,e-1)),t!==e&&this.ringPhysics.ensureSampleCount(t)}else{const e=Math.max(8,Math.min(Co,o));this.ringPhysics.n!==e&&this.ringPhysics.ensureSampleCount(e)}if(r&&this.ringPhysics.n>0){const e=this.ringPhysics.n;this.ge&&this.ge.length===e||(this.ge=new Float32Array(e)),this.ge.set(this.ringPhysics.deformations)}let e=i;this.be-=i;const s=1/Math.max(30,Math.min(240,+(t.wallPhysicsMaxSubstepHz??60)||60));let c=0;const d=6;for(;e>1e-6&&d>c;){const t=e>s?s:e;this.ringPhysics.step(t),e-=t,c++}try{const e=this.ringPhysics,t=0|e.n,a=0|this.ringRender.n;if(t>0&&a>0){this._&&this._.length===a?this._.set(this.H):(this._=new Float32Array(a),this.H=new Float32Array(a),this.Me=new Float32Array(a));const n=e.deformations,o=this.Me,i=this.H;for(let e=0;a>e;e++){const i=e/a*t,r=Math.floor(i)%t,l=i-r;o[e]=(1-l)*n[r]+l*n[(r+1)%t]}for(let e=0;a>e;e++)i[e]=(o[(e-2+a)%a]+4*o[(e-1+a)%a]+6*o[e]+4*o[(e+1)%a]+o[(e+2)%a])*(1/16)}}catch(l){}this.N=r?Math.max(0,Math.min(1,this.be/i)):1}},reset(){this.ringPhysics.reset(),this.ringRender.reset(),this.be=0,this.N=0,this.ge=null,this._=null,this.H=null,this.Me=null},hasAnyDeformation(){return this.ringPhysics.hasDeformation()},getDeformationAtPoint(e,t){const a=this.ringPhysics;if(!a||0===a.n)return 0;const n=f();if(!n.canvas)return 0;const o=n.DPR||1,i=Math.max(0,(+n.wallThickness||0)*o),r=a.getDeformationAtPoint(e-i,t-i);return r>0?r*o:0}};let Ao=0;class Ko{constructor(e,t,a,n){const o=f();this.x=e,this.y=t,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=a,this.rBase=a,this.m=o.ballMassKg,this.color=n,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1,this.isSleeping=!1,this.sleepTimer=0,this.isGrounded=!1,this.hasSupport=!1,this.ye="ball-"+Ao++}step(e,t){const a=f(),{currentMode:n,G:o,gravityScale:i,FRICTION:r,MASS_BASELINE_KG:l}=a;if(this.t+=e,this.age+=e,this.isSleeping){const e=(a.repelRadius||710)*a.DPR*1.2,t=this.x-a.mouseX,n=this.y-a.mouseY;e*e>t*t+n*n&&this.wake()}if(this.isSleeping&&!1!==a.physicsSkipSleepingSteps)return;const s=a.DPR||1,c=this.isGrounded,d=this.hasSupport;this.isGrounded=!1,this.hasSupport=!1,n!==Ln.WEIGHTLESS&&(!c&&!d||-8*s>this.vy)&&(this.vy+=o*i*e);const p=Math.max(.25,this.m/l),u=Math.max(0,1-(n===Ln.WEIGHTLESS||n===Ln.ORBIT_3D||n===Ln.ORBIT_3D_2?0:r)*(1+1*Math.max(0,Math.min(1,1-Math.sqrt(this.vx*this.vx+this.vy*this.vy)/(100*s))))/p);if(this.vx*=u,this.vy*=u,n!==Ln.ORBIT_3D&&n!==Ln.ORBIT_3D_2){const e=2*s;e>Math.abs(this.vx)&&(this.vx=0),e>Math.abs(this.vy)&&n===Ln.WEIGHTLESS&&(this.vy=0)}0!==this.driftAx&&this.driftTime>this.age?this.vx+=this.driftAx*e/p:0!==this.driftAx&&(this.driftAx=0),t&&t(this,e),this.x+=this.vx*e,this.y+=this.vy*e,this.omega*=Math.max(0,1-On.SPIN_DAMP_PER_S*(1+.5*Math.max(0,Math.min(1,1-Math.abs(this.omega)/2)))*e),this.theta+=this.omega*e,.01>Math.abs(this.omega)&&(this.omega=0),this.squashAmount+=(0-this.squashAmount)*Math.min(1,On.SQUASH_DECAY_PER_S*e),this.squash=1-this.squashAmount}updateSleepState(e,t){const a=Math.sqrt(this.vx*this.vx+this.vy*this.vy),n=Math.abs(this.omega),o=t.DPR||1,i=(Number.isFinite(t.sleepVelocityThreshold)?t.sleepVelocityThreshold:On.SLEEP_VELOCITY_THRESHOLD)*o,r=Number.isFinite(t.sleepAngularThreshold)?t.sleepAngularThreshold:On.SLEEP_ANGULAR_THRESHOLD,l=Number.isFinite(t.timeToSleep)?t.timeToSleep:On.TIME_TO_SLEEP;(this.isGrounded||this.hasSupport)&&i>a&&r>n?(this.sleepTimer+=e,l>this.sleepTimer||(this.vx=0,this.vy=0,this.omega=0,this.isSleeping=!0)):this.sleepTimer=0}wake(){this.isSleeping=!1,this.sleepTimer=0}walls(e,t,a,n,o={}){const i=!1!==o.registerEffects,r=f(),{REST:l,MASS_BASELINE_KG:s,currentMode:c,DPR:d}=r,p=void 0!==n?n:l,u=r.wallWobbleImpactThreshold??On.WALL_REST_VEL_THRESHOLD,h=this.r*(1+(r.ballSpacing||0)),m="function"==typeof r.getCanvasCornerRadius?r.getCanvasCornerRadius():r.cornerRadius??r.wallRadius??0,b=Math.max(0,+m||0)*(d||1),g=Math.max(0,(r.wallThickness??0)*(d||1)),M=Math.max(0,r.wallInset??3)*(d||1),y=Math.max(1,e-2*g),v=Math.max(1,t-2*g);let w=!1;const x=c===Ln.PIT||c===Ln.PIT_THROWS,S=.5*y,k=.5*v,C=Math.max(0,Math.min(b,.5*y,.5*v)),P=this.x-(g+S),F=this.y-(g+k),T=Math.abs(P)-(S-C),D=Math.abs(F)-(k-C),I=Math.hypot(Math.max(T,0),Math.max(D,0))+Math.min(Math.max(T,D),0)-C;let L=0,A=0;if(T>0&&D>0){const e=Math.hypot(T,D);e>1e-6&&(L=T/e,A=D/e)}else T>D?(L=1,A=0):(L=0,A=1);L*=0>P?-1:1,A*=0>F?-1:1;const K=I+(h+M);if(K>0&&(!x||A>=-.5)){w=!0;const t=this.vx*L+this.vy*A;this.x-=L*K,this.y-=A*K,t>0&&(this.vx-=(1+p)*t*L,this.vy-=(1+p)*t*A);const n=A>.7,o=Math.abs(t),l=Math.min(1,o/(80*this.r));if(n){this.isGrounded=!0;const e=Math.max(.25,this.m/s);this.vx*=Math.max(0,1-On.ROLL_FRICTION_PER_S*(1+Math.max(0,Math.min(1,1-Math.abs(this.vx)/(80*d))))*a/e),3*d>Math.abs(this.vx)&&(this.vx=0),this.omega+=(this.vx-this.omega*this.r)/this.r*On.SPIN_GAIN/e,this.omega+=(this.vx/this.r-this.omega)*Math.min(1,On.GROUND_COUPLING_PER_S*a),.05>Math.abs(this.omega)&&(this.omega=0)}if(this.squashAmount=Math.min(r.getSquashMax(),.8*l),this.squashNormalAngle=Math.atan2(-A,-L),i){U(this.r,.65*l,this.x/Math.max(1,e),this.ye);const a=Math.max(0,t);this.isSleeping||u>a||((e,t,a)=>{const n=f(),o=n.canvas;if(!o)return;const i="function"==typeof n.getCanvasCornerRadius?n.getCanvasCornerRadius():n.cornerRadius??n.wallRadius??0,r=Math.max(0,(+i||0)*(n.DPR||1)),l=Math.max(0,(+n.wallThickness||0)*(n.DPR||1)),s=Math.max(1,o.width-2*l),c=Math.max(1,o.height-2*l);Lo.ringPhysics.ensureGeometry(s,c,Math.max(0,Math.min(r,.5*s,.5*c)));const d=e-l,p=t-l;if(64>Lo.he)Lo.ringPhysics.impactAtPoint(d,p,a);else{const e=Lo.ringPhysics.n;if(e>0){const t=Lo.ringPhysics.tFromPoint(d,p);Lo.ringPhysics.velocities[Math.round(((+t||0)%1+1)%1*e)%e]+=Math.max(0,n.wallWobbleMaxDeform??Po)*Math.max(0,Math.min(1,+a||0)),Lo.ringPhysics.pe=!0}}Lo.he++})(this.x-L*h,this.y-A*h,Math.min(1,a/(80*this.r)));const n=this.isSleeping?1:Math.max(0,(u-o)/u);n>.1&&((e,t,a=1)=>{const n=f(),o=n.canvas;if(!o)return;const i="function"==typeof n.getCanvasCornerRadius?n.getCanvasCornerRadius():n.cornerRadius??n.wallRadius??0,r=Math.max(0,(+i||0)*(n.DPR||1)),l=Math.max(0,(+n.wallThickness||0)*(n.DPR||1)),s=Math.max(1,o.width-2*l),c=Math.max(1,o.height-2*l);Lo.ringPhysics.ensureGeometry(s,c,Math.max(0,Math.min(r,.5*s,.5*c))),Lo.ringPhysics.addPressureAtPoint(e-l,t-l,a,{fast:Lo.fe>=256}),Lo.fe++})(this.x-L*h,this.y-A*h,n)}}w&&this.isSleeping&&this.wake()}draw(e){const t=this.squashAmount>.001,a=1>this.alpha;t||a?(e.save(),e.translate(this.x,this.y),t?(e.rotate(this.theta+this.squashNormalAngle),e.scale(1-.3*this.squashAmount,1+.3*this.squashAmount),e.rotate(-this.squashNormalAngle)):e.rotate(this.theta),a&&(e.globalAlpha=this.alpha),e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI),e.fillStyle=this.color,e.fill(),e.restore()):(e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.r,0,2*Math.PI),e.fill())}}const Oo=.2,Wo=[];let Eo,Ro,zo=On.DPR,Bo=0,Vo=0,$o=null,No=null,_o=0,Go=0,Ho=0;const jo=2*Math.PI,Zo=1e-6;let Yo=0,Xo=0;var qo=Object.freeze({__proto__:null,MODES:Ln,getForceApplicator:st,getModeRenderer:dt,getModeUpdater:ct,resetCurrentMode:lt,setMode:rt});let Uo=null,Jo=!1,Qo=!1,ei=null,ti=0,ai=!1,ni=null;const oi="translate(-50%, -50%) scale(0.25)",ii="translate(-50%, -50%) scale(1)";var ri=Object.freeze({__proto__:null,getCursorColor:pt,hideCursor:mt,setupCustomCursor:ut,showCursor:bt,updateCursorPosition:ft,updateCursorSize:ht});let li=0,si=null,ci=null,di=null,pi=0,ui=0,hi=!1;const fi=On.PHYSICS_DT;let mi=0;const bi=42,gi=1/60;var Mi=Object.freeze({__proto__:null,getBalls:()=>f().balls||[],render:St,syncChromeColor:kt,updatePhysics:xt});const yi=(()=>{try{return{log:console.log?.bind(console)??(()=>{}),info:console.info?.bind(console)??(()=>{}),warn:console.warn?.bind(console)??(()=>{}),error:console.error?.bind(console)??(()=>{}),debug:console.debug?.bind(console)??(()=>{}),groupCollapsed:console.groupCollapsed?.bind(console)??(()=>{}),groupEnd:console.groupEnd?.bind(console)??(()=>{}),table:console.table?.bind(console)??(()=>{})}}catch(e){return{log(){},info(){},warn(){},error(){},debug(){},groupCollapsed(){},groupEnd(){},table(){}}}})();let vi=null,wi=0,xi="undefined"!=typeof performance&&performance.now?performance.now():Date.now(),Si=!1;const ki=["#b7bcb7","#d0d0d0","#ffffff","#00695c","#1a1a1a","#ff4013","#0d5cb6","#ffa000"],Ci=[.5,.25,.12,.06,.03,.02,.01,.01];let Pi=null,Fi=null,Ti="auto",Di="light",Ii=!1;var Li=Object.freeze({__proto__:null,getCurrentTheme:()=>Ti,initializeDarkMode:Wt,setTheme:Ot,toggleDarkMode:Et});let Ai=!1,Ki=null,Oi=null,Wi=null,Ei=null,Ri=null,zi=0,Bi=null,Vi=0,$i=null,Ni="";const _i=["noiseEnabled","noiseSeed","noiseTextureSize","noiseDistribution","noiseMonochrome","noiseChroma","noiseMotion","noiseMotionAmount","noiseSpeedBackMs","noiseSpeedFrontMs","noiseFlicker","noiseFlickerSpeedMs","noiseBlurPx","noiseContrast","noiseBrightness","noiseSaturation","noiseHue","noiseSizeBase","noiseSizeTop","noiseBackOpacity","noiseFrontOpacity","noiseBackOpacityDark","noiseFrontOpacityDark","noiseTopOpacity","detailNoiseOpacity"];let Gi={};(()=>{try{const e=localStorage.getItem("panel_control_visibility");e&&(Gi=JSON.parse(e))}catch(e){Gi={}}})();const Hi=["physics","wall","balls","colorDistribution","colors","noise","cursor","trail","links","scene","overlay","entrance","environment"],ji={physics:"MATERIAL WORLD",wall:"MATERIAL WORLD",balls:"MATERIAL WORLD",colorDistribution:"LOOK & PALETTE",colors:"LOOK & PALETTE",noise:"LOOK & PALETTE",cursor:"INTERACTION",trail:"INTERACTION",links:"INTERACTION",scene:"MOTION",entrance:"MOTION",overlay:"DEPTH & LAYOUT",layout:"DEPTH & LAYOUT",sound:"SOUND",environment:"ENVIRONMENT"},Zi={environment:{title:"Browser",icon:"🧭",defaultOpen:!1,controls:[{id:"chromeHarmonyMode",label:"Chrome Harmony",stateKey:"chromeHarmonyMode",type:"select",options:[{value:"auto",label:"Auto (adapt only when needed)"},{value:"site",label:"Site (benchmark)"},{value:"browser",label:"Browser (force adapt)"}],default:"site",format:e=>e+"",parse:e=>e+"",hint:"If desktop browsers ignore theme-color, the wall adapts to match the browser UI palette.",onChange(){Promise.resolve().then(()=>Li).then(({getCurrentTheme:e,setTheme:t})=>{t(e())}).catch(()=>{})}},{id:"autoDarkModeEnabled",label:"Auto Dark (Night)",stateKey:"autoDarkModeEnabled",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,hint:"In Auto theme, prefer Dark during the night window (privacy-first: local clock only).",onChange(){Promise.resolve().then(()=>Li).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}},{id:"autoDarkNightStartHour",label:"Night Starts",stateKey:"autoDarkNightStartHour",type:"range",min:0,max:23,step:1,default:18,format:e=>Math.round(e)+":00",parse:e=>parseInt(e,10),onChange(){Promise.resolve().then(()=>Li).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}},{id:"autoDarkNightEndHour",label:"Night Ends",stateKey:"autoDarkNightEndHour",type:"range",min:0,max:23,step:1,default:6,format:e=>Math.round(e)+":00",parse:e=>parseInt(e,10),onChange(){Promise.resolve().then(()=>Li).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}}]},physics:{title:"Material World",icon:"⚖️",defaultOpen:!1,controls:[{id:"ballMassKg",label:"Ball Mass",stateKey:"ballMassKg",type:"range",min:20,max:400,step:1,default:91,format:e=>Math.round(e)+" kg",parse:e=>parseInt(e,10),hint:"Heavier = snooker feel (more inertia, less jitter).",onChange(e,t){const a=+t;if(Number.isFinite(a)&&Array.isArray(e.balls))for(let n=0;e.balls.length>n;n++){const t=e.balls[n];t&&(t.m=a)}}},{id:"REST",label:"Restitution",stateKey:"REST",type:"range",min:0,max:.95,step:.01,default:.42,format:e=>e.toFixed(2),parse:parseFloat,hint:"Global bounciness for collisions (modes may override)."},{id:"FRICTION",label:"Friction",stateKey:"FRICTION",type:"range",min:0,max:.06,step:.001,default:.018,format:e=>e.toFixed(3),parse:parseFloat,hint:"Global drag/energy loss (modes may override)."},{id:"physicsCollisionIterations",label:"Collision Iterations",stateKey:"physicsCollisionIterations",type:"range",min:3,max:20,step:1,default:10,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Performance",groupCollapsed:!0,hint:"Lower = faster, higher = tighter stacks."},{id:"physicsSkipSleepingCollisions",label:"Skip Sleeping Pairs",stateKey:"physicsSkipSleepingCollisions",type:"toggle",default:!0,group:"Performance"},{id:"physicsSpatialGridOptimization",label:"Grid Reuse",stateKey:"physicsSpatialGridOptimization",type:"toggle",default:!0,group:"Performance"},{id:"physicsSleepThreshold",label:"Sleep Threshold",stateKey:"physicsSleepThreshold",type:"range",min:0,max:30,step:1,default:12,format:e=>Math.round(e)+" px/s",parse:e=>parseInt(e,10),group:"Performance",hint:"Global sleep threshold for non-Pit physics modes. 0 disables."},{id:"physicsSleepTime",label:"Sleep Time",stateKey:"physicsSleepTime",type:"range",min:0,max:1,step:.05,default:.25,format:e=>e.toFixed(2)+"s",parse:parseFloat,group:"Performance"},{id:"physicsSkipSleepingSteps",label:"Skip Sleeping Steps",stateKey:"physicsSkipSleepingSteps",type:"toggle",default:!0,group:"Performance"}]},balls:{title:"Balls",icon:"🎱",defaultOpen:!1,controls:[{id:"sizeGlobal",label:"Size",stateKey:"sizeScale",type:"range",min:.1,max:6,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat,onChange(e){Promise.resolve().then(()=>Vn).then(({updateBallSizes:t})=>{t();const a=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=a,e.rBase=a})}),Promise.resolve().then(()=>ri).then(({updateCursorSize:e})=>{e()})}},{id:"responsiveScaleMobile",label:"Mobile Scale",stateKey:"responsiveScaleMobile",type:"range",min:.5,max:1.5,step:.05,default:.75,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Ball size multiplier for iPad/iPhone (requires reload)",onChange(e){Promise.resolve().then(()=>Vn).then(({detectResponsiveScale:t})=>{t();const a=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=a,e.rBase=a})})}},{id:"mobileObjectReductionFactor",label:"Mobile Density",stateKey:"mobileObjectReductionFactor",type:"range",min:0,max:1,step:.05,default:.7,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Scales object counts on mobile (0% = none). Resets the current mode.",onChange(e){Promise.resolve().then(()=>qo).then(({setMode:t})=>{t(e.currentMode)}).catch(()=>{})}},{id:"ballSoftnessGlobal",label:"Softness",stateKey:"ballSoftness",type:"range",min:0,max:100,step:1,default:20,format:e=>e+"",parse:e=>parseInt(e,10)},{id:"ballSpacing",label:"Spacing",stateKey:"ballSpacing",type:"range",min:0,max:.5,step:.01,default:.08,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Collision gap as % of ball radius (affects physics)"},{id:"sizeVariationGlobalMul",label:"Variation Scale",stateKey:"sizeVariationGlobalMul",type:"range",min:0,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Global multiplier for per-mode size variation",onChange(){Promise.resolve().then(()=>Vn).then(({updateBallSizes:e})=>{e()})}},{id:"sizeVariationCap",label:"Variation Cap",stateKey:"sizeVariationCap",type:"range",min:0,max:.2,step:.01,default:.2,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Max radius deviation from medium (20% = ±20%)",onChange(){Promise.resolve().then(()=>Vn).then(({updateBallSizes:e})=>{e()})}}]},cursor:{title:"Hand",icon:"🖐️",defaultOpen:!1,controls:[{id:"cursorInfluenceRadiusVw",label:"Influence Radius",stateKey:"cursorInfluenceRadiusVw",type:"range",min:0,max:80,step:.5,default:14,format:e=>e.toFixed(1)+"vw",parse:parseFloat,hint:"Universal cursor interaction zone (scales with viewport width)."}]},trail:{title:"Mouse & Trail",icon:"🖐️",defaultOpen:!1,controls:[{id:"cursorSize",label:"Cursor Size",stateKey:"cursorSize",type:"range",min:.1,max:3,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,onChange(){Promise.resolve().then(()=>ri).then(({updateCursorSize:e})=>{e()})}},{id:"mouseTrailEnabled",label:"Trail Enabled",stateKey:"mouseTrailEnabled",type:"checkbox",default:!0},{id:"mouseTrailLength",label:"Trail Length",stateKey:"mouseTrailLength",type:"range",min:4,max:96,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),hint:"Max samples kept (higher = smoother, slightly more work)"},{id:"mouseTrailSize",label:"Trail Size",stateKey:"mouseTrailSize",type:"range",min:.5,max:10,step:.1,default:1.3,format:e=>e.toFixed(1)+"px",parse:parseFloat},{id:"mouseTrailFadeMs",label:"Trail Fade",stateKey:"mouseTrailFadeMs",type:"range",min:40,max:1200,step:10,default:220,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10)},{id:"mouseTrailOpacity",label:"Trail Opacity",stateKey:"mouseTrailOpacity",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat}]},links:{title:"Links",icon:"🔗",defaultOpen:!1,controls:[{id:"linkTextPadding",label:"Text Link Padding",stateKey:"linkTextPadding",type:"range",min:4,max:40,step:1,default:30,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Padding for text links (footer links, CV links)",onChange(e,t){document.documentElement.style.setProperty("--link-text-padding",t+"px"),document.documentElement.style.setProperty("--link-text-margin",-t+"px")}},{id:"linkIconPadding",label:"Icon Link Padding",stateKey:"linkIconPadding",type:"range",min:4,max:40,step:1,default:24,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Padding for icon links (social media icons)",onChange(e,t){document.documentElement.style.setProperty("--link-icon-padding",t+"px"),document.documentElement.style.setProperty("--link-icon-margin",-t+"px")}},{id:"linkColorInfluence",label:"Color Influence",stateKey:"linkColorInfluence",type:"range",min:0,max:1,step:.01,default:1,format:e=>e.toFixed(2),parse:parseFloat,hint:"How much cursor color affects link colors (0 = none, 1 = full)",onChange(e,t){document.documentElement.style.setProperty("--link-color-influence",t+"")}},{id:"linkImpactScale",label:"Impact Scale",stateKey:"linkImpactScale",type:"range",min:.7,max:1,step:.01,default:.95,format:e=>e.toFixed(2),parse:parseFloat,hint:"Scale when link is pressed (lower = more dramatic press)",onChange(e,t){document.documentElement.style.setProperty("--link-impact-scale",t+"")}},{id:"linkImpactBlur",label:"Impact Blur",stateKey:"linkImpactBlur",type:"range",min:0,max:20,step:.5,default:10,format:e=>e.toFixed(1)+"px",parse:parseFloat,hint:"Blur amount when link is pressed (creates depth effect)",onChange(e,t){document.documentElement.style.setProperty("--link-impact-blur",t+"px")}},{id:"linkImpactDuration",label:"Impact Duration",stateKey:"linkImpactDuration",type:"range",min:50,max:300,step:10,default:150,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration of press animation (fast and subtle)",onChange(e,t){document.documentElement.style.setProperty("--link-impact-duration",t+"ms")}}]},scene:{title:"Scene Impact",icon:"🎬",defaultOpen:!1,controls:[{id:"sceneImpactEnabled",label:"Enabled",stateKey:"sceneImpactEnabled",type:"checkbox",default:!0,hint:"If disabled, mode changes will not animate the scene."},{id:"sceneImpactMul",label:"Click Depth",stateKey:"sceneImpactMul",type:"range",min:0,max:.05,step:.001,default:.01,format:e=>e.toFixed(3),parse:parseFloat,hint:"How far the entire scene “presses in” on simulation change.",onChange(e,t){const a=document.getElementById("abs-scene");if(!a)return;const n=e||{},o=+n.sceneImpactMobileMulFactor;a.style.setProperty("--abs-scene-impact-mul",+t*((n.isMobile||n.isMobileViewport)&&Number.isFinite(o)&&o>0?o:1)+"")}},{id:"sceneImpactLogoCompMul",label:"Logo Comp",stateKey:"sceneImpactLogoCompMul",type:"range",min:.25,max:6,step:.05,default:3.6,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"How strongly the logo counter-scales against the scene press (higher = logo feels more “anchored”).",onChange(e,t){const a=document.getElementById("abs-scene");if(!a)return;const n=+t;a.style.setProperty("--abs-scene-impact-logo-comp-mul",(Number.isFinite(n)&&n>0?n:1)+"")}},{id:"sceneImpactMobileMulFactor",label:"Mobile Depth ×",stateKey:"sceneImpactMobileMulFactor",type:"range",min:.25,max:3,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Multiplier applied to Click Depth on mobile-sized viewports.",onChange(e,t){const a=document.getElementById("abs-scene");if(!a)return;const n=e||{},o=+n.sceneImpactMul,i=+t;a.style.setProperty("--abs-scene-impact-mul",(Number.isFinite(o)?o:0)*((n.isMobile||n.isMobileViewport)&&Number.isFinite(i)&&i>0?i:1)+"")}},{id:"sceneImpactPressMs",label:"Press",stateKey:"sceneImpactPressMs",type:"range",min:20,max:300,step:5,default:90,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Press-in duration."},{id:"sceneImpactReleaseMs",label:"Release",stateKey:"sceneImpactReleaseMs",type:"range",min:40,max:1200,step:10,default:310,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Release duration (“bounce out” length)."},{id:"sceneImpactAnticipation",label:"Anticipation",stateKey:"sceneImpactAnticipation",type:"range",min:0,max:.6,step:.01,default:0,format:e=>e.toFixed(2),parse:parseFloat,hint:"Micro pre-pop before the click-in (0 = off)."},{id:"sceneChangeSoundEnabled",label:"Scene Sound",stateKey:"sceneChangeSoundEnabled",type:"checkbox",default:!0,hint:"Plays a soft “pebble-like” tick when switching simulations (only if sound is enabled)."},{id:"sceneChangeSoundIntensity",label:"Scene Sound Intensity",stateKey:"sceneChangeSoundIntensity",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat},{id:"sceneChangeSoundRadius",label:"Scene Sound Pitch",stateKey:"sceneChangeSoundRadius",type:"range",min:6,max:60,step:1,default:18,format:e=>""+Math.round(e),parse:e=>parseInt(e,10),hint:"Higher = lower pitch (maps like “ball size”)."}]},overlay:{title:"Depth & Blur",icon:"🌫️",defaultOpen:!1,controls:[{id:"gateOverlayEnabled",label:"Enabled",stateKey:"gateOverlayEnabled",type:"checkbox",default:!0},{id:"gateOverlayOpacity",label:"White Wash",stateKey:"gateOverlayOpacity",type:"range",min:0,max:.1,step:.001,default:.01,format:e=>e.toFixed(3),parse:parseFloat,onChange(e,t){Promise.resolve().then(()=>fr).then(({updateOverlayOpacity:e})=>{e(t)})}},{id:"gateOverlayTransitionMs",label:"Anim In Speed",stateKey:"gateOverlayTransitionMs",type:"range",min:200,max:1500,step:50,default:800,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration for blur & depth zoom when opening",onChange(e,t){Promise.resolve().then(()=>fr).then(({updateOverlayTransition:e})=>{e(t)})}},{id:"gateOverlayTransitionOutMs",label:"Anim Out Speed",stateKey:"gateOverlayTransitionOutMs",type:"range",min:200,max:1200,step:50,default:600,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration for blur & depth zoom when closing",onChange(e,t){Promise.resolve().then(()=>fr).then(({updateOverlayTransitionOut:e})=>{e(t)})}},{id:"gateOverlayContentDelayMs",label:"Content Delay",stateKey:"gateOverlayContentDelayMs",type:"range",min:0,max:1e3,step:50,default:200,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Wait before showing dialog content",onChange(e,t){Promise.resolve().then(()=>fr).then(({updateGateContentDelay:e})=>{e(t)})}},{id:"gateDepthScale",label:"Depth Scale",stateKey:"gateDepthScale",type:"range",min:.9,max:1,step:.001,default:.96,format:e=>e.toFixed(3),parse:parseFloat,hint:"Scene scale when gate opens (0.9-1.0)",onChange(e,t){Promise.resolve().then(()=>fr).then(({updateGateDepthScale:e})=>{e(t)})}},{id:"gateDepthTranslateY",label:"Depth Shift",stateKey:"gateDepthTranslateY",type:"range",min:0,max:30,step:1,default:8,format:e=>Math.round(e)+"px",parse:parseInt,hint:"Vertical shift when gate opens",onChange(e,t){Promise.resolve().then(()=>fr).then(({updateGateDepthTranslateY:e})=>{e(t)})}},{id:"logoOpacityInactive",label:"Logo Opacity Closed",stateKey:"logoOpacityInactive",type:"range",min:0,max:1,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,hint:"Logo opacity when gate is closed (1 = fully visible)",onChange(e,t){Promise.resolve().then(()=>fr).then(({updateLogoOpacityInactive:e})=>{e(t)})}},{id:"logoOpacityActive",label:"Logo Opacity Open",stateKey:"logoOpacityActive",type:"range",min:0,max:1,step:.05,default:.2,format:e=>e.toFixed(2),parse:parseFloat,hint:"Logo opacity when gate is active (0.2 = more faded)",onChange(e,t){Promise.resolve().then(()=>fr).then(({updateLogoOpacityActive:e})=>{e(t)})}},{id:"logoBlurInactive",label:"Logo Blur Closed",stateKey:"logoBlurInactive",type:"range",min:0,max:20,step:.5,default:0,format:e=>e.toFixed(1)+"px",parse:parseFloat,hint:"Logo blur when gate is closed (0 = sharp)",onChange(e,t){Promise.resolve().then(()=>fr).then(({updateLogoBlurInactive:e})=>{e(t)})}},{id:"logoBlurActive",label:"Logo Blur Open",stateKey:"logoBlurActive",type:"range",min:0,max:30,step:.5,default:12,format:e=>e.toFixed(1)+"px",parse:parseFloat,hint:"Logo blur when gate is active (12px = soft blur)",onChange(e,t){Promise.resolve().then(()=>fr).then(({updateLogoBlurActive:e})=>{e(t)})}}]},colors:{title:"Color & Surface",icon:"🎨",defaultOpen:!1,controls:[{type:"divider",label:"Backgrounds"},{id:"bgLight",label:"Light Mode",stateKey:"bgLight",type:"color",default:"#f5f5f5",hint:"Background color for light mode",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--bg-light",t),!e.isDarkMode){a.style.setProperty("--chrome-bg",t);const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t)}}},{id:"bgDark",label:"Dark Mode",stateKey:"bgDark",type:"color",default:"#0a0a0a",hint:"Background color for dark mode",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--bg-dark",t),e.isDarkMode){a.style.setProperty("--chrome-bg",t);const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t)}}},{type:"divider",label:"Text · Light Mode"},{id:"textColorLight",label:"Primary",stateKey:"textColorLight",type:"color",default:"#161616",hint:"Main text color in light mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-light",t)}},{id:"textColorLightMuted",label:"Muted",stateKey:"textColorLightMuted",type:"color",default:"#2f2f2f",hint:"Secondary/muted text in light mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-light-muted",t)}},{type:"divider",label:"Text · Dark Mode"},{id:"textColorDark",label:"Primary",stateKey:"textColorDark",type:"color",default:"#b3b3b3",hint:"Main text color in dark mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-dark",t)}},{id:"textColorDarkMuted",label:"Muted",stateKey:"textColorDarkMuted",type:"color",default:"#808080",hint:"Secondary/muted text in dark mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-dark-muted",t)}},{type:"divider",label:"Edge Labels"},{id:"edgeLabelColorLight",label:"Light Mode",stateKey:"edgeLabelColorLight",type:"color",default:"#2f2f2f",hint:"Color for the vertical edge labels in light mode",onChange(e,t){document.documentElement.style.setProperty("--edge-label-color-light",t)}},{id:"edgeLabelColorDark",label:"Dark Mode",stateKey:"edgeLabelColorDark",type:"color",default:"#b3b3b3",hint:"Color for the vertical edge labels in dark mode",onChange(e,t){document.documentElement.style.setProperty("--edge-label-color-dark",t)}},{id:"edgeLabelInsetAdjustPx",label:"Inset",stateKey:"edgeLabelInsetAdjustPx",type:"range",min:-120,max:240,step:1,default:0,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Adjusts edge label inset relative to wall. Higher = inward; lower = outward.",onChange(){Promise.resolve().then(()=>Vn).then(e=>{e.applyLayoutCSSVars()})}},{type:"divider",label:"Links"},{id:"linkHoverColor",label:"Hover Accent",stateKey:"linkHoverColor",type:"color",default:"#ff4013",hint:"Link hover color (accent)",onChange(e,t){document.documentElement.style.setProperty("--link-hover-color",t)}},{type:"divider",label:"Logo"},{id:"logoColorLight",label:"Light Mode",stateKey:"logoColorLight",type:"color",default:"#161616",hint:"Logo color in light mode",onChange(e,t){document.documentElement.style.setProperty("--logo-color-light",t)}},{id:"logoColorDark",label:"Dark Mode",stateKey:"logoColorDark",type:"color",default:"#d5d5d5",hint:"Logo color in dark mode",onChange(e,t){document.documentElement.style.setProperty("--logo-color-dark",t)}},{id:"topLogoWidthVw",label:"Logo Size",stateKey:"topLogoWidthVw",type:"range",min:15,max:45,step:.25,default:35,format:e=>parseFloat(e).toFixed(2)+"vw",parse:parseFloat,hint:"Top-center logo width (clamped by min/max tokens).",onChange(e,t){document.documentElement.style.setProperty("--top-logo-width-vw",t+"")}},{id:"homeMainLinksBelowLogoPx",label:"Links Offset",stateKey:"homeMainLinksBelowLogoPx",type:"range",min:-120,max:240,step:1,default:40,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Index: move the main links up/down below the logo.",onChange(e,t){document.documentElement.style.setProperty("--home-main-links-below-logo-px",t+"")}},{type:"divider",label:"Portfolio Logo"},{id:"portfolioLogoColorLight",label:"Light Mode",stateKey:"portfolioLogoColorLight",type:"color",default:"#161616",hint:"Portfolio logo color in light mode (separate from index)",onChange(e,t){document.documentElement.style.setProperty("--portfolio-logo-color-light",t)}},{id:"portfolioLogoColorDark",label:"Dark Mode",stateKey:"portfolioLogoColorDark",type:"color",default:"#d5d5d5",hint:"Portfolio logo color in dark mode (separate from index)",onChange(e,t){document.documentElement.style.setProperty("--portfolio-logo-color-dark",t)}}]},colorDistribution:{title:"Palette Mix",icon:"🧩",defaultOpen:!1,controls:[{id:"colorDistribution",label:"Disciplines",stateKey:"colorDistribution",type:"colorDistribution",labels:["AI Integration","UI/UX Design","Creative Strategy","Frontend Development","Brand Identity","3D Design","Art Direction"],hint:"Assign each discipline to a palette color, then set weights that sum to 100%. Used for all ball spawns across modes."}]},wall:{title:"WALL",icon:"🫧",defaultOpen:!1,controls:[{id:"frameColorLight",label:"Color · Light Mode",stateKey:"frameColorLight",type:"color",default:"#0a0a0a",hint:"Wall color in light mode (also used for browser chrome)",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--frame-color-light",t),!e.isDarkMode){const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t),a.style.setProperty("--chrome-bg",t)}Promise.resolve().then(()=>Mi).then(e=>{e.syncChromeColor()})}},{id:"frameColorDark",label:"Color · Dark Mode",stateKey:"frameColorDark",type:"color",default:"#0a0a0a",hint:"Wall color in dark mode (also used for browser chrome)",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--frame-color-dark",t),e.isDarkMode){const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t),a.style.setProperty("--chrome-bg",t)}Promise.resolve().then(()=>Mi).then(e=>{e.syncChromeColor()})}},{id:"wallPreset",label:"Wall Preset",stateKey:"wallPreset",type:"select",options:Object.entries(Wn).map(([e,t])=>({value:e,label:t?.label?t.label:e})),default:"pudding",format:e=>e+"",onChange(e,t){((e,t)=>{Wn[e]&&(t.wallPreset=e)})(t+"",e),sa({runOnChange:!1});try{Lo?.reset?.()}catch(a){}try{const t=Array.isArray(e?.balls)?e.balls:[];for(let e=0;t.length>e;e++)t[e]?.wake?.()}catch(a){}try{const e=document.getElementById("wallPresetSlider");e&&"function"==typeof e.blur?e.blur():document.activeElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()}catch(a){}},hint:"Curated wall “types” that set multiple wall sliders at once."},{id:"wallThicknessVw",label:"Wall Thickness",stateKey:"wallThicknessVw",type:"range",min:0,max:8,step:.1,default:1.3,format:e=>e.toFixed(1)+"vw",parse:parseFloat,hint:"Wall tube thickness (content padding is layout-only)",onChange(){Promise.resolve().then(()=>Vn).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars(),Promise.resolve().then(()=>fr).then(({updateBlurFromWallThickness:e})=>{e()})})}},{id:"wallRadiusVw",label:"Corner Radius",stateKey:"wallRadiusVw",type:"range",min:0,max:12,step:.1,default:3.7,format:e=>e.toFixed(1)+"vw",parse:parseFloat,onChange(){Promise.resolve().then(()=>Vn).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars()})}},{id:"wallInset",label:"Collision Inset",stateKey:"wallInset",type:"range",min:0,max:20,step:1,default:2,format:e=>e+"px",parse:e=>parseInt(e,10),hint:"Physics padding inside the visual wall"},{id:"mobileWallThicknessXFactor",label:"Mobile L/R Thickness",stateKey:"mobileWallThicknessXFactor",type:"range",min:.5,max:3,step:.05,default:1.4,format:e=>e.toFixed(2)+"×",parse:parseFloat,hint:"Wall thickness multiplier for LEFT/RIGHT sides on mobile",onChange(){Promise.resolve().then(()=>Vn).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars()})}},{id:"mobileEdgeLabelsVisible",label:"Mobile Edge Labels",stateKey:"mobileEdgeLabelsVisible",type:"toggle",default:!0,hint:"Show side edge labels on mobile (chapter/copyright)",onChange(){Promise.resolve().then(()=>Vn).then(e=>{e.applyLayoutCSSVars()})}},{id:"mobileEdgeLabelSizeFactor",label:"Mobile Label Size",stateKey:"mobileEdgeLabelSizeFactor",type:"range",min:.3,max:2,step:.05,default:.85,format:e=>e.toFixed(2)+"×",parse:parseFloat,hint:"Font size multiplier for edge labels on mobile",onChange(){Promise.resolve().then(()=>Vn).then(e=>{e.applyLayoutCSSVars()})}},{id:"mobileEdgeLabelOpacity",label:"Mobile Label Opacity",stateKey:"mobileEdgeLabelOpacity",type:"range",min:0,max:1,step:.05,default:.5,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,hint:"Opacity for edge labels on mobile",onChange(){Promise.resolve().then(()=>Vn).then(e=>{e.applyLayoutCSSVars()})}},{id:"wallWobbleMaxDeform",label:"Deformation",stateKey:"wallWobbleMaxDeform",type:"range",min:10,max:150,step:5,default:60,format:e=>e+"px",parse:e=>parseInt(e,10),group:"Wall Material",groupLayout:"grid-2col",hint:"Max flex distance. Low = rigid, High = soft"},{id:"wallWobbleStiffness",label:"Stiffness",stateKey:"wallWobbleStiffness",type:"range",min:50,max:3e3,step:10,default:120,format:e=>e+"",parse:e=>parseInt(e,10),group:"Wall Material",hint:"Spring strength. Low = soft, High = firm"},{id:"restitution",label:"Bounce",stateKey:"restitution",type:"range",min:.3,max:.95,step:.05,default:.7,format:e=>Math.round(100*e)+"%",parse:parseFloat,group:"Wall Material",hint:"Energy kept on bounce. 100% = elastic, 30% = soft"},{id:"wallWobbleDamping",label:"Damping",stateKey:"wallWobbleDamping",type:"range",min:0,max:80,step:1,default:35,format:e=>e+"",parse:e=>parseInt(e,10),group:"Wall Material",hint:"Oscillation decay. High = viscous/slow"},{id:"wallWobbleSigma",label:"Impact Spread",stateKey:"wallWobbleSigma",type:"range",min:.5,max:6,step:.1,default:2,format:e=>e.toFixed(1),parse:parseFloat,group:"Wall Material",hint:"Blob size. High = pudding, Low = rubber"},{id:"wallWobbleSettlingSpeed",label:"Settle Speed",stateKey:"wallWobbleSettlingSpeed",type:"range",min:0,max:100,step:1,default:75,format:e=>e+"%",parse:e=>parseInt(e,10),group:"Wall Material",hint:"Snap-to-flat aggression when still"},{id:"wallWobbleCornerClamp",label:"Corner Stiffness",stateKey:"wallWobbleCornerClamp",type:"range",min:0,max:1,step:.01,default:.6,format:e=>e.toFixed(2),parse:parseFloat,group:"Wall Behavior",groupLayout:"grid-2col",groupCollapsed:!0,hint:"1.0 = locked corners, 0 = flexible corners"},{id:"wallWobbleImpactThreshold",label:"Impact Gate",stateKey:"wallWobbleImpactThreshold",type:"range",min:20,max:200,step:1,default:140,format:e=>e+" px/s",parse:e=>parseInt(e,10),group:"Wall Behavior",hint:"Min impact speed to trigger deformation"},{id:"wallWobbleMaxVel",label:"Max Wall Speed",stateKey:"wallWobbleMaxVel",type:"range",min:100,max:2e3,step:10,default:800,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Performance Caps",groupLayout:"grid-2col",groupCollapsed:!0,hint:"Velocity cap to prevent erratic spikes"},{id:"wallWobbleMaxImpulse",label:"Max Impulse",stateKey:"wallWobbleMaxImpulse",type:"range",min:20,max:600,step:5,default:220,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Performance Caps",hint:"Per-sample impact cap for smoother behavior"},{id:"wallWobbleMaxEnergyPerStep",label:"Max Energy/Tick",stateKey:"wallWobbleMaxEnergyPerStep",type:"range",min:1e3,max:8e4,step:500,default:2e4,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Performance Caps",hint:"Safety budget to prevent runaway spikes"},{id:"wallPhysicsSamples",label:"Physics Samples",stateKey:"wallPhysicsSamples",type:"range",min:8,max:96,step:1,default:48,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Performance",groupCollapsed:!0,hint:"Visual-only. Lower = faster, higher = smoother blobs."},{id:"wallPhysicsSkipInactive",label:"Skip When Still",stateKey:"wallPhysicsSkipInactive",type:"toggle",default:!0,group:"Performance",hint:"Stops integrating the wall when it's already at rest."},{id:"wallRenderDecimation",label:"Render Detail",stateKey:"wallRenderDecimation",type:"range",min:1,max:12,step:1,default:2,format:e=>""+Math.round(e),parse:e=>parseInt(e,10),group:"Performance",hint:"1=ultra smooth, 2=default, 4=faster, 12=very fast/polygonal (rendering only)."}]},noise:{title:"Grain",icon:"🧂",defaultOpen:!1,controls:[{id:"noiseEnabled",label:"Enabled",stateKey:"noiseEnabled",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,group:"Render",hint:"Procedural noise texture (no GIF).",onChange:(e,t)=>qt({noiseEnabled:t})},{id:"noiseSeed",label:"Seed",stateKey:"noiseSeed",type:"range",min:0,max:999999,step:1,default:1337,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Texture",hint:"Changes the generated grain pattern.",onChange:(e,t)=>qt({noiseSeed:t})},{id:"noiseTextureSize",label:"Tile Size",stateKey:"noiseTextureSize",type:"range",min:64,max:512,step:32,default:256,format:e=>Math.round(e)+" px",parse:e=>parseInt(e,10),group:"Texture",hint:"Bigger tiles reduce repetition but cost more memory.",onChange:(e,t)=>qt({noiseTextureSize:t})},{id:"noiseDistribution",label:"Distribution",stateKey:"noiseDistribution",type:"select",options:[{value:"gaussian",label:"Gaussian (filmic)"},{value:"uniform",label:"Uniform (flat)"}],default:"gaussian",format:e=>e+"",parse:e=>e+"",group:"Texture",onChange:(e,t)=>qt({noiseDistribution:t})},{id:"noiseMonochrome",label:"Monochrome",stateKey:"noiseMonochrome",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,group:"Texture",hint:"Off = subtle RGB grain.",onChange:(e,t)=>qt({noiseMonochrome:t})},{id:"noiseChroma",label:"Chroma",stateKey:"noiseChroma",type:"range",min:0,max:1,step:.01,default:.35,format:e=>Math.round(100*e)+"%",parse:parseFloat,group:"Texture",hint:"How different R/G/B channels are (ignored when Monochrome is on).",onChange:(e,t)=>qt({noiseChroma:t})},{id:"noiseSizeBase",label:"Back Scale",stateKey:"noiseSizeBase",type:"range",min:20,max:400,step:5,default:100,format:e=>Math.round(e)+" px",parse:e=>parseInt(e,10),group:"Layers",onChange:(e,t)=>qt({noiseSizeBase:t})},{id:"noiseSizeTop",label:"Front Scale",stateKey:"noiseSizeTop",type:"range",min:20,max:600,step:5,default:150,format:e=>Math.round(e)+" px",parse:e=>parseInt(e,10),group:"Layers",onChange:(e,t)=>qt({noiseSizeTop:t})},{id:"noiseTopOpacity",label:"Top Opacity",stateKey:"noiseTopOpacity",type:"range",min:0,max:.25,step:.005,default:.01,format:e=>e.toFixed(3),parse:parseFloat,group:"Layers",hint:"Extra subtle layer (used by .noise-3).",onChange:(e,t)=>qt({noiseTopOpacity:t})},{id:"noiseBackOpacity",label:"Back Opacity (Light)",stateKey:"noiseBackOpacity",type:"range",min:0,max:.3,step:.005,default:.025,format:e=>e.toFixed(3),parse:parseFloat,group:"Layers",onChange:(e,t)=>qt({noiseBackOpacity:t})},{id:"noiseFrontOpacity",label:"Front Opacity (Light)",stateKey:"noiseFrontOpacity",type:"range",min:0,max:.3,step:.005,default:.055,format:e=>e.toFixed(3),parse:parseFloat,group:"Layers",onChange:(e,t)=>qt({noiseFrontOpacity:t})},{id:"noiseBackOpacityDark",label:"Back Opacity (Dark)",stateKey:"noiseBackOpacityDark",type:"range",min:0,max:.5,step:.005,default:.12,format:e=>e.toFixed(3),parse:parseFloat,group:"Layers",onChange:(e,t)=>qt({noiseBackOpacityDark:t})},{id:"noiseFrontOpacityDark",label:"Front Opacity (Dark)",stateKey:"noiseFrontOpacityDark",type:"range",min:0,max:.5,step:.005,default:.08,format:e=>e.toFixed(3),parse:parseFloat,group:"Layers",onChange:(e,t)=>qt({noiseFrontOpacityDark:t})},{id:"noiseMotion",label:"Motion",stateKey:"noiseMotion",type:"select",options:[{value:"jitter",label:"Jitter (film grain)"},{value:"drift",label:"Drift (slow pan)"},{value:"static",label:"Static"}],default:"jitter",format:e=>e+"",parse:e=>e+"",group:"Motion",onChange:(e,t)=>qt({noiseMotion:t})},{id:"noiseMotionAmount",label:"Motion Amount",stateKey:"noiseMotionAmount",type:"range",min:0,max:2.5,step:.01,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,group:"Motion",onChange:(e,t)=>qt({noiseMotionAmount:t})},{id:"noiseSpeedBackMs",label:"Back Speed",stateKey:"noiseSpeedBackMs",type:"range",min:0,max:1e4,step:50,default:1800,format:e=>Math.round(e)+" ms",parse:e=>parseInt(e,10),group:"Motion",onChange:(e,t)=>qt({noiseSpeedBackMs:t})},{id:"noiseSpeedFrontMs",label:"Front Speed",stateKey:"noiseSpeedFrontMs",type:"range",min:0,max:1e4,step:50,default:1100,format:e=>Math.round(e)+" ms",parse:e=>parseInt(e,10),group:"Motion",onChange:(e,t)=>qt({noiseSpeedFrontMs:t})},{id:"noiseFlicker",label:"Flicker",stateKey:"noiseFlicker",type:"range",min:0,max:1,step:.01,default:.12,format:e=>Math.round(100*e)+"%",parse:parseFloat,group:"Motion",onChange:(e,t)=>qt({noiseFlicker:t})},{id:"noiseFlickerSpeedMs",label:"Flicker Speed",stateKey:"noiseFlickerSpeedMs",type:"range",min:0,max:5e3,step:20,default:220,format:e=>Math.round(e)+" ms",parse:e=>parseInt(e,10),group:"Motion",onChange:(e,t)=>qt({noiseFlickerSpeedMs:t})},{id:"noiseBlurPx",label:"Blur",stateKey:"noiseBlurPx",type:"range",min:0,max:6,step:.05,default:0,format:e=>e.toFixed(2)+" px",parse:parseFloat,group:"Look",onChange:(e,t)=>qt({noiseBlurPx:t})},{id:"noiseContrast",label:"Contrast",stateKey:"noiseContrast",type:"range",min:.25,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"x",parse:parseFloat,group:"Look",onChange:(e,t)=>qt({noiseContrast:t})},{id:"noiseBrightness",label:"Brightness",stateKey:"noiseBrightness",type:"range",min:.25,max:2,step:.01,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,group:"Look",onChange:(e,t)=>qt({noiseBrightness:t})},{id:"noiseSaturation",label:"Saturation",stateKey:"noiseSaturation",type:"range",min:0,max:3,step:.01,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,group:"Look",onChange:(e,t)=>qt({noiseSaturation:t})},{id:"noiseHue",label:"Hue Rotate",stateKey:"noiseHue",type:"range",min:0,max:360,step:1,default:0,format:e=>Math.round(e)+"°",parse:e=>parseInt(e,10),group:"Look",onChange:(e,t)=>qt({noiseHue:t})}]},critters:{title:"Critters",icon:"🪲",mode:"critters",defaultOpen:!1,controls:[{id:"critterCount",label:"Count",stateKey:"critterCount",type:"range",min:10,max:260,step:5,default:90,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"critterSpeed",label:"Speed",stateKey:"critterSpeed",type:"range",min:0,max:1800,step:10,default:680,format:e=>""+Math.round(e),parse:parseFloat},{id:"critterMaxSpeed",label:"Max Speed",stateKey:"critterMaxSpeed",type:"range",min:200,max:4e3,step:25,default:1400,format:e=>""+Math.round(e),parse:parseFloat},{id:"critterStepHz",label:"Step Rate",stateKey:"critterStepHz",type:"range",min:0,max:16,step:.1,default:5,format:e=>e.toFixed(1)+" Hz",parse:parseFloat},{id:"critterStepSharpness",label:"Step Sharpness",stateKey:"critterStepSharpness",type:"range",min:.5,max:6,step:.1,default:2.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnNoise",label:"Wander",stateKey:"critterTurnNoise",type:"range",min:0,max:8,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnDamp",label:"Turn Inertia",stateKey:"critterTurnDamp",type:"range",min:.5,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnSeek",label:"Steering",stateKey:"critterTurnSeek",type:"range",min:0,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterAvoidRadius",label:"Avoid Radius",stateKey:"critterAvoidRadius",type:"range",min:0,max:260,step:5,default:90,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"critterAvoidForce",label:"Avoid Force",stateKey:"critterAvoidForce",type:"range",min:0,max:25e3,step:250,default:9500,format:e=>Math.round(e)+"",parse:parseFloat},{id:"critterEdgeAvoid",label:"Edge Avoid",stateKey:"critterEdgeAvoid",type:"range",min:0,max:3,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat},{id:"critterMousePull",label:"Mouse Fear",stateKey:"critterMousePull",type:"range",min:0,max:4,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Flee strength inside the mouse zone"},{id:"critterMouseRadiusVw",label:"Mouse Zone",stateKey:"critterMouseRadiusVw",type:"range",min:0,max:80,step:1,default:30,format:e=>Math.round(e)+"vw",parse:parseFloat},{id:"critterRestitution",label:"Bounciness",stateKey:"critterRestitution",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat,hint:"Mode-only override",onChange(e,t){"critters"===e.currentMode&&(e.REST=t)}},{id:"critterFriction",label:"Friction",stateKey:"critterFriction",type:"range",min:0,max:.06,step:.001,default:.018,format:e=>e.toFixed(3),parse:parseFloat,hint:"Mode-only override",onChange(e,t){"critters"===e.currentMode&&(e.FRICTION=t)}},ea("crittersWarmupFrames")]},pit:{title:"Ball Pit",icon:"🎯",mode:"pit",defaultOpen:!1,controls:[{id:"gravityPit",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange(e,t){"pit"===e.currentMode&&(e.G=e.GE*t)}},{id:"repelPower",label:"Repel Power",stateKey:"repelPower",type:"range",min:0,max:1e4,step:100,default:8500,format:e=>""+Math.round(e),parse:parseFloat,onChange(e,t){e.repelPower=24e3*Math.pow(2,12*(Math.max(0,Math.min(1e4,t))/1e4-.5))}},{id:"sleepVelocityThreshold",label:"Sleep Speed",stateKey:"sleepVelocityThreshold",type:"range",min:0,max:40,step:.5,default:12,format:e=>(+e).toFixed(1)+" px/s",parse:parseFloat,hint:"Pit modes only. Higher = settles sooner."},{id:"sleepAngularThreshold",label:"Sleep Spin",stateKey:"sleepAngularThreshold",type:"range",min:0,max:1,step:.01,default:.18,format:e=>(+e).toFixed(2)+" rad/s",parse:parseFloat,hint:"Pit modes only. Higher = stops spinning sooner."},{id:"timeToSleep",label:"Sleep Time",stateKey:"timeToSleep",type:"range",min:.05,max:2,step:.05,default:.25,format:e=>(+e).toFixed(2)+"s",parse:parseFloat,hint:"Pit modes only. Lower = sleeps faster."},ea("pitWarmupFrames")]},pitThrows:{title:"Ball Pit (Throws)",icon:"🎯",mode:"pit-throws",defaultOpen:!1,controls:[{id:"gravityPitThrows",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange(e,t){"pit-throws"===e.currentMode&&(e.G=e.GE*t)}},{id:"pitThrowsSpeed",label:"Throw Speed",stateKey:"pitThrowSpeed",type:"range",min:100,max:2e3,step:25,default:650,format:e=>Math.round(e)+"",parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpeedVar",label:"Speed Variance",stateKey:"pitThrowSpeedVar",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},{id:"sleepVelocityThresholdThrows",label:"Sleep Speed",stateKey:"sleepVelocityThreshold",type:"range",min:0,max:40,step:.5,default:12,format:e=>(+e).toFixed(1)+" px/s",parse:parseFloat,hint:"Pit modes only. Higher = settles sooner."},{id:"sleepAngularThresholdThrows",label:"Sleep Spin",stateKey:"sleepAngularThreshold",type:"range",min:0,max:1,step:.01,default:.18,format:e=>(+e).toFixed(2)+" rad/s",parse:parseFloat,hint:"Pit modes only. Higher = stops spinning sooner."},{id:"timeToSleepThrows",label:"Sleep Time",stateKey:"timeToSleep",type:"range",min:.05,max:2,step:.05,default:.25,format:e=>(+e).toFixed(2)+"s",parse:parseFloat,hint:"Pit modes only. Lower = sleeps faster."},{id:"pitThrowsInterval",label:"Throw Interval",stateKey:"pitThrowIntervalMs",type:"range",min:10,max:500,step:5,default:70,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsColorPause",label:"Color Pause",stateKey:"pitThrowColorPauseMs",type:"range",min:0,max:1200,step:10,default:180,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsPairChance",label:"Pair Chance",stateKey:"pitThrowPairChance",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsPairStagger",label:"Pair Stagger",stateKey:"pitThrowPairStaggerMs",type:"range",min:0,max:120,step:1,default:18,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsBatchSize",label:"Batch Size",stateKey:"pitThrowBatchSize",type:"range",min:1,max:60,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"pitThrowsTargetYFrac",label:"Throw Aim (Y)",stateKey:"pitThrowTargetYFrac",type:"range",min:.12,max:.7,step:.01,default:.36,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAngleJitter",label:"Angle Jitter",stateKey:"pitThrowAngleJitter",type:"range",min:0,max:.6,step:.01,default:.16,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpreadVar",label:"Spread Variance",stateKey:"pitThrowSpreadVar",type:"range",min:0,max:.8,step:.01,default:.25,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsSpeedJitter",label:"Speed Jitter",stateKey:"pitThrowSpeedJitter",type:"range",min:0,max:.8,step:.01,default:.22,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsInletInset",label:"Inlet Inset",stateKey:"pitThrowInletInset",type:"range",min:0,max:.2,step:.005,default:.06,format:e=>e.toFixed(3),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpawnSpread",label:"Spawn Spread",stateKey:"pitThrowSpawnSpread",type:"range",min:0,max:.12,step:.0025,default:.02,format:e=>e.toFixed(4),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAimJitter",label:"Aim Jitter",stateKey:"pitThrowAimJitter",type:"range",min:0,max:.2,step:.005,default:.04,format:e=>e.toFixed(3),parse:parseFloat},{id:"pitThrowsCrossBias",label:"Cross Aim",stateKey:"pitThrowCrossBias",type:"range",min:0,max:.3,step:.005,default:.12,format:e=>e.toFixed(3),parse:parseFloat},ea("pitThrowsWarmupFrames")]},flies:{title:"Flies",icon:"🕊️",mode:"flies",defaultOpen:!1,controls:[{id:"fliesBallCount",label:"Ball Count",stateKey:"fliesBallCount",type:"range",min:20,max:150,step:5,default:60,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"attractPower",label:"Attraction",stateKey:"attractionPower",type:"range",min:100,max:8e3,step:50,default:5e3,format:e=>""+Math.round(e),parse:parseFloat},{id:"swarmSpeed",label:"Swarm Speed",stateKey:"swarmSpeed",type:"range",min:.2,max:5,step:.1,default:.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"fliesSeparation",label:"Separation",stateKey:"fliesSeparation",type:"range",min:5e3,max:3e4,step:1e3,default:15e3,format:e=>""+Math.round(e),parse:parseFloat},ea("fliesWarmupFrames")]},weightless:{title:"Zero-G",icon:"🌌",mode:"weightless",defaultOpen:!1,controls:[{id:"weightlessCount",label:"Ball Count",stateKey:"weightlessCount",type:"range",min:20,max:200,step:10,default:80,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"weightlessSpeed",label:"Initial Speed",stateKey:"weightlessInitialSpeed",type:"range",min:100,max:600,step:25,default:250,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"weightlessBounce",label:"Bounce",stateKey:"weightlessBounce",type:"range",min:.5,max:1,step:.05,default:.95,format:e=>e.toFixed(2),parse:parseFloat},{id:"weightlessRepelPower",label:"Cursor Blast Power",stateKey:"weightlessRepelPower",type:"range",min:0,max:6e5,step:1e4,default:22e4,format:e=>""+Math.round(e),parse:parseFloat},{id:"weightlessRepelSoft",label:"Cursor Blast Falloff",stateKey:"weightlessRepelSoft",type:"range",min:.5,max:6,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},ea("weightlessWarmupFrames")]},water:{title:"Water",icon:"🌊",mode:"water",defaultOpen:!1,controls:[{id:"waterBallCount",label:"Ball Count",stateKey:"waterBallCount",type:"range",min:50,max:400,step:10,default:300,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"waterDrag",label:"Water Resistance",stateKey:"waterDrag",type:"range",min:.001,max:.05,step:.001,default:.015,format:e=>e.toFixed(3),parse:parseFloat},{id:"waterRippleStrength",label:"Ripple Strength",stateKey:"waterRippleStrength",type:"range",min:5e3,max:3e4,step:1e3,default:18e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"waterMotion",label:"Drift Strength",stateKey:"waterDriftStrength",type:"range",min:0,max:80,step:1,default:40,format:e=>e.toFixed(0),parse:parseFloat,onChange(e,t){e.waterInitialVelocity=5*t},reinitMode:!0},ea("waterWarmupFrames")]},vortex:{title:"Vortex",icon:"🌀",mode:"vortex",defaultOpen:!1,controls:[{id:"vortexBallCount",label:"Ball Count",stateKey:"vortexBallCount",type:"range",min:50,max:500,step:10,default:180,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"vortexSwirl",label:"Swirl Strength",stateKey:"vortexSwirlStrength",type:"range",min:100,max:3e3,step:50,default:420,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexPull",label:"Radial Pull",stateKey:"vortexRadialPull",type:"range",min:0,max:2e3,step:20,default:180,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexSpeedMultiplier",label:"Speed Multiplier",stateKey:"vortexSpeedMultiplier",type:"range",min:.1,max:3,step:.1,default:1,format:e=>e.toFixed(1),parse:parseFloat},{id:"vortexRadius",label:"Vortex Radius",stateKey:"vortexRadius",type:"range",min:0,max:800,step:20,default:0,format:e=>0===e?"Unlimited":e.toFixed(0)+"px",parse:parseFloat,tooltip:"Maximum effective radius (0 = unlimited, uses distance falloff)"},{id:"vortexFalloffCurve",label:"Falloff Curve",stateKey:"vortexFalloffCurve",type:"range",min:.3,max:3,step:.1,default:1,format:e=>e.toFixed(1),parse:parseFloat,tooltip:"Falloff shape: 1.0 = linear, 2.0 = quadratic (sharper), 0.5 = gentle"},{id:"vortexRotationDirection",label:"Rotation Direction",stateKey:"vortexRotationDirection",type:"range",min:-1,max:1,step:2,default:1,format:e=>1===e?"Counterclockwise":"Clockwise",parse:parseFloat},{id:"vortexCoreStrength",label:"Core Strength",stateKey:"vortexCoreStrength",type:"range",min:.5,max:3,step:.1,default:1,format:e=>e.toFixed(1)+"x",parse:parseFloat,tooltip:"Strength multiplier at vortex center"},{id:"vortexAccelerationZone",label:"Acceleration Zone",stateKey:"vortexAccelerationZone",type:"range",min:0,max:400,step:20,default:0,format:e=>0===e?"Disabled":e.toFixed(0)+"px",parse:parseFloat,tooltip:"Radius where extra acceleration occurs (0 = disabled)"},{id:"vortexOutwardPush",label:"Outward Push",stateKey:"vortexOutwardPush",type:"range",min:0,max:1e3,step:20,default:0,format:e=>0===e?"Disabled":e.toFixed(0),parse:parseFloat,tooltip:"Outward force at edges (only when radius is set)"},{id:"vortexDrag",label:"Drag",stateKey:"vortexDrag",type:"range",min:.001,max:.05,step:.001,default:.005,format:e=>e.toFixed(3),parse:parseFloat},ea("vortexWarmupFrames")]},"ping-pong":{title:"Ping Pong",icon:"🏓",mode:"ping-pong",defaultOpen:!1,controls:[{id:"pingPongBallCount",label:"Ball Count",stateKey:"pingPongBallCount",type:"range",min:10,max:100,step:5,default:35,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"pingPongSpeed",label:"Ball Speed",stateKey:"pingPongSpeed",type:"range",min:200,max:1600,step:50,default:800,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"pingPongVerticalDamp",label:"Vertical Damping",stateKey:"pingPongVerticalDamp",type:"range",min:.8,max:.999,step:.001,default:.995,format:e=>e.toFixed(3),parse:parseFloat},ea("pingPongWarmupFrames")]},magnetic:{title:"Magnetic",icon:"🧲",mode:"magnetic",defaultOpen:!1,controls:[{id:"magneticBallCount",label:"Ball Count",stateKey:"magneticBallCount",type:"range",min:50,max:300,step:10,default:180,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"magneticStrength",label:"Strength",stateKey:"magneticStrength",type:"range",min:1e4,max:1e5,step:5e3,default:65e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticVelocity",label:"Max Velocity",stateKey:"magneticMaxVelocity",type:"range",min:500,max:4e3,step:100,default:2800,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticDamping",label:"Damping",stateKey:"magneticDamping",type:"range",min:.8,max:.999,step:.001,default:.98,format:e=>e.toFixed(3),parse:parseFloat},ea("magneticWarmupFrames")]},bubbles:{title:"Bubbles",icon:"🫧",mode:"bubbles",defaultOpen:!1,controls:[{id:"bubblesRate",label:"Bubble Rate",stateKey:"bubblesSpawnRate",type:"range",min:1,max:20,step:1,default:8,format:e=>e+"",parse:e=>parseInt(e,10)},{id:"bubblesSpeed",label:"Rise Speed",stateKey:"bubblesRiseSpeed",type:"range",min:50,max:400,step:25,default:150,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesWobble",label:"Wobble",stateKey:"bubblesWobble",type:"range",min:0,max:100,step:5,default:40,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesMax",label:"Max Bubbles",stateKey:"bubblesMaxCount",type:"range",min:50,max:300,step:10,default:150,format:e=>e+"",parse:e=>parseInt(e,10)},ea("bubblesWarmupFrames")]},tilt:{title:"Tilt",icon:"⚖️",mode:"tilt",defaultOpen:!1,controls:[{id:"tiltBallCount",label:"Particle Count",stateKey:"tiltBallCount",type:"range",min:100,max:500,step:10,default:300,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"tiltMaxAngle",label:"Max Angle",stateKey:"tiltMaxAngle",type:"range",min:.5,max:10,step:.5,default:2,format:e=>e.toFixed(1)+"°",parse:parseFloat},{id:"tiltLerpSpeed",label:"Smoothness",stateKey:"tiltLerpSpeed",type:"range",min:.01,max:.5,step:.01,default:.08,format:e=>e.toFixed(2),parse:parseFloat},{id:"tiltGlassMass",label:"Particle Mass",stateKey:"tiltGlassBallMass",type:"range",min:.02,max:.3,step:.01,default:.08,format:e=>e.toFixed(2)+"x",parse:parseFloat,reinitMode:!0},{id:"tiltFriction",label:"Friction",stateKey:"tiltFriction",type:"range",min:.002,max:.02,step:.001,default:.008,format:e=>e.toFixed(3),parse:parseFloat}]},kaleidoscope:{title:"Kaleidoscope",icon:"🪞",mode:"kaleidoscope",defaultOpen:!1,controls:[{id:"kaleiBallCount",label:"Ball Count",stateKey:"kaleidoscopeBallCount",type:"range",min:15,max:120,step:1,default:23,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kaleiWedges",label:"Wedges",stateKey:"kaleidoscopeWedges",type:"range",min:4,max:16,step:1,default:12,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kaleiMirror",label:"Mirror",type:"range",min:0,max:1,step:1,default:1,format:e=>e?"On":"Off",parse:e=>parseInt(e,10)},{id:"kaleiSpeed",label:"Speed",stateKey:"kaleidoscopeSpeed",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat},{id:"kaleiDotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscopeDotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kaleiDotAreaMul",label:"Dot Area",stateKey:"kaleidoscopeDotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kaleiSpawnArea",label:"Spawn Density",stateKey:"kaleidoscopeSpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kaleiSizeVar",label:"Size Variance",stateKey:"kaleidoscopeSizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},ea("kaleidoscopeWarmupFrames")]},kaleidoscope1:{title:"Kaleidoscope I (Variant)",icon:"🪞",mode:"kaleidoscope-1",defaultOpen:!1,controls:[{id:"kalei1BallCount",label:"Ball Count",stateKey:"kaleidoscope1BallCount",type:"range",min:6,max:180,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei1Wedges",label:"Wedges",stateKey:"kaleidoscope1Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei1Speed",label:"Speed",stateKey:"kaleidoscope1Speed",type:"range",min:.2,max:2,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei1DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope1DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei1DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope1DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei1SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope1SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei1SizeVar",label:"Size Variance",stateKey:"kaleidoscope1SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},ea("kaleidoscope1WarmupFrames")]},kaleidoscope2:{title:"Kaleidoscope II (Variant)",icon:"🪞",mode:"kaleidoscope-2",defaultOpen:!1,controls:[{id:"kalei2BallCount",label:"Ball Count",stateKey:"kaleidoscope2BallCount",type:"range",min:10,max:260,step:2,default:36,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei2Wedges",label:"Wedges",stateKey:"kaleidoscope2Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei2Speed",label:"Speed",stateKey:"kaleidoscope2Speed",type:"range",min:.2,max:2,step:.05,default:1.15,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei2DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope2DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei2DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope2DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei2SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope2SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei2SizeVar",label:"Size Variance",stateKey:"kaleidoscope2SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},ea("kaleidoscope2WarmupFrames")]},kaleidoscope3:{title:"Kaleidoscope III (Variant)",icon:"🪞",mode:"kaleidoscope-3",defaultOpen:!1,controls:[{id:"kalei3BallCount",label:"Ball Count",stateKey:"kaleidoscope3BallCount",type:"range",min:12,max:300,step:3,default:54,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei3Wedges",label:"Wedges",stateKey:"kaleidoscope3Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei3Speed",label:"Speed",stateKey:"kaleidoscope3Speed",type:"range",min:.2,max:2,step:.05,default:1.55,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei3DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope3DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei3DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope3DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei3SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope3SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei3SizeVar",label:"Size Variance",stateKey:"kaleidoscope3SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},ea("kaleidoscope3WarmupFrames")]},orbit3d:{title:"Orbit 3D: Zero Gravity",icon:"🌪️",mode:"orbit-3d",defaultOpen:!1,controls:[{id:"orbit3dMoonCount",label:"Body Count",stateKey:"orbit3dMoonCount",type:"range",min:10,max:200,step:10,default:80,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"orbit3dGravity",label:"Gravity Pull",stateKey:"orbit3dGravity",type:"range",min:1e3,max:1e4,step:500,default:5e3,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3dVelocityMult",label:"Orbital Speed",stateKey:"orbit3dVelocityMult",type:"range",min:50,max:300,step:10,default:150,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3dDepthScale",label:"Depth Effect",stateKey:"orbit3dDepthScale",type:"range",min:0,max:1.5,step:.1,default:.8,format:e=>e.toFixed(1),parse:parseFloat},{id:"orbit3dDamping",label:"Stability",stateKey:"orbit3dDamping",type:"range",min:.005,max:.05,step:.005,default:.02,format:e=>e.toFixed(3),parse:parseFloat},{id:"sizeVariationOrbit3d",label:"Size Variation",stateKey:"sizeVariationOrbit3d",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},ea("orbit3dWarmupFrames")]},orbit3d2:{title:"Orbit 3D (Tight Swarm)",icon:"🌪️",mode:"orbit-3d-2",defaultOpen:!1,controls:[{id:"orbit3d2MoonCount",label:"Moon Count",stateKey:"orbit3d2MoonCount",type:"range",min:20,max:200,step:10,default:100,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"orbit3d2Gravity",label:"Gravity (G×M)",stateKey:"orbit3d2Gravity",type:"range",min:1e4,max:3e5,step:1e4,default:8e4,format:e=>Math.round(e/1e3)+"k",parse:parseFloat,reinitMode:!0},{id:"orbit3d2VelocityMult",label:"Initial Velocity",stateKey:"orbit3d2VelocityMult",type:"range",min:.5,max:1.5,step:.05,default:1.1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"orbit3d2MinOrbit",label:"Min Orbit (vw)",stateKey:"orbit3d2MinOrbit",type:"range",min:2,max:15,step:1,default:4,format:e=>e+"vw",parse:parseFloat,reinitMode:!0},{id:"orbit3d2MaxOrbit",label:"Max Orbit (vw)",stateKey:"orbit3d2MaxOrbit",type:"range",min:3,max:25,step:1,default:12,format:e=>e+"vw",parse:parseFloat,reinitMode:!0},{id:"orbit3d2DepthScale",label:"Depth Effect",stateKey:"orbit3d2DepthScale",type:"range",min:0,max:.8,step:.05,default:.6,format:e=>e.toFixed(2),parse:parseFloat},{id:"orbit3d2Damping",label:"Damping",stateKey:"orbit3d2Damping",type:"range",min:0,max:.2,step:.005,default:.01,format:e=>e.toFixed(3),parse:parseFloat},{id:"orbit3d2FollowSmoothing",label:"Cursor Follow Speed",stateKey:"orbit3d2FollowSmoothing",type:"range",min:1,max:200,step:1,default:40,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3d2Softening",label:"Gravity Softening",stateKey:"orbit3d2Softening",type:"range",min:1,max:100,step:1,default:15,format:e=>Math.round(e),parse:parseFloat},{id:"sizeVariationOrbit3d2",label:"Size Variation",stateKey:"sizeVariationOrbit3d2",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},ea("orbit3d2WarmupFrames")]},lattice:{title:"Crystal Lattice",icon:"💎",mode:"lattice",defaultOpen:!1,controls:[{id:"sizeVariationLattice",label:"Size Variation",stateKey:"sizeVariationLattice",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"latticeSpacingVw",label:"Spacing (vw)",stateKey:"latticeSpacingVw",type:"range",min:1,max:20,step:.25,default:8.5,format:e=>e.toFixed(2)+"vw",parse:parseFloat,reinitMode:!0},{id:"latticeStiffness",label:"Stiffness",stateKey:"latticeStiffness",type:"range",min:0,max:10,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},{id:"latticeDamping",label:"Damping",stateKey:"latticeDamping",type:"range",min:.5,max:1,step:.01,default:.92,format:e=>e.toFixed(2),parse:parseFloat},{id:"latticeDisruptRadius",label:"Mesh Stretch Radius",stateKey:"latticeDisruptRadius",type:"range",min:50,max:1e3,step:25,default:600,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"latticeDisruptPower",label:"Mesh Stretch Power",stateKey:"latticeDisruptPower",type:"range",min:0,max:50,step:1,default:25,format:e=>e.toFixed(1),parse:parseFloat},{id:"latticeMeshWaveStrength",label:"Wave Amplitude",stateKey:"latticeMeshWaveStrength",type:"range",min:0,max:50,step:1,default:12,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"latticeMeshWaveSpeed",label:"Wave Speed",stateKey:"latticeMeshWaveSpeed",type:"range",min:0,max:3,step:.1,default:.8,format:e=>e.toFixed(1)+"x",parse:parseFloat},{id:"latticeAlignment",label:"Grid Alignment",stateKey:"latticeAlignment",type:"select",options:[{value:"center",label:"Center (Fill)"},{value:"top-left",label:"Top-Left"},{value:"top-center",label:"Top-Center"},{value:"top-right",label:"Top-Right"}],default:"center",format:e=>e+"",parse:e=>e+"",reinitMode:!0},ea("latticeWarmupFrames")]},neural:{title:"Neural Network",icon:"🧠",mode:"neural",defaultOpen:!1,controls:[{id:"neuralBallCount",label:"Ball Count",stateKey:"neuralBallCount",type:"range",min:8,max:260,step:1,default:80,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"sizeVariationNeural",label:"Size Variation",stateKey:"sizeVariationNeural",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"neuralWanderStrength",label:"Wander Strength",stateKey:"neuralWanderStrength",type:"range",min:0,max:2e3,step:10,default:420,format:e=>Math.round(e)+"",parse:parseFloat},{id:"neuralDamping",label:"Damping",stateKey:"neuralDamping",type:"range",min:.8,max:1,step:.005,default:.985,format:e=>e.toFixed(3),parse:parseFloat},{id:"neuralCohesion",label:"Cohesion",stateKey:"neuralCohesion",type:"range",min:0,max:1,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},ea("neuralWarmupFrames")]},parallaxLinear:{title:"Parallax (Linear)",icon:"🫧",mode:"parallax-linear",defaultOpen:!1,controls:[{id:"parallaxLinearPreset",label:"Preset",stateKey:"parallaxLinearPreset",type:"select",options:Object.keys(En).map(e=>({value:e,label:En[e].label})),default:"default",format:e=>En[e]?.label||e,onChange(e){((e,t=!0)=>{const a=En[e];if(!a)return;const n=f();for(const[i,r]of Object.entries(a))"label"!==i&&void 0!==n[i]&&(n[i]=r);n.parallaxLinearPreset=e,t&&Promise.resolve().then(()=>qo).then(({resetCurrentMode:e})=>e());try{sa()}catch(o){}console.log("Applied parallax linear preset: "+a.label)})(e,!0)}},{id:"parallaxLinearDotSizeMul",label:"Dot Size",stateKey:"parallaxLinearDotSizeMul",type:"range",min:.2,max:6,step:.1,default:1.8,format:e=>e.toFixed(1)+"×",parse:parseFloat,reinitMode:!0},{id:"sizeVariationParallaxLinear",label:"Size Variation",stateKey:"sizeVariationParallaxLinear",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"parallaxLinearGridX",label:"Grid X (Cols)",stateKey:"parallaxLinearGridX",type:"range",min:3,max:40,step:1,default:14,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearGridY",label:"Grid Y (Rows)",stateKey:"parallaxLinearGridY",type:"range",min:3,max:40,step:1,default:10,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearGridZ",label:"Grid Z (Layers)",stateKey:"parallaxLinearGridZ",type:"range",min:2,max:20,step:1,default:7,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearSpanX",label:"Span X",stateKey:"parallaxLinearSpanX",type:"range",min:.2,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0,hint:"World-space width as a multiple of the viewport width. Use >1 to fill edge-to-edge."},{id:"parallaxLinearSpanY",label:"Span Y",stateKey:"parallaxLinearSpanY",type:"range",min:.2,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0,hint:"World-space height as a multiple of the viewport height."},{id:"parallaxLinearZNear",label:"Z Near",stateKey:"parallaxLinearZNear",type:"range",min:10,max:1200,step:10,default:50,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearZFar",label:"Z Far",stateKey:"parallaxLinearZFar",type:"range",min:50,max:3e3,step:25,default:900,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearFocalLength",label:"Focal Length",stateKey:"parallaxLinearFocalLength",type:"range",min:80,max:2e3,step:10,default:420,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10)},{id:"parallaxLinearParallaxStrength",label:"Parallax Strength",stateKey:"parallaxLinearParallaxStrength",type:"range",min:0,max:2e3,step:10,default:260,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},ea("parallaxLinearWarmupFrames")]},parallaxPerspective:{title:"Parallax (Perspective)",icon:"🫧",mode:"parallax-perspective",defaultOpen:!1,controls:[{id:"parallaxPerspectivePreset",label:"Preset",stateKey:"parallaxPerspectivePreset",type:"select",options:Object.keys(Rn).map(e=>({value:e,label:Rn[e].label})),default:"default",format:e=>Rn[e]?.label||e,onChange(e){((e,t=!0)=>{const a=Rn[e];if(!a)return;const n=f();for(const[i,r]of Object.entries(a))"label"!==i&&void 0!==n[i]&&(n[i]=r);n.parallaxPerspectivePreset=e,t&&Promise.resolve().then(()=>qo).then(({resetCurrentMode:e})=>e());try{sa()}catch(o){}console.log("Applied parallax perspective preset: "+a.label)})(e,!0)}},{id:"parallaxPerspectiveRandomness",label:"Randomness",stateKey:"parallaxPerspectiveRandomness",type:"range",min:0,max:1,step:.05,default:.6,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0,hint:"0 = perfect grid. 1 = full jitter from grid vertices."},{id:"parallaxPerspectiveDotSizeMul",label:"Dot Size",stateKey:"parallaxPerspectiveDotSizeMul",type:"range",min:.2,max:6,step:.1,default:1.8,format:e=>e.toFixed(1)+"×",parse:parseFloat,reinitMode:!0},{id:"sizeVariationParallaxPerspective",label:"Size Variation",stateKey:"sizeVariationParallaxPerspective",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveGridX",label:"Grid X (Cols)",stateKey:"parallaxPerspectiveGridX",type:"range",min:3,max:50,step:1,default:16,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveGridY",label:"Grid Y (Rows)",stateKey:"parallaxPerspectiveGridY",type:"range",min:3,max:50,step:1,default:12,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveGridZ",label:"Grid Z (Layers)",stateKey:"parallaxPerspectiveGridZ",type:"range",min:2,max:25,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveSpanX",label:"Span X",stateKey:"parallaxPerspectiveSpanX",type:"range",min:.2,max:3,step:.05,default:1.45,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveSpanY",label:"Span Y",stateKey:"parallaxPerspectiveSpanY",type:"range",min:.2,max:3,step:.05,default:1.45,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveZNear",label:"Z Near",stateKey:"parallaxPerspectiveZNear",type:"range",min:10,max:1200,step:10,default:40,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveZFar",label:"Z Far",stateKey:"parallaxPerspectiveZFar",type:"range",min:50,max:4e3,step:50,default:1200,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveFocalLength",label:"Focal Length",stateKey:"parallaxPerspectiveFocalLength",type:"range",min:80,max:2e3,step:10,default:420,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10)},{id:"parallaxPerspectiveParallaxStrength",label:"Parallax Strength",stateKey:"parallaxPerspectiveParallaxStrength",type:"range",min:0,max:2e3,step:10,default:280,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},ea("parallaxPerspectiveWarmupFrames")]},entrance:{title:"Entrance",icon:"🎭",defaultOpen:!1,controls:[{id:"entranceEnabled",label:"Enabled",stateKey:"entranceEnabled",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,hint:"Enable dramatic entrance animation (browser default → wall-state)",onChange(){"undefined"!=typeof window&&setTimeout(()=>window.location.reload(),300)}},{id:"entranceWallTransitionDelay",label:"Wall Transition Delay",stateKey:"entranceWallTransitionDelay",type:"range",min:0,max:2e3,step:50,default:300,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Delay before wall background transition starts"},{id:"entranceWallTransitionDuration",label:"Wall Growth Duration",stateKey:"entranceWallTransitionDuration",type:"range",min:200,max:2e3,step:50,default:800,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration of wall scaling down into viewport animation"},{id:"entranceWallInitialScale",label:"Initial Scale",stateKey:"entranceWallInitialScale",type:"range",min:1.05,max:1.5,step:.05,default:1.1,format:e=>e.toFixed(2),parse:e=>parseFloat(e),hint:"Starting scale (wall starts slightly larger, scales down to 1.0)"},{id:"entranceWallEasing",label:"Wall Growth Easing",stateKey:"entranceWallEasing",type:"select",options:[{value:"cubic-bezier(0.16, 1, 0.3, 1)",label:"Organic (default)"},{value:"ease-out",label:"Ease Out"},{value:"ease-in-out",label:"Ease In Out"},{value:"cubic-bezier(0.34, 1.56, 0.64, 1)",label:"Bounce"},{value:"cubic-bezier(0.68, -0.55, 0.265, 1.55)",label:"Overshoot"}],default:"cubic-bezier(0.16, 1, 0.3, 1)",format:e=>e+"",parse:e=>e+"",hint:"Easing function for wall growth animation"},{id:"entranceElementDuration",label:"Element Duration",stateKey:"entranceElementDuration",type:"range",min:100,max:1e3,step:50,default:200,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration for individual element animations"},{id:"entranceElementScaleStart",label:"Element Scale Start",stateKey:"entranceElementScaleStart",type:"range",min:.5,max:1,step:.01,default:.95,format:e=>e.toFixed(2),parse:e=>parseFloat(e),hint:"Initial scale for elements (0-1)"},{id:"entranceElementTranslateZStart",label:"Element Z Start",stateKey:"entranceElementTranslateZStart",type:"range",min:-100,max:0,step:5,default:-20,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Initial z-axis position (negative = back in 3D space)"},{id:"entrancePerspectiveLandscape",label:"Perspective (Landscape)",stateKey:"entrancePerspectiveLandscape",type:"range",min:500,max:3e3,step:50,default:1200,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"3D perspective for landscape aspect ratio",onChange(){Promise.resolve().then(()=>Ml).then(({applyPerspectiveCSS:e})=>{e()}).catch(()=>{})}},{id:"entrancePerspectiveSquare",label:"Perspective (Square)",stateKey:"entrancePerspectiveSquare",type:"range",min:500,max:3e3,step:50,default:1e3,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"3D perspective for square aspect ratio",onChange(){Promise.resolve().then(()=>Ml).then(({applyPerspectiveCSS:e})=>{e()}).catch(()=>{})}},{id:"entrancePerspectivePortrait",label:"Perspective (Portrait)",stateKey:"entrancePerspectivePortrait",type:"range",min:500,max:3e3,step:50,default:800,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"3D perspective for portrait aspect ratio",onChange(){Promise.resolve().then(()=>Ml).then(({applyPerspectiveCSS:e})=>{e()}).catch(()=>{})}}]}};var Yi=Object.freeze({__proto__:null,setupIndexControls:da,setupMasterControls:ca,updateModeButtonsUI:pa});(()=>{try{for(const[,e]of Object.entries(Zi)){if(!e?.mode)continue;const t=Array.isArray(e.controls)?e.controls.length:0;4>t&&console.warn(`[panel] Mode "${e.mode}" has only ${t} controls; add at least 4 parameters.`)}}catch(e){}oa({open:!0}),ra(),la(),ia({open:!1})})();const Xi=la(),qi={core:{title:"Core",controls:[{id:"masterGain",label:"Master Volume",min:10,max:100,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"collisionMinImpact",label:"Silence Threshold",min:20,max:85,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e}]},envelope:{title:"Envelope",controls:[{id:"decayTime",label:"Click Length",min:20,max:180,step:1,format:e=>Math.round(e)+"ms",toConfig:e=>e/1e3,fromConfig:e=>1e3*e}]},tone:{title:"Tone",controls:[{id:"filterBaseFreq",label:"Brightness",min:300,max:6e3,step:50,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"harmonicGain",label:"Warmth",min:0,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"filterQ",label:"Resonance",min:10,max:200,step:5,format:e=>""+(e/100).toFixed(2),toConfig:e=>e/100,fromConfig:e=>100*e}]},crystal:{title:"Crystal",controls:[{id:"pitchMinHz",label:"Pitch Low",min:80,max:1200,step:10,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"pitchMaxHz",label:"Pitch High",min:200,max:4e3,step:20,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"pitchCurve",label:"Pitch Curve",min:70,max:160,step:1,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleGain",label:"Sparkle",min:0,max:35,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMin",label:"Sparkle Min",min:120,max:600,step:10,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMax",label:"Sparkle Max",min:160,max:800,step:10,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleDecayMul",label:"Sparkle Decay",min:20,max:95,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"noiseTransientQ",label:"Sparkle Q",min:60,max:600,step:5,format:e=>""+(e/100).toFixed(2),toConfig:e=>e/100,fromConfig:e=>100*e}]},space:{title:"Space",controls:[{id:"reverbWetMix",label:"Reverb Mix",min:0,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"reverbDecay",label:"Room Size",min:5,max:80,step:1,format:e=>(e/100).toFixed(2)+"s",toConfig:e=>e/100,fromConfig:e=>100*e}]},dynamics:{title:"Dynamics",controls:[{id:"minGain",label:"Min Hit Volume",min:0,max:20,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"maxGain",label:"Max Hit Volume",min:5,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e}]},realism:{title:"Realism",controls:[{id:"noiseTransientGain",label:"Impact Snap",min:0,max:80,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"varianceGain",label:"Volume Variance",min:0,max:50,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"variancePitch",label:"Pitch Variance",min:0,max:25,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"velocityNoiseScale",label:"Hard Hit Crack",min:100,max:500,step:10,format:e=>(e/100).toFixed(1)+"×",toConfig:e=>e/100,fromConfig:e=>100*e}]}};let Ui=null,Ji=null;const Qi="panel_dock_position_v2",er="panel_dock_hidden",tr="master_panel_collapsed",ar="panel_dock_size";let nr=!1,or=0,ir=0,rr=0,lr=0,sr=!1,cr=!1,dr=null,pr=!0,ur=null;const hr=new WeakMap;var fr=Object.freeze({__proto__:null,hideOverlay:Da,initGateOverlay:Ca,isOverlayActive:Ia,mountGateIntoOverlay:wa,showOverlay:Ta,unmountGateFromOverlay:xa,updateGateContentDelay(e){document.documentElement.style.setProperty("--gate-content-delay",e+"ms")},updateGateDepthScale(e){document.documentElement.style.setProperty("--gate-depth-scale",e)},updateGateDepthTranslateY(e){document.documentElement.style.setProperty("--gate-depth-translate-y",e+"px")},updateLogoBlurActive(e){const t=document.documentElement;t.style.setProperty("--logo-blur-active-target",e+"px"),Ia()&&t.style.setProperty("--logo-blur-active",e+"px")},updateLogoBlurInactive(e){const t=document.documentElement;t.style.setProperty("--logo-blur-inactive",e+"px"),Ia()||t.style.setProperty("--logo-blur-active",e+"px")},updateLogoOpacityActive(e){const t=document.documentElement,a=e;t.style.setProperty("--logo-opacity-active-target",a),Ia()&&t.style.setProperty("--logo-opacity-active",a)},updateLogoOpacityInactive(e){const t=document.documentElement;t.style.setProperty("--logo-opacity-inactive",e),Ia()||t.style.setProperty("--logo-opacity-active",e)},updateOverlayOpacity(e){dr&&dr.style.setProperty("--gate-overlay-opacity",e)},updateOverlayTransition(e){dr&&(dr.style.setProperty("--gate-overlay-transition-duration",e+"ms"),document.documentElement.style.setProperty("--gate-depth-duration",e+"ms"))},updateOverlayTransitionOut(e){dr&&(dr.style.setProperty("--gate-overlay-transition-out-duration",e+"ms"),document.documentElement.style.setProperty("--gate-depth-out-duration",e+"ms"))}});const mr="--abs-scene-impact",br="--abs-scene-impact-dur",gr="--abs-scene-impact-logo-scale";let Mr=null,yr=!1,vr=0,wr=0,xr=0,Sr=!1,kr=null,Cr=!1,Pr=new Set;var Fr=Object.freeze({__proto__:null,emitCursorPulse:Ba,getCurrentCursorPosition:Va,initCursorPulse:za});let Tr=0,Dr=0,Ir=0,Lr=0,Ar=0,Kr=0,Or=!1,Wr=null,Er=0,Rr=0,zr=0,Br=!1,Vr=0,$r=0,Nr=0,_r=0,Gr=0,Hr=performance.now()/1e3,jr=0,Zr=!0,Yr=null;const Xr=1e3/60;let qr=[],Ur=0,Jr=null;const Qr='<i class="ti ti-volume-off" aria-hidden="true"></i>';let el=null;const tl=new Map([["apple music",'<i class="ti ti-brand-apple" aria-hidden="true"></i>'],["instagram",'<i class="ti ti-brand-instagram" aria-hidden="true"></i>'],["linkedin",'<i class="ti ti-brand-linkedin" aria-hidden="true"></i>'],["x",'<i class="ti ti-brand-x" aria-hidden="true"></i>']]);var al=Object.freeze({__proto__:null,applyExpertiseLegendColors:Ja});let nl=!1,ol=null,il=!1;const rl="abs-link-hovering",ll="abs-hover-mode-index",sl="abs-hover-mode-ui",cl="--abs-cursor-hop-dot-size",dl="abs-hover-pulse-ring",pl="abs-hover-target",ul="abs-hover-target--index",hl="abs-hover-target--ui",fl="--abs-hover-index-bg",ml="--abs-hover-index-fg";let bl=!1;const gl=['1em "Geist"','1em "Geist Mono"','1em "Sarina"','1em "tabler-icons"'];(async()=>{document.documentElement.classList.add("js-enabled");try{await(async()=>{if(Jr)return Jr;const e=_a();if(e)return Jr=e,Jr;const t=await(async()=>{const e=["config/contents-home.json","js/contents-home.json","../public/js/contents-home.json","config/text.json","js/text.json","../public/js/text.json"];for(const a of e)try{const e=await fetch(a,{cache:"no-cache"});if(!e.ok)continue;const t=await e.json();if(Na(t))return t}catch(t){}throw Error("No contents-home.json found")})();Jr=t;try{"undefined"!=typeof window&&(window.__TEXT__=t)}catch(a){}return Jr})(),(()=>{try{(()=>{const e=Ga("meta.title","");e&&(document.title=e);const t=Ga("meta.description","");if(t){const e=document.querySelector('meta[name="description"]');e&&e.setAttribute("content",t)}})(),wn(document.getElementById("edge-chapter-text"),Ga("edge.chapterText","")),wn(document.querySelector(".edge-copyright__text"),Ga("edge.copyright","")),(()=>{const e=document.getElementById("expertise-legend");xn(e,"aria-label",Ga("legend.ariaLabel",""));const t=Ga("legend.items",null);if(!Array.isArray(t)||!e)return;const a=e.querySelectorAll(".legend__item span");for(let n=0;a.length>n&&t.length>n;n++){const e=t?.[n]?.label;e&&(a[n].textContent=e)}})(),(()=>{const e=document.querySelector(".decorative-script p");if(!e)return;const t=Ga("philosophy.textBeforeLink",""),a=Ga("philosophy.link.id","contact-email-inline")||"contact-email-inline",n=Ga("philosophy.link.href","#")||"#",o=Ga("philosophy.link.text","")||"";let i=document.getElementById(a);if(i||(i=e.querySelector("a")),!i)return;i.id=a,i.setAttribute("href",n),i.textContent=o;const r=i.previousSibling;r&&r.nodeType===Node.TEXT_NODE?r.nodeValue=t:e.insertBefore(document.createTextNode(t),i);const l=i.nextSibling;l&&l.nodeType===Node.TEXT_NODE&&(l.nodeValue="")})(),(()=>{xn(document.getElementById("footer-links-container"),"aria-label",Ga("footer.navAriaLabel",""));const e=Ga("footer.links",null);if(e&&"object"==typeof e)for(const t of["contact","portfolio","cv"]){const a=e?.[t];if(!a)continue;const n=document.getElementById(a.id||"");n&&(a.href&&n.setAttribute("href",a.href),a.text&&(n.textContent=a.text))}})(),(()=>{const e=document.getElementById("social-links");xn(e,"aria-label",Ga("socials.ariaLabel",""));const t=Ga("socials.items",null);if(!e||!t||"object"!=typeof t)return;const a=["appleMusic","x","linkedin"],n=e.querySelectorAll("a.footer_icon-link");for(let o=0;n.length>o&&3>o;o++){const e=n[o],i=t?.[a[o]];if(!i)continue;i.url&&e.setAttribute("href",i.url),i.ariaLabel&&e.setAttribute("aria-label",i.ariaLabel);const r=e.querySelector(".screen-reader");r&&i.screenReaderText&&(r.textContent=i.screenReaderText)}})(),(()=>{const e=document.getElementById("header-cv-link");if(!e)return;const t=Ga("footer.links.cv",null);t&&"object"==typeof t&&(t.href&&e.setAttribute("href",t.href),t.text&&(e.textContent=t.text))})(),(()=>{const e=document.querySelector("[data-portfolio-ui] .decorative-script p");if(!e)return;const t=Ga("portfolio.blurb","");t&&(e.textContent=t)})()}catch(e){}})()}catch(e){}try{Ct()&&yi.groupCollapsed("BouncyBalls bootstrap"),Dt("bb:start"),Tt("🚀 Initializing modular bouncy balls...");const a=await(async()=>{try{try{if("undefined"!=typeof window&&window.__RUNTIME_CONFIG__&&"object"==typeof window.__RUNTIME_CONFIG__)return window.__RUNTIME_CONFIG__}catch(e){}const t=["config/default-config.json","js/config.json","../public/js/config.json"];for(const a of t)try{const e=await fetch(a,{cache:"no-cache"});if(e.ok)return await e.json()}catch(e){}throw Error("No config found")}catch(e){return console.warn("Config load failed, using defaults"),{gravityMultiplier:1.05,ballMass:91,maxBalls:300}}})();h(a),Dt("bb:config"),Tt("✓ Config loaded");try{const e=f();"undefined"!=typeof window&&(window.REST=e.REST,window.FRICTION=e.FRICTION,window.MAX_BALLS=e.maxBalls,window.repelRadius=e.repelRadius,window.repelPower=e.repelPower)}catch(e){}u(),Tt("✓ Layout applied"),kn(a),Tt("✓ Visual effects configured");try{const e=f(),t=document.documentElement;Number.isFinite(e?.topLogoWidthVw)&&t.style.setProperty("--top-logo-width-vw",e.topLogoWidthVw+""),Number.isFinite(e?.homeMainLinksBelowLogoPx)&&t.style.setProperty("--home-main-links-below-logo-px",e.homeMainLinksBelowLogoPx+"")}catch(e){}(()=>{const e=document.querySelector(".noise");if(!e)return;const t=e.closest("#bravia-balls")||document.getElementById("bravia-balls")||e.parentElement||document.body,a=getComputedStyle(e),n=a.backgroundImage&&"none"!==a.backgroundImage?a.backgroundImage:null;if(!document.querySelector(".noise-2")){const e=document.createElement("div");e.className="noise-2",n&&(e.style.backgroundImage=n),t.appendChild(e),console.log("✓ Created .noise-2 element")}if(!document.querySelector(".noise-3")){const e=document.createElement("div");e.className="noise-3",n&&(e.style.backgroundImage=n),t.appendChild(e),console.log("✓ Created .noise-3 element")}})();try{Xt(f())}catch(e){}Te();const n=Ie(),o=Le(),i=document.getElementById("bravia-balls");if(!n||!o||!i)throw Error("Missing DOM elements");try{const e=document.getElementById("brand-logo");e&&e.parentElement!==i&&i.prepend(e)}catch(e){}try{n.setAttribute("role","application"),n.getAttribute("aria-label")||n.setAttribute("aria-label","Interactive bouncy balls physics simulation")}catch(e){}b(n,o,i),De(),Dt("bb:renderer"),Tt("✓ Canvas initialized (container-relative sizing)"),f().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),(()=>{function t(e=1200){m=!0;const t=performance.now();g=Math.max(g,t+e)}function a(e){return!(!e||!e.closest||!(e.closest("#panelDock")||e.closest("#masterPanel")||e.closest("#dockToggle")||e.closest(".panel-dock")||e.closest(".panel")))}function n(e,t){if(b>0||performance.now()<g){const a=p.getBoundingClientRect();return{x:(e-a.left)*u,y:(t-a.top)*u,inBounds:!(a.left>e||e>a.right||a.top>t||t>a.bottom)}}return!m&&h||(h=p.getBoundingClientRect(),m=!1),{x:(e-h.left)*u,y:(t-h.top)*u,inBounds:!(h.left>e||e>h.right||h.top>t||t>h.bottom)}}function o(e,t,o,{isMouseLike:i}={isMouseLike:!0}){const r=n(e,t),l=performance.now(),s=l-Ir;if(s>0&&Ir>0){const e=r.x-Tr,t=r.y-Dr;Lr=Math.sqrt(e*e+t*t)/s}if(i?(ft(e,t),Ar=e,Kr=t):mt(),d.currentMode!==Ln.ORBIT_3D&&d.currentMode!==Ln.ORBIT_3D_2&&a(o))return;if(Ia())return;d.mouseX=r.x,d.mouseY=r.y,d.mouseInCanvas=r.inBounds,"undefined"!=typeof window&&(window.mouseInCanvas=r.inBounds);const c=Math.hypot(r.x-(d.lastPointerMoveX??r.x),r.y-(d.lastPointerMoveY??r.y));c>.5&&(d.lastPointerMoveMs=l,d.lastPointerMoveX=r.x,d.lastPointerMoveY=r.y),i&&c>.5&&((e,t,a,n)=>{if(gt())return;const o=f();if(!o?.mouseTrailEnabled)return;if(!n)return;if(Mt())return;if((e=>{const t=Math.max(0,0|e);t>0&&(li===t&&si&&ci&&di||(li=t,si=new Float32Array(li),ci=new Float32Array(li),di=new Float64Array(li),pi=0,ui=0))})(yt(0|(o.mouseTrailLength??18),4,96)),!li)return;const i=o.DPR||1,r=yt(+(o.mouseTrailSize??1.3),.5,10)*i,l=Math.max(.35,.55*r),s=l*l;if(ui>0){const n=(pi-1+li)%li;if(((e,t,a,n)=>{const o=e-a,i=t-n;return o*o+i*i})(e,t,si[n],ci[n])<s)return void(di[n]=a)}si[pi]=e,ci[pi]=t,di[pi]=a,pi=(pi+1)%li,li>ui&&ui++})(r.x,r.y,l,r.inBounds),d.currentMode===Ln.WATER&&r.inBounds&&Lr>.3&&l-$r>80&&(Me(r.x,r.y,Math.min(2*Lr,3)),$r=l),Tr=r.x,Dr=r.y,Ir=l}function i(){if(d?.isMobile||d?.isMobileViewport)return!0;try{return!(!window.matchMedia||!window.matchMedia("(max-width: 768px)").matches)}catch(e){return!1}}function r(){if(Vr){try{window.clearTimeout(Vr)}catch(e){}Vr=0}}function l(e,t,o,l=null){Or||a(o)||(e=>!(!e||!e.closest||!(e.closest("a")||e.closest("button")||e.closest("input")||e.closest("select")||e.closest("textarea"))))(o)||Ia()||d.clickCycleEnabled&&n(e,t).inBounds&&(Or=!0,Wr=l,Er=e,Rr=t,zr=0,Br=!1,r(),i()||(Br=!0,Wa(1,{armManual:!0,scheduleRelease:!1})))}function s(e=null,t="mouse"){if(!Or)return;if(null!==Wr&&null!==e&&e!==Wr)return;const a=zr;Or=!1,Wr=null,zr=0;const n=Br;if(Br=!1,"touch"!==t&&"pen"!==t||15>=a){if(i()){(Er>0||Rr>0)&&(Ar=Er,Kr=Rr),Wa(1,{armManual:!0,scheduleRelease:!1});const e=Math.max(1,Math.round(.8*(+(d.sceneImpactPressMs??75)||0))),t=Math.round(Math.min(80,Math.max(0,.4*(+e||0))));return r(),void(Vr=window.setTimeout(()=>{Vr=0,$a(),Ea()},Math.max(0,Math.round(e)+t)))}$a(),Ea()}else n&&Ea()}function c(e=null){Or&&(null!==Wr&&null!==e&&e!==Wr||(Or=!1,Wr=null,zr=0,r(),Br&&Ea(),Br=!1))}const d=f(),p=d.canvas;if(void 0===d.clickCycleEnabled&&(d.clickCycleEnabled=!1),!p)return void console.error("Canvas not available for pointer setup");const u=d.DPR;let h=null,m=!0;try{h=p.getBoundingClientRect(),m=!1}catch(e){m=!0}try{requestAnimationFrame(()=>{requestAnimationFrame(()=>{h=p.getBoundingClientRect(),m=!1})})}catch(e){}let b=0,g=0;try{window.addEventListener("resize",()=>{m=!0},{passive:!0})}catch(e){}try{const e=e=>!e||"transform"===e||"top"===e||"left"===e||"right"===e||"bottom"===e||"width"===e||"height"===e,a=(a,n)=>{if(!a||!a.addEventListener)return;a.addEventListener("transitionrun",a=>{e(a?.propertyName)&&(b++,t(n))});const o=a=>{e(a?.propertyName)&&(b=Math.max(0,b-1),t(120))};a.addEventListener("transitionend",o),a.addEventListener("transitioncancel",o)};a(document.getElementById("abs-scene"),600),a(document.getElementById("bravia-balls"),1200)}catch(e){}document.addEventListener("mousemove",e=>{window.PointerEvent||o(e.clientX,e.clientY,e.target,{isMouseLike:!0})},{passive:!0}),document.addEventListener("pointermove",e=>{o(e.clientX,e.clientY,e.target,{isMouseLike:"mouse"===e.pointerType||"pen"===e.pointerType})},{passive:!0}),window.PointerEvent?(document.addEventListener("pointerdown",e=>{l(e.clientX,e.clientY,e.target,e.pointerId)},{passive:!0}),document.addEventListener("pointermove",e=>{Or&&Wr===e.pointerId&&(zr=Math.max(zr,Math.hypot(e.clientX-Er,e.clientY-Rr)))},{passive:!0}),document.addEventListener("pointerup",e=>{s(e.pointerId,e.pointerType)},{passive:!0}),document.addEventListener("pointercancel",e=>{c(e.pointerId)},{passive:!0})):(document.addEventListener("mousedown",e=>{l(e.clientX,e.clientY,e.target,null)},{passive:!0}),document.addEventListener("mouseup",()=>{s(null,"mouse")},{passive:!0})),document.addEventListener("touchmove",e=>{if(!Ia()&&e.touches&&e.touches[0]){const t=n(e.touches[0].clientX,e.touches[0].clientY);d.mouseX=t.x,d.mouseY=t.y,d.mouseInCanvas=t.inBounds;const a=performance.now();Math.hypot(t.x-(d.lastPointerMoveX??t.x),t.y-(d.lastPointerMoveY??t.y))>.5&&(d.lastPointerMoveMs=a,d.lastPointerMoveX=t.x,d.lastPointerMoveY=t.y),d.currentMode===Ln.WATER&&t.inBounds&&a-$r>80&&(Me(t.x,t.y,2),$r=a)}},{passive:!0}),document.addEventListener("touchstart",e=>{if(!window.PointerEvent&&!a(e.target)&&!Ia()&&(mt(),!e.target.closest("a")&&!e.target.closest("button")&&!e.target.closest("input")&&!e.target.closest("select")&&!e.target.closest("textarea")&&e.touches&&e.touches[0])){const t=e.touches[0];if(!n(t.clientX,t.clientY).inBounds)return;d.clickCycleEnabled&&(Or=!0,Wr=null,Er=t.clientX,Rr=t.clientY,zr=0)}},{passive:!0}),document.addEventListener("touchmove",e=>{if(!window.PointerEvent&&Or&&e.touches&&e.touches[0]){const t=e.touches[0];zr=Math.max(zr,Math.hypot(t.clientX-Er,t.clientY-Rr))}},{passive:!0}),document.addEventListener("touchend",()=>{window.PointerEvent||s(null,"touch")},{passive:!0}),document.addEventListener("touchcancel",()=>{window.PointerEvent||c(null)},{passive:!0}),document.addEventListener("mouseleave",()=>{d.mouseX=On.OFFSCREEN_MOUSE,d.mouseY=On.OFFSCREEN_MOUSE,d.mouseInCanvas=!1,Lr=0,"undefined"!=typeof window&&(window.mouseInCanvas=!1),mt()}),document.addEventListener("mouseenter",()=>{bt()}),document.addEventListener("touchend",()=>{d.mouseX=On.OFFSCREEN_MOUSE,d.mouseY=On.OFFSCREEN_MOUSE,d.mouseInCanvas=!1},{passive:!0}),console.log("✓ Unified pointer system configured (document-level)"),d.ve=!0,"undefined"!=typeof window&&(window.ve=!0)})(),Tt("✓ Pointer tracking configured"),"undefined"!=typeof document&&document.addEventListener("touchmove",e=>{var t;(t=e.target)instanceof Element&&(t.closest(".panel-dock .panel .panel-content")||t.closest("#controlPanel"))||e.preventDefault()},{passive:!1,capture:!0}),Tt("✓ Overscroll lock configured"),ut(),Dt("bb:input"),Tt("✓ Custom cursor initialized"),nl||(nl=!0,mn(),document.addEventListener("pointerover",gn,!0),document.addEventListener("pointerout",Mn,!0),document.addEventListener("pointermove",yn,{passive:!0}),document.addEventListener("pointerdown",vn,!0),window.PointerEvent||(document.addEventListener("mouseover",gn,!0),document.addEventListener("mouseout",Mn,!0),document.addEventListener("mousemove",yn,{passive:!0}),document.addEventListener("mousedown",vn,!0)),window.addEventListener("blur",mn,{passive:!0}),window.addEventListener("mouseout",e=>{e.relatedTarget||e.toElement||mn()},{passive:!0}),window.addEventListener("resize",()=>{if(ol){try{ol.getBoundingClientRect?.()}catch(e){}bn()}},{passive:!0}),window.addEventListener("scroll",()=>{if(ol){try{ol.getBoundingClientRect?.()}catch(e){}bn()}},{passive:!0,capture:!0})),(()=>{if("undefined"!=typeof window&&"undefined"!=typeof document&&(Mr=document.querySelector("#abs-scene")||null,Mr&&(Mr.style.setProperty(mr,"0"),Mr.style.setProperty(br,"100ms"),Mr.style.setProperty(gr,"1"),Aa(),!(()=>{try{return!(!window.matchMedia||!window.matchMedia("(prefers-reduced-motion: reduce)").matches)}catch(e){return!1}})()))){yr=!0,Mr.classList.add("abs-scene--impact");try{window.addEventListener("resize",Aa,{passive:!0})}catch(e){}window.addEventListener("bb:modeChanged",e=>{const t=f();if(!1===t?.sceneImpactEnabled)return;if(Sr)return void(Sr=!1);const a=e?.detail||{};((e=1,t={})=>{if(!yr||!Mr)return;const a=f();if(!1===a?.sceneImpactEnabled)return;const n=Math.max(0,Math.min(1,+e||0)),o=++vr;Oa(),Mr.classList.add("abs-scene--animating"),t?.armManual&&(Sr=!0);const i=a?.sceneImpactPressMs??75,r=a?.sceneImpactReleaseMs??220,l=Math.max(1,Math.round(.8*(+i||0))),s=Math.max(1,Math.round(1.2*(+r||0))),c=Math.round(Math.min(80,Math.max(0,.4*(+l||0))));Mr.style.setProperty(br,Math.round(l)+"ms"),window.requestAnimationFrame(()=>{yr&&Mr&&o===vr&&(Mr.style.setProperty(mr,n+""),Mr.style.setProperty(gr,Ka(n,a)+""))}),wr=window.setTimeout(()=>{Ra({token:o,releaseMs:s})},Math.max(0,Math.round(l)+c)),xr=window.setTimeout(()=>{xr=0,Mr&&Mr.classList.remove("abs-scene--animating")},Math.max(0,Math.round(l)+c+Math.round(s)+80))})(a.prevMode&&a.mode&&a.prevMode!==a.mode?1:.75,{armManual:!1})},{passive:!0})}})(),Promise.resolve().then(()=>Fr).then(({initCursorPulse:e})=>{e(),Tt("✓ Cursor pulse system initialized")}).catch(()=>{}),console.log("⚠️ localStorage is disabled - using defaults"),j(),X();try{(e=>{const t=e&&"object"==typeof e?e:null;if(!t)return;if("string"==typeof t.soundPreset&&ie(t.soundPreset),t.soundConfig&&"object"==typeof t.soundConfig)return void oe(t.soundConfig);const a={};let n=!1;for(const[o,i]of Object.entries(t))o in Qn&&(a[o]=i,n=!0);n&&oe(a)})(a)}catch(e){}Tt("✓ Sound engine primed (awaiting user unlock)"),"undefined"!=typeof window&&(bl||(bl=!0,window.addEventListener("bb:modeChanged",e=>{const t=f();if(!1===t?.sceneChangeSoundEnabled)return;const a=e?.detail||{};a.prevMode&&a.mode&&a.prevMode!==a.mode&&U(+(t?.sceneChangeSoundRadius??18),+(t?.sceneChangeSoundIntensity??.35),.5,null)},{passive:!0}))),Dt("bb:ui"),Tt("✓ UI initialized (panel disabled in production)"),Wt(),Dt("bb:theme"),Ja(),cr||(cr=!0,window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName))return;const t=e.key.toLowerCase();if("/"===t||"Slash"===e.code)return e.preventDefault(),void Ma();if("r"!==t)return"ArrowRight"===e.key?(e.preventDefault(),void ya(1)):"ArrowLeft"===e.key?(e.preventDefault(),void ya(-1)):void 0;e.preventDefault(),lt();try{pa(f().currentMode)}catch(e){}})),Tt("✓ Keyboard shortcuts registered"),Ca(a),Tt("✓ Gate overlay system initialized"),(()=>{const t=document.getElementById("cv-gate-trigger"),a=document.getElementById("brand-logo"),n=document.getElementById("cv-gate"),o=document.getElementById("portfolio-gate"),i=document.getElementById("contact-gate"),r=Array.from(document.querySelectorAll(".cv-digit")),l=document.getElementById("page-flash"),s=document.getElementById("cv-gate-label");if(!t||!a||!n||0===r.length)return void console.warn("CV Gate: Missing required elements");const c=Ga("gates.common.backText","BACK"),d=Ga("gates.common.backAriaLabel","Back"),p=Ga("gates.cv.title","Bio/CV"),u=Ga("gates.cv.description","Because spam bots don't deserve nice things—and neither do recruiters who don't read portfolios. This keeps my inbox slightly more civilized.");s&&(s.innerHTML=`\n            <div class="gate-nav">\n                <button type="button" class="gate-back" data-gate-back aria-label="${d}">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>${c}</span>\n                </button>\n            </div>\n            <h2 class="gate-title">${p}</h2>\n            <p class="gate-description">${u}</p>\n        `);const h=l||(()=>{const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e})();let f=!1;const m=()=>n&&n.classList.contains("active")||o&&o.classList.contains("active")||i&&i.classList.contains("active"),b=e=>{e?.preventDefault?.();const t=m();o&&o.classList.contains("active")&&(o.classList.remove("active"),o.setAttribute("aria-hidden","true"),setTimeout(()=>{o.classList.add("hidden"),xa(o)},400)),i&&i.classList.contains("active")&&(i.classList.remove("active"),i.setAttribute("aria-hidden","true"),setTimeout(()=>{i.classList.add("hidden"),xa(i)},400)),f=!0,t||Ta(),a.classList.add("fade-out-up"),wa(n),n.classList.remove("hidden"),n.setAttribute("aria-hidden","false"),n.classList.add("active"),r[0].focus()},g=(e=!1)=>{f=!1,r.forEach(e=>e.value=""),e?(n.style.transition="none",a.style.transition="none",n.classList.remove("active"),n.setAttribute("aria-hidden","true"),n.classList.add("hidden"),xa(n),a.classList.remove("fade-out-up"),m()||Da(),requestAnimationFrame(()=>{n.style.removeProperty("transition"),a.style.removeProperty("transition")})):(n.classList.remove("active"),n.setAttribute("aria-hidden","true"),a.classList.remove("fade-out-up"),setTimeout(()=>{f||(n.classList.add("hidden"),xa(n)),m()||Da()},400))};try{const e=s?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",g)}catch(e){}n.addEventListener("click",e=>{(e.target===n||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&g(!0)});const M=()=>{const e=r.map(e=>e.value).join("");4===e.length&&("1111"===e?(Ha(h,"success"),setTimeout(()=>{window.location.href="cv.html"},500)):(Ha(h,"error"),setTimeout(()=>{r.forEach(e=>e.value=""),r[0].focus()},350)))};t.addEventListener("click",b);try{sessionStorage.getItem("abs_open_cv_gate")&&(sessionStorage.removeItem("abs_open_cv_gate"),setTimeout(()=>b(),300))}catch(e){}document.addEventListener("keydown",e=>{"Escape"===e.key&&f&&g()}),document.addEventListener("gate-overlay-dismiss",e=>{f&&g(e.detail?.instant||!1)}),r.forEach((e,t)=>{e.addEventListener("keydown",a=>{"Backspace"===a.key&&""===e.value&&(t>0?r[t-1].focus():g())}),e.addEventListener("input",e=>{const a=e.target.value;if(/^\d*$/.test(a)){if(1===a.length)r.length-1>t?r[t+1].focus():M();else if(a.length>1){const n=a.split("");e.target.value=n[0];let o=t+1;for(let e=1;n.length>e&&r.length>o;e++)r[o].value=n[e],o++;r.length>o?r[o].focus():M()}}else e.target.value=a.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})})(),Tt("✓ CV password gate initialized"),(()=>{const t=document.getElementById("portfolio-gate-trigger"),a=document.getElementById("portfolio-gate"),n=document.getElementById("brand-logo"),o=document.getElementById("cv-gate"),i=document.getElementById("contact-gate"),r=Array.from(document.querySelectorAll(".portfolio-digit")),l=document.getElementById("page-flash"),s=document.getElementById("portfolio-gate-label");if(!t||!a||0===r.length)return void console.warn("Portfolio Gate: Missing required elements");const c=Ga("gates.common.backText","BACK"),d=Ga("gates.common.backAriaLabel","Back"),p=Ga("gates.portfolio.title","View Portfolio"),u=Ga("gates.portfolio.description","Good work deserves good context. This small step ensures you're here with intention, not just browsing. Quality takes time—yours and mine.");s&&(s.innerHTML=`\n            <div class="gate-nav">\n                <button type="button" class="gate-back" data-gate-back aria-label="${d}">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>${c}</span>\n                </button>\n            </div>\n            <h2 class="gate-title">${p}</h2>\n            <p class="gate-description">${u}</p>\n        `);const h=l||(()=>{const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e})();let f=!1;const m=()=>a&&a.classList.contains("active")||o&&o.classList.contains("active")||i&&i.classList.contains("active"),b=e=>{e&&e.preventDefault();const t=m(),l=(()=>{try{const e=window.PORTFOLIO_BASE||"";return e&&!e.endsWith("/")?e+"/":e}catch(e){return""}})(),s=document.createElement("link");s.rel="prefetch",s.href=l+"js/portfolio-bundle.js",document.head.appendChild(s);const c=document.createElement("link");c.rel="preload",c.as="image",c.href=l+"images/portfolio/pages/chapter-0-1.webp",document.head.appendChild(c),o&&o.classList.contains("active")&&(o.classList.remove("active"),o.setAttribute("aria-hidden","true"),setTimeout(()=>{o.classList.add("hidden"),xa(o)},400)),i&&i.classList.contains("active")&&(i.classList.remove("active"),i.setAttribute("aria-hidden","true"),setTimeout(()=>{i.classList.add("hidden"),xa(i)},400)),f=!0,t||Ta(),n&&n.classList.add("fade-out-up"),wa(a),a.classList.remove("hidden"),a.setAttribute("aria-hidden","false"),a.classList.add("active"),r[0].focus()},g=(e=!1)=>{f=!1,r.forEach(e=>e.value=""),e?(a.style.transition="none",n&&(n.style.transition="none"),a.classList.remove("active"),a.setAttribute("aria-hidden","true"),a.classList.add("hidden"),xa(a),n&&n.classList.remove("fade-out-up"),m()||Da(),requestAnimationFrame(()=>{a.style.removeProperty("transition"),n&&n.style.removeProperty("transition")})):(a.classList.remove("active"),a.setAttribute("aria-hidden","true"),n&&n.classList.remove("fade-out-up"),setTimeout(()=>{f||(a.classList.add("hidden"),xa(a)),m()||Da()},400))};try{const e=s?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",g)}catch(e){}a.addEventListener("click",e=>{(e.target===a||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&g(!0)});const M=()=>{const e=r.map(e=>e.value).join("");4===e.length&&("1234"===e?(ja(h,"success"),sessionStorage.setItem("abs_portfolio_ok",Date.now()),setTimeout(()=>{window.location.href="portfolio.html"},500)):(ja(h,"error"),setTimeout(()=>{r.forEach(e=>e.value=""),r[0].focus()},350)))};sessionStorage.getItem("abs_open_portfolio_gate")&&(sessionStorage.removeItem("abs_open_portfolio_gate"),setTimeout(()=>b(),300)),t.addEventListener("click",b),document.addEventListener("keydown",e=>{"Escape"===e.key&&f&&g()}),document.addEventListener("gate-overlay-dismiss",e=>{f&&g(e.detail?.instant||!1)}),r.forEach((e,t)=>{e.addEventListener("keydown",a=>{"Backspace"===a.key&&""===e.value&&(t>0?r[t-1].focus():g())}),e.addEventListener("input",e=>{const a=e.target.value;if(/^\d*$/.test(a)){if(1===a.length)r.length-1>t?r[t+1].focus():M();else if(a.length>1){const n=a.split("");e.target.value=n[0];let o=t+1;for(let e=1;n.length>e&&r.length>o;e++)r[o].value=n[e],o++;r.length>o?r[o].focus():M()}}else e.target.value=a.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})})(),Tt("✓ Portfolio password gate initialized"),(()=>{const t=Ga("contact.email","alexander@beck.fyi"),a=Ga("gates.common.backText","BACK"),n=Ga("gates.common.backAriaLabel","Back"),o=Ga("gates.contact.title","Contact"),i=Ga("gates.contact.description","For collaborations, product design work, AI prototyping, or anything that needs a crisp creative + technical brain."),r=Ga("contact.copy.buttonAriaLabel","Copy email address"),l=Ga("contact.copy.statusCopied","Copied"),s=Ga("contact.copy.statusError","Copy failed"),c=[document.getElementById("contact-email"),document.getElementById("contact-email-inline")].filter(Boolean),d=document.getElementById("brand-logo"),p=document.getElementById("contact-gate"),u=document.getElementById("contact-gate-label"),h=document.getElementById("contact-gate-inputs"),f=document.getElementById("cv-gate"),m=document.getElementById("portfolio-gate");if(!(c.length&&d&&p&&u&&h))return void console.warn("Contact Gate: Missing required elements");u.innerHTML=`\n    <div class="gate-nav">\n      <button type="button" class="gate-back" data-gate-back aria-label="${n}">\n        <i class="ti ti-arrow-left" aria-hidden="true"></i>\n        <span>${a}</span>\n      </button>\n    </div>\n    <h2 class="gate-title">${o}</h2>\n    <p class="gate-description">\n      ${i}\n    </p>\n  `,h.innerHTML=`\n    <div class="contact-email-row" data-email-row>\n      <button type="button" class="contact-email-value" data-copy-email aria-label="${r}">\n        <span class="contact-email-text">${t}</span>\n      </button>\n      <button type="button" class="contact-email-copy" data-copy-email-icon aria-label="${r}">\n        <i class="ti ti-copy" aria-hidden="true"></i>\n      </button>\n    </div>\n    <div class="contact-copy-status" data-copy-status aria-live="polite"></div>\n  `;const b=u.querySelector("[data-gate-back]"),g=h.querySelector("[data-copy-email]"),M=h.querySelector("[data-copy-email-icon]"),y=h.querySelector("[data-email-row]"),v=h.querySelector("[data-copy-status]"),w=h.querySelector(".contact-email-copy i");let x=!1,S=null;const k=()=>p&&p.classList.contains("active")||f&&f.classList.contains("active")||m&&m.classList.contains("active"),C=e=>{if(g&&M&&v){if(S&&window.clearTimeout(S),"copied"===e)return y?.classList?.add?.("is-copied"),y?.classList?.remove?.("is-error"),v.textContent=l,w&&(w.className="ti ti-check"),void(S=window.setTimeout(()=>C("idle"),1200));if("error"===e)return y?.classList?.add?.("is-error"),y?.classList?.remove?.("is-copied"),v.textContent=s,w&&(w.className="ti ti-alert-triangle"),void(S=window.setTimeout(()=>C("idle"),1200));y?.classList?.remove?.("is-copied","is-error"),v.textContent="",w&&(w.className="ti ti-copy")}},P=e=>{e?.preventDefault?.();const t=k();f&&f.classList.contains("active")&&(f.classList.remove("active"),f.setAttribute("aria-hidden","true"),setTimeout(()=>{f.classList.add("hidden"),xa(f)},400)),m&&m.classList.contains("active")&&(m.classList.remove("active"),m.setAttribute("aria-hidden","true"),setTimeout(()=>{m.classList.add("hidden"),xa(m)},400)),x=!0,t||Ta(),C("idle"),d.classList.add("fade-out-up"),wa(p),p.classList.remove("hidden"),p.setAttribute("aria-hidden","false"),p.classList.add("active"),g?.focus?.()},F=(e=!1)=>{x=!1,C("idle"),e?(p.style.transition="none",d.style.transition="none",p.classList.remove("active"),p.setAttribute("aria-hidden","true"),p.classList.add("hidden"),xa(p),d.classList.remove("fade-out-up"),k()||Da(),requestAnimationFrame(()=>{p.style.removeProperty("transition"),d.style.removeProperty("transition")})):(p.classList.remove("active"),p.setAttribute("aria-hidden","true"),d.classList.remove("fade-out-up"),setTimeout(()=>{x||(p.classList.add("hidden"),xa(p)),k()||Da()},400))};c.forEach(e=>e.addEventListener("click",P,{capture:!0})),b?.addEventListener("click",F),p.addEventListener("click",e=>{(e.target===p||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&F(!0)});const T=async()=>{const a=await(async t=>{try{if(navigator?.clipboard?.writeText)return await navigator.clipboard.writeText(t),!0}catch(e){}try{const e=document.createElement("textarea");e.value=t,e.setAttribute("readonly","true"),e.style.position="fixed",e.style.left="-9999px",e.style.top="0",document.body.appendChild(e),e.select();const a=!0===document.execCommand?.("copy");return document.body.removeChild(e),a}catch(e){return!1}})(t);C(a?"copied":"error")};g?.addEventListener("click",T),M?.addEventListener("click",T),document.addEventListener("keydown",e=>{"Escape"===e.key&&x&&F()}),document.addEventListener("gate-overlay-dismiss",e=>{x&&F(e.detail?.instant||!1)});try{sessionStorage.getItem("abs_open_contact_gate")&&(sessionStorage.removeItem("abs_open_contact_gate"),requestAnimationFrame(()=>P()))}catch(e){}})(),Tt("✓ Contact gate initialized"),(()=>{const e=document.getElementById("social-links");if(!e)return;if(e.querySelector("i.ti"))return;const t=Array.from(e.querySelectorAll("a.footer_icon-link[aria-label]"));for(const a of t){const e=(a.getAttribute("aria-label")||"").trim().toLowerCase(),t=tl.get(e);if(!t)continue;const n=a.querySelector("svg");n?(a.insertAdjacentHTML("afterbegin",t),n.remove()):a.insertAdjacentHTML("afterbegin",t)}})(),(()=>{function e(){t.textContent=n.format(new Date).toUpperCase()}const t=document.getElementById("time-display"),a=document.getElementById("site-year");if(!t)return;const n=new Intl.DateTimeFormat("en-GB",{timeZone:"Europe/London",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});e(),setInterval(e,1e3),a&&(a.style.cursor="pointer",a.addEventListener("click",Et))})(),(()=>{try{const e=document.getElementById("cv-gate-trigger");if(e&&!e.querySelector(".footer-link-nowrap")){const t=((Ga("footer.links.cv.text","")||"")+"").trim(),a=(e.textContent||"").trim().replace(/\s+/g," "),n=t||a;n&&n.includes("/")&&a===n&&(e.innerHTML=`<span class="footer-link-nowrap">${n}</span>`)}}catch(e){}})(),(()=>{if(X(),"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return console.log("⏸ Sound toggle hidden (prefers-reduced-motion)"),null;el=document.createElement("button"),el.className="sound-toggle",el.id="sound-toggle",el.type="button",el.setAttribute("aria-label","Toggle collision sounds"),el.setAttribute("aria-pressed","false"),el.setAttribute("data-enabled","false"),el.innerHTML=Qr,el.title="Sound off",el.addEventListener("click",Za);const t=document.getElementById("fade-content"),a=document.getElementById("sound-toggle-slot"),n=document.getElementById("top-elements-soundRow"),o=document.getElementById("social-links"),i=document.querySelector(".ui-meta-right"),r=!!a,l=o&&(!t||t.contains(o)),s="undefined"!=typeof window&&"function"==typeof window.matchMedia&&window.matchMedia("(max-width: 600px)").matches,c=t=>{if(!t)return!1;try{el.parentElement&&el.parentElement!==t&&el.parentElement.removeChild(el)}catch(e){}if(t.classList.contains("ui-meta-right")){const e=t.querySelector("time");if(e)return t.insertBefore(el,e),!0}return t.appendChild(el),!0};if(s&&n)el.classList.add("sound-toggle--top"),el.classList.add("sound-toggle--topwide"),c(n);else if(r)el.classList.add("sound-toggle--top"),c(a);else if(i)c(i);else if(l){const e=document.createElement("li");e.className="margin-bottom_none sound-toggle-item",el.classList.add("sound-toggle--social"),e.appendChild(el),o.appendChild(e)}else t?t.appendChild(el):document.body.appendChild(el);try{if("undefined"!=typeof window&&"function"==typeof window.matchMedia){const e=window.matchMedia("(max-width: 600px)"),t=()=>{const t=document.getElementById("top-elements-soundRow"),a=document.getElementById("sound-toggle-slot"),n=e.matches&&!!t;el.classList.toggle("sound-toggle--topwide",n),n?c(t):a&&c(a)};"function"==typeof e.addEventListener?e.addEventListener("change",t):"function"==typeof e.addListener&&e.addListener(t)}}catch(e){}console.log("✓ Sound toggle created");try{const e=ae();Ya(!(!e.isUnlocked||!e.isEnabled))}catch(e){}"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(fo,e=>{const t=e&&e.detail?e.detail:null;t&&Ya(!(!t.isUnlocked||!t.isEnabled))})})(),Tt("✓ Sound toggle button created"),Tt("✓ Theme toggle button created");const r=Ln.PIT;$?.(),rt(r);try{const e=await Promise.resolve().then(()=>Yi);e.updateModeButtonsUI?.(r)}catch(e){}Dt("bb:mode"),Tt("✓ Mode initialized"),No=St;const l=()=>st();(e=>{function t(a){if(!Zr)return void(Yr=null);const n=a-jr;if(Xr>n)return void(Yr=requestAnimationFrame(t));jr=a-n%Xr,(e=>{if(qr.push(e),qr.length>30&&qr.shift(),30===qr.length){const e=1e3/(qr.reduce((e,t)=>e+t,0)/30);30>e&&2>Ur?(Ur++,console.log(`⚡ Adaptive throttle increased to level ${Ur} (avg FPS: ${e.toFixed(1)})`)):e>55&&Ur>0&&(Ur--,console.log(`⚡ Adaptive throttle decreased to level ${Ur} (avg FPS: ${e.toFixed(1)})`))}})(n);const o=a/1e3;let i=Math.min(.033,o-Hr);Hr=o,(2>Ur||Math.random()>.5)&&xt(i,e),St(),(e=>{if(_r++,e-Nr>1e3){Gr=_r,_r=0,Nr=e;const t=document.getElementById("render-fps");t&&(t.textContent=Gr+"")}})(performance.now()),Yr=requestAnimationFrame(t)}document.addEventListener("visibilitychange",()=>{Zr=!document.hidden,Zr?(Hr=performance.now()/1e3,jr=performance.now(),console.log("▶️ Animation resumed"),Yr||(Yr=requestAnimationFrame(t))):(console.log("⏸️ Animation paused (tab hidden)"),Yr&&(cancelAnimationFrame(Yr),Yr=null))}),Yr=requestAnimationFrame(t),console.log("✓ Render loop started (60fps throttle, visibility-aware)")})((e,t)=>{const a=l();a&&a(e,t)}),Dt("bb:end"),Tt("✅ Bouncy Balls running (modular)");const s=[{phase:"config",ms:It("bb:m:config","bb:start","bb:config")},{phase:"renderer",ms:It("bb:m:renderer","bb:config","bb:renderer")},{phase:"input",ms:It("bb:m:input","bb:renderer","bb:input")},{phase:"ui",ms:It("bb:m:ui","bb:input","bb:ui")},{phase:"theme",ms:It("bb:m:theme","bb:ui","bb:theme")},{phase:"mode+loop",ms:It("bb:m:mode","bb:theme","bb:mode")},{phase:"total",ms:It("bb:m:total","bb:start","bb:end")}].filter(e=>"number"==typeof e.ms);s.length&&(t=>{if(Ct())try{yi.table(t)}catch(e){}})(s.map(e=>({...e,ms:+e.ms.toFixed(2)}))),Ct()&&yi.groupEnd();try{Ct()?Ft():(({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"]}={})=>{Ct()||Ft({sentence:e,ascii:t,silence:!0})})()}catch(t){try{console.error("Banner print error:",t),console.log("%cCurious mind detected. Design meets engineering at 60fps.","color: #888; font-style: italic;")}catch(e){}}try{const{orchestrateEntrance:t}=await Promise.resolve().then(()=>Ml);if(!f().entranceEnabled||window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches){try{await Sn()}catch(e){}const t=document.getElementById("fade-content");t&&(t.style.opacity="1",t.style.transform="translateZ(0)"),console.log("✓ Entrance animation skipped (disabled or reduced motion)")}else await t({async waitForFonts(){try{await Sn()}catch(e){}}}),console.log("✓ Dramatic entrance animation orchestrated")}catch(e){console.warn("⚠️ Entrance animation failed, falling back to simple fade:",e);try{await Sn()}catch(e){}const t=document.getElementById("fade-content");t&&(t.style.opacity="1",t.style.transform="translateZ(0)")}}catch(a){console.error("❌ Initialization failed:",a),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${a.message}\n${a.stack}</pre>\n    </div>`}})();var Ml=Object.freeze({__proto__:null,animateElementEntrance:In,applyAspectRatioClass:Pn,applyPerspectiveCSS:Fn,detectAspectRatioCategory:Cn,async orchestrateEntrance(e={}){const t=f();Pn(),Fn(),Tn(),e.waitForFonts&&await e.waitForFonts(),Dn();const a=document.getElementById("fade-content");a&&In(a,{delay:(t.entranceWallTransitionDelay||300)+.3*(t.entranceWallTransitionDuration||800),duration:t.entranceElementDuration||200,scaleStart:t.entranceElementScaleStart||.95,translateZStart:t.entranceElementTranslateZStart||-20})},setInitialBrowserDefaultState:Tn,transitionToWallState:Dn});e.applyFramePaddingCSSVars=()=>{u()},e.applyVisualCSSVars=kn})({});