(()=>{const t={PIT:"pit",FLIES:"flies",WEIGHTLESS:"weightless"};let e=t.PIT,n=40,a=1.15,o=!0,i=5e3,s=180,l=3.5,r=80,h=250,d=.97,c=300,u=150;const m=-1e9,g=1e-4,f=.25;function y(){return 0===n?0:n/40*.2}const p=document.getElementById("c"),x=p.getContext("2d",{alpha:!0}),v=document.getElementById("controlPanel"),E=document.getElementById("bravia-balls"),M=Math.max(1,Math.min(2,window.devicePixelRatio||1));let I,b=50,S=-50,C=100,B=50;function w(){const n=e===t.PIT?1.5:1,a=window.innerHeight*n;p.width=Math.floor(window.innerWidth*M),p.height=Math.floor(a*M)}w(),window.addEventListener("resize",function(){clearTimeout(I),I=setTimeout(()=>{w(),Z(),Y()},150)});const T=1960;let L=1.1,V=T*L,R=.88,F=.003,P=.03,q=400;const A=.5*M,z=6,G=24;let N=1,U=.15,W=1,k=null,H=11.2;const O=.15;let $=1;function D(){$=Math.max(.5,Math.min(3,Math.pow(H/1,.35)))}D();let _=z*N,j=G*N;function Z(){W=(p.clientWidth||window.innerWidth)<=768?.4:1;const t=N*W;if(null===k)return k=t,_=z*t,void(j=G*t);const e=t/k;if(1!==e){for(let t=0;t<Gt.length;t++)Gt[t].r*=e;k=t}_=z*t,j=G*t}function Y(){Et=[];const t=document.querySelector(vt);if(!t)return;const e=t.getBoundingClientRect(),n=p.getBoundingClientRect(),a=function(t){const e=document.createElement("span");e.style.cssText=window.getComputedStyle(t).cssText,e.style.position="absolute",e.style.visibility="hidden",e.style.whiteSpace="nowrap",e.textContent="ABCDEFGHIJKLMNOPQRSTUVWXYZ",document.body.appendChild(e);const n=e.getBoundingClientRect().height;return document.body.removeChild(e),n}(t),o=.5*(e.height-a),i={x:(e.left-n.left)*M,y:(e.top-n.top+o)*M,width:e.width*M,height:a*M};i.width>0&&i.height>0&&i.x<p.width&&i.y<p.height&&i.x+i.width>0&&i.y+i.height>0&&Et.push(i)}let J=!0,X=0,K=1;const Q={industrialTeal:{label:"Industrial Teal",colors:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"]},sunsetCoral:{label:"Sunset Coral",colors:["#b8b5b1","#e5e3df","#ffffff","#ff6b6b","#000000","#00d4aa","#2563eb","#f59e0b"]},violetPunch:{label:"Violet Punch",colors:["#b5b4bd","#e3e2e9","#ffffff","#8b5cf6","#000000","#ef4444","#06b6d4","#fbbf24"]},citrusBlast:{label:"Citrus Blast",colors:["#b9b7b0","#e6e4dd","#ffffff","#f59e0b","#000000","#ec4899","#3b82f6","#10b981"]},cobaltSpark:{label:"Cobalt Spark",colors:["#b3b6bc","#e1e4e9","#ffffff","#2563eb","#000000","#f97316","#ec4899","#eab308"]}};let tt="industrialTeal",et=["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],nt=5,at=et[nt]||"#ff4013";function ot(t=et){try{const e=document.documentElement,n=(t&&t.length?t:et).slice(0,8);for(let t=0;t<8;t++){const a=n[t]||"#ffffff";e.style.setProperty(`--ball-${t+1}`,a)}}catch(t){}}const it=[.5,.25,.12,.06,.03,.02,.01,.01];function st(){try{if(!et||0===et.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let e=0;for(let n=0;n<Math.min(et.length,it.length);n++)if(e+=it[n],t<=e)return et[n];return et[Math.min(et.length-1,7)]}catch(t){return console.error("Error picking random color:",t),"#ffffff"}}let lt=255,rt=274e3,ht=4.4,dt=m,ct=m,ut=!1,mt=!1;("ontouchstart"in window||navigator.maxTouchPoints>0)&&(mt=!0);const gt="bouncyBallsSettings";function ft(){const t={currentMode:e,gravityMultiplierPit:a,repellerEnabledPit:o,attractionPower:i,orbitRadius:s,swarmSpeed:l,weightlessInitialSpeed:h,weightlessBounce:d,weightlessMaxBalls:weightlessMaxBalls,weightlessRepellerPower:c,weightlessRepellerRadius:u,restitution:R,friction:F,sizeScale:N,sizeVariation:U,ballMassKg:H,ballSoftness:n,repelPower:rt,repelRadius:lt,repelSoft:ht,cornerRadius:xt,motionBlur:trailFade,trailSubtlety:It,currentTemplate:tt,cursorBallColor:at};try{localStorage.setItem(gt,JSON.stringify(t)),console.log("âœ“ Settings saved")}catch(t){console.warn("Could not save settings:",t)}}function yt(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(ft,500)}const pt=1e3;let xt=0;const vt="#hero-text";let Et=[],Mt=.025,It=1.8,bt=!0,St=0,Ct=-135,Bt=.15,wt=2,Tt=.7,Lt=0,Vt=0,Rt=0,Ft=0,Pt=0;const qt=document.getElementById("render-fps"),At=document.getElementById("physics-fps");class zt{constructor(t,e,n,a){this.x=t,this.y=e,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=n,this.rBase=n,this.m=H,this.color=a,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1}step(n){this.t+=n,this.age+=n,e!==t.WEIGHTLESS&&(this.vy+=V*$*n);const a=Math.max(.25,this.m/1),o=e===t.WEIGHTLESS?1e-4:F,s=Math.max(0,1-o/a);this.vx*=s,this.vy*=s,0!==this.driftAx&&this.age<this.driftTime?this.vx+=this.driftAx*n/a:0!==this.driftAx&&(this.driftAx=0),function(n,a){e!==t.PIT?e!==t.FLIES?e===t.WEIGHTLESS&&function(t,e){if(dt===m||ct===m)return;if(c<=0||u<=0)return;const n=u*M,a=t.x-dt,o=t.y-ct,i=a*a+o*o;if(i>n*n)return;const s=Math.max(Math.sqrt(i),g),l=a/s,r=o/s,h=Math.max(0,1-s/n),d=c*h;t.vx+=l*d*e,t.vy+=r*d*e}(n,a):function(t,e){const n=dt===m?.5*p.width:dt,a=ct===m?.5*p.height:ct,o=n-t.x,s=a-t.y,r=o*o+s*s,h=Math.sqrt(r+1),d=o/h,c=s/h,u=i*l*2;t.vx+=d*u*e,t.vy+=c*u*e;const g=120*M;let f=0,y=0,x=0;for(let e=0;e<Gt.length;e++){const n=Gt[e];if(n===t)continue;const a=t.x-n.x,o=t.y-n.y,i=a*a+o*o;if(i<g*g&&i>0){const t=Math.sqrt(i),e=1-t/g;f+=a/t*e,y+=o/t*e,x++}}if(x>0){const n=15e3;t.vx+=f/x*n*e,t.vy+=y/x*n*e}const v=2500*l;if(Math.random()<.08){const e=Math.random()*Math.PI*2,n=1500*l;t.vx+=Math.cos(e)*n,t.vy+=Math.sin(e)*n}t.vx+=(Math.random()-.5)*v*e,t.vy+=(Math.random()-.5)*v*e;const E=.3+2*Math.random(),I=2e3*l*E*e;t.vx+=-c*I,t.vy+=d*I;const b=2200*l,S=Math.sqrt(t.vx*t.vx+t.vy*t.vy);S>b&&(t.vx=t.vx/S*b,t.vy=t.vy/S*b),t.vx*=.995,t.vy*=.995}(n,a):function(t,e){if(!ut)return;if(rt<=0||lt<=0)return;const n=lt*M,a=t.x-dt,o=t.y-ct,i=a*a+o*o;if(i>n*n)return;const s=Math.max(Math.sqrt(i),g),l=a/s,r=o/s,h=Math.max(0,1-s/n),d=20*rt*Math.pow(h,ht),c=Math.max(.25,t.m/1);t.vx+=l*d*e/c,t.vy+=r*d*e/c;t.vx+=10*(Math.random()-.5)*e,t.vy+=10*(Math.random()-.5)*e}(n,a)}(this,n),this.x+=this.vx*n,this.y+=this.vy*n;const r=Math.max(0,1-2*n);this.omega*=r,this.theta+=this.omega*n,this.theta>Math.PI?this.theta-=2*Math.PI:this.theta<-Math.PI&&(this.theta+=2*Math.PI);const h=Math.min(1,18*n);this.squashAmount+=(0-this.squashAmount)*h,this.squash=1-this.squashAmount}walls(n,a,o,i=R){const s=i;if(0===xt){if(this.y+this.r>a){this.y=a-this.r;const t=this.vy,e=this.vx-this.omega*this.r,n=Math.max(.25,this.m/1);this.omega+=e/this.r*f/n;const i=Math.max(0,1-1.5*o/n);this.vx*=i;const l=Math.abs(t)<70?0:s;this.vy=-this.vy*(l*Math.pow(1/this.m,O));const r=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(y(),.8*r),this.squash=1-this.squashAmount,this.squashNormalAngle=-Math.PI/2;const h=this.vx/this.r;this.omega+=(h-this.omega)*Math.min(1,8*o)}const i=e===t.PIT?a/3:0;if(this.y-this.r<i){this.y=i+this.r;const t=this.vy;this.vy=-this.vy*s;const e=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(y(),.8*e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI/2}if(this.x+this.r>n){this.x=n-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*s;const t=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(y(),.8*t),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*s;const t=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(y(),.8*t),this.squash=1-this.squashAmount,this.squashNormalAngle=0}}else this.handleRoundedWallCollision(n,a);this.checkTextCollisions(o)}checkTextCollisions(t){for(let t=0;t<Et.length;t++){const e=Et[t],n=Math.max(e.x,Math.min(this.x,e.x+e.width)),a=Math.max(e.y,Math.min(this.y,e.y+e.height)),o=this.x-n,i=this.y-a,s=Math.sqrt(o*o+i*i);if(s<this.r)if(0===s){const t=this.x-e.x,n=e.x+e.width-this.x,a=this.y-e.y,o=e.y+e.height-this.y,i=Math.min(t,n,a,o);i===t?(this.x=e.x-this.r,this.vx=-Math.abs(this.vx)*R):i===n?(this.x=e.x+e.width+this.r,this.vx=Math.abs(this.vx)*R):i===a?(this.y=e.y-this.r,this.vy=-Math.abs(this.vy)*R):(this.y=e.y+e.height+this.r,this.vy=Math.abs(this.vy)*R)}else{const t=this.r-s,e=o/s,n=i/s;this.x+=e*t,this.y+=n*t;const a=this.vx*e+this.vy*n;if(a<0){this.vx-=2*a*e*R,this.vy-=2*a*n*R;const t=Math.min(1,Math.abs(a)/(70*this.r));this.squash=1-y()*t,this.squashDirX=Math.abs(e)>Math.abs(n)?1:0,this.squashDirY=Math.abs(n)>Math.abs(e)?1:0}}}}handleRoundedWallCollision(t,e){const n=xt,a=[{x:n,y:n},{x:t-n,y:n},{x:t-n,y:e-n},{x:n,y:e-n}];for(let o=0;o<a.length;o++){const i=a[o],s=this.x-i.x,l=this.y-i.y,r=Math.sqrt(s*s+l*l);if(this.isInCornerRegion(i,t,e,n)&&r+this.r>n){const t=n-(r-this.r);if(t>0&&r>0){const e=s/r,n=l/r;this.x+=e*t,this.y+=n*t;const a=this.vx*e+this.vy*n;this.vx-=2*a*e*R,this.vy-=2*a*n*R;const o=Math.min(1,Math.abs(a)/(90*this.r));this.squashAmount=Math.min(y(),.8*o),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.atan2(n,e)}}}if(this.y+this.r>e&&(this.x<n||this.x>t-n)&&(this.y=e-this.r,this.vy=-this.vy*(R*Math.pow(1/this.m,O))),this.y-this.r<0&&(this.x<n||this.x>t-n)&&(this.y=this.r,this.vy=-this.vy*R),this.x+this.r>t&&(this.y<n||this.y>e-n)){this.x=t-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(R*Math.pow(1/this.m,O));const e=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(y(),e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0&&(this.y<n||this.y>e-n)){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(R*Math.pow(1/this.m,O));const t=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(y(),t),this.squash=1-this.squashAmount,this.squashNormalAngle=0}this.y+this.r>e&&this.x>=n&&this.x<=t-n&&(this.y=e-this.r,this.vy=-this.vy*(R*Math.pow(1/this.m,O))),this.y-this.r<0&&this.x>=n&&this.x<=t-n&&(this.y=this.r,this.vy=-this.vy*(R*Math.pow(1/this.m,O))),this.x+this.r>t&&this.y>=n&&this.y<=e-n&&(this.x=t-this.r,this.vx=-this.vx*(R*Math.pow(1/this.m,O))),this.x-this.r<0&&this.y>=n&&this.y<=e-n&&(this.x=this.r,this.vx=-this.vx*(R*Math.pow(1/this.m,O)))}isInCornerRegion(t,e,n,a){return t.x===a&&t.y===a?this.x<=a&&this.y<=a:t.x===e-a&&t.y===a?this.x>=e-a&&this.y<=a:t.x===e-a&&t.y===n-a?this.x>=e-a&&this.y>=n-a:t.x===a&&t.y===n-a&&this.x<=a&&this.y>=n-a}draw(t){t.save(),t.translate(this.x,this.y);const e=Math.min(y(),Math.max(0,this.squashAmount));if(e>.001){const n=1+e,a=1/n;t.rotate(this.squashNormalAngle),t.scale(n,a),t.rotate(-this.squashNormalAngle)}if(bt&&St>0){const e=St/100;if(e<=.3)!function(t,e,n,a){t.beginPath(),t.arc(0,0,e,0,2*Math.PI),t.fillStyle=n,t.fill();const o=Ct*Math.PI/180,i=Math.cos(o),s=Math.sin(o),l=1-Bt*a*2,r=t.createRadialGradient(i*e*.2,s*e*.2,e*l,0,0,e);r.addColorStop(0,"rgba(255,255,255,0)"),r.addColorStop(Math.max(0,l-.1),"rgba(255,255,255,0)"),r.addColorStop(.95,`rgba(255,255,255,${.25*a})`),r.addColorStop(1,`rgba(255,255,255,${.4*a})`),t.fillStyle=r,t.fill();const h=t.createRadialGradient(-i*e*.2,-s*e*.2,e*l,0,0,e);h.addColorStop(0,"rgba(0,0,0,0)"),h.addColorStop(Math.max(0,l-.1),"rgba(0,0,0,0)"),h.addColorStop(.95,`rgba(0,0,0,${.2*a})`),h.addColorStop(1,`rgba(0,0,0,${.35*a})`),t.fillStyle=h,t.fill()}(t,this.r,this.color,e/.3);else if(e<=.7){const n=(e-.3)/.4;!function(t,e,n,a){const o=Ct*Math.PI/180,i=Math.cos(o)*e*.3,s=Math.sin(o)*e*.3,l=t.createRadialGradient(i,s,0,0,0,e),r=Wt(n,.3*a),h=kt(n,.25*a);if(l.addColorStop(0,r),l.addColorStop(.5+.2*(1-a),n),l.addColorStop(1,h),t.beginPath(),t.arc(0,0,e,0,2*Math.PI),t.fillStyle=l,t.fill(),a>.3){const n=t.createRadialGradient(1.2*i,1.2*s,0,1.2*i,1.2*s,.4*e),o=Tt*(a-.3)/.7*.5;n.addColorStop(0,`rgba(255,255,255,${o})`),n.addColorStop(.6,`rgba(255,255,255,${.2*o})`),n.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=n,t.fill()}}(t,this.r,this.color,n)}else{const n=(e-.7)/.3;!function(t,e,n,a){const o=Ct*Math.PI/180,i=Math.cos(o)*e*.35,s=Math.sin(o)*e*.35,l=t.createRadialGradient(i,s,0,0,0,e),r=Wt(n,.45+.15*a),h=kt(n,.35+.15*a);l.addColorStop(0,r),l.addColorStop(.4,n),l.addColorStop(1,h),t.beginPath(),t.arc(0,0,e,0,2*Math.PI),t.fillStyle=l,t.fill();const d=t.createRadialGradient(1.15*i,1.15*s,0,1.15*i,1.15*s,.5*e),c=Tt*(.7+.3*a);d.addColorStop(0,`rgba(255,255,255,${c})`),d.addColorStop(.4,`rgba(255,255,255,${.3*c})`),d.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=d,t.fill()}(t,this.r,this.color,n)}}else t.beginPath(),t.arc(0,0,this.r,0,2*Math.PI),t.fillStyle=this.color,t.fill();t.restore()}}const Gt=[];function Nt(t,e,n){return Math.max(e,Math.min(n,t))}function Ut(t){if(t.startsWith("rgb")){const e=t.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(e)return{r:parseInt(e[1]),g:parseInt(e[2]),b:parseInt(e[3])}}const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:128,g:128,b:128}}function Wt(t,e){const n=Ut(t);return`rgb(${Math.min(255,Math.round(n.r+(255-n.r)*e))}, ${Math.min(255,Math.round(n.g+(255-n.g)*e))}, ${Math.min(255,Math.round(n.b+(255-n.b)*e))})`}function kt(t,e){const n=Ut(t);return`rgb(${Math.max(0,Math.round(n.r*(1-e)))}, ${Math.max(0,Math.round(n.g*(1-e)))}, ${Math.max(0,Math.round(n.b*(1-e)))})`}function Ht(t,e){return t+Math.random()*(e-t)}function Ot(t,e,n=st()){const a=(_+j)/2;let o;if(0===U)o=a;else{const t=.1*a;o=Ht(Math.max(1,a-t),a+t)}const i=new zt(t,e,o,n),s=.5*p.width,l=J?K>=0?1:-1:t<s?1:-1,r=Nt(o/(.5*(_+j)),.6,1.4),h=140*r,d=180*r;return i.vx=l*(h+Math.random()*d),i.vy=120*-Math.random(),i.driftAx=l*(360+420*Math.random())*r,i.driftTime=.22+.28*Math.random(),Gt.push(i),i}let $t=0;function Dt(){const t=p.clientWidth,e=p.clientHeight,n=Nt(C/100*t,0,t);let a=Nt(b/100*t,0,t);if(J){const e=.2*t,n=a;a=Nt(a+Math.sin(X)*e,0,t),K=a>=n?1:-1}const o=Math.min(40,.1*n),i=Nt(a-n/2-o,-o,t),s=Nt(a+n/2+o,-o,t),l=S/100*e,r=l+B/100*e,h=Math.random();return{x:(i+(s-i)*(K>0?Math.pow(h,.7):1-Math.pow(1-h,.7)))*M,y:Ht(l*M,r*M)-(j+2+Ht(0,10*M))}}const _t=new Map;function jt(t=6){const e=function(){const t=Gt.length;if(t<2)return[];const e=Math.max(1,2*j),n=Math.ceil(p.width/e)+1;_t.clear();for(let a=0;a<t;a++){const t=Gt[a],o=t.x/e|0,i=(t.y/e|0)*n+o;let s=_t.get(i);s||(s=[],_t.set(i,s)),s.push(a)}const a=[];for(const[t,e]of _t){const o=t/n|0,i=t%n;for(let t=-1;t<=1;t++)for(let s=-1;s<=1;s++){const l=(o+t)*n+(i+s),r=_t.get(l);if(r)for(let t=0;t<e.length;t++){const n=e[t];for(let t=0;t<r.length;t++){const e=r[t];if(e<=n)continue;const o=Gt[n],i=Gt[e],s=i.x-o.x,l=i.y-o.y,h=o.r+i.r,d=s*s+l*l;if(d<h*h){const t=h-Math.sqrt(Math.max(d,1e-6));a.push({i:n,j:e,overlap:t})}}}}}return a.sort((t,e)=>e.overlap-t.overlap),a}();for(let n=0;n<t;n++)for(let t=0;t<e.length;t++){const{i:n,j:a}=e[t],o=Gt[n],i=Gt[a],s=i.x-o.x,l=i.y-o.y,r=o.r+i.r,h=s*s+l*l;if(0===h||h>r*r)continue;const d=Math.sqrt(h),c=s/d,u=l/d,m=r-d,g=1/Math.max(o.m,.001),f=1/Math.max(i.m,.001),p=.8*Math.max(m-A,0)/(g+f),x=p*c,v=p*u;o.x-=x*g,o.y-=v*g,i.x+=x*f,i.y+=v*f;const E=i.vx-o.vx,M=i.vy-o.vy,I=E*c+M*u;if(I<0){const t=-(1+(Math.abs(I)<30?0:R))*I/(g+f),e=t*c,n=t*u;o.vx-=e*g,o.vy-=n*g,i.vx+=e*f,i.vy+=n*f;const a=E-I*c,s=M-I*u,l=Math.hypot(a,s);if(l>.001){const t=a*-u+s*c>=0?1:-1,e=.18;o.omega-=t*e*l/Math.max(o.r,1),i.omega+=t*e*l/Math.max(i.r,1)}const r=Math.min(1,Math.abs(I)/(50*(o.r+i.r))),h=Math.min(y(),.8*r);o.squashAmount=Math.max(o.squashAmount,.8*h),o.squashNormalAngle=Math.atan2(-u,-c),i.squashAmount=Math.max(i.squashAmount,.8*h),i.squashNormalAngle=Math.atan2(u,c)}}}let Zt=performance.now()/1e3,Yt=0;const Jt=1/120;function Xt(){const t=parseFloat(ee.value);N=t,Z();const e=(_+j)/2;for(let t=0;t<Gt.length;t++)if(0===U)Gt[t].r=e,Gt[t].rBase=e;else{const n=.1*e,a=Math.max(1,e-n),o=e+n;Gt[t].r=Ht(a,o),Gt[t].rBase=Gt[t].r}}console.log("High refresh mode enabled - using requestAnimationFrame"),requestAnimationFrame(function n(a){const o=a/1e3;let i=Math.min(.008,o-Zt);Zt=o,Yt+=i,Lt++,(qt||At)&&o-Rt>=1&&(qt&&Lt!==Ft&&(Ft=Lt,qt.textContent=Ft.toString()),At&&Vt!==Pt&&(Pt=Vt,At.textContent=Pt.toString()),Lt=0,Vt=0,Rt=o),function(n){if(e!==t.WEIGHTLESS)for($t+=n;$t>=P;){const t=(Math.random()-.5)*P*.5;$t-=P+t,X+=2*Math.PI*.12*(P+t);const e=Dt(),n=Math.random()<.35?3:1;for(let t=0;t<n;t++)if(Gt.length<q){const n=8*t*(Math.random()<.5?1:-1);Ot(e.x+n,e.y-12*t)}}}(i),Lt%60==0&&Y();let s=0;for(;Yt>=Jt&&s<2;){for(let t=0;t<Gt.length;t++)Gt[t].step(Jt);e!==t.FLIES&&jt(3);const n=e===t.WEIGHTLESS?d:R;for(let t=0;t<Gt.length;t++)Gt[t].walls(p.width,p.height,Jt,n);Yt-=Jt,s++,Vt++}Yt>3*Jt&&(Yt=0),x.clearRect(0,0,p.width,p.height),xt>0&&function(t,e,n){const a=xt;t.strokeStyle="rgba(255, 255, 255, 0.1)",t.lineWidth=2,t.beginPath(),t.moveTo(a,0),t.lineTo(e-a,0),t.arcTo(e,0,e,a,a),t.lineTo(e,n-a),t.arcTo(e,n,e-a,n,a),t.lineTo(a,n),t.arcTo(0,n,0,n-a,a),t.lineTo(0,a),t.arcTo(0,0,a,0,a),t.closePath(),t.stroke()}(x,p.width,p.height);for(let t=0;t<Gt.length;t++)Gt[t].draw(x);if(function(t){if(mt)return;if(dt===m||ct===m)return;const e=dt,n=ct,a=(_+j)/2;t.beginPath(),t.arc(e,n,a,0,2*Math.PI),t.fillStyle="rgba(255, 255, 255, 0.9)",t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.6)",t.lineWidth=2,t.stroke()}(x),!mt){x.save(),x.font="14px system-ui, -apple-system, sans-serif",x.fillStyle="rgba(255, 255, 255, 0.3)",x.textAlign="left",x.textBaseline="bottom";const t=e.charAt(0).toUpperCase()+e.slice(1);x.fillText(t+" Mode",10,p.height-10),x.restore()}requestAnimationFrame(n)}),window.addEventListener("keydown",n=>{const a=n.key.toLowerCase();"r"===a&&(function(){if(e===t.WEIGHTLESS)Tn();else for(let t=0;t<Gt.length;t++){const e=Gt[t],n=Dt();e.x=n.x,e.y=n.y;const a=.5*p.width,o=J?K>=0?1:-1:e.x<a?1:-1,i=Nt(e.r/(.5*(_+j)),.6,1.4),s=140*i,l=180*i,r=120;e.vx=o*(s+Math.random()*l),e.vy=-Math.random()*r,e.age=0,e.driftAx=o*(360+420*Math.random())*i,e.driftTime=.22+.28*Math.random()}}(),n.preventDefault()),"/"===a&&v&&(n.preventDefault(),v.classList.toggle("hidden")),"1"===a&&Ln(t.PIT),"2"===a&&Ln(t.FLIES),"3"===a&&Ln(t.WEIGHTLESS)}),function(t=160){for(let e=0;e<t&&Gt.length<q;e++){const t=Dt();Ot(t.x,t.y)}}(200),p.addEventListener("mousemove",n=>{const a=p.getBoundingClientRect();dt=(n.clientX-a.left)*M,ct=(n.clientY-a.top)*M,e===t.PIT&&rt>0&&lt>0&&(ut=!0)}),p.addEventListener("mouseleave",()=>{dt=m,ct=m});const Kt=document.getElementById("restitutionSlider"),Qt=document.getElementById("frictionSlider"),te=document.getElementById("emitterSlider"),ee=document.getElementById("sizeSliderGlobal"),ne=document.getElementById("sizeVariationSliderGlobal"),ae=(document.getElementById("weightSliderGlobal"),document.getElementById("ballSoftnessSliderGlobal")),oe=document.getElementById("sizeValGlobal"),ie=document.getElementById("sizeVariationValGlobal"),se=(document.getElementById("weightValGlobal"),document.getElementById("ballSoftnessValGlobal")),le=(document.getElementById("sizeSliderPit"),document.getElementById("sizeVariationSliderPit"),document.getElementById("weightSliderPit"),document.getElementById("ballSoftnessSliderPit"),document.getElementById("sizeValPit"),document.getElementById("sizeVariationValPit"),document.getElementById("weightValPit"),document.getElementById("ballSoftnessValPit"),document.getElementById("sizeSliderFlies"),document.getElementById("sizeVariationSliderFlies"),document.getElementById("weightSliderFlies"),document.getElementById("ballSoftnessSliderFlies"),document.getElementById("sizeValFlies"),document.getElementById("sizeVariationValFlies"),document.getElementById("weightValFlies"),document.getElementById("ballSoftnessValFlies"),document.getElementById("sizeSliderZeroG"),document.getElementById("sizeVariationSliderZeroG"),document.getElementById("weightSliderZeroG"),document.getElementById("ballSoftnessSliderZeroG"),document.getElementById("sizeValZeroG"),document.getElementById("sizeVariationValZeroG"),document.getElementById("weightValZeroG"),document.getElementById("ballSoftnessValZeroG"),document.getElementById("maxBallsSlider")),re=document.getElementById("spawnYSlider"),he=document.getElementById("spawnWidthSlider"),de=document.getElementById("spawnCenterSlider"),ce=document.getElementById("spawnHeightSlider"),ue=document.getElementById("repelSizeSlider"),me=document.getElementById("repelPowerSlider"),ge=document.getElementById("repelSoftSlider"),fe=document.getElementById("colorSelect"),ye=document.getElementById("color1"),pe=document.getElementById("color2"),xe=document.getElementById("color3"),ve=document.getElementById("color4"),Ee=document.getElementById("color5"),Me=document.getElementById("color6"),Ie=document.getElementById("color7"),be=document.getElementById("color8"),Se=document.getElementById("cursorColorSelect"),Ce=document.getElementById("color1Val"),Be=document.getElementById("color2Val"),we=document.getElementById("color3Val"),Te=document.getElementById("color4Val"),Le=document.getElementById("color5Val"),Ve=document.getElementById("color6Val"),Re=document.getElementById("color7Val"),Fe=document.getElementById("color8Val");[Ce,Be,we,Te,Le,Ve,Re,Fe].forEach(t=>{t&&t.setAttribute("title","Click to copy")});const Pe=document.getElementById("cornerRadiusSlider"),qe=document.getElementById("cornerRadiusVal"),Ae=document.getElementById("trailFadeSlider"),ze=document.getElementById("trailFadeVal"),Ge=document.getElementById("trailSubtletySlider"),Ne=document.getElementById("trailSubtletyVal"),Ue=document.getElementById("restitutionVal"),We=document.getElementById("frictionVal"),ke=document.getElementById("emitterVal"),He=document.getElementById("maxBallsVal"),Oe=document.getElementById("spawnYVal"),$e=document.getElementById("spawnWidthVal"),De=document.getElementById("spawnCenterVal"),_e=document.getElementById("spawnHeightVal"),je=document.getElementById("repelSizeVal"),Ze=document.getElementById("repelPowerVal"),Ye=document.getElementById("repelSoftVal");function Je(){return{gravityMultiplier:L,restitution:R,friction:F,ballMass:H,emitRate:P,maxBalls:q,ballScale:N,ballVariation:U,spawnX:b,spawnY:S,spawnWidth:C,spawnHeight:B,sweepEnabled:J,repelRadius:lt,repelPower:rt,repelSoftness:ht,trailFade:trailFade,trailSubtlety:It,colors:et.slice(),colorWeights:it.slice(),currentTemplate:tt,cursorColorIndex:nt}}const Xe=document.getElementById("saveConfigBtn"),Ke=document.getElementById("buildBtn"),Qe=document.getElementById("configOutput");function tn(t,e){t&&t.addEventListener("click",async()=>{const n="function"==typeof e?e():String(e||"").trim();try{await navigator.clipboard.writeText(n);const e=t.textContent;t.textContent="COPIED",t.style.color="#3ddc84",setTimeout(()=>{t.textContent=e,t.style.color="#888"},900)}catch(t){console.warn("Clipboard unavailable")}})}Xe&&Ke&&Qe&&(Xe.addEventListener("click",()=>{const t=(e=Je(),`// Generated configuration from frontend\nconst CONFIG = ${JSON.stringify(e,null,2)};`);var e;Qe.style.display="block",Qe.textContent=t,navigator.clipboard.writeText(t).then(()=>{const t=Xe.textContent;Xe.textContent="âœ… Copied!",setTimeout(()=>{Xe.textContent=t},1200)}).catch(()=>{console.warn("Clipboard copy failed");const t=Xe.textContent;Xe.textContent="âš ï¸ Copy failed",setTimeout(()=>{Xe.textContent=t},1200)})}),Ke.addEventListener("click",()=>{const t=Je();Qe.style.display="block",Qe.innerHTML="\n<strong>ðŸš€ Build Instructions:</strong><br>\n1. Run: <code>npm run build</code><br>\n2. Your current config will be baked into <code>public/js/bouncy-balls-embed.js</code>";const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download="current-config.json",a.click(),URL.revokeObjectURL(n)})),Kt&&Kt.addEventListener("input",()=>{R=parseFloat(Kt.value),Ue&&(Ue.textContent=R.toFixed(2)),yt()}),Qt&&Qt.addEventListener("input",()=>{F=parseFloat(Qt.value),We&&(We.textContent=F.toFixed(4)),yt()}),te&&te.addEventListener("input",()=>{P=parseFloat(te.value),ke&&(ke.textContent=P.toFixed(3)),yt()}),function(t){if(!t)return;const{size:e,sizeVal:a,sizeVar:o,sizeVarVal:i,soft:s,softVal:l}=t;e&&e.addEventListener("input",()=>{const t=parseFloat(e.value);a&&(a.textContent=t.toFixed(1)),N=t,Z();for(let t=0;t<Gt.length;t++)Gt[t].m=H;yt()}),o&&o.addEventListener("input",()=>{const t=parseFloat(o.value);i&&(i.textContent=t.toFixed(1)),U=t,yt()}),s&&s.addEventListener("input",()=>{const t=parseInt(s.value,10);l&&(l.textContent=String(t)),n=t,yt()})}({size:ee,sizeVal:oe,sizeVar:ne,sizeVarVal:ie,soft:ae,softVal:se}),le&&le.addEventListener("input",()=>{q=parseInt(le.value,10),He&&(He.textContent=q.toString()),Gt.length>q&&(Gt.length=q)}),ne&&ne.addEventListener("input",()=>{U=parseFloat(ne.value),ie&&(ie.textContent=U.toFixed(1)),an()});const en=document.getElementById("weightPitSlider"),nn=document.getElementById("weightPitVal");function an(){const t=(_+j)/2;for(let e=0;e<Gt.length;e++){const n=Gt[e];if(0===U)n.r=t;else{const e=.1*t,a=Math.max(1,t-e),o=t+e;n.r=Ht(a,o)}n.m=H}}document.getElementById("weightWeightlessSlider"),document.getElementById("weightWeightlessVal"),re&&re.addEventListener("input",()=>{S=parseFloat(re.value),Oe&&(Oe.textContent=S.toFixed(0)),w()}),he&&he.addEventListener("input",()=>{C=parseFloat(he.value),$e&&($e.textContent=C.toFixed(0))}),de&&de.addEventListener("input",()=>{b=parseFloat(de.value),De&&(De.textContent=b.toFixed(0))}),ce&&ce.addEventListener("input",()=>{B=parseFloat(ce.value),_e&&(_e.textContent=B.toFixed(0))}),ue&&ue.addEventListener("input",()=>{lt=parseFloat(ue.value),je&&(je.textContent=lt.toFixed(0)),ut=ut||rt>0&&lt>0}),me&&me.addEventListener("input",()=>{rt=function(t){const e=Math.max(0,Math.min(pt,Number(t)))/pt;return 2*Math.pow(2,12*(e-.5))*12e3}(me.value),Ze&&(Ze.textContent=Math.round(rt).toString()),Zn&&"off"!==Zn.value&&(ut=rt>0&&lt>0)}),ge&&ge.addEventListener("input",()=>{ht=parseFloat(ge.value),Ye&&(Ye.textContent=ht.toFixed(1))}),fe&&fe.addEventListener("change",()=>{const t=Q[fe.value];t&&(tt=fe.value,et=t.colors.slice(),at=et[nt]||at,ye&&Ce&&(ye.value=et[0],Ce.textContent=et[0].toUpperCase()),pe&&Be&&(pe.value=et[1],Be.textContent=et[1].toUpperCase()),xe&&we&&(xe.value=et[2],we.textContent=et[2].toUpperCase()),ve&&Te&&(ve.value=et[3],Te.textContent=et[3].toUpperCase()),Ee&&Le&&(Ee.value=et[4],Le.textContent=et[4].toUpperCase()),Me&&Ve&&(Me.value=et[5],Ve.textContent=et[5].toUpperCase()),Ie&&Re&&(Ie.value=et[6],Re.textContent=et[6].toUpperCase()),be&&Fe&&(be.value=et[7],Fe.textContent=et[7].toUpperCase()),Vn(),ot())});const on=Array.from(document.querySelectorAll(".mode-button")),sn=document.getElementById("pitControls"),ln=document.getElementById("fliesControls"),rn=document.getElementById("weightlessControls"),hn=document.getElementById("gravityPitSlider"),dn=document.getElementById("gravityPitVal"),cn=document.getElementById("repellerEnabledPit"),un=document.getElementById("attractPowerSlider"),mn=document.getElementById("attractPowerVal"),gn=document.getElementById("orbitRadiusSlider"),fn=document.getElementById("orbitRadiusVal"),yn=document.getElementById("swarmSpeedSlider"),pn=document.getElementById("swarmSpeedVal"),xn=document.getElementById("weightlessCountSlider"),vn=document.getElementById("weightlessCountVal"),En=document.getElementById("weightlessSpeedSlider"),Mn=document.getElementById("weightlessSpeedVal"),In=document.getElementById("weightlessBounceSlider"),bn=document.getElementById("weightlessBounceVal"),Sn=document.getElementById("weightlessRepelSlider"),Cn=document.getElementById("weightlessRepelVal"),Bn=document.getElementById("weightlessRepelRadiusSlider"),wn=document.getElementById("weightlessRepelRadiusVal");function Tn(){Gt.length=0;const t=r,e=p.width,n=p.height,a=e/n,o=Math.ceil(Math.sqrt(t*a)),i=Math.ceil(t/o),s=(e-80)/Math.max(1,o-1),l=(n-80)/Math.max(1,i-1),d=[];for(let a=0;a<i;a++)for(let i=0;i<o&&!(d.length>=t);i++){const t=40+i*s,o=40+a*l,r=(Math.random()-.5)*s*.25,h=(Math.random()-.5)*l*.25;d.push({x:Math.max(20,Math.min(e-20,t+r)),y:Math.max(20,Math.min(n-20,o+h))})}for(const t of d){const e=Ot(t.x,t.y),n=Math.random()*Math.PI*2,a=h*(.7+.3*Math.random());e.vx=Math.cos(n)*a,e.vy=Math.sin(n)*a,e.driftAx=0,e.driftTime=0}}function Ln(n){e=n,E.className="",e===t.PIT&&E.classList.add("mode-pit"),w(),e===t.PIT?(L=a,V=T*L,ut=o&&rt>0&&lt>0,J=!0,Gt.length=0,$t=0,Xt()):e===t.FLIES?(L=0,V=T*L,ut=!1,J=!1,function(){Gt.length=0;const t=.5*p.width,e=.5*p.height,n=150*M;for(let a=0;a<60;a++){const a=Math.random()*Math.PI*2,o=Math.random()*n,i=Ot(t+Math.cos(a)*o,e+Math.sin(a)*o),s=.5+.5*Math.random(),l=Math.random()*Math.PI*2,r=300*s;i.vx=Math.cos(l)*r,i.vy=Math.sin(l)*r,i.driftAx=0,i.driftTime=0}}(),Xt()):e===t.WEIGHTLESS&&(L=0,V=T*L,ut=!1,J=!1,Tn(),Xt()),sn&&sn.classList.toggle("active",e===t.PIT),ln&&ln.classList.toggle("active",e===t.FLIES),rn&&rn.classList.toggle("active",e===t.WEIGHTLESS),on.forEach(t=>t.classList.toggle("active",t.getAttribute("data-mode")===e))}function Vn(){for(let t=0;t<Gt.length;t++)Gt[t].color=st()}on.forEach(t=>t.addEventListener("click",()=>{Ln(t.getAttribute("data-mode")),yt()})),hn&&hn.addEventListener("input",()=>{a=parseFloat(hn.value),dn&&(dn.textContent=a.toFixed(1)),yt(),e===t.PIT&&(L=a,V=T*L)}),en&&en.addEventListener("input",()=>{H=parseFloat(en.value),nn&&(nn.textContent=H.toFixed(2));for(let t=0;t<Gt.length;t++)Gt[t].m=H;D(),yt()}),cn&&cn.addEventListener("change",()=>{o=!!cn.checked,e===t.PIT&&(ut=o&&rt>0&&lt>0)}),un&&un.addEventListener("input",()=>{i=parseFloat(un.value),mn&&(mn.textContent=Math.round(i).toString())}),gn&&gn.addEventListener("input",()=>{s=parseFloat(gn.value),fn&&(fn.textContent=Math.round(s).toString())}),yn&&yn.addEventListener("input",()=>{l=parseFloat(yn.value),pn&&(pn.textContent=l.toFixed(1))}),xn&&xn.addEventListener("input",()=>{r=parseInt(xn.value,10),vn&&(vn.textContent=r.toString()),e===t.WEIGHTLESS&&Tn()}),En&&En.addEventListener("input",()=>{h=parseFloat(En.value),Mn&&(Mn.textContent=Math.round(h).toString())}),In&&In.addEventListener("input",()=>{d=parseFloat(In.value),bn&&(bn.textContent=d.toFixed(2))}),Sn&&Sn.addEventListener("input",()=>{c=parseFloat(Sn.value),Cn&&(Cn.textContent=Math.round(c).toString()),yt()}),Bn&&Bn.addEventListener("input",()=>{u=parseFloat(Bn.value),wn&&(wn.textContent=Math.round(u).toString()),yt()}),ye&&ye.addEventListener("input",()=>{et[0]=ye.value,Ce&&(Ce.textContent=ye.value.toUpperCase()),Vn(),ot()}),pe&&pe.addEventListener("input",()=>{et[1]=pe.value,Be&&(Be.textContent=pe.value.toUpperCase()),Vn(),ot()}),xe&&xe.addEventListener("input",()=>{et[2]=xe.value,we&&(we.textContent=xe.value.toUpperCase()),Vn(),ot()}),ve&&ve.addEventListener("input",()=>{et[3]=ve.value,Te&&(Te.textContent=ve.value.toUpperCase()),Vn(),ot()}),Ee&&Ee.addEventListener("input",()=>{et[4]=Ee.value,Le&&(Le.textContent=Ee.value.toUpperCase()),Vn(),ot()}),Me&&Me.addEventListener("input",()=>{et[5]=Me.value,Ve&&(Ve.textContent=Me.value.toUpperCase()),Vn(),ot()}),Ie&&Ie.addEventListener("input",()=>{et[6]=Ie.value,Re&&(Re.textContent=Ie.value.toUpperCase()),Vn(),ot()}),be&&be.addEventListener("input",()=>{et[7]=be.value,Fe&&(Fe.textContent=be.value.toUpperCase()),Vn(),ot()}),Se&&Se.addEventListener("change",()=>{const t=Math.max(1,Math.min(8,parseInt(Se.value,10)))-1;nt=t,at=et[nt]||at}),tn(Ce,()=>ye.value.toUpperCase()),tn(Be,()=>pe.value.toUpperCase()),tn(we,()=>xe.value.toUpperCase()),tn(Te,()=>ve.value.toUpperCase()),tn(Le,()=>Ee.value.toUpperCase()),tn(Ve,()=>Me.value.toUpperCase()),tn(Re,()=>Ie.value.toUpperCase()),tn(Fe,()=>be.value.toUpperCase()),Pe&&Pe.addEventListener("input",()=>{xt=parseFloat(Pe.value),qe&&(qe.textContent=xt.toFixed(0))}),Ae&&Ae.addEventListener("input",()=>{Mt=parseFloat(Ae.value),ze&&(ze.textContent=Mt.toFixed(3))}),Ge&&Ge.addEventListener("input",()=>{It=parseFloat(Ge.value),Ne&&(Ne.textContent=It.toFixed(2)+"Ã—")});const Rn=document.getElementById("shaderEnabled"),Fn=document.getElementById("ballRoundness"),Pn=document.getElementById("ballRoundnessVal"),qn=document.getElementById("lightAngle"),An=document.getElementById("lightAngleVal"),zn=document.getElementById("edgeBevelWidth"),Gn=document.getElementById("edgeBevelWidthVal"),Nn=document.getElementById("edgeSharpness"),Un=document.getElementById("edgeSharpnessVal"),Wn=document.getElementById("specularIntensity"),kn=document.getElementById("specularIntensityVal");Rn&&Rn.addEventListener("change",()=>{bt=Rn.checked,yt()}),Fn&&Fn.addEventListener("input",()=>{St=parseFloat(Fn.value),Pn&&(Pn.textContent=St.toFixed(0)+"%"),yt()}),qn&&qn.addEventListener("input",()=>{Ct=parseFloat(qn.value),An&&(An.textContent=Ct.toFixed(0)+"Â°"),yt()}),zn&&zn.addEventListener("input",()=>{Bt=parseFloat(zn.value)/100,Gn&&(Gn.textContent=zn.value+"%"),yt()}),Nn&&Nn.addEventListener("input",()=>{wt=parseFloat(Nn.value),Un&&(Un.textContent=wt.toFixed(1)),yt()}),Wn&&Wn.addEventListener("input",()=>{Tt=parseFloat(Wn.value)/100,kn&&(kn.textContent=Wn.value+"%"),yt()});const Hn={rubberPlayground:{label:"Rubber â€“ Playground",G:1960,REST:.9,FRICTION:.0025,sizeScale:1.8,maxBalls:450,sizeVariation:.2},rubberRacquet:{label:"Rubber â€“ Racquetball",G:3320,REST:.97,FRICTION:.0035,sizeScale:.7,maxBalls:350,sizeVariation:.3},rubberSuperball:{label:"Rubber â€“ Superball",G:1960,REST:.95,FRICTION:.0015,sizeScale:1.2,maxBalls:450,sizeVariation:.05},rubberSoft:{label:"Rubber â€“ Soft",G:1960,REST:.86,FRICTION:.0035,sizeScale:2.2,maxBalls:350,sizeVariation:.25},rubberHeavy:{label:"Rubber â€“ Heavy",G:1960,REST:.88,FRICTION:.003,sizeScale:2,maxBalls:400,sizeVariation:.15}},On={fullRain:{label:"Full Rain (top-half)",EMIT_INTERVAL:.03,xCenter:50,y:-50,w:100,h:50},narrowStrip:{label:"Narrow Strip Top",EMIT_INTERVAL:.05,xCenter:50,y:-40,w:20,h:10},leftGutter:{label:"Left Gutter",EMIT_INTERVAL:.045,xCenter:10,y:-60,w:18,h:20},rightGutter:{label:"Right Gutter",EMIT_INTERVAL:.045,xCenter:90,y:-60,w:18,h:20},centerFountain:{label:"Center Fountain",EMIT_INTERVAL:.02,xCenter:50,y:-30,w:30,h:20},stormBurst:{label:"Storm Burst",EMIT_INTERVAL:.005,xCenter:50,y:-80,w:100,h:30},slowSnow:{label:"Slow Snow",EMIT_INTERVAL:.2,xCenter:50,y:-30,w:100,h:20},edgeDrizzle:{label:"Edge Drizzle",EMIT_INTERVAL:.08,xCenter:15,y:-40,w:30,h:15},twinColumns:{label:"Twin Columns",EMIT_INTERVAL:.03,xCenter:30,y:-50,w:10,h:40},focusedBeam:{label:"Focused Beam",EMIT_INTERVAL:.015,xCenter:50,y:-70,w:6,h:12}},$n={off:{label:"Off",r:710,p:274e3,s:4.4},gentle:{label:"Gentle Breeze",r:120,p:2500,s:2.5},pushField:{label:"Push Field",r:240,p:8e4,s:2},tractor:{label:"Tractor Push",r:320,p:14e4,s:1.6},magnet:{label:"Magnet Repel",r:200,p:18e4,s:3},pulse:{label:"Pulse Strong",r:280,p:22e4,s:1.2},wideSoft:{label:"Wide Soft",r:500,p:8e4,s:4.5},needle:{label:"Needle Point",r:80,p:26e4,s:.8},wall:{label:"Invisible Wall",r:700,p:16e4,s:5},singularity:{label:"Singularity",r:600,p:3e5,s:.5}};function Dn(t,e,n){t.innerHTML="";for(const[a,o]of Object.entries(e)){const e=document.createElement("option");e.value=a,e.textContent=o.label||a,a===n&&(e.selected=!0),t.appendChild(e)}}const _n=document.getElementById("physicsSelect"),jn=document.getElementById("spawnSelect"),Zn=document.getElementById("repellerSelect");function Yn(t,e,n,a=0){t&&(t.value=String(n)),e&&(e.textContent=a>0?n.toFixed(a):n.toString())}function Jn(n){const a=Hn[n];if(!a)return;R=a.REST,F=a.FRICTION,q=a.maxBalls,U=a.sizeVariation;const o=a.sizeScale;N=o,Z();for(let n=0;n<Gt.length;n++)Gt[n].m=e===t.BOULDERS?5*H:H;Gt.length>q&&(Gt.length=q),Yn(Kt,Ue,R,2),Yn(Qt,We,F,4),Yn(ee,oe,N,1),Yn(le,He,q,0),Yn(ne,ie,U,1),an()}function Xn(t){const e=On[t];e&&(P=e.EMIT_INTERVAL,b=e.xCenter,S=e.y,C=e.w,B=e.h,Yn(te,ke,P,3),Yn(de,De,b,0),Yn(re,Oe,S,0),Yn(he,$e,C,0),Yn(ce,_e,B,0))}function Kn(t){const e=$n[t];if(!e)return;lt=e.r,rt=1*e.p,ut="off"!==t,Yn(ue,je,lt,0);const n=function(t){const e=Math.max(1,Number(t))/24e3,n=.5+Math.log2(e)/12;return Math.round(Math.max(0,Math.min(1,n))*pt)}(rt);me&&(me.value=String(n)),Ze&&(Ze.textContent=Math.round(rt).toString()),Yn(ge,Ye,ht,1)}_n&&Dn(_n,Hn,"rubberRacquet"),jn&&Dn(jn,On,"fullRain"),Zn&&Dn(Zn,$n,"off"),fe&&Dn(fe,Q,"industrialTeal"),Jn("rubberRacquet"),Xn("fullRain"),Kn("off");const Qn=Q[tt];ye&&Ce&&(ye.value=Qn.colors[0],Ce.textContent=Qn.colors[0].toUpperCase()),pe&&Be&&(pe.value=Qn.colors[1],Be.textContent=Qn.colors[1].toUpperCase()),xe&&we&&(xe.value=Qn.colors[2],we.textContent=Qn.colors[2].toUpperCase()),ve&&Te&&(ve.value=Qn.colors[3],Te.textContent=Qn.colors[3].toUpperCase()),Ee&&Le&&(Ee.value=Qn.colors[4],Le.textContent=Qn.colors[4].toUpperCase()),Me&&Ve&&(Me.value=Qn.colors[5],Ve.textContent=Qn.colors[5].toUpperCase()),Ie&&Re&&(Ie.value=Qn.colors[6],Re.textContent=Qn.colors[6].toUpperCase()),be&&Fe&&(be.value=Qn.colors[7],Fe.textContent=Qn.colors[7].toUpperCase()),ot(Qn.colors),_n&&_n.addEventListener("change",()=>Jn(_n.value)),jn&&jn.addEventListener("change",()=>Xn(jn.value)),Zn&&Zn.addEventListener("change",()=>Kn(Zn.value)),Z(),Y(),function(){try{const t=localStorage.getItem(gt);if(t){const n=JSON.parse(t);return n.currentMode&&(e=n.currentMode),void 0!==n.gravityMultiplierPit&&(a=n.gravityMultiplierPit),void 0!==n.repellerEnabledPit&&(o=n.repellerEnabledPit),n.attractionPower&&(i=n.attractionPower),n.orbitRadius&&(s=n.orbitRadius),n.swarmSpeed&&(l=n.swarmSpeed),n.weightlessInitialSpeed&&(h=n.weightlessInitialSpeed),n.weightlessBounce&&(d=n.weightlessBounce),n.weightlessMaxBalls&&(weightlessMaxBalls=n.weightlessMaxBalls),void 0!==n.weightlessRepellerPower&&(c=n.weightlessRepellerPower),void 0!==n.weightlessRepellerRadius&&(u=n.weightlessRepellerRadius),n.restitution&&(R=n.restitution),void 0!==n.friction&&(F=n.friction),n.sizeScale&&(N=n.sizeScale),void 0!==n.sizeVariation&&(U=n.sizeVariation),n.ballMassKg&&(H=n.ballMassKg),n.repelPower&&(rt=n.repelPower),n.repelRadius&&(lt=n.repelRadius),n.repelSoft&&(ht=n.repelSoft),void 0!==n.cornerRadius&&(xt=n.cornerRadius),void 0!==n.motionBlur&&(trailFade=n.motionBlur),n.trailSubtlety&&(It=n.trailSubtlety),n.currentTemplate&&(tt=n.currentTemplate),n.cursorBallColor&&(at=n.cursorBallColor),console.log("âœ“ Settings loaded"),!0}}catch(t){console.warn("Could not load settings:",t)}}(),Ln(e),window.addEventListener("beforeunload",ft)})();