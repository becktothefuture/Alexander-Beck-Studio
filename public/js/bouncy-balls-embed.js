// Bouncy Balls Simulation - Minified with Terser
(()=>{function t(){return 0===G?0:wt*(G/40)}function e(){if(!ht)return void(Lt.style.filter="none");const t=(t,e)=>`rgba(${parseInt(t.slice(1,3),16)}, ${parseInt(t.slice(3,5),16)}, ${parseInt(t.slice(5,7),16)}, ${e})`,e=`drop-shadow(${ut}px ${mt}px ${gt}px ${t(pt,yt)})`,n=xt?` drop-shadow(${ut}px ${Math.round(.5*mt)}px ${ft}px ${t(pt,vt)})`:"";Lt.style.filter=e+n}function n(){const t=new Date,e=t.getHours(),n=e>=18||e<6;return console.log(`🌍 Time check: ${e}:${t.getMinutes().toString().padStart(2,"0")} → ${n?"Night":"Day"} (sunset: 18, sunrise: 6)`),n}function o(t){Gt=t,t?Tt.classList.add("dark-mode"):Tt.classList.remove("dark-mode"),d(me),function(){const t=document.getElementById("darkModeToggle"),e=document.getElementById("darkModeStatus");if(t&&(t.checked=kt),e){const t=new Date,n=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`;Gt?(e.textContent=`🌙 Night Mode (${n})`,e.style.background="rgba(100,100,255,0.3)"):(e.textContent=`☀️ Day Mode (${n})`,e.style.background="rgba(255,200,0,0.3)")}}()}function a(){kt&&o(n())}function i(){const t=k===MODES.PIT?Et:It,e=window.innerHeight*t;if(Lt.width=Math.floor(window.innerWidth*Rt),Lt.height=Math.floor(e*Rt),k===MODES.PULSE_GRID){B();for(let t=0;t<Ue.length;t++){const e=Ue[t];e.gridX=Math.max(0,Math.min(ia-1,e.gridX)),e.gridY=Math.max(0,Math.min(aa-1,e.gridY));const n=b(e.gridX,e.gridY);e.x=n.x,e.y=n.y,e.targetX=n.x,e.targetY=n.y}}}function s(){se=Math.max(.5,Math.min(3,Math.pow(ae/1,.35)))}function l(){ne=(Lt.clientWidth||window.innerWidth)<=768?.4:1;const t=te*ne;if(null===oe)return oe=t,le=Qt*t,void(re=Kt*t);const e=t/oe;if(1!==e){for(let t=0;t<Ue.length;t++)Ue[t].r*=e;oe=t}le=Qt*t,re=Kt*t}function r(){Le=[];const t=document.querySelector(we);if(!t)return;const e=t.getBoundingClientRect(),n=Lt.getBoundingClientRect(),o=function(t){const e=document.createElement("span");e.style.cssText=window.getComputedStyle(t).cssText,e.style.position="absolute",e.style.visibility="hidden",e.style.whiteSpace="nowrap",e.textContent="ABCDEFGHIJKLMNOPQRSTUVWXYZ",document.body.appendChild(e);const n=e.getBoundingClientRect().height;return document.body.removeChild(e),n}(t),a=.5*(e.height-o),i={x:(e.left-n.left)*Rt,y:(e.top-n.top+a)*Rt,width:e.width*Rt,height:o*Rt};i.width>0&&i.height>0&&i.x<Lt.width&&i.y<Lt.height&&i.x+i.width>0&&i.y+i.height>0&&Le.push(i)}function d(t){me=t,ge=function(t){const e=ue[t];return e?Gt?e.dark:e.light:ue.industrialTeal.light}(t),pe=ge[ye]||pe,V(),c(),function(){const t=document.getElementById("color1"),e=document.getElementById("color2"),n=document.getElementById("color3"),o=document.getElementById("color4"),a=document.getElementById("color5"),i=document.getElementById("color6"),s=document.getElementById("color7"),l=document.getElementById("color8"),r=document.getElementById("color1Val"),d=document.getElementById("color2Val"),c=document.getElementById("color3Val"),h=document.getElementById("color4Val"),u=document.getElementById("color5Val"),m=document.getElementById("color6Val"),g=document.getElementById("color7Val"),y=document.getElementById("color8Val");t&&r&&(t.value=ge[0],r.textContent=ge[0].toUpperCase()),e&&d&&(e.value=ge[1],d.textContent=ge[1].toUpperCase()),n&&c&&(n.value=ge[2],c.textContent=ge[2].toUpperCase()),o&&h&&(o.value=ge[3],h.textContent=ge[3].toUpperCase()),a&&u&&(a.value=ge[4],u.textContent=ge[4].toUpperCase()),i&&m&&(i.value=ge[5],m.textContent=ge[5].toUpperCase()),s&&g&&(s.value=ge[6],g.textContent=ge[6].toUpperCase()),l&&y&&(l.value=ge[7],y.textContent=ge[7].toUpperCase())}()}function c(t=ge){try{const e=document.documentElement,n=(t&&t.length?t:ge).slice(0,8);for(let t=0;t<8;t++){const o=n[t]||"#ffffff";e.style.setProperty(`--ball-${t+1}`,o)}}catch(t){}}function h(){try{if(!ge||0===ge.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let e=0;for(let n=0;n<Math.min(ge.length,xe.length);n++)if(e+=xe[n],t<=e)return ge[n];return ge[Math.min(ge.length-1,7)]}catch(t){return console.error("Error picking random color:",t),"#ffffff"}}function u(){Fe("⚠️ localStorage is disabled")}function m(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(u,500)}function g(t,e,n){return Math.max(e,Math.min(n,t))}function y(t,e){return t+Math.random()*(e-t)}function p(t,e,n=h()){const o=(le+re)/2;let a;if(0===ee)a=o;else{const t=.1*o;a=y(Math.max(1,o-t),o+t)}const i=new Ball(t,e,a,n),s=.5*Lt.width,l=de?he>=0?1:-1:t<s?1:-1,r=g(a/(.5*(le+re)),.6,1.4),d=140*r,c=180*r;return i.vx=l*(d+Math.random()*c),i.vy=120*-Math.random(),i.driftAx=l*(360+420*Math.random())*r,i.driftTime=.22+.28*Math.random(),Ue.push(i),i}function x(){const t=Lt.clientWidth,e=Lt.clientHeight,n=g(Nt/100*t,0,t);let o=g(Ot/100*t,0,t);if(de){const e=.2*t,n=o;o=g(o+Math.sin(ce)*e,0,t),he=o>=n?1:-1}const a=Math.min(40,.1*n),i=g(o-n/2-a,-a,t),s=g(o+n/2+a,-a,t),l=Ut/100*e,r=l+Xt/100*e,d=Math.random();return{x:(i+(s-i)*(he>0?Math.pow(d,.7):1-Math.pow(1-d,.7)))*Rt,y:y(l*Rt,r*Rt)-(re+bt+y(0,10*Rt))}}function f(e=6){const n=function(){const t=Ue.length;if(t<2)return[];const e=Math.max(1,2*re),n=Math.ceil(Lt.width/e)+1;$e.clear();for(let o=0;o<t;o++){const t=Ue[o],a=t.x/e|0,i=(t.y/e|0)*n+a;let s=$e.get(i);s||(s=[],$e.set(i,s)),s.push(o)}const o=[];for(const[t,e]of $e){const a=t/n|0,i=t%n;for(let t=-1;t<=1;t++)for(let s=-1;s<=1;s++){const l=(a+t)*n+(i+s),r=$e.get(l);if(r)for(let t=0;t<e.length;t++){const n=e[t];for(let t=0;t<r.length;t++){const e=r[t];if(e<=n)continue;const a=Ue[n],i=Ue[e],s=i.x-a.x,l=i.y-a.y,d=a.r+i.r,c=s*s+l*l;if(c<d*d){const t=d-Math.sqrt(Math.max(c,St));o.push({i:n,j:e,overlap:t})}}}}}return o.sort((t,e)=>e.overlap-t.overlap),o}();for(let o=0;o<e;o++)for(let e=0;e<n.length;e++){const{i:o,j:a}=n[e],i=Ue[o],s=Ue[a],l=s.x-i.x,r=s.y-i.y,d=i.r+s.r,c=l*l+r*r;if(0===c||c>d*d)continue;const h=Math.sqrt(c),u=l/h,m=r/h,g=d-h,y=1/Math.max(i.m,.001),p=1/Math.max(s.m,.001),x=.8*Math.max(g-Jt,0)/(y+p),f=x*u,v=x*m;i.x-=f*y,i.y-=v*y,s.x+=f*p,s.y+=v*p;const E=s.vx-i.vx,I=s.vy-i.vy,M=E*u+I*m;if(M<0){const e=-(1+(Math.abs(M)<30?0:Wt))*M/(y+p),n=e*u,o=e*m;i.vx-=n*y,i.vy-=o*y,s.vx+=n*p,s.vy+=o*p;const a=E-M*u,l=I-M*m,r=Math.hypot(a,l);if(r>.001){const t=a*-m+l*u>=0?1:-1,e=Ct;i.omega-=t*e*r/Math.max(i.r,1),s.omega+=t*e*r/Math.max(s.r,1)}const d=Math.min(1,Math.abs(M)/(50*(i.r+s.r))),c=Math.min(t(),.8*d);i.squashAmount=Math.max(i.squashAmount,.8*c),i.squashNormalAngle=Math.atan2(-m,-u),s.squashAmount=Math.max(s.squashAmount,.8*c),s.squashNormalAngle=Math.atan2(m,u)}}}function v(){const t=parseFloat(yn.value);te=t,l();const e=(le+re)/2;for(let t=0;t<Ue.length;t++)if(0===ee)Ue[t].r=e,Ue[t].rBase=e;else{const n=.1*e,o=Math.max(1,e-n),a=e+n;Ue[t].r=y(o,a),Ue[t].rBase=Ue[t].r}}function E(){return{gravityMultiplier:$t,restitution:Wt,friction:jt,ballMass:ae,emitRate:_t,maxBalls:Zt,ballScale:te,ballVariation:ee,spawnX:Ot,spawnY:Ut,spawnWidth:Nt,spawnHeight:Xt,sweepEnabled:de,repelRadius:fe,repelPower:ve,repelSoftness:Ee,trailFade:Te,trailSubtlety:Ve,colors:ge.slice(),colorWeights:xe.slice(),currentTemplate:me,cursorColorIndex:ye,performanceMode:Pt,targetFPS:At,enableLOD:!0}}function I(t,e){t&&t.addEventListener("click",async()=>{const n="function"==typeof e?e():String(e||"").trim();try{await navigator.clipboard.writeText(n);const e=t.textContent;t.textContent="COPIED",t.style.color="#3ddc84",setTimeout(()=>{t.textContent=e,t.style.color="#888"},900)}catch(t){console.warn("Clipboard unavailable")}})}function M(){const t=(le+re)/2;for(let e=0;e<Ue.length;e++){const n=Ue[e];if(0===ee)n.r=t;else{const e=.1*t,o=Math.max(1,t-e),a=t+e;n.r=y(o,a)}n.m=ae}}function S(){Ue.length=0;const t=X,e=Lt.width,n=Lt.height,o=40*Rt;for(let a=0;a<t;a++){const t=p(o+Math.random()*(e-2*o),o+Math.random()*(n-2*o)),a=Math.random()*Math.PI*2,i=Y*(.7+.3*Math.random());t.vx=Math.cos(a)*i,t.vy=Math.sin(a)*i,t.driftAx=0,t.driftTime=0}}function B(){const t=Lt.width,e=Lt.height;ia=j,oa=t/ia,aa=Math.floor(e/oa),sa=(t-ia*oa)/2,la=(e-aa*oa)/2}function b(t,e){return{x:sa+(t+.5)*oa,y:la+(e+.5)*oa}}function C(t,e){for(const n of Ne){const o=n.x-t.x,a=n.y-t.y,i=o*o+a*a,s=Math.sqrt(i);if(s<5)continue;const l=n.strength/i*e;t.vx+=o/s*l,t.vy+=a/s*l}0!==rt&&(t.vx*=1-rt,t.vy*=1-rt)}function w(){Ue.length=0,function(){Ne=[],Xe=[];const t={x:Lt.width/(2*Rt),y:Lt.height/(2*Rt),strength:it,isPermanent:!0};Ne.push(t),Xe.push(t)}();const t=Lt.width/Rt,e=Lt.height/Rt,n=t/2,o=e/2,a=.15*Math.min(t,e),i=.35*Math.min(t,e);for(let t=0;t<st;t++){const e=2*Math.PI*t/st+.5*(Math.random()-.5),s=a+Math.random()*(i-a),l=n+Math.cos(e)*s,r=o+Math.sin(e)*s,d=lt*(.7+.6*Math.random()),c=-Math.sin(e)*d,h=Math.cos(e)*d,u=BASE_RADIUS*effectiveScale*(.9+.2*Math.random()),m=new Ball(l,r,u,c,h);Ue.push(m)}Fe(`🌀 Vortex scene initialized: ${st} balls in orbital ring`)}function L(){Ue.length=0,B();const t=ia*aa,e=Math.min(et,t),n=[];for(let t=0;t<aa;t++)for(let e=0;e<ia;e++)n.push({gridX:e,gridY:t});for(let t=n.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[n[t],n[e]]=[n[e],n[t]]}for(let t=0;t<e;t++){const e=n[t],o=b(e.gridX,e.gridY),a=p(o.x,o.y);a.gridX=e.gridX,a.gridY=e.gridY,a.targetX=o.x,a.targetY=o.y,a.jumpProgress=1,a.vx=0,a.vy=0,a.driftAx=0,a.driftTime=0;const i=_,s=J*Math.random()*i;a.nextJumpTime=i+s}}function T(t){k=t,function(t){const e=document.getElementById("announcer");e&&(e.textContent="",setTimeout(()=>e.textContent=t,100))}(`Switched to ${{[MODES.PIT]:"Ball Pit",[MODES.FLIES]:"Flies to Light",[MODES.WEIGHTLESS]:"Zero Gravity",[MODES.PULSE_GRID]:"Pulse Grid",[MODES.VORTEX]:"Vortex Spiral"}[t]} mode`),Tt.className="",k===MODES.PIT&&Tt.classList.add("mode-pit"),i(),k===MODES.PIT?($t=z,Ht=Yt*$t,Se=D&&ve>0&&fe>0,de=!1,Ue.length=0,Ye=0,function(){Ue.length=0;const t=Zt,e=(Lt.width,Lt.clientHeight),n=Ut/100*e*Rt,o=n+Xt/100*e*Rt,a=Nt/100*Lt.clientWidth,i=Ot/100*Lt.clientWidth-a/2;for(let e=0;e<t;e++){const t=p((i+Math.random()*a)*Rt,n+Math.random()*(o-n));t.vx=100*(Math.random()-.5),t.vy=50*Math.random(),t.driftAx=0,t.driftTime=0}}(),v()):k===MODES.FLIES?($t=0,Ht=Yt*$t,Se=!1,de=!1,function(){Ue.length=0;const t=.5*Lt.width,e=.5*Lt.height,n=150*Rt;for(let o=0;o<60;o++){const o=Math.random()*Math.PI*2,a=Math.random()*n,i=p(t+Math.cos(o)*a,e+Math.sin(o)*a),s=.5+.5*Math.random(),l=Math.random()*Math.PI*2,r=300*s;i.vx=Math.cos(l)*r,i.vy=Math.sin(l)*r,i.driftAx=0,i.driftTime=0}}(),v()):k===MODES.WEIGHTLESS?($t=0,Ht=Yt*$t,Se=!1,de=!1,S(),v()):k===MODES.PULSE_GRID?($t=0,Ht=Yt*$t,Se=!1,de=!1,L(),v()):k===MODES.VORTEX&&($t=0,Ht=Yt*$t,Se=!1,de=!1,w(),v()),function(){const t=document.getElementById("pulseGridControls"),e=document.getElementById("vortexControls");qo&&qo.classList.toggle("active",k===MODES.PIT),ko&&ko.classList.toggle("active",k===MODES.FLIES),Go&&Go.classList.toggle("active",k===MODES.WEIGHTLESS),t&&t.classList.toggle("active",k===MODES.PULSE_GRID),e&&e.classList.toggle("active",k===MODES.VORTEX),Ao.forEach(t=>{const e=t.getAttribute("data-mode")===k;t.classList.toggle("active",e),t.setAttribute("aria-pressed",e?"true":"false")})}()}function V(){for(let t=0;t<Ue.length;t++)Ue[t].color=h()}function F(t,e,n){t.innerHTML="";for(const[o,a]of Object.entries(e)){const e=document.createElement("option");e.value=o,e.textContent=a.label||o,o===n&&(e.selected=!0),t.appendChild(e)}}function R(t,e,n,o=0){t&&(t.value=String(n)),e&&(e.textContent=o>0?n.toFixed(o):n.toString())}function P(t){const e=Ra[t];if(!e)return;Wt=e.REST,jt=e.FRICTION,Zt=e.maxBalls,ee=e.sizeVariation;const n=e.sizeScale;te=n,l();for(let t=0;t<Ue.length;t++)Ue[t].m=ae;Ue.length>Zt&&(Ue.length=Zt),R(un,Kn,Wt,2),R(mn,to,jt,4),R(yn,fn,te,1),R(In,no,Zt,0),R(pn,vn,ee,1),M()}function A(t){const e=Pa[t];e&&(_t=e.EMIT_INTERVAL,Ot=e.xCenter,Ut=e.y,Nt=e.w,Xt=e.h,R(gn,eo,_t,3),R(Bn,io,Ot,0),R(Mn,oo,Ut,0),R(Sn,ao,Nt,0),R(bn,so,Xt,0))}function q(t){const e=Aa[t];if(!e)return;fe=e.r,ve=1*e.p,Se="off"!==t,R(Cn,lo,fe,0);const n=function(t){const e=Math.max(1,Number(t))/24e3,n=.5+Math.log2(e)/12;return Math.round(Math.max(0,Math.min(1,n))*be)}(ve);wn&&(wn.value=String(n)),ro&&(ro.textContent=Math.round(ve).toString()),R(Ln,co,Ee,1)}const MODES={PIT:"pit",FLIES:"flies",WEIGHTLESS:"weightless",PULSE_GRID:"pulse-grid",VORTEX:"vortex"};let k=MODES.PIT,G=20,z=1.05,D=!0,O=5e3,U=180,N=3.5,X=80,Y=250,$=.97,H=300,W=150,j=40,_=.8,Z=.25,J=.3,Q=.4,K=1,tt=3,et=120,nt=.15,ot="snap",at=1.08,it=5e3,st=200,lt=180,rt=2e-4,dt=3e3,ct=!0,ht=!1,ut=1,mt=1,gt=0,yt=.29,pt="#000000",xt=!1,ft=4,vt=.1;const Et=1.5,It=1,Mt=-1e9,St=1e-6,Bt=1e-4,bt=2,Ct=.18,wt=.2,Lt=document.getElementById("c"),Tt=document.getElementById("bravia-balls");let Vt;try{if(Vt=Lt.getContext("2d",{alpha:!0}),!Vt)throw new Error("Canvas 2D context not available");console.log("✅ Canvas initialized with alpha transparency")}catch(Da){throw console.error("❌ Failed to initialize canvas:",Da),Tt.innerHTML='\n      <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #1a1a1a; color: white; font-family: system-ui, -apple-system, sans-serif;">\n        <div style="text-align: center; padding: 40px; background: rgba(255,50,50,0.1); border: 2px solid rgba(255,50,50,0.3); border-radius: 12px; max-width: 480px;">\n          <div style="font-size: 72px; margin-bottom: 20px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));">⚠️</div>\n          <h2 style="margin: 0 0 16px 0; font-size: 24px; font-weight: 600;">Canvas Not Supported</h2>\n          <p style="margin: 0 0 12px 0; opacity: 0.9; line-height: 1.6; font-size: 15px;">Your browser doesn\'t support the HTML5 Canvas 2D features required for this interactive simulation.</p>\n          <p style="margin: 0; opacity: 0.7; font-size: 13px;">Please try a modern browser like Chrome, Firefox, Safari, or Edge.</p>\n        </div>\n      </div>\n    ',Da}const Ft=document.getElementById("controlPanel"),Rt=Math.max(1,Math.min(2,window.devicePixelRatio||1));let Pt=!1,At=60,qt="initializing",kt=!0,Gt=!1;const zt={normal:{maxBalls:350,collisionIters:2,adaptiveQualityMin:.5},performance:{maxBalls:200,collisionIters:1,adaptiveQualityMin:.3}};let Dt,Ot=50,Ut=-50,Nt=100,Xt=50;i(),window.addEventListener("resize",function(){clearTimeout(Dt),Dt=setTimeout(()=>{i(),l(),r()},150)});const Yt=1960;let $t=0,Ht=Yt*$t,Wt=.97,jt=.0035,_t=.03,Zt=350;const Jt=.5*Rt,Qt=6,Kt=24;let te=1,ee=.3,ne=1,oe=null,ae=91;const ie=.15;let se=1;s();let le=Qt*te,re=Kt*te,de=!1,ce=0,he=1;const ue={industrialTeal:{label:"Industrial Teal",light:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#6b726b","#3d453d","#8a928a","#00e6c3","#d5d5d5","#ff6b47","#5b9aff","#ffb84d"]},sunsetCoral:{label:"Sunset Coral",light:["#bdbbb8","#e8e6e3","#ffffff","#ff3b3b","#000000","#00f5d4","#1e40af","#fb923c"],dark:["#716f6b","#3f3d3a","#8e8c88","#ff6b6b","#d8d8d8","#00ffe7","#6ba3ff","#ffb570"]},violetPunch:{label:"Violet Punch",light:["#b8b7c2","#e6e5ed","#ffffff","#9333ea","#000000","#dc2626","#0ea5e9","#facc15"],dark:["#6d6c7a","#3a3845","#8b8a98","#c266ff","#dad6e8","#ff5c5c","#42d4ff","#fff066"]},citrusBlast:{label:"Citrus Blast",light:["#bfbdb5","#eae8df","#ffffff","#ea580c","#000000","#e11d48","#2563eb","#059669"],dark:["#74726a","#403e38","#918f87","#ff8c4d","#dbd9d1","#ff5c7a","#6ba3ff","#00d699"]},cobaltSpark:{label:"Cobalt Spark",light:["#b5b8be","#e3e6eb","#ffffff","#1d4ed8","#000000","#ea580c","#db2777","#d97706"],dark:["#696d75","#3a3e45","#878b93","#6b9dff","#d6dae2","#ff8c5c","#ff66b3","#ffc266"]}};let me="industrialTeal",ge=ue.industrialTeal.light.slice(),ye=4,pe=ge[ye]||"#00695c";const xe=[.5,.25,.12,.06,.03,.02,.01,.01];let fe=710,ve=274e3,Ee=3.4,Ie=Mt,Me=Mt,Se=!1,Be=!1;("ontouchstart"in window||navigator.maxTouchPoints>0)&&(Be=!0);const be=1e4;let Ce=0;const we="#hero-text";let Le=[],Te=.025,Ve=1.8;const Fe=console.log.bind(console);let Re=0,Pe=0,Ae=0,qe=0,ke=0;const Ge=document.getElementById("render-fps"),ze=document.getElementById("physics-fps");let De=2,Oe=0;class Ball{constructor(t,e,n,o){this.x=t,this.y=e,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=n,this.rBase=n,this.m=ae,this.color=o,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1}step(t){this.t+=t,this.age+=t,k!==MODES.WEIGHTLESS&&(this.vy+=Ht*se*t);const e=Math.max(.25,this.m/1),n=k===MODES.WEIGHTLESS?1e-4:jt,o=Math.max(0,1-n/e);this.vx*=o,this.vy*=o,0!==this.driftAx&&this.age<this.driftTime?this.vx+=this.driftAx*t/e:0!==this.driftAx&&(this.driftAx=0),function(t,e){k!==MODES.PIT?k!==MODES.FLIES?k!==MODES.WEIGHTLESS||function(t,e){if(Ie===Mt||Me===Mt)return;if(H<=0||W<=0)return;const n=W*Rt,o=t.x-Ie,a=t.y-Me,i=o*o+a*a;if(i>n*n)return;const s=Math.max(Math.sqrt(i),Bt),l=o/s,r=a/s,d=Math.max(0,1-s/n),c=H*d;t.vx+=l*c*e,t.vy+=r*c*e}(t,e):function(t,e){const n=Ie===Mt?.5*Lt.width:Ie,o=Me===Mt?.5*Lt.height:Me,a=n-t.x,i=o-t.y,s=a*a+i*i,l=Math.sqrt(s+1),r=a/l,d=i/l,c=O*N*2;t.vx+=r*c*e,t.vy+=d*c*e;const h=120*Rt;let u=0,m=0,g=0;for(let e=0;e<Ue.length;e++){const n=Ue[e];if(n===t)continue;const o=t.x-n.x,a=t.y-n.y,i=o*o+a*a;if(i<h*h&&i>0){const t=Math.sqrt(i),e=1-t/h;u+=o/t*e,m+=a/t*e,g++}}if(g>0){const n=15e3;t.vx+=u/g*n*e,t.vy+=m/g*n*e}const y=2500*N;if(Math.random()<.08){const e=Math.random()*Math.PI*2,n=1500*N;t.vx+=Math.cos(e)*n,t.vy+=Math.sin(e)*n}t.vx+=(Math.random()-.5)*y*e,t.vy+=(Math.random()-.5)*y*e;const p=.3+2*Math.random(),x=2e3*N*p*e;t.vx+=-d*x,t.vy+=r*x;const f=2200*N,v=Math.sqrt(t.vx*t.vx+t.vy*t.vy);v>f&&(t.vx=t.vx/v*f,t.vy=t.vy/v*f),t.vx*=.995,t.vy*=.995}(t,e):function(t,e){if(!Se)return;if(ve<=0||fe<=0)return;const n=fe*Rt,o=t.x-Ie,a=t.y-Me,i=o*o+a*a;if(i>n*n)return;const s=Math.max(Math.sqrt(i),Bt),l=o/s,r=a/s,d=Math.max(0,1-s/n),c=20*ve*Math.pow(d,Ee),h=Math.max(.25,t.m/1);t.vx+=l*c*e/h,t.vy+=r*c*e/h,t.vx+=10*(Math.random()-.5)*e,t.vy+=10*(Math.random()-.5)*e}(t,e)}(this,t),this.x+=this.vx*t,this.y+=this.vy*t;const a=Math.max(0,1-2*t);this.omega*=a,this.theta+=this.omega*t,this.theta>Math.PI?this.theta-=2*Math.PI:this.theta<-Math.PI&&(this.theta+=2*Math.PI);const i=Math.min(1,18*t);this.squashAmount+=(0-this.squashAmount)*i,this.squash=1-this.squashAmount}walls(e,n,o,a=Wt){const i=a;if(0===Ce){if(this.y+this.r>n){this.y=n-this.r;const e=this.vy,a=this.vx-this.omega*this.r,s=Math.max(.25,this.m/1);this.omega+=a/this.r*.25/s;const l=Math.max(0,1-1.5*o/s);this.vx*=l;const r=Math.abs(e)<70?0:i;this.vy=-this.vy*(r*Math.pow(1/this.m,ie));const d=Math.min(1,Math.abs(e)/(90*this.r));this.squashAmount=Math.min(t(),.8*d),this.squash=1-this.squashAmount,this.squashNormalAngle=-Math.PI/2;const c=this.vx/this.r;this.omega+=(c-this.omega)*Math.min(1,8*o)}const a=k===MODES.PIT?n/3:0;if(this.y-this.r<a){this.y=a+this.r;const e=this.vy;this.vy=-this.vy*i;const n=Math.min(1,Math.abs(e)/(90*this.r));this.squashAmount=Math.min(t(),.8*n),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI/2}if(this.x+this.r>e){this.x=e-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*i;const n=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(t(),.8*n),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*i;const e=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(t(),.8*e),this.squash=1-this.squashAmount,this.squashNormalAngle=0}}else this.handleRoundedWallCollision(e,n);this.checkTextCollisions(o)}checkTextCollisions(e){for(let e=0;e<Le.length;e++){const n=Le[e],o=Math.max(n.x,Math.min(this.x,n.x+n.width)),a=Math.max(n.y,Math.min(this.y,n.y+n.height)),i=this.x-o,s=this.y-a,l=Math.sqrt(i*i+s*s);if(l<this.r)if(0===l){const t=this.x-n.x,e=n.x+n.width-this.x,o=this.y-n.y,a=n.y+n.height-this.y,i=Math.min(t,e,o,a);i===t?(this.x=n.x-this.r,this.vx=-Math.abs(this.vx)*Wt):i===e?(this.x=n.x+n.width+this.r,this.vx=Math.abs(this.vx)*Wt):i===o?(this.y=n.y-this.r,this.vy=-Math.abs(this.vy)*Wt):(this.y=n.y+n.height+this.r,this.vy=Math.abs(this.vy)*Wt)}else{const e=this.r-l,n=i/l,o=s/l;this.x+=n*e,this.y+=o*e;const a=this.vx*n+this.vy*o;if(a<0){this.vx-=2*a*n*Wt,this.vy-=2*a*o*Wt;const e=Math.min(1,Math.abs(a)/(70*this.r));this.squash=1-t()*e,this.squashDirX=Math.abs(n)>Math.abs(o)?1:0,this.squashDirY=Math.abs(o)>Math.abs(n)?1:0}}}}handleRoundedWallCollision(e,n){const o=Ce,a=[{x:o,y:o},{x:e-o,y:o},{x:e-o,y:n-o},{x:o,y:n-o}];for(let i=0;i<a.length;i++){const s=a[i],l=this.x-s.x,r=this.y-s.y,d=Math.sqrt(l*l+r*r);if(this.isInCornerRegion(s,e,n,o)&&d+this.r>o){const e=o-(d-this.r);if(e>0&&d>0){const n=l/d,o=r/d;this.x+=n*e,this.y+=o*e;const a=this.vx*n+this.vy*o;this.vx-=2*a*n*Wt,this.vy-=2*a*o*Wt;const i=Math.min(1,Math.abs(a)/(90*this.r));this.squashAmount=Math.min(t(),.8*i),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.atan2(o,n)}}}if(this.y+this.r>n&&(this.x<o||this.x>e-o)&&(this.y=n-this.r,this.vy=-this.vy*(Wt*Math.pow(1/this.m,ie))),this.y-this.r<0&&(this.x<o||this.x>e-o)&&(this.y=this.r,this.vy=-this.vy*Wt),this.x+this.r>e&&(this.y<o||this.y>n-o)){this.x=e-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(Wt*Math.pow(1/this.m,ie));const n=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(t(),n),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0&&(this.y<o||this.y>n-o)){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(Wt*Math.pow(1/this.m,ie));const e=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(t(),e),this.squash=1-this.squashAmount,this.squashNormalAngle=0}this.y+this.r>n&&this.x>=o&&this.x<=e-o&&(this.y=n-this.r,this.vy=-this.vy*(Wt*Math.pow(1/this.m,ie))),this.y-this.r<0&&this.x>=o&&this.x<=e-o&&(this.y=this.r,this.vy=-this.vy*(Wt*Math.pow(1/this.m,ie))),this.x+this.r>e&&this.y>=o&&this.y<=n-o&&(this.x=e-this.r,this.vx=-this.vx*(Wt*Math.pow(1/this.m,ie))),this.x-this.r<0&&this.y>=o&&this.y<=n-o&&(this.x=this.r,this.vx=-this.vx*(Wt*Math.pow(1/this.m,ie)))}isInCornerRegion(t,e,n,o){return t.x===o&&t.y===o?this.x<=o&&this.y<=o:t.x===e-o&&t.y===o?this.x>=e-o&&this.y<=o:t.x===e-o&&t.y===n-o?this.x>=e-o&&this.y>=n-o:t.x===o&&t.y===n-o&&this.x<=o&&this.y>=n-o}draw(e){e.save(),e.translate(this.x,this.y);const n=Math.min(t(),Math.max(0,this.squashAmount));if(this.r>15&&n>.001){const t=1+n,o=1/t;e.rotate(this.squashNormalAngle),e.scale(t,o),e.rotate(-this.squashNormalAngle)}e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI);let o=this.color;if(k===MODES.VORTEX&&ct){const t=Math.sqrt(this.vx*this.vx+this.vy*this.vy),e=800;o=`hsl(${220-220*Math.min(t/e,1)}, 70%, 55%)`}e.fillStyle=o,e.fill(),e.restore()}}const Ue=[];let Ne=[],Xe=[],Ye=0;const $e=new Map;let He=performance.now()/1e3,We=0;const je=1/120;console.log("High refresh mode enabled - using requestAnimationFrame"),requestAnimationFrame(function frame(t){const e=t/1e3;let n=Math.min(.033,e-He);He=e,We+=n,(Ge||ze)&&Re++,(Ge||ze)&&e-Ae>=1&&(Ge&&Re!==qe&&(qe=Re,Ge.textContent=qe.toString()),ze&&Pe!==ke&&(ke=Pe,ze.textContent=ke.toString()),Re=0,Pe=0,Ae=e,function(t){t-Oe<2||(Oe=t,qe<50?(De=1,console.log("⚡ Adaptive Quality: LOW (1 collision iter) - FPS:",qe)):qe<70?(De=2,console.log("⚡ Adaptive Quality: MEDIUM (2 collision iters) - FPS:",qe)):(De=3,console.log("⚡ Adaptive Quality: HIGH (3 collision iters) - FPS:",qe)))}(e)),function(t){if(k!==MODES.PIT&&k!==MODES.WEIGHTLESS&&k!==MODES.PULSE_GRID)for(Ye+=t;Ye>=_t;){const t=(Math.random()-.5)*_t*.5;Ye-=_t+t,ce+=2*Math.PI*.12*(_t+t);const e=x(),n=Math.random()<.35?3:1;for(let t=0;t<n;t++)if(Ue.length<Zt){const n=8*t*(Math.random()<.5?1:-1);p(e.x+n,e.y-12*t)}}}(n),k===MODES.PULSE_GRID&&function(t){for(let e=0;e<Ue.length;e++){const n=Ue[e];if(n.nextJumpTime-=t,n.nextJumpTime<=0&&n.jumpProgress>=1){const t=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}],e=t[Math.floor(Math.random()*t.length)],o=tt-K+1,a=K+Math.floor(Math.random()*o),i=Math.max(1,Math.round(a*(1-.5*Q+Q*Math.random())));let s=n.gridX+e.dx*i,l=n.gridY+e.dy*i;s=Math.max(0,Math.min(ia-1,s)),l=Math.max(0,Math.min(aa-1,l)),n.gridX=s,n.gridY=l;const r=b(s,l);n.targetX=r.x,n.targetY=r.y,n.jumpProgress=0,n.jumpStartX=n.x,n.jumpStartY=n.y;const d=Q*_*(Math.random()-.5),c=J*_*Math.random();n.nextJumpTime=_+d+c}if(n.jumpProgress<1)if(n.jumpProgress+=t/Z,n.jumpProgress>=1)n.jumpProgress=1,n.x=n.targetX,n.y=n.targetY,n.vx=0,n.vy=0;else{const t=n.jumpProgress;let e=t;if("linear"===ot)e=t;else if("snap"===ot)if(t<.6){const n=t/.6;e=n*n*at}else{const n=(t-.6)/.4;e=1+(at-1)*(1-n)-nt*Math.sin(n*Math.PI)}else if("bounce"===ot)if(t<.7)e=t/.7*(t/.7);else{const n=(t-.7)/.3;e=1-.5*nt*Math.sin(n*Math.PI*2)}else"smooth"===ot&&(e=t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2);n.x=n.jumpStartX+(n.targetX-n.jumpStartX)*e,n.y=n.jumpStartY+(n.targetY-n.jumpStartY)*e,n.vx=0,n.vy=0}}}(n),Re%60==0&&r(),k===MODES.VORTEX&&(Ne=[...Xe],mouseInCanvas&&dt>0&&Ne.push({x:Ie,y:Me,strength:dt,isPermanent:!1}));let o=0;for(;We>=je&&o<2;){if(k!==MODES.PULSE_GRID){const t=Ue.length;for(let e=0;e<t;e++)Ue[e].step(je),k===MODES.VORTEX&&C(Ue[e],je)}if(k!==MODES.FLIES&&k!==MODES.PULSE_GRID&&k!==MODES.VORTEX&&f(De),k!==MODES.PULSE_GRID){const t=k===MODES.WEIGHTLESS?$:Wt,e=Ue.length;for(let n=0;n<e;n++)Ue[n].walls(Lt.width,Lt.height,je,t)}We-=je,o++,Pe++}We>3*je&&(We=0),Vt.clearRect(0,0,Lt.width,Lt.height),Ce>0&&function(t,e,n){const o=Ce;t.strokeStyle="rgba(255, 255, 255, 0.1)",t.lineWidth=2,t.beginPath(),t.moveTo(o,0),t.lineTo(e-o,0),t.arcTo(e,0,e,o,o),t.lineTo(e,n-o),t.arcTo(e,n,e-o,n,o),t.lineTo(o,n),t.arcTo(0,n,0,n-o,o),t.lineTo(0,o),t.arcTo(0,0,o,0,o),t.closePath(),t.stroke()}(Vt,Lt.width,Lt.height);const a=Ue.length;for(let t=0;t<a;t++)Ue[t].draw(Vt);if(function(t){if(Be)return;if(Ie===Mt||Me===Mt)return;const e=Ie,n=Me,o=(le+re)/2*1.33;t.beginPath(),t.arc(e,n,o,0,2*Math.PI),t.fillStyle="rgba(255, 255, 255, 0.9)",t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.6)",t.lineWidth=2,t.stroke()}(Vt),!Be){Vt.save(),Vt.font="14px system-ui, -apple-system, sans-serif",Vt.fillStyle="rgba(255, 255, 255, 0.3)",Vt.textAlign="left",Vt.textBaseline="bottom";const t=k.charAt(0).toUpperCase()+k.slice(1);Vt.fillText(t+" Mode",10,Lt.height-10),Vt.restore()}requestAnimationFrame(frame)});const _e=document.getElementById("panelHeader"),Ze=document.getElementById("minimizePanel");if(Ft&&Ft.classList.add("hidden"),Ze&&Ft&&Ze.addEventListener("click",t=>{t.stopPropagation(),Ft.classList.toggle("hidden")}),_e&&Ft){let Oa,Ua,Na,Xa,Ya=!1,$a=0,Ha=0;function Je(t){"touchstart"===t.type?(Na=t.touches[0].clientX-$a,Xa=t.touches[0].clientY-Ha):(Na=t.clientX-$a,Xa=t.clientY-Ha),(t.target===_e||_e.contains(t.target))&&(Ya=!0,Ft.style.cursor="grabbing")}function Qe(t){if(Ya){t.preventDefault(),"touchmove"===t.type?(Oa=t.touches[0].clientX-Na,Ua=t.touches[0].clientY-Xa):(Oa=t.clientX-Na,Ua=t.clientY-Xa),$a=Oa,Ha=Ua,Ft.getBoundingClientRect();const e=window.getComputedStyle(Ft),n=parseFloat(e.top)||0,o=parseFloat(e.right)||0;Ft.style.top=`${n+Ha}px`,Ft.style.right=o-$a+"px",Ft.style.left="auto",Ft.style.bottom="auto",$a=0,Ha=0,Na="touchmove"===t.type?t.touches[0].clientX:t.clientX,Xa="touchmove"===t.type?t.touches[0].clientY:t.clientY}}function Ke(t){Ya&&(Ya=!1,Ft.style.cursor="move",Na=Oa,Xa=Ua)}_e.addEventListener("mousedown",Je),document.addEventListener("mousemove",Qe),document.addEventListener("mouseup",Ke),_e.addEventListener("touchstart",Je),document.addEventListener("touchmove",Qe),document.addEventListener("touchend",Ke)}const tn=document.getElementById("vortexBallCountSlider"),en=document.getElementById("vortexBallCountVal"),nn=document.getElementById("vortexWellStrengthSlider"),on=document.getElementById("vortexWellStrengthVal"),an=document.getElementById("vortexMouseStrengthSlider"),sn=document.getElementById("vortexMouseStrengthVal"),ln=document.getElementById("vortexInitialSpeedSlider"),rn=document.getElementById("vortexInitialSpeedVal"),dn=document.getElementById("vortexDecaySlider"),cn=document.getElementById("vortexDecayVal"),hn=document.getElementById("vortexSpeedColorCheckbox");tn&&tn.addEventListener("input",()=>{st=parseInt(tn.value,10),en&&(en.textContent=st.toString()),k===MODES.VORTEX&&w(),m()}),nn&&nn.addEventListener("input",()=>{it=parseInt(nn.value,10),on&&(on.textContent=it.toString()),k===MODES.VORTEX&&Ne.length>0&&(Ne[0].strength=it,Xe[0].strength=it),m()}),an&&an.addEventListener("input",()=>{dt=parseInt(an.value,10),sn&&(sn.textContent=dt.toString()),m()}),ln&&ln.addEventListener("input",()=>{lt=parseInt(ln.value,10),rn&&(rn.textContent=lt.toString()),m()}),dn&&dn.addEventListener("input",()=>{rt=parseFloat(dn.value),cn&&(cn.textContent=rt.toFixed(4)),m()}),hn&&hn.addEventListener("change",()=>{ct=hn.checked,m()}),window.addEventListener("keydown",t=>{const e=t.key.toLowerCase();"r"===e&&(function(){if(k===MODES.WEIGHTLESS)S();else for(let t=0;t<Ue.length;t++){const e=Ue[t],n=x();e.x=n.x,e.y=n.y;const o=.5*Lt.width,a=de?he>=0?1:-1:e.x<o?1:-1,i=g(e.r/(.5*(le+re)),.6,1.4),s=140*i,l=180*i,r=120;e.vx=a*(s+Math.random()*l),e.vy=-Math.random()*r,e.age=0,e.driftAx=a*(360+420*Math.random())*i,e.driftTime=.22+.28*Math.random()}}(),t.preventDefault()),"/"===e&&Ft&&(t.preventDefault(),Ft.classList.toggle("hidden")),"1"===e&&T(MODES.PIT),"2"===e&&T(MODES.FLIES),"3"===e&&T(MODES.WEIGHTLESS),"4"===e&&T(MODES.PULSE_GRID),"5"===e&&T(MODES.VORTEX)}),Lt.addEventListener("mousemove",t=>{const e=Lt.getBoundingClientRect();Ie=(t.clientX-e.left)*Rt,Me=(t.clientY-e.top)*Rt,k===MODES.PIT&&ve>0&&fe>0&&(Se=!0)}),Lt.addEventListener("mouseleave",()=>{Ie=Mt,Me=Mt});const un=document.getElementById("restitutionSlider"),mn=document.getElementById("frictionSlider"),gn=document.getElementById("emitterSlider"),yn=document.getElementById("sizeSliderGlobal"),pn=document.getElementById("sizeVariationSliderGlobal"),xn=(document.getElementById("weightSliderGlobal"),document.getElementById("ballSoftnessSliderGlobal")),fn=document.getElementById("sizeValGlobal"),vn=document.getElementById("sizeVariationValGlobal"),En=(document.getElementById("weightValGlobal"),document.getElementById("ballSoftnessValGlobal")),In=(document.getElementById("sizeSliderPit"),document.getElementById("sizeVariationSliderPit"),document.getElementById("weightSliderPit"),document.getElementById("ballSoftnessSliderPit"),document.getElementById("sizeValPit"),document.getElementById("sizeVariationValPit"),document.getElementById("weightValPit"),document.getElementById("ballSoftnessValPit"),document.getElementById("sizeSliderFlies"),document.getElementById("sizeVariationSliderFlies"),document.getElementById("weightSliderFlies"),document.getElementById("ballSoftnessSliderFlies"),document.getElementById("sizeValFlies"),document.getElementById("sizeVariationValFlies"),document.getElementById("weightValFlies"),document.getElementById("ballSoftnessValFlies"),document.getElementById("sizeSliderZeroG"),document.getElementById("sizeVariationSliderZeroG"),document.getElementById("weightSliderZeroG"),document.getElementById("ballSoftnessSliderZeroG"),document.getElementById("sizeValZeroG"),document.getElementById("sizeVariationValZeroG"),document.getElementById("weightValZeroG"),document.getElementById("ballSoftnessValZeroG"),document.getElementById("maxBallsSlider")),Mn=document.getElementById("spawnYSlider"),Sn=document.getElementById("spawnWidthSlider"),Bn=document.getElementById("spawnCenterSlider"),bn=document.getElementById("spawnHeightSlider"),Cn=document.getElementById("repelSizeSlider"),wn=document.getElementById("repelPowerSlider"),Ln=document.getElementById("repelSoftSlider"),Tn=document.getElementById("colorSelect"),Vn=document.getElementById("color1"),Fn=document.getElementById("color2"),Rn=document.getElementById("color3"),Pn=document.getElementById("color4"),An=document.getElementById("color5"),qn=document.getElementById("color6"),kn=document.getElementById("color7"),Gn=document.getElementById("color8"),zn=document.getElementById("cursorColorSelect"),Dn=document.getElementById("color1Val"),On=document.getElementById("color2Val"),Un=document.getElementById("color3Val"),Nn=document.getElementById("color4Val"),Xn=document.getElementById("color5Val"),Yn=document.getElementById("color6Val"),$n=document.getElementById("color7Val"),Hn=document.getElementById("color8Val");[Dn,On,Un,Nn,Xn,Yn,$n,Hn].forEach(t=>{t&&t.setAttribute("title","Click to copy")});const Wn=document.getElementById("cornerRadiusSlider"),jn=document.getElementById("cornerRadiusVal"),_n=document.getElementById("trailFadeSlider"),Zn=document.getElementById("trailFadeVal"),Jn=document.getElementById("trailSubtletySlider"),Qn=document.getElementById("trailSubtletyVal"),Kn=document.getElementById("restitutionVal"),to=document.getElementById("frictionVal"),eo=document.getElementById("emitterVal"),no=document.getElementById("maxBallsVal"),oo=document.getElementById("spawnYVal"),ao=document.getElementById("spawnWidthVal"),io=document.getElementById("spawnCenterVal"),so=document.getElementById("spawnHeightVal"),lo=document.getElementById("repelSizeVal"),ro=document.getElementById("repelPowerVal"),co=document.getElementById("repelSoftVal"),ho=document.getElementById("saveConfigBtn"),uo=document.getElementById("buildBtn"),mo=document.getElementById("configOutput");ho&&uo&&mo&&(ho.addEventListener("click",()=>{const t=E(),e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download="current-config.json",o.click(),URL.revokeObjectURL(n),mo.style.display="block",mo.innerHTML="\n<strong>💾 Config Saved!</strong><br>\nReplace <code>source/current-config.json</code> with the downloaded file.<br>\nThen rebuild: <code>npm run build-production</code>";const a=ho.textContent;ho.textContent="✅ Downloaded!",setTimeout(()=>{ho.textContent=a},2e3)}),uo.addEventListener("click",()=>{const t=E();mo.style.display="block",mo.innerHTML="\n<strong>🚀 Build Instructions:</strong><br>\n1. Run: <code>npm run build</code><br>\n2. Your current config will be baked into <code>public/js/bouncy-balls-embed.js</code>";const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download="current-config.json",o.click(),URL.revokeObjectURL(n)})),un&&un.addEventListener("input",()=>{Wt=parseFloat(un.value),Kn&&(Kn.textContent=Wt.toFixed(2)),m()}),mn&&mn.addEventListener("input",()=>{jt=parseFloat(mn.value),to&&(to.textContent=jt.toFixed(4)),m()}),gn&&gn.addEventListener("input",()=>{_t=parseFloat(gn.value),eo&&(eo.textContent=_t.toFixed(3)),m()}),function(t){if(!t)return;const{size:e,sizeVal:n,sizeVar:o,sizeVarVal:a,soft:i,softVal:s}=t;e&&e.addEventListener("input",()=>{const t=parseFloat(e.value);n&&(n.textContent=t.toFixed(1)),te=t,l();const o=(le+re)/2;for(let t=0;t<Ue.length;t++)Ue[t].r=o,Ue[t].rBase=o;for(let t=0;t<Ue.length;t++)Ue[t].m=ae;m()}),o&&o.addEventListener("input",()=>{const t=parseFloat(o.value);a&&(a.textContent=t.toFixed(1)),ee=t,m()}),i&&i.addEventListener("input",()=>{const t=parseInt(i.value,10);s&&(s.textContent=String(t)),G=t,m()})}({size:yn,sizeVal:fn,sizeVar:pn,sizeVarVal:vn,soft:xn,softVal:En}),In&&In.addEventListener("input",()=>{Zt=parseInt(In.value,10),no&&(no.textContent=Zt.toString()),Ue.length>Zt&&(Ue.length=Zt)}),pn&&pn.addEventListener("input",()=>{ee=parseFloat(pn.value),vn&&(vn.textContent=ee.toFixed(1)),M()});const go=document.getElementById("weightPitSlider"),yo=document.getElementById("weightPitVal");document.getElementById("weightWeightlessSlider"),document.getElementById("weightWeightlessVal"),Mn&&Mn.addEventListener("input",()=>{Ut=parseFloat(Mn.value),oo&&(oo.textContent=Ut.toFixed(0)),i()}),Sn&&Sn.addEventListener("input",()=>{Nt=parseFloat(Sn.value),ao&&(ao.textContent=Nt.toFixed(0))}),Bn&&Bn.addEventListener("input",()=>{Ot=parseFloat(Bn.value),io&&(io.textContent=Ot.toFixed(0))}),bn&&bn.addEventListener("input",()=>{Xt=parseFloat(bn.value),so&&(so.textContent=Xt.toFixed(0))}),Cn&&Cn.addEventListener("input",()=>{fe=parseFloat(Cn.value),lo&&(lo.textContent=fe.toFixed(0)),Se=Se||ve>0&&fe>0}),wn&&wn.addEventListener("input",()=>{ve=function(t){const e=Math.max(0,Math.min(be,Number(t)))/be;return 2*Math.pow(2,12*(e-.5))*12e3}(wn.value),ro&&(ro.textContent=Math.round(ve).toString()),Ga&&"off"!==Ga.value&&(Se=ve>0&&fe>0)}),Ln&&Ln.addEventListener("input",()=>{Ee=parseFloat(Ln.value),co&&(co.textContent=Ee.toFixed(1))});const po=document.getElementById("performanceModeToggle");document.getElementById("performanceModeStatus"),po&&po.addEventListener("change",()=>{!function(){Pt=!Pt,At=Pt?120:60;const t=Pt?zt.performance:zt.normal;Pt?(console.log("⚡ PERFORMANCE MODE: Optimizing for 120 FPS..."),Ue.length>t.maxBalls&&(Ue.length=t.maxBalls,console.log(`⚡ Reduced balls to ${t.maxBalls} for 120 FPS`)),Zt=t.maxBalls,De=t.collisionIters):(console.log("🎨 NORMAL MODE: Restoring visual quality..."),Zt=t.maxBalls,De=t.collisionIters),function(){const t=document.getElementById("performanceModeToggle"),e=document.getElementById("performanceModeStatus"),n=document.getElementById("maxBallsSlider"),o=document.getElementById("maxBallsVal");t&&(t.checked=Pt),e&&(Pt?(e.textContent=`⚡ 120 FPS Mode Active (${Ue.length} balls)`,e.style.background="rgba(255,165,0,0.3)"):(e.textContent=`🎨 Normal Mode (${Ue.length} balls)`,e.style.background="rgba(0,0,0,0.2)")),n&&o&&(n.value=Zt,o.textContent=Zt.toString())}(),console.log(`🎯 Target FPS: ${At}, Mode: ${Pt?"PERFORMANCE":"NORMAL"}`)}()});const xo=document.getElementById("darkModeToggle");document.getElementById("darkModeStatus"),xo&&xo.addEventListener("change",()=>{kt=!kt,kt?(a(),console.log("🌙 Auto Dark Mode: ENABLED")):(o(!1),console.log("☀️ Auto Dark Mode: DISABLED")),m()});const fo=document.getElementById("canvasShadowEnabled"),vo=document.getElementById("shadowOffsetX"),Eo=document.getElementById("shadowOffsetXVal"),Io=document.getElementById("shadowOffsetY"),Mo=document.getElementById("shadowOffsetYVal"),So=document.getElementById("shadowBlur"),Bo=document.getElementById("shadowBlurVal"),bo=document.getElementById("shadowOpacity"),Co=document.getElementById("shadowOpacityVal"),wo=document.getElementById("shadowColor"),Lo=document.getElementById("shadowColorVal"),To=document.getElementById("shadow2Enabled"),Vo=document.getElementById("shadow2Blur"),Fo=document.getElementById("shadow2BlurVal"),Ro=document.getElementById("shadow2Opacity"),Po=document.getElementById("shadow2OpacityVal");fo&&fo.addEventListener("change",()=>{ht=fo.checked,e(),m()}),vo&&vo.addEventListener("input",()=>{ut=parseFloat(vo.value),Eo&&(Eo.textContent=ut.toFixed(1)),e(),m()}),Io&&Io.addEventListener("input",()=>{mt=parseFloat(Io.value),Mo&&(Mo.textContent=mt.toFixed(1)),e(),m()}),So&&So.addEventListener("input",()=>{gt=parseFloat(So.value),Bo&&(Bo.textContent=gt.toFixed(1)),e(),m()}),bo&&bo.addEventListener("input",()=>{yt=parseFloat(bo.value),Co&&(Co.textContent=yt.toFixed(2)),e(),m()}),wo&&wo.addEventListener("input",()=>{pt=wo.value,Lo&&(Lo.textContent=pt.toUpperCase()),e(),m()}),To&&To.addEventListener("change",()=>{xt=To.checked,e(),m()}),Vo&&Vo.addEventListener("input",()=>{ft=parseInt(Vo.value,10),Fo&&(Fo.textContent=ft.toString()),e(),m()}),Ro&&Ro.addEventListener("input",()=>{vt=parseFloat(Ro.value),Po&&(Po.textContent=vt.toFixed(2)),e(),m()}),Lt.addEventListener("mousemove",t=>{const e=Lt.getBoundingClientRect();Ie=(t.clientX-e.left)*Rt,Me=(t.clientY-e.top)*Rt}),Lt.addEventListener("mouseleave",()=>{Ie=Mt,Me=Mt}),Tn&&Tn.addEventListener("change",()=>{d(Tn.value)});const Ao=Array.from(document.querySelectorAll(".mode-button")),qo=document.getElementById("pitControls"),ko=document.getElementById("fliesControls"),Go=document.getElementById("weightlessControls"),zo=document.getElementById("gravityPitSlider"),Do=document.getElementById("gravityPitVal"),Oo=document.getElementById("repellerEnabledPit"),Uo=document.getElementById("attractPowerSlider"),No=document.getElementById("attractPowerVal"),Xo=document.getElementById("orbitRadiusSlider"),Yo=document.getElementById("orbitRadiusVal"),$o=document.getElementById("swarmSpeedSlider"),Ho=document.getElementById("swarmSpeedVal"),Wo=document.getElementById("weightlessCountSlider"),jo=document.getElementById("weightlessCountVal"),_o=document.getElementById("weightlessSpeedSlider"),Zo=document.getElementById("weightlessSpeedVal"),Jo=document.getElementById("weightlessBounceSlider"),Qo=document.getElementById("weightlessBounceVal"),Ko=document.getElementById("weightlessRepelSlider"),ta=document.getElementById("weightlessRepelVal"),ea=document.getElementById("weightlessRepelRadiusSlider"),na=document.getElementById("weightlessRepelRadiusVal");let oa=0,aa=0,ia=0,sa=0,la=0;const ra=document.getElementById("resetBtn");ra&&ra.addEventListener("click",()=>{confirm("Reset all settings to defaults? This will reload the page with default values.")&&(Fe("🔄 Reloading with defaults..."),location.reload())}),Ao.forEach(t=>t.addEventListener("click",()=>{T(t.getAttribute("data-mode")),m()})),zo&&zo.addEventListener("input",()=>{z=parseFloat(zo.value),Do&&(Do.textContent=z.toFixed(1)),m(),k===MODES.PIT&&($t=z,Ht=Yt*$t)}),go&&go.addEventListener("input",()=>{ae=parseFloat(go.value),yo&&(yo.textContent=ae.toFixed(2));for(let t=0;t<Ue.length;t++)Ue[t].m=ae;s(),m()}),Oo&&Oo.addEventListener("change",()=>{D=!!Oo.checked,k===MODES.PIT&&(Se=D&&ve>0&&fe>0)}),Uo&&Uo.addEventListener("input",()=>{O=parseFloat(Uo.value),No&&(No.textContent=Math.round(O).toString())}),Xo&&Xo.addEventListener("input",()=>{U=parseFloat(Xo.value),Yo&&(Yo.textContent=Math.round(U).toString())}),$o&&$o.addEventListener("input",()=>{N=parseFloat($o.value),Ho&&(Ho.textContent=N.toFixed(1))}),Wo&&Wo.addEventListener("input",()=>{X=parseInt(Wo.value,10),jo&&(jo.textContent=X.toString()),k===MODES.WEIGHTLESS&&S()}),_o&&_o.addEventListener("input",()=>{Y=parseFloat(_o.value),Zo&&(Zo.textContent=Math.round(Y).toString())}),Jo&&Jo.addEventListener("input",()=>{$=parseFloat(Jo.value),Qo&&(Qo.textContent=$.toFixed(2))}),Ko&&Ko.addEventListener("input",()=>{H=parseFloat(Ko.value),ta&&(ta.textContent=Math.round(H).toString()),m()}),ea&&ea.addEventListener("input",()=>{W=parseFloat(ea.value),na&&(na.textContent=Math.round(W).toString()),m()});const da=document.getElementById("gridPresetSelect"),ca=document.getElementById("gridBallCountSlider"),ha=document.getElementById("gridBallCountVal"),ua=document.getElementById("gridColumnsSlider"),ma=document.getElementById("gridColumnsVal"),ga=document.getElementById("pulseIntervalSlider"),ya=document.getElementById("pulseIntervalVal"),pa=document.getElementById("pulseSpeedSlider"),xa=document.getElementById("pulseSpeedVal"),fa=document.getElementById("pulseMinStepsSlider"),va=document.getElementById("pulseMinStepsVal"),Ea=document.getElementById("pulseMaxStepsSlider"),Ia=document.getElementById("pulseMaxStepsVal"),Ma=document.getElementById("pulseSynchronicitySlider"),Sa=document.getElementById("pulseSynchronicityVal"),Ba=document.getElementById("pulseRandomnessSlider"),ba=document.getElementById("pulseRandomnessVal"),Ca={synchronized:{interval:.6,speed:.2,minSteps:1,maxSteps:2,synchronicity:.1,randomness:.2,easingStyle:"snap",overshoot:1.12,bounce:.18},organic:{interval:.8,speed:.25,minSteps:1,maxSteps:3,synchronicity:.3,randomness:.4,easingStyle:"smooth",overshoot:1.05,bounce:.1},chaotic:{interval:.4,speed:.15,minSteps:2,maxSteps:4,synchronicity:.7,randomness:.8,easingStyle:"bounce",overshoot:1.15,bounce:.25}};da&&da.addEventListener("change",()=>{!function(t){const e=Ca[t];if(!e)return;_=e.interval,Z=e.speed,K=e.minSteps,tt=e.maxSteps,J=e.synchronicity,Q=e.randomness,ot=e.easingStyle,at=e.overshoot,nt=e.bounce,ga&&(ga.value=e.interval),ya&&(ya.textContent=e.interval.toFixed(1)),pa&&(pa.value=e.speed),xa&&(xa.textContent=e.speed.toFixed(2)),fa&&(fa.value=e.minSteps),va&&(va.textContent=e.minSteps.toString()),Ea&&(Ea.value=e.maxSteps),Ia&&(Ia.textContent=e.maxSteps.toString()),Ma&&(Ma.value=e.synchronicity),Sa&&(Sa.textContent=e.synchronicity.toFixed(2)),Ba&&(Ba.value=e.randomness),ba&&(ba.textContent=e.randomness.toFixed(2));const n=document.getElementById("pulseEasingSelect"),o=document.getElementById("pulseOvershootSlider"),a=document.getElementById("pulseOvershootVal"),i=document.getElementById("pulseBounceSlider"),s=document.getElementById("pulseBounceVal");n&&(n.value=e.easingStyle),o&&(o.value=e.overshoot),a&&(a.textContent=e.overshoot.toFixed(2)),i&&(i.value=e.bounce),s&&(s.textContent=e.bounce.toFixed(2)),k===MODES.PULSE_GRID&&L()}(da.value),m()}),ca&&ca.addEventListener("input",()=>{et=parseInt(ca.value,10),ha&&(ha.textContent=et.toString()),k===MODES.PULSE_GRID&&L(),m()}),ua&&ua.addEventListener("input",()=>{j=parseInt(ua.value,10),ma&&(ma.textContent=j.toString()),k===MODES.PULSE_GRID&&(B(),L()),m()}),ga&&ga.addEventListener("input",()=>{_=parseFloat(ga.value),ya&&(ya.textContent=_.toFixed(1)),m()}),pa&&pa.addEventListener("input",()=>{Z=parseFloat(pa.value),xa&&(xa.textContent=Z.toFixed(2)),m()}),fa&&fa.addEventListener("input",()=>{K=parseInt(fa.value,10),va&&(va.textContent=K.toString()),K>tt&&(tt=K,Ea&&(Ea.value=K),Ia&&(Ia.textContent=K.toString())),m()}),Ea&&Ea.addEventListener("input",()=>{tt=parseInt(Ea.value,10),Ia&&(Ia.textContent=tt.toString()),tt<K&&(K=tt,fa&&(fa.value=tt),va&&(va.textContent=tt.toString())),m()}),Ma&&Ma.addEventListener("input",()=>{J=parseFloat(Ma.value),Sa&&(Sa.textContent=J.toFixed(2)),m()}),Ba&&Ba.addEventListener("input",()=>{Q=parseFloat(Ba.value),ba&&(ba.textContent=Q.toFixed(2)),m()});const wa=document.getElementById("pulseEasingSelect"),La=document.getElementById("pulseOvershootSlider"),Ta=document.getElementById("pulseOvershootVal"),Va=document.getElementById("pulseBounceSlider"),Fa=document.getElementById("pulseBounceVal");wa&&wa.addEventListener("change",()=>{ot=wa.value,m()}),La&&La.addEventListener("input",()=>{at=parseFloat(La.value),Ta&&(Ta.textContent=at.toFixed(2)),m()}),Va&&Va.addEventListener("input",()=>{nt=parseFloat(Va.value),Fa&&(Fa.textContent=nt.toFixed(2)),m()}),Vn&&Vn.addEventListener("input",()=>{ge[0]=Vn.value,Dn&&(Dn.textContent=Vn.value.toUpperCase()),V(),c()}),Fn&&Fn.addEventListener("input",()=>{ge[1]=Fn.value,On&&(On.textContent=Fn.value.toUpperCase()),V(),c()}),Rn&&Rn.addEventListener("input",()=>{ge[2]=Rn.value,Un&&(Un.textContent=Rn.value.toUpperCase()),V(),c()}),Pn&&Pn.addEventListener("input",()=>{ge[3]=Pn.value,Nn&&(Nn.textContent=Pn.value.toUpperCase()),V(),c()}),An&&An.addEventListener("input",()=>{ge[4]=An.value,Xn&&(Xn.textContent=An.value.toUpperCase()),V(),c()}),qn&&qn.addEventListener("input",()=>{ge[5]=qn.value,Yn&&(Yn.textContent=qn.value.toUpperCase()),V(),c()}),kn&&kn.addEventListener("input",()=>{ge[6]=kn.value,$n&&($n.textContent=kn.value.toUpperCase()),V(),c()}),Gn&&Gn.addEventListener("input",()=>{ge[7]=Gn.value,Hn&&(Hn.textContent=Gn.value.toUpperCase()),V(),c()}),zn&&zn.addEventListener("change",()=>{const t=Math.max(1,Math.min(8,parseInt(zn.value,10)))-1;ye=t,pe=ge[ye]||pe,m()}),I(Dn,()=>Vn.value.toUpperCase()),I(On,()=>Fn.value.toUpperCase()),I(Un,()=>Rn.value.toUpperCase()),I(Nn,()=>Pn.value.toUpperCase()),I(Xn,()=>An.value.toUpperCase()),I(Yn,()=>qn.value.toUpperCase()),I($n,()=>kn.value.toUpperCase()),I(Hn,()=>Gn.value.toUpperCase()),Wn&&Wn.addEventListener("input",()=>{Ce=parseFloat(Wn.value),jn&&(jn.textContent=Ce.toFixed(0))}),_n&&_n.addEventListener("input",()=>{Te=parseFloat(_n.value),Zn&&(Zn.textContent=Te.toFixed(3))}),Jn&&Jn.addEventListener("input",()=>{Ve=parseFloat(Jn.value),Qn&&(Qn.textContent=Ve.toFixed(2)+"×")});const Ra={rubberPlayground:{label:"Rubber – Playground",G:1960,REST:.9,FRICTION:.0025,sizeScale:1.8,maxBalls:450,sizeVariation:.2},rubberRacquet:{label:"Rubber – Racquetball",G:3320,REST:.97,FRICTION:.0035,sizeScale:.7,maxBalls:350,sizeVariation:.3},rubberSuperball:{label:"Rubber – Superball",G:1960,REST:.95,FRICTION:.0015,sizeScale:1.2,maxBalls:450,sizeVariation:.05},rubberSoft:{label:"Rubber – Soft",G:1960,REST:.86,FRICTION:.0035,sizeScale:2.2,maxBalls:350,sizeVariation:.25},rubberHeavy:{label:"Rubber – Heavy",G:1960,REST:.88,FRICTION:.003,sizeScale:2,maxBalls:400,sizeVariation:.15}},Pa={fullRain:{label:"Full Rain (top-half)",EMIT_INTERVAL:.03,xCenter:50,y:-50,w:100,h:50},narrowStrip:{label:"Narrow Strip Top",EMIT_INTERVAL:.05,xCenter:50,y:-40,w:20,h:10},leftGutter:{label:"Left Gutter",EMIT_INTERVAL:.045,xCenter:10,y:-60,w:18,h:20},rightGutter:{label:"Right Gutter",EMIT_INTERVAL:.045,xCenter:90,y:-60,w:18,h:20},centerFountain:{label:"Center Fountain",EMIT_INTERVAL:.02,xCenter:50,y:-30,w:30,h:20},stormBurst:{label:"Storm Burst",EMIT_INTERVAL:.005,xCenter:50,y:-80,w:100,h:30},slowSnow:{label:"Slow Snow",EMIT_INTERVAL:.2,xCenter:50,y:-30,w:100,h:20},edgeDrizzle:{label:"Edge Drizzle",EMIT_INTERVAL:.08,xCenter:15,y:-40,w:30,h:15},twinColumns:{label:"Twin Columns",EMIT_INTERVAL:.03,xCenter:30,y:-50,w:10,h:40},focusedBeam:{label:"Focused Beam",EMIT_INTERVAL:.015,xCenter:50,y:-70,w:6,h:12}},Aa={off:{label:"Off",r:710,p:274e3,s:4.4},gentle:{label:"Gentle Breeze",r:120,p:2500,s:2.5},pushField:{label:"Push Field",r:240,p:8e4,s:2},tractor:{label:"Tractor Push",r:320,p:14e4,s:1.6},magnet:{label:"Magnet Repel",r:200,p:18e4,s:3},pulse:{label:"Pulse Strong",r:280,p:22e4,s:1.2},wideSoft:{label:"Wide Soft",r:500,p:8e4,s:4.5},needle:{label:"Needle Point",r:80,p:26e4,s:.8},wall:{label:"Invisible Wall",r:700,p:16e4,s:5},singularity:{label:"Singularity",r:600,p:3e5,s:.5}},qa=document.getElementById("physicsSelect"),ka=document.getElementById("spawnSelect"),Ga=document.getElementById("repellerSelect");qa&&F(qa,Ra,"rubberRacquet"),ka&&F(ka,Pa,"fullRain"),Ga&&F(Ga,Aa,"off"),Tn&&F(Tn,ue,"industrialTeal"),P("rubberRacquet"),A("fullRain"),q("off"),Fe("⚠️ localStorage is disabled - using defaults"),console.log("🔍 Initializing dark mode system..."),Gt=function(){if(console.log("🔍 STATE: DETERMINING_MODE"),qt="determining_mode",!kt)return console.log("✓ Dark mode disabled by user → Light mode"),!1;const t=n();return console.log(`✓ Dark mode determination complete → ${t?"DARK":"LIGHT"} mode`),t}(),console.log(`✅ Dark mode determined: ${Gt?"DARK":"LIGHT"} mode`),Gt?Tt.classList.add("dark-mode"):Tt.classList.remove("dark-mode"),console.log(`   Container classes: ${Tt.classList.toString()}`),console.log("   Background should be: "+(Gt?"#0a0a0a (dark)":"#cecece (light)")),d(me),console.log(`   Color template applied: ${me} (${Gt?"dark":"light"} variant)`);const za=setInterval(a,6e4);window.addEventListener("unload",()=>{za&&clearInterval(za)}),qa&&qa.addEventListener("change",()=>P(qa.value)),ka&&ka.addEventListener("change",()=>A(ka.value)),Ga&&Ga.addEventListener("change",()=>q(Ga.value)),l(),r(),e();{const Wa=Object.values(MODES),ja=Wa[Math.floor(Math.random()*Wa.length)];k=ja,console.log(`🎲 Random mode selected: ${ja}`)}T(k),window.addEventListener("beforeunload",u)})();