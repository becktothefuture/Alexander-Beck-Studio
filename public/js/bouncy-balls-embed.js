var e=function(e){"use strict";const t={PIT:"pit",FLIES:"flies",WEIGHTLESS:"weightless",WATER:"water",VORTEX:"vortex",PING_PONG:"ping-pong",MAGNETIC:"magnetic",BUBBLES:"bubbles"},n={DPR:Math.max(1,Math.min(2,window.devicePixelRatio||1)),OFFSCREEN_MOUSE:-1e9,MIN_DISTANCE_EPSILON:1e-6,ACCUMULATOR_RESET_THRESHOLD:3,MAX_PHYSICS_STEPS:2,SPIN_DAMP_PER_S:2,SPIN_GAIN:.25,SPIN_GAIN_TANGENT:.18,ROLL_FRICTION_PER_S:1.5,SQUASH_MAX_BASE:.2,SQUASH_DECAY_PER_S:18,WALL_REST_VEL_THRESHOLD:70,GROUND_COUPLING_PER_S:8,SLEEP_VELOCITY_THRESHOLD:5,SLEEP_ANGULAR_THRESHOLD:.05,TIME_TO_SLEEP:.5,PHYSICS_DT:1/120};let a=Math.max(1,Math.min(2,window.devicePixelRatio||1));const o={config:{},currentMode:t.FLIES,balls:[],canvas:null,ctx:null,container:null,mouseX:n.OFFSCREEN_MOUSE,mouseY:n.OFFSCREEN_MOUSE,mouseInCanvas:!1,GE:1960,G:0,gravityScale:1,gravityMultiplier:0,gravityMultiplierPit:1.1,REST:.69,FRICTION:.006,ballMassKg:129,MASS_BASELINE_KG:129,MASS_REST_EXP:.15,MASS_GRAVITY_EXP:.35,get DPR(){return a},sizeScale:1.2,sizeVariation:0,responsiveScale:1,R_MIN_BASE:6,R_MAX_BASE:24,R_MIN:6*1.2*.75,R_MAX:36,cursorSize:1,ballSoftness:20,ballSpacing:2.5,cornerRadius:42,vortexSwirlStrength:420,vortexRadialPull:180,vortexBallCount:180,magneticBallCount:180,magneticStrength:65e3,magneticMaxVelocity:2800,magneticExplosionInterval:5,bubblesSpawnRate:8,bubblesRiseSpeed:150,bubblesWobble:40,bubblesMaxCount:150,bubblesDeflectRadius:80,pingPongBallCount:35,pingPongSpeed:800,pingPongCursorRadius:50,currentColors:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],currentTemplate:"industrialTeal",fliesBallCount:60,attractionPower:5e3,orbitRadius:180,swarmSpeed:.4,fliesSeparation:15e3,weightlessCount:80,weightlessInitialSpeed:250,weightlessBounce:.97,gridColumns:40,gridBallCount:120,pulseInterval:.8,waterBallCount:300,waterDrag:.015,waterRippleSpeed:300,waterRippleStrength:18e3,waterDriftStrength:40,waterInitialVelocity:200,repelRadius:120,repelPower:274e3,repelSoft:3.4,repellerEnabled:!1,emitterTimer:0,autoDarkModeEnabled:!0,isDarkMode:!1,containerBorder:20,simulationPadding:0,contentPadding:40,containerInnerShadowOpacity:.12,containerInnerShadowBlur:80,containerInnerShadowSpread:-10,containerInnerShadowOffsetY:0,frameColor:"#0a0a0a",wallThickness:20,wallRadius:42,wallWobbleMaxDeform:148,wallWobbleStiffness:1300,wallWobbleDamping:34,wallWobbleSigma:4,wallWobbleCornerClamp:1,getSquashMax(){return 0===this.ballSoftness?0:n.SQUASH_MAX_BASE*(this.ballSoftness/40)},getCanvasCornerRadius(){return Math.max(0,this.cornerRadius-this.simulationPadding)}};function i(){return o}function s(){o.balls.length=0}const l={industrialTeal:{label:"Industrial Teal",light:["#b7bcb7","#d0d0d0","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#6b726b","#3d453d","#8a928a","#00e6c3","#d5d5d5","#ff6b47","#5b9aff","#ffb84d"]},sunsetCoral:{label:"Sunset Coral",light:["#bdbbb8","#e8e6e3","#ffffff","#ff3b3b","#000000","#00f5d4","#1e40af","#fb923c"],dark:["#716f6b","#3f3d3a","#8e8c88","#ff6b6b","#d8d8d8","#00ffe7","#6ba3ff","#ffb570"]},violetPunch:{label:"Violet Punch",light:["#b8b7c2","#e6e5ed","#ffffff","#9333ea","#000000","#dc2626","#0ea5e9","#facc15"],dark:["#6d6c7a","#3a3845","#8b8a98","#c266ff","#dad6e8","#ff5c5c","#42d4ff","#fff066"]},citrusBlast:{label:"Citrus Blast",light:["#bfbdb5","#eae8df","#ffffff","#ea580c","#000000","#e11d48","#2563eb","#059669"],dark:["#74726a","#403e38","#918f87","#ff8c4d","#dbd9d1","#ff5c7a","#6ba3ff","#00d699"]},cobaltSpark:{label:"Cobalt Spark",light:["#b5b8be","#e3e6eb","#ffffff","#1d4ed8","#000000","#ea580c","#db2777","#d97706"],dark:["#696d75","#3a3e45","#878b93","#6b9dff","#d6dae2","#ff8c5c","#ff66b3","#ffc266"]}},r=[.5,.25,.12,.06,.03,.02,.01,.01];function c(){const e=i().currentColors;if(!e||0===e.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let n=0;for(let a=0;a<Math.min(e.length,r.length);a++)if(n+=r[a],t<=n)return e[a];return e[Math.min(e.length-1,7)]}function d(e){const t=i().currentColors;return t&&0!==t.length?t[Math.max(0,Math.min(7,Math.floor(e)))]||"#ffffff":(console.warn("No colors available, using fallback"),"#ffffff")}function u(e){const t=i();t.currentTemplate=e,t.currentColors=function(e){const t=i(),n=l[e];return n?t.isDarkMode?n.dark:n.light:l.industrialTeal.light}(e),t.cursorBallColor=t.currentColors[t.cursorBallIndex||4],function(){const e=i(),t=e.balls,n=e.currentColors;if(t.length>0&&n&&n.length>0){const e=Math.min(8,n.length,t.length),a=Math.floor(Math.random()*e);for(let o=0;o<e;o++)t[o].color=n[(a+o)%e];for(let n=e;n<t.length;n++)t[n].color=c();return}for(let e=0;e<t.length;e++)t[e].color=c()}(),function(e){try{const t=document.documentElement,n=(e&&e.length?e:[]).slice(0,8);for(let e=0;e<8;e++){const a=n[e]||"#ffffff";t.style.setProperty(`--ball-${e+1}`,a)}}catch(e){}}(t.currentColors),function(){const e=i().currentColors;for(let t=1;t<=8;t++){const n=document.getElementById(`color${t}`),a=document.getElementById(`color${t}Val`);n&&e[t-1]&&(n.value=e[t-1],a&&(a.textContent=e[t-1].toUpperCase()))}}()}function m(){const e=document.getElementById("colorSelect");if(!e)return;e.innerHTML="";for(const[t,n]of Object.entries(l)){const a=document.createElement("option");a.value=t,a.textContent=n.label,e.appendChild(a)}const t=i();e.value=t.currentTemplate}function h(e,t=.15){return e*(1+2*(Math.random()-.5)*t)}const p={attackTime:.005,decayTime:.075,harmonicGain:0,filterBaseFreq:580,filterVelocityRange:400,filterQ:.18,filterMinHz:350,filterMaxHz:2800,pitchMinHz:145,pitchMaxHz:280,pitchCurve:1,reverbDecay:.14,reverbWetMix:.08,reverbHighDamp:.8,minGain:.008,maxGain:.09,masterGain:.28,voiceGainMax:.14,minTimeBetweenSounds:.012,maxPan:.15,noiseTransientEnabled:!0,noiseTransientGain:.045,noiseTransientDecay:.008,noiseTransientFilterMin:500,noiseTransientFilterMax:1800,noiseTransientQ:1.2,sparkleGain:0,sparkleRatioMin:2.3,sparkleRatioMax:4.1,sparkleDecayMul:.65,variancePitch:.06,varianceDecay:.2,varianceGain:.15,varianceFilter:.18,varianceNoise:.25,velocityNoiseScale:1.8,velocityBrightnessScale:1.4,velocityDecayScale:.65,intensityExponent:1.5,toneSafetyMinHz:130,toneSafetyMaxHz:480,toneSafetyExponent:2.2,toneSafetyHighGainAtten:.25,toneSafetyLowGainAtten:.06,toneSafetyHighBrightAtten:.45,collisionMinImpact:.58,highShelfFreq:2200,highShelfGain:-6};let f=null;const g={organicImpact:{label:"Organic Impact",description:"Warm, natural thuds with intensity dynamics",...p},glassMarbles:{label:"Glass Marbles",description:"Clear, glassy impacts with more presence",...p,pitchMinHz:260,pitchMaxHz:780,pitchCurve:1.05,filterBaseFreq:850,filterVelocityRange:600,noiseTransientGain:.065,noiseTransientFilterMin:650,noiseTransientFilterMax:2200,noiseTransientQ:1.6,decayTime:.055,intensityExponent:1.3,highShelfGain:-4.5},crystalPebbles:{label:"Crystal Pebbles ‚òÖ",description:"Crisp, close, soothing micro-chimes (non-repetitive)",...p,pitchMinHz:420,pitchMaxHz:1600,pitchCurve:1.15,filterBaseFreq:1300,filterVelocityRange:1700,filterQ:.22,filterMaxHz:6200,decayTime:.04,intensityExponent:1.65,collisionMinImpact:.7,minTimeBetweenSounds:.018,noiseTransientGain:.02,noiseTransientDecay:.006,noiseTransientFilterMin:1200,noiseTransientFilterMax:7e3,noiseTransientQ:2.8,sparkleGain:.12,sparkleRatioMin:2.6,sparkleRatioMax:4.4,sparkleDecayMul:.55,reverbWetMix:.04,reverbDecay:.1,highShelfGain:-4,masterGain:.24},woodenBeads:{label:"Wooden Beads ‚òÖ",description:"Ultra-soft, muted thuds (recommended)",...p,filterBaseFreq:420,filterVelocityRange:200,noiseTransientGain:.025,noiseTransientFilterMin:380,noiseTransientFilterMax:1400,noiseTransientQ:1.1,decayTime:.095,intensityExponent:1.7,collisionMinImpact:.62,highShelfGain:-7.5,reverbWetMix:.12},rubberBalls:{label:"Rubber Balls",description:"Bouncy, playful with longer decay",...p,pitchMinHz:160,pitchMaxHz:360,filterBaseFreq:520,filterVelocityRange:350,noiseTransientGain:.035,noiseTransientFilterMin:450,noiseTransientFilterMax:1600,noiseTransientQ:1.2,decayTime:.12,intensityExponent:1.4,reverbWetMix:.14,highShelfGain:-5},metallicClick:{label:"Metallic Click",description:"Crisp, percussive impacts",...p,pitchMinHz:220,pitchMaxHz:620,pitchCurve:1.1,filterBaseFreq:720,filterVelocityRange:550,noiseTransientGain:.08,noiseTransientFilterMin:700,noiseTransientFilterMax:2400,noiseTransientQ:1.8,noiseTransientDecay:.006,decayTime:.045,intensityExponent:1.2,highShelfGain:-3.5,collisionMinImpact:.5}};let y="crystalPebbles";f={...g[y]},delete f.label,delete f.description;let b=null,v=null,M=null,S=null,x=null,w=null,E=null,C=null,I=!1,P=!1;const T="bravia-balls:sound-state";function R(){try{"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent(T,{detail:W()}))}catch(e){}}const B=8;let k=[],A=0,_=new Map,L=!1,F=null;function O(){if("undefined"!=typeof window&&window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion: reduce)");L=e.matches,e.addEventListener("change",e=>{L=e.matches})}console.log("‚úì Sound engine initialized (awaiting user unlock)")}async function D(){if(P)return!0;try{const e=window.AudioContext||window.webkitAudioContext;if(!e)return console.warn("Web Audio API not supported"),!1;b=new e({latencyHint:"interactive",sampleRate:44100}),"suspended"===b.state&&await b.resume(),function(){v=b.createGain(),v.gain.value=f.masterGain,w=b.createDynamicsCompressor(),w.threshold.value=-6,w.knee.value=10,w.ratio.value=16,w.attack.value=5e-4,w.release.value=.08,C=b.createBiquadFilter(),C.type="highshelf",C.frequency.value=f.highShelfFreq,C.gain.value=f.highShelfGain,C.Q.value=.7,E=b.createWaveShaper(),E.curve=function(e=.55){const t=1024,n=new Float32Array(t),a=1+8*e;for(let e=0;e<t;e++){const o=2*e/(t-1)-1;n[e]=Math.tanh(a*o)/Math.tanh(a)}return n}(.55),E.oversample="2x",S=b.createGain(),S.gain.value=1-f.reverbWetMix,x=b.createGain(),x.gain.value=f.reverbWetMix,M=function(){const e=b.createGain(),t=b.createGain(),n=[.029,.037,.053,.067].map(e=>{const t=b.createDelay(.1);return t.delayTime.value=e*f.reverbDecay,t}),a=n.map(()=>{const e=b.createGain();return e.gain.value=.4,e}),o=b.createBiquadFilter();return o.type="lowpass",o.frequency.value=2e3*(1-f.reverbHighDamp),o.Q.value=.5,n.forEach((t,i)=>{e.connect(t),t.connect(a[i]),a[i].connect(o),a[i].connect(n[(i+1)%n.length])}),o.connect(t),e.connect(t),e._output=t,e}();const e=M._output;S.connect(E),x.connect(M),e.connect(E),E.connect(C),C.connect(w),w.connect(v),v.connect(b.destination),function(){k=[];for(let e=0;e<B;e++){const t={id:e,inUse:!1,startTime:0,filter:b.createBiquadFilter(),envelope:b.createGain(),panner:b.createStereoPanner(),reverbSend:b.createGain(),noiseFilter:b.createBiquadFilter(),noiseEnvelope:b.createGain(),osc:null,harmonicOsc:null,sparkleOsc:null,noiseSource:null};t.filter.type="lowpass",t.noiseFilter.type="bandpass",t.noiseFilter.Q.value=1.2,t.filter.connect(t.envelope),t.envelope.connect(t.panner),t.panner.connect(S),t.panner.connect(t.reverbSend),t.reverbSend.connect(x),t.noiseFilter.connect(t.noiseEnvelope),t.noiseEnvelope.connect(t.panner),k.push(t)}}()}(),P=!0,I=!0,R();const t=1e3*(b.baseLatency||0);return console.log(`‚úì Audio unlocked (${t.toFixed(1)}ms base latency)`),!0}catch(e){return console.error("Failed to unlock audio:",e),!1}}function $(e,t,n=.5,a=null){if(!I||!P||!b||L)return;if(t<f.collisionMinImpact)return;const o=b.currentTime;if(o-A<.005)return;if(null!==a){if(o-(_.get(a)||0)<f.minTimeBetweenSounds)return;_.set(a,o)}if(A=o,_.size>200){const e=o-.5;for(const[t,n]of _)n<e&&_.delete(t)}const i=function(){for(let e=0;e<B;e++)if(!k[e].inUse)return k[e];let e=k[0];for(let t=1;t<B;t++)k[t].startTime<e.startTime&&(e=k[t]);return N(e),e}();i&&function(e,t,n,a,o){e.inUse=!0,e.startTime=o;const i=Math.max(0,Math.min(1,n)),s=Math.pow(i,f.intensityExponent),l=h(t,f.variancePitch),r=h(f.decayTime,f.varianceDecay)*(1-s*(1-f.velocityDecayScale)),c=r+.02;let d=f.minGain+(f.maxGain-f.minGain)*s;d*=h(1,f.varianceGain);const u=1+(f.velocityBrightnessScale-1)*s;let m=f.filterBaseFreq+f.filterVelocityRange*Math.pow(s,1.3);m*=h(1,f.varianceFilter)*u;const p=2*(a-.5)*f.maxPan,g=.12+.5*(1-s);({gain:d,filterFreq:m}=function(e,t,n){const a=G((e-f.toneSafetyMinHz)/(f.toneSafetyMaxHz-f.toneSafetyMinHz),0,1),o=f.toneSafetyExponent,i=Math.pow(a,o),s=Math.pow(1-a,o),l=G(1-f.toneSafetyHighGainAtten*i-f.toneSafetyLowGainAtten*s,.6,1);let r=Math.min(t*l,f.voiceGainMax);const c=G(1-f.toneSafetyHighBrightAtten*i,.55,1);return{gain:r,filterFreq:G(n*c,f.filterMinHz,f.filterMaxHz)}}(l,d,m)),e.filter.frequency.value=m,e.filter.Q.value=f.filterQ,e.panner.pan.value=p,e.reverbSend.gain.value=g,e.noiseFilter.Q.value=G(f.noiseTransientQ||1.2,.5,8),e.envelope.gain.cancelScheduledValues(o),e.envelope.gain.setValueAtTime(d,o),e.envelope.gain.exponentialRampToValueAtTime(.001,o+r);const y=b.createOscillator();if(y.type="sine",y.frequency.value=l,e.osc=y,y.connect(e.filter),(f.harmonicGain||0)>.001){const t=b.createOscillator();t.type="sine",t.frequency.value=2*l;const n=b.createGain();n.gain.cancelScheduledValues(o),n.gain.setValueAtTime(d*f.harmonicGain,o),n.gain.exponentialRampToValueAtTime(.001,o+r),e.harmonicOsc=t,t.connect(n),n.connect(e.filter),t.onended=()=>{try{n.disconnect()}catch(e){}},t.start(o),t.stop(o+c)}else e.harmonicOsc=null;if((f.sparkleGain||0)>.001){const t=b.createOscillator();t.type="sine";const n=f.sparkleRatioMin||2.3,a=f.sparkleRatioMax||4.1,i=G(n+Math.random()*(a-n),1.2,10);t.frequency.value=l*h(i,.02);const s=b.createGain(),u=Math.max(.012,r*G(f.sparkleDecayMul||.65,.25,.95));s.gain.cancelScheduledValues(o),s.gain.setValueAtTime(d*f.sparkleGain,o),s.gain.exponentialRampToValueAtTime(.001,o+u),e.sparkleOsc=t,t.connect(s),s.connect(e.filter),t.onended=()=>{try{s.disconnect()}catch(e){}},t.start(o),t.stop(o+c)}else e.sparkleOsc=null;if(f.noiseTransientEnabled&&s>.25){const t=function(){if(!F){const e=2*b.sampleRate;F=b.createBuffer(1,e,b.sampleRate);const t=F.getChannelData(0);let n=0,a=0,o=0;for(let i=0;i<e;i++){const e=2*Math.random()-1;n=.99765*n+.099046*e,a=.963*a+.2965164*e,o=.57*o+1.0526913*e,t[i]=.25*(n+a+o+.1848*e)}}const e=b.createBufferSource();return e.buffer=F,e.loopStart=1.5*Math.random(),e.loopEnd=e.loopStart+.1,e.loop=!1,e}();e.noiseSource=t;const n=Math.pow(s,1.4),a=f.noiseTransientFilterMin+(f.noiseTransientFilterMax-f.noiseTransientFilterMin)*n;e.noiseFilter.frequency.value=h(a,f.varianceNoise);const i=f.noiseTransientGain*f.velocityNoiseScale*n*d,l=h(f.noiseTransientDecay,f.varianceNoise);e.noiseEnvelope.gain.cancelScheduledValues(o),e.noiseEnvelope.gain.setValueAtTime(i,o),e.noiseEnvelope.gain.exponentialRampToValueAtTime(.001,o+l),t.connect(e.noiseFilter),t.start(o),t.stop(o+l+.01)}else e.noiseSource=null;y.start(o),y.stop(o+c),y.onended=()=>N(e)}(i,function(e){const t=1-G((e-8)/47,0,1),n=G(f.pitchMinHz||145,40,6e3),a=G(f.pitchMaxHz||280,n+10,12e3),o=G(f.pitchCurve||1,.5,2.5);return(n+Math.pow(t,o)*(a-n))*h(1,1.5*(f.variancePitch||.06))}(e),Math.max(0,Math.min(1,t)),n,o)}function N(e){if(e.osc){try{e.osc.stop(),e.osc.disconnect()}catch(e){}e.osc=null}if(e.harmonicOsc){try{e.harmonicOsc.stop(),e.harmonicOsc.disconnect()}catch(e){}e.harmonicOsc=null}if(e.sparkleOsc){try{e.sparkleOsc.stop(),e.sparkleOsc.disconnect()}catch(e){}e.sparkleOsc=null}if(e.noiseSource){try{e.noiseSource.stop(),e.noiseSource.disconnect()}catch(e){}e.noiseSource=null}e.inUse=!1}function G(e,t,n){return e<t?t:e>n?n:e}function q(){return!!P&&(I=!I,R(),I)}function W(){return{isUnlocked:P,isEnabled:I,activeSounds:k.filter(e=>e.inUse).length,poolSize:B}}function z(){return{...f}}function V(e){for(const[t,n]of Object.entries(e))t in f&&(f[t]=n);x&&S&&"reverbWetMix"in e&&(x.gain.value=f.reverbWetMix,S.gain.value=1-f.reverbWetMix),C&&("highShelfFreq"in e||"highShelfGain"in e)&&(C.frequency.value=f.highShelfFreq,C.gain.value=f.highShelfGain),v&&"masterGain"in e&&(v.gain.value=f.masterGain)}function H(){return y}const K=new Map;function X(e=10){const t=i(),a=t.balls,o=function(){const e=i(),t=e.balls,a=e.canvas,o=e.R_MAX,s=(e.ballSpacing||0)*(e.DPR||1),l=t.length;if(l<2)return[];const r=Math.max(1,2*o),c=Math.ceil(a.width/r)+1;K.clear();for(let e=0;e<l;e++){const n=t[e],a=n.x/r|0,o=(n.y/r|0)*c+a;let i=K.get(o);i||(i=[],K.set(o,i)),i.push(e)}const d=[];for(const[e,a]of K){const o=e/c|0,i=e%c;for(let e=-1;e<=1;e++)for(let l=-1;l<=1;l++){const r=(o+e)*c+(i+l),u=K.get(r);if(u)for(let e=0;e<a.length;e++){const o=a[e];for(let e=0;e<u.length;e++){const a=u[e];if(a<=o)continue;const i=t[o],l=t[a],r=l.x-i.x,c=l.y-i.y,m=i.r+l.r+s,h=r*r+c*c;if(h<m*m){const e=m-Math.sqrt(Math.max(h,n.MIN_DISTANCE_EPSILON));d.push({i:o,j:a,overlap:e})}}}}}return d.sort((e,t)=>t.overlap-e.overlap),d}(),s=t.REST,l=.5*t.DPR,r=(t.ballSpacing||0)*(t.DPR||1);for(let i=0;i<e;i++)for(let e=0;e<o.length;e++){const{i:c,j:d}=o[e],u=a[c],m=a[d];if(u.isSleeping&&m.isSleeping)continue;u.isSleeping&&u.wake(),m.isSleeping&&m.wake();const h=m.x-u.x,p=m.y-u.y,f=u.r+m.r+r,g=h*h+p*p;if(0===g||g>f*f)continue;const y=Math.sqrt(g),b=h/y,v=p/y,M=f-y,S=1/Math.max(u.m,.001),x=1/Math.max(m.m,.001),w=.8*Math.max(M-l,0)/(S+x),E=w*b,C=w*v;u.x-=E*S,u.y-=C*S,m.x+=E*x,m.y+=C*x;const I=m.vx-u.vx,P=m.vy-u.vy,T=I*b+P*v;if(T<0){const e=-(1+(Math.abs(T)<30?0:s))*T/(S+x),a=e*b,o=e*v;u.vx-=a*S,u.vy-=o*S,m.vx+=a*x,m.vy+=o*x;const l=I-T*b,r=P-T*v,d=Math.hypot(l,r);if(d>.001){const e=l*-v+r*b>=0?1:-1,t=n.SPIN_GAIN_TANGENT;u.omega-=e*t*d/Math.max(u.r,1),m.omega+=e*t*d/Math.max(m.r,1)}const h=Math.min(1,Math.abs(T)/(50*(u.r+m.r))),p=Math.min(t.getSquashMax(),.8*h);u.squashAmount=Math.max(u.squashAmount,.8*p),u.squashNormalAngle=Math.atan2(-v,-b),m.squashAmount=Math.max(m.squashAmount,.8*p),m.squashNormalAngle=Math.atan2(v,b),0===i&&$((u.r+m.r)/2,h,(u.x+m.x)/2/(t.canvas?.width||1),`${c}-${e}`)}}}const U=12;class Y{constructor(){this.deformations=new Float32Array(U),this.velocities=new Float32Array(U)}impact(e,t){const n=i(),a=Math.max(0,Math.min(.45,n.wallWobbleCornerClamp??.1)),o=11*Math.max(a,Math.min(1-a,e)),s=(n.wallWobbleMaxDeform??30)*t,l=Math.max(.25,n.wallWobbleSigma??2);for(let e=1;e<11;e++){const t=Math.abs(e-o),n=Math.exp(-t*t/(2*l*l)),a=Math.min(e,11-e),i=Math.min(1,a/2);this.velocities[e]+=s*n*i}}step(e){const t=i(),n=Math.max(1,t.wallWobbleStiffness??400),a=Math.max(0,t.wallWobbleDamping??18),o=Math.max(0,t.wallWobbleMaxDeform??30);this.deformations[0]=0,this.deformations[11]=0,this.velocities[0]=0,this.velocities[11]=0;for(let t=1;t<11;t++){const i=-n*this.deformations[t]-a*this.velocities[t];this.velocities[t]+=i*e,this.deformations[t]+=this.velocities[t]*e,this.deformations[t]=Math.max(0,Math.min(o,this.deformations[t])),Math.abs(this.deformations[t])<.05&&Math.abs(this.velocities[t])<.1&&(this.deformations[t]=0,this.velocities[t]=0)}}getDeformAt(e){const t=11*Math.max(0,Math.min(1,e)),n=Math.floor(t),a=Math.min(n+1,11),o=t-n,i=o*o*(3-2*o);return this.deformations[n]*(1-i)+this.deformations[a]*i}getMaxDeformation(){let e=0;for(let t=0;t<U;t++)this.deformations[t]>e&&(e=this.deformations[t]);return e}hasDeformation(){return this.getMaxDeformation()>.1}reset(){this.deformations.fill(0),this.velocities.fill(0)}}const j={top:new Y,bottom:new Y,left:new Y,right:new Y,step(e){this.top.step(e),this.bottom.step(e),this.left.step(e),this.right.step(e)},reset(){this.top.reset(),this.bottom.reset(),this.left.reset(),this.right.reset()},hasAnyDeformation(){return this.top.hasDeformation()||this.bottom.hasDeformation()||this.left.hasDeformation()||this.right.hasDeformation()}};function Q(e,t,n){e.startsWith("corner")||("top"===e?j.top.impact(t,n):"bottom"===e?j.bottom.impact(t,n):"left"===e?j.left.impact(t,n):"right"===e&&j.right.impact(t,n))}let Z=0;class J{constructor(e,t,n,a){const o=i();this.x=e,this.y=t,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=n,this.rBase=n,this.m=o.ballMassKg,this.color=a,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1,this.isSleeping=!1,this.sleepTimer=0,this._soundId="ball-"+Z++}step(e,a){const o=i(),{currentMode:s,G:l,gravityScale:r,FRICTION:c,MASS_BASELINE_KG:d}=o;if(this.t+=e,this.age+=e,this.isSleeping&&s===t.PIT){const e=o.mouseX,t=o.mouseY,n=(o.repelRadius||710)*o.DPR*1.2,a=this.x-e,i=this.y-t;a*a+i*i<n*n&&this.wake()}if(this.isSleeping)return;s!==t.WEIGHTLESS&&(this.vy+=l*r*e);const u=Math.max(.25,this.m/d),m=s===t.WEIGHTLESS?1e-4:c,h=Math.max(0,1-m/u);this.vx*=h,this.vy*=h,0!==this.driftAx&&this.age<this.driftTime?this.vx+=this.driftAx*e/u:0!==this.driftAx&&(this.driftAx=0),a&&a(this,e),this.x+=this.vx*e,this.y+=this.vy*e;const p=Math.max(0,1-n.SPIN_DAMP_PER_S*e);this.omega*=p,this.theta+=this.omega*e;const f=Math.min(1,n.SQUASH_DECAY_PER_S*e);this.squashAmount+=(0-this.squashAmount)*f,this.squash=1-this.squashAmount,s===t.PIT&&this.updateSleepState(e,o)}updateSleepState(e,t){const a=Math.sqrt(this.vx*this.vx+this.vy*this.vy),o=Math.abs(this.omega),i=t.canvas;i&&this.y+this.r>=i.height-1&&a<n.SLEEP_VELOCITY_THRESHOLD&&o<n.SLEEP_ANGULAR_THRESHOLD?(this.sleepTimer+=e,this.sleepTimer>=n.TIME_TO_SLEEP&&(this.vx=0,this.vy=0,this.omega=0,this.isSleeping=!0)):this.sleepTimer=0}wake(){this.isSleeping=!1,this.sleepTimer=0}walls(e,a,o,s){const l=i(),{REST:r,MASS_BASELINE_KG:c,MASS_REST_EXP:d,currentMode:u,DPR:m}=l,h=void 0!==s?s:r,p=(l.getCanvasCornerRadius()||100)*(m||1),f=3*(m||1);let g=!1;const y=[{cx:p,cy:p},{cx:e-p,cy:p},{cx:p,cy:a-p},{cx:e-p,cy:a-p}];for(let n=0;n<y.length;n++){if(u===t.PIT&&n<2)continue;const o=y[n],i=n%2==0?this.x<p:this.x>e-p,s=n<2?this.y<p:this.y>a-p;if(i&&s){const e=this.x-o.cx,t=this.y-o.cy,n=Math.sqrt(e*e+t*t),a=p-this.r;if(n>a&&a>0){g=!0;const o=n-a,i=e/n,s=t/n;this.x-=i*o,this.y-=s*o;const l=this.vx*i+this.vy*s;l>0&&(this.vx-=(1+h)*l*i,this.vy-=(1+h)*l*s)}}}const b=f,v=e-f,M=f,S=a-f;if(this.y+this.r>S){g=!0,this.y=S-this.r;const t=this.vy,a=this.vx-this.omega*this.r,i=Math.max(.25,this.m/c);this.omega+=a/this.r*n.SPIN_GAIN/i;const s=Math.max(0,1-n.ROLL_FRICTION_PER_S*o/i);this.vx*=s;const r=Math.abs(t)<n.WALL_REST_VEL_THRESHOLD?0:h;this.vy=-this.vy*(r*Math.pow(c/this.m,d));const u=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(l.getSquashMax(),.8*u),this.squashNormalAngle=-Math.PI/2;const m=this.vx/this.r;this.omega+=(m-this.omega)*Math.min(1,n.GROUND_COUPLING_PER_S*o),$(this.r,.7*u,this.x/e,this._soundId),Q("bottom",this.x/e,u)}if(u!==t.PIT&&this.y-this.r<M){g=!0,this.y=M+this.r;const t=this.vy;this.vy=-this.vy*h;const n=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(l.getSquashMax(),.8*n),this.squashNormalAngle=Math.PI/2,$(this.r,.7*n,this.x/e,this._soundId),Q("top",this.x/e,n)}if(this.x+this.r>v){g=!0,this.x=v-this.r;const e=this.vx,t=this.vy-this.omega*this.r,o=Math.max(.25,this.m/c);this.omega+=t/this.r*(.5*n.SPIN_GAIN)/o,this.vx=-this.vx*(r*Math.pow(c/this.m,d));const i=Math.min(1,Math.abs(e)/(70*this.r));this.squashAmount=Math.min(l.getSquashMax(),.8*i),this.squashNormalAngle=Math.PI,$(this.r,.6*i,1,this._soundId),Q("right",this.y/a,i)}if(this.x-this.r<b){g=!0,this.x=b+this.r;const e=this.vx,t=this.vy-this.omega*this.r,o=Math.max(.25,this.m/c);this.omega+=t/this.r*(.5*n.SPIN_GAIN)/o,this.vx=-this.vx*(r*Math.pow(c/this.m,d));const i=Math.min(1,Math.abs(e)/(70*this.r));this.squashAmount=Math.min(l.getSquashMax(),.8*i),this.squashNormalAngle=0,$(this.r,.6*i,0,this._soundId),Q("left",this.y/a,i)}g&&this.isSleeping&&this.wake()}draw(e){const t=this.squashAmount>.001,n=this.alpha<1;if(t||n){if(e.save(),e.translate(this.x,this.y),t){e.rotate(this.theta+this.squashNormalAngle);const t=1-.3*this.squashAmount,n=1+.3*this.squashAmount;e.scale(t,n),e.rotate(-this.squashNormalAngle)}else e.rotate(this.theta);n&&(e.globalAlpha=this.alpha),e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI),e.fillStyle=this.color,e.fill(),e.restore()}else e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.r,0,2*Math.PI),e.fill()}}const ee=[];function te(e,t){const n=i(),a=n.waterDrag||.015;e.vx*=1-a,e.vy*=1-a,e.omega*=1-.5*a;for(let n=0;n<ee.length;n++){const a=ee[n],o=e.x-a.x,i=e.y-a.y,s=Math.sqrt(o*o+i*i),l=40,r=a.radius-l,c=a.radius+l;if(s>r&&s<c){const n=Math.abs(s-a.radius),r=a.strength*(1-n/l);if(s>.1){const n=o/s,a=i/s;e.vx+=n*r*t,e.vy+=a*r*t}}}const o=n.waterDriftStrength||25;e.vx+=Math.sin(.5*e.t+.01*e.x)*o*t,e.vy+=Math.cos(.7*e.t+.01*e.y)*o*t}function ne(e,t,n=1){const a=(i().waterRippleStrength||15e3)*Math.min(n,5);ee.push({x:e,y:t,radius:0,strength:a,age:0})}const ae=n.PHYSICS_DT;let oe=0;const ie=42;function se(e,t){const n=[{x:ie,y:ie},{x:t.width-ie,y:ie},{x:ie,y:t.height-ie},{x:t.width-ie,y:t.height-ie}];for(let t=0;t<n.length;t++){const a=n[t].x,o=n[t].y,i=e.x-a,s=e.y-o,l=Math.max(1,Math.hypot(i,s));if(l<ie+e.r){const t=(ie+e.r-l)/(ie+e.r)*1800,n=i/l,a=s/l;e.vx+=n*t*ae,e.vy+=a*t*ae}}}let le="light",re="light";function ce(e,t){return getComputedStyle(document.documentElement).getPropertyValue(e).trim()||t}function de(e){le=e;let t=!1;t="auto"===e?"dark"===re:"dark"===e,function(e){const t=i();t.isDarkMode=e,document.documentElement.style.colorScheme=e?"dark":"light",e?(t.container?.classList.add("dark-mode"),document.body.classList.add("dark-mode"),document.documentElement.classList.add("dark-mode")):(t.container?.classList.remove("dark-mode"),document.body.classList.remove("dark-mode"),document.documentElement.classList.remove("dark-mode")),function(e){const t=ce("--chrome-bg-light","#0a0a0a"),n=ce("--chrome-bg-dark","#0a0a0a"),a=e?n:t;let o=document.querySelector('meta[name="theme-color"]');o||(o=document.createElement("meta"),o.name="theme-color",document.head.appendChild(o)),o.content=a;let i=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: light)"]');i||(i=document.createElement("meta"),i.name="theme-color",i.media="(prefers-color-scheme: light)",document.head.appendChild(i)),i.content=t;let s=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: dark)"]');s||(s=document.createElement("meta"),s.name="theme-color",s.media="(prefers-color-scheme: dark)",document.head.appendChild(s)),s.content=n}(e),u(t.currentTemplate),function(){const e=document.getElementById("themeAuto"),t=document.getElementById("themeLight"),n=document.getElementById("themeDark");if(!e||!t||!n)return;[e,t,n].forEach(e=>e.classList.remove("active")),"auto"===le?e.classList.add("active"):"light"===le?t.classList.add("active"):n.classList.add("active");const a=document.getElementById("themeStatus");if(a){const e=i();a.textContent="auto"===le?e.isDarkMode?"üåô Auto (Dark)":"‚òÄÔ∏è Auto (Light)":"light"===le?"‚òÄÔ∏è Light Mode":"üåô Dark Mode"}}()}(t);try{localStorage.setItem("theme-preference",e)}catch(e){}console.log(`üé® Theme set to: ${e} (rendering: ${t?"dark":"light"})`)}function ue(){re=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",console.log(`üñ•Ô∏è System prefers: ${re}`),de("light");const e=document.getElementById("themeAuto"),t=document.getElementById("themeLight"),n=document.getElementById("themeDark");e&&e.addEventListener("click",()=>de("auto")),t&&t.addEventListener("click",()=>de("light")),n&&n.addEventListener("click",()=>de("dark")),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{re=e.matches?"dark":"light",console.log(`üñ•Ô∏è System preference changed to: ${re}`),"auto"===le&&de("auto")}),console.log("‚úì Modern dark mode initialized")}function me(){return le}let he,pe,fe=n.DPR;function ge(){he=document.getElementById("c"),he?(pe=he.getContext("2d",{alpha:!0,desynchronized:!0,willReadFrequently:!1}),pe||(pe=he.getContext("2d"),console.warn("‚ö†Ô∏è Desynchronized mode unavailable, using standard context")),function(){const e=window.devicePixelRatio||1;(navigator.connection?.saveData||navigator.hardwareConcurrency<=4||/Android|iPhone|iPad|iPod/i.test(navigator.userAgent))&&e>1.5?(fe=1.5,console.log("‚ö° Adaptive DPR: Reduced to 1.5x for performance")):fe=Math.min(e,2),a=fe}(),pe.imageSmoothingEnabled=!1,window.addEventListener("resize",ye),console.log(`‚úì Renderer optimized (DPR: ${fe.toFixed(2)}, desync: ${pe.getContextAttributes?.()?.desynchronized??"unknown"})`)):console.error("Canvas not found")}function ye(){if(!he)return;const e=i().container||document.getElementById("bravia-balls"),t=e?e.clientWidth:window.innerWidth,n=e?e.clientHeight:window.innerHeight,a=fe;he.width=Math.floor(t*a),he.height=Math.floor(n*a),he.style.width=t+"px",he.style.height=n+"px",pe&&(pe.imageSmoothingEnabled=!1),function(e){const t=i();if(!t.canvasShadowEnabled)return void(e.style.filter="");const n=t.shadowOffsetX||1,a=t.shadowOffsetY||1,o=t.shadowBlur||0,s=t.shadowColor||"#000000",l=t.shadowOpacity||.29,r=t.shadow2Enabled?` drop-shadow(0 0 ${t.shadow2Blur||4}px rgba(0,0,0,${t.shadow2Opacity||.1}))`:"";e.style.filter=`drop-shadow(${n}px ${a}px ${o}px ${function(e,t){const n=e.replace("#",""),a=parseInt(n,16);return`rgba(${a>>16&255}, ${a>>8&255}, ${255&a}, ${t})`}(s,l)})${r}`}(he)}function be(){return he}function ve(){return pe}function Me(){console.log("‚ö†Ô∏è localStorage is disabled")}function Se(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(Me,500)}let xe=null,we={};function Ee(e){return!1!==we[e]}!function(){try{const e=localStorage.getItem("panel_control_visibility");e&&(we=JSON.parse(e))}catch(e){we={}}}();const Ce={balls:{title:"Balls",icon:"üé±",defaultOpen:!1,controls:[{id:"sizeGlobal",label:"Size",stateKey:"sizeScale",type:"range",min:.1,max:6,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat,onChange:(e,t)=>{const n=(e.R_MIN_BASE+e.R_MAX_BASE)/2;e.R_MIN=n*t*.75,e.R_MAX=n*t*1.25;const a=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=a,e.rBase=a}),Promise.resolve().then(function(){return At}).then(({updateCursorSize:e})=>{e()})}},{id:"ballSoftnessGlobal",label:"Softness",stateKey:"ballSoftness",type:"range",min:0,max:100,step:1,default:20,format:e=>String(e),parse:e=>parseInt(e,10)},{id:"ballSpacing",label:"Spacing",stateKey:"ballSpacing",type:"range",min:0,max:10,step:.5,default:2.5,format:e=>e.toFixed(1)+"px",parse:parseFloat}]},cursor:{title:"Cursor",icon:"üëÜ",defaultOpen:!1,controls:[{id:"cursorSize",label:"Size",stateKey:"cursorSize",type:"range",min:.1,max:3,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,onChange:(e,t)=>{Promise.resolve().then(function(){return At}).then(({updateCursorSize:e})=>{e()})}}]},frame:{title:"Frame",icon:"üñºÔ∏è",defaultOpen:!1,controls:[{id:"frameColor",label:"Color",stateKey:"frameColor",type:"color",default:"#0a0a0a",onChange:(e,t)=>{const n=document.documentElement;n.style.setProperty("--frame-color-light",t),n.style.setProperty("--frame-color-dark",t),n.style.setProperty("--wall-color",t),n.style.setProperty("--chrome-bg",t),n.style.setProperty("--chrome-bg-light",t),n.style.setProperty("--chrome-bg-dark",t);const a=document.querySelector('meta[name="theme-color"]');a&&(a.content=t)}}]},shadow:{title:"Inner Shadow",icon:"üåë",defaultOpen:!1,controls:[{id:"containerInnerShadowOpacity",label:"Strength",stateKey:"containerInnerShadowOpacity",type:"range",min:0,max:.4,step:.01,default:.12,format:e=>e.toFixed(2),parse:parseFloat,cssVar:"--container-inner-shadow-opacity"},{id:"containerInnerShadowBlur",label:"Blur",stateKey:"containerInnerShadowBlur",type:"range",min:0,max:250,step:5,default:80,format:e=>`${Math.round(e)}px`,parse:e=>parseInt(e,10),cssVar:"--container-inner-shadow-blur"},{id:"containerInnerShadowSpread",label:"Spread",stateKey:"containerInnerShadowSpread",type:"range",min:-50,max:50,step:1,default:-10,format:e=>`${Math.round(e)}px`,parse:e=>parseInt(e,10),cssVar:"--container-inner-shadow-spread"},{id:"containerInnerShadowOffsetY",label:"Offset Y",stateKey:"containerInnerShadowOffsetY",type:"range",min:-60,max:60,step:1,default:0,format:e=>`${Math.round(e)}px`,parse:e=>parseInt(e,10),cssVar:"--container-inner-shadow-offset-y"}]},wobble:{title:"Wall Wobble",icon:"„Ä∞Ô∏è",defaultOpen:!1,controls:[{id:"wallWobbleMaxDeform",label:"Strength",stateKey:"wallWobbleMaxDeform",type:"range",min:0,max:150,step:1,default:148,format:e=>`${e}px`,parse:e=>parseInt(e,10)},{id:"wallWobbleStiffness",label:"Return Speed",stateKey:"wallWobbleStiffness",type:"range",min:50,max:3e3,step:10,default:1300,format:e=>String(e),parse:e=>parseInt(e,10)},{id:"wallWobbleDamping",label:"Damping",stateKey:"wallWobbleDamping",type:"range",min:0,max:80,step:1,default:34,format:e=>String(e),parse:e=>parseInt(e,10)},{id:"wallWobbleSigma",label:"Impact Spread",stateKey:"wallWobbleSigma",type:"range",min:.5,max:4,step:.1,default:4,format:e=>e.toFixed(1),parse:parseFloat},{id:"wallWobbleCornerClamp",label:"Corner Stickiness",stateKey:"wallWobbleCornerClamp",type:"range",min:0,max:1,step:.01,default:1,format:e=>e.toFixed(2),parse:parseFloat}]},noise:{title:"Noise",icon:"üì∫",defaultOpen:!1,controls:[{id:"noiseSizeBase",label:"Back Size",stateKey:"noiseSizeBase",type:"range",min:50,max:200,step:5,default:100,format:e=>String(e),parse:e=>parseInt(e,10),cssVar:"--noise-size-base"},{id:"noiseSizeTop",label:"Front Size",stateKey:"noiseSizeTop",type:"range",min:40,max:150,step:5,default:80,format:e=>String(e),parse:e=>parseInt(e,10),cssVar:"--noise-size-top"},{id:"noiseBackOpacity",label:"Back Opacity",stateKey:"noiseBackOpacity",type:"range",min:0,max:.1,step:.001,default:.015,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-back-opacity"},{id:"noiseFrontOpacity",label:"Front Opacity",stateKey:"noiseFrontOpacity",type:"range",min:0,max:.05,step:.001,default:.01,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-front-opacity"}]},pit:{title:"Ball Pit",icon:"üéØ",mode:"pit",defaultOpen:!1,controls:[{id:"gravityPit",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange:(e,t)=>{"pit"===e.currentMode&&(e.G=e.GE*t)}},{id:"weightPit",label:"Weight",stateKey:"ballMassKg",type:"range",min:10,max:200,step:1,default:129,format:e=>e.toFixed(0),parse:parseFloat,onChange:(e,t)=>{e.balls.forEach(e=>{e.m=t})}},{id:"restitution",label:"Bounciness",stateKey:"REST",type:"range",min:0,max:1,step:.01,default:.69,format:e=>e.toFixed(2),parse:parseFloat},{id:"friction",label:"Air Friction",stateKey:"FRICTION",type:"range",min:0,max:.01,step:5e-4,default:.006,format:e=>e.toFixed(4),parse:parseFloat},{id:"repelSize",label:"Repel Size",stateKey:"repelRadius",type:"range",min:50,max:1e3,step:5,default:120,format:e=>e.toFixed(0),parse:parseFloat},{id:"repelPower",label:"Repel Power",stateKey:"repelPower",type:"range",min:0,max:1e4,step:100,default:8500,format:e=>Math.round(e).toString(),parse:parseFloat,onChange:(e,t)=>{const n=Math.max(0,Math.min(1e4,t))/1e4;e.repelPower=12e3*Math.pow(2,12*(n-.5))*2}}]},flies:{title:"Flies",icon:"üïäÔ∏è",mode:"flies",defaultOpen:!1,controls:[{id:"fliesBallCount",label:"Ball Count",stateKey:"fliesBallCount",type:"range",min:20,max:150,step:5,default:60,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"attractPower",label:"Attraction",stateKey:"attractionPower",type:"range",min:100,max:8e3,step:50,default:5e3,format:e=>Math.round(e).toString(),parse:parseFloat},{id:"swarmSpeed",label:"Swarm Speed",stateKey:"swarmSpeed",type:"range",min:.2,max:5,step:.1,default:.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"fliesSeparation",label:"Separation",stateKey:"fliesSeparation",type:"range",min:5e3,max:3e4,step:1e3,default:15e3,format:e=>Math.round(e).toString(),parse:parseFloat}]},weightless:{title:"Zero-G",icon:"üåå",mode:"weightless",defaultOpen:!1,controls:[{id:"weightlessCount",label:"Ball Count",stateKey:"weightlessBallCount",type:"range",min:20,max:200,step:10,default:80,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"weightlessSpeed",label:"Initial Speed",stateKey:"weightlessInitialSpeed",type:"range",min:100,max:600,step:25,default:250,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"weightlessBounce",label:"Bounce",stateKey:"weightlessBounce",type:"range",min:.5,max:1,step:.05,default:.95,format:e=>e.toFixed(2),parse:parseFloat}]},water:{title:"Water",icon:"üåä",mode:"water",defaultOpen:!1,controls:[{id:"waterBallCount",label:"Ball Count",stateKey:"waterBallCount",type:"range",min:50,max:400,step:10,default:300,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"waterRippleStrength",label:"Ripple Strength",stateKey:"waterRippleStrength",type:"range",min:5e3,max:3e4,step:1e3,default:18e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"waterMotion",label:"Motion",stateKey:"waterDriftStrength",type:"range",min:0,max:80,step:1,default:40,format:e=>e.toFixed(0),parse:parseFloat,onChange:(e,t)=>{e.waterInitialVelocity=5*t},reinitMode:!0}]},vortex:{title:"Vortex",icon:"üåÄ",mode:"vortex",defaultOpen:!1,controls:[{id:"vortexBallCount",label:"Ball Count",stateKey:"vortexBallCount",type:"range",min:50,max:300,step:10,default:180,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"vortexSwirl",label:"Swirl Strength",stateKey:"vortexSwirlStrength",type:"range",min:100,max:800,step:20,default:420,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexPull",label:"Radial Pull",stateKey:"vortexRadialPull",type:"range",min:0,max:400,step:10,default:180,format:e=>e.toFixed(0),parse:parseFloat}]},"ping-pong":{title:"Ping Pong",icon:"üèì",mode:"ping-pong",defaultOpen:!1,controls:[{id:"pingPongBallCount",label:"Ball Count",stateKey:"pingPongBallCount",type:"range",min:10,max:100,step:5,default:35,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"pingPongSpeed",label:"Ball Speed",stateKey:"pingPongSpeed",type:"range",min:200,max:1200,step:50,default:800,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"pingPongCursor",label:"Cursor Size",stateKey:"pingPongCursorRadius",type:"range",min:20,max:200,step:10,default:50,format:e=>e.toFixed(0),parse:parseFloat}]},magnetic:{title:"Magnetic",icon:"üß≤",mode:"magnetic",defaultOpen:!1,controls:[{id:"magneticBallCount",label:"Ball Count",stateKey:"magneticBallCount",type:"range",min:50,max:300,step:10,default:180,format:e=>String(e),parse:e=>parseInt(e,10),reinitMode:!0},{id:"magneticStrength",label:"Strength",stateKey:"magneticStrength",type:"range",min:1e4,max:1e5,step:5e3,default:65e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticVelocity",label:"Max Velocity",stateKey:"magneticMaxVelocity",type:"range",min:500,max:4e3,step:100,default:2800,format:e=>e.toFixed(0),parse:parseFloat}]},bubbles:{title:"Bubbles",icon:"ü´ß",mode:"bubbles",defaultOpen:!1,controls:[{id:"bubblesRate",label:"Bubble Rate",stateKey:"bubblesSpawnRate",type:"range",min:1,max:20,step:1,default:8,format:e=>String(e),parse:e=>parseInt(e,10)},{id:"bubblesSpeed",label:"Rise Speed",stateKey:"bubblesRiseSpeed",type:"range",min:50,max:400,step:25,default:150,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesWobble",label:"Wobble",stateKey:"bubblesWobble",type:"range",min:0,max:100,step:5,default:40,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesMax",label:"Max Bubbles",stateKey:"bubblesMaxCount",type:"range",min:50,max:300,step:10,default:150,format:e=>String(e),parse:e=>parseInt(e,10)},{id:"bubblesDeflect",label:"Cursor Deflection",stateKey:"bubblesDeflectRadius",type:"range",min:20,max:150,step:10,default:80,format:e=>e.toFixed(0),parse:parseFloat}]}};function Ie(e){if(!Ee(e.id))return"";const t=e.id+"Slider",n=e.id+"Val",a=e.id+"Picker";if("color"===e.type)return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${n}">${e.default}</span>\n        </div>\n        <input type="color" id="${a}" value="${e.default}" aria-label="${e.label}" />\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`;const o=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${n}">${e.format(e.default)}</span>\n        </div>\n        <input type="range" id="${t}" min="${e.min}" max="${e.max}" step="${e.step}" value="${e.default}">\n      </label>\n      ${o}`}function Pe(e,t){const n=t.controls.filter(e=>Ee(e.id));if(0===n.length)return"";let a=null,o="";for(const e of n)e.group&&e.group!==a?(null!==a&&(o+="</div>"),o+=`<div class="section-title" style="margin-top: 12px;">${e.group}</div><div class="group">`,a=e.group):e.group||null===a||(o+="</div>",a=null),o+=Ie(e);null!==a&&(o+="</div>");const i=t.defaultOpen?"open":"",s=`\n    <summary class="panel-section-header">\n      ${t.icon?`<span class="section-icon">${t.icon}</span>`:""}\n      <span class="section-label">${t.title}</span>\n    </summary>`,l=`<div class="panel-section-content">${o}</div>`;return t.mode?`\n      <div id="${t.mode}Controls" class="mode-controls">\n        <details class="panel-section-accordion" ${i}>\n          ${s}\n          ${l}\n        </details>\n      </div>`:`\n    <details class="panel-section-accordion" ${i}>\n      ${s}\n      ${l}\n    </details>`}const Te=function(){const e="8001"===window.location.port||null!==document.querySelector('script[type="module"][src*="main.js"]');let t=`\n    <div class="environment-badge" style="\n      position: sticky;\n      top: 0;\n      padding: 0.5rem 1rem;\n      background: ${e?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)"};\n      color: white;\n      font-weight: 700;\n      font-size: 0.7rem;\n      text-align: center;\n      z-index: 1000;\n      letter-spacing: 0.1em;\n      text-transform: uppercase;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n      margin: -1rem -1rem 1rem -1rem;\n      user-select: none;\n    " role="status" aria-label="Environment indicator">\n      ${e?"üöÄ DEV MODE ‚Äî Instant Reload":"üì¶ PRODUCTION BUILD ‚Äî Bundled"}\n    </div>\n    \x3c!-- Screen reader announcements --\x3e\n    <div role="status" aria-live="polite" aria-atomic="true" class="sr-only" id="announcer"></div>\n\n    \x3c!-- Theme --\x3e\n    <details class="panel-section-accordion" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">üé®</span>\n        <span class="section-label">Theme</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="theme-segment-control" role="group" aria-label="Theme selector">\n          <button id="themeAuto" class="theme-segment-btn" aria-label="Auto theme">Auto</button>\n          <button id="themeLight" class="theme-segment-btn active" aria-label="Light theme">Light</button>\n          <button id="themeDark" class="theme-segment-btn" aria-label="Dark theme">Dark</button>\n        </div>\n        <div id="themeStatus" class="panel-status">‚òÄÔ∏è Light Mode</div>\n      </div>\n    </details>\n\n    \x3c!-- Mode --\x3e\n    <details class="panel-section-accordion" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">üéõÔ∏è</span>\n        <span class="section-label">Mode</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="mode-switcher" role="group" aria-label="Simulation mode selector">\n          <button class="mode-button active" data-mode="pit" aria-label="Ball Pit mode">üéØ Pit</button>\n          <button class="mode-button" data-mode="flies" aria-label="Flies mode">üïäÔ∏è Flies</button>\n          <button class="mode-button" data-mode="weightless" aria-label="Zero-G mode">üåå Zero-G</button>\n          <button class="mode-button" data-mode="water" aria-label="Water mode">üåä Water</button>\n          <button class="mode-button" data-mode="vortex" aria-label="Vortex mode">üåÄ Vortex</button>\n          <button class="mode-button" data-mode="ping-pong" aria-label="Ping Pong mode">üèì Pong</button>\n          <button class="mode-button" data-mode="magnetic" aria-label="Magnetic mode">üß≤ Magnet</button>\n          <button class="mode-button" data-mode="bubbles" aria-label="Bubbles mode">ü´ß Bubbles</button>\n        </div>\n      </div>\n    </details>`;for(const[e,n]of Object.entries(Ce))n.mode||(t+=Pe(0,n));t+='\n    <details class="panel-section-accordion">\n      <summary class="panel-section-header">\n        <span class="section-icon">üåà</span>\n        <span class="section-label">Colors</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Color Template</span>\n            <span class="control-value"></span>\n          </div>\n          <select id="colorSelect"></select>\n        </label>\n      </div>\n    </details>';for(const[e,n]of Object.entries(Ce))n.mode&&(t+=Pe(0,n));return t+='\n    <div class="panel-section panel-section--action">\n      <button id="saveConfigBtn" class="primary">üíæ Save Config</button>\n    </div>\n    <div class="panel-footer">\n      <kbd>R</kbd> reset ¬∑ <kbd>/</kbd> panel ¬∑ click cycles modes\n    </div>',t}();function Re(e,t,n){n||(n=c());const a=i(),o=(a.R_MIN+a.R_MAX)/2;let s;if(0===a.sizeVariation)s=o;else{const e=.1*o;r=o+e,s=(l=Math.max(1,o-e))+Math.random()*(r-l)}var l,r;const d=new J(e,t,s,n),u=e<.5*a.canvas.width?1:-1,m=(f=s/(.5*(a.R_MIN+a.R_MAX)),Math.max(.6,Math.min(1.4,f))),h=140*m,p=180*m;var f;return d.vx=u*(h+Math.random()*p),d.vy=120*-Math.random(),d.driftAx=u*(360+420*Math.random())*m,d.driftTime=.22+.28*Math.random(),a.balls.push(d),d}function Be(e,t){const n=i(),a=-1e9===n.mouseX?.5*n.canvas.width:n.mouseX,o=-1e9===n.mouseY?.5*n.canvas.height:n.mouseY,s=a-e.x,l=o-e.y,r=Math.sqrt(s*s+l*l+1),c=s/r,d=l/r;e.vx+=4e3*c*t,e.vy+=4e3*d*t;const u=120*n.DPR;let m=0,h=0,p=0;for(let t=0;t<n.balls.length;t++){const a=n.balls[t];if(a===e)continue;const o=e.x-a.x,i=e.y-a.y,s=o*o+i*i;if(s<u*u&&s>0){const e=Math.sqrt(s),t=1-e/u;m+=o/e*t,h+=i/e*t,p++}}if(p>0){const n=15e3;e.vx+=m/p*n*t,e.vy+=h/p*n*t}e.vx+=1e3*(Math.random()-.5)*t,e.vy+=1e3*(Math.random()-.5)*t}function ke(e,t){const n=i(),a=n.repelPower,o=n.repelRadius,s=n.mouseX,l=n.mouseY;if(!n.repellerEnabled||a<=0||o<=0)return;const r=o*n.DPR,c=e.x-s,d=e.y-l,u=c*c+d*d;if(u>r*r)return;const m=Math.max(Math.sqrt(u),1e-4),h=c/m,p=d/m,f=Math.max(0,1-m/r),g=20*a*Math.pow(f,n.repelSoft||3.4),y=Math.max(.25,e.m/n.MASS_BASELINE_KG);e.vx+=h*g*t/y,e.vy+=p*g*t/y}function Ae(e,n){const a=i();if(a.currentMode!==t.VORTEX)return;const o=a.mouseX,s=a.mouseY;if(!a.mouseInCanvas)return;const l=a.vortexSwirlStrength||420,r=a.vortexRadialPull||180,c=e.x-o,d=e.y-s,u=c*c+d*d,m=Math.max(8,Math.sqrt(u)),h=1/(1+.0015*m),p=c/m,f=d/m,g=-f,y=p,b=l*h;e.vx+=g*b*n,e.vy+=y*b*n;const v=r*h;e.vx-=p*v*n,e.vy-=f*v*n,e.vx*=.995,e.vy*=.995}function _e(e,n){const a=i();if(a.currentMode!==t.PING_PONG)return;if(!e.isPingPong)return;if(a.mouseInCanvas){const t=(a.pingPongCursorRadius||100)*a.DPR,n=a.mouseX,o=a.mouseY,i=e.x-n,s=e.y-o,l=Math.sqrt(i*i+s*s),r=t+e.r;if(l<r&&l>.1){const t=r-l,n=i/l,a=s/l;e.x+=n*t*1.1,e.y+=a*t*1.1;const o=e.vx*n+e.vy*a;o<0&&(e.vx-=2*o*n,e.vy-=2*o*a,e.omega+=.02*o)}}const o=a.pingPongSpeed||400;if(Math.abs(e.vx)<.9*o){const t=e.vx>=0?1:-1;e.vx=t*o}e.vy*=.995}function Le(e,n){const a=i();if(a.currentMode!==t.MAGNETIC)return;if(!a.mouseInCanvas)return;const o=a.mouseX,s=a.mouseY,l=o-e.x,r=s-e.y,c=Math.max(30,Math.sqrt(l*l+r*r)),d=(a.magneticStrength||65e3)/(c*c)*1e3,u=l/c,m=r/c,h=e.charge||1;e.vx+=u*d*h*n,e.vy+=m*d*h*n;const p=a.magneticMaxVelocity||2800,f=Math.sqrt(e.vx*e.vx+e.vy*e.vy);f>p&&(e.vx=e.vx/f*p,e.vy=e.vy/f*p),e.vx*=.998,e.vy*=.998}function Fe(e,t,n,a=!1){const o=i(),s=.5*o.R_MIN,l=.8*o.R_MAX,r=s+Math.random()*(l-s),c=new J(e,t,a?r:.1,n);return c.isBubble=!0,c.baseRadius=r,c.targetRadius=r,c.wobblePhase=Math.random()*Math.PI*2,c.wobbleFreq=2+3*Math.random(),c.vx=20*(Math.random()-.5),c.vy=-50-50*Math.random(),c.spawning=!a,c.spawnProgress=a?1:0,c.dissipating=!1,c.dissipateProgress=0,c.alpha=1,o.balls.push(c),c}function Oe(e){const t=i(),n=t.canvas;if(!n)return;const a=n.width,o=n.height;e.x=Math.random()*a,e.y=o+20+30*Math.random(),e.vx=20*(Math.random()-.5),e.vy=-50-50*Math.random(),e.wobblePhase=Math.random()*Math.PI*2,e.wobbleFreq=2+3*Math.random(),e.c=c();const s=.5*t.R_MIN,l=.8*t.R_MAX;e.targetRadius=s+Math.random()*(l-s),e.baseRadius=e.targetRadius,e.r=.1,e.spawning=!0,e.spawnProgress=0,e.dissipating=!1,e.dissipateProgress=0,e.alpha=1}function De(e,n){const a=i();if(a.currentMode!==t.BUBBLES)return;if(!e.isBubble)return;const o=a.canvas;if(!o)return;if(e.spawning){e.spawnProgress+=3*n;const t=1-Math.pow(1-Math.min(1,e.spawnProgress),3);e.r=e.targetRadius*t,e.rBase=e.r,e.spawnProgress>=1&&(e.spawning=!1,e.r=e.targetRadius,e.rBase=e.targetRadius)}if(e.dissipating){e.dissipateProgress+=3*n;const t=Math.pow(e.dissipateProgress,2);return e.r=e.targetRadius*Math.max(0,1-t),e.rBase=e.r,e.alpha=Math.max(0,1-.5*t),e.vy*=.92,e.vx*=.92,void(e.dissipateProgress>=1&&Oe(e))}const s=a.bubblesRiseSpeed||150,l=.01*(a.bubblesWobble||40),r=s*a.DPR;e.vy-=r*n,e.wobblePhase+=e.wobbleFreq*n;const c=Math.sin(e.wobblePhase)*l*100;if(e.vx+=c*n,e.vx*=.92,e.vy*=.96,a.mouseInCanvas){const t=e.x-a.mouseX,o=e.y-a.mouseY,i=Math.sqrt(t*t+o*o),s=(a.bubblesDeflectRadius||80)*a.DPR;if(i<s&&i>1){const a=300*(1-i/s),l=t/i,r=o/i;e.vx+=l*a*n,e.vy+=r*a*n}}const d=2*e.targetRadius;e.y<d&&!e.dissipating&&!e.spawning&&(e.dissipating=!0,e.dissipateProgress=0),(e.x<4*-e.r||e.x>o.width+4*e.r)&&Oe(e)}function $e(e){const n=i();if(function(e){o.currentMode=e}(e),console.log(`Switching to mode: ${e}`),function(e){const t=document.getElementById("announcer");t&&(t.textContent="",setTimeout(()=>{t.textContent=e},10))}(`Switched to ${{pit:"Ball Pit",flies:"Flies to Light",weightless:"Zero Gravity",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles"}[e]||e} mode`),n.container){const a=n.container.classList.contains("dark-mode");n.container.className="",e===t.PIT&&n.container.classList.add("mode-pit"),(a||n.isDarkMode)&&n.container.classList.add("dark-mode")}ye(),e===t.PIT?(n.gravityMultiplier=n.gravityMultiplierPit,n.G=n.GE*n.gravityMultiplier,n.repellerEnabled=!0,function(){const e=i();s();const t=e.canvas.width,n=e.canvas.height,a=e.DPR,o=-.5*n,l=(e.wallThickness||20)*a,r=l,c=t-l;for(let e=0;e<8;e++){const t=Re(r+Math.random()*(c-r),o+Math.random()*(0-o),d(e));t.vx=100*(Math.random()-.5),t.vy=50*Math.random()+50,t.driftAx=0,t.driftTime=0}for(let e=8;e<300;e++){const e=Re(r+Math.random()*(c-r),o+Math.random()*(0-o));e.vx=100*(Math.random()-.5),e.vy=50*Math.random()+50,e.driftAx=0,e.driftTime=0}}()):e===t.FLIES?(n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,function(){const e=i();s();const t=.5*e.canvas.width,n=.5*e.canvas.height,a=150*e.DPR;for(let e=0;e<8;e++){const o=Math.random()*Math.PI*2,i=Math.random()*a,s=Re(t+Math.cos(o)*i,n+Math.sin(o)*i,d(e)),l=.5+.5*Math.random(),r=Math.random()*Math.PI*2,c=300*l;s.vx=Math.cos(r)*c,s.vy=Math.sin(r)*c,s.driftAx=0,s.driftTime=0}for(let e=8;e<60;e++){const e=Math.random()*Math.PI*2,o=Math.random()*a,i=Re(t+Math.cos(e)*o,n+Math.sin(e)*o),s=.5+.5*Math.random(),l=Math.random()*Math.PI*2,r=300*s;i.vx=Math.cos(l)*r,i.vy=Math.sin(l)*r,i.driftAx=0,i.driftTime=0}}()):e===t.WEIGHTLESS?(n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,function(){const e=i();s();const t=e.weightlessCount,n=e.canvas.width,a=e.canvas.height,o=40*e.DPR;for(let i=0;i<8&&i<t;i++){const t=Re(o+Math.random()*(n-2*o),o+Math.random()*(a-2*o),d(i)),s=Math.random()*Math.PI*2,l=e.weightlessInitialSpeed*(.7+.3*Math.random());t.vx=Math.cos(s)*l,t.vy=Math.sin(s)*l,t.driftAx=0,t.driftTime=0}for(let i=8;i<t;i++){const t=Re(o+Math.random()*(n-2*o),o+Math.random()*(a-2*o)),i=Math.random()*Math.PI*2,s=e.weightlessInitialSpeed*(.7+.3*Math.random());t.vx=Math.cos(i)*s,t.vy=Math.sin(i)*s,t.driftAx=0,t.driftTime=0}}()):e===t.WATER?(n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,function(){const e=i();s(),ee.length=0;const t=e.canvas;if(!t)return;const n=t.width,a=t.height,o=e.waterBallCount||100;for(let t=0;t<8&&t<o;t++){const o=Math.random()*n,i=Math.random()*a,s=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),l=d(t),r=new J(o,i,s,l),c=e.waterInitialVelocity||120;r.vx=(Math.random()-.5)*c,r.vy=(Math.random()-.5)*c,e.balls.push(r)}for(let t=8;t<o;t++){const t=Math.random()*n,o=Math.random()*a,i=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),s=c(),l=new J(t,o,i,s),r=e.waterInitialVelocity||120;l.vx=(Math.random()-.5)*r,l.vy=(Math.random()-.5)*r,e.balls.push(l)}}()):e===t.VORTEX?(n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,function(){const e=i();s();const t=e.canvas;if(!t)return;const n=t.width,a=t.height,o=Math.min(e.vortexBallCount||180,e.maxBalls||300);for(let t=0;t<8&&t<o;t++){const o=Math.random()*n,i=Math.random()*a,s=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),l=d(t),r=new J(o,i,s,l);r.vx=80*(Math.random()-.5),r.vy=80*(Math.random()-.5),e.balls.push(r)}for(let t=8;t<o;t++){const t=Math.random()*n,o=Math.random()*a,i=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),s=c(),l=new J(t,o,i,s);l.vx=80*(Math.random()-.5),l.vy=80*(Math.random()-.5),e.balls.push(l)}}()):e===t.PING_PONG?(n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,function(){const e=i();s();const t=e.canvas;if(!t)return;const n=t.width,a=t.height,o=Math.min(e.pingPongBallCount||80,e.maxBalls||300),l=e.pingPongSpeed||400;for(let t=0;t<8&&t<o;t++){const o=Math.random()*n,i=.15*a+Math.random()*a*.7,s=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),r=d(t),c=new J(o,i,s,r),u=Math.random()>.5?1:-1;c.vx=u*(.8*l+Math.random()*l*.4),c.vy=0,c.isPingPong=!0,e.balls.push(c)}for(let t=8;t<o;t++){const t=Math.random()*n,o=.15*a+Math.random()*a*.7,i=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),s=c(),r=new J(t,o,i,s),d=Math.random()>.5?1:-1;r.vx=d*(.8*l+Math.random()*l*.4),r.vy=0,r.isPingPong=!0,e.balls.push(r)}}()):e===t.MAGNETIC?(n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,function(){const e=i();s();const t=e.canvas;if(!t)return;const n=t.width,a=t.height,o=Math.min(e.magneticBallCount||180,e.maxBalls||300);for(let t=0;t<8&&t<o;t++){const o=Math.random()*n,i=Math.random()*a,s=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),l=d(t),r=new J(o,i,s,l);r.vx=100*(Math.random()-.5),r.vy=100*(Math.random()-.5),r.charge=Math.random()>.5?1:-1,r.baseAlpha=1,e.balls.push(r)}for(let t=8;t<o;t++){const t=Math.random()*n,o=Math.random()*a,i=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),s=c(),l=new J(t,o,i,s);l.vx=100*(Math.random()-.5),l.vy=100*(Math.random()-.5),l.charge=Math.random()>.5?1:-1,l.baseAlpha=1,e.balls.push(l)}}()):e===t.BUBBLES&&(n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,function(){const e=i();e.balls.length=0;const t=e.canvas;if(!t)return;const n=t.width,a=t.height,o=e.bubblesMaxCount||150;for(let e=0;e<8&&e<o;e++)Fe(Math.random()*n,.3*a+Math.random()*a*.6,d(e),!0);for(let e=8;e<o;e++)Fe(Math.random()*n,.3*a+Math.random()*a*.6,c(),!0)}()),console.log(`Mode ${e} initialized with ${n.balls.length} balls`)}function Ne(){const e=i();return e.currentMode===t.FLIES?Be:e.currentMode===t.PIT?ke:e.currentMode===t.WATER?te:e.currentMode===t.VORTEX?Ae:e.currentMode===t.PING_PONG?_e:e.currentMode===t.MAGNETIC?Le:e.currentMode===t.BUBBLES?De:null}var Ge=Object.freeze({__proto__:null,MODES:t,getForceApplicator:Ne,setMode:$e});function qe(){!function(){const e=i();for(const[t,n]of Object.entries(Ce))for(const t of n.controls){const a=t.id+"Val",o=document.getElementById(a);if("color"===t.type){const n=t.id+"Picker",a=document.getElementById(n);if(!a)continue;a.addEventListener("input",()=>{const n=a.value;t.stateKey&&(e[t.stateKey]=n),t.onChange&&t.onChange(e,n),o&&(o.textContent=n),Se()});continue}const i=t.id+"Slider",s=document.getElementById(i);s&&s.addEventListener("input",()=>{const a=t.parse(s.value);if(t.stateKey&&(e[t.stateKey]=a),t.onChange&&t.onChange(e,a),o){const n=t.stateKey?e[t.stateKey]:a;o.textContent=t.format(n)}if(t.cssVar&&xe){const e={};e[t.cssVar.replace("--","").replace(/-([a-z])/g,(e,t)=>t.toUpperCase())]=a,xe(e)}t.reinitMode&&e.currentMode===n.mode&&(n.mode.replace("-",""),import(`../modes/${n.mode}.js`).then(e=>{const t=Object.values(e).find(e=>"function"==typeof e&&e.name.toLowerCase().includes("initialize"));t&&t()}).catch(()=>{})),Se()})}}(),document.querySelectorAll(".mode-button").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.getAttribute("data-mode");console.log("Mode button clicked:",n),$e(n),We(n)})}),m();const e=document.getElementById("colorSelect");e&&e.addEventListener("change",()=>{u(e.value),Se()});const t=document.getElementById("themeAuto"),n=document.getElementById("themeLight"),a=document.getElementById("themeDark");[t,n,a].forEach(e=>{e&&e.addEventListener("click",()=>{[t,n,a].forEach(e=>e?.classList.remove("active")),e.classList.add("active")})})}function We(e){document.querySelectorAll(".mode-button").forEach(t=>{const n=t.getAttribute("data-mode")===e;t.classList.toggle("active",n)}),document.querySelectorAll(".mode-controls").forEach(e=>e.classList.remove("active"));const t=e+"Controls",n=document.getElementById(t);n&&n.classList.add("active");const a=document.getElementById("announcer");if(a){const t={pit:"Ball Pit",flies:"Flies to Light",weightless:"Zero-G",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles"};a.textContent=`Switched to ${t[e]||e} mode`}}var ze=Object.freeze({__proto__:null,setupControls:qe,updateModeButtonsUI:We});const Ve={core:{title:"Core",controls:[{id:"masterGain",label:"Master Volume",min:10,max:100,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"collisionMinImpact",label:"Silence Threshold",min:20,max:85,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e}]},envelope:{title:"Envelope",controls:[{id:"decayTime",label:"Click Length",min:20,max:180,step:1,format:e=>`${Math.round(e)}ms`,toConfig:e=>e/1e3,fromConfig:e=>1e3*e}]},tone:{title:"Tone",controls:[{id:"filterBaseFreq",label:"Brightness",min:300,max:6e3,step:50,format:e=>`${Math.round(e)}Hz`,toConfig:e=>e,fromConfig:e=>e},{id:"harmonicGain",label:"Warmth",min:0,max:50,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"filterQ",label:"Resonance",min:10,max:200,step:5,format:e=>`${(e/100).toFixed(2)}`,toConfig:e=>e/100,fromConfig:e=>100*e}]},crystal:{title:"Crystal",controls:[{id:"pitchMinHz",label:"Pitch Low",min:80,max:1200,step:10,format:e=>`${Math.round(e)}Hz`,toConfig:e=>e,fromConfig:e=>e},{id:"pitchMaxHz",label:"Pitch High",min:200,max:4e3,step:20,format:e=>`${Math.round(e)}Hz`,toConfig:e=>e,fromConfig:e=>e},{id:"pitchCurve",label:"Pitch Curve",min:70,max:160,step:1,format:e=>`${(e/100).toFixed(2)}√ó`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleGain",label:"Sparkle",min:0,max:35,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMin",label:"Sparkle Min",min:120,max:600,step:10,format:e=>`${(e/100).toFixed(2)}√ó`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMax",label:"Sparkle Max",min:160,max:800,step:10,format:e=>`${(e/100).toFixed(2)}√ó`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleDecayMul",label:"Sparkle Decay",min:20,max:95,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"noiseTransientQ",label:"Sparkle Q",min:60,max:600,step:5,format:e=>`${(e/100).toFixed(2)}`,toConfig:e=>e/100,fromConfig:e=>100*e}]},space:{title:"Space",controls:[{id:"reverbWetMix",label:"Reverb Mix",min:0,max:50,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"reverbDecay",label:"Room Size",min:5,max:80,step:1,format:e=>`${(e/100).toFixed(2)}s`,toConfig:e=>e/100,fromConfig:e=>100*e}]},dynamics:{title:"Dynamics",controls:[{id:"minGain",label:"Min Hit Volume",min:0,max:20,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"maxGain",label:"Max Hit Volume",min:5,max:50,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e}]},realism:{title:"Realism",controls:[{id:"noiseTransientGain",label:"Impact Snap",min:0,max:80,step:1,format:e=>`${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"varianceGain",label:"Volume Variance",min:0,max:50,step:1,format:e=>`¬±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"variancePitch",label:"Pitch Variance",min:0,max:25,step:1,format:e=>`¬±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"velocityNoiseScale",label:"Hard Hit Crack",min:100,max:500,step:10,format:e=>`${(e/100).toFixed(1)}√ó`,toConfig:e=>e/100,fromConfig:e=>100*e}]}};function He(e,t){const n=t();for(const t of Object.values(Ve))for(const a of t.controls){const t=e.querySelector(`#sound_${a.id}`),o=e.querySelector(`#sound_${a.id}_val`);if(!t||void 0===n[a.id])continue;const i=a.fromConfig(n[a.id]);t.value=i,o&&(o.textContent=a.format(i))}}let Ke=null,Xe=null,Ue=null;const Ye="panel_dock_position",je="panel_dock_hidden",Qe="master_panel_collapsed";function Ze(e){try{localStorage.setItem(je,String(e))}catch(e){}}let Je=!1,et=!1,tt=0,nt=0,at=0,ot=0;function it(e){if(e.target.closest("button")||e.target.closest("input")||e.target.closest("select"))return;const t=e.touches?e.touches[0].clientX:e.clientX,n=e.touches?e.touches[0].clientY:e.clientY,a=Xe.getBoundingClientRect();tt=t,nt=n,at=a.left,ot=a.top,Je=!1,et=!1}function st(e){if(0===tt&&0===nt)return;const t=e.touches?e.touches[0].clientX:e.clientX,n=e.touches?e.touches[0].clientY:e.clientY,a=t-tt,o=n-nt;if(!Je&&(Math.abs(a)>5||Math.abs(o)>5)&&(Je=!0,et=!0,Xe.classList.add("dragging"),Xe.style.position="fixed",Xe.style.top=`${ot}px`,Xe.style.left=`${at}px`,Xe.style.right="auto"),Je){let t=at+a,n=ot+o;const i=Xe.getBoundingClientRect();t=Math.max(0,Math.min(window.innerWidth-i.width,t)),n=Math.max(0,Math.min(window.innerHeight-i.height,n)),Xe.style.left=`${t}px`,Xe.style.top=`${n}px`,e.preventDefault()}}function lt(){Je&&(Je=!1,Xe.classList.remove("dragging"),function(){try{const e={left:Xe.style.left,top:Xe.style.top,custom:!0};localStorage.setItem(Ye,JSON.stringify(e))}catch(e){}}()),tt=0,nt=0,setTimeout(()=>{et=!1},10)}function rt(e){e.classList.toggle("collapsed"),function(e){try{localStorage.setItem(Qe,String(e))}catch(e){}}(e.classList.contains("collapsed"))}const ct="--abs-brand-logo-scale";let dt=null,ut=!1,mt=0,ht=0,pt=1,ft=1,gt=1,yt=null,bt=null,vt=0,Mt=null;function St(){mt=window.innerWidth||0,ht=window.innerHeight||0,pt=Math.max(1,.5*Math.min(mt,ht)),ft=Math.max(1,.25*mt),gt=Math.max(1,.25*ht)}function xt(){if(vt=0,!ut||!dt)return;if(null==yt||null==bt)return;const e=yt-.5*mt,t=bt-.5*ht,n=Math.hypot(e,t);let a=0;if(n>0){const n=Math.sqrt(e*e/(ft*ft)+t*t/(gt*gt));a=n>0?1/n:0}let o=0;var i;o=n<=a?0:n>=pt?1:(i=(n-a)/Math.max(1e-6,pt-a))<0?0:i>1?1:i;const s=.98+(1.02-.98)*o;null!=Mt&&Math.abs(s-Mt)<.001||(dt.style.setProperty(ct,s.toFixed(4)),Mt=s)}let wt=null,Et=!1,Ct=!1,It=0;function Pt(){Et||(wt=document.createElement("div"),wt.id="custom-cursor",wt.setAttribute("aria-hidden","true"),document.body.appendChild(wt),wt.style.display="none",Et=!0,Tt())}function Tt(){if(!wt)return;const e=i(),t=(e.R_MIN+e.R_MAX)/2*e.cursorSize;It=2*t,wt.style.width=`${It}px`,wt.style.height=`${It}px`,wt.style.borderRadius="50%",wt.style.marginLeft="0",wt.style.marginTop="0",Ct||(wt.style.transform="translate(-50%, -50%) scale(1)",wt.style.opacity="1")}function Rt(e,t){if(!wt)return;const n=Ct;Ct=function(e,t){const n=document.getElementById("bravia-balls");if(!n)return!1;const a=n.getBoundingClientRect();return e>=a.left&&e<=a.right&&t>=a.top&&t<=a.bottom}(e,t),wt.style.left=`${e}px`,wt.style.top=`${t}px`,document.body.style.cursor="none",Ct?(wt.style.display="block",n?wt.style.transform.includes("scale(0.25)")||(wt.style.transform="translate(-50%, -50%) scale(0.25)",wt.style.opacity="1"):(wt.style.transform="translate(-50%, -50%) scale(1)",wt.style.opacity="1",wt.offsetHeight,requestAnimationFrame(()=>{wt.style.transform="translate(-50%, -50%) scale(0.25)",wt.style.opacity="1"}))):(wt.style.display="none",n&&(wt.style.transform="translate(-50%, -50%) scale(1)",wt.style.opacity="1"))}function Bt(){wt&&(wt.style.display="none",document.body.style.cursor="none",Ct=!1)}function kt(){wt&&(Ct=!1)}var At=Object.freeze({__proto__:null,hideCursor:Bt,setupCustomCursor:Pt,showCursor:kt,updateCursorPosition:Rt,updateCursorSize:Tt});let _t=0,Lt=0,Ft=0,Ot=0,Dt=0,$t=!1;const Nt=[t.PIT,t.FLIES,t.WEIGHTLESS,t.WATER,t.VORTEX,t.PING_PONG,t.MAGNETIC,t.BUBBLES];function Gt(){const e=i().currentMode,t=Nt.indexOf(e),n=Nt[(t+1)%Nt.length]||Nt[0];Promise.resolve().then(function(){return Ge}).then(({setMode:e})=>{e(n)}),Promise.resolve().then(function(){return ze}).then(({updateModeButtonsUI:e})=>{e(n)})}let qt=0,Wt=0,zt=0,Vt=0;const Ht="--abs-brand-logo-retreat";let Kt=null,Xt=!1,Ut=0,Yt=null,jt=0,Qt=0,Zt=1;function Jt(){if(!Kt)return;const e=Kt.getBoundingClientRect();jt=e.left+.5*e.width,Qt=e.top+.5*e.height,Zt=Math.max(1,.6*Math.min(e.width,e.height))}let en=performance.now()/1e3,tn=0,nn=!0,an=null;const on=1e3/60;let sn=[],ln=0;function rn(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.offsetWidth,e.classList.add(`page-flash--${t}`),setTimeout(()=>{e.classList.remove(`page-flash--${t}`)},"success"===t?600:300)}function cn(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.offsetWidth,e.classList.add(`page-flash--${t}`),setTimeout(()=>{e.classList.remove(`page-flash--${t}`)},"success"===t?600:300)}let dn=null;async function un(){W().isUnlocked?mn(q()):await D()?mn(!0):(dn.textContent="Audio unavailable",setTimeout(()=>{dn.textContent="Sound off"},2e3))}function mn(e){dn&&(dn.setAttribute("data-enabled",e?"true":"false"),dn.setAttribute("aria-pressed",e?"true":"false"),dn.setAttribute("aria-label","Toggle collision sounds"),dn.textContent=e?"Sound On":"Sound Off")}function hn(e){const t=me();e.textContent="dark"===t?"‚òÄ":"‚òæ",e.title="dark"===t?"Switch to light mode":"Switch to dark mode"}function pn(){const e=i(),t=document.documentElement;t.style.setProperty("--container-border",`${e.containerBorder??20}px`),t.style.setProperty("--simulation-padding",`${e.simulationPadding||0}px`)}function fn(e){const t=document.documentElement;void 0!==e.wallThickness&&t.style.setProperty("--wall-thickness",`${e.wallThickness}px`),void 0!==e.wallRadius&&t.style.setProperty("--wall-radius",`${e.wallRadius}px`),void 0!==e.contentPadding&&t.style.setProperty("--content-padding",`${e.contentPadding}px`),void 0!==e.containerInnerShadowOpacity&&t.style.setProperty("--container-inner-shadow-opacity",String(e.containerInnerShadowOpacity)),void 0!==e.containerInnerShadowBlur&&t.style.setProperty("--container-inner-shadow-blur",`${e.containerInnerShadowBlur}px`),void 0!==e.containerInnerShadowSpread&&t.style.setProperty("--container-inner-shadow-spread",`${e.containerInnerShadowSpread}px`),void 0!==e.containerInnerShadowOffsetY&&t.style.setProperty("--container-inner-shadow-offset-y",`${e.containerInnerShadowOffsetY}px`),void 0!==e.noiseSizeBase&&t.style.setProperty("--noise-size-base",`${e.noiseSizeBase}px`),void 0!==e.noiseSizeTop&&t.style.setProperty("--noise-size-top",`${e.noiseSizeTop}px`),void 0!==e.noiseBackOpacity&&t.style.setProperty("--noise-back-opacity",String(e.noiseBackOpacity)),void 0!==e.noiseFrontOpacity&&t.style.setProperty("--noise-front-opacity",String(e.noiseFrontOpacity)),void 0!==e.noiseBackOpacityDark&&t.style.setProperty("--noise-back-opacity-dark",String(e.noiseBackOpacityDark)),void 0!==e.noiseFrontOpacityDark&&t.style.setProperty("--noise-front-opacity-dark",String(e.noiseFrontOpacityDark))}return async function(){document.documentElement.classList.add("js-enabled"),xe=fn;try{console.log("üöÄ Initializing modular bouncy balls...");const e=await async function(){try{const e=["config/default-config.json","js/config.json","../public/js/config.json"];for(const t of e)try{const e=await fetch(t,{cache:"no-cache"});if(e.ok)return await e.json()}catch(e){}throw new Error("No config found")}catch(e){return console.warn("Config load failed, using defaults"),{gravityMultiplier:1.05,ballMass:91,maxBalls:300}}}();!function(e){o.config={...e},e.ballMass&&(o.ballMassKg=e.ballMass),void 0!==e.gravityMultiplier&&(o.gravityMultiplier=e.gravityMultiplier,o.gravityMultiplierPit=e.gravityMultiplier),e.restitution&&(o.REST=e.restitution),e.friction&&(o.FRICTION=e.friction),e.ballScale&&(o.sizeScale=e.ballScale),void 0!==e.maxBalls&&(o.maxBalls=e.maxBalls),void 0!==e.repelRadius&&(o.repelRadius=e.repelRadius),void 0!==e.repelPower&&(o.repelPower=e.repelPower),void 0!==e.containerBorder&&(o.containerBorder=e.containerBorder),void 0!==e.simulationPadding&&(o.simulationPadding=e.simulationPadding),void 0!==e.contentPadding&&(o.contentPadding=e.contentPadding),void 0!==e.containerInnerShadowOpacity&&(o.containerInnerShadowOpacity=e.containerInnerShadowOpacity),void 0!==e.containerInnerShadowBlur&&(o.containerInnerShadowBlur=e.containerInnerShadowBlur),void 0!==e.containerInnerShadowSpread&&(o.containerInnerShadowSpread=e.containerInnerShadowSpread),void 0!==e.containerInnerShadowOffsetY&&(o.containerInnerShadowOffsetY=e.containerInnerShadowOffsetY),void 0!==e.frameColor&&(o.frameColor=e.frameColor),void 0!==e.wallThickness&&(o.wallThickness=e.wallThickness),void 0!==e.wallRadius&&(o.wallRadius=e.wallRadius),void 0!==e.ballSpacing&&(o.ballSpacing=e.ballSpacing),void 0!==e.wallWobbleMaxDeform&&(o.wallWobbleMaxDeform=e.wallWobbleMaxDeform),void 0!==e.wallWobbleStiffness&&(o.wallWobbleStiffness=e.wallWobbleStiffness),void 0!==e.wallWobbleDamping&&(o.wallWobbleDamping=e.wallWobbleDamping),void 0!==e.wallWobbleSigma&&(o.wallWobbleSigma=e.wallWobbleSigma),void 0!==e.wallWobbleCornerClamp&&(o.wallWobbleCornerClamp=e.wallWobbleCornerClamp);const t=(o.R_MIN_BASE+o.R_MAX_BASE)/2;o.R_MIN=t*o.sizeScale*.75,o.R_MAX=t*o.sizeScale*1.25}(e),console.log("‚úì Config loaded");try{const e=i();"undefined"!=typeof window&&(window.REST=e.REST,window.FRICTION=e.FRICTION,window.MAX_BALLS=e.maxBalls,window.repelRadius=e.repelRadius,window.repelPower=e.repelPower)}catch(e){}pn(),console.log("‚úì Frame padding applied"),fn(e),console.log("‚úì Visual effects configured"),function(){const e=document.querySelector(".noise");if(!e)return;const t=getComputedStyle(e),n=t.backgroundImage&&"none"!==t.backgroundImage?t.backgroundImage:null;if(!document.querySelector(".noise-2")){const e=document.createElement("div");e.className="noise-2",n&&(e.style.backgroundImage=n),e.style.position="fixed",e.style.inset="0",e.style.pointerEvents="none",e.style.backgroundRepeat="repeat",e.style.backgroundPosition="50%",e.style.backgroundAttachment="fixed",e.style.mixBlendMode="luminosity",document.body.appendChild(e),console.log("‚úì Created .noise-2 element")}if(!document.querySelector(".noise-3")){const e=document.createElement("div");e.className="noise-3",n&&(e.style.backgroundImage=n),e.style.position="fixed",e.style.inset="0",e.style.pointerEvents="none",e.style.backgroundRepeat="repeat",e.style.backgroundPosition="50%",e.style.backgroundAttachment="fixed",e.style.mixBlendMode="luminosity",document.body.appendChild(e),console.log("‚úì Created .noise-3 element")}}(),ge();const a=be(),s=ve(),l=document.getElementById("bravia-balls");if(!a||!s||!l)throw new Error("Missing DOM elements");!function(e,t,n){o.canvas=e,o.ctx=t,o.container=n}(a,s,l),ye(),console.log("‚úì Canvas initialized (container-relative sizing)"),i().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),function(){const e=i(),a=e.canvas;if($t=e.clickCycleEnabled||!1,!a)return void console.error("Canvas not available for pointer setup");const o=e.DPR;function s(e){return!(!e||!e.closest)&&Boolean(e.closest("#panelDock")||e.closest("#masterPanel")||e.closest("#dockToggle")||e.closest(".panel-dock")||e.closest(".panel"))}function l(e,t){const n=a.getBoundingClientRect();return{x:(e-n.left)*o,y:(t-n.top)*o,inBounds:e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom}}document.addEventListener("mousemove",n=>{var a,o;if(a=n.clientX,o=n.clientY,ut&&dt&&(yt=a,bt=o,vt||(vt=window.requestAnimationFrame(xt))),Rt(n.clientX,n.clientY),s(n.target))return;const i=l(n.clientX,n.clientY),r=performance.now(),c=r-Ft;if(c>0&&Ft>0){const e=i.x-_t,t=i.y-Lt;Ot=Math.sqrt(e*e+t*t)/c}if(e.mouseX=i.x,e.mouseY=i.y,e.mouseInCanvas=i.inBounds,"undefined"!=typeof window&&(window.mouseInCanvas=i.inBounds),e.currentMode===t.WATER&&i.inBounds&&Ot>.3&&r-qt>80){const e=Math.min(2*Ot,3);ne(i.x,i.y,e),qt=r}_t=i.x,Lt=i.y,Ft=r},{passive:!0}),document.addEventListener("click",e=>{s(e.target)||e.target.closest("a")||e.target.closest("button")||e.target.closest("input")||e.target.closest("select")||e.target.closest("textarea")||l(e.clientX,e.clientY).inBounds&&$t&&Gt()}),document.addEventListener("touchmove",n=>{if(n.touches&&n.touches[0]){const a=l(n.touches[0].clientX,n.touches[0].clientY);e.mouseX=a.x,e.mouseY=a.y,e.mouseInCanvas=a.inBounds;const o=performance.now();e.currentMode===t.WATER&&a.inBounds&&o-qt>80&&(ne(a.x,a.y,2),qt=o)}},{passive:!0}),document.addEventListener("touchstart",e=>{if(!s(e.target)&&!e.target.closest("a")&&!e.target.closest("button")&&!e.target.closest("input")&&!e.target.closest("select")&&!e.target.closest("textarea")&&e.touches&&e.touches[0]){if(!l(e.touches[0].clientX,e.touches[0].clientY).inBounds)return;const t=performance.now();t-Dt<300&&$t&&Gt(),Dt=t}},{passive:!0}),document.addEventListener("mouseleave",()=>{e.mouseX=n.OFFSCREEN_MOUSE,e.mouseY=n.OFFSCREEN_MOUSE,e.mouseInCanvas=!1,Ot=0,"undefined"!=typeof window&&(window.mouseInCanvas=!1),Bt()}),document.addEventListener("mouseenter",()=>{kt()}),document.addEventListener("touchend",()=>{e.mouseX=n.OFFSCREEN_MOUSE,e.mouseY=n.OFFSCREEN_MOUSE,e.mouseInCanvas=!1},{passive:!0}),console.log("‚úì Unified pointer system configured (document-level)")}(),console.log("‚úì Pointer tracking configured"),Pt(),console.log("‚úì Custom cursor initialized"),"undefined"!=typeof window&&"undefined"!=typeof document&&(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches||(dt=document.querySelector("#brand-logo .hero__text")||document.querySelector("#brand-logo")||null,dt&&(St(),ut=!0,dt.style.setProperty(ct,String(1)),window.addEventListener("resize",St,{passive:!0})))),"undefined"!=typeof window&&"undefined"!=typeof document&&(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches||(Kt=document.querySelector("#brand-logo .hero__text")||document.querySelector("#brand-logo")||null,Kt&&(Jt(),window.addEventListener("resize",Jt,{passive:!0}),Kt.style.setProperty(Ht,"0"),Xt=!0))),console.log("‚ö†Ô∏è localStorage is disabled - using defaults"),ue(),console.log("‚úì Dark mode initialized"),u(i().currentTemplate),console.log("‚úì Color system initialized"),function(){O();try{const e=document.getElementById("controlPanel");e&&e.remove();const t=document.getElementById("soundPanel");t&&t.remove()}catch(e){}Ke=document.createElement("div"),Ke.className="panel-dock",Ke.id="panelDock";const e=function(){try{return"true"===localStorage.getItem(je)}catch(e){return!1}}();e&&Ke.classList.add("hidden"),Xe=function(){const e=document.createElement("div");e.id="masterPanel",e.className=function(){try{return"true"===localStorage.getItem(Qe)}catch(e){return!1}}()?"panel collapsed":"panel",e.setAttribute("role","region"),e.setAttribute("aria-label","Settings");const t=document.createElement("div");t.className="panel-header",t.innerHTML='\n    <div class="panel-title">\n      <span class="drag-indicator" aria-hidden="true">‚ãÆ‚ãÆ</span>\n      <span>Settings</span>\n    </div>\n    <button class="collapse-btn" aria-label="Collapse panel">‚ñº</button>\n  ';const n=document.createElement("div");n.className="panel-content",n.innerHTML=function(){const e=e=>{const t=getComputedStyle(document.documentElement).getPropertyValue(e).trim();return parseInt(t)||0},t=e("--container-border")||20,n=e("--wall-radius")||42,a=e("--content-padding")||40;return`\n    \x3c!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n         LAYOUT SECTION - Frame & Content Spacing\n         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê --\x3e\n    <details class="panel-section-accordion" id="layoutSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">üìê</span>\n        <span class="section-label">Layout</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Frame</span>\n            <span class="control-value" id="frameValue">${t}px</span>\n          </div>\n          <input type="range" id="layoutFrame" min="0" max="100" value="${t}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Content Padding</span>\n            <span class="control-value" id="contentPadValue">${a}px</span>\n          </div>\n          <input type="range" id="contentPadding" min="0" max="80" value="${a}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Radius</span>\n            <span class="control-value" id="radiusValue">${n}px</span>\n          </div>\n          <input type="range" id="layoutRadius" min="0" max="100" value="${n}" />\n        </label>\n      </div>\n    </details>\n\n    \x3c!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n         SOUND SECTION\n         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê --\x3e\n    <details class="panel-section-accordion" id="soundSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">üîä</span>\n        <span class="section-label">Sound</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="sound-enable-row">\n          <button id="soundEnableBtn" class="sound-enable-btn">üîá Enable Sound</button>\n        </div>\n        <div id="soundControlsWrapper" class="sound-controls" style="display: none;">\n          <label class="control-row">\n            <span class="control-label">Preset</span>\n            <select id="soundPresetSelect" class="control-select"></select>\n          </label>\n          <p id="presetDescription" class="control-hint"></p>\n          ${function(){let e="";for(const[t,n]of Object.entries(Ve)){e+='<div class="sound-dock__section">',e+=`<div class="sound-dock__section-title">${n.title}</div>`,e+='<div class="sound-dock__group">';for(const t of n.controls)e+=`\n        <label class="sound-dock__row">\n          <span class="sound-dock__label">${t.label}</span>\n          <input type="range" \n            id="sound_${t.id}" \n            class="sound-dock__slider" \n            min="${t.min}" \n            max="${t.max}" \n            step="${t.step}">\n          <span class="sound-dock__val" id="sound_${t.id}_val">${t.format(t.fromConfig(0))}</span>\n        </label>`;e+="</div></div>"}return e}()}\n        </div>\n      </div>\n    </details>\n\n    \x3c!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n         CONTROLS SECTION - Theme & Mode\n         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê --\x3e\n    <details class="panel-section-accordion" id="controlsSection" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">‚öôÔ∏è</span>\n        <span class="section-label">Controls</span>\n      </summary>\n      <div class="panel-section-content">\n        ${Te}\n      </div>\n    </details>\n  `}(),e.appendChild(t),e.appendChild(n);const a=t.querySelector(".collapse-btn");return a&&a.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),rt(e)}),t.addEventListener("click",t=>{et||t.target.closest("button")||rt(e)}),setTimeout(()=>{ue(),qe(),function(){const e=document.getElementById("saveConfigBtn");e&&e.addEventListener("click",()=>{const e=i(),t={gravityMultiplier:e.gravityMultiplierPit,ballMass:e.ballMassKg,ballSpacing:e.ballSpacing,sizeScale:e.sizeScale,sizeVariation:e.sizeVariation,restitution:e.REST,friction:e.FRICTION,repelRadius:e.repelRadius,repelPower:e.repelPower,repelSoftness:e.repelSoft,frameColor:e.frameColor,containerBorder:e.containerBorder,simulationPadding:e.simulationPadding,contentPadding:e.contentPadding,containerInnerShadowOpacity:e.containerInnerShadowOpacity,containerInnerShadowBlur:e.containerInnerShadowBlur,containerInnerShadowSpread:e.containerInnerShadowSpread,containerInnerShadowOffsetY:e.containerInnerShadowOffsetY,wallThickness:e.wallThickness,wallRadius:e.wallRadius,wallWobbleMaxDeform:e.wallWobbleMaxDeform,wallWobbleStiffness:e.wallWobbleStiffness,wallWobbleDamping:e.wallWobbleDamping,wallWobbleSigma:e.wallWobbleSigma,wallWobbleCornerClamp:e.wallWobbleCornerClamp,cursorColorIndex:5,enableLOD:!1},n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(n),a.download="current-config.json",document.body.appendChild(a),a.click(),document.body.removeChild(a)})}(),function(e){const t=e.querySelector("#soundEnableBtn"),n=e.querySelector("#soundControlsWrapper"),a=e.querySelector("#soundPresetSelect"),o=e.querySelector("#presetDescription"),i=e.querySelector("#soundSection"),s=(e,{openIfEnabled:a=!1}={})=>{if(!t)return;const o=e||W(),s=!(!o.isUnlocked||!o.isEnabled),l=!!o.isUnlocked;t.textContent=l?s?"üîä Sound On":"üîá Sound Off":"üîá Enable Sound",t.classList.toggle("enabled",s),n&&(n.style.display=s?"":"none"),a&&s&&i&&!i.open&&(i.open=!0)};if(t&&t.addEventListener("click",async()=>{const e=W();if(e.isUnlocked){const t=q();s({...e,isEnabled:t})}else await D()&&s(null,{openIfEnabled:!0})}),a){for(const[e,t]of Object.entries(g)){const n=document.createElement("option");n.value=e,n.textContent=t.label,a.appendChild(n)}a.value=H(),o&&g[H()]&&(o.textContent=g[H()].description),a.addEventListener("change",()=>{!function(e){const t=g[e];if(!t)return!1;y=e;const{label:n,description:a,...o}=t;V(o)}(a.value),o&&g[a.value]&&(o.textContent=g[a.value].description),He(e,z)})}(function(e,t,n){for(const t of Object.values(Ve))for(const a of t.controls){const t=e.querySelector(`#sound_${a.id}`),o=e.querySelector(`#sound_${a.id}_val`);t&&t.addEventListener("input",()=>{const e=parseFloat(t.value),i=a.toConfig(e);o&&(o.textContent=a.format(e)),n({[a.id]:i})})}})(e,0,V),He(e,z),s(),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(T,e=>{s(e&&e.detail?e.detail:null)})}(e),function(e){const t=e.querySelector("#layoutFrame"),n=e.querySelector("#frameValue"),a=e.querySelector("#contentPadding"),o=e.querySelector("#contentPadValue"),s=e.querySelector("#layoutRadius"),l=e.querySelector("#radiusValue"),r=i();t&&n&&t.addEventListener("input",e=>{const t=parseInt(e.target.value,10);n.textContent=`${t}px`,document.documentElement.style.setProperty("--container-border",`${t}px`),document.documentElement.style.setProperty("--wall-thickness",`${t}px`),r.wallThickness=t,r.containerBorder=t,ye()}),a&&o&&a.addEventListener("input",e=>{const t=parseInt(e.target.value,10);o.textContent=`${t}px`,document.documentElement.style.setProperty("--content-padding",`${t}px`),r.contentPadding=t}),s&&l&&s.addEventListener("input",e=>{const t=parseInt(e.target.value,10);l.textContent=`${t}px`,document.documentElement.style.setProperty("--wall-radius",`${t}px`),r.wallRadius=t,r.cornerRadius=t})}(e)},0),e}(),Ke.appendChild(Xe),Ue=function(){const e=document.createElement("button");return e.className="dock-toggle",e.id="dockToggle",e.setAttribute("aria-label","Show settings"),e.innerHTML="‚öôÔ∏è",e.addEventListener("click",()=>{Ke.classList.remove("hidden"),e.style.opacity="0",e.style.pointerEvents="none",Ze(!1)}),e}(),document.body.insertBefore(Ke,document.body.firstChild),document.body.insertBefore(Ue,document.body.firstChild),e&&Ue&&(Ue.style.opacity="1",Ue.style.pointerEvents="auto"),function(){if(!Xe)return;const e=Xe.querySelector(".panel-header");e&&(e.addEventListener("mousedown",it),e.addEventListener("touchstart",it,{passive:!1}),document.addEventListener("mousemove",st),document.addEventListener("mouseup",lt),document.addEventListener("touchmove",st,{passive:!1}),document.addEventListener("touchend",lt),function(){try{const e=JSON.parse(localStorage.getItem(Ye)||"{}");e.custom&&(Xe.style.position="fixed",Xe.style.left=e.left,Xe.style.top=e.top,Xe.style.right="auto")}catch(e){}}())}(),console.log("‚úì Panel dock created")}(),m(),console.log("‚úì Panel dock created (Sound + Controls)"),window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName))return;const n=e.key.toLowerCase();if("/"===n||"Slash"===e.code)return e.preventDefault(),void function(){if(!Ke)return;const e=Ke.classList.toggle("hidden");Ze(e),Ue&&(Ue.style.opacity=e?"1":"0",Ue.style.pointerEvents=e?"auto":"none")}();"1"===n?(e.preventDefault(),$e(t.PIT),We("pit")):"2"===n?(e.preventDefault(),$e(t.FLIES),We("flies")):"3"===n?(e.preventDefault(),$e(t.WEIGHTLESS),We("weightless")):"4"===n?(e.preventDefault(),$e(t.WATER),We("water")):"5"===n?(e.preventDefault(),$e(t.VORTEX),We("vortex")):"6"===n?(e.preventDefault(),$e(t.PING_PONG),We("ping-pong")):"7"===n?(e.preventDefault(),$e(t.MAGNETIC),We("magnetic")):"8"===n&&(e.preventDefault(),$e(t.BUBBLES),We("bubbles"))}),console.log("‚úì Keyboard shortcuts registered"),console.log("‚úì Keyboard shortcuts registered"),function(){const e=document.getElementById("cv-gate-trigger"),t=document.getElementById("brand-logo"),n=document.getElementById("cv-gate"),a=document.getElementById("portfolio-gate"),o=Array.from(document.querySelectorAll(".cv-digit")),i=document.getElementById("page-flash"),s=document.getElementById("cv-gate-label");if(!e||!t||!n||0===o.length)return void console.warn("CV Gate: Missing required elements");s&&(s.innerHTML='\n            <h2 class="gate-title">Download Bio/CV</h2>\n            <p class="gate-description">Because spam bots don\'t deserve nice things‚Äîand neither do recruiters who don\'t read portfolios. This keeps my inbox slightly more civilized.</p>\n        ');const l=i||function(){const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e}();let r=!1;const c=()=>{r=!1,o.forEach(e=>e.value=""),n.classList.remove("active"),t.classList.remove("fade-out-up"),setTimeout(()=>{r||n.classList.add("hidden")},400)},d=()=>{const e=o.map(e=>e.value).join("");4===e.length&&("1111"===e?(rn(l,"success"),setTimeout(()=>{window.location.href="cv.html"},500)):(rn(l,"error"),setTimeout(()=>{o.forEach(e=>e.value=""),o[0].focus()},350)))};e.addEventListener("click",e=>{e.preventDefault(),a&&a.classList.contains("active")&&(a.classList.remove("active"),setTimeout(()=>{a.classList.add("hidden")},400)),r=!0,t.classList.add("fade-out-up"),n.classList.remove("hidden"),n.offsetWidth,n.classList.add("active"),o[0].focus()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&r&&c()}),o.forEach((e,t)=>{e.addEventListener("keydown",n=>{"Backspace"===n.key&&""===e.value&&(t>0?o[t-1].focus():c())}),e.addEventListener("input",e=>{const n=e.target.value;if(/^\d*$/.test(n)){if(1===n.length)t<o.length-1?o[t+1].focus():d();else if(n.length>1){const a=n.split("");e.target.value=a[0];let i=t+1;for(let e=1;e<a.length&&i<o.length;e++)o[i].value=a[e],i++;i<o.length?o[i].focus():d()}}else e.target.value=n.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})}(),console.log("‚úì CV password gate initialized"),function(){const e=document.getElementById("portfolio-gate-trigger"),t=document.getElementById("brand-logo"),n=document.getElementById("portfolio-gate"),a=document.getElementById("cv-gate"),o=Array.from(document.querySelectorAll(".portfolio-digit")),i=document.getElementById("page-flash"),s=document.getElementById("portfolio-gate-label");if(!e||!t||!n||0===o.length)return void console.warn("Portfolio Gate: Missing required elements");s&&(s.innerHTML='\n            <h2 class="gate-title">View Portfolio</h2>\n            <p class="gate-description">Good work deserves good context. This small step ensures you\'re here with intention, not just browsing. Quality takes time‚Äîyours and mine.</p>\n        ');const l=i||function(){const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e}();let r=!1;const c=()=>{r=!1,o.forEach(e=>e.value=""),n.classList.remove("active"),t.classList.remove("fade-out-up"),setTimeout(()=>{r||n.classList.add("hidden")},400)},d=()=>{const e=o.map(e=>e.value).join("");4===e.length&&("1234"===e?(cn(l,"success"),setTimeout(()=>{window.location.href="portfolio.html"},500)):(cn(l,"error"),setTimeout(()=>{o.forEach(e=>e.value=""),o[0].focus()},350)))};e.addEventListener("click",e=>{e.preventDefault(),a&&a.classList.contains("active")&&(a.classList.remove("active"),setTimeout(()=>{a.classList.add("hidden")},400)),r=!0,t.classList.add("fade-out-up"),n.classList.remove("hidden"),n.offsetWidth,n.classList.add("active"),o[0].focus()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&r&&c()}),o.forEach((e,t)=>{e.addEventListener("keydown",n=>{"Backspace"===n.key&&""===e.value&&(t>0?o[t-1].focus():c())}),e.addEventListener("input",e=>{const n=e.target.value;if(/^\d*$/.test(n)){if(1===n.length)t<o.length-1?o[t+1].focus():d();else if(n.length>1){const a=n.split("");e.target.value=a[0];let i=t+1;for(let e=1;e<a.length&&i<o.length;e++)o[i].value=a[e],i++;i<o.length?o[i].focus():d()}}else e.target.value=n.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})}(),console.log("‚úì Portfolio password gate initialized"),function(){if(O(),"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return console.log("‚è∏ Sound toggle hidden (prefers-reduced-motion)"),null;dn=document.createElement("button"),dn.className="sound-toggle",dn.id="sound-toggle",dn.type="button",dn.setAttribute("aria-label","Toggle collision sounds"),dn.setAttribute("aria-pressed","false"),dn.setAttribute("data-enabled","false"),dn.textContent="Sound Off",dn.addEventListener("click",un);const e=document.getElementById("fade-content"),t=document.getElementById("social-links");if(!t||e&&!e.contains(t))e?e.appendChild(dn):document.body.appendChild(dn);else{const e=document.createElement("li");e.className="margin-bottom_none sound-toggle-item",dn.classList.add("sound-toggle--social"),e.appendChild(dn),t.appendChild(e)}console.log("‚úì Sound toggle created");try{const e=W();mn(!(!e.isUnlocked||!e.isEnabled))}catch(e){}"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(T,e=>{const t=e&&e.detail?e.detail:null;t&&mn(!(!t.isUnlocked||!t.isEnabled))})}(),console.log("‚úì Sound toggle button created"),function(){if(document.getElementById("theme-toggle-btn"))return;const e=document.createElement("button");e.id="theme-toggle-btn",e.className="theme-toggle",e.setAttribute("aria-label","Toggle dark mode"),e.setAttribute("type","button"),hn(e),e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();const n="dark"===me()?"light":"dark";de(n),hn(e);const a=document.getElementById("announcer");a&&(a.textContent=`Theme switched to ${n} mode`)}),document.body.appendChild(e)}(),console.log("‚úì Theme toggle button created"),$e(t.PIT),console.log("‚úì Mode initialized");const r=()=>Ne();(function(e){function a(o){if(!nn)return void(an=null);const s=o-tn;if(s<on)return void(an=requestAnimationFrame(a));tn=o-s%on,function(e){if(sn.push(e),sn.length>30&&sn.shift(),30===sn.length){const e=1e3/(sn.reduce((e,t)=>e+t,0)/30);e<30&&ln<2?(ln++,console.log(`‚ö° Adaptive throttle increased to level ${ln} (avg FPS: ${e.toFixed(1)})`)):e>55&&ln>0&&(ln--,console.log(`‚ö° Adaptive throttle decreased to level ${ln} (avg FPS: ${e.toFixed(1)})`))}}(s);const l=o/1e3;let r=Math.min(.033,l-en);en=l,(ln<2||Math.random()>.5)&&async function(e,a){const o=i(),s=o.balls,l=o.canvas;if(!l||0===s.length)return;oe+=e;let r=0;for(;oe>=ae&&r<n.MAX_PHYSICS_STEPS;){const e=s.length;for(let t=0;t<e;t++)s[t].step(ae,a);o.currentMode!==t.FLIES&&X(10);const n=o.currentMode===t.WEIGHTLESS?o.weightlessBounce:o.REST,i=s.length;for(let e=0;e<i;e++)se(s[e],l),s[e].walls(l.width,l.height,ae,n);oe-=ae,r++}o.currentMode===t.WATER&&function(e){const t=i().waterRippleSpeed||300;for(let n=ee.length-1;n>=0;n--){const a=ee[n];a.radius+=t*e,a.age+=e,a.strength*=.96,(a.age>3||a.strength<10)&&ee.splice(n,1)}}(e),j.step(e),oe>ae*n.ACCUMULATOR_RESET_THRESHOLD&&(oe=0)}(r,e),function(){const e=i(),t=e.ctx,n=e.balls,a=e.canvas;if(t&&a){t.clearRect(0,0,a.width,a.height),e.currentMode;for(let e=0;e<n.length;e++)n[e].draw(t);!function(e,t,n){const a=i(),o=function(){try{return getComputedStyle(document.documentElement).getPropertyValue("--wall-color").trim()||"#0a0a0a"}catch{return"#0a0a0a"}}(),s=(a.wallThickness||12)*(a.DPR||1);if(e.save(),e.fillStyle=o,j.bottom.hasDeformation()){e.beginPath(),e.moveTo(0,n+s);for(let a=0;a<=U;a++){const o=a/U,i=o*t,s=j.bottom.getDeformAt(o);e.lineTo(i,n-s)}e.lineTo(t,n+s),e.closePath(),e.fill()}if(j.top.hasDeformation()){e.beginPath(),e.moveTo(0,-s);for(let n=0;n<=U;n++){const a=n/U,o=a*t,i=j.top.getDeformAt(a);e.lineTo(o,i)}e.lineTo(t,-s),e.closePath(),e.fill()}if(j.left.hasDeformation()){e.beginPath(),e.moveTo(-s,0);for(let t=0;t<=U;t++){const a=t/U,o=a*n,i=j.left.getDeformAt(a);e.lineTo(i,o)}e.lineTo(-s,n),e.closePath(),e.fill()}if(j.right.hasDeformation()){e.beginPath(),e.moveTo(t+s,0);for(let a=0;a<=U;a++){const o=a/U,i=o*n,s=j.right.getDeformAt(o);e.lineTo(t-s,i)}e.lineTo(t+s,n),e.closePath(),e.fill()}e.restore()}(t,a.width,a.height)}}(),ln<2&&function(e){if(!Xt||!Kt)return;if(e-Ut<90)return;Ut=e;const t=i(),n=t.balls||[],a=t.canvas;if(!a||0===n.length)return void(0!==Yt&&(Kt.style.setProperty(Ht,"0"),Yt=0));const o=a.getBoundingClientRect(),s=t.DPR||1,l=(jt-o.left)*s,r=(Qt-o.top)*s,c=Math.max(1,.5*Math.min(window.innerWidth,window.innerHeight)*s),d=(Zt+18)*s;let u=1/0;for(let e=0;e<n.length;e++){const t=n[e],a=t.x-l,o=t.y-r,i=Math.hypot(a,o),s=Math.max(0,i-(t.r||0));if(s<u&&(u=s),u<=d)break}let m=0;var h;m=u<=d?1:u>=c?0:1-((h=(u-d)/Math.max(1e-6,c-d))<0?0:h>1?1:h);const p=Number(m.toFixed(3));null!=Yt&&Math.abs(p-Yt)<.001||(Kt.style.setProperty(Ht,String(p)),Yt=p)}(o),function(e){if(zt++,e-Wt>1e3){Vt=zt,zt=0,Wt=e;const t=document.getElementById("render-fps");t&&(t.textContent=String(Vt))}}(performance.now()),an=requestAnimationFrame(a)}document.addEventListener("visibilitychange",()=>{nn=!document.hidden,nn?(en=performance.now()/1e3,tn=performance.now(),console.log("‚ñ∂Ô∏è Animation resumed"),an||(an=requestAnimationFrame(a))):(console.log("‚è∏Ô∏è Animation paused (tab hidden)"),an&&(cancelAnimationFrame(an),an=null))}),an=requestAnimationFrame(a),console.log("‚úì Render loop started (60fps throttle, visibility-aware)")})((e,t)=>{const n=r();n&&n(e,t)}),console.log("‚úÖ Bouncy Balls running (modular)");const c=400,d=3e3,h="cubic-bezier(0.16, 1, 0.3, 1)",p=c+d+750,f=(e,t)=>{e.style.opacity="1",console.warn(`‚ö†Ô∏è Fade failsafe: forcing #fade-content visible (${t})`)};setTimeout(()=>{const e=document.getElementById("fade-content");if(!e)return void console.warn("‚ö†Ô∏è #fade-content not found (fade skipped)");if(window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches)return e.style.opacity="1",void console.log("‚úì Page fade-in skipped (prefers-reduced-motion)");if("function"!=typeof e.animate)return void f(e,"WAAPI unsupported");const t=e.animate([{opacity:0},{opacity:1}],{duration:d,easing:h,fill:"forwards"});t.addEventListener?.("finish",()=>{e.style.opacity="1",console.log("‚úì Page fade-in finished")}),t.addEventListener?.("cancel",()=>{f(e,"animation canceled")}),console.log("‚úì Page fade-in started (WAAPI)"),setTimeout(()=>{"0"===window.getComputedStyle(e).opacity&&f(e,"opacity still 0 after failsafe window")},p)},c)}catch(e){console.error("‚ùå Initialization failed:",e),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${e.message}\n${e.stack}</pre>\n    </div>`}}(),e.applyFramePaddingCSSVars=pn,e.applyVisualCSSVars=fn,e}({});
