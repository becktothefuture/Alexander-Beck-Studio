var e=function(e){"use strict";const t={PIT:"pit",FLIES:"flies",WEIGHTLESS:"weightless",WATER:"water",VORTEX:"vortex",PING_PONG:"ping-pong",MAGNETIC:"magnetic",BUBBLES:"bubbles"},n={DPR:Math.max(1,Math.min(2,window.devicePixelRatio||1)),OFFSCREEN_MOUSE:-1e9,MIN_DISTANCE_EPSILON:1e-6,ACCUMULATOR_RESET_THRESHOLD:3,MAX_PHYSICS_STEPS:2,SPIN_DAMP_PER_S:2,SPIN_GAIN:.25,SPIN_GAIN_TANGENT:.18,ROLL_FRICTION_PER_S:1.5,SQUASH_MAX_BASE:.2,SQUASH_DECAY_PER_S:18,WALL_REST_VEL_THRESHOLD:70,GROUND_COUPLING_PER_S:8,SLEEP_VELOCITY_THRESHOLD:5,SLEEP_ANGULAR_THRESHOLD:.05,TIME_TO_SLEEP:.5,PHYSICS_DT:1/120},a={config:{},currentMode:t.FLIES,balls:[],canvas:null,ctx:null,container:null,mouseX:n.OFFSCREEN_MOUSE,mouseY:n.OFFSCREEN_MOUSE,mouseInCanvas:!1,GE:1960,G:0,gravityScale:1,gravityMultiplier:0,gravityMultiplierPit:1.1,REST:.69,FRICTION:.006,ballMassKg:129,MASS_BASELINE_KG:129,MASS_REST_EXP:.15,MASS_GRAVITY_EXP:.35,DPR:Math.max(1,Math.min(2,window.devicePixelRatio||1)),sizeScale:1.2,sizeVariation:0,responsiveScale:1,R_MIN_BASE:6,R_MAX_BASE:24,R_MIN:6*1.2*.75,R_MAX:36,ballSoftness:20,cornerRadius:42,vortexSwirlStrength:420,vortexRadialPull:180,vortexBallCount:180,magneticBallCount:180,magneticStrength:65e3,magneticMaxVelocity:2800,magneticExplosionInterval:5,bubblesSpawnRate:8,bubblesRiseSpeed:150,bubblesWobble:40,bubblesMaxCount:150,bubblesDeflectRadius:80,pingPongBallCount:35,pingPongSpeed:800,pingPongCursorRadius:50,currentColors:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],currentTemplate:"industrialTeal",fliesBallCount:60,attractionPower:5e3,orbitRadius:180,swarmSpeed:.4,fliesSeparation:15e3,weightlessCount:80,weightlessInitialSpeed:250,weightlessBounce:.97,gridColumns:40,gridBallCount:120,pulseInterval:.8,waterBallCount:300,waterDrag:.015,waterRippleSpeed:300,waterRippleStrength:18e3,waterDriftStrength:40,waterInitialVelocity:200,repelRadius:120,repelPower:274e3,repelSoft:3.4,repellerEnabled:!1,emitterTimer:0,autoDarkModeEnabled:!0,isDarkMode:!1,containerBorder:0,simulationPadding:0,wallThickness:12,wallSoftness:20,wallRadius:42,wallBounceIntensity:0,wallBounceHighlightMax:.3,getSquashMax(){return 0===this.ballSoftness?0:n.SQUASH_MAX_BASE*(this.ballSoftness/40)},getCanvasCornerRadius(){return Math.max(0,this.cornerRadius-this.simulationPadding)}};function i(){return a}function l(){a.balls.length=0}const o={industrialTeal:{label:"Industrial Teal",light:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#6b726b","#3d453d","#8a928a","#00e6c3","#d5d5d5","#ff6b47","#5b9aff","#ffb84d"]},sunsetCoral:{label:"Sunset Coral",light:["#bdbbb8","#e8e6e3","#ffffff","#ff3b3b","#000000","#00f5d4","#1e40af","#fb923c"],dark:["#716f6b","#3f3d3a","#8e8c88","#ff6b6b","#d8d8d8","#00ffe7","#6ba3ff","#ffb570"]},violetPunch:{label:"Violet Punch",light:["#b8b7c2","#e6e5ed","#ffffff","#9333ea","#000000","#dc2626","#0ea5e9","#facc15"],dark:["#6d6c7a","#3a3845","#8b8a98","#c266ff","#dad6e8","#ff5c5c","#42d4ff","#fff066"]},citrusBlast:{label:"Citrus Blast",light:["#bfbdb5","#eae8df","#ffffff","#ea580c","#000000","#e11d48","#2563eb","#059669"],dark:["#74726a","#403e38","#918f87","#ff8c4d","#dbd9d1","#ff5c7a","#6ba3ff","#00d699"]},cobaltSpark:{label:"Cobalt Spark",light:["#b5b8be","#e3e6eb","#ffffff","#1d4ed8","#000000","#ea580c","#db2777","#d97706"],dark:["#696d75","#3a3e45","#878b93","#6b9dff","#d6dae2","#ff8c5c","#ff66b3","#ffc266"]}},s=[.5,.25,.12,.06,.03,.02,.01,.01];function r(){const e=i().currentColors;if(!e||0===e.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let n=0;for(let a=0;a<Math.min(e.length,s.length);a++)if(n+=s[a],t<=n)return e[a];return e[Math.min(e.length-1,7)]}function c(e){const t=i().currentColors;return t&&0!==t.length?t[Math.max(0,Math.min(7,Math.floor(e)))]||"#ffffff":(console.warn("No colors available, using fallback"),"#ffffff")}function d(e){const t=i();t.currentTemplate=e,t.currentColors=function(e){const t=i(),n=o[e];return n?t.isDarkMode?n.dark:n.light:o.industrialTeal.light}(e),t.cursorBallColor=t.currentColors[t.cursorBallIndex||4],function(){const e=i().balls;for(let t=0;t<e.length;t++)e[t].color=r()}(),function(e){try{const t=document.documentElement,n=(e&&e.length?e:[]).slice(0,8);for(let e=0;e<8;e++){const a=n[e]||"#ffffff";t.style.setProperty(`--ball-${e+1}`,a)}}catch(e){}}(t.currentColors),function(){const e=i().currentColors;for(let t=1;t<=8;t++){const n=document.getElementById(`color${t}`),a=document.getElementById(`color${t}Val`);n&&e[t-1]&&(n.value=e[t-1],a&&(a.textContent=e[t-1].toUpperCase()))}}()}function u(){const e=document.getElementById("colorSelect");if(!e)return;e.innerHTML="";for(const[t,n]of Object.entries(o)){const a=document.createElement("option");a.value=t,a.textContent=n.label,e.appendChild(a)}const t=i();e.value=t.currentTemplate}const m=[131,147,165,196,220,262,294,330,392,440,523];let p={attackTime:0,decayTime:.045,harmonicGain:.12,filterBaseFreq:2100,filterVelocityRange:320,filterQ:.45,reverbDecay:.18,reverbWetMix:.12,reverbHighDamp:.65,minGain:.03,maxGain:.18,masterGain:.42,minTimeBetweenSounds:.008,maxPan:.22,collisionMinImpact:.12,rollingEnabled:!0,rollingMaxVelocity:80,rollingMinVelocity:15,rollingGain:.02,rollingFreq:130,whooshEnabled:!1,whooshMinVelocity:500,whooshGain:0,whooshFreq:800};const h={materialWood:{label:"Material ‚Äî Wood",description:"Warm clacks ¬∑ dry room ¬∑ subtle surface friction",attackTime:0,decayTime:.045,harmonicGain:.12,filterBaseFreq:2100,filterVelocityRange:320,filterQ:.45,reverbDecay:.18,reverbWetMix:.12,masterGain:.42,minGain:.03,maxGain:.18,collisionMinImpact:.12,rollingEnabled:!0,rollingGain:.02,rollingFreq:130,rollingMinVelocity:14,rollingMaxVelocity:85,whooshEnabled:!1},materialStone:{label:"Material ‚Äî Stone",description:"Crisper taps ¬∑ slightly brighter ¬∑ more ‚Äútick‚Äù",attackTime:0,decayTime:.04,harmonicGain:.08,filterBaseFreq:2850,filterVelocityRange:520,filterQ:.55,reverbDecay:.18,reverbWetMix:.12,masterGain:.4,minGain:.03,maxGain:.2,collisionMinImpact:.14,rollingEnabled:!0,rollingGain:.012,rollingFreq:110,rollingMinVelocity:14,rollingMaxVelocity:85,whooshEnabled:!1},materialPlastic:{label:"Material ‚Äî Plastic",description:"Softer ‚Äútok‚Äù ¬∑ less bright ¬∑ slightly longer decay",attackTime:0,decayTime:.06,harmonicGain:.16,filterBaseFreq:1650,filterVelocityRange:260,filterQ:.35,reverbDecay:.18,reverbWetMix:.12,masterGain:.44,minGain:.03,maxGain:.19,collisionMinImpact:.1,rollingEnabled:!0,rollingGain:.024,rollingFreq:155,rollingMinVelocity:14,rollingMaxVelocity:85,whooshEnabled:!1},woodenDiscs:{label:"Wooden Discs",description:"Warm woody clacks ¬∑ subtle table friction ¬∑ no air whoosh",attackTime:0,decayTime:.045,harmonicGain:.12,filterBaseFreq:2100,filterVelocityRange:320,filterQ:.45,reverbDecay:.18,reverbWetMix:.12,masterGain:.42,minGain:.03,maxGain:.18,collisionMinImpact:.12,rollingEnabled:!0,rollingGain:.02,rollingFreq:130,rollingMinVelocity:14,rollingMaxVelocity:85,whooshEnabled:!1},softClick:{label:"Soft Click",description:"Instant, clicky, gently fading",attackTime:0,decayTime:.055,harmonicGain:.09,filterBaseFreq:2400,filterVelocityRange:380,filterQ:.4,reverbDecay:.28,reverbWetMix:.22,masterGain:.52,minGain:.05,maxGain:.28,collisionMinImpact:.13,rollingEnabled:!0,rollingGain:.018,rollingFreq:120,rollingMinVelocity:14,rollingMaxVelocity:85,whooshEnabled:!1},riverStones:{label:"River Stones",description:"Crisp, tactile taps",attackTime:0,decayTime:.05,harmonicGain:.18,filterBaseFreq:2800,filterVelocityRange:600,filterQ:.55,reverbDecay:.2,reverbWetMix:.15,masterGain:.48,minGain:.04,maxGain:.22,collisionMinImpact:.14,rollingEnabled:!0,rollingGain:.016,rollingFreq:110,rollingMinVelocity:14,rollingMaxVelocity:85,whooshEnabled:!1},rainDrops:{label:"Rain Drops",description:"Light, delicate plinks",attackTime:0,decayTime:.042,harmonicGain:.11,filterBaseFreq:3200,filterVelocityRange:450,filterQ:.45,reverbDecay:.35,reverbWetMix:.3,masterGain:.4,minGain:.03,maxGain:.18,collisionMinImpact:.12,rollingEnabled:!0,rollingGain:.014,rollingFreq:135,rollingMinVelocity:14,rollingMaxVelocity:85,whooshEnabled:!1},silkTouch:{label:"Silk Touch",description:"Ultra-smooth, barely there",attackTime:0,decayTime:.065,harmonicGain:.04,filterBaseFreq:1800,filterVelocityRange:250,filterQ:.3,reverbDecay:.4,reverbWetMix:.35,masterGain:.32,minGain:.02,maxGain:.14,collisionMinImpact:.16,rollingEnabled:!0,rollingGain:.012,rollingFreq:115,rollingMinVelocity:14,rollingMaxVelocity:85,whooshEnabled:!1},morningDew:{label:"Morning Dew",description:"Fresh, hopeful sparkle",attackTime:0,decayTime:.048,harmonicGain:.14,filterBaseFreq:3600,filterVelocityRange:550,filterQ:.5,reverbDecay:.32,reverbWetMix:.28,masterGain:.38,minGain:.03,maxGain:.19,collisionMinImpact:.12,rollingEnabled:!0,rollingGain:.014,rollingFreq:140,rollingMinVelocity:14,rollingMaxVelocity:85,whooshEnabled:!1},bamboo:{label:"Bamboo",description:"Hollow, zen garden taps",attackTime:0,decayTime:.08,harmonicGain:.2,filterBaseFreq:2200,filterVelocityRange:400,filterQ:.65,reverbDecay:.25,reverbWetMix:.2,masterGain:.45,minGain:.04,maxGain:.22,collisionMinImpact:.13,rollingEnabled:!0,rollingGain:.018,rollingFreq:105,rollingMinVelocity:14,rollingMaxVelocity:85,whooshEnabled:!1},whisper:{label:"Whisper",description:"Almost silent, intimate",attackTime:0,decayTime:.07,harmonicGain:.03,filterBaseFreq:1400,filterVelocityRange:180,filterQ:.25,reverbDecay:.5,reverbWetMix:.45,masterGain:.22,minGain:.015,maxGain:.11,collisionMinImpact:.17,rollingEnabled:!0,rollingGain:.01,rollingFreq:110,rollingMinVelocity:14,rollingMaxVelocity:85,whooshEnabled:!1},glitch:{label:"Glitch",description:"Digital artifacts, unstable",attackTime:0,decayTime:.025,harmonicGain:.55,filterBaseFreq:5500,filterVelocityRange:2500,filterQ:2.5,reverbDecay:.08,reverbWetMix:.05,masterGain:.35,minGain:.03,maxGain:.2,collisionMinImpact:.08,rollingEnabled:!0,rollingGain:.02,rollingFreq:160,rollingMinVelocity:14,rollingMaxVelocity:85,whooshEnabled:!1},theVoid:{label:"The Void",description:"Dark, hollow, unsettling",attackTime:.005,decayTime:.25,harmonicGain:.02,filterBaseFreq:350,filterVelocityRange:100,filterQ:.8,reverbDecay:.85,reverbWetMix:.7,masterGain:.55,minGain:.06,maxGain:.32,collisionMinImpact:.11,rollingEnabled:!0,rollingGain:.012,rollingFreq:80,rollingMinVelocity:14,rollingMaxVelocity:85,whooshEnabled:!1},midnight:{label:"Midnight",description:"Subtle, mysterious, elegant",attackTime:0,decayTime:.09,harmonicGain:.07,filterBaseFreq:1900,filterVelocityRange:280,filterQ:.35,reverbDecay:.55,reverbWetMix:.4,masterGain:.36,minGain:.03,maxGain:.18,collisionMinImpact:.15,rollingEnabled:!0,rollingGain:.012,rollingFreq:120,rollingMinVelocity:14,rollingMaxVelocity:85,whooshEnabled:!1}};let g="woodenDiscs",f=null,v=null,b=null,y=null,M=null,S=null,x=!1,w=!1,E=[],I=0,P=new Map,B=!1,R=null,C=null,T=null,_=null,k=null,V=null,A=0;function G(){if("undefined"!=typeof window&&window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion: reduce)");B=e.matches,e.addEventListener("change",e=>{B=e.matches})}console.log("‚úì Sound engine initialized (awaiting user unlock)")}async function F(){if(w)return!0;try{const e=window.AudioContext||window.webkitAudioContext;if(!e)return console.warn("Web Audio API not supported"),!1;f=new e({latencyHint:"interactive",sampleRate:44100}),"suspended"===f.state&&await f.resume(),v=f.createGain(),v.gain.value=p.masterGain,S=f.createDynamicsCompressor(),S.threshold.value=-3,S.knee.value=6,S.ratio.value=12,S.attack.value=.001,S.release.value=.1,y=f.createGain(),y.gain.value=1-p.reverbWetMix,M=f.createGain(),M.gain.value=p.reverbWetMix,b=function(){const e=f.createGain(),t=f.createGain(),n=[.029,.037,.053,.067].map(e=>{const t=f.createDelay(.1);return t.delayTime.value=e*p.reverbDecay,t}),a=n.map(()=>{const e=f.createGain();return e.gain.value=.4,e}),i=f.createBiquadFilter();return i.type="lowpass",i.frequency.value=2e3*(1-p.reverbHighDamp),i.Q.value=.5,n.forEach((t,l)=>{e.connect(t),t.connect(a[l]),a[l].connect(i),a[l].connect(n[(l+1)%n.length])}),i.connect(t),e.connect(t),e._output=t,e}(),y.connect(S),M.connect(b),b.connect(S),S.connect(v),v.connect(f.destination),function(){E=[];for(let e=0;e<8;e++){const t={id:e,inUse:!1,startTime:0,filter:f.createBiquadFilter(),envelope:f.createGain(),panner:f.createStereoPanner(),reverbSend:f.createGain(),osc:null,osc2:null,harmGain:null};t.filter.type="lowpass",t.filter.connect(t.envelope),t.envelope.connect(t.panner),t.panner.connect(y),t.panner.connect(t.reverbSend),t.reverbSend.connect(M),E.push(t)}}(),function(){if(p.rollingEnabled){R=f.createOscillator(),R.type="triangle",R.frequency.value=p.rollingFreq;const e=f.createGain();e.gain.value=.3;const t=L(),n=f.createGain();n.gain.value=.7,T=f.createBiquadFilter(),T.type="bandpass",T.frequency.value=350,T.Q.value=.8,C=f.createGain(),C.gain.value=0,R.connect(e),e.connect(T),t.connect(n),n.connect(T),T.connect(C),C.connect(y),R.start()}p.whooshEnabled&&(_=L(),V=f.createBiquadFilter(),V.type="bandpass",V.frequency.value=p.whooshFreq,V.Q.value=.8,k=f.createGain(),k.gain.value=0,_.connect(V),V.connect(k),k.connect(y))}(),w=!0,x=!0;const t=1e3*(f.baseLatency||0);return console.log(`‚úì Audio unlocked (${t.toFixed(1)}ms base latency)`),!0}catch(e){return console.error("Failed to unlock audio:",e),!1}}function L(){const e=2*f.sampleRate,t=f.createBuffer(1,e,f.sampleRate),n=t.getChannelData(0);for(let t=0;t<e;t++)n[t]=2*Math.random()-1;const a=f.createBufferSource();return a.buffer=t,a.loop=!0,a.start(),a}function D(e,t,n=.5,a=null){if(!x||!w||!f)return;if(B)return;if(t<p.collisionMinImpact)return;const i=f.currentTime;if(i-I<.005)return;if(null!==a){if(i-(P.get(a)||0)<p.minTimeBetweenSounds)return;P.set(a,i)}if(I=i,P.size>200){const e=i-.5;for(const[t,n]of P)n<e&&P.delete(t)}const l=function(){for(const e of E)if(!e.inUse)return e;let e=E[0];for(const t of E)t.startTime<e.startTime&&(e=t);return q(e),e}();l&&function(e,t,n,a,i){e.inUse=!0,e.startTime=i;const l=p.minGain+(p.maxGain-p.minGain)*n,o=p.filterBaseFreq+p.filterVelocityRange*n,s=p.decayTime+.015,r=1-.5*n,c=2*(a-.5)*p.maxPan;e.filter.frequency.value=o,e.filter.Q.value=p.filterQ,e.panner.pan.value=c,e.reverbSend.gain.value=r,e.envelope.gain.cancelScheduledValues(i),e.envelope.gain.setValueAtTime(l,i),e.envelope.gain.exponentialRampToValueAtTime(.001,i+p.decayTime);const d=f.createOscillator();d.type="sine",d.frequency.value=t;const u=f.createOscillator();u.type="sine",u.frequency.value=2*t;const m=f.createGain();m.gain.value=p.harmonicGain,e.osc=d,e.osc2=u,e.harmGain=m,d.connect(e.filter),u.connect(m),m.connect(e.filter),d.start(i),u.start(i),d.stop(i+s),u.stop(i+s),d.onended=()=>q(e)}(l,function(e){const t=(1-Math.max(0,Math.min(1,(e-8)/47)))*(m.length-1),n=1.5*(Math.random()-.5),a=Math.max(0,Math.min(m.length-1,Math.round(t+n))),i=1+.06*(Math.random()-.5);return m[a]*i}(e),Math.max(0,Math.min(1,t)),n,i)}function q(e){if(e.osc){try{e.osc.stop(),e.osc.disconnect()}catch(e){}e.osc=null}if(e.osc2){try{e.osc2.stop(),e.osc2.disconnect()}catch(e){}e.osc2=null}if(e.harmGain){try{e.harmGain.disconnect()}catch(e){}e.harmGain=null}e.inUse=!1}function N(){return!!w&&(x=!x,x)}function O(){return{isUnlocked:w,isEnabled:x,activeSounds:E.filter(e=>e.inUse).length,poolSize:8,rollingEnergy:A,whooshEnergy:0}}function z(e){for(const[t,n]of Object.entries(e))t in p&&(p[t]=n);M&&y&&"reverbWetMix"in e&&(M.gain.value=p.reverbWetMix,y.gain.value=1-p.reverbWetMix),v&&"masterGain"in e&&(v.gain.value=p.masterGain)}function W(){return g}const X=new Map;function $(e=10){const t=i(),a=t.balls,l=function(){const e=i(),t=e.balls,a=e.canvas,l=e.R_MAX,o=t.length;if(o<2)return[];const s=Math.max(1,2*l),r=Math.ceil(a.width/s)+1;X.clear();for(let e=0;e<o;e++){const n=t[e],a=n.x/s|0,i=(n.y/s|0)*r+a;let l=X.get(i);l||(l=[],X.set(i,l)),l.push(e)}const c=[];for(const[e,a]of X){const i=e/r|0,l=e%r;for(let e=-1;e<=1;e++)for(let o=-1;o<=1;o++){const s=(i+e)*r+(l+o),d=X.get(s);if(d)for(let e=0;e<a.length;e++){const i=a[e];for(let e=0;e<d.length;e++){const a=d[e];if(a<=i)continue;const l=t[i],o=t[a],s=o.x-l.x,r=o.y-l.y,u=l.r+o.r,m=s*s+r*r;if(m<u*u){const e=u-Math.sqrt(Math.max(m,n.MIN_DISTANCE_EPSILON));c.push({i:i,j:a,overlap:e})}}}}}return c.sort((e,t)=>t.overlap-e.overlap),c}(),o=t.REST,s=.5*t.DPR;for(let i=0;i<e;i++)for(let e=0;e<l.length;e++){const{i:r,j:c}=l[e],d=a[r],u=a[c];if(d.isSleeping&&u.isSleeping)continue;d.isSleeping&&d.wake(),u.isSleeping&&u.wake();const m=u.x-d.x,p=u.y-d.y,h=d.r+u.r,g=m*m+p*p;if(0===g||g>h*h)continue;const f=Math.sqrt(g),v=m/f,b=p/f,y=h-f,M=1/Math.max(d.m,.001),S=1/Math.max(u.m,.001),x=.8*Math.max(y-s,0)/(M+S),w=x*v,E=x*b;d.x-=w*M,d.y-=E*M,u.x+=w*S,u.y+=E*S;const I=u.vx-d.vx,P=u.vy-d.vy,B=I*v+P*b;if(B<0){const e=-(1+(Math.abs(B)<30?0:o))*B/(M+S),a=e*v,l=e*b;d.vx-=a*M,d.vy-=l*M,u.vx+=a*S,u.vy+=l*S;const s=I-B*v,c=P-B*b,m=Math.hypot(s,c);if(m>.001){const e=s*-b+c*v>=0?1:-1,t=n.SPIN_GAIN_TANGENT;d.omega-=e*t*m/Math.max(d.r,1),u.omega+=e*t*m/Math.max(u.r,1)}const p=Math.min(1,Math.abs(B)/(50*(d.r+u.r))),h=Math.min(t.getSquashMax(),.8*p);d.squashAmount=Math.max(d.squashAmount,.8*h),d.squashNormalAngle=Math.atan2(-b,-v),u.squashAmount=Math.max(u.squashAmount,.8*h),u.squashNormalAngle=Math.atan2(b,v),0===i&&D((d.r+u.r)/2,p,(d.x+u.x)/2/(t.canvas?.width||1),`${r}-${e}`)}}}const H=12;class U{constructor(){this.deformations=new Float32Array(H),this.velocities=new Float32Array(H)}impact(e,t){const n=11*Math.max(.1,Math.min(.9,e)),a=30*t;for(let e=1;e<11;e++){const t=Math.abs(e-n),i=Math.exp(-t*t/8),l=Math.min(e,11-e),o=Math.min(1,l/2);this.velocities[e]+=a*i*o}}step(e){this.deformations[0]=0,this.deformations[11]=0,this.velocities[0]=0,this.velocities[11]=0;for(let t=1;t<11;t++){const n=-400*this.deformations[t]-18*this.velocities[t];this.velocities[t]+=n*e,this.deformations[t]+=this.velocities[t]*e,this.deformations[t]=Math.max(0,Math.min(30,this.deformations[t])),Math.abs(this.deformations[t])<.05&&Math.abs(this.velocities[t])<.1&&(this.deformations[t]=0,this.velocities[t]=0)}}getDeformAt(e){const t=11*Math.max(0,Math.min(1,e)),n=Math.floor(t),a=Math.min(n+1,11),i=t-n,l=i*i*(3-2*i);return this.deformations[n]*(1-l)+this.deformations[a]*l}getMaxDeformation(){let e=0;for(let t=0;t<H;t++)this.deformations[t]>e&&(e=this.deformations[t]);return e}hasDeformation(){return this.getMaxDeformation()>.1}reset(){this.deformations.fill(0),this.velocities.fill(0)}}const Y={top:new U,bottom:new U,left:new U,right:new U,step(e){this.top.step(e),this.bottom.step(e),this.left.step(e),this.right.step(e)},reset(){this.top.reset(),this.bottom.reset(),this.left.reset(),this.right.reset()},hasAnyDeformation(){return this.top.hasDeformation()||this.bottom.hasDeformation()||this.left.hasDeformation()||this.right.hasDeformation()}};function j(e,t,n){e.startsWith("corner")||n<.05||("top"===e?Y.top.impact(t,n):"bottom"===e?Y.bottom.impact(t,n):"left"===e?Y.left.impact(t,n):"right"===e&&Y.right.impact(t,n))}let Q=0;class K{constructor(e,t,n,a){const l=i();this.x=e,this.y=t,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=n,this.rBase=n,this.m=l.ballMassKg,this.color=a,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1,this.isSleeping=!1,this.sleepTimer=0,this._soundId="ball-"+Q++}step(e,a){const l=i(),{currentMode:o,G:s,gravityScale:r,FRICTION:c,MASS_BASELINE_KG:d}=l;if(this.t+=e,this.age+=e,this.isSleeping&&o===t.PIT){const e=l.mouseX,t=l.mouseY,n=(l.repelRadius||710)*l.DPR*1.2,a=this.x-e,i=this.y-t;a*a+i*i<n*n&&this.wake()}if(this.isSleeping)return;o!==t.WEIGHTLESS&&(this.vy+=s*r*e);const u=Math.max(.25,this.m/d),m=o===t.WEIGHTLESS?1e-4:c,p=Math.max(0,1-m/u);this.vx*=p,this.vy*=p,0!==this.driftAx&&this.age<this.driftTime?this.vx+=this.driftAx*e/u:0!==this.driftAx&&(this.driftAx=0),a&&a(this,e),this.x+=this.vx*e,this.y+=this.vy*e;const h=Math.max(0,1-n.SPIN_DAMP_PER_S*e);this.omega*=h,this.theta+=this.omega*e;const g=Math.min(1,n.SQUASH_DECAY_PER_S*e);this.squashAmount+=(0-this.squashAmount)*g,this.squash=1-this.squashAmount,o===t.PIT&&this.updateSleepState(e,l)}updateSleepState(e,t){const a=Math.sqrt(this.vx*this.vx+this.vy*this.vy),i=Math.abs(this.omega),l=t.canvas;l&&this.y+this.r>=l.height-1&&a<n.SLEEP_VELOCITY_THRESHOLD&&i<n.SLEEP_ANGULAR_THRESHOLD?(this.sleepTimer+=e,this.sleepTimer>=n.TIME_TO_SLEEP&&(this.vx=0,this.vy=0,this.omega=0,this.isSleeping=!0)):this.sleepTimer=0}wake(){this.isSleeping=!1,this.sleepTimer=0}walls(e,a,l,o){const s=i(),{REST:r,MASS_BASELINE_KG:c,MASS_REST_EXP:d,currentMode:u,DPR:m}=s,p=void 0!==o?o:r,h=u===t.PIT?a/3:0,g=(s.getCanvasCornerRadius()||100)*(m||1);let f=!1;const v=[{cx:g,cy:h+g},{cx:e-g,cy:h+g},{cx:g,cy:a-g},{cx:e-g,cy:a-g}];for(let t=0;t<v.length;t++){const n=v[t],i=t%2==0?this.x<g:this.x>e-g,l=t<2?this.y<h+g:this.y>a-g;if(i&&l){const e=this.x-n.cx,t=this.y-n.cy,a=Math.sqrt(e*e+t*t),i=g-this.r;if(a>i&&i>0){f=!0;const n=a-i,l=e/a,o=t/a;this.x-=l*n,this.y-=o*n;const s=this.vx*l+this.vy*o;s>0&&(this.vx-=(1+p)*s*l,this.vy-=(1+p)*s*o)}}}const b=e-0,y=h+0,M=a-0;if(this.y+this.r>M){f=!0,this.y=M-this.r;const t=this.vy,a=this.vx-this.omega*this.r,i=Math.max(.25,this.m/c);this.omega+=a/this.r*n.SPIN_GAIN/i;const o=Math.max(0,1-n.ROLL_FRICTION_PER_S*l/i);this.vx*=o;const r=Math.abs(t)<n.WALL_REST_VEL_THRESHOLD?0:p;this.vy=-this.vy*(r*Math.pow(c/this.m,d));const u=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(s.getSquashMax(),.8*u),this.squashNormalAngle=-Math.PI/2;const m=this.vx/this.r;this.omega+=(m-this.omega)*Math.min(1,n.GROUND_COUPLING_PER_S*l),D(this.r,.7*u,this.x/e,this._soundId),j("bottom",this.x/e,u)}if(this.y-this.r<y){f=!0,this.y=y+this.r,this.vy=-this.vy*p;const t=Math.min(1,Math.abs(this.vy)/(90*this.r));this.squashAmount=Math.min(s.getSquashMax(),.8*t),this.squashNormalAngle=Math.PI/2,D(this.r,.6*t,this.x/e,this._soundId),j("top",this.x/e,t)}if(this.x+this.r>b){f=!0,this.x=b-this.r;const e=this.vx,t=this.vy-this.omega*this.r,i=Math.max(.25,this.m/c);this.omega+=t/this.r*(.5*n.SPIN_GAIN)/i,this.vx=-this.vx*(r*Math.pow(c/this.m,d));const l=Math.min(1,Math.abs(e)/(70*this.r));this.squashAmount=Math.min(s.getSquashMax(),.8*l),this.squashNormalAngle=Math.PI,D(this.r,.6*l,1,this._soundId),j("right",(this.y-h)/(a-h),l)}if(this.x-this.r<0){f=!0,this.x=0+this.r;const e=this.vx,t=this.vy-this.omega*this.r,i=Math.max(.25,this.m/c);this.omega+=t/this.r*(.5*n.SPIN_GAIN)/i,this.vx=-this.vx*(r*Math.pow(c/this.m,d));const l=Math.min(1,Math.abs(e)/(70*this.r));this.squashAmount=Math.min(s.getSquashMax(),.8*l),this.squashNormalAngle=0,D(this.r,.6*l,0,this._soundId),j("left",(this.y-h)/(a-h),l)}f&&this.isSleeping&&this.wake()}draw(e){if(e.save(),e.translate(this.x,this.y),e.rotate(this.theta),this.squashAmount>.001){const t=1-.3*this.squashAmount,n=1+.3*this.squashAmount;e.rotate(this.squashNormalAngle),e.scale(t,n),e.rotate(-this.squashNormalAngle)}e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI),e.fillStyle=this.color,e.globalAlpha=this.alpha,e.fill(),e.globalAlpha=1,e.restore()}}const Z=[];function J(){const e=i();l(),Z.length=0;const t=e.canvas;if(!t)return;const n=t.width,a=t.height,o=e.waterBallCount||100;for(let t=0;t<8&&t<o;t++){const i=Math.random()*n,l=Math.random()*a,o=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),s=c(t),r=new K(i,l,o,s),d=e.waterInitialVelocity||120;r.vx=(Math.random()-.5)*d,r.vy=(Math.random()-.5)*d,e.balls.push(r)}for(let t=8;t<o;t++){const t=Math.random()*n,i=Math.random()*a,l=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),o=r(),s=new K(t,i,l,o),c=e.waterInitialVelocity||120;s.vx=(Math.random()-.5)*c,s.vy=(Math.random()-.5)*c,e.balls.push(s)}}function ee(e,t){const n=i(),a=n.waterDrag||.015;e.vx*=1-a,e.vy*=1-a,e.omega*=1-.5*a;for(let n=0;n<Z.length;n++){const a=Z[n],i=e.x-a.x,l=e.y-a.y,o=Math.sqrt(i*i+l*l),s=40,r=a.radius-s,c=a.radius+s;if(o>r&&o<c){const n=Math.abs(o-a.radius),r=a.strength*(1-n/s);if(o>.1){const n=i/o,a=l/o;e.vx+=n*r*t,e.vy+=a*r*t}}}const l=n.waterDriftStrength||25;e.vx+=Math.sin(.5*e.t+.01*e.x)*l*t,e.vy+=Math.cos(.7*e.t+.01*e.y)*l*t}function te(e){const t=i().waterRippleSpeed||300;for(let n=Z.length-1;n>=0;n--){const a=Z[n];a.radius+=t*e,a.age+=e,a.strength*=.96,(a.age>3||a.strength<10)&&Z.splice(n,1)}}function ne(e,t,n=1){const a=(i().waterRippleStrength||15e3)*Math.min(n,5);Z.push({x:e,y:t,radius:0,strength:a,age:0})}var ae=Object.freeze({__proto__:null,applyWaterForces:ee,createWaterRipple:ne,initializeWater:J,updateWaterRipples:te});const ie=n.PHYSICS_DT;let le=0;const oe=42;function se(e,t){const n=[{x:oe,y:oe},{x:t.width-oe,y:oe},{x:oe,y:t.height-oe},{x:t.width-oe,y:t.height-oe}];for(let t=0;t<n.length;t++){const a=n[t].x,i=n[t].y,l=e.x-a,o=e.y-i,s=Math.max(1,Math.hypot(l,o));if(s<oe+e.r){const t=(oe+e.r-s)/(oe+e.r)*1800,n=l/s,a=o/s;e.vx+=n*t*ie,e.vy+=a*t*ie}}}let re,ce,de="light",ue="light";function me(e,t){return getComputedStyle(document.documentElement).getPropertyValue(e).trim()||t}function pe(e){de=e;let t=!1;t="auto"===e?"dark"===ue:"dark"===e,function(e){const t=i();t.isDarkMode=e,document.documentElement.style.colorScheme=e?"dark":"light",e?(t.container?.classList.add("dark-mode"),document.body.classList.add("dark-mode"),document.documentElement.classList.add("dark-mode")):(t.container?.classList.remove("dark-mode"),document.body.classList.remove("dark-mode"),document.documentElement.classList.remove("dark-mode")),function(e){const t=me("--chrome-bg-light","#0a0a0a"),n=me("--chrome-bg-dark","#0a0a0a"),a=e?n:t;let i=document.querySelector('meta[name="theme-color"]');i||(i=document.createElement("meta"),i.name="theme-color",document.head.appendChild(i)),i.content=a;let l=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: light)"]');l||(l=document.createElement("meta"),l.name="theme-color",l.media="(prefers-color-scheme: light)",document.head.appendChild(l)),l.content=t;let o=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: dark)"]');o||(o=document.createElement("meta"),o.name="theme-color",o.media="(prefers-color-scheme: dark)",document.head.appendChild(o)),o.content=n}(e),d(t.currentTemplate),function(){const e=document.getElementById("themeAuto"),t=document.getElementById("themeLight"),n=document.getElementById("themeDark");if(!e||!t||!n)return;[e,t,n].forEach(e=>e.classList.remove("active")),"auto"===de?e.classList.add("active"):"light"===de?t.classList.add("active"):n.classList.add("active");const a=document.getElementById("themeStatus");if(a){const e=i();a.textContent="auto"===de?e.isDarkMode?"üåô Auto (Dark)":"‚òÄÔ∏è Auto (Light)":"light"===de?"‚òÄÔ∏è Light Mode":"üåô Dark Mode"}}()}(t);try{localStorage.setItem("theme-preference",e)}catch(e){}console.log(`üé® Theme set to: ${e} (rendering: ${t?"dark":"light"})`)}function he(){ue=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",console.log(`üñ•Ô∏è System prefers: ${ue}`),pe("light");const e=document.getElementById("themeAuto"),t=document.getElementById("themeLight"),n=document.getElementById("themeDark");e&&e.addEventListener("click",()=>pe("auto")),t&&t.addEventListener("click",()=>pe("light")),n&&n.addEventListener("click",()=>pe("dark")),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{ue=e.matches?"dark":"light",console.log(`üñ•Ô∏è System preference changed to: ${ue}`),"auto"===de&&pe("auto")}),console.log("‚úì Modern dark mode initialized")}function ge(){re=document.getElementById("c"),ce=re?re.getContext("2d"):null,re&&ce?window.addEventListener("resize",fe):console.error("Canvas not found")}function fe(){if(!re)return;const e=i(),t=e.container||document.getElementById("bravia-balls"),a=t?t.clientWidth:window.innerWidth,l=t?t.clientHeight:window.innerHeight,o=e.wallThickness||0,s=a-2*o,r=l-2*o,c=n.DPR;re.width=Math.floor(s*c),re.height=Math.floor(r*c),re.style.width=s+"px",re.style.height=r+"px",function(e){const t=i();if(!t.canvasShadowEnabled)return void(e.style.filter="");const n=t.shadowOffsetX||1,a=t.shadowOffsetY||1,l=t.shadowBlur||0,o=t.shadowColor||"#000000",s=t.shadowOpacity||.29,r=t.shadow2Enabled?` drop-shadow(0 0 ${t.shadow2Blur||4}px rgba(0,0,0,${t.shadow2Opacity||.1}))`:"";e.style.filter=`drop-shadow(${n}px ${a}px ${l}px ${function(e,t){const n=e.replace("#",""),a=parseInt(n,16);return`rgba(${a>>16&255}, ${a>>8&255}, ${255&a}, ${t})`}(o,s)})${r}`}(re)}function ve(){return re}function be(){return ce}function ye(){console.log("‚ö†Ô∏è localStorage is disabled")}function Me(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(ye,500)}function Se(e,t,n){n||(n=r());const a=i(),l=(a.R_MIN+a.R_MAX)/2;let o;if(0===a.sizeVariation)o=l;else{const e=.1*l;c=l+e,o=(s=Math.max(1,l-e))+Math.random()*(c-s)}var s,c;const d=new K(e,t,o,n),u=e<.5*a.canvas.width?1:-1,m=(g=o/(.5*(a.R_MIN+a.R_MAX)),Math.max(.6,Math.min(1.4,g))),p=140*m,h=180*m;var g;return d.vx=u*(p+Math.random()*h),d.vy=120*-Math.random(),d.driftAx=u*(360+420*Math.random())*m,d.driftTime=.22+.28*Math.random(),a.balls.push(d),d}function xe(){const e=i();l();const t=.5*e.canvas.width,n=.5*e.canvas.height,a=150*e.DPR;for(let e=0;e<8;e++){const i=Math.random()*Math.PI*2,l=Math.random()*a,o=Se(t+Math.cos(i)*l,n+Math.sin(i)*l,c(e)),s=.5+.5*Math.random(),r=Math.random()*Math.PI*2,d=300*s;o.vx=Math.cos(r)*d,o.vy=Math.sin(r)*d,o.driftAx=0,o.driftTime=0}for(let e=8;e<60;e++){const e=Math.random()*Math.PI*2,i=Math.random()*a,l=Se(t+Math.cos(e)*i,n+Math.sin(e)*i),o=.5+.5*Math.random(),s=Math.random()*Math.PI*2,r=300*o;l.vx=Math.cos(s)*r,l.vy=Math.sin(s)*r,l.driftAx=0,l.driftTime=0}}function we(e,t){const n=i(),a=-1e9===n.mouseX?.5*n.canvas.width:n.mouseX,l=-1e9===n.mouseY?.5*n.canvas.height:n.mouseY,o=a-e.x,s=l-e.y,r=Math.sqrt(o*o+s*s+1),c=o/r,d=s/r;e.vx+=4e3*c*t,e.vy+=4e3*d*t;const u=120*n.DPR;let m=0,p=0,h=0;for(let t=0;t<n.balls.length;t++){const a=n.balls[t];if(a===e)continue;const i=e.x-a.x,l=e.y-a.y,o=i*i+l*l;if(o<u*u&&o>0){const e=Math.sqrt(o),t=1-e/u;m+=i/e*t,p+=l/e*t,h++}}if(h>0){const n=15e3;e.vx+=m/h*n*t,e.vy+=p/h*n*t}e.vx+=1e3*(Math.random()-.5)*t,e.vy+=1e3*(Math.random()-.5)*t}var Ee=Object.freeze({__proto__:null,applyFliesForces:we,initializeFlies:xe});function Ie(e,t){const n=i(),a=n.repelPower,l=n.repelRadius,o=n.mouseX,s=n.mouseY;if(!n.repellerEnabled||a<=0||l<=0)return;const r=l*n.DPR,c=e.x-o,d=e.y-s,u=c*c+d*d;if(u>r*r)return;const m=Math.max(Math.sqrt(u),1e-4),p=c/m,h=d/m,g=Math.max(0,1-m/r),f=20*a*Math.pow(g,n.repelSoft||3.4),v=Math.max(.25,e.m/n.MASS_BASELINE_KG);e.vx+=p*f*t/v,e.vy+=h*f*t/v}function Pe(){const e=i();l();const t=e.weightlessCount,n=e.canvas.width,a=e.canvas.height,o=40*e.DPR;for(let i=0;i<8&&i<t;i++){const t=Se(o+Math.random()*(n-2*o),o+Math.random()*(a-2*o),c(i)),l=Math.random()*Math.PI*2,s=e.weightlessInitialSpeed*(.7+.3*Math.random());t.vx=Math.cos(l)*s,t.vy=Math.sin(l)*s,t.driftAx=0,t.driftTime=0}for(let i=8;i<t;i++){const t=Se(o+Math.random()*(n-2*o),o+Math.random()*(a-2*o)),i=Math.random()*Math.PI*2,l=e.weightlessInitialSpeed*(.7+.3*Math.random());t.vx=Math.cos(i)*l,t.vy=Math.sin(i)*l,t.driftAx=0,t.driftTime=0}}var Be=Object.freeze({__proto__:null,initializeWeightless:Pe});function Re(){const e=i();l();const t=e.canvas;if(!t)return;const n=t.width,a=t.height,o=Math.min(e.vortexBallCount||180,e.maxBalls||300);for(let t=0;t<8&&t<o;t++){const i=Math.random()*n,l=Math.random()*a,o=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),s=c(t),r=new K(i,l,o,s);r.vx=80*(Math.random()-.5),r.vy=80*(Math.random()-.5),e.balls.push(r)}for(let t=8;t<o;t++){const t=Math.random()*n,i=Math.random()*a,l=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),o=r(),s=new K(t,i,l,o);s.vx=80*(Math.random()-.5),s.vy=80*(Math.random()-.5),e.balls.push(s)}}function Ce(e,n){const a=i();if(a.currentMode!==t.VORTEX)return;const l=a.mouseX,o=a.mouseY;if(!a.mouseInCanvas)return;const s=a.vortexSwirlStrength||420,r=a.vortexRadialPull||180,c=e.x-l,d=e.y-o,u=c*c+d*d,m=Math.max(8,Math.sqrt(u)),p=1/(1+.0015*m),h=c/m,g=d/m,f=-g,v=h,b=s*p;e.vx+=f*b*n,e.vy+=v*b*n;const y=r*p;e.vx-=h*y*n,e.vy-=g*y*n,e.vx*=.995,e.vy*=.995}var Te=Object.freeze({__proto__:null,applyVortexForces:Ce,initializeVortex:Re});function _e(){const e=i();l();const t=e.canvas;if(!t)return;const n=t.width,a=t.height,o=Math.min(e.pingPongBallCount||80,e.maxBalls||300),s=e.pingPongSpeed||400;for(let t=0;t<8&&t<o;t++){const i=Math.random()*n,l=.15*a+Math.random()*a*.7,o=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),r=c(t),d=new K(i,l,o,r),u=Math.random()>.5?1:-1;d.vx=u*(.8*s+Math.random()*s*.4),d.vy=0,d.isPingPong=!0,e.balls.push(d)}for(let t=8;t<o;t++){const t=Math.random()*n,i=.15*a+Math.random()*a*.7,l=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),o=r(),c=new K(t,i,l,o),d=Math.random()>.5?1:-1;c.vx=d*(.8*s+Math.random()*s*.4),c.vy=0,c.isPingPong=!0,e.balls.push(c)}}function ke(e,n){const a=i();if(a.currentMode!==t.PING_PONG)return;if(!e.isPingPong)return;if(a.mouseInCanvas){const t=(a.pingPongCursorRadius||100)*a.DPR,n=a.mouseX,i=a.mouseY,l=e.x-n,o=e.y-i,s=Math.sqrt(l*l+o*o),r=t+e.r;if(s<r&&s>.1){const t=r-s,n=l/s,a=o/s;e.x+=n*t*1.1,e.y+=a*t*1.1;const i=e.vx*n+e.vy*a;i<0&&(e.vx-=2*i*n,e.vy-=2*i*a,e.omega+=.02*i)}}const l=a.pingPongSpeed||400;if(Math.abs(e.vx)<.9*l){const t=e.vx>=0?1:-1;e.vx=t*l}e.vy*=.995}var Ve=Object.freeze({__proto__:null,applyPingPongForces:ke,initializePingPong:_e});function Ae(){const e=i();l();const t=e.canvas;if(!t)return;const n=t.width,a=t.height,o=Math.min(e.magneticBallCount||180,e.maxBalls||300);for(let t=0;t<8&&t<o;t++){const i=Math.random()*n,l=Math.random()*a,o=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),s=c(t),r=new K(i,l,o,s);r.vx=100*(Math.random()-.5),r.vy=100*(Math.random()-.5),r.charge=Math.random()>.5?1:-1,r.baseAlpha=1,e.balls.push(r)}for(let t=8;t<o;t++){const t=Math.random()*n,i=Math.random()*a,l=e.R_MIN+Math.random()*(e.R_MAX-e.R_MIN),o=r(),s=new K(t,i,l,o);s.vx=100*(Math.random()-.5),s.vy=100*(Math.random()-.5),s.charge=Math.random()>.5?1:-1,s.baseAlpha=1,e.balls.push(s)}}function Ge(e,n){const a=i();if(a.currentMode!==t.MAGNETIC)return;if(!a.mouseInCanvas)return;const l=a.mouseX,o=a.mouseY,s=l-e.x,r=o-e.y,c=Math.max(30,Math.sqrt(s*s+r*r)),d=(a.magneticStrength||65e3)/(c*c)*1e3,u=s/c,m=r/c,p=e.charge||1;e.vx+=u*d*p*n,e.vy+=m*d*p*n;const h=a.magneticMaxVelocity||2800,g=Math.sqrt(e.vx*e.vx+e.vy*e.vy);g>h&&(e.vx=e.vx/g*h,e.vy=e.vy/g*h),e.vx*=.998,e.vy*=.998}var Fe=Object.freeze({__proto__:null,applyMagneticForces:Ge,initializeMagnetic:Ae});function Le(e,t,n,a=!1){const l=i(),o=.5*l.R_MIN,s=.8*l.R_MAX,r=o+Math.random()*(s-o),c=new K(e,t,a?r:.1,n);return c.isBubble=!0,c.baseRadius=r,c.targetRadius=r,c.wobblePhase=Math.random()*Math.PI*2,c.wobbleFreq=2+3*Math.random(),c.vx=20*(Math.random()-.5),c.vy=-50-50*Math.random(),c.spawning=!a,c.spawnProgress=a?1:0,c.dissipating=!1,c.dissipateProgress=0,c.alpha=1,l.balls.push(c),c}function De(e){const t=i(),n=t.canvas;if(!n)return;const a=n.width,l=n.height;e.x=Math.random()*a,e.y=l+20+30*Math.random(),e.vx=20*(Math.random()-.5),e.vy=-50-50*Math.random(),e.wobblePhase=Math.random()*Math.PI*2,e.wobbleFreq=2+3*Math.random(),e.c=r();const o=.5*t.R_MIN,s=.8*t.R_MAX;e.targetRadius=o+Math.random()*(s-o),e.baseRadius=e.targetRadius,e.r=.1,e.spawning=!0,e.spawnProgress=0,e.dissipating=!1,e.dissipateProgress=0,e.alpha=1}function qe(e,n){const a=i();if(a.currentMode!==t.BUBBLES)return;if(!e.isBubble)return;const l=a.canvas;if(!l)return;if(e.spawning){e.spawnProgress+=3*n;const t=1-Math.pow(1-Math.min(1,e.spawnProgress),3);e.r=e.targetRadius*t,e.rBase=e.r,e.spawnProgress>=1&&(e.spawning=!1,e.r=e.targetRadius,e.rBase=e.targetRadius)}if(e.dissipating){e.dissipateProgress+=3*n;const t=Math.pow(e.dissipateProgress,2);return e.r=e.targetRadius*Math.max(0,1-t),e.rBase=e.r,e.alpha=Math.max(0,1-.5*t),e.vy*=.92,e.vx*=.92,void(e.dissipateProgress>=1&&De(e))}const o=a.bubblesRiseSpeed||150,s=.01*(a.bubblesWobble||40),r=o*a.DPR;e.vy-=r*n,e.wobblePhase+=e.wobbleFreq*n;const c=Math.sin(e.wobblePhase)*s*100;if(e.vx+=c*n,e.vx*=.92,e.vy*=.96,a.mouseInCanvas){const t=e.x-a.mouseX,i=e.y-a.mouseY,l=Math.sqrt(t*t+i*i),o=(a.bubblesDeflectRadius||80)*a.DPR;if(l<o&&l>1){const a=300*(1-l/o),s=t/l,r=i/l;e.vx+=s*a*n,e.vy+=r*a*n}}const d=2*e.targetRadius;e.y<d&&!e.dissipating&&!e.spawning&&(e.dissipating=!0,e.dissipateProgress=0),(e.x<4*-e.r||e.x>l.width+4*e.r)&&De(e)}function Ne(e){const n=i();if(function(e){a.currentMode=e}(e),console.log(`Switching to mode: ${e}`),function(e){const t=document.getElementById("announcer");t&&(t.textContent="",setTimeout(()=>{t.textContent=e},10))}(`Switched to ${{pit:"Ball Pit",flies:"Flies to Light",weightless:"Zero Gravity",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles"}[e]||e} mode`),n.container){const a=n.container.classList.contains("dark-mode");n.container.className="",e===t.PIT&&n.container.classList.add("mode-pit"),(a||n.isDarkMode)&&n.container.classList.add("dark-mode")}fe(),e===t.PIT?(n.gravityMultiplier=n.gravityMultiplierPit,n.G=n.GE*n.gravityMultiplier,n.repellerEnabled=!0,function(){const e=i();l();const t=e.canvas.width,n=e.canvas.height;e.DPR;const a=n/3*.7,o=t;for(let e=0;e<8;e++){const t=Se(0+Math.random()*(o-0),0+Math.random()*(a-0),c(e));t.vx=100*(Math.random()-.5),t.vy=50*Math.random(),t.driftAx=0,t.driftTime=0}for(let e=8;e<300;e++){const e=Se(0+Math.random()*(o-0),0+Math.random()*(a-0));e.vx=100*(Math.random()-.5),e.vy=50*Math.random(),e.driftAx=0,e.driftTime=0}}()):e===t.FLIES?(n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,xe()):e===t.WEIGHTLESS?(n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,Pe()):e===t.WATER?(n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,J()):e===t.VORTEX?(n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,Re()):e===t.PING_PONG?(n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,_e()):e===t.MAGNETIC?(n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,Ae()):e===t.BUBBLES&&(n.gravityMultiplier=0,n.G=0,n.repellerEnabled=!1,function(){const e=i();e.balls.length=0;const t=e.canvas;if(!t)return;const n=t.width,a=t.height,l=e.bubblesMaxCount||150;for(let e=0;e<8&&e<l;e++)Le(Math.random()*n,.3*a+Math.random()*a*.6,c(e),!0);for(let e=8;e<l;e++)Le(Math.random()*n,.3*a+Math.random()*a*.6,r(),!0)}()),console.log(`Mode ${e} initialized with ${n.balls.length} balls`)}function Oe(){const e=i();return e.currentMode===t.FLIES?we:e.currentMode===t.PIT?Ie:e.currentMode===t.WATER?ee:e.currentMode===t.VORTEX?Ce:e.currentMode===t.PING_PONG?ke:e.currentMode===t.MAGNETIC?Ge:e.currentMode===t.BUBBLES?qe:null}var ze=Object.freeze({__proto__:null,MODES:t,getForceApplicator:Oe,setMode:Ne});function We(e,t){const n=document.getElementById(e);n&&n.addEventListener("input",()=>t(n))}function Xe(e,t){const n=document.getElementById(e);n&&(n.textContent=t)}function $e(){const e=i();document.querySelectorAll(".mode-button").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.getAttribute("data-mode");console.log("Mode button clicked:",n),Ne(n),He(n)})}),We("sizeSliderGlobal",t=>{e.sizeScale=parseFloat(t.value),Xe("sizeValGlobal",e.sizeScale.toFixed(2));const n=(e.R_MIN_BASE+e.R_MAX_BASE)/2;e.R_MIN=n*e.sizeScale*.75,e.R_MAX=n*e.sizeScale*1.25;const a=(e.R_MIN+e.R_MAX)/2;for(let t=0;t<e.balls.length;t++)e.balls[t].r=a,e.balls[t].rBase=a;Me()}),We("ballSoftnessSliderGlobal",t=>{e.ballSoftness=parseInt(t.value,10),Xe("ballSoftnessValGlobal",String(e.ballSoftness)),Me()}),We("wallThicknessSlider",t=>{e.wallThickness=parseInt(t.value,10),Xe("wallThicknessVal",String(e.wallThickness)),Tt({wallThickness:e.wallThickness}),fe(),Me()}),We("wallSoftnessSlider",t=>{e.wallSoftness=parseInt(t.value,10),Xe("wallSoftnessVal",String(e.wallSoftness)),Tt({wallSoftness:e.wallSoftness}),Me()}),We("wallRadiusSlider",t=>{e.wallRadius=parseInt(t.value,10),e.cornerRadius=e.wallRadius,Xe("wallRadiusVal",String(e.wallRadius)),Tt({wallRadius:e.wallRadius}),Me()}),We("wallBounceHighlightSlider",t=>{e.wallBounceHighlightMax=parseFloat(t.value),Xe("wallBounceHighlightVal",e.wallBounceHighlightMax.toFixed(2)),Me()}),We("noiseSizeBaseSlider",e=>{const t={noiseSizeBase:parseInt(e.value,10)};Xe("noiseSizeBaseVal",String(t.noiseSizeBase)),Tt(t),Me()}),We("noiseSizeTopSlider",e=>{const t={noiseSizeTop:parseInt(e.value,10)};Xe("noiseSizeTopVal",String(t.noiseSizeTop)),Tt(t),Me()}),We("noiseBackOpacitySlider",e=>{const t={noiseBackOpacity:parseFloat(e.value)};Xe("noiseBackOpacityVal",t.noiseBackOpacity.toFixed(3)),Tt(t),Me()}),We("noiseFrontOpacitySlider",e=>{const t={noiseFrontOpacity:parseFloat(e.value)};Xe("noiseFrontOpacityVal",t.noiseFrontOpacity.toFixed(3)),Tt(t),Me()}),We("vignetteLightIntensitySlider",e=>{const t={vignetteLightIntensity:parseFloat(e.value)};Xe("vignetteLightIntensityVal",t.vignetteLightIntensity.toFixed(2)),Tt(t),Me()}),We("vignetteDarkIntensitySlider",e=>{const t={vignetteDarkIntensity:parseFloat(e.value)};Xe("vignetteDarkIntensityVal",t.vignetteDarkIntensity.toFixed(2)),Tt(t),Me()}),We("vignetteBlurOuterSlider",e=>{const t={vignetteBlurOuter:parseInt(e.value,10)};Xe("vignetteBlurOuterVal",String(t.vignetteBlurOuter)),Tt(t),Me()}),We("vignetteBlurMidSlider",e=>{const t={vignetteBlurMid:parseInt(e.value,10)};Xe("vignetteBlurMidVal",String(t.vignetteBlurMid)),Tt(t),Me()}),We("vignetteBlurInnerSlider",e=>{const t={vignetteBlurInner:parseInt(e.value,10)};Xe("vignetteBlurInnerVal",String(t.vignetteBlurInner)),Tt(t),Me()}),We("vignetteSpreadSlider",e=>{const t={vignetteSpread:parseInt(e.value,10)};Xe("vignetteSpreadVal",String(t.vignetteSpread)),Tt(t),Me()}),We("vignetteTransitionSlider",e=>{const t={vignetteTransition:parseInt(e.value,10)};Xe("vignetteTransitionVal",String(t.vignetteTransition)),Tt(t),Me()}),We("gravityPitSlider",t=>{e.gravityMultiplierPit=parseFloat(t.value),Xe("gravityPitVal",e.gravityMultiplierPit.toFixed(2)),"pit"===e.currentMode&&(e.G=e.GE*e.gravityMultiplierPit),Me()}),We("weightPitSlider",t=>{e.ballMassKg=parseFloat(t.value),Xe("weightPitVal",e.ballMassKg.toFixed(0));for(let t=0;t<e.balls.length;t++)e.balls[t].m=e.ballMassKg;Me()}),We("restitutionSlider",t=>{e.REST=parseFloat(t.value),Xe("restitutionVal",e.REST.toFixed(2)),Me()}),We("frictionSlider",t=>{e.FRICTION=parseFloat(t.value),Xe("frictionVal",e.FRICTION.toFixed(4)),Me()});const t=document.getElementById("repellerEnabledPit");t&&t.addEventListener("change",()=>{e.repellerEnabled=!!t.checked,Me()}),We("repelSizeSlider",t=>{e.repelRadius=parseFloat(t.value),Xe("repelSizeVal",e.repelRadius.toFixed(0)),Me()}),We("repelPowerSlider",t=>{const n=parseFloat(t.value),a=Math.max(0,Math.min(1e4,n))/1e4,i=12e3*Math.pow(2,12*(a-.5))*2;e.repelPower=i,Xe("repelPowerVal",Math.round(e.repelPower).toString()),Me()}),We("repelSoftSlider",t=>{e.repelSoft=parseFloat(t.value),Xe("repelSoftVal",e.repelSoft.toFixed(1)),Me()}),We("fliesBallCountSlider",t=>{e.fliesBallCount=parseInt(t.value,10),Xe("fliesBallCountVal",String(e.fliesBallCount)),"flies"===e.currentMode&&Promise.resolve().then(function(){return Ee}).then(({initializeFlies:e})=>{e()})}),We("attractPowerSlider",t=>{e.attractionPower=parseFloat(t.value),Xe("attractPowerVal",Math.round(e.attractionPower).toString())}),We("swarmSpeedSlider",t=>{e.swarmSpeed=parseFloat(t.value),Xe("swarmSpeedVal",e.swarmSpeed.toFixed(1))}),We("fliesSeparationSlider",t=>{e.fliesSeparation=parseFloat(t.value),Xe("fliesSeparationVal",Math.round(e.fliesSeparation).toString())}),We("weightlessCountSlider",t=>{e.weightlessBallCount=parseInt(t.value,10),Xe("weightlessCountVal",String(e.weightlessBallCount)),"weightless"===e.currentMode&&Promise.resolve().then(function(){return Be}).then(({initializeWeightless:e})=>{e()})}),We("weightlessSpeedSlider",t=>{e.weightlessInitialSpeed=parseFloat(t.value),Xe("weightlessSpeedVal",e.weightlessInitialSpeed.toFixed(0)),"weightless"===e.currentMode&&Promise.resolve().then(function(){return Be}).then(({initializeWeightless:e})=>{e()})}),We("weightlessBounceSlider",t=>{e.weightlessBounce=parseFloat(t.value),Xe("weightlessBounceVal",e.weightlessBounce.toFixed(2))}),We("waterBallCountSlider",t=>{e.waterBallCount=parseInt(t.value,10),Xe("waterBallCountVal",String(e.waterBallCount)),"water"===e.currentMode&&Promise.resolve().then(function(){return ae}).then(({initializeWater:e})=>{e()}),Me()}),We("waterRippleStrengthSlider",t=>{e.waterRippleStrength=parseFloat(t.value),Xe("waterRippleStrengthVal",e.waterRippleStrength.toFixed(0)),Me()}),We("waterMotionSlider",t=>{const n=parseFloat(t.value);e.waterDriftStrength=n,e.waterInitialVelocity=5*n,Xe("waterMotionVal",n.toFixed(0)),"water"===e.currentMode&&Promise.resolve().then(function(){return ae}).then(({initializeWater:e})=>{e()}),Me()}),We("vortexBallCountSlider",t=>{e.vortexBallCount=parseInt(t.value,10),Xe("vortexBallCountVal",String(e.vortexBallCount)),"vortex"===e.currentMode&&Promise.resolve().then(function(){return Te}).then(({initializeVortex:e})=>{e()})}),We("vortexSwirlSlider",t=>{e.vortexSwirlStrength=parseFloat(t.value),Xe("vortexSwirlVal",e.vortexSwirlStrength.toFixed(0))}),We("vortexPullSlider",t=>{e.vortexRadialPull=parseFloat(t.value),Xe("vortexPullVal",e.vortexRadialPull.toFixed(0))}),We("pingPongBallCountSlider",t=>{e.pingPongBallCount=parseInt(t.value,10),Xe("pingPongBallCountVal",String(e.pingPongBallCount)),"ping-pong"===e.currentMode&&Promise.resolve().then(function(){return Ve}).then(({initializePingPong:e})=>{e()})}),We("pingPongSpeedSlider",t=>{e.pingPongSpeed=parseFloat(t.value),Xe("pingPongSpeedVal",e.pingPongSpeed.toFixed(0)),"ping-pong"===e.currentMode&&Promise.resolve().then(function(){return Ve}).then(({initializePingPong:e})=>{e()})}),We("pingPongCursorSlider",t=>{e.pingPongCursorRadius=parseFloat(t.value),Xe("pingPongCursorVal",e.pingPongCursorRadius.toFixed(0))}),We("magneticBallCountSlider",t=>{e.magneticBallCount=parseInt(t.value,10),Xe("magneticBallCountVal",String(e.magneticBallCount)),"magnetic"===e.currentMode&&Promise.resolve().then(function(){return Fe}).then(({initializeMagnetic:e})=>{e()})}),We("magneticStrengthSlider",t=>{e.magneticStrength=parseFloat(t.value),Xe("magneticStrengthVal",e.magneticStrength.toFixed(0))}),We("magneticVelocitySlider",t=>{e.magneticMaxVelocity=parseFloat(t.value),Xe("magneticVelocityVal",e.magneticMaxVelocity.toFixed(0))}),We("magneticIntervalSlider",t=>{e.magneticExplosionInterval=parseInt(t.value,10),Xe("magneticIntervalVal",String(e.magneticExplosionInterval))}),We("bubblesRateSlider",t=>{e.bubblesSpawnRate=parseInt(t.value,10),Xe("bubblesRateVal",String(e.bubblesSpawnRate))}),We("bubblesSpeedSlider",t=>{e.bubblesRiseSpeed=parseFloat(t.value),Xe("bubblesSpeedVal",e.bubblesRiseSpeed.toFixed(0))}),We("bubblesWobbleSlider",t=>{e.bubblesWobble=parseFloat(t.value),Xe("bubblesWobbleVal",e.bubblesWobble.toFixed(0))}),We("bubblesMaxSlider",t=>{e.bubblesMaxCount=parseInt(t.value,10),Xe("bubblesMaxVal",String(e.bubblesMaxCount))}),We("bubblesDeflectSlider",t=>{e.bubblesDeflectRadius=parseFloat(t.value),Xe("bubblesDeflectVal",e.bubblesDeflectRadius.toFixed(0))}),u();const n=document.getElementById("colorSelect");n&&n.addEventListener("change",()=>{d(n.value),Me()})}function He(e){document.querySelectorAll(".mode-button").forEach(t=>{const n=t.getAttribute("data-mode")===e;t.classList.toggle("active",n)}),document.querySelectorAll(".mode-controls").forEach(e=>e.classList.remove("active"));const t=e+"Controls",n=document.getElementById(t);n&&n.classList.add("active");const a=document.getElementById("announcer");if(a){const t={pit:"Ball Pit",flies:"Flies to Light",weightless:"Zero-G",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles"};a.textContent=`Switched to ${t[e]||e} mode`}}var Ue=Object.freeze({__proto__:null,setupControls:$e,updateModeButtonsUI:He});let Ye=null,je=null,Qe=null,Ke=null;function Ze(e){e.classList.toggle("collapsed")}function Je(e){const t={...p},n=[{id:"masterGain",valId:"masterVal",fromConfig:e=>100*e,format:e=>`${Math.round(e)}%`},{id:"collisionMinImpact",valId:"thresholdVal",fromConfig:e=>100*e,format:e=>`${Math.round(e)}%`},{id:"decayTime",valId:"decayVal",fromConfig:e=>1e3*e,format:e=>`${Math.round(e)}ms`},{id:"filterBaseFreq",valId:"filterVal",fromConfig:e=>e,format:e=>`${Math.round(e)}Hz`},{id:"rollingGain",valId:"rollingVal",fromConfig:e=>100*e,format:e=>`${e.toFixed(1)}%`}];for(const a of n){const n=e.querySelector(`#${a.id}`),i=e.querySelector(`#${a.valId}`);if(n&&void 0!==t[a.id]){const e=a.fromConfig(t[a.id]);n.value=e,i&&(i.textContent=a.format(e))}}}function et(e){const t=Qe?.querySelector(".panel-header .panel-icon");t&&(t.textContent=e?"üîä":"üîá")}const tt="--abs-brand-logo-scale";let nt=null,at=!1,it=0,lt=0,ot=1,st=null,rt=null,ct=0,dt=null;function ut(){it=window.innerWidth||0,lt=window.innerHeight||0,ot=Math.hypot(.5*it,.5*lt)||1}function mt(){if(ct=0,!at||!nt)return;if(null==st||null==rt)return;const e=st-.5*it,t=rt-.5*lt;var n;const a=.9+(1.1-.9)*((n=Math.hypot(e,t)/ot)<0?0:n>1?1:n);null!=dt&&Math.abs(a-dt)<.001||(nt.style.setProperty(tt,a.toFixed(4)),dt=a)}let pt=0,ht=0,gt=0,ft=0,vt=0,bt=!1;const yt=[t.PIT,t.FLIES,t.WEIGHTLESS,t.WATER,t.VORTEX,t.PING_PONG,t.MAGNETIC,t.BUBBLES];function Mt(){const e=i().currentMode,t=yt.indexOf(e),n=yt[(t+1)%yt.length]||yt[0];Promise.resolve().then(function(){return ze}).then(({setMode:e})=>{e(n)}),Promise.resolve().then(function(){return Ue}).then(({updateModeButtonsUI:e})=>{e(n)})}let St=0,xt=0,wt=0,Et=0,It=performance.now()/1e3,Pt=null;async function Bt(){O().isUnlocked?Rt(N()):await F()?Rt(!0):(Pt.textContent="Audio unavailable",setTimeout(()=>{Pt.textContent="Sound off"},2e3))}function Rt(e){Pt&&(Pt.setAttribute("data-enabled",e?"true":"false"),Pt.setAttribute("aria-pressed",e?"true":"false"),Pt.setAttribute("aria-label","Toggle collision sounds"),Pt.textContent=e?"Sound On":"Sound Off")}function Ct(){const e=i(),t=document.documentElement;t.style.setProperty("--container-border",`${e.containerBorder||0}px`),t.style.setProperty("--simulation-padding",`${e.simulationPadding||0}px`)}function Tt(e){const t=document.documentElement;void 0!==e.wallThickness&&t.style.setProperty("--wall-thickness",`${e.wallThickness}px`),void 0!==e.wallSoftness&&t.style.setProperty("--wall-softness",`${e.wallSoftness}px`),void 0!==e.wallRadius&&t.style.setProperty("--wall-radius",`${e.wallRadius}px`),void 0!==e.wallBounceIntensity&&t.style.setProperty("--wall-bounce-intensity",String(e.wallBounceIntensity)),void 0!==e.noiseSizeBase&&t.style.setProperty("--noise-size-base",`${e.noiseSizeBase}px`),void 0!==e.noiseSizeTop&&t.style.setProperty("--noise-size-top",`${e.noiseSizeTop}px`),void 0!==e.noiseBackOpacity&&t.style.setProperty("--noise-back-opacity",String(e.noiseBackOpacity)),void 0!==e.noiseFrontOpacity&&t.style.setProperty("--noise-front-opacity",String(e.noiseFrontOpacity)),void 0!==e.noiseBackOpacityDark&&t.style.setProperty("--noise-back-opacity-dark",String(e.noiseBackOpacityDark)),void 0!==e.noiseFrontOpacityDark&&t.style.setProperty("--noise-front-opacity-dark",String(e.noiseFrontOpacityDark)),void 0!==e.vignetteLightIntensity&&t.style.setProperty("--vignette-light-intensity",String(e.vignetteLightIntensity)),void 0!==e.vignetteDarkIntensity&&t.style.setProperty("--vignette-dark-intensity",String(e.vignetteDarkIntensity)),void 0!==e.vignetteBlurOuter&&t.style.setProperty("--vignette-blur-outer",`${e.vignetteBlurOuter}px`),void 0!==e.vignetteBlurMid&&t.style.setProperty("--vignette-blur-mid",`${e.vignetteBlurMid}px`),void 0!==e.vignetteBlurInner&&t.style.setProperty("--vignette-blur-inner",`${e.vignetteBlurInner}px`),void 0!==e.vignetteSpread&&t.style.setProperty("--vignette-spread",`${e.vignetteSpread}px`),void 0!==e.vignetteTransition&&t.style.setProperty("--vignette-transition",`${e.vignetteTransition}ms`)}return async function(){document.documentElement.classList.add("js-enabled");try{console.log("üöÄ Initializing modular bouncy balls...");const l=await async function(){try{const e=["config/default-config.json","js/config.json","../public/js/config.json"];for(const t of e)try{const e=await fetch(t,{cache:"no-cache"});if(e.ok)return await e.json()}catch(e){}throw new Error("No config found")}catch(e){return console.warn("Config load failed, using defaults"),{gravityMultiplier:1.05,ballMass:91,maxBalls:300}}}();!function(e){a.config={...e},e.ballMass&&(a.ballMassKg=e.ballMass),e.gravityMultiplier&&(a.gravityMultiplier=e.gravityMultiplier),e.restitution&&(a.REST=e.restitution),e.friction&&(a.FRICTION=e.friction),e.ballScale&&(a.sizeScale=e.ballScale),void 0!==e.containerBorder&&(a.containerBorder=e.containerBorder),void 0!==e.simulationPadding&&(a.simulationPadding=e.simulationPadding),void 0!==e.wallThickness&&(a.wallThickness=e.wallThickness),void 0!==e.wallSoftness&&(a.wallSoftness=e.wallSoftness),void 0!==e.wallRadius&&(a.wallRadius=e.wallRadius);const t=(a.R_MIN_BASE+a.R_MAX_BASE)/2;a.R_MIN=t*a.sizeScale*.75,a.R_MAX=t*a.sizeScale*1.25}(l),console.log("‚úì Config loaded"),Ct(),console.log("‚úì Frame padding applied"),Tt(l),console.log("‚úì Visual effects configured"),function(){const e=document.querySelector(".noise");if(!e)return;const t=getComputedStyle(e),n=t.backgroundImage&&"none"!==t.backgroundImage?t.backgroundImage:null;if(!document.querySelector(".noise-2")){const t=document.createElement("div");t.className="noise-2",n&&(t.style.backgroundImage=n),t.style.position="fixed",t.style.inset="0",t.style.pointerEvents="none",t.style.backgroundRepeat="repeat",t.style.backgroundPosition="50%",t.style.backgroundAttachment="fixed",t.style.mixBlendMode="luminosity",e.insertAdjacentElement("afterend",t),console.log("‚úì Created .noise-2 element")}const a=document.querySelector(".noise-2");if(a&&!document.querySelector(".noise-3")){const e=document.createElement("div");e.className="noise-3",n&&(e.style.backgroundImage=n),e.style.position="fixed",e.style.inset="0",e.style.pointerEvents="none",e.style.backgroundRepeat="repeat",e.style.backgroundPosition="50%",e.style.backgroundAttachment="fixed",e.style.mixBlendMode="luminosity",a.insertAdjacentElement("afterend",e),console.log("‚úì Created .noise-3 element")}}(),ge();const o=ve(),s=be(),r=document.getElementById("bravia-balls");if(!o||!s||!r)throw new Error("Missing DOM elements");!function(e,t,n){a.canvas=e,a.ctx=t,a.container=n}(o,s,r),fe(),console.log("‚úì Canvas initialized (container-relative sizing)"),i().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),function(){const e=i(),a=e.canvas;if(bt=e.clickCycleEnabled||!1,!a)return void console.error("Canvas not available for pointer setup");const l=e.DPR;function o(e,t){const n=a.getBoundingClientRect();return{x:(e-n.left)*l,y:(t-n.top)*l,inBounds:e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom}}document.addEventListener("mousemove",n=>{var a,i;if(a=n.clientX,i=n.clientY,at&&nt&&(st=a,rt=i,ct||(ct=window.requestAnimationFrame(mt))),n.target.closest("#controlPanel"))return;const l=o(n.clientX,n.clientY),s=performance.now(),r=s-gt;if(r>0&&gt>0){const e=l.x-pt,t=l.y-ht;ft=Math.sqrt(e*e+t*t)/r}if(e.mouseX=l.x,e.mouseY=l.y,e.mouseInCanvas=l.inBounds,"undefined"!=typeof window&&(window.mouseInCanvas=l.inBounds),e.currentMode===t.WATER&&l.inBounds&&ft>.3&&s-St>80){const e=Math.min(2*ft,3);ne(l.x,l.y,e),St=s}pt=l.x,ht=l.y,gt=s},{passive:!0}),document.addEventListener("click",e=>{e.target.closest("#controlPanel")||e.target.closest("a")||e.target.closest("button")||o(e.clientX,e.clientY).inBounds&&bt&&Mt()}),document.addEventListener("touchmove",n=>{if(n.touches&&n.touches[0]){const a=o(n.touches[0].clientX,n.touches[0].clientY);e.mouseX=a.x,e.mouseY=a.y,e.mouseInCanvas=a.inBounds;const i=performance.now();e.currentMode===t.WATER&&a.inBounds&&i-St>80&&(ne(a.x,a.y,2),St=i)}},{passive:!0}),document.addEventListener("touchstart",e=>{if(!e.target.closest("#controlPanel")&&!e.target.closest("a")&&!e.target.closest("button")&&e.touches&&e.touches[0]){if(!o(e.touches[0].clientX,e.touches[0].clientY).inBounds)return;const t=performance.now();t-vt<300&&bt&&Mt(),vt=t}},{passive:!0}),document.addEventListener("mouseleave",()=>{e.mouseX=n.OFFSCREEN_MOUSE,e.mouseY=n.OFFSCREEN_MOUSE,e.mouseInCanvas=!1,ft=0,"undefined"!=typeof window&&(window.mouseInCanvas=!1)}),document.addEventListener("touchend",()=>{e.mouseX=n.OFFSCREEN_MOUSE,e.mouseY=n.OFFSCREEN_MOUSE,e.mouseInCanvas=!1},{passive:!0}),console.log("‚úì Unified pointer system configured (document-level)")}(),console.log("‚úì Pointer tracking configured"),"undefined"!=typeof window&&"undefined"!=typeof document&&(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches||(nt=document.querySelector("#brand-logo .hero__text")||document.querySelector("#brand-logo")||null,nt&&(ut(),at=!0,nt.style.setProperty(tt,String(1)),window.addEventListener("resize",ut,{passive:!0})))),console.log("‚ö†Ô∏è localStorage is disabled - using defaults"),he(),console.log("‚úì Dark mode initialized"),d(i().currentTemplate),console.log("‚úì Color system initialized"),G(),Ye=document.createElement("div"),Ye.className="panel-dock",Ye.id="panelDock",je=function(){const e=document.createElement("div");e.id="controlPanel",e.className="panel collapsed",e.setAttribute("role","region"),e.setAttribute("aria-label","Simulation controls");const t=document.createElement("div");t.className="panel-header",t.innerHTML='\n    <div class="panel-title">\n      <span class="panel-icon">‚öôÔ∏è</span>\n      <span>Controls</span>\n    </div>\n    <button class="collapse-btn" aria-label="Expand/collapse controls">‚ñº</button>\n  ';const n=document.createElement("div");return n.className="panel-content",n.innerHTML='\n  \x3c!-- Screen reader announcements --\x3e\n  <div role="status" aria-live="polite" aria-atomic="true" class="sr-only" id="announcer"></div>\n  \n  <div class="panel-content">\n  \n  \x3c!-- Theme Segment Control --\x3e\n  <div class="panel-section">\n    <div class="section-title">üé® Theme</div>\n    <div class="theme-segment-control" role="group" aria-label="Theme selector">\n      <button id="themeAuto" class="theme-segment-btn" aria-label="Auto theme">Auto</button>\n      <button id="themeLight" class="theme-segment-btn active" aria-label="Light theme">Light</button>\n      <button id="themeDark" class="theme-segment-btn" aria-label="Dark theme">Dark</button>\n    </div>\n    <div id="themeStatus" class="panel-status">‚òÄÔ∏è Light Mode</div>\n  </div>\n  \n  \x3c!-- Mode Switcher --\x3e\n  <div class="panel-section">\n    <div class="section-title">Mode</div>\n    <div class="mode-switcher" role="group" aria-label="Simulation mode selector">\n      <button class="mode-button" data-mode="pit" aria-label="Ball Pit mode">üéØ Pit</button>\n      <button class="mode-button active" data-mode="flies" aria-label="Flies mode">üïäÔ∏è Flies</button>\n      <button class="mode-button" data-mode="weightless" aria-label="Zero-G mode">üåå Zero-G</button>\n      <button class="mode-button" data-mode="water" aria-label="Water mode">üåä Water</button>\n      <button class="mode-button" data-mode="vortex" aria-label="Vortex mode">üåÄ Vortex</button>\n      <button class="mode-button" data-mode="ping-pong" aria-label="Ping Pong mode">üèì Pong</button>\n      <button class="mode-button" data-mode="magnetic" aria-label="Magnetic mode">üß≤ Magnet</button>\n      <button class="mode-button" data-mode="bubbles" aria-label="Bubbles mode">ü´ß Bubbles</button>\n    </div>\n  </div>\n  \n  \x3c!-- Global Ball Properties --\x3e\n  <details open>\n    <summary>Global Properties</summary>\n    <div class="group">\n      <label>\n        <span>Size<span class="val" id="sizeValGlobal">1.2</span></span>\n        <input type="range" id="sizeSliderGlobal" min="0.1" max="6.0" step="0.05" value="1.2">\n      </label>\n      <label>\n        <span>Softness<span class="val" id="ballSoftnessValGlobal">20</span></span>\n        <input type="range" id="ballSoftnessSliderGlobal" min="0" max="100" step="1" value="20">\n      </label>\n    </div>\n  </details>\n  \n  \x3c!-- Colors --\x3e\n  <details>\n    <summary>Colors</summary>\n    <div class="group">\n      <label>\n        <span>Color Template</span>\n        <select id="colorSelect"></select>\n      </label>\n    </div>\n  </details>\n  \n  \x3c!-- Rubber Walls --\x3e\n  <details>\n    <summary>Walls</summary>\n    <div class="group">\n      <label>\n        <span>Thickness<span class="val" id="wallThicknessVal">12</span></span>\n        <input type="range" id="wallThicknessSlider" min="0" max="40" step="1" value="12">\n      </label>\n      <label>\n        <span>Softness<span class="val" id="wallSoftnessVal">20</span></span>\n        <input type="range" id="wallSoftnessSlider" min="0" max="60" step="1" value="20">\n      </label>\n      <label>\n        <span>Corner Radius<span class="val" id="wallRadiusVal">42</span></span>\n        <input type="range" id="wallRadiusSlider" min="0" max="80" step="2" value="42">\n      </label>\n      <label>\n        <span>Bounce Flash<span class="val" id="wallBounceHighlightVal">0.30</span></span>\n        <input type="range" id="wallBounceHighlightSlider" min="0" max="1" step="0.05" value="0.3">\n      </label>\n    </div>\n  </details>\n  \n  \x3c!-- Visual Effects --\x3e\n  <details>\n    <summary>Effects</summary>\n    <div class="group">\n      <div class="section-title">Noise Texture</div>\n      <label>\n        <span>Back Size<span class="val" id="noiseSizeBaseVal">100</span></span>\n        <input type="range" id="noiseSizeBaseSlider" min="50" max="200" step="5" value="100">\n      </label>\n      <label>\n        <span>Front Size<span class="val" id="noiseSizeTopVal">80</span></span>\n        <input type="range" id="noiseSizeTopSlider" min="40" max="150" step="5" value="80">\n      </label>\n      <label>\n        <span>Back Opacity<span class="val" id="noiseBackOpacityVal">0.015</span></span>\n        <input type="range" id="noiseBackOpacitySlider" min="0" max="0.1" step="0.001" value="0.015">\n      </label>\n      <label>\n        <span>Front Opacity<span class="val" id="noiseFrontOpacityVal">0.010</span></span>\n        <input type="range" id="noiseFrontOpacitySlider" min="0" max="0.05" step="0.001" value="0.01">\n      </label>\n      \n      <div class="section-title" style="margin-top: 12px;">Vignette</div>\n      <label>\n        <span>Light Intensity<span class="val" id="vignetteLightIntensityVal">0.08</span></span>\n        <input type="range" id="vignetteLightIntensitySlider" min="0" max="1" step="0.01" value="0.08">\n      </label>\n      <label>\n        <span>Dark Intensity<span class="val" id="vignetteDarkIntensityVal">0.05</span></span>\n        <input type="range" id="vignetteDarkIntensitySlider" min="0" max="1" step="0.01" value="0.05">\n      </label>\n      <label>\n        <span>Outer Blur<span class="val" id="vignetteBlurOuterVal">180</span></span>\n        <input type="range" id="vignetteBlurOuterSlider" min="0" max="400" step="10" value="180">\n      </label>\n      <label>\n        <span>Mid Blur<span class="val" id="vignetteBlurMidVal">100</span></span>\n        <input type="range" id="vignetteBlurMidSlider" min="0" max="300" step="10" value="100">\n      </label>\n      <label>\n        <span>Inner Blur<span class="val" id="vignetteBlurInnerVal">40</span></span>\n        <input type="range" id="vignetteBlurInnerSlider" min="0" max="200" step="5" value="40">\n      </label>\n    </div>\n  </details>\n  \n  \x3c!-- Mode-specific Controls --\x3e\n  <div id="pitControls" class="mode-controls">\n    <details open>\n      <summary>Ball Pit Settings</summary>\n      <div class="group">\n        <label>\n          <span>Gravity<span class="val" id="gravityPitVal">1.10</span></span>\n          <input type="range" id="gravityPitSlider" min="0.0" max="2.0" step="0.05" value="1.10">\n        </label>\n        <label>\n          <span>Weight<span class="val" id="weightPitVal">129</span></span>\n          <input type="range" id="weightPitSlider" min="10.0" max="200.0" step="1.0" value="129">\n        </label>\n        <label>\n          <span>Bounciness<span class="val" id="restitutionVal">0.69</span></span>\n          <input type="range" id="restitutionSlider" min="0.00" max="1.00" step="0.01" value="0.69">\n        </label>\n        <label>\n          <span>Air Friction<span class="val" id="frictionVal">0.0060</span></span>\n          <input type="range" id="frictionSlider" min="0.000" max="0.010" step="0.0005" value="0.0060">\n        </label>\n        <label>\n          <span>Repel Size<span class="val" id="repelSizeVal">120</span></span>\n          <input type="range" id="repelSizeSlider" min="50" max="1000" step="5" value="120">\n        </label>\n        <label>\n          <span>Repel Power<span class="val" id="repelPowerVal">8500</span></span>\n          <input type="range" id="repelPowerSlider" min="0" max="10000" step="100" value="8500">\n        </label>\n      </div>\n    </details>\n  </div>\n  \n  <div id="fliesControls" class="mode-controls active">\n    <details open>\n      <summary>Flies Settings</summary>\n      <div class="group">\n        <label>\n          <span>Ball Count<span class="val" id="fliesBallCountVal">60</span></span>\n          <input type="range" id="fliesBallCountSlider" min="20" max="150" step="5" value="60">\n        </label>\n        <label>\n          <span>Attraction<span class="val" id="attractPowerVal">5000</span></span>\n          <input type="range" id="attractPowerSlider" min="100" max="8000" step="50" value="5000">\n        </label>\n        <label>\n          <span>Swarm Speed<span class="val" id="swarmSpeedVal">0.4</span></span>\n          <input type="range" id="swarmSpeedSlider" min="0.2" max="5.0" step="0.1" value="0.4">\n        </label>\n        <label>\n          <span>Separation<span class="val" id="fliesSeparationVal">15000</span></span>\n          <input type="range" id="fliesSeparationSlider" min="5000" max="30000" step="1000" value="15000">\n        </label>\n      </div>\n    </details>\n  </div>\n  \n  <div id="weightlessControls" class="mode-controls">\n    <details open>\n      <summary>Zero-G Settings</summary>\n      <div class="group">\n        <label>\n          <span>Ball Count<span class="val" id="weightlessCountVal">80</span></span>\n          <input type="range" id="weightlessCountSlider" min="20" max="200" step="10" value="80">\n        </label>\n        <label>\n          <span>Initial Speed<span class="val" id="weightlessSpeedVal">250</span></span>\n          <input type="range" id="weightlessSpeedSlider" min="100" max="600" step="25" value="250">\n        </label>\n        <label>\n          <span>Bounce<span class="val" id="weightlessBounceVal">0.95</span></span>\n          <input type="range" id="weightlessBounceSlider" min="0.5" max="1.0" step="0.05" value="0.95">\n        </label>\n      </div>\n    </details>\n  </div>\n  \n  <div id="waterControls" class="mode-controls">\n    <details open>\n      <summary>Water Settings</summary>\n      <div class="group">\n        <label>\n          <span>Ball Count<span class="val" id="waterBallCountVal">300</span></span>\n          <input type="range" id="waterBallCountSlider" min="50" max="400" step="10" value="300">\n        </label>\n        <label>\n          <span>Ripple Strength<span class="val" id="waterRippleStrengthVal">18000</span></span>\n          <input type="range" id="waterRippleStrengthSlider" min="5000" max="30000" step="1000" value="18000">\n        </label>\n        <label>\n          <span>Motion<span class="val" id="waterMotionVal">40</span></span>\n          <input type="range" id="waterMotionSlider" min="0" max="80" step="1" value="40">\n        </label>\n      </div>\n    </details>\n  </div>\n  \n  <div id="vortexControls" class="mode-controls">\n    <details open>\n      <summary>Vortex Settings</summary>\n      <div class="group">\n        <label>\n          <span>Ball Count<span class="val" id="vortexBallCountVal">180</span></span>\n          <input type="range" id="vortexBallCountSlider" min="50" max="300" step="10" value="180">\n        </label>\n        <label>\n          <span>Swirl Strength<span class="val" id="vortexSwirlVal">420</span></span>\n          <input type="range" id="vortexSwirlSlider" min="100" max="800" step="20" value="420">\n        </label>\n        <label>\n          <span>Radial Pull<span class="val" id="vortexPullVal">180</span></span>\n          <input type="range" id="vortexPullSlider" min="0" max="400" step="10" value="180">\n        </label>\n      </div>\n    </details>\n  </div>\n  \n  <div id="ping-pongControls" class="mode-controls">\n    <details open>\n      <summary>Ping Pong Settings</summary>\n      <div class="group">\n        <label>\n          <span>Ball Count<span class="val" id="pingPongBallCountVal">35</span></span>\n          <input type="range" id="pingPongBallCountSlider" min="10" max="100" step="5" value="35">\n        </label>\n        <label>\n          <span>Ball Speed<span class="val" id="pingPongSpeedVal">800</span></span>\n          <input type="range" id="pingPongSpeedSlider" min="200" max="1200" step="50" value="800">\n        </label>\n        <label>\n          <span>Cursor Size<span class="val" id="pingPongCursorVal">50</span></span>\n          <input type="range" id="pingPongCursorSlider" min="20" max="200" step="10" value="50">\n        </label>\n      </div>\n    </details>\n  </div>\n  \n  <div id="magneticControls" class="mode-controls">\n    <details open>\n      <summary>Magnetic Settings</summary>\n      <div class="group">\n        <label>\n          <span>Ball Count<span class="val" id="magneticBallCountVal">180</span></span>\n          <input type="range" id="magneticBallCountSlider" min="50" max="300" step="10" value="180">\n        </label>\n        <label>\n          <span>Strength<span class="val" id="magneticStrengthVal">65000</span></span>\n          <input type="range" id="magneticStrengthSlider" min="10000" max="100000" step="5000" value="65000">\n        </label>\n        <label>\n          <span>Max Velocity<span class="val" id="magneticVelocityVal">2800</span></span>\n          <input type="range" id="magneticVelocitySlider" min="500" max="4000" step="100" value="2800">\n        </label>\n      </div>\n    </details>\n  </div>\n  \n  <div id="bubblesControls" class="mode-controls">\n    <details open>\n      <summary>Bubbles Settings</summary>\n      <div class="group">\n        <label>\n          <span>Bubble Rate<span class="val" id="bubblesRateVal">8</span></span>\n          <input type="range" id="bubblesRateSlider" min="1" max="20" step="1" value="8">\n        </label>\n        <label>\n          <span>Rise Speed<span class="val" id="bubblesSpeedVal">150</span></span>\n          <input type="range" id="bubblesSpeedSlider" min="50" max="400" step="25" value="150">\n        </label>\n        <label>\n          <span>Wobble<span class="val" id="bubblesWobbleVal">40</span></span>\n          <input type="range" id="bubblesWobbleSlider" min="0" max="100" step="5" value="40">\n        </label>\n        <label>\n          <span>Max Bubbles<span class="val" id="bubblesMaxVal">150</span></span>\n          <input type="range" id="bubblesMaxSlider" min="50" max="300" step="10" value="150">\n        </label>\n        <label>\n          <span>Cursor Deflection<span class="val" id="bubblesDeflectVal">80</span></span>\n          <input type="range" id="bubblesDeflectSlider" min="20" max="150" step="10" value="80">\n        </label>\n      </div>\n    </details>\n  </div>\n  \n  \x3c!-- Save Config --\x3e\n  <div class="panel-section panel-section--action">\n    <button id="saveConfigBtn" class="primary">üíæ Save Config</button>\n  </div>\n  \n  \x3c!-- Keyboard shortcuts --\x3e\n  <div class="panel-footer">\n    <kbd>R</kbd> reset ¬∑ <kbd>/</kbd> panel ¬∑ click cycles modes\n  </div>\n  \n  </div>\n'.replace(/<div class="panel-header"[\s\S]*?<\/div>/,""),e.appendChild(t),e.appendChild(n),t.addEventListener("click",()=>Ze(e)),setTimeout(()=>{he(),$e(),function(){const e=document.getElementById("saveConfigBtn");e&&e.addEventListener("click",()=>{const e=i(),t={gravityMultiplier:e.gravityMultiplierPit,ballMass:e.ballMassKg,sizeScale:e.sizeScale,sizeVariation:e.sizeVariation,restitution:e.REST,friction:e.FRICTION,repelRadius:e.repelRadius,repelPower:e.repelPower,repelSoftness:e.repelSoft,cursorColorIndex:5,enableLOD:!1},n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(n),a.download="current-config.json",document.body.appendChild(a),a.click(),document.body.removeChild(a)})}()},0),e}(),Qe=function(){const e=document.createElement("div");e.id="soundPanel",e.className="panel sound-panel collapsed",e.setAttribute("role","region"),e.setAttribute("aria-label","Sound configuration");const t=document.createElement("div");t.className="panel-header",t.innerHTML='\n    <div class="panel-title">\n      <span class="panel-icon">üîä</span>\n      <span>Sound</span>\n    </div>\n    <button class="collapse-btn" aria-label="Expand/collapse sound">‚ñº</button>\n  ';const n=document.createElement("div");return n.className="panel-content",n.innerHTML='\n  \x3c!-- Sound Enable/Disable --\x3e\n  <div class="sound-dock__enable">\n    <button id="soundEnableBtn" class="sound-dock__enable-btn">\n      üîá Enable Sound\n    </button>\n  </div>\n  \n  \x3c!-- Controls (visible when sound enabled) --\x3e\n  <div id="soundControlsWrapper" class="sound-dock__controls" style="display: none;">\n    \x3c!-- Preset --\x3e\n    <div class="sound-dock__section">\n      <select id="soundPresetSelect" class="sound-dock__select"></select>\n      <p id="presetDescription" class="sound-dock__desc"></p>\n    </div>\n    \n    \x3c!-- Core: 5 most important parameters (1:1 with sound-engine CONFIG) --\x3e\n    <div class="sound-dock__section">\n      <div class="sound-dock__group">\n        <label class="sound-dock__row">\n          <span class="sound-dock__label">Master</span>\n          <input type="range" id="masterGain" class="sound-dock__slider" min="10" max="100" step="1">\n          <span class="sound-dock__val" id="masterVal">42%</span>\n        </label>\n        <label class="sound-dock__row">\n          <span class="sound-dock__label">Silence Threshold</span>\n          <input type="range" id="collisionMinImpact" class="sound-dock__slider" min="0" max="30" step="1">\n          <span class="sound-dock__val" id="thresholdVal">12%</span>\n        </label>\n        <label class="sound-dock__row">\n          <span class="sound-dock__label">Click Length</span>\n          <input type="range" id="decayTime" class="sound-dock__slider" min="20" max="180" step="1">\n          <span class="sound-dock__val" id="decayVal">45ms</span>\n        </label>\n        <label class="sound-dock__row">\n          <span class="sound-dock__label">Brightness</span>\n          <input type="range" id="filterBaseFreq" class="sound-dock__slider" min="300" max="6000" step="50">\n          <span class="sound-dock__val" id="filterVal">2100Hz</span>\n        </label>\n        <label class="sound-dock__row">\n          <span class="sound-dock__label">Surface Texture</span>\n          <input type="range" id="rollingGain" class="sound-dock__slider" min="0" max="8" step="0.1">\n          <span class="sound-dock__val" id="rollingVal">2.0%</span>\n        </label>\n      </div>\n    </div>\n  </div>\n',e.appendChild(t),e.appendChild(n),t.addEventListener("click",()=>Ze(e)),setTimeout(()=>function(e){const t=e.querySelector("#soundEnableBtn"),n=e.querySelector("#soundControlsWrapper"),a=e.querySelector("#soundPresetSelect"),i=e.querySelector("#presetDescription");if(t&&t.addEventListener("click",async()=>{if(O().isUnlocked){const e=N();t.textContent=e?"üîä Sound On":"üîá Sound Off",t.style.background=e?"rgba(76, 175, 80, 0.3)":"",n&&(n.style.display=e?"":"none"),et(e)}else await F()&&(t.textContent="üîä Sound On",t.style.background="rgba(76, 175, 80, 0.3)",n&&(n.style.display=""),et(!0))}),a){for(const[e,t]of Object.entries(h)){const n=document.createElement("option");n.value=e,n.textContent=t.label,a.appendChild(n)}a.value=W(),i&&h[W()]&&(i.textContent=h[W()].description),a.addEventListener("change",()=>{!function(e){const t=h[e];if(!t)return console.warn(`Unknown sound preset: ${e}`),!1;g=e;const{label:n,description:a,...i}=t;z(i),console.log(`üéµ Applied sound preset: ${t.label}`)}(a.value),i&&h[a.value]&&(i.textContent=h[a.value].description),Je(e)})}!function(e){const t=[{id:"masterGain",valId:"masterVal",format:e=>`${Math.round(e)}%`,toConfig:e=>e/100},{id:"collisionMinImpact",valId:"thresholdVal",format:e=>`${Math.round(e)}%`,toConfig:e=>e/100},{id:"decayTime",valId:"decayVal",format:e=>`${Math.round(e)}ms`,toConfig:e=>e/1e3},{id:"filterBaseFreq",valId:"filterVal",format:e=>`${Math.round(e)}Hz`,toConfig:e=>e},{id:"rollingGain",valId:"rollingVal",format:e=>`${e.toFixed(1)}%`,toConfig:e=>e/100}];for(const n of t){const t=e.querySelector(`#${n.id}`),a=e.querySelector(`#${n.valId}`);t&&t.addEventListener("input",()=>{const e=parseFloat(t.value),i=n.toConfig(e);a&&(a.textContent=n.format(e)),z({[n.id]:i})})}Je(e)}(e)}(e),0),e}(),Ye.appendChild(Qe),Ye.appendChild(je),Ke=function(){const e=document.createElement("button");return e.className="dock-toggle",e.id="dockToggle",e.setAttribute("aria-label","Show panels"),e.innerHTML="‚öôÔ∏è",e.addEventListener("click",()=>{Ye.classList.remove("hidden"),e.style.opacity="0",e.style.pointerEvents="none"}),e}(),document.body.appendChild(Ye),document.body.appendChild(Ke),document.addEventListener("keydown",e=>{if(!["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName))switch(e.key){case"s":case"S":Ye&&!Ye.classList.contains("hidden")&&Qe&&Ze(Qe);break;case"c":case"C":if(e.ctrlKey||e.metaKey)return;Ye&&!Ye.classList.contains("hidden")&&je&&Ze(je)}}),console.log("‚úì Panel dock created (both panels collapsed by default)"),u(),console.log("‚úì Panel dock created (Sound + Controls)"),window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName))return;const n=e.key.toLowerCase();if("/"===n||"Slash"===e.code)return e.preventDefault(),void function(){if(!Ye)return;const e=Ye.classList.toggle("hidden");Ke&&(Ke.style.opacity=e?"1":"0",Ke.style.pointerEvents=e?"auto":"none")}();"1"===n?(e.preventDefault(),Ne(t.PIT),He("pit")):"2"===n?(e.preventDefault(),Ne(t.FLIES),He("flies")):"3"===n?(e.preventDefault(),Ne(t.WEIGHTLESS),He("weightless")):"4"===n?(e.preventDefault(),Ne(t.WATER),He("water")):"5"===n?(e.preventDefault(),Ne(t.VORTEX),He("vortex")):"6"===n?(e.preventDefault(),Ne(t.PING_PONG),He("ping-pong")):"7"===n?(e.preventDefault(),Ne(t.MAGNETIC),He("magnetic")):"8"===n&&(e.preventDefault(),Ne(t.BUBBLES),He("bubbles"))}),console.log("‚úì Keyboard shortcuts registered"),console.log("‚úì Keyboard shortcuts registered"),function(){const e=document.getElementById("cv-gate-trigger"),t=document.getElementById("brand-logo"),n=document.getElementById("cv-gate"),a=Array.from(document.querySelectorAll(".cv-digit")),i=document.body;if(!e||!t||!n||0===a.length)return void console.warn("CV Gate: Missing required elements");let l=!1;const o=()=>{l=!1,a.forEach(e=>e.value=""),n.classList.remove("active"),t.classList.remove("fade-out-up"),setTimeout(()=>{l||n.classList.add("hidden")},400)},s=()=>{const e=a.map(e=>e.value).join("");4===e.length&&("1111"===e?(i.classList.add("flash-green"),setTimeout(()=>{window.location.href="cv-test.html"},400)):(i.classList.add("flash-red"),setTimeout(()=>{i.classList.remove("flash-red"),a.forEach(e=>e.value=""),a[0].focus()},400)))};e.addEventListener("click",e=>{e.preventDefault(),l=!0,t.classList.add("fade-out-up"),n.classList.remove("hidden"),n.offsetWidth,n.classList.add("active"),a[0].focus()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&l&&o()}),a.forEach((e,t)=>{e.addEventListener("keydown",n=>{"Backspace"===n.key&&""===e.value&&(t>0?a[t-1].focus():o())}),e.addEventListener("input",e=>{const n=e.target.value;if(/^\d*$/.test(n)){if(1===n.length)t<a.length-1?a[t+1].focus():s();else if(n.length>1){const i=n.split("");e.target.value=i[0];let l=t+1;for(let e=1;e<i.length&&l<a.length;e++)a[l].value=i[e],l++;l<a.length?a[l].focus():s()}}else e.target.value=n.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})}(),console.log("‚úì Password gate initialized"),function(){if(G(),"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return console.log("‚è∏ Sound toggle hidden (prefers-reduced-motion)"),null;Pt=document.createElement("button"),Pt.className="sound-toggle footer_link is-orange",Pt.id="sound-toggle",Pt.type="button",Pt.setAttribute("aria-label","Toggle collision sounds"),Pt.setAttribute("aria-pressed","false"),Pt.setAttribute("data-enabled","false"),Pt.style.background="none",Pt.style.border="none",Pt.style.padding="0",Pt.style.font="inherit",Pt.style.cursor="pointer",Pt.style.position="fixed",Pt.style.zIndex="200",Pt.style.bottom="3.5em",Pt.style.left="4em",Pt.textContent="Sound Off",Pt.addEventListener("click",Bt),document.body.appendChild(Pt),console.log("‚úì Sound toggle created")}(),console.log("‚úì Sound toggle button created"),Ne(t.FLIES),console.log("‚úì Mode initialized");const c=()=>Oe();e=(e,t)=>{const n=c();n&&n(e,t)},requestAnimationFrame(function a(l){const o=l/1e3;let s=Math.min(.033,o-It);It=o,async function(e,a){const l=i(),o=l.balls,s=l.canvas;if(!s||0===o.length)return;le+=e;let r=0;for(;le>=ie&&r<n.MAX_PHYSICS_STEPS;){const e=o.length;for(let t=0;t<e;t++)o[t].step(ie,a);l.currentMode!==t.FLIES&&$(10);const n=l.currentMode===t.WEIGHTLESS?l.weightlessBounce:l.REST,i=o.length;for(let e=0;e<i;e++)se(o[e],s),o[e].walls(s.width,s.height,ie,n);le-=ie,r++}l.currentMode===t.WATER&&te(e),Y.step(e),le>ie*n.ACCUMULATOR_RESET_THRESHOLD&&(le=0)}(s,e),function(){const e=i(),t=e.ctx,n=e.balls,a=e.canvas;if(t&&a){t.clearRect(0,0,a.width,a.height),function(e,t,n){const a=i();if(!Y.hasAnyDeformation())return;const l=function(){try{return getComputedStyle(document.documentElement).getPropertyValue("--wall-color").trim()||"#0a0a0a"}catch{return"#0a0a0a"}}(),o=(a.wallRadius||42)*(a.DPR||1),s=(a.wallThickness||12)*(a.DPR||1),r="pit"===a.currentMode?n/3:0;if(e.save(),e.fillStyle=l,Y.bottom.hasDeformation()){e.beginPath(),e.moveTo(o,n+s);for(let a=0;a<=H;a++){const i=a/H,l=o+i*(t-2*o),s=Y.bottom.getDeformAt(i);e.lineTo(l,n-s)}e.lineTo(t-o,n+s),e.closePath(),e.fill()}if(Y.top.hasDeformation()){e.beginPath(),e.moveTo(o,r-s);for(let n=0;n<=H;n++){const a=n/H,i=o+a*(t-2*o),l=Y.top.getDeformAt(a);e.lineTo(i,r+l)}e.lineTo(t-o,r-s),e.closePath(),e.fill()}if(Y.left.hasDeformation()){e.beginPath(),e.moveTo(-s,r+o);for(let t=0;t<=H;t++){const a=t/H,i=r+o+a*(n-r-2*o),l=Y.left.getDeformAt(a);e.lineTo(l,i)}e.lineTo(-s,n-o),e.closePath(),e.fill()}if(Y.right.hasDeformation()){e.beginPath(),e.moveTo(t+s,r+o);for(let a=0;a<=H;a++){const i=a/H,l=r+o+i*(n-r-2*o),s=Y.right.getDeformAt(i);e.lineTo(t-s,l)}e.lineTo(t+s,n-o),e.closePath(),e.fill()}e.restore()}(t,a.width,a.height),e.currentMode;for(let e=0;e<n.length;e++)n[e].draw(t);!function(e){const t=i();if(!t.mouseInCanvas)return;if(!0===t.isTouchDevice)return;if(!1===t.cursorBallVisible)return;const n=Math.max(6*t.DPR,.12*(t.R_MIN+t.R_MAX));e.save(),e.beginPath(),e.arc(t.mouseX,t.mouseY,n,0,2*Math.PI),e.fillStyle=t.currentColors&&t.currentColors[4]||"#000000",e.globalAlpha=.9,e.fill(),e.globalAlpha=1,e.restore()}(t)}}();const r=i().balls||[],c=i();!function(e,t=1/0){if(!x||!w||!f)return;if(B)return;let n=0,a=0;if(p.rollingEnabled)for(const i of e){const e=Math.sqrt(i.vx*i.vx+i.vy*i.vy),l=Math.abs(i.vx),o=Math.abs(i.vy),s=i.y+i.r>=t-3,r=l>2*o,c=e>p.rollingMinVelocity&&e<p.rollingMaxVelocity;s&&r&&c&&(n+=l/p.rollingMaxVelocity,a++)}const i=a>0?Math.min(1,n/Math.max(1,.7*a)):0;if(A+=.15*(i-A),C&&p.rollingEnabled){const e=A*p.rollingGain;if(C.gain.setTargetAtTime(e,f.currentTime,.08),R){const e=1+.15*A;R.frequency.setTargetAtTime(p.rollingFreq*e,f.currentTime,.15)}}k&&k.gain.setTargetAtTime(0,f.currentTime,.05)}(r,c.canvas?c.canvas.height-(c.simulationPadding||0):1/0),function(e){if(wt++,e-xt>1e3){Et=wt,wt=0,xt=e;const t=document.getElementById("render-fps");t&&(t.textContent=String(Et))}}(performance.now()),requestAnimationFrame(a)}),console.log("‚úÖ Bouncy Balls running (modular)"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.body.classList.add("page-ready"),console.log("‚úì Page fade-in triggered")})})}catch(e){console.error("‚ùå Initialization failed:",e),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${e.message}\n${e.stack}</pre>\n    </div>`}var e}(),e.applyFramePaddingCSSVars=Ct,e.applyVisualCSSVars=Tt,e}({});
