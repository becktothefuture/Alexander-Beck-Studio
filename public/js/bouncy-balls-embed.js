(()=>{const t={PIT:"pit",FLIES:"flies",WEIGHTLESS:"weightless"};let e=t.PIT,n=40,i=1.15,s=!0,o=5e3,a=180,l=3.5,r=80,h=250,d=.97,c=300,u=150;const m=-1e9,g=1e-4,y=.25;function f(){return 0===n?0:n/40*.2}const p=document.getElementById("c"),x=p.getContext("2d",{alpha:!0}),v=document.getElementById("controlPanel"),E=document.getElementById("bravia-balls"),M=Math.max(1,Math.min(2,window.devicePixelRatio||1));let I=!1,b=0,S=0;if(v){!function(){const t=localStorage.getItem("panelPosition");if(t&&v)try{const e=JSON.parse(t);v.style.left=e.left,v.style.top=e.top,v.style.right="auto",v.style.bottom="auto"}catch(t){console.warn("Failed to parse saved panel position")}}();const t=v.querySelector(".panel-header span:last-child");t&&t.addEventListener("click",t=>{t.stopPropagation(),v.classList.toggle("hidden"),vt()});const e=t=>{const e=t.target;if("INPUT"===e.tagName||"SELECT"===e.tagName||"BUTTON"===e.tagName||e.closest("label")||e.closest("details"))return;I=!0,v.classList.add("dragging");const n=v.getBoundingClientRect(),i=t.clientX||t.touches&&t.touches[0].clientX,s=t.clientY||t.touches&&t.touches[0].clientY;b=i-n.left,S=s-n.top,t.preventDefault()},n=t=>{if(!I)return;const e=t.clientX||t.touches&&t.touches[0].clientX,n=t.clientY||t.touches&&t.touches[0].clientY,i=e-b,s=n-S,o=window.innerWidth-v.offsetWidth,a=window.innerHeight-v.offsetHeight;v.style.left=Math.max(0,Math.min(i,o))+"px",v.style.top=Math.max(0,Math.min(s,a))+"px",v.style.right="auto",v.style.bottom="auto",t.preventDefault()},i=()=>{I&&(I=!1,v.classList.remove("dragging"),v&&localStorage.setItem("panelPosition",JSON.stringify({left:v.style.left,top:v.style.top})))};v.addEventListener("mousedown",e),window.addEventListener("mousemove",n),window.addEventListener("mouseup",i),v.addEventListener("touchstart",e,{passive:!1}),window.addEventListener("touchmove",n,{passive:!1}),window.addEventListener("touchend",i)}let w,C=50,B=-50,L=100,T=50;function V(){const n=e===t.PIT?1.5:1,i=window.innerHeight*n;p.width=Math.floor(window.innerWidth*M),p.height=Math.floor(i*M)}V(),window.addEventListener("resize",function(){clearTimeout(w),w=setTimeout(()=>{V(),K(),Q()},150)});const F=1960;let R=1.1,P=F*R,q=.88,A=.003,z=.03,N=400;const U=.5*M,G=6,W=24;let H=1,k=.15,O=1,D=null,Y=11.2;const _=.15;let j=1;function X(){j=Math.max(.5,Math.min(3,Math.pow(Y/1,.35)))}X();let Z=G*H,J=W*H;function K(){O=(p.clientWidth||window.innerWidth)<=768?.4:1;const t=H*O;if(null===D)return D=t,Z=G*t,void(J=W*t);const e=t/D;if(1!==e){for(let t=0;t<zt.length;t++)zt[t].r*=e;D=t}Z=G*t,J=W*t}function Q(){bt=[];const t=document.querySelector(It);if(!t)return;const e=t.getBoundingClientRect(),n=p.getBoundingClientRect(),i=function(t){const e=document.createElement("span");e.style.cssText=window.getComputedStyle(t).cssText,e.style.position="absolute",e.style.visibility="hidden",e.style.whiteSpace="nowrap",e.textContent="ABCDEFGHIJKLMNOPQRSTUVWXYZ",document.body.appendChild(e);const n=e.getBoundingClientRect().height;return document.body.removeChild(e),n}(t),s=.5*(e.height-i),o={x:(e.left-n.left)*M,y:(e.top-n.top+s)*M,width:e.width*M,height:i*M};o.width>0&&o.height>0&&o.x<p.width&&o.y<p.height&&o.x+o.width>0&&o.y+o.height>0&&bt.push(o)}let $=!0,tt=0,et=1;const nt={industrialTeal:{label:"Industrial Teal",colors:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"]},sunsetCoral:{label:"Sunset Coral",colors:["#b8b5b1","#e5e3df","#ffffff","#ff6b6b","#000000","#00d4aa","#2563eb","#f59e0b"]},violetPunch:{label:"Violet Punch",colors:["#b5b4bd","#e3e2e9","#ffffff","#8b5cf6","#000000","#ef4444","#06b6d4","#fbbf24"]},citrusBlast:{label:"Citrus Blast",colors:["#b9b7b0","#e6e4dd","#ffffff","#f59e0b","#000000","#ec4899","#3b82f6","#10b981"]},cobaltSpark:{label:"Cobalt Spark",colors:["#b3b6bc","#e1e4e9","#ffffff","#2563eb","#000000","#f97316","#ec4899","#eab308"]}};let it="industrialTeal",st=["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],ot=5,at=st[ot]||"#ff4013";function lt(t=st){try{const e=document.documentElement,n=(t&&t.length?t:st).slice(0,8);for(let t=0;t<8;t++){const i=n[t]||"#ffffff";e.style.setProperty(`--ball-${t+1}`,i)}}catch(t){}}const rt=[.5,.25,.12,.06,.03,.02,.01,.01];function ht(){try{if(!st||0===st.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let e=0;for(let n=0;n<Math.min(st.length,rt.length);n++)if(e+=rt[n],t<=e)return st[n];return st[Math.min(st.length-1,7)]}catch(t){return console.error("Error picking random color:",t),"#ffffff"}}let dt=255,ct=274e3,ut=4.4,mt=m,gt=m,yt=!1,ft=!1;("ontouchstart"in window||navigator.maxTouchPoints>0)&&(ft=!0);const pt="bouncyBallsSettings";function xt(){const t={currentMode:e,gravityMultiplierPit:i,repellerEnabledPit:s,attractionPower:o,orbitRadius:a,swarmSpeed:l,weightlessInitialSpeed:h,weightlessBounce:d,weightlessMaxBalls:weightlessMaxBalls,weightlessRepellerPower:c,weightlessRepellerRadius:u,restitution:q,friction:A,sizeScale:H,sizeVariation:k,ballMassKg:Y,ballSoftness:n,repelPower:ct,repelRadius:dt,repelSoft:ut,cornerRadius:Mt,motionBlur:trailFade,trailSubtlety:wt,currentTemplate:it,cursorBallColor:at,panelVisible:v&&!v.classList.contains("hidden")};try{localStorage.setItem(pt,JSON.stringify(t)),console.log("âœ“ Settings saved")}catch(t){console.warn("Could not save settings:",t)}}function vt(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(xt,500)}const Et=1e4;let Mt=0;const It="#hero-text";let bt=[],St=.025,wt=1.8,Ct=0,Bt=0,Lt=0,Tt=0,Vt=0;const Ft=document.getElementById("render-fps"),Rt=document.getElementById("physics-fps");let Pt=2,qt=0;class At{constructor(t,e,n,i){this.x=t,this.y=e,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=n,this.rBase=n,this.m=Y,this.color=i,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1}step(n){this.t+=n,this.age+=n,e!==t.WEIGHTLESS&&(this.vy+=P*j*n);const i=Math.max(.25,this.m/1),s=e===t.WEIGHTLESS?1e-4:A,a=Math.max(0,1-s/i);this.vx*=a,this.vy*=a,0!==this.driftAx&&this.age<this.driftTime?this.vx+=this.driftAx*n/i:0!==this.driftAx&&(this.driftAx=0),function(n,i){e!==t.PIT?e!==t.FLIES?e===t.WEIGHTLESS&&function(t,e){if(mt===m||gt===m)return;if(c<=0||u<=0)return;const n=u*M,i=t.x-mt,s=t.y-gt,o=i*i+s*s;if(o>n*n)return;const a=Math.max(Math.sqrt(o),g),l=i/a,r=s/a,h=Math.max(0,1-a/n),d=c*h;t.vx+=l*d*e,t.vy+=r*d*e}(n,i):function(t,e){const n=mt===m?.5*p.width:mt,i=gt===m?.5*p.height:gt,s=n-t.x,a=i-t.y,r=s*s+a*a,h=Math.sqrt(r+1),d=s/h,c=a/h,u=o*l*2;t.vx+=d*u*e,t.vy+=c*u*e;const g=120*M;let y=0,f=0,x=0;for(let e=0;e<zt.length;e++){const n=zt[e];if(n===t)continue;const i=t.x-n.x,s=t.y-n.y,o=i*i+s*s;if(o<g*g&&o>0){const t=Math.sqrt(o),e=1-t/g;y+=i/t*e,f+=s/t*e,x++}}if(x>0){const n=15e3;t.vx+=y/x*n*e,t.vy+=f/x*n*e}const v=2500*l;if(Math.random()<.08){const e=Math.random()*Math.PI*2,n=1500*l;t.vx+=Math.cos(e)*n,t.vy+=Math.sin(e)*n}t.vx+=(Math.random()-.5)*v*e,t.vy+=(Math.random()-.5)*v*e;const E=.3+2*Math.random(),I=2e3*l*E*e;t.vx+=-c*I,t.vy+=d*I;const b=2200*l,S=Math.sqrt(t.vx*t.vx+t.vy*t.vy);S>b&&(t.vx=t.vx/S*b,t.vy=t.vy/S*b),t.vx*=.995,t.vy*=.995}(n,i):function(t,e){if(!yt)return;if(ct<=0||dt<=0)return;const n=dt*M,i=t.x-mt,s=t.y-gt,o=i*i+s*s;if(o>n*n)return;const a=Math.max(Math.sqrt(o),g),l=i/a,r=s/a,h=Math.max(0,1-a/n),d=20*ct*Math.pow(h,ut),c=Math.max(.25,t.m/1);t.vx+=l*d*e/c,t.vy+=r*d*e/c;t.vx+=10*(Math.random()-.5)*e,t.vy+=10*(Math.random()-.5)*e}(n,i)}(this,n),this.x+=this.vx*n,this.y+=this.vy*n;const r=Math.max(0,1-2*n);this.omega*=r,this.theta+=this.omega*n,this.theta>Math.PI?this.theta-=2*Math.PI:this.theta<-Math.PI&&(this.theta+=2*Math.PI);const h=Math.min(1,18*n);this.squashAmount+=(0-this.squashAmount)*h,this.squash=1-this.squashAmount}walls(n,i,s,o=q){const a=o;if(0===Mt){if(this.y+this.r>i){this.y=i-this.r;const t=this.vy,e=this.vx-this.omega*this.r,n=Math.max(.25,this.m/1);this.omega+=e/this.r*y/n;const o=Math.max(0,1-1.5*s/n);this.vx*=o;const l=Math.abs(t)<70?0:a;this.vy=-this.vy*(l*Math.pow(1/this.m,_));const r=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(f(),.8*r),this.squash=1-this.squashAmount,this.squashNormalAngle=-Math.PI/2;const h=this.vx/this.r;this.omega+=(h-this.omega)*Math.min(1,8*s)}const o=e===t.PIT?i/3:0;if(this.y-this.r<o){this.y=o+this.r;const t=this.vy;this.vy=-this.vy*a;const e=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(f(),.8*e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI/2}if(this.x+this.r>n){this.x=n-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*a;const t=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(f(),.8*t),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*a;const t=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(f(),.8*t),this.squash=1-this.squashAmount,this.squashNormalAngle=0}}else this.handleRoundedWallCollision(n,i);this.checkTextCollisions(s)}checkTextCollisions(t){for(let t=0;t<bt.length;t++){const e=bt[t],n=Math.max(e.x,Math.min(this.x,e.x+e.width)),i=Math.max(e.y,Math.min(this.y,e.y+e.height)),s=this.x-n,o=this.y-i,a=Math.sqrt(s*s+o*o);if(a<this.r)if(0===a){const t=this.x-e.x,n=e.x+e.width-this.x,i=this.y-e.y,s=e.y+e.height-this.y,o=Math.min(t,n,i,s);o===t?(this.x=e.x-this.r,this.vx=-Math.abs(this.vx)*q):o===n?(this.x=e.x+e.width+this.r,this.vx=Math.abs(this.vx)*q):o===i?(this.y=e.y-this.r,this.vy=-Math.abs(this.vy)*q):(this.y=e.y+e.height+this.r,this.vy=Math.abs(this.vy)*q)}else{const t=this.r-a,e=s/a,n=o/a;this.x+=e*t,this.y+=n*t;const i=this.vx*e+this.vy*n;if(i<0){this.vx-=2*i*e*q,this.vy-=2*i*n*q;const t=Math.min(1,Math.abs(i)/(70*this.r));this.squash=1-f()*t,this.squashDirX=Math.abs(e)>Math.abs(n)?1:0,this.squashDirY=Math.abs(n)>Math.abs(e)?1:0}}}}handleRoundedWallCollision(t,e){const n=Mt,i=[{x:n,y:n},{x:t-n,y:n},{x:t-n,y:e-n},{x:n,y:e-n}];for(let s=0;s<i.length;s++){const o=i[s],a=this.x-o.x,l=this.y-o.y,r=Math.sqrt(a*a+l*l);if(this.isInCornerRegion(o,t,e,n)&&r+this.r>n){const t=n-(r-this.r);if(t>0&&r>0){const e=a/r,n=l/r;this.x+=e*t,this.y+=n*t;const i=this.vx*e+this.vy*n;this.vx-=2*i*e*q,this.vy-=2*i*n*q;const s=Math.min(1,Math.abs(i)/(90*this.r));this.squashAmount=Math.min(f(),.8*s),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.atan2(n,e)}}}if(this.y+this.r>e&&(this.x<n||this.x>t-n)&&(this.y=e-this.r,this.vy=-this.vy*(q*Math.pow(1/this.m,_))),this.y-this.r<0&&(this.x<n||this.x>t-n)&&(this.y=this.r,this.vy=-this.vy*q),this.x+this.r>t&&(this.y<n||this.y>e-n)){this.x=t-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(q*Math.pow(1/this.m,_));const e=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(f(),e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0&&(this.y<n||this.y>e-n)){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(q*Math.pow(1/this.m,_));const t=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(f(),t),this.squash=1-this.squashAmount,this.squashNormalAngle=0}this.y+this.r>e&&this.x>=n&&this.x<=t-n&&(this.y=e-this.r,this.vy=-this.vy*(q*Math.pow(1/this.m,_))),this.y-this.r<0&&this.x>=n&&this.x<=t-n&&(this.y=this.r,this.vy=-this.vy*(q*Math.pow(1/this.m,_))),this.x+this.r>t&&this.y>=n&&this.y<=e-n&&(this.x=t-this.r,this.vx=-this.vx*(q*Math.pow(1/this.m,_))),this.x-this.r<0&&this.y>=n&&this.y<=e-n&&(this.x=this.r,this.vx=-this.vx*(q*Math.pow(1/this.m,_)))}isInCornerRegion(t,e,n,i){return t.x===i&&t.y===i?this.x<=i&&this.y<=i:t.x===e-i&&t.y===i?this.x>=e-i&&this.y<=i:t.x===e-i&&t.y===n-i?this.x>=e-i&&this.y>=n-i:t.x===i&&t.y===n-i&&this.x<=i&&this.y>=n-i}draw(t){t.save(),t.translate(this.x,this.y);const e=Math.min(f(),Math.max(0,this.squashAmount));if(this.r>15&&e>.001){const n=1+e,i=1/n;t.rotate(this.squashNormalAngle),t.scale(n,i),t.rotate(-this.squashNormalAngle)}t.beginPath(),t.arc(0,0,this.r,0,2*Math.PI),t.fillStyle=this.color,t.fill(),t.restore()}}const zt=[];function Nt(t,e,n){return Math.max(e,Math.min(n,t))}function Ut(t,e){return t+Math.random()*(e-t)}function Gt(t,e,n=ht()){const i=(Z+J)/2;let s;if(0===k)s=i;else{const t=.1*i;s=Ut(Math.max(1,i-t),i+t)}const o=new At(t,e,s,n),a=.5*p.width,l=$?et>=0?1:-1:t<a?1:-1,r=Nt(s/(.5*(Z+J)),.6,1.4),h=140*r,d=180*r;return o.vx=l*(h+Math.random()*d),o.vy=120*-Math.random(),o.driftAx=l*(360+420*Math.random())*r,o.driftTime=.22+.28*Math.random(),zt.push(o),o}let Wt=0;function Ht(){const t=p.clientWidth,e=p.clientHeight,n=Nt(L/100*t,0,t);let i=Nt(C/100*t,0,t);if($){const e=.2*t,n=i;i=Nt(i+Math.sin(tt)*e,0,t),et=i>=n?1:-1}const s=Math.min(40,.1*n),o=Nt(i-n/2-s,-s,t),a=Nt(i+n/2+s,-s,t),l=B/100*e,r=l+T/100*e,h=Math.random();return{x:(o+(a-o)*(et>0?Math.pow(h,.7):1-Math.pow(1-h,.7)))*M,y:Ut(l*M,r*M)-(J+2+Ut(0,10*M))}}const kt=new Map;function Ot(t=6){const e=function(){const t=zt.length;if(t<2)return[];const e=Math.max(1,2*J),n=Math.ceil(p.width/e)+1;kt.clear();for(let i=0;i<t;i++){const t=zt[i],s=t.x/e|0,o=(t.y/e|0)*n+s;let a=kt.get(o);a||(a=[],kt.set(o,a)),a.push(i)}const i=[];for(const[t,e]of kt){const s=t/n|0,o=t%n;for(let t=-1;t<=1;t++)for(let a=-1;a<=1;a++){const l=(s+t)*n+(o+a),r=kt.get(l);if(r)for(let t=0;t<e.length;t++){const n=e[t];for(let t=0;t<r.length;t++){const e=r[t];if(e<=n)continue;const s=zt[n],o=zt[e],a=o.x-s.x,l=o.y-s.y,h=s.r+o.r,d=a*a+l*l;if(d<h*h){const t=h-Math.sqrt(Math.max(d,1e-6));i.push({i:n,j:e,overlap:t})}}}}}return i.sort((t,e)=>e.overlap-t.overlap),i}();for(let n=0;n<t;n++)for(let t=0;t<e.length;t++){const{i:n,j:i}=e[t],s=zt[n],o=zt[i],a=o.x-s.x,l=o.y-s.y,r=s.r+o.r,h=a*a+l*l;if(0===h||h>r*r)continue;const d=Math.sqrt(h),c=a/d,u=l/d,m=r-d,g=1/Math.max(s.m,.001),y=1/Math.max(o.m,.001),p=.8*Math.max(m-U,0)/(g+y),x=p*c,v=p*u;s.x-=x*g,s.y-=v*g,o.x+=x*y,o.y+=v*y;const E=o.vx-s.vx,M=o.vy-s.vy,I=E*c+M*u;if(I<0){const t=-(1+(Math.abs(I)<30?0:q))*I/(g+y),e=t*c,n=t*u;s.vx-=e*g,s.vy-=n*g,o.vx+=e*y,o.vy+=n*y;const i=E-I*c,a=M-I*u,l=Math.hypot(i,a);if(l>.001){const t=i*-u+a*c>=0?1:-1,e=.18;s.omega-=t*e*l/Math.max(s.r,1),o.omega+=t*e*l/Math.max(o.r,1)}const r=Math.min(1,Math.abs(I)/(50*(s.r+o.r))),h=Math.min(f(),.8*r);s.squashAmount=Math.max(s.squashAmount,.8*h),s.squashNormalAngle=Math.atan2(-u,-c),o.squashAmount=Math.max(o.squashAmount,.8*h),o.squashNormalAngle=Math.atan2(u,c)}}}let Dt=performance.now()/1e3,Yt=0;const _t=1/120;function jt(){const t=parseFloat(Kt.value);H=t,K();const e=(Z+J)/2;for(let t=0;t<zt.length;t++)if(0===k)zt[t].r=e,zt[t].rBase=e;else{const n=.1*e,i=Math.max(1,e-n),s=e+n;zt[t].r=Ut(i,s),zt[t].rBase=zt[t].r}}console.log("High refresh mode enabled - using requestAnimationFrame"),requestAnimationFrame(function n(i){const s=i/1e3;let o=Math.min(.008,s-Dt);Dt=s,Yt+=o,Ct++,(Ft||Rt)&&s-Lt>=1&&(Ft&&Ct!==Tt&&(Tt=Ct,Ft.textContent=Tt.toString()),Rt&&Bt!==Vt&&(Vt=Bt,Rt.textContent=Vt.toString()),Ct=0,Bt=0,Lt=s,function(t){t-qt<2||(qt=t,Tt<50?(Pt=1,console.log("âš¡ Adaptive Quality: LOW (1 collision iter) - FPS:",Tt)):Tt<70?(Pt=2,console.log("âš¡ Adaptive Quality: MEDIUM (2 collision iters) - FPS:",Tt)):(Pt=3,console.log("âš¡ Adaptive Quality: HIGH (3 collision iters) - FPS:",Tt)))}(s)),function(n){if(e!==t.WEIGHTLESS)for(Wt+=n;Wt>=z;){const t=(Math.random()-.5)*z*.5;Wt-=z+t,tt+=2*Math.PI*.12*(z+t);const e=Ht(),n=Math.random()<.35?3:1;for(let t=0;t<n;t++)if(zt.length<N){const n=8*t*(Math.random()<.5?1:-1);Gt(e.x+n,e.y-12*t)}}}(o),Ct%60==0&&Q();let a=0;for(;Yt>=_t&&a<2;){for(let t=0;t<zt.length;t++)zt[t].step(_t);e!==t.FLIES&&Ot(Pt);const n=e===t.WEIGHTLESS?d:q;for(let t=0;t<zt.length;t++)zt[t].walls(p.width,p.height,_t,n);Yt-=_t,a++,Bt++}Yt>3*_t&&(Yt=0),x.clearRect(0,0,p.width,p.height),Mt>0&&function(t,e,n){const i=Mt;t.strokeStyle="rgba(255, 255, 255, 0.1)",t.lineWidth=2,t.beginPath(),t.moveTo(i,0),t.lineTo(e-i,0),t.arcTo(e,0,e,i,i),t.lineTo(e,n-i),t.arcTo(e,n,e-i,n,i),t.lineTo(i,n),t.arcTo(0,n,0,n-i,i),t.lineTo(0,i),t.arcTo(0,0,i,0,i),t.closePath(),t.stroke()}(x,p.width,p.height);for(let t=0;t<zt.length;t++)zt[t].draw(x);if(function(t){if(ft)return;if(mt===m||gt===m)return;const e=mt,n=gt,i=(Z+J)/2;t.beginPath(),t.arc(e,n,i,0,2*Math.PI),t.fillStyle="rgba(255, 255, 255, 0.9)",t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.6)",t.lineWidth=2,t.stroke()}(x),!ft){x.save(),x.font="14px system-ui, -apple-system, sans-serif",x.fillStyle="rgba(255, 255, 255, 0.3)",x.textAlign="left",x.textBaseline="bottom";const t=e.charAt(0).toUpperCase()+e.slice(1);x.fillText(t+" Mode",10,p.height-10),x.restore()}requestAnimationFrame(n)}),window.addEventListener("keydown",n=>{const i=n.key.toLowerCase();"r"===i&&(function(){if(e===t.WEIGHTLESS)Sn();else for(let t=0;t<zt.length;t++){const e=zt[t],n=Ht();e.x=n.x,e.y=n.y;const i=.5*p.width,s=$?et>=0?1:-1:e.x<i?1:-1,o=Nt(e.r/(.5*(Z+J)),.6,1.4),a=140*o,l=180*o,r=120;e.vx=s*(a+Math.random()*l),e.vy=-Math.random()*r,e.age=0,e.driftAx=s*(360+420*Math.random())*o,e.driftTime=.22+.28*Math.random()}}(),n.preventDefault()),"/"===i&&v&&(n.preventDefault(),v.classList.toggle("hidden"),vt()),"1"===i&&wn(t.PIT),"2"===i&&wn(t.FLIES),"3"===i&&wn(t.WEIGHTLESS)}),function(t=160){for(let e=0;e<t&&zt.length<N;e++){const t=Ht();Gt(t.x,t.y)}}(200),p.addEventListener("mousemove",n=>{const i=p.getBoundingClientRect();mt=(n.clientX-i.left)*M,gt=(n.clientY-i.top)*M,e===t.PIT&&ct>0&&dt>0&&(yt=!0)}),p.addEventListener("mouseleave",()=>{mt=m,gt=m});const Xt=document.getElementById("restitutionSlider"),Zt=document.getElementById("frictionSlider"),Jt=document.getElementById("emitterSlider"),Kt=document.getElementById("sizeSliderGlobal"),Qt=document.getElementById("sizeVariationSliderGlobal"),$t=(document.getElementById("weightSliderGlobal"),document.getElementById("ballSoftnessSliderGlobal")),te=document.getElementById("sizeValGlobal"),ee=document.getElementById("sizeVariationValGlobal"),ne=(document.getElementById("weightValGlobal"),document.getElementById("ballSoftnessValGlobal")),ie=(document.getElementById("sizeSliderPit"),document.getElementById("sizeVariationSliderPit"),document.getElementById("weightSliderPit"),document.getElementById("ballSoftnessSliderPit"),document.getElementById("sizeValPit"),document.getElementById("sizeVariationValPit"),document.getElementById("weightValPit"),document.getElementById("ballSoftnessValPit"),document.getElementById("sizeSliderFlies"),document.getElementById("sizeVariationSliderFlies"),document.getElementById("weightSliderFlies"),document.getElementById("ballSoftnessSliderFlies"),document.getElementById("sizeValFlies"),document.getElementById("sizeVariationValFlies"),document.getElementById("weightValFlies"),document.getElementById("ballSoftnessValFlies"),document.getElementById("sizeSliderZeroG"),document.getElementById("sizeVariationSliderZeroG"),document.getElementById("weightSliderZeroG"),document.getElementById("ballSoftnessSliderZeroG"),document.getElementById("sizeValZeroG"),document.getElementById("sizeVariationValZeroG"),document.getElementById("weightValZeroG"),document.getElementById("ballSoftnessValZeroG"),document.getElementById("maxBallsSlider")),se=document.getElementById("spawnYSlider"),oe=document.getElementById("spawnWidthSlider"),ae=document.getElementById("spawnCenterSlider"),le=document.getElementById("spawnHeightSlider"),re=document.getElementById("repelSizeSlider"),he=document.getElementById("repelPowerSlider"),de=document.getElementById("repelSoftSlider"),ce=document.getElementById("colorSelect"),ue=document.getElementById("color1"),me=document.getElementById("color2"),ge=document.getElementById("color3"),ye=document.getElementById("color4"),fe=document.getElementById("color5"),pe=document.getElementById("color6"),xe=document.getElementById("color7"),ve=document.getElementById("color8"),Ee=document.getElementById("cursorColorSelect"),Me=document.getElementById("color1Val"),Ie=document.getElementById("color2Val"),be=document.getElementById("color3Val"),Se=document.getElementById("color4Val"),we=document.getElementById("color5Val"),Ce=document.getElementById("color6Val"),Be=document.getElementById("color7Val"),Le=document.getElementById("color8Val");[Me,Ie,be,Se,we,Ce,Be,Le].forEach(t=>{t&&t.setAttribute("title","Click to copy")});const Te=document.getElementById("cornerRadiusSlider"),Ve=document.getElementById("cornerRadiusVal"),Fe=document.getElementById("trailFadeSlider"),Re=document.getElementById("trailFadeVal"),Pe=document.getElementById("trailSubtletySlider"),qe=document.getElementById("trailSubtletyVal"),Ae=document.getElementById("restitutionVal"),ze=document.getElementById("frictionVal"),Ne=document.getElementById("emitterVal"),Ue=document.getElementById("maxBallsVal"),Ge=document.getElementById("spawnYVal"),We=document.getElementById("spawnWidthVal"),He=document.getElementById("spawnCenterVal"),ke=document.getElementById("spawnHeightVal"),Oe=document.getElementById("repelSizeVal"),De=document.getElementById("repelPowerVal"),Ye=document.getElementById("repelSoftVal");function _e(){return{gravityMultiplier:R,restitution:q,friction:A,ballMass:Y,emitRate:z,maxBalls:N,ballScale:H,ballVariation:k,spawnX:C,spawnY:B,spawnWidth:L,spawnHeight:T,sweepEnabled:$,repelRadius:dt,repelPower:ct,repelSoftness:ut,trailFade:trailFade,trailSubtlety:wt,colors:st.slice(),colorWeights:rt.slice(),currentTemplate:it,cursorColorIndex:ot}}const je=document.getElementById("saveConfigBtn"),Xe=document.getElementById("buildBtn"),Ze=document.getElementById("configOutput");function Je(t,e){t&&t.addEventListener("click",async()=>{const n="function"==typeof e?e():String(e||"").trim();try{await navigator.clipboard.writeText(n);const e=t.textContent;t.textContent="COPIED",t.style.color="#3ddc84",setTimeout(()=>{t.textContent=e,t.style.color="#888"},900)}catch(t){console.warn("Clipboard unavailable")}})}je&&Xe&&Ze&&(je.addEventListener("click",()=>{const t=(e=_e(),`// Generated configuration from frontend\nconst CONFIG = ${JSON.stringify(e,null,2)};`);var e;Ze.style.display="block",Ze.textContent=t,navigator.clipboard.writeText(t).then(()=>{const t=je.textContent;je.textContent="âœ… Copied!",setTimeout(()=>{je.textContent=t},1200)}).catch(()=>{console.warn("Clipboard copy failed");const t=je.textContent;je.textContent="âš ï¸ Copy failed",setTimeout(()=>{je.textContent=t},1200)})}),Xe.addEventListener("click",()=>{const t=_e();Ze.style.display="block",Ze.innerHTML="\n<strong>ðŸš€ Build Instructions:</strong><br>\n1. Run: <code>npm run build</code><br>\n2. Your current config will be baked into <code>public/js/bouncy-balls-embed.js</code>";const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download="current-config.json",i.click(),URL.revokeObjectURL(n)})),Xt&&Xt.addEventListener("input",()=>{q=parseFloat(Xt.value),Ae&&(Ae.textContent=q.toFixed(2)),vt()}),Zt&&Zt.addEventListener("input",()=>{A=parseFloat(Zt.value),ze&&(ze.textContent=A.toFixed(4)),vt()}),Jt&&Jt.addEventListener("input",()=>{z=parseFloat(Jt.value),Ne&&(Ne.textContent=z.toFixed(3)),vt()}),function(t){if(!t)return;const{size:e,sizeVal:i,sizeVar:s,sizeVarVal:o,soft:a,softVal:l}=t;e&&e.addEventListener("input",()=>{const t=parseFloat(e.value);i&&(i.textContent=t.toFixed(1)),H=t,K();for(let t=0;t<zt.length;t++)zt[t].m=Y;vt()}),s&&s.addEventListener("input",()=>{const t=parseFloat(s.value);o&&(o.textContent=t.toFixed(1)),k=t,vt()}),a&&a.addEventListener("input",()=>{const t=parseInt(a.value,10);l&&(l.textContent=String(t)),n=t,vt()})}({size:Kt,sizeVal:te,sizeVar:Qt,sizeVarVal:ee,soft:$t,softVal:ne}),ie&&ie.addEventListener("input",()=>{N=parseInt(ie.value,10),Ue&&(Ue.textContent=N.toString()),zt.length>N&&(zt.length=N)}),Qt&&Qt.addEventListener("input",()=>{k=parseFloat(Qt.value),ee&&(ee.textContent=k.toFixed(1)),$e()});const Ke=document.getElementById("weightPitSlider"),Qe=document.getElementById("weightPitVal");function $e(){const t=(Z+J)/2;for(let e=0;e<zt.length;e++){const n=zt[e];if(0===k)n.r=t;else{const e=.1*t,i=Math.max(1,t-e),s=t+e;n.r=Ut(i,s)}n.m=Y}}document.getElementById("weightWeightlessSlider"),document.getElementById("weightWeightlessVal"),se&&se.addEventListener("input",()=>{B=parseFloat(se.value),Ge&&(Ge.textContent=B.toFixed(0)),V()}),oe&&oe.addEventListener("input",()=>{L=parseFloat(oe.value),We&&(We.textContent=L.toFixed(0))}),ae&&ae.addEventListener("input",()=>{C=parseFloat(ae.value),He&&(He.textContent=C.toFixed(0))}),le&&le.addEventListener("input",()=>{T=parseFloat(le.value),ke&&(ke.textContent=T.toFixed(0))}),re&&re.addEventListener("input",()=>{dt=parseFloat(re.value),Oe&&(Oe.textContent=dt.toFixed(0)),yt=yt||ct>0&&dt>0}),he&&he.addEventListener("input",()=>{ct=function(t){const e=Math.max(0,Math.min(Et,Number(t)))/Et;return 2*Math.pow(2,12*(e-.5))*12e3}(he.value),De&&(De.textContent=Math.round(ct).toString()),Pn&&"off"!==Pn.value&&(yt=ct>0&&dt>0)}),de&&de.addEventListener("input",()=>{ut=parseFloat(de.value),Ye&&(Ye.textContent=ut.toFixed(1))}),ce&&ce.addEventListener("change",()=>{const t=nt[ce.value];t&&(it=ce.value,st=t.colors.slice(),at=st[ot]||at,ue&&Me&&(ue.value=st[0],Me.textContent=st[0].toUpperCase()),me&&Ie&&(me.value=st[1],Ie.textContent=st[1].toUpperCase()),ge&&be&&(ge.value=st[2],be.textContent=st[2].toUpperCase()),ye&&Se&&(ye.value=st[3],Se.textContent=st[3].toUpperCase()),fe&&we&&(fe.value=st[4],we.textContent=st[4].toUpperCase()),pe&&Ce&&(pe.value=st[5],Ce.textContent=st[5].toUpperCase()),xe&&Be&&(xe.value=st[6],Be.textContent=st[6].toUpperCase()),ve&&Le&&(ve.value=st[7],Le.textContent=st[7].toUpperCase()),Cn(),lt())});const tn=Array.from(document.querySelectorAll(".mode-button")),en=document.getElementById("pitControls"),nn=document.getElementById("fliesControls"),sn=document.getElementById("weightlessControls"),on=document.getElementById("gravityPitSlider"),an=document.getElementById("gravityPitVal"),ln=document.getElementById("repellerEnabledPit"),rn=document.getElementById("attractPowerSlider"),hn=document.getElementById("attractPowerVal"),dn=document.getElementById("orbitRadiusSlider"),cn=document.getElementById("orbitRadiusVal"),un=document.getElementById("swarmSpeedSlider"),mn=document.getElementById("swarmSpeedVal"),gn=document.getElementById("weightlessCountSlider"),yn=document.getElementById("weightlessCountVal"),fn=document.getElementById("weightlessSpeedSlider"),pn=document.getElementById("weightlessSpeedVal"),xn=document.getElementById("weightlessBounceSlider"),vn=document.getElementById("weightlessBounceVal"),En=document.getElementById("weightlessRepelSlider"),Mn=document.getElementById("weightlessRepelVal"),In=document.getElementById("weightlessRepelRadiusSlider"),bn=document.getElementById("weightlessRepelRadiusVal");function Sn(){zt.length=0;const t=r,e=p.width,n=p.height,i=e/n,s=Math.ceil(Math.sqrt(t*i)),o=Math.ceil(t/s),a=(e-80)/Math.max(1,s-1),l=(n-80)/Math.max(1,o-1),d=[];for(let i=0;i<o;i++)for(let o=0;o<s&&!(d.length>=t);o++){const t=40+o*a,s=40+i*l,r=(Math.random()-.5)*a*.25,h=(Math.random()-.5)*l*.25;d.push({x:Math.max(20,Math.min(e-20,t+r)),y:Math.max(20,Math.min(n-20,s+h))})}for(const t of d){const e=Gt(t.x,t.y),n=Math.random()*Math.PI*2,i=h*(.7+.3*Math.random());e.vx=Math.cos(n)*i,e.vy=Math.sin(n)*i,e.driftAx=0,e.driftTime=0}}function wn(n){e=n,E.className="",e===t.PIT&&E.classList.add("mode-pit"),V(),e===t.PIT?(R=i,P=F*R,yt=s&&ct>0&&dt>0,$=!0,zt.length=0,Wt=0,jt()):e===t.FLIES?(R=0,P=F*R,yt=!1,$=!1,function(){zt.length=0;const t=.5*p.width,e=.5*p.height,n=150*M;for(let i=0;i<60;i++){const i=Math.random()*Math.PI*2,s=Math.random()*n,o=Gt(t+Math.cos(i)*s,e+Math.sin(i)*s),a=.5+.5*Math.random(),l=Math.random()*Math.PI*2,r=300*a;o.vx=Math.cos(l)*r,o.vy=Math.sin(l)*r,o.driftAx=0,o.driftTime=0}}(),jt()):e===t.WEIGHTLESS&&(R=0,P=F*R,yt=!1,$=!1,Sn(),jt()),en&&en.classList.toggle("active",e===t.PIT),nn&&nn.classList.toggle("active",e===t.FLIES),sn&&sn.classList.toggle("active",e===t.WEIGHTLESS),tn.forEach(t=>t.classList.toggle("active",t.getAttribute("data-mode")===e))}function Cn(){for(let t=0;t<zt.length;t++)zt[t].color=ht()}tn.forEach(t=>t.addEventListener("click",()=>{wn(t.getAttribute("data-mode")),vt()})),on&&on.addEventListener("input",()=>{i=parseFloat(on.value),an&&(an.textContent=i.toFixed(1)),vt(),e===t.PIT&&(R=i,P=F*R)}),Ke&&Ke.addEventListener("input",()=>{Y=parseFloat(Ke.value),Qe&&(Qe.textContent=Y.toFixed(2));for(let t=0;t<zt.length;t++)zt[t].m=Y;X(),vt()}),ln&&ln.addEventListener("change",()=>{s=!!ln.checked,e===t.PIT&&(yt=s&&ct>0&&dt>0)}),rn&&rn.addEventListener("input",()=>{o=parseFloat(rn.value),hn&&(hn.textContent=Math.round(o).toString())}),dn&&dn.addEventListener("input",()=>{a=parseFloat(dn.value),cn&&(cn.textContent=Math.round(a).toString())}),un&&un.addEventListener("input",()=>{l=parseFloat(un.value),mn&&(mn.textContent=l.toFixed(1))}),gn&&gn.addEventListener("input",()=>{r=parseInt(gn.value,10),yn&&(yn.textContent=r.toString()),e===t.WEIGHTLESS&&Sn()}),fn&&fn.addEventListener("input",()=>{h=parseFloat(fn.value),pn&&(pn.textContent=Math.round(h).toString())}),xn&&xn.addEventListener("input",()=>{d=parseFloat(xn.value),vn&&(vn.textContent=d.toFixed(2))}),En&&En.addEventListener("input",()=>{c=parseFloat(En.value),Mn&&(Mn.textContent=Math.round(c).toString()),vt()}),In&&In.addEventListener("input",()=>{u=parseFloat(In.value),bn&&(bn.textContent=Math.round(u).toString()),vt()}),ue&&ue.addEventListener("input",()=>{st[0]=ue.value,Me&&(Me.textContent=ue.value.toUpperCase()),Cn(),lt()}),me&&me.addEventListener("input",()=>{st[1]=me.value,Ie&&(Ie.textContent=me.value.toUpperCase()),Cn(),lt()}),ge&&ge.addEventListener("input",()=>{st[2]=ge.value,be&&(be.textContent=ge.value.toUpperCase()),Cn(),lt()}),ye&&ye.addEventListener("input",()=>{st[3]=ye.value,Se&&(Se.textContent=ye.value.toUpperCase()),Cn(),lt()}),fe&&fe.addEventListener("input",()=>{st[4]=fe.value,we&&(we.textContent=fe.value.toUpperCase()),Cn(),lt()}),pe&&pe.addEventListener("input",()=>{st[5]=pe.value,Ce&&(Ce.textContent=pe.value.toUpperCase()),Cn(),lt()}),xe&&xe.addEventListener("input",()=>{st[6]=xe.value,Be&&(Be.textContent=xe.value.toUpperCase()),Cn(),lt()}),ve&&ve.addEventListener("input",()=>{st[7]=ve.value,Le&&(Le.textContent=ve.value.toUpperCase()),Cn(),lt()}),Ee&&Ee.addEventListener("change",()=>{const t=Math.max(1,Math.min(8,parseInt(Ee.value,10)))-1;ot=t,at=st[ot]||at}),Je(Me,()=>ue.value.toUpperCase()),Je(Ie,()=>me.value.toUpperCase()),Je(be,()=>ge.value.toUpperCase()),Je(Se,()=>ye.value.toUpperCase()),Je(we,()=>fe.value.toUpperCase()),Je(Ce,()=>pe.value.toUpperCase()),Je(Be,()=>xe.value.toUpperCase()),Je(Le,()=>ve.value.toUpperCase()),Te&&Te.addEventListener("input",()=>{Mt=parseFloat(Te.value),Ve&&(Ve.textContent=Mt.toFixed(0))}),Fe&&Fe.addEventListener("input",()=>{St=parseFloat(Fe.value),Re&&(Re.textContent=St.toFixed(3))}),Pe&&Pe.addEventListener("input",()=>{wt=parseFloat(Pe.value),qe&&(qe.textContent=wt.toFixed(2)+"Ã—")});const Bn={rubberPlayground:{label:"Rubber â€“ Playground",G:1960,REST:.9,FRICTION:.0025,sizeScale:1.8,maxBalls:450,sizeVariation:.2},rubberRacquet:{label:"Rubber â€“ Racquetball",G:3320,REST:.97,FRICTION:.0035,sizeScale:.7,maxBalls:350,sizeVariation:.3},rubberSuperball:{label:"Rubber â€“ Superball",G:1960,REST:.95,FRICTION:.0015,sizeScale:1.2,maxBalls:450,sizeVariation:.05},rubberSoft:{label:"Rubber â€“ Soft",G:1960,REST:.86,FRICTION:.0035,sizeScale:2.2,maxBalls:350,sizeVariation:.25},rubberHeavy:{label:"Rubber â€“ Heavy",G:1960,REST:.88,FRICTION:.003,sizeScale:2,maxBalls:400,sizeVariation:.15}},Ln={fullRain:{label:"Full Rain (top-half)",EMIT_INTERVAL:.03,xCenter:50,y:-50,w:100,h:50},narrowStrip:{label:"Narrow Strip Top",EMIT_INTERVAL:.05,xCenter:50,y:-40,w:20,h:10},leftGutter:{label:"Left Gutter",EMIT_INTERVAL:.045,xCenter:10,y:-60,w:18,h:20},rightGutter:{label:"Right Gutter",EMIT_INTERVAL:.045,xCenter:90,y:-60,w:18,h:20},centerFountain:{label:"Center Fountain",EMIT_INTERVAL:.02,xCenter:50,y:-30,w:30,h:20},stormBurst:{label:"Storm Burst",EMIT_INTERVAL:.005,xCenter:50,y:-80,w:100,h:30},slowSnow:{label:"Slow Snow",EMIT_INTERVAL:.2,xCenter:50,y:-30,w:100,h:20},edgeDrizzle:{label:"Edge Drizzle",EMIT_INTERVAL:.08,xCenter:15,y:-40,w:30,h:15},twinColumns:{label:"Twin Columns",EMIT_INTERVAL:.03,xCenter:30,y:-50,w:10,h:40},focusedBeam:{label:"Focused Beam",EMIT_INTERVAL:.015,xCenter:50,y:-70,w:6,h:12}},Tn={off:{label:"Off",r:710,p:274e3,s:4.4},gentle:{label:"Gentle Breeze",r:120,p:2500,s:2.5},pushField:{label:"Push Field",r:240,p:8e4,s:2},tractor:{label:"Tractor Push",r:320,p:14e4,s:1.6},magnet:{label:"Magnet Repel",r:200,p:18e4,s:3},pulse:{label:"Pulse Strong",r:280,p:22e4,s:1.2},wideSoft:{label:"Wide Soft",r:500,p:8e4,s:4.5},needle:{label:"Needle Point",r:80,p:26e4,s:.8},wall:{label:"Invisible Wall",r:700,p:16e4,s:5},singularity:{label:"Singularity",r:600,p:3e5,s:.5}};function Vn(t,e,n){t.innerHTML="";for(const[i,s]of Object.entries(e)){const e=document.createElement("option");e.value=i,e.textContent=s.label||i,i===n&&(e.selected=!0),t.appendChild(e)}}const Fn=document.getElementById("physicsSelect"),Rn=document.getElementById("spawnSelect"),Pn=document.getElementById("repellerSelect");function qn(t,e,n,i=0){t&&(t.value=String(n)),e&&(e.textContent=i>0?n.toFixed(i):n.toString())}function An(n){const i=Bn[n];if(!i)return;q=i.REST,A=i.FRICTION,N=i.maxBalls,k=i.sizeVariation;const s=i.sizeScale;H=s,K();for(let n=0;n<zt.length;n++)zt[n].m=e===t.BOULDERS?5*Y:Y;zt.length>N&&(zt.length=N),qn(Xt,Ae,q,2),qn(Zt,ze,A,4),qn(Kt,te,H,1),qn(ie,Ue,N,0),qn(Qt,ee,k,1),$e()}function zn(t){const e=Ln[t];e&&(z=e.EMIT_INTERVAL,C=e.xCenter,B=e.y,L=e.w,T=e.h,qn(Jt,Ne,z,3),qn(ae,He,C,0),qn(se,Ge,B,0),qn(oe,We,L,0),qn(le,ke,T,0))}function Nn(t){const e=Tn[t];if(!e)return;dt=e.r,ct=1*e.p,yt="off"!==t,qn(re,Oe,dt,0);const n=function(t){const e=Math.max(1,Number(t))/24e3,n=.5+Math.log2(e)/12;return Math.round(Math.max(0,Math.min(1,n))*Et)}(ct);he&&(he.value=String(n)),De&&(De.textContent=Math.round(ct).toString()),qn(de,Ye,ut,1)}Fn&&Vn(Fn,Bn,"rubberRacquet"),Rn&&Vn(Rn,Ln,"fullRain"),Pn&&Vn(Pn,Tn,"off"),ce&&Vn(ce,nt,"industrialTeal"),An("rubberRacquet"),zn("fullRain"),Nn("off");const Un=nt[it];ue&&Me&&(ue.value=Un.colors[0],Me.textContent=Un.colors[0].toUpperCase()),me&&Ie&&(me.value=Un.colors[1],Ie.textContent=Un.colors[1].toUpperCase()),ge&&be&&(ge.value=Un.colors[2],be.textContent=Un.colors[2].toUpperCase()),ye&&Se&&(ye.value=Un.colors[3],Se.textContent=Un.colors[3].toUpperCase()),fe&&we&&(fe.value=Un.colors[4],we.textContent=Un.colors[4].toUpperCase()),pe&&Ce&&(pe.value=Un.colors[5],Ce.textContent=Un.colors[5].toUpperCase()),xe&&Be&&(xe.value=Un.colors[6],Be.textContent=Un.colors[6].toUpperCase()),ve&&Le&&(ve.value=Un.colors[7],Le.textContent=Un.colors[7].toUpperCase()),lt(Un.colors),Fn&&Fn.addEventListener("change",()=>An(Fn.value)),Rn&&Rn.addEventListener("change",()=>zn(Rn.value)),Pn&&Pn.addEventListener("change",()=>Nn(Pn.value)),K(),Q(),function(){try{const t=localStorage.getItem(pt);if(t){const n=JSON.parse(t);return n.currentMode&&(e=n.currentMode),void 0!==n.gravityMultiplierPit&&(i=n.gravityMultiplierPit),void 0!==n.repellerEnabledPit&&(s=n.repellerEnabledPit),n.attractionPower&&(o=n.attractionPower),n.orbitRadius&&(a=n.orbitRadius),n.swarmSpeed&&(l=n.swarmSpeed),n.weightlessInitialSpeed&&(h=n.weightlessInitialSpeed),n.weightlessBounce&&(d=n.weightlessBounce),n.weightlessMaxBalls&&(weightlessMaxBalls=n.weightlessMaxBalls),void 0!==n.weightlessRepellerPower&&(c=n.weightlessRepellerPower),void 0!==n.weightlessRepellerRadius&&(u=n.weightlessRepellerRadius),n.restitution&&(q=n.restitution),void 0!==n.friction&&(A=n.friction),n.sizeScale&&(H=n.sizeScale),void 0!==n.sizeVariation&&(k=n.sizeVariation),n.ballMassKg&&(Y=n.ballMassKg),n.repelPower&&(ct=n.repelPower),n.repelRadius&&(dt=n.repelRadius),n.repelSoft&&(ut=n.repelSoft),void 0!==n.cornerRadius&&(Mt=n.cornerRadius),void 0!==n.motionBlur&&(trailFade=n.motionBlur),n.trailSubtlety&&(wt=n.trailSubtlety),n.currentTemplate&&(it=n.currentTemplate),n.cursorBallColor&&(at=n.cursorBallColor),void 0!==n.panelVisible&&v&&(n.panelVisible?v.classList.remove("hidden"):v.classList.add("hidden")),console.log("âœ“ Settings loaded"),!0}}catch(t){console.warn("Could not load settings:",t)}}(),wn(e),window.addEventListener("beforeunload",xt)})();