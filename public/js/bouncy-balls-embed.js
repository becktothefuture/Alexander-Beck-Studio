/* Alexander Beck Studio - Bouncy Balls Simulation | Built 2025-10-02T23:00:13.896Z */
(()=>{const t={PIT:"pit",FLIES:"flies",WEIGHTLESS:"weightless",PULSE_GRID:"pulse-grid",VORTEX:"vortex"};let e=t.PIT,n=20,o=1.05,a=!0,i=5e3,s=180,l=.4,r=80,d=250,h=.97,c=300,u=150,m=40,g=.8,y=.25,p=.3,x=.4,v=1,f=3,E=120,I=.15,M="snap",S=1.08,B=8e3,b=200,C=450,w=1e-4,L=3e3,V=!1,T=!1,F=1,R=1,P=0,A=.29,q="#000000",k=!1,G=4,z=.1;const U=-1e9,O=1e-4,X=.25;function N(){return 0===n?0:n/40*.2}const D=document.getElementById("c"),Y=document.getElementById("bravia-balls");let W;try{if(W=D.getContext("2d",{alpha:!0}),!W)throw Error("Canvas 2D context not available")}catch(Ga){throw console.error("‚ùå Failed to initialize canvas:",Ga),Y.innerHTML='\n      <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #1a1a1a; color: white; font-family: system-ui, -apple-system, sans-serif;">\n        <div style="text-align: center; padding: 40px; background: rgba(255,50,50,0.1); border: 2px solid rgba(255,50,50,0.3); border-radius: 12px; max-width: 480px;">\n          <div style="font-size: 72px; margin-bottom: 20px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));">‚ö†Ô∏è</div>\n          <h2 style="margin: 0 0 16px 0; font-size: 24px; font-weight: 600;">Canvas Not Supported</h2>\n          <p style="margin: 0 0 12px 0; opacity: 0.9; line-height: 1.6; font-size: 15px;">Your browser doesn\'t support the HTML5 Canvas 2D features required for this interactive simulation.</p>\n          <p style="margin: 0; opacity: 0.7; font-size: 13px;">Please try a modern browser like Chrome, Firefox, Safari, or Edge.</p>\n        </div>\n      </div>\n    ',Ga}const H=document.getElementById("controlPanel"),j=Math.max(1,Math.min(2,window.devicePixelRatio||1));function _(){if(!T)return void(D.style.filter="none");const t=(t,e)=>`rgba(${parseInt(t.slice(1,3),16)}, ${parseInt(t.slice(3,5),16)}, ${parseInt(t.slice(5,7),16)}, ${e})`,e=`drop-shadow(${F}px ${R}px ${P}px ${t(q,A)})`,n=k?` drop-shadow(${F}px ${Math.round(.5*R)}px ${G}px ${t(q,z)})`:"";D.style.filter=e+n}let $=!1,Z=60,J="initializing",Q=!0,K=!1;function tt(){const t=new Date,e=t.getHours(),n=e>=18||e<6;return t.getMinutes().toString().padStart(2,"0"),n}function et(t){K=t,t?(Y.classList.add("dark-mode"),document.body.classList.add("dark-mode")):(Y.classList.remove("dark-mode"),document.body.classList.remove("dark-mode")),Ot(kt),function(){const t=document.getElementById("darkModeToggle"),e=document.getElementById("darkModeStatus");if(t&&(t.checked=Q),e){const t=new Date,n=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`;K?(e.textContent=`üåô Night Mode (${n})`,e.style.background="rgba(100,100,255,0.3)"):(e.textContent=`‚òÄÔ∏è Day Mode (${n})`,e.style.background="rgba(255,200,0,0.3)")}}()}function nt(){Q&&et(tt())}const ot={normal:{maxBalls:350,collisionIters:2,adaptiveQualityMin:.5},performance:{maxBalls:200,collisionIters:1,adaptiveQualityMin:.3}};let at,it=50,st=-50,lt=100,rt=50;function dt(){const n=e===t.PIT?1.5:1,o=window.innerHeight*n;if(D.width=Math.floor(window.innerWidth*j),D.height=Math.floor(o*j),e===t.PULSE_GRID){_o();for(let t=0;t<xe.length;t++){const e=xe[t];e.gridX=Math.max(0,Math.min(Wo-1,e.gridX)),e.gridY=Math.max(0,Math.min(Yo-1,e.gridY));const n=$o(e.gridX,e.gridY);e.x=n.x,e.y=n.y,e.targetX=n.x,e.targetY=n.y}}}dt(),window.addEventListener("resize",function(){clearTimeout(at),at=setTimeout(()=>{dt(),Tt(),Ft()},150)});const ht=1960;let ct=0,ut=ht*ct,mt=.97,gt=.0035,yt=.03,pt=350;const xt=.5*j,vt=6,ft=24;let Et=1.2,It=0,Mt=1,St=null,Bt=91;const bt=.15;let Ct=1;function wt(){Ct=Math.max(.5,Math.min(3,Math.pow(Bt/1,.35)))}wt();let Lt=vt*Et,Vt=ft*Et;function Tt(){Mt=(D.clientWidth||window.innerWidth)<=768?.4:1;const t=Et*Mt;if(null===St)return St=t,Lt=vt*t,void(Vt=ft*t);const e=t/St;if(1!==e){for(let t=0;t<xe.length;t++)xe[t].r*=e;St=t}Lt=vt*t,Vt=ft*t}function Ft(){oe=[];const t=document.querySelector(ne);if(!t)return;const e=t.getBoundingClientRect(),n=D.getBoundingClientRect(),o=function(t){const e=document.createElement("span");e.style.cssText=window.getComputedStyle(t).cssText,e.style.position="absolute",e.style.visibility="hidden",e.style.whiteSpace="nowrap",e.textContent="ABCDEFGHIJKLMNOPQRSTUVWXYZ",document.body.appendChild(e);const n=e.getBoundingClientRect().height;return document.body.removeChild(e),n}(t),a=.5*(e.height-o),i={x:(e.left-n.left)*j,y:(e.top-n.top+a)*j,width:e.width*j,height:o*j};i.width>0&&i.height>0&&i.x<D.width&&i.y<D.height&&i.x+i.width>0&&i.y+i.height>0&&oe.push(i)}let Rt=!1,Pt=0,At=1;const qt={industrialTeal:{label:"Industrial Teal",light:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#6b726b","#3d453d","#8a928a","#00e6c3","#d5d5d5","#ff6b47","#5b9aff","#ffb84d"]},sunsetCoral:{label:"Sunset Coral",light:["#bdbbb8","#e8e6e3","#ffffff","#ff3b3b","#000000","#00f5d4","#1e40af","#fb923c"],dark:["#716f6b","#3f3d3a","#8e8c88","#ff6b6b","#d8d8d8","#00ffe7","#6ba3ff","#ffb570"]},violetPunch:{label:"Violet Punch",light:["#b8b7c2","#e6e5ed","#ffffff","#9333ea","#000000","#dc2626","#0ea5e9","#facc15"],dark:["#6d6c7a","#3a3845","#8b8a98","#c266ff","#dad6e8","#ff5c5c","#42d4ff","#fff066"]},citrusBlast:{label:"Citrus Blast",light:["#bfbdb5","#eae8df","#ffffff","#ea580c","#000000","#e11d48","#2563eb","#059669"],dark:["#74726a","#403e38","#918f87","#ff8c4d","#dbd9d1","#ff5c7a","#6ba3ff","#00d699"]},cobaltSpark:{label:"Cobalt Spark",light:["#b5b8be","#e3e6eb","#ffffff","#1d4ed8","#000000","#ea580c","#db2777","#d97706"],dark:["#696d75","#3a3e45","#878b93","#6b9dff","#d6dae2","#ff8c5c","#ff66b3","#ffc266"]}};let kt="industrialTeal",Gt=qt.industrialTeal.light.slice(),zt=4,Ut=Gt[zt]||"#00695c";function Ot(t){kt=t,Gt=function(t){const e=qt[t];return e?K?e.dark:e.light:qt.industrialTeal.light}(t),Ut=Gt[zt]||Ut,Ba(),Xt(),function(){const t=document.getElementById("color1"),e=document.getElementById("color2"),n=document.getElementById("color3"),o=document.getElementById("color4"),a=document.getElementById("color5"),i=document.getElementById("color6"),s=document.getElementById("color7"),l=document.getElementById("color8"),r=document.getElementById("color1Val"),d=document.getElementById("color2Val"),h=document.getElementById("color3Val"),c=document.getElementById("color4Val"),u=document.getElementById("color5Val"),m=document.getElementById("color6Val"),g=document.getElementById("color7Val"),y=document.getElementById("color8Val");t&&r&&(t.value=Gt[0],r.textContent=Gt[0].toUpperCase()),e&&d&&(e.value=Gt[1],d.textContent=Gt[1].toUpperCase()),n&&h&&(n.value=Gt[2],h.textContent=Gt[2].toUpperCase()),o&&c&&(o.value=Gt[3],c.textContent=Gt[3].toUpperCase()),a&&u&&(a.value=Gt[4],u.textContent=Gt[4].toUpperCase()),i&&m&&(i.value=Gt[5],m.textContent=Gt[5].toUpperCase()),s&&g&&(s.value=Gt[6],g.textContent=Gt[6].toUpperCase()),l&&y&&(l.value=Gt[7],y.textContent=Gt[7].toUpperCase())}()}function Xt(t=Gt){try{const e=document.documentElement,n=(t&&t.length?t:Gt).slice(0,8);for(let t=0;t<8;t++){const o=n[t]||"#ffffff";e.style.setProperty("--ball-"+(t+1),o)}}catch(e){}}const Nt=[.5,.25,.12,.06,.03,.02,.01,.01];function Dt(){try{if(!Gt||0===Gt.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let e=0;for(let n=0;n<Math.min(Gt.length,Nt.length);n++)if(e+=Nt[n],t<=e)return Gt[n];return Gt[Math.min(Gt.length-1,7)]}catch(Ga){return console.error("Error picking random color:",Ga),"#ffffff"}}let Yt=710,Wt=25e4,Ht=4,jt=U,_t=U,$t=!1,Zt=!1,Jt=!1;function Qt(){se("‚ö†Ô∏è localStorage is disabled")}function Kt(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(Qt,500)}("ontouchstart"in window||navigator.maxTouchPoints>0)&&(Jt=!0);const te=1e4;let ee=0;const ne="#hero-text";let oe=[],ae=.025,ie=1.8;const se=console.log.bind(console);let le=0,re=0,de=0,he=0,ce=0;const ue=document.getElementById("render-fps"),me=document.getElementById("physics-fps");let ge=2,ye=0;class pe{constructor(t,e,n,o){this.x=t,this.y=e,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=n,this.rBase=n,this.m=Bt,this.color=o,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1}step(n){this.t+=n,this.age+=n,e!==t.WEIGHTLESS&&(this.vy+=ut*Ct*n);const o=Math.max(.25,this.m/1),a=Math.max(0,1-(e===t.WEIGHTLESS?1e-4:gt)/o);this.vx*=a,this.vy*=a,0!==this.driftAx&&this.age<this.driftTime?this.vx+=this.driftAx*n/o:0!==this.driftAx&&(this.driftAx=0),function(n,o){e!==t.PIT?e!==t.FLIES?e!==t.WEIGHTLESS||function(t,e){if(jt===U||_t===U)return;if(c<=0||u<=0)return;const n=u*j,o=t.x-jt,a=t.y-_t,i=o*o+a*a;if(i>n*n)return;const s=Math.max(Math.sqrt(i),O),l=o/s,r=a/s,d=c*Math.max(0,1-s/n);t.vx+=l*d*e,t.vy+=r*d*e}(n,o):function(t,e){const n=jt===U?.5*D.width:jt,o=_t===U?.5*D.height:_t,a=n-t.x,s=o-t.y,r=Math.sqrt(a*a+s*s+1),d=a/r,h=s/r,c=i*l*2;t.vx+=d*c*e,t.vy+=h*c*e;const u=120*j;let m=0,g=0,y=0;for(let i=0;i<xe.length;i++){const e=xe[i];if(e===t)continue;const n=t.x-e.x,o=t.y-e.y,a=n*n+o*o;if(a<u*u&&a>0){const t=Math.sqrt(a),e=1-t/u;m+=n/t*e,g+=o/t*e,y++}}if(y>0){const n=15e3;t.vx+=m/y*n*e,t.vy+=g/y*n*e}const p=2500*l;if(Math.random()<.08){const e=Math.random()*Math.PI*2,n=1500*l;t.vx+=Math.cos(e)*n,t.vy+=Math.sin(e)*n}t.vx+=(Math.random()-.5)*p*e,t.vy+=(Math.random()-.5)*p*e;const x=.3+2*Math.random(),v=2e3*l*x*e;t.vx+=-h*v,t.vy+=d*v;const f=2200*l,E=Math.sqrt(t.vx*t.vx+t.vy*t.vy);E>f&&(t.vx=t.vx/E*f,t.vy=t.vy/E*f),t.vx*=.995,t.vy*=.995}(n,o):function(t,e){if(!Zt)return;if(Wt<=0||Yt<=0)return;const n=Yt*j,o=t.x-jt,a=t.y-_t,i=o*o+a*a;if(i>n*n)return;const s=Math.max(Math.sqrt(i),O),l=o/s,r=a/s,d=20*Wt*Math.pow(Math.max(0,1-s/n),Ht),h=Math.max(.25,t.m/1);t.vx+=l*d*e/h,t.vy+=r*d*e/h,t.vx+=10*(Math.random()-.5)*e,t.vy+=10*(Math.random()-.5)*e}(n,o)}(this,n),this.x+=this.vx*n,this.y+=this.vy*n;const s=Math.max(0,1-2*n);this.omega*=s,this.theta+=this.omega*n,this.theta>Math.PI?this.theta-=2*Math.PI:this.theta<-Math.PI&&(this.theta+=2*Math.PI);const r=Math.min(1,18*n);this.squashAmount+=(0-this.squashAmount)*r,this.squash=1-this.squashAmount}walls(n,o,a,i=mt){const s=i;if(0===ee){if(this.y+this.r>o){this.y=o-this.r;const t=this.vy,e=this.vx-this.omega*this.r,n=Math.max(.25,this.m/1);this.omega+=e/this.r*X/n;const i=Math.max(0,1-1.5*a/n);this.vx*=i;const l=Math.abs(t)<70?0:s;this.vy=-this.vy*l*Math.pow(1/this.m,bt);const r=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(N(),.8*r),this.squash=1-this.squashAmount,this.squashNormalAngle=-Math.PI/2;const d=this.vx/this.r;this.omega+=(d-this.omega)*Math.min(1,8*a)}const i=e===t.PIT?o/3:0;if(this.y-this.r<i){this.y=i+this.r;const t=this.vy;this.vy=-this.vy*s;const e=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(N(),.8*e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI/2}if(this.x+this.r>n){this.x=n-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.5*X/e}this.vx=-this.vx*s;const t=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(N(),.8*t),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.5*X/e}this.vx=-this.vx*s;const t=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(N(),.8*t),this.squash=1-this.squashAmount,this.squashNormalAngle=0}}else this.handleRoundedWallCollision(n,o);this.checkTextCollisions(a)}checkTextCollisions(t){for(let e=0;e<oe.length;e++){const t=oe[e],n=Math.max(t.x,Math.min(this.x,t.x+t.width)),o=Math.max(t.y,Math.min(this.y,t.y+t.height)),a=this.x-n,i=this.y-o,s=Math.sqrt(a*a+i*i);if(s<this.r)if(0===s){const e=this.x-t.x,n=t.x+t.width-this.x,o=this.y-t.y,a=t.y+t.height-this.y,i=Math.min(e,n,o,a);i===e?(this.x=t.x-this.r,this.vx=-Math.abs(this.vx)*mt):i===n?(this.x=t.x+t.width+this.r,this.vx=Math.abs(this.vx)*mt):i===o?(this.y=t.y-this.r,this.vy=-Math.abs(this.vy)*mt):(this.y=t.y+t.height+this.r,this.vy=Math.abs(this.vy)*mt)}else{const t=this.r-s,e=a/s,n=i/s;this.x+=e*t,this.y+=n*t;const o=this.vx*e+this.vy*n;if(o<0){this.vx-=2*o*e*mt,this.vy-=2*o*n*mt;const t=Math.min(1,Math.abs(o)/(70*this.r));this.squash=1-N()*t,this.squashDirX=Math.abs(e)>Math.abs(n)?1:0,this.squashDirY=Math.abs(n)>Math.abs(e)?1:0}}}}handleRoundedWallCollision(t,e){const n=ee,o=[{x:n,y:n},{x:t-n,y:n},{x:t-n,y:e-n},{x:n,y:e-n}];for(let a=0;a<o.length;a++){const i=o[a],s=this.x-i.x,l=this.y-i.y,r=Math.sqrt(s*s+l*l);if(this.isInCornerRegion(i,t,e,n)&&r+this.r>n){const t=n-(r-this.r);if(t>0&&r>0){const e=s/r,n=l/r;this.x+=e*t,this.y+=n*t;const o=this.vx*e+this.vy*n;this.vx-=2*o*e*mt,this.vy-=2*o*n*mt;const a=Math.min(1,Math.abs(o)/(90*this.r));this.squashAmount=Math.min(N(),.8*a),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.atan2(n,e)}}}if(this.y+this.r>e&&(this.x<n||this.x>t-n)&&(this.y=e-this.r,this.vy=-this.vy*mt*Math.pow(1/this.m,bt)),this.y-this.r<0&&(this.x<n||this.x>t-n)&&(this.y=this.r,this.vy=-this.vy*mt),this.x+this.r>t&&(this.y<n||this.y>e-n)){this.x=t-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.5*X/e}this.vx=-this.vx*mt*Math.pow(1/this.m,bt);const e=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(N(),e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0&&(this.y<n||this.y>e-n)){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.5*X/e}this.vx=-this.vx*mt*Math.pow(1/this.m,bt);const t=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(N(),t),this.squash=1-this.squashAmount,this.squashNormalAngle=0}this.y+this.r>e&&this.x>=n&&this.x<=t-n&&(this.y=e-this.r,this.vy=-this.vy*mt*Math.pow(1/this.m,bt)),this.y-this.r<0&&this.x>=n&&this.x<=t-n&&(this.y=this.r,this.vy=-this.vy*mt*Math.pow(1/this.m,bt)),this.x+this.r>t&&this.y>=n&&this.y<=e-n&&(this.x=t-this.r,this.vx=-this.vx*mt*Math.pow(1/this.m,bt)),this.x-this.r<0&&this.y>=n&&this.y<=e-n&&(this.x=this.r,this.vx=-this.vx*mt*Math.pow(1/this.m,bt))}isInCornerRegion(t,e,n,o){return t.x===o&&t.y===o?this.x<=o&&this.y<=o:t.x===e-o&&t.y===o?this.x>=e-o&&this.y<=o:t.x===e-o&&t.y===n-o?this.x>=e-o&&this.y>=n-o:t.x===o&&t.y===n-o&&this.x<=o&&this.y>=n-o}draw(n){n.save(),n.translate(this.x,this.y);const o=Math.min(N(),Math.max(0,this.squashAmount));if(this.r>15&&o>.001){const t=1+o,e=1/t;n.rotate(this.squashNormalAngle),n.scale(t,e),n.rotate(-this.squashNormalAngle)}n.beginPath(),n.arc(0,0,this.r,0,2*Math.PI);let a=this.color;if(e===t.VORTEX&&V){const t=Math.sqrt(this.vx*this.vx+this.vy*this.vy);a=`hsl(${220-220*Math.min(t/800,1)}, 70%, 55%)`}n.fillStyle=a,n.fill(),n.restore()}}const xe=[];let ve=[],fe=[];function Ee(t,e,n){return Math.max(e,Math.min(n,t))}function Ie(t,e){return t+Math.random()*(e-t)}function Me(t,e,n=Dt()){const o=(Lt+Vt)/2;let a;if(0===It)a=o;else{const t=.1*o;a=Ie(Math.max(1,o-t),o+t)}const i=new pe(t,e,a,n),s=.5*D.width,l=Rt?At>=0?1:-1:t<s?1:-1,r=Ee(a/(.5*(Lt+Vt)),.6,1.4),d=140*r,h=180*r;return i.vx=l*(d+Math.random()*h),i.vy=120*-Math.random(),i.driftAx=l*(360+420*Math.random())*r,i.driftTime=.22+.28*Math.random(),xe.push(i),i}let Se=0;function Be(){const t=D.clientWidth,e=D.clientHeight,n=Ee(lt/100*t,0,t);let o=Ee(it/100*t,0,t);if(Rt){const e=.2*t,n=o;o=Ee(o+Math.sin(Pt)*e,0,t),At=o>=n?1:-1}const a=Math.min(40,.1*n),i=Ee(o-n/2-a,-a,t),s=Ee(o+n/2+a,-a,t),l=st/100*e,r=l+rt/100*e,d=Math.random();return{x:(i+(s-i)*(At>0?Math.pow(d,.7):1-Math.pow(1-d,.7)))*j,y:Ie(l*j,r*j)-(Vt+2+Ie(0,10*j))}}const be=new Map;function Ce(t=6){const e=function(){const t=xe.length;if(t<2)return[];const e=Math.max(1,2*Vt),n=Math.ceil(D.width/e)+1;be.clear();for(let a=0;a<t;a++){const t=xe[a],o=t.x/e|0,i=(t.y/e|0)*n+o;let s=be.get(i);s||(s=[],be.set(i,s)),s.push(a)}const o=[];for(const[a,i]of be){const t=a/n|0,e=a%n;for(let a=-1;a<=1;a++)for(let s=-1;s<=1;s++){const l=(t+a)*n+(e+s),r=be.get(l);if(r)for(let t=0;t<i.length;t++){const e=i[t];for(let t=0;t<r.length;t++){const n=r[t];if(n<=e)continue;const a=xe[e],i=xe[n],s=i.x-a.x,l=i.y-a.y,d=a.r+i.r,h=s*s+l*l;if(h<d*d){const t=d-Math.sqrt(Math.max(h,1e-6));o.push({i:e,j:n,overlap:t})}}}}}return o.sort((t,e)=>e.overlap-t.overlap),o}();for(let n=0;n<t;n++)for(let t=0;t<e.length;t++){const{i:n,j:o}=e[t],a=xe[n],i=xe[o],s=i.x-a.x,l=i.y-a.y,r=a.r+i.r,d=s*s+l*l;if(0===d||d>r*r)continue;const h=Math.sqrt(d),c=s/h,u=l/h,m=r-h,g=1/Math.max(a.m,.001),y=1/Math.max(i.m,.001),p=.8*Math.max(m-xt,0)/(g+y),x=p*c,v=p*u;a.x-=x*g,a.y-=v*g,i.x+=x*y,i.y+=v*y;const f=i.vx-a.vx,E=i.vy-a.vy,I=f*c+E*u;if(I<0){const t=-(1+(Math.abs(I)<30?0:mt))*I/(g+y),e=t*c,n=t*u;a.vx-=e*g,a.vy-=n*g,i.vx+=e*y,i.vy+=n*y;const o=f-I*c,s=E-I*u,l=Math.hypot(o,s);if(l>.001){const t=o*-u+s*c>=0?1:-1,e=.18;a.omega-=t*e*l/Math.max(a.r,1),i.omega+=t*e*l/Math.max(i.r,1)}const r=Math.min(1,Math.abs(I)/(50*(a.r+i.r))),d=Math.min(N(),.8*r);a.squashAmount=Math.max(a.squashAmount,.8*d),a.squashNormalAngle=Math.atan2(-u,-c),i.squashAmount=Math.max(i.squashAmount,.8*d),i.squashNormalAngle=Math.atan2(u,c)}}}let we=performance.now()/1e3,Le=0;const Ve=1/120;function Te(){const t=parseFloat(Ze.value);Et=t,Tt();const e=(Lt+Vt)/2;for(let n=0;n<xe.length;n++)if(0===It)xe[n].r=e,xe[n].rBase=e;else{const t=.1*e,o=Math.max(1,e-t),a=e+t;xe[n].r=Ie(o,a),xe[n].rBase=xe[n].r}}requestAnimationFrame(function n(o){const a=o/1e3;let i=Math.min(.033,a-we);we=a,Le+=i,(ue||me)&&le++,(ue||me)&&a-de>=1&&(ue&&le!==he&&(he=le,ue.textContent=he.toString()),me&&re!==ce&&(ce=re,me.textContent=ce.toString()),le=0,re=0,de=a,function(t){t-ye<2||(ye=t,ge=he<50?1:he<70?2:3)}(a)),function(n){if(e!==t.PIT&&e!==t.WEIGHTLESS&&e!==t.PULSE_GRID&&e!==t.VORTEX)for(Se+=n;Se>=yt;){const t=(Math.random()-.5)*yt*.5;Se-=yt+t,Pt+=.24*Math.PI*(yt+t);const e=Be(),n=Math.random()<.35?3:1;for(let o=0;o<n;o++)if(xe.length<pt){const t=8*o*(Math.random()<.5?1:-1);Me(e.x+t,e.y-12*o)}}}(i),e===t.PULSE_GRID&&function(t){for(let e=0;e<xe.length;e++){const n=xe[e];if(n.nextJumpTime-=t,n.nextJumpTime<=0&&n.jumpProgress>=1){const t=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}],e=t[Math.floor(Math.random()*t.length)],o=f-v+1,a=v+Math.floor(Math.random()*o),i=Math.max(1,Math.round(a*(1-.5*x+x*Math.random())));let s=n.gridX+e.dx*i,l=n.gridY+e.dy*i;s=Math.max(0,Math.min(Wo-1,s)),l=Math.max(0,Math.min(Yo-1,l)),n.gridX=s,n.gridY=l;const r=$o(s,l);n.targetX=r.x,n.targetY=r.y,n.jumpProgress=0,n.jumpStartX=n.x,n.jumpStartY=n.y;const d=x*g*(Math.random()-.5),h=p*g*Math.random();n.nextJumpTime=g+d+h}if(n.jumpProgress<1)if(n.jumpProgress+=t/y,n.jumpProgress>=1)n.jumpProgress=1,n.x=n.targetX,n.y=n.targetY,n.vx=0,n.vy=0;else{const t=n.jumpProgress;let e=t;if("linear"===M)e=t;else if("snap"===M)if(t<.6){const n=t/.6;e=n*n*S}else{const n=(t-.6)/.4;e=1+(S-1)*(1-n)-I*Math.sin(n*Math.PI)}else"bounce"===M?e=t<.7?t/.7*(t/.7):1-.5*I*Math.sin((t-.7)/.3*Math.PI*2):"smooth"===M&&(e=t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2);n.x=n.jumpStartX+(n.targetX-n.jumpStartX)*e,n.y=n.jumpStartY+(n.targetY-n.jumpStartY)*e,n.vx=0,n.vy=0}}}(i),le%60==0&&Ft(),e===t.VORTEX&&function(){const t=D.width/j,e=D.height/j,n=$t?jt/j:t/2,o=$t?_t/j:e/2;ve=[{x:n,y:o,strength:B,isPermanent:!1}],fe.length>0&&(fe[0].x=n,fe[0].y=o)}();let s=0;for(;Le>=Ve&&s<2;){if(e!==t.PULSE_GRID){const n=xe.length;for(let o=0;o<n;o++)xe[o].step(Ve),e===t.VORTEX&&Zo(xe[o],Ve)}if(e!==t.FLIES&&e!==t.PULSE_GRID&&e!==t.VORTEX&&Ce(ge),e!==t.PULSE_GRID){const n=e===t.WEIGHTLESS?h:mt,o=xe.length;for(let t=0;t<o;t++)xe[t].walls(D.width,D.height,Ve,n)}Le-=Ve,s++,re++}Le>3*Ve&&(Le=0),W.clearRect(0,0,D.width,D.height),ee>0&&function(t,e,n){const o=ee;t.strokeStyle="rgba(255, 255, 255, 0.1)",t.lineWidth=2,t.beginPath(),t.moveTo(o,0),t.lineTo(e-o,0),t.arcTo(e,0,e,o,o),t.lineTo(e,n-o),t.arcTo(e,n,e-o,n,o),t.lineTo(o,n),t.arcTo(0,n,0,n-o,o),t.lineTo(0,o),t.arcTo(0,0,o,0,o),t.closePath(),t.stroke()}(W,D.width,D.height);const l=xe.length;for(let t=0;t<l;t++)xe[t].draw(W);if(function(t){if(Jt)return;if(jt===U||_t===U)return;const e=jt,n=_t,o=(Lt+Vt)/2*1.3;t.beginPath(),t.arc(e,n,o,0,2*Math.PI),t.fillStyle="rgba(255, 255, 255, 0.9)",t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.6)",t.lineWidth=2,t.stroke()}(W),!Jt){W.save(),W.font="14px system-ui, -apple-system, sans-serif",W.fillStyle="rgba(255, 255, 255, 0.3)",W.textAlign="left",W.textBaseline="bottom";const t=e.charAt(0).toUpperCase()+e.slice(1);W.fillText(t+" Mode",10,D.height-10),W.restore()}requestAnimationFrame(n)});const Fe=document.getElementById("panelHeader"),Re=document.getElementById("minimizePanel");if(H&&H.classList.add("hidden"),Re&&H&&Re.addEventListener("click",t=>{t.stopPropagation(),H.classList.toggle("hidden")}),Fe&&H){let za,Ua,Oa,Xa,Na=!1,Da=0,Ya=0;function Pe(t){"touchstart"===t.type?(Oa=t.touches[0].clientX-Da,Xa=t.touches[0].clientY-Ya):(Oa=t.clientX-Da,Xa=t.clientY-Ya),(t.target===Fe||Fe.contains(t.target))&&(Na=!0,H.style.cursor="grabbing")}function Ae(t){if(Na){t.preventDefault(),"touchmove"===t.type?(za=t.touches[0].clientX-Oa,Ua=t.touches[0].clientY-Xa):(za=t.clientX-Oa,Ua=t.clientY-Xa),Da=za,Ya=Ua,H.getBoundingClientRect();const e=window.getComputedStyle(H),n=parseFloat(e.top)||0,o=parseFloat(e.right)||0;H.style.top=n+Ya+"px",H.style.right=o-Da+"px",H.style.left="auto",H.style.bottom="auto",Da=0,Ya=0,Oa="touchmove"===t.type?t.touches[0].clientX:t.clientX,Xa="touchmove"===t.type?t.touches[0].clientY:t.clientY}}function qe(t){Na&&(Na=!1,H.style.cursor="move",Oa=za,Xa=Ua)}Fe.addEventListener("mousedown",Pe),document.addEventListener("mousemove",Ae),document.addEventListener("mouseup",qe),Fe.addEventListener("touchstart",Pe),document.addEventListener("touchmove",Ae),document.addEventListener("touchend",qe)}const ke=document.getElementById("vortexBallCountSlider"),Ge=document.getElementById("vortexBallCountVal"),ze=document.getElementById("vortexWellStrengthSlider"),Ue=document.getElementById("vortexWellStrengthVal"),Oe=document.getElementById("vortexMouseStrengthSlider"),Xe=document.getElementById("vortexMouseStrengthVal"),Ne=document.getElementById("vortexInitialSpeedSlider"),De=document.getElementById("vortexInitialSpeedVal"),Ye=document.getElementById("vortexDecaySlider"),We=document.getElementById("vortexDecayVal"),He=document.getElementById("vortexSpeedColorCheckbox");ke&&ke.addEventListener("input",()=>{b=parseInt(ke.value,10),Ge&&(Ge.textContent=b.toString()),e===t.VORTEX&&Jo(),Kt()}),ze&&ze.addEventListener("input",()=>{B=parseInt(ze.value,10),Ue&&(Ue.textContent=B.toString()),e===t.VORTEX&&ve.length>0&&(ve[0].strength=B,fe[0].strength=B),Kt()}),Oe&&Oe.addEventListener("input",()=>{L=parseInt(Oe.value,10),Xe&&(Xe.textContent=L.toString()),Kt()}),Ne&&Ne.addEventListener("input",()=>{C=parseInt(Ne.value,10),De&&(De.textContent=C.toString()),Kt()}),Ye&&Ye.addEventListener("input",()=>{w=parseFloat(Ye.value),We&&(We.textContent=w.toFixed(4)),Kt()}),He&&He.addEventListener("change",()=>{V=He.checked,Kt()}),window.addEventListener("keydown",n=>{const o=n.key.toLowerCase();"r"===o&&(function(){if(e===t.WEIGHTLESS)No();else for(let t=0;t<xe.length;t++){const e=xe[t],n=Be();e.x=n.x,e.y=n.y;const o=.5*D.width,a=Rt?At>=0?1:-1:e.x<o?1:-1,i=Ee(e.r/(.5*(Lt+Vt)),.6,1.4),s=140*i,l=180*i,r=120;e.vx=a*(s+Math.random()*l),e.vy=-Math.random()*r,e.age=0,e.driftAx=a*(360+420*Math.random())*i,e.driftTime=.22+.28*Math.random()}}(),n.preventDefault()),"/"===o&&H&&(n.preventDefault(),H.classList.toggle("hidden")),"1"===o&&Ko(t.PIT),"2"===o&&Ko(t.FLIES),"3"===o&&Ko(t.WEIGHTLESS),"4"===o&&Ko(t.PULSE_GRID),"5"===o&&Ko(t.VORTEX)}),D.addEventListener("mousemove",n=>{const o=D.getBoundingClientRect();jt=(n.clientX-o.left)*j,_t=(n.clientY-o.top)*j,$t=!0,e===t.PIT&&Wt>0&&Yt>0&&(Zt=!0)}),D.addEventListener("mouseleave",()=>{jt=U,_t=U,$t=!1});const je=document.getElementById("restitutionSlider"),_e=document.getElementById("frictionSlider"),$e=document.getElementById("emitterSlider"),Ze=document.getElementById("sizeSliderGlobal"),Je=document.getElementById("sizeVariationSliderGlobal"),Qe=(document.getElementById("weightSliderGlobal"),document.getElementById("ballSoftnessSliderGlobal")),Ke=document.getElementById("sizeValGlobal"),tn=document.getElementById("sizeVariationValGlobal"),en=(document.getElementById("weightValGlobal"),document.getElementById("ballSoftnessValGlobal")),nn=(document.getElementById("sizeSliderPit"),document.getElementById("sizeVariationSliderPit"),document.getElementById("weightSliderPit"),document.getElementById("ballSoftnessSliderPit"),document.getElementById("sizeValPit"),document.getElementById("sizeVariationValPit"),document.getElementById("weightValPit"),document.getElementById("ballSoftnessValPit"),document.getElementById("sizeSliderFlies"),document.getElementById("sizeVariationSliderFlies"),document.getElementById("weightSliderFlies"),document.getElementById("ballSoftnessSliderFlies"),document.getElementById("sizeValFlies"),document.getElementById("sizeVariationValFlies"),document.getElementById("weightValFlies"),document.getElementById("ballSoftnessValFlies"),document.getElementById("sizeSliderZeroG"),document.getElementById("sizeVariationSliderZeroG"),document.getElementById("weightSliderZeroG"),document.getElementById("ballSoftnessSliderZeroG"),document.getElementById("sizeValZeroG"),document.getElementById("sizeVariationValZeroG"),document.getElementById("weightValZeroG"),document.getElementById("ballSoftnessValZeroG"),document.getElementById("maxBallsSlider")),on=document.getElementById("spawnYSlider"),an=document.getElementById("spawnWidthSlider"),sn=document.getElementById("spawnCenterSlider"),ln=document.getElementById("spawnHeightSlider"),rn=document.getElementById("repelSizeSlider"),dn=document.getElementById("repelPowerSlider"),hn=document.getElementById("repelSoftSlider"),cn=document.getElementById("colorSelect"),un=document.getElementById("color1"),mn=document.getElementById("color2"),gn=document.getElementById("color3"),yn=document.getElementById("color4"),pn=document.getElementById("color5"),xn=document.getElementById("color6"),vn=document.getElementById("color7"),fn=document.getElementById("color8"),En=document.getElementById("cursorColorSelect"),In=document.getElementById("color1Val"),Mn=document.getElementById("color2Val"),Sn=document.getElementById("color3Val"),Bn=document.getElementById("color4Val"),bn=document.getElementById("color5Val"),Cn=document.getElementById("color6Val"),wn=document.getElementById("color7Val"),Ln=document.getElementById("color8Val");[In,Mn,Sn,Bn,bn,Cn,wn,Ln].forEach(t=>{t&&t.setAttribute("title","Click to copy")});const Vn=document.getElementById("cornerRadiusSlider"),Tn=document.getElementById("cornerRadiusVal"),Fn=document.getElementById("trailFadeSlider"),Rn=document.getElementById("trailFadeVal"),Pn=document.getElementById("trailSubtletySlider"),An=document.getElementById("trailSubtletyVal"),qn=document.getElementById("restitutionVal"),kn=document.getElementById("frictionVal"),Gn=document.getElementById("emitterVal"),zn=document.getElementById("maxBallsVal"),Un=document.getElementById("spawnYVal"),On=document.getElementById("spawnWidthVal"),Xn=document.getElementById("spawnCenterVal"),Nn=document.getElementById("spawnHeightVal"),Dn=document.getElementById("repelSizeVal"),Yn=document.getElementById("repelPowerVal"),Wn=document.getElementById("repelSoftVal");function Hn(){return{gravityMultiplier:ct,restitution:mt,friction:gt,ballMass:Bt,emitRate:yt,maxBalls:pt,ballScale:Et,ballVariation:It,spawnX:it,spawnY:st,spawnWidth:lt,spawnHeight:rt,sweepEnabled:Rt,repelRadius:Yt,repelPower:Wt,repelSoftness:Ht,trailFade:ae,trailSubtlety:ie,colors:Gt.slice(),colorWeights:Nt.slice(),currentTemplate:kt,cursorColorIndex:zt,performanceMode:$,targetFPS:Z,enableLOD:!0}}const jn=document.getElementById("saveConfigBtn"),_n=document.getElementById("buildBtn"),$n=document.getElementById("configOutput");function Zn(t,e){t&&t.addEventListener("click",async()=>{const n="function"==typeof e?e():((e||"")+"").trim();try{await navigator.clipboard.writeText(n);const e=t.textContent;t.textContent="COPIED",t.style.color="#3ddc84",setTimeout(()=>{t.textContent=e,t.style.color="#888"},900)}catch(o){console.warn("Clipboard unavailable")}})}jn&&_n&&$n&&(jn.addEventListener("click",()=>{const t=Hn(),e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download="current-config.json",o.click(),URL.revokeObjectURL(n),$n.style.display="block",$n.innerHTML="\n<strong>üíæ Config Saved!</strong><br>\nReplace <code>source/current-config.json</code> with the downloaded file.<br>\nThen rebuild: <code>npm run build-production</code>";const a=jn.textContent;jn.textContent="‚úÖ Downloaded!",setTimeout(()=>{jn.textContent=a},2e3)}),_n.addEventListener("click",()=>{const t=Hn();$n.style.display="block",$n.innerHTML="\n<strong>üöÄ Build Instructions:</strong><br>\n1. Run: <code>npm run build</code><br>\n2. Your current config will be baked into <code>public/js/bouncy-balls-embed.js</code>";const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download="current-config.json",o.click(),URL.revokeObjectURL(n)})),je&&je.addEventListener("input",()=>{mt=parseFloat(je.value),qn&&(qn.textContent=mt.toFixed(2)),Kt()}),_e&&_e.addEventListener("input",()=>{gt=parseFloat(_e.value),kn&&(kn.textContent=gt.toFixed(4)),Kt()}),$e&&$e.addEventListener("input",()=>{yt=parseFloat($e.value),Gn&&(Gn.textContent=yt.toFixed(3)),Kt()}),function(t){if(!t)return;const{size:e,sizeVal:o,sizeVar:a,sizeVarVal:i,soft:s,softVal:l}=t;e&&e.addEventListener("input",()=>{const t=parseFloat(e.value);o&&(o.textContent=t.toFixed(1)),Et=t,Tt();const n=(Lt+Vt)/2;for(let e=0;e<xe.length;e++)xe[e].r=n,xe[e].rBase=n;for(let e=0;e<xe.length;e++)xe[e].m=Bt;Kt()}),a&&a.addEventListener("input",()=>{const t=parseFloat(a.value);i&&(i.textContent=t.toFixed(1)),It=t,Kt()}),s&&s.addEventListener("input",()=>{const t=parseInt(s.value,10);l&&(l.textContent=t+""),n=t,Kt()})}({size:Ze,sizeVal:Ke,sizeVar:Je,sizeVarVal:tn,soft:Qe,softVal:en}),nn&&nn.addEventListener("input",()=>{pt=parseInt(nn.value,10),zn&&(zn.textContent=pt.toString()),xe.length>pt&&(xe.length=pt)}),Je&&Je.addEventListener("input",()=>{It=parseFloat(Je.value),tn&&(tn.textContent=It.toFixed(1)),Kn()});const Jn=document.getElementById("weightPitSlider"),Qn=document.getElementById("weightPitVal");function Kn(){const t=(Lt+Vt)/2;for(let e=0;e<xe.length;e++){const n=xe[e];if(0===It)n.r=t;else{const e=.1*t,o=Math.max(1,t-e),a=t+e;n.r=Ie(o,a)}n.m=Bt}}document.getElementById("weightWeightlessSlider"),document.getElementById("weightWeightlessVal"),on&&on.addEventListener("input",()=>{st=parseFloat(on.value),Un&&(Un.textContent=st.toFixed(0)),dt()}),an&&an.addEventListener("input",()=>{lt=parseFloat(an.value),On&&(On.textContent=lt.toFixed(0))}),sn&&sn.addEventListener("input",()=>{it=parseFloat(sn.value),Xn&&(Xn.textContent=it.toFixed(0))}),ln&&ln.addEventListener("input",()=>{rt=parseFloat(ln.value),Nn&&(Nn.textContent=rt.toFixed(0))}),rn&&rn.addEventListener("input",()=>{Yt=parseFloat(rn.value),Dn&&(Dn.textContent=Yt.toFixed(0)),Zt=Zt||Wt>0&&Yt>0}),dn&&dn.addEventListener("input",()=>{var t;t=dn.value,Wt=24e3*Math.pow(2,12*(Math.max(0,Math.min(te,+t))/te-.5)),Yn&&(Yn.textContent=Math.round(Wt).toString()),Fa&&"off"!==Fa.value&&(Zt=Wt>0&&Yt>0)}),hn&&hn.addEventListener("input",()=>{Ht=parseFloat(hn.value),Wn&&(Wn.textContent=Ht.toFixed(1))});const to=document.getElementById("performanceModeToggle");document.getElementById("performanceModeStatus"),to&&to.addEventListener("change",()=>{!function(){$=!$,Z=$?120:60;const t=$?ot.performance:ot.normal;$?(xe.length>t.maxBalls&&(xe.length=t.maxBalls,t.maxBalls),pt=t.maxBalls,ge=t.collisionIters):(pt=t.maxBalls,ge=t.collisionIters),function(){const t=document.getElementById("performanceModeToggle"),e=document.getElementById("performanceModeStatus"),n=document.getElementById("maxBallsSlider"),o=document.getElementById("maxBallsVal");t&&(t.checked=$),e&&($?(e.textContent=`‚ö° 120 FPS Mode Active (${xe.length} balls)`,e.style.background="rgba(255,165,0,0.3)"):(e.textContent=`üé® Normal Mode (${xe.length} balls)`,e.style.background="rgba(0,0,0,0.2)")),n&&o&&(n.value=pt,o.textContent=pt.toString())}()}()});const eo=document.getElementById("darkModeToggle");document.getElementById("darkModeStatus"),eo&&eo.addEventListener("change",()=>{Q=!Q,Q?nt():et(!1),Kt()});const no=document.getElementById("canvasShadowEnabled"),oo=document.getElementById("shadowOffsetX"),ao=document.getElementById("shadowOffsetXVal"),io=document.getElementById("shadowOffsetY"),so=document.getElementById("shadowOffsetYVal"),lo=document.getElementById("shadowBlur"),ro=document.getElementById("shadowBlurVal"),ho=document.getElementById("shadowOpacity"),co=document.getElementById("shadowOpacityVal"),uo=document.getElementById("shadowColor"),mo=document.getElementById("shadowColorVal"),go=document.getElementById("shadow2Enabled"),yo=document.getElementById("shadow2Blur"),po=document.getElementById("shadow2BlurVal"),xo=document.getElementById("shadow2Opacity"),vo=document.getElementById("shadow2OpacityVal");no&&no.addEventListener("change",()=>{T=no.checked,_(),Kt()}),oo&&oo.addEventListener("input",()=>{F=parseFloat(oo.value),ao&&(ao.textContent=F.toFixed(1)),_(),Kt()}),io&&io.addEventListener("input",()=>{R=parseFloat(io.value),so&&(so.textContent=R.toFixed(1)),_(),Kt()}),lo&&lo.addEventListener("input",()=>{P=parseFloat(lo.value),ro&&(ro.textContent=P.toFixed(1)),_(),Kt()}),ho&&ho.addEventListener("input",()=>{A=parseFloat(ho.value),co&&(co.textContent=A.toFixed(2)),_(),Kt()}),uo&&uo.addEventListener("input",()=>{q=uo.value,mo&&(mo.textContent=q.toUpperCase()),_(),Kt()}),go&&go.addEventListener("change",()=>{k=go.checked,_(),Kt()}),yo&&yo.addEventListener("input",()=>{G=parseInt(yo.value,10),po&&(po.textContent=G.toString()),_(),Kt()}),xo&&xo.addEventListener("input",()=>{z=parseFloat(xo.value),vo&&(vo.textContent=z.toFixed(2)),_(),Kt()}),D.addEventListener("mouseleave",()=>{jt=U,_t=U,$t=!1}),cn&&cn.addEventListener("change",()=>{Ot(cn.value)});const fo=Array.from(document.querySelectorAll(".mode-button")),Eo=document.getElementById("pitControls"),Io=document.getElementById("fliesControls"),Mo=document.getElementById("weightlessControls"),So=document.getElementById("gravityPitSlider"),Bo=document.getElementById("gravityPitVal"),bo=document.getElementById("repellerEnabledPit"),Co=document.getElementById("attractPowerSlider"),wo=document.getElementById("attractPowerVal"),Lo=document.getElementById("orbitRadiusSlider"),Vo=document.getElementById("orbitRadiusVal"),To=document.getElementById("swarmSpeedSlider"),Fo=document.getElementById("swarmSpeedVal"),Ro=document.getElementById("weightlessCountSlider"),Po=document.getElementById("weightlessCountVal"),Ao=document.getElementById("weightlessSpeedSlider"),qo=document.getElementById("weightlessSpeedVal"),ko=document.getElementById("weightlessBounceSlider"),Go=document.getElementById("weightlessBounceVal"),zo=document.getElementById("weightlessRepelSlider"),Uo=document.getElementById("weightlessRepelVal"),Oo=document.getElementById("weightlessRepelRadiusSlider"),Xo=document.getElementById("weightlessRepelRadiusVal");function No(){xe.length=0;const t=r,e=D.width,n=D.height,o=40*j;for(let a=0;a<t;a++){const t=Me(o+Math.random()*(e-2*o),o+Math.random()*(n-2*o)),a=Math.random()*Math.PI*2,i=d*(.7+.3*Math.random());t.vx=Math.cos(a)*i,t.vy=Math.sin(a)*i,t.driftAx=0,t.driftTime=0}}let Do=0,Yo=0,Wo=0,Ho=0,jo=0;function _o(){const t=D.width,e=D.height;Wo=m,Do=t/Wo,Yo=Math.floor(e/Do),Ho=(t-Wo*Do)/2,jo=(e-Yo*Do)/2}function $o(t,e){return{x:Ho+(t+.5)*Do,y:jo+(e+.5)*Do}}function Zo(t,e){for(const n of ve){const o=n.x-t.x,a=n.y-t.y,i=o*o+a*a,s=Math.sqrt(i);if(s<5)continue;const l=o/s,r=a/s,d=n.strength/i*e*.6,h=1.2*n.strength/s*e,c=1-Math.min(s/600,.5);t.vx+=l*d+-r*h*(.8+.4*c),t.vy+=r*d+l*h*(.8+.4*c);const u=.997;t.vx*=u,t.vy*=u}0!==w&&(t.vx*=1-w,t.vy*=1-w)}function Jo(){xe.length=0,function(){ve=[],fe=[];const t={x:D.width/2,y:D.height/2,strength:B,isPermanent:!0};ve.push(t),fe.push(t)}();const t=D.width,e=D.height,n=t/2,o=e/2,a=.2*Math.min(t,e),i=.45*Math.min(t,e);for(let s=0;s<b;s++){const t=2*Math.PI*s/b+.5*(Math.random()-.5),e=a+Math.random()*(i-a),l=n+Math.cos(t)*e,r=o+Math.sin(t)*e,d=C*(.8+.4*Math.random()),h=-Math.sin(t)*d,c=Math.cos(t)*d,u=(Lt+Vt)/2*(.9+.2*Math.random()),m=Dt(),g=new pe(l,r,u,m);g.vx=h,g.vy=c,xe.push(g)}se(`üåÄ Vortex scene initialized: ${b} balls in orbital ring`)}function Qo(){xe.length=0,_o();const t=Math.min(E,Wo*Yo),e=[];for(let n=0;n<Yo;n++)for(let t=0;t<Wo;t++)e.push({gridX:t,gridY:n});for(let n=e.length-1;n>0;n--){const t=Math.floor(Math.random()*(n+1));[e[n],e[t]]=[e[t],e[n]]}for(let n=0;n<t;n++){const t=e[n],o=$o(t.gridX,t.gridY),a=Me(o.x,o.y);a.gridX=t.gridX,a.gridY=t.gridY,a.targetX=o.x,a.targetY=o.y,a.jumpProgress=1,a.vx=0,a.vy=0,a.driftAx=0,a.driftTime=0;const i=g,s=p*Math.random()*i;a.nextJumpTime=i+s}}function Ko(n){e=n,function(t){const e=document.getElementById("announcer");e&&(e.textContent="",setTimeout(()=>e.textContent=t,100))}(`Switched to ${{[t.PIT]:"Ball Pit",[t.FLIES]:"Flies to Light",[t.WEIGHTLESS]:"Zero Gravity",[t.PULSE_GRID]:"Pulse Grid",[t.VORTEX]:"Vortex Spiral"}[n]} mode`),Y.className="",e===t.PIT&&Y.classList.add("mode-pit"),Q?et(tt()):K&&Y.classList.add("dark-mode"),dt(),e===t.PIT?(ct=o,ut=ht*ct,Zt=a&&Wt>0&&Yt>0,Rt=!1,Pa("rubberHeavy"),xe.length=0,Se=0,function(){xe.length=0;const t=pt,e=(D.width,D.clientHeight),n=st/100*e*j,o=n+rt/100*e*j,a=lt/100*D.clientWidth,i=it/100*D.clientWidth-a/2;for(let s=0;s<t;s++){const t=Me((i+Math.random()*a)*j,n+Math.random()*(o-n));t.vx=100*(Math.random()-.5),t.vy=50*Math.random(),t.driftAx=0,t.driftTime=0}}(),Te()):e===t.FLIES?(ct=0,ut=ht*ct,Zt=!1,Rt=!1,function(){xe.length=0;const t=.5*D.width,e=.5*D.height,n=150*j;for(let o=0;o<60;o++){const o=Math.random()*Math.PI*2,a=Math.random()*n,i=Me(t+Math.cos(o)*a,e+Math.sin(o)*a),s=.5+.5*Math.random(),l=Math.random()*Math.PI*2,r=300*s;i.vx=Math.cos(l)*r,i.vy=Math.sin(l)*r,i.driftAx=0,i.driftTime=0}}(),Te()):e===t.WEIGHTLESS?(ct=0,ut=ht*ct,Zt=!1,Rt=!1,No(),Te()):e===t.PULSE_GRID?(ct=0,ut=ht*ct,Zt=!1,Rt=!1,Qo(),Te()):e===t.VORTEX&&(ct=0,ut=ht*ct,Zt=!1,Rt=!1,Jo(),Te()),function(){const n=document.getElementById("pulseGridControls"),o=document.getElementById("vortexControls");Eo&&Eo.classList.toggle("active",e===t.PIT),Io&&Io.classList.toggle("active",e===t.FLIES),Mo&&Mo.classList.toggle("active",e===t.WEIGHTLESS),n&&n.classList.toggle("active",e===t.PULSE_GRID),o&&o.classList.toggle("active",e===t.VORTEX),fo.forEach(t=>{const n=t.getAttribute("data-mode")===e;t.classList.toggle("active",n),t.setAttribute("aria-pressed",n?"true":"false")})}()}const ta=document.getElementById("resetBtn");ta&&ta.addEventListener("click",()=>{confirm("Reset all settings to defaults? This will reload the page with default values.")&&(se("üîÑ Reloading with defaults..."),location.reload())}),fo.forEach(t=>t.addEventListener("click",()=>{Ko(t.getAttribute("data-mode")),Kt()})),So&&So.addEventListener("input",()=>{o=parseFloat(So.value),Bo&&(Bo.textContent=o.toFixed(1)),Kt(),e===t.PIT&&(ct=o,ut=ht*ct)}),Jn&&Jn.addEventListener("input",()=>{Bt=parseFloat(Jn.value),Qn&&(Qn.textContent=Bt.toFixed(2));for(let t=0;t<xe.length;t++)xe[t].m=Bt;wt(),Kt()}),bo&&bo.addEventListener("change",()=>{a=!!bo.checked,e===t.PIT&&(Zt=a&&Wt>0&&Yt>0)}),Co&&Co.addEventListener("input",()=>{i=parseFloat(Co.value),wo&&(wo.textContent=Math.round(i).toString())}),Lo&&Lo.addEventListener("input",()=>{s=parseFloat(Lo.value),Vo&&(Vo.textContent=Math.round(s).toString())}),To&&To.addEventListener("input",()=>{l=parseFloat(To.value),Fo&&(Fo.textContent=l.toFixed(1))}),Ro&&Ro.addEventListener("input",()=>{r=parseInt(Ro.value,10),Po&&(Po.textContent=r.toString()),e===t.WEIGHTLESS&&No()}),Ao&&Ao.addEventListener("input",()=>{d=parseFloat(Ao.value),qo&&(qo.textContent=Math.round(d).toString())}),ko&&ko.addEventListener("input",()=>{h=parseFloat(ko.value),Go&&(Go.textContent=h.toFixed(2))}),zo&&zo.addEventListener("input",()=>{c=parseFloat(zo.value),Uo&&(Uo.textContent=Math.round(c).toString()),Kt()}),Oo&&Oo.addEventListener("input",()=>{u=parseFloat(Oo.value),Xo&&(Xo.textContent=Math.round(u).toString()),Kt()});const ea=document.getElementById("gridPresetSelect"),na=document.getElementById("gridBallCountSlider"),oa=document.getElementById("gridBallCountVal"),aa=document.getElementById("gridColumnsSlider"),ia=document.getElementById("gridColumnsVal"),sa=document.getElementById("pulseIntervalSlider"),la=document.getElementById("pulseIntervalVal"),ra=document.getElementById("pulseSpeedSlider"),da=document.getElementById("pulseSpeedVal"),ha=document.getElementById("pulseMinStepsSlider"),ca=document.getElementById("pulseMinStepsVal"),ua=document.getElementById("pulseMaxStepsSlider"),ma=document.getElementById("pulseMaxStepsVal"),ga=document.getElementById("pulseSynchronicitySlider"),ya=document.getElementById("pulseSynchronicityVal"),pa=document.getElementById("pulseRandomnessSlider"),xa=document.getElementById("pulseRandomnessVal"),va={synchronized:{interval:.6,speed:.2,minSteps:1,maxSteps:2,synchronicity:.1,randomness:.2,easingStyle:"snap",overshoot:1.12,bounce:.18},organic:{interval:.8,speed:.25,minSteps:1,maxSteps:3,synchronicity:.3,randomness:.4,easingStyle:"smooth",overshoot:1.05,bounce:.1},chaotic:{interval:.4,speed:.15,minSteps:2,maxSteps:4,synchronicity:.7,randomness:.8,easingStyle:"bounce",overshoot:1.15,bounce:.25}};ea&&ea.addEventListener("change",()=>{!function(n){const o=va[n];if(!o)return;g=o.interval,y=o.speed,v=o.minSteps,f=o.maxSteps,p=o.synchronicity,x=o.randomness,M=o.easingStyle,S=o.overshoot,I=o.bounce,sa&&(sa.value=o.interval),la&&(la.textContent=o.interval.toFixed(1)),ra&&(ra.value=o.speed),da&&(da.textContent=o.speed.toFixed(2)),ha&&(ha.value=o.minSteps),ca&&(ca.textContent=o.minSteps.toString()),ua&&(ua.value=o.maxSteps),ma&&(ma.textContent=o.maxSteps.toString()),ga&&(ga.value=o.synchronicity),ya&&(ya.textContent=o.synchronicity.toFixed(2)),pa&&(pa.value=o.randomness),xa&&(xa.textContent=o.randomness.toFixed(2));const a=document.getElementById("pulseEasingSelect"),i=document.getElementById("pulseOvershootSlider"),s=document.getElementById("pulseOvershootVal"),l=document.getElementById("pulseBounceSlider"),r=document.getElementById("pulseBounceVal");a&&(a.value=o.easingStyle),i&&(i.value=o.overshoot),s&&(s.textContent=o.overshoot.toFixed(2)),l&&(l.value=o.bounce),r&&(r.textContent=o.bounce.toFixed(2)),e===t.PULSE_GRID&&Qo()}(ea.value),Kt()}),na&&na.addEventListener("input",()=>{E=parseInt(na.value,10),oa&&(oa.textContent=E.toString()),e===t.PULSE_GRID&&Qo(),Kt()}),aa&&aa.addEventListener("input",()=>{m=parseInt(aa.value,10),ia&&(ia.textContent=m.toString()),e===t.PULSE_GRID&&(_o(),Qo()),Kt()}),sa&&sa.addEventListener("input",()=>{g=parseFloat(sa.value),la&&(la.textContent=g.toFixed(1)),Kt()}),ra&&ra.addEventListener("input",()=>{y=parseFloat(ra.value),da&&(da.textContent=y.toFixed(2)),Kt()}),ha&&ha.addEventListener("input",()=>{v=parseInt(ha.value,10),ca&&(ca.textContent=v.toString()),v>f&&(f=v,ua&&(ua.value=v),ma&&(ma.textContent=v.toString())),Kt()}),ua&&ua.addEventListener("input",()=>{f=parseInt(ua.value,10),ma&&(ma.textContent=f.toString()),f<v&&(v=f,ha&&(ha.value=f),ca&&(ca.textContent=f.toString())),Kt()}),ga&&ga.addEventListener("input",()=>{p=parseFloat(ga.value),ya&&(ya.textContent=p.toFixed(2)),Kt()}),pa&&pa.addEventListener("input",()=>{x=parseFloat(pa.value),xa&&(xa.textContent=x.toFixed(2)),Kt()});const fa=document.getElementById("pulseEasingSelect"),Ea=document.getElementById("pulseOvershootSlider"),Ia=document.getElementById("pulseOvershootVal"),Ma=document.getElementById("pulseBounceSlider"),Sa=document.getElementById("pulseBounceVal");function Ba(){for(let t=0;t<xe.length;t++)xe[t].color=Dt()}fa&&fa.addEventListener("change",()=>{M=fa.value,Kt()}),Ea&&Ea.addEventListener("input",()=>{S=parseFloat(Ea.value),Ia&&(Ia.textContent=S.toFixed(2)),Kt()}),Ma&&Ma.addEventListener("input",()=>{I=parseFloat(Ma.value),Sa&&(Sa.textContent=I.toFixed(2)),Kt()}),un&&un.addEventListener("input",()=>{Gt[0]=un.value,In&&(In.textContent=un.value.toUpperCase()),Ba(),Xt()}),mn&&mn.addEventListener("input",()=>{Gt[1]=mn.value,Mn&&(Mn.textContent=mn.value.toUpperCase()),Ba(),Xt()}),gn&&gn.addEventListener("input",()=>{Gt[2]=gn.value,Sn&&(Sn.textContent=gn.value.toUpperCase()),Ba(),Xt()}),yn&&yn.addEventListener("input",()=>{Gt[3]=yn.value,Bn&&(Bn.textContent=yn.value.toUpperCase()),Ba(),Xt()}),pn&&pn.addEventListener("input",()=>{Gt[4]=pn.value,bn&&(bn.textContent=pn.value.toUpperCase()),Ba(),Xt()}),xn&&xn.addEventListener("input",()=>{Gt[5]=xn.value,Cn&&(Cn.textContent=xn.value.toUpperCase()),Ba(),Xt()}),vn&&vn.addEventListener("input",()=>{Gt[6]=vn.value,wn&&(wn.textContent=vn.value.toUpperCase()),Ba(),Xt()}),fn&&fn.addEventListener("input",()=>{Gt[7]=fn.value,Ln&&(Ln.textContent=fn.value.toUpperCase()),Ba(),Xt()}),En&&En.addEventListener("change",()=>{const t=Math.max(1,Math.min(8,parseInt(En.value,10)))-1;zt=t,Ut=Gt[zt]||Ut,Kt()}),Zn(In,()=>un.value.toUpperCase()),Zn(Mn,()=>mn.value.toUpperCase()),Zn(Sn,()=>gn.value.toUpperCase()),Zn(Bn,()=>yn.value.toUpperCase()),Zn(bn,()=>pn.value.toUpperCase()),Zn(Cn,()=>xn.value.toUpperCase()),Zn(wn,()=>vn.value.toUpperCase()),Zn(Ln,()=>fn.value.toUpperCase()),Vn&&Vn.addEventListener("input",()=>{ee=parseFloat(Vn.value),Tn&&(Tn.textContent=ee.toFixed(0))}),Fn&&Fn.addEventListener("input",()=>{ae=parseFloat(Fn.value),Rn&&(Rn.textContent=ae.toFixed(3))}),Pn&&Pn.addEventListener("input",()=>{ie=parseFloat(Pn.value),An&&(An.textContent=ie.toFixed(2)+"√ó")});const ba={rubberPlayground:{label:"Rubber ‚Äì Playground",G:1960,REST:.9,FRICTION:.0025,sizeScale:1.2,maxBalls:450,sizeVariation:.2},rubberRacquet:{label:"Rubber ‚Äì Racquetball",G:3320,REST:.97,FRICTION:.0035,sizeScale:1.2,maxBalls:350,sizeVariation:.3},rubberSuperball:{label:"Rubber ‚Äì Superball",G:1960,REST:.95,FRICTION:.0015,sizeScale:1.2,maxBalls:450,sizeVariation:.05},rubberSoft:{label:"Rubber ‚Äì Soft",G:1960,REST:.86,FRICTION:.0035,sizeScale:1.2,maxBalls:350,sizeVariation:.25},rubberHeavy:{label:"Rubber ‚Äì Heavy",G:1960,REST:.88,FRICTION:.003,sizeScale:1.2,maxBalls:400,sizeVariation:.15}},Ca={fullRain:{label:"Full Rain (top-half)",EMIT_INTERVAL:.03,xCenter:50,y:-50,w:100,h:50},narrowStrip:{label:"Narrow Strip Top",EMIT_INTERVAL:.05,xCenter:50,y:-40,w:20,h:10},leftGutter:{label:"Left Gutter",EMIT_INTERVAL:.045,xCenter:10,y:-60,w:18,h:20},rightGutter:{label:"Right Gutter",EMIT_INTERVAL:.045,xCenter:90,y:-60,w:18,h:20},centerFountain:{label:"Center Fountain",EMIT_INTERVAL:.02,xCenter:50,y:-30,w:30,h:20},stormBurst:{label:"Storm Burst",EMIT_INTERVAL:.005,xCenter:50,y:-80,w:100,h:30},slowSnow:{label:"Slow Snow",EMIT_INTERVAL:.2,xCenter:50,y:-30,w:100,h:20},edgeDrizzle:{label:"Edge Drizzle",EMIT_INTERVAL:.08,xCenter:15,y:-40,w:30,h:15},twinColumns:{label:"Twin Columns",EMIT_INTERVAL:.03,xCenter:30,y:-50,w:10,h:40},focusedBeam:{label:"Focused Beam",EMIT_INTERVAL:.015,xCenter:50,y:-70,w:6,h:12}},wa={off:{label:"Off",r:710,p:274e3,s:4.4},gentle:{label:"Gentle Breeze",r:120,p:2500,s:2.5},pushField:{label:"Push Field",r:240,p:8e4,s:2},tractor:{label:"Tractor Push",r:320,p:14e4,s:1.6},magnet:{label:"Magnet Repel",r:200,p:18e4,s:3},pulse:{label:"Pulse Strong",r:280,p:22e4,s:1.2},wideSoft:{label:"Wide Soft",r:500,p:8e4,s:4.5},needle:{label:"Needle Point",r:80,p:26e4,s:.8},wall:{label:"Invisible Wall",r:700,p:16e4,s:5},singularity:{label:"Singularity",r:600,p:3e5,s:.5}};function La(t,e,n){t.innerHTML="";for(const[o,a]of Object.entries(e)){const e=document.createElement("option");e.value=o,e.textContent=a.label||o,o===n&&(e.selected=!0),t.appendChild(e)}}const Va=document.getElementById("physicsSelect"),Ta=document.getElementById("spawnSelect"),Fa=document.getElementById("repellerSelect");function Ra(t,e,n,o=0){t&&(t.value=n+""),e&&(e.textContent=o>0?n.toFixed(o):n.toString())}function Pa(t){const e=ba[t];if(!e)return;mt=e.REST,gt=e.FRICTION,pt=e.maxBalls,It=e.sizeVariation;const n=e.sizeScale;Et=n,Tt();for(let o=0;o<xe.length;o++)xe[o].m=Bt;xe.length>pt&&(xe.length=pt),Ra(je,qn,mt,2),Ra(_e,kn,gt,4),Ra(Ze,Ke,Et,1),Ra(nn,zn,pt,0),Ra(Je,tn,It,1),Kn()}function Aa(t){const e=Ca[t];e&&(yt=e.EMIT_INTERVAL,it=e.xCenter,st=e.y,lt=e.w,rt=e.h,Ra($e,Gn,yt,3),Ra(sn,Xn,it,0),Ra(on,Un,st,0),Ra(an,On,lt,0),Ra(ln,Nn,rt,0))}function qa(t){const e=wa[t];if(!e)return;Yt=e.r,Wt=1*e.p,Zt="off"!==t,Ra(rn,Dn,Yt,0);const n=function(t){const e=.5+Math.log2(Math.max(1,+t)/24e3)/12;return Math.round(Math.max(0,Math.min(1,e))*te)}(Wt);dn&&(dn.value=n+""),Yn&&(Yn.textContent=Math.round(Wt).toString()),Ra(hn,Wn,Ht,1)}Va&&La(Va,ba,"rubberRacquet"),Ta&&La(Ta,Ca,"fullRain"),Fa&&La(Fa,wa,"off"),cn&&La(cn,qt,"industrialTeal"),Pa("rubberHeavy"),Aa("fullRain"),qa("off"),se("‚ö†Ô∏è localStorage is disabled - using defaults"),J="determining_mode",K=!!Q&&tt(),K?Y.classList.add("dark-mode"):Y.classList.remove("dark-mode"),Y.classList.toString(),Ot(kt);const ka=setInterval(nt,6e4);window.addEventListener("unload",()=>{ka&&clearInterval(ka)}),Va&&Va.addEventListener("change",()=>Pa(Va.value)),Ta&&Ta.addEventListener("change",()=>Aa(Ta.value)),Fa&&Fa.addEventListener("change",()=>qa(Fa.value)),Tt(),Ft(),_();{const Wa=Object.values(t),Ha=Wa[Math.floor(Math.random()*Wa.length)];e=Ha}Ko(e),window.addEventListener("beforeunload",Qt)})();