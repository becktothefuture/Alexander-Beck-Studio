(()=>{const t="pit",e="flies",n="weightless",o="pulse-grid";let a=t,s=40,i=1.15,l=!0,r=5e3,d=180,u=3.5,h=80,c=250,m=.97,g=300,p=150,y=40,f=.8,v=.25,x=.3,E=.4,I=1,M=3,B=120,S=.15,b="snap",w=1.08,C=!1,L=0,V=4,F=12,R=.15,T="#000000",P=!1,A=4,q=.1;const z=-1e9,k=1e-4,O=.25;function N(){return 0===s?0:s/40*.2}const Y=document.getElementById("c"),X=document.getElementById("bravia-balls");let G;try{if(G=Y.getContext("2d",{alpha:!0}),!G)throw new Error("Canvas 2D context not available")}catch(pa){throw console.error("‚ùå Failed to initialize canvas:",pa),X.innerHTML='\n      <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #1a1a1a; color: white; font-family: system-ui, -apple-system, sans-serif;">\n        <div style="text-align: center; padding: 40px; background: rgba(255,50,50,0.1); border: 2px solid rgba(255,50,50,0.3); border-radius: 12px; max-width: 480px;">\n          <div style="font-size: 72px; margin-bottom: 20px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));">‚ö†Ô∏è</div>\n          <h2 style="margin: 0 0 16px 0; font-size: 24px; font-weight: 600;">Canvas Not Supported</h2>\n          <p style="margin: 0 0 12px 0; opacity: 0.9; line-height: 1.6; font-size: 15px;">Your browser doesn\'t support the HTML5 Canvas 2D features required for this interactive simulation.</p>\n          <p style="margin: 0; opacity: 0.7; font-size: 13px;">Please try a modern browser like Chrome, Firefox, Safari, or Edge.</p>\n        </div>\n      </div>\n    ',pa}const U=document.getElementById("controlPanel"),D=Math.max(1,Math.min(2,window.devicePixelRatio||1));function $(){if(!C)return void(Y.style.filter="none");const t=(t,e)=>`rgba(${parseInt(t.slice(1,3),16)}, ${parseInt(t.slice(3,5),16)}, ${parseInt(t.slice(5,7),16)}, ${e})`,e=`drop-shadow(${L}px ${V}px ${F}px ${t(T,R)})`,n=P?` drop-shadow(${L}px ${Math.round(.5*V)}px ${A}px ${t(T,q)})`:"";Y.style.filter=e+n}let j=!1,H=60,W=!0,_=!1;function Z(t){_=t;const e=document.documentElement,n=document.body;t?(e.classList.add("dark-mode"),n.classList.add("dark-mode")):(e.classList.remove("dark-mode"),n.classList.remove("dark-mode")),qt(Rt),function(){const t=document.getElementById("darkModeToggle"),e=document.getElementById("darkModeStatus");if(t&&(t.checked=W),e){const t=new Date,n=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`;_?(e.textContent=`üåô Night Mode (${n})`,e.style.background="rgba(100,100,255,0.3)"):(e.textContent=`‚òÄÔ∏è Day Mode (${n})`,e.style.background="rgba(255,200,0,0.3)")}}()}function J(){W&&Z(function(){const t=(new Date).getHours();return t>=18||t<6}())}const Q={normal:{maxBalls:350,collisionIters:2,adaptiveQualityMin:.5},performance:{maxBalls:200,collisionIters:1,adaptiveQualityMin:.3}};let K,tt=50,et=-50,nt=100,ot=50;function at(){const e=a===t?1.5:1,n=window.innerHeight*e;if(Y.width=Math.floor(window.innerWidth*D),Y.height=Math.floor(n*D),a===o){Vo();for(let t=0;t<he.length;t++){const e=he[t];e.gridX=Math.max(0,Math.min(wo-1,e.gridX)),e.gridY=Math.max(0,Math.min(bo-1,e.gridY));const n=Fo(e.gridX,e.gridY);e.x=n.x,e.y=n.y,e.targetX=n.x,e.targetY=n.y}}}at(),window.addEventListener("resize",function(){clearTimeout(K),K=setTimeout(()=>{at(),bt(),wt()},150)});const st=1960;let it=1.1,lt=st*it,rt=.88,dt=.003,ut=.03,ht=400;const ct=.5*D,mt=6,gt=24;let pt=1,yt=.15,ft=1,vt=null,xt=11.2;const Et=.15;let It=1;function Mt(){It=Math.max(.5,Math.min(3,Math.pow(xt/1,.35)))}Mt();let Bt=mt*pt,St=gt*pt;function bt(){ft=(Y.clientWidth||window.innerWidth)<=768?.4:1;const t=pt*ft;if(null===vt)return vt=t,Bt=mt*t,void(St=gt*t);const e=t/vt;if(1!==e){for(let t=0;t<he.length;t++)he[t].r*=e;vt=t}Bt=mt*t,St=gt*t}function wt(){Qt=[];const t=document.querySelector(Jt);if(!t)return;const e=t.getBoundingClientRect(),n=Y.getBoundingClientRect(),o=function(t){const e=document.createElement("span");e.style.cssText=window.getComputedStyle(t).cssText,e.style.position="absolute",e.style.visibility="hidden",e.style.whiteSpace="nowrap",e.textContent="ABCDEFGHIJKLMNOPQRSTUVWXYZ",document.body.appendChild(e);const n=e.getBoundingClientRect().height;return document.body.removeChild(e),n}(t),a=.5*(e.height-o),s={x:(e.left-n.left)*D,y:(e.top-n.top+a)*D,width:e.width*D,height:o*D};s.width>0&&s.height>0&&s.x<Y.width&&s.y<Y.height&&s.x+s.width>0&&s.y+s.height>0&&Qt.push(s)}let Ct=!0,Lt=0,Vt=1;const Ft={industrialTeal:{label:"Industrial Teal",light:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#2a2a2a","#1a1a1a","#404040","#00a88f","#e0e0e0","#ff6b47","#3b7de0","#ffc04d"]},sunsetCoral:{label:"Sunset Coral",light:["#bdbbb8","#e8e6e3","#ffffff","#ff3b3b","#000000","#00f5d4","#1e40af","#fb923c"],dark:["#2b2a28","#1c1b1a","#3d3d3d","#ff5c5c","#dddddd","#00ffe7","#4169e1","#ffa866"]},violetPunch:{label:"Violet Punch",light:["#b8b7c2","#e6e5ed","#ffffff","#9333ea","#000000","#dc2626","#0ea5e9","#facc15"],dark:["#2a2832","#1a1921","#3e3d47","#b24dff","#e0e0e0","#ff4444","#00d4ff","#ffe34d"]},citrusBlast:{label:"Citrus Blast",light:["#bfbdb5","#eae8df","#ffffff","#ea580c","#000000","#e11d48","#2563eb","#059669"],dark:["#2c2b27","#1d1c19","#3f3e3a","#ff7733","#dddddd","#ff4466","#4d8aff","#00bf7f"]},cobaltSpark:{label:"Cobalt Spark",light:["#b5b8be","#e3e6eb","#ffffff","#1d4ed8","#000000","#ea580c","#db2777","#d97706"],dark:["#282b30","#191c20","#3d4147","#4d7aff","#dedede","#ff7f3d","#ff4d9e","#ffad33"]}};let Rt="industrialTeal",Tt=["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],Pt=5,At=Tt[Pt]||"#000000";function qt(t){Rt=t,Tt=function(t){const e=Ft[t];return e?_?e.dark:e.light:Ft.industrialTeal.light}(t),At=Tt[Pt]||At,na(),zt(),oa()}function zt(t=Tt){try{const e=document.documentElement,n=(t&&t.length?t:Tt).slice(0,8);for(let t=0;t<8;t++){const o=n[t]||"#ffffff";e.style.setProperty(`--ball-${t+1}`,o)}}catch(t){}}const kt=[.5,.25,.12,.06,.03,.02,.01,.01];function Ot(){try{if(!Tt||0===Tt.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let e=0;for(let n=0;n<Math.min(Tt.length,kt.length);n++)if(e+=kt[n],t<=e)return Tt[n];return Tt[Math.min(Tt.length-1,7)]}catch(t){return console.error("Error picking random color:",t),"#ffffff"}}let Nt=255,Yt=274e3,Xt=4.4,Gt=z,Ut=z,Dt=!1,$t=!1;("ontouchstart"in window||navigator.maxTouchPoints>0)&&($t=!0);const jt="bouncyBallsSettings";function Ht(){const t={currentMode:a,gravityMultiplierPit:i,repellerEnabledPit:l,attractionPower:r,orbitRadius:d,swarmSpeed:u,weightlessInitialSpeed:c,weightlessBounce:m,weightlessCount:h,weightlessRepellerPower:g,weightlessRepellerRadius:p,restitution:rt,friction:dt,sizeScale:pt,sizeVariation:yt,ballMassKg:xt,ballSoftness:s,repelPower:Yt,repelRadius:Nt,repelSoft:Xt,cornerRadius:Zt,motionBlur:trailFade,trailSubtlety:te,currentTemplate:Rt,cursorBallColor:At,gridColumns:y,gridBallCount:B,pulseInterval:f,pulseSpeed:v,pulseSynchronicity:x,pulseRandomness:E,pulseMinSteps:I,pulseMaxSteps:M,pulseEasingStyle:b,pulseOvershoot:w,pulseBounceIntensity:S,canvasShadowEnabled:C,shadowOffsetX:L,shadowOffsetY:V,shadowBlur:F,shadowOpacity:R,shadowColor:T,shadow2Enabled:P,shadow2Blur:A,shadow2Opacity:q,autoDarkModeEnabled:W};try{localStorage.setItem(jt,JSON.stringify(t)),console.log("‚úì Settings saved")}catch(t){console.warn("Could not save settings:",t)}}function Wt(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(Ht,500)}const _t=1e4;let Zt=0;const Jt="#hero-text";let Qt=[],Kt=.025,te=1.8,ee=0,ne=0,oe=0,ae=0,se=0;const ie=document.getElementById("render-fps"),le=document.getElementById("physics-fps");let re=2,de=0;class ue{constructor(t,e,n,o){this.x=t,this.y=e,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=n,this.rBase=n,this.m=xt,this.color=o,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1}step(o){this.t+=o,this.age+=o,a!==n&&(this.vy+=lt*It*o);const s=Math.max(.25,this.m/1),i=a===n?1e-4:dt,l=Math.max(0,1-i/s);this.vx*=l,this.vy*=l,0!==this.driftAx&&this.age<this.driftTime?this.vx+=this.driftAx*o/s:0!==this.driftAx&&(this.driftAx=0),function(o,s){a!==t?a!==e?a!==n||function(t,e){if(Gt===z||Ut===z)return;if(g<=0||p<=0)return;const n=p*D,o=t.x-Gt,a=t.y-Ut,s=o*o+a*a;if(s>n*n)return;const i=Math.max(Math.sqrt(s),k),l=o/i,r=a/i,d=Math.max(0,1-i/n),u=g*d;t.vx+=l*u*e,t.vy+=r*u*e}(o,s):function(t,e){const n=Gt===z?.5*Y.width:Gt,o=Ut===z?.5*Y.height:Ut,a=n-t.x,s=o-t.y,i=a*a+s*s,l=Math.sqrt(i+1),d=a/l,h=s/l,c=r*u*2;t.vx+=d*c*e,t.vy+=h*c*e;const m=120*D;let g=0,p=0,y=0;for(let e=0;e<he.length;e++){const n=he[e];if(n===t)continue;const o=t.x-n.x,a=t.y-n.y,s=o*o+a*a;if(s<m*m&&s>0){const t=Math.sqrt(s),e=1-t/m;g+=o/t*e,p+=a/t*e,y++}}if(y>0){const n=15e3;t.vx+=g/y*n*e,t.vy+=p/y*n*e}const f=2500*u;if(Math.random()<.08){const e=Math.random()*Math.PI*2,n=1500*u;t.vx+=Math.cos(e)*n,t.vy+=Math.sin(e)*n}t.vx+=(Math.random()-.5)*f*e,t.vy+=(Math.random()-.5)*f*e;const v=.3+2*Math.random(),x=2e3*u*v*e;t.vx+=-h*x,t.vy+=d*x;const E=2200*u,I=Math.sqrt(t.vx*t.vx+t.vy*t.vy);I>E&&(t.vx=t.vx/I*E,t.vy=t.vy/I*E),t.vx*=.995,t.vy*=.995}(o,s):function(t,e){if(!Dt)return;if(Yt<=0||Nt<=0)return;const n=Nt*D,o=t.x-Gt,a=t.y-Ut,s=o*o+a*a;if(s>n*n)return;const i=Math.max(Math.sqrt(s),k),l=o/i,r=a/i,d=Math.max(0,1-i/n),u=20*Yt*Math.pow(d,Xt),h=Math.max(.25,t.m/1);t.vx+=l*u*e/h,t.vy+=r*u*e/h;t.vx+=10*(Math.random()-.5)*e,t.vy+=10*(Math.random()-.5)*e}(o,s)}(this,o),this.x+=this.vx*o,this.y+=this.vy*o;const d=Math.max(0,1-2*o);this.omega*=d,this.theta+=this.omega*o,this.theta>Math.PI?this.theta-=2*Math.PI:this.theta<-Math.PI&&(this.theta+=2*Math.PI);const h=Math.min(1,18*o);this.squashAmount+=(0-this.squashAmount)*h,this.squash=1-this.squashAmount}walls(e,n,o,s=rt){const i=s;if(0===Zt){if(this.y+this.r>n){this.y=n-this.r;const t=this.vy,e=this.vx-this.omega*this.r,a=Math.max(.25,this.m/1);this.omega+=e/this.r*O/a;const s=Math.max(0,1-1.5*o/a);this.vx*=s;const l=Math.abs(t)<70?0:i;this.vy=-this.vy*(l*Math.pow(1/this.m,Et));const r=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(N(),.8*r),this.squash=1-this.squashAmount,this.squashNormalAngle=-Math.PI/2;const d=this.vx/this.r;this.omega+=(d-this.omega)*Math.min(1,8*o)}const s=a===t?n/3:0;if(this.y-this.r<s){this.y=s+this.r;const t=this.vy;this.vy=-this.vy*i;const e=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(N(),.8*e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI/2}if(this.x+this.r>e){this.x=e-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*i;const t=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(N(),.8*t),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*i;const t=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(N(),.8*t),this.squash=1-this.squashAmount,this.squashNormalAngle=0}}else this.handleRoundedWallCollision(e,n);this.checkTextCollisions(o)}checkTextCollisions(t){for(let t=0;t<Qt.length;t++){const e=Qt[t],n=Math.max(e.x,Math.min(this.x,e.x+e.width)),o=Math.max(e.y,Math.min(this.y,e.y+e.height)),a=this.x-n,s=this.y-o,i=Math.sqrt(a*a+s*s);if(i<this.r)if(0===i){const t=this.x-e.x,n=e.x+e.width-this.x,o=this.y-e.y,a=e.y+e.height-this.y,s=Math.min(t,n,o,a);s===t?(this.x=e.x-this.r,this.vx=-Math.abs(this.vx)*rt):s===n?(this.x=e.x+e.width+this.r,this.vx=Math.abs(this.vx)*rt):s===o?(this.y=e.y-this.r,this.vy=-Math.abs(this.vy)*rt):(this.y=e.y+e.height+this.r,this.vy=Math.abs(this.vy)*rt)}else{const t=this.r-i,e=a/i,n=s/i;this.x+=e*t,this.y+=n*t;const o=this.vx*e+this.vy*n;if(o<0){this.vx-=2*o*e*rt,this.vy-=2*o*n*rt;const t=Math.min(1,Math.abs(o)/(70*this.r));this.squash=1-N()*t,this.squashDirX=Math.abs(e)>Math.abs(n)?1:0,this.squashDirY=Math.abs(n)>Math.abs(e)?1:0}}}}handleRoundedWallCollision(t,e){const n=Zt,o=[{x:n,y:n},{x:t-n,y:n},{x:t-n,y:e-n},{x:n,y:e-n}];for(let a=0;a<o.length;a++){const s=o[a],i=this.x-s.x,l=this.y-s.y,r=Math.sqrt(i*i+l*l);if(this.isInCornerRegion(s,t,e,n)&&r+this.r>n){const t=n-(r-this.r);if(t>0&&r>0){const e=i/r,n=l/r;this.x+=e*t,this.y+=n*t;const o=this.vx*e+this.vy*n;this.vx-=2*o*e*rt,this.vy-=2*o*n*rt;const a=Math.min(1,Math.abs(o)/(90*this.r));this.squashAmount=Math.min(N(),.8*a),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.atan2(n,e)}}}if(this.y+this.r>e&&(this.x<n||this.x>t-n)&&(this.y=e-this.r,this.vy=-this.vy*(rt*Math.pow(1/this.m,Et))),this.y-this.r<0&&(this.x<n||this.x>t-n)&&(this.y=this.r,this.vy=-this.vy*rt),this.x+this.r>t&&(this.y<n||this.y>e-n)){this.x=t-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(rt*Math.pow(1/this.m,Et));const e=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(N(),e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0&&(this.y<n||this.y>e-n)){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(rt*Math.pow(1/this.m,Et));const t=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(N(),t),this.squash=1-this.squashAmount,this.squashNormalAngle=0}this.y+this.r>e&&this.x>=n&&this.x<=t-n&&(this.y=e-this.r,this.vy=-this.vy*(rt*Math.pow(1/this.m,Et))),this.y-this.r<0&&this.x>=n&&this.x<=t-n&&(this.y=this.r,this.vy=-this.vy*(rt*Math.pow(1/this.m,Et))),this.x+this.r>t&&this.y>=n&&this.y<=e-n&&(this.x=t-this.r,this.vx=-this.vx*(rt*Math.pow(1/this.m,Et))),this.x-this.r<0&&this.y>=n&&this.y<=e-n&&(this.x=this.r,this.vx=-this.vx*(rt*Math.pow(1/this.m,Et)))}isInCornerRegion(t,e,n,o){return t.x===o&&t.y===o?this.x<=o&&this.y<=o:t.x===e-o&&t.y===o?this.x>=e-o&&this.y<=o:t.x===e-o&&t.y===n-o?this.x>=e-o&&this.y>=n-o:t.x===o&&t.y===n-o&&this.x<=o&&this.y>=n-o}draw(t){t.save(),t.translate(this.x,this.y);const e=Math.min(N(),Math.max(0,this.squashAmount));if(this.r>15&&e>.001){const n=1+e,o=1/n;t.rotate(this.squashNormalAngle),t.scale(n,o),t.rotate(-this.squashNormalAngle)}t.beginPath(),t.arc(0,0,this.r,0,2*Math.PI),t.fillStyle=this.color,t.fill(),t.restore()}}const he=[];function ce(t,e,n){return Math.max(e,Math.min(n,t))}function me(t,e){return t+Math.random()*(e-t)}function ge(t,e,n=Ot()){const o=(Bt+St)/2;let a;if(0===yt)a=o;else{const t=.1*o;a=me(Math.max(1,o-t),o+t)}const s=new ue(t,e,a,n),i=.5*Y.width,l=Ct?Vt>=0?1:-1:t<i?1:-1,r=ce(a/(.5*(Bt+St)),.6,1.4),d=140*r,u=180*r;return s.vx=l*(d+Math.random()*u),s.vy=120*-Math.random(),s.driftAx=l*(360+420*Math.random())*r,s.driftTime=.22+.28*Math.random(),he.push(s),s}let pe=0;function ye(){const t=Y.clientWidth,e=Y.clientHeight,n=ce(nt/100*t,0,t);let o=ce(tt/100*t,0,t);if(Ct){const e=.2*t,n=o;o=ce(o+Math.sin(Lt)*e,0,t),Vt=o>=n?1:-1}const a=Math.min(40,.1*n),s=ce(o-n/2-a,-a,t),i=ce(o+n/2+a,-a,t),l=et/100*e,r=l+ot/100*e,d=Math.random();return{x:(s+(i-s)*(Vt>0?Math.pow(d,.7):1-Math.pow(1-d,.7)))*D,y:me(l*D,r*D)-(St+2+me(0,10*D))}}const fe=new Map;function ve(t=6){const e=function(){const t=he.length;if(t<2)return[];const e=Math.max(1,2*St),n=Math.ceil(Y.width/e)+1;fe.clear();for(let o=0;o<t;o++){const t=he[o],a=t.x/e|0,s=(t.y/e|0)*n+a;let i=fe.get(s);i||(i=[],fe.set(s,i)),i.push(o)}const o=[];for(const[t,e]of fe){const a=t/n|0,s=t%n;for(let t=-1;t<=1;t++)for(let i=-1;i<=1;i++){const l=(a+t)*n+(s+i),r=fe.get(l);if(r)for(let t=0;t<e.length;t++){const n=e[t];for(let t=0;t<r.length;t++){const e=r[t];if(e<=n)continue;const a=he[n],s=he[e],i=s.x-a.x,l=s.y-a.y,d=a.r+s.r,u=i*i+l*l;if(u<d*d){const t=d-Math.sqrt(Math.max(u,1e-6));o.push({i:n,j:e,overlap:t})}}}}}return o.sort((t,e)=>e.overlap-t.overlap),o}();for(let n=0;n<t;n++)for(let t=0;t<e.length;t++){const{i:n,j:o}=e[t],a=he[n],s=he[o],i=s.x-a.x,l=s.y-a.y,r=a.r+s.r,d=i*i+l*l;if(0===d||d>r*r)continue;const u=Math.sqrt(d),h=i/u,c=l/u,m=r-u,g=1/Math.max(a.m,.001),p=1/Math.max(s.m,.001),y=.8*Math.max(m-ct,0)/(g+p),f=y*h,v=y*c;a.x-=f*g,a.y-=v*g,s.x+=f*p,s.y+=v*p;const x=s.vx-a.vx,E=s.vy-a.vy,I=x*h+E*c;if(I<0){const t=-(1+(Math.abs(I)<30?0:rt))*I/(g+p),e=t*h,n=t*c;a.vx-=e*g,a.vy-=n*g,s.vx+=e*p,s.vy+=n*p;const o=x-I*h,i=E-I*c,l=Math.hypot(o,i);if(l>.001){const t=o*-c+i*h>=0?1:-1,e=.18;a.omega-=t*e*l/Math.max(a.r,1),s.omega+=t*e*l/Math.max(s.r,1)}const r=Math.min(1,Math.abs(I)/(50*(a.r+s.r))),d=Math.min(N(),.8*r);a.squashAmount=Math.max(a.squashAmount,.8*d),a.squashNormalAngle=Math.atan2(-c,-h),s.squashAmount=Math.max(s.squashAmount,.8*d),s.squashNormalAngle=Math.atan2(c,h)}}}let xe=performance.now()/1e3,Ee=0;const Ie=1/120;function Me(){const t=parseFloat(Re.value);pt=t,bt();const e=(Bt+St)/2;for(let t=0;t<he.length;t++)if(0===yt)he[t].r=e,he[t].rBase=e;else{const n=.1*e,o=Math.max(1,e-n),a=e+n;he[t].r=me(o,a),he[t].rBase=he[t].r}}console.log("High refresh mode enabled - using requestAnimationFrame"),requestAnimationFrame(function t(s){const i=s/1e3;let l=Math.min(.008,i-xe);xe=i,Ee+=l,ee++,(ie||le)&&i-oe>=1&&(ie&&ee!==ae&&(ae=ee,ie.textContent=ae.toString()),le&&ne!==se&&(se=ne,le.textContent=se.toString()),ee=0,ne=0,oe=i,function(t){t-de<2||(de=t,ae<50?(re=1,console.log("‚ö° Adaptive Quality: LOW (1 collision iter) - FPS:",ae)):ae<70?(re=2,console.log("‚ö° Adaptive Quality: MEDIUM (2 collision iters) - FPS:",ae)):(re=3,console.log("‚ö° Adaptive Quality: HIGH (3 collision iters) - FPS:",ae)))}(i)),function(t){if(a!==n&&a!==o)for(pe+=t;pe>=ut;){const t=(Math.random()-.5)*ut*.5;pe-=ut+t,Lt+=2*Math.PI*.12*(ut+t);const e=ye(),n=Math.random()<.35?3:1;for(let t=0;t<n;t++)if(he.length<ht){const n=8*t*(Math.random()<.5?1:-1);ge(e.x+n,e.y-12*t)}}}(l),a===o&&function(t){for(let e=0;e<he.length;e++){const n=he[e];if(n.nextJumpTime-=t,n.nextJumpTime<=0&&n.jumpProgress>=1){const t=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}],e=t[Math.floor(Math.random()*t.length)],o=M-I+1,a=I+Math.floor(Math.random()*o),s=Math.max(1,Math.round(a*(1-.5*E+E*Math.random())));let i=n.gridX+e.dx*s,l=n.gridY+e.dy*s;i=Math.max(0,Math.min(wo-1,i)),l=Math.max(0,Math.min(bo-1,l)),n.gridX=i,n.gridY=l;const r=Fo(i,l);n.targetX=r.x,n.targetY=r.y,n.jumpProgress=0,n.jumpStartX=n.x,n.jumpStartY=n.y;const d=E*f*(Math.random()-.5),u=x*f*Math.random();n.nextJumpTime=f+d+u}if(n.jumpProgress<1)if(n.jumpProgress+=t/v,n.jumpProgress>=1)n.jumpProgress=1,n.x=n.targetX,n.y=n.targetY,n.vx=0,n.vy=0;else{const t=n.jumpProgress;let e=t;if("linear"===b)e=t;else if("snap"===b)if(t<.6){const n=t/.6;e=n*n*w}else{const n=(t-.6)/.4;e=1+(w-1)*(1-n)-S*Math.sin(n*Math.PI)}else if("bounce"===b)if(t<.7)e=t/.7*(t/.7);else{const n=(t-.7)/.3;e=1-.5*S*Math.sin(n*Math.PI*2)}else"smooth"===b&&(e=t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2);n.x=n.jumpStartX+(n.targetX-n.jumpStartX)*e,n.y=n.jumpStartY+(n.targetY-n.jumpStartY)*e,n.vx=0,n.vy=0}}}(l),ee%60==0&&wt();let r=0;for(;Ee>=Ie&&r<2;){if(a!==o)for(let t=0;t<he.length;t++)he[t].step(Ie);if(a!==e&&a!==o&&ve(re),a!==o){const t=a===n?m:rt;for(let e=0;e<he.length;e++)he[e].walls(Y.width,Y.height,Ie,t)}Ee-=Ie,r++,ne++}Ee>3*Ie&&(Ee=0),G.clearRect(0,0,Y.width,Y.height),Zt>0&&function(t,e,n){const o=Zt;t.strokeStyle="rgba(255, 255, 255, 0.1)",t.lineWidth=2,t.beginPath(),t.moveTo(o,0),t.lineTo(e-o,0),t.arcTo(e,0,e,o,o),t.lineTo(e,n-o),t.arcTo(e,n,e-o,n,o),t.lineTo(o,n),t.arcTo(0,n,0,n-o,o),t.lineTo(0,o),t.arcTo(0,0,o,0,o),t.closePath(),t.stroke()}(G,Y.width,Y.height);for(let t=0;t<he.length;t++)he[t].draw(G);if(function(t){if($t)return;if(Gt===z||Ut===z)return;const e=Gt,n=Ut,o=(Bt+St)/2;t.beginPath(),t.arc(e,n,o,0,2*Math.PI),t.fillStyle="rgba(255, 255, 255, 0.9)",t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.6)",t.lineWidth=2,t.stroke()}(G),!$t){G.save(),G.font="14px system-ui, -apple-system, sans-serif",G.fillStyle="rgba(255, 255, 255, 0.3)",G.textAlign="left",G.textBaseline="bottom";const t=a.charAt(0).toUpperCase()+a.slice(1);G.fillText(t+" Mode",10,Y.height-10),G.restore()}requestAnimationFrame(t)});const Be=document.getElementById("panelHeader"),Se=document.getElementById("minimizePanel");if(Se&&U&&Se.addEventListener("click",t=>{t.stopPropagation(),U.classList.toggle("hidden")}),Be&&U){let ya,fa,va,xa,Ea=!1,Ia=0,Ma=0;function be(t){"touchstart"===t.type?(va=t.touches[0].clientX-Ia,xa=t.touches[0].clientY-Ma):(va=t.clientX-Ia,xa=t.clientY-Ma),(t.target===Be||Be.contains(t.target))&&(Ea=!0,U.style.cursor="grabbing")}function we(t){if(Ea){t.preventDefault(),"touchmove"===t.type?(ya=t.touches[0].clientX-va,fa=t.touches[0].clientY-xa):(ya=t.clientX-va,fa=t.clientY-xa),Ia=ya,Ma=fa,U.getBoundingClientRect();const e=window.getComputedStyle(U),n=parseFloat(e.top)||0,o=parseFloat(e.right)||0;U.style.top=`${n+Ma}px`,U.style.right=o-Ia+"px",U.style.left="auto",U.style.bottom="auto",Ia=0,Ma=0,va="touchmove"===t.type?t.touches[0].clientX:t.clientX,xa="touchmove"===t.type?t.touches[0].clientY:t.clientY}}function Ce(t){Ea&&(Ea=!1,U.style.cursor="move",va=ya,xa=fa)}Be.addEventListener("mousedown",be),document.addEventListener("mousemove",we),document.addEventListener("mouseup",Ce),Be.addEventListener("touchstart",be),document.addEventListener("touchmove",we),document.addEventListener("touchend",Ce)}window.addEventListener("keydown",s=>{const i=s.key.toLowerCase();"r"===i&&(function(){if(a===n)Bo();else for(let t=0;t<he.length;t++){const e=he[t],n=ye();e.x=n.x,e.y=n.y;const o=.5*Y.width,a=Ct?Vt>=0?1:-1:e.x<o?1:-1,s=ce(e.r/(.5*(Bt+St)),.6,1.4),i=140*s,l=180*s,r=120;e.vx=a*(i+Math.random()*l),e.vy=-Math.random()*r,e.age=0,e.driftAx=a*(360+420*Math.random())*s,e.driftTime=.22+.28*Math.random()}}(),s.preventDefault()),"/"===i&&U&&(s.preventDefault(),U.classList.toggle("hidden")),"1"===i&&To(t),"2"===i&&To(e),"3"===i&&To(n),"4"===i&&To(o)}),function(t=160){for(let e=0;e<t&&he.length<ht;e++){const t=ye();ge(t.x,t.y)}}(200),Y.addEventListener("mousemove",e=>{const n=Y.getBoundingClientRect();Gt=(e.clientX-n.left)*D,Ut=(e.clientY-n.top)*D,a===t&&Yt>0&&Nt>0&&(Dt=!0)}),Y.addEventListener("mouseleave",()=>{Gt=z,Ut=z});const Le=document.getElementById("restitutionSlider"),Ve=document.getElementById("frictionSlider"),Fe=document.getElementById("emitterSlider"),Re=document.getElementById("sizeSliderGlobal"),Te=document.getElementById("sizeVariationSliderGlobal"),Pe=(document.getElementById("weightSliderGlobal"),document.getElementById("ballSoftnessSliderGlobal")),Ae=document.getElementById("sizeValGlobal"),qe=document.getElementById("sizeVariationValGlobal"),ze=(document.getElementById("weightValGlobal"),document.getElementById("ballSoftnessValGlobal")),ke=(document.getElementById("sizeSliderPit"),document.getElementById("sizeVariationSliderPit"),document.getElementById("weightSliderPit"),document.getElementById("ballSoftnessSliderPit"),document.getElementById("sizeValPit"),document.getElementById("sizeVariationValPit"),document.getElementById("weightValPit"),document.getElementById("ballSoftnessValPit"),document.getElementById("sizeSliderFlies"),document.getElementById("sizeVariationSliderFlies"),document.getElementById("weightSliderFlies"),document.getElementById("ballSoftnessSliderFlies"),document.getElementById("sizeValFlies"),document.getElementById("sizeVariationValFlies"),document.getElementById("weightValFlies"),document.getElementById("ballSoftnessValFlies"),document.getElementById("sizeSliderZeroG"),document.getElementById("sizeVariationSliderZeroG"),document.getElementById("weightSliderZeroG"),document.getElementById("ballSoftnessSliderZeroG"),document.getElementById("sizeValZeroG"),document.getElementById("sizeVariationValZeroG"),document.getElementById("weightValZeroG"),document.getElementById("ballSoftnessValZeroG"),document.getElementById("maxBallsSlider")),Oe=document.getElementById("spawnYSlider"),Ne=document.getElementById("spawnWidthSlider"),Ye=document.getElementById("spawnCenterSlider"),Xe=document.getElementById("spawnHeightSlider"),Ge=document.getElementById("repelSizeSlider"),Ue=document.getElementById("repelPowerSlider"),De=document.getElementById("repelSoftSlider"),$e=document.getElementById("colorSelect"),je=document.getElementById("color1"),He=document.getElementById("color2"),We=document.getElementById("color3"),_e=document.getElementById("color4"),Ze=document.getElementById("color5"),Je=document.getElementById("color6"),Qe=document.getElementById("color7"),Ke=document.getElementById("color8"),tn=document.getElementById("cursorColorSelect"),en=document.getElementById("color1Val"),nn=document.getElementById("color2Val"),on=document.getElementById("color3Val"),an=document.getElementById("color4Val"),sn=document.getElementById("color5Val"),ln=document.getElementById("color6Val"),rn=document.getElementById("color7Val"),dn=document.getElementById("color8Val");[en,nn,on,an,sn,ln,rn,dn].forEach(t=>{t&&t.setAttribute("title","Click to copy")});const un=document.getElementById("cornerRadiusSlider"),hn=document.getElementById("cornerRadiusVal"),cn=document.getElementById("trailFadeSlider"),mn=document.getElementById("trailFadeVal"),gn=document.getElementById("trailSubtletySlider"),pn=document.getElementById("trailSubtletyVal"),yn=document.getElementById("restitutionVal"),fn=document.getElementById("frictionVal"),vn=document.getElementById("emitterVal"),xn=document.getElementById("maxBallsVal"),En=document.getElementById("spawnYVal"),In=document.getElementById("spawnWidthVal"),Mn=document.getElementById("spawnCenterVal"),Bn=document.getElementById("spawnHeightVal"),Sn=document.getElementById("repelSizeVal"),bn=document.getElementById("repelPowerVal"),wn=document.getElementById("repelSoftVal");function Cn(){return{gravityMultiplier:it,restitution:rt,friction:dt,ballMass:xt,emitRate:ut,maxBalls:ht,ballScale:pt,ballVariation:yt,spawnX:tt,spawnY:et,spawnWidth:nt,spawnHeight:ot,sweepEnabled:Ct,repelRadius:Nt,repelPower:Yt,repelSoftness:Xt,trailFade:Kt,trailSubtlety:te,colors:Tt.slice(),colorWeights:kt.slice(),currentTemplate:Rt,cursorColorIndex:Pt,performanceMode:j,targetFPS:H,enableLOD:!0}}const Ln=document.getElementById("saveConfigBtn"),Vn=document.getElementById("buildBtn"),Fn=document.getElementById("configOutput");function Rn(t,e){t&&t.addEventListener("click",async()=>{const n="function"==typeof e?e():String(e||"").trim();try{await navigator.clipboard.writeText(n);const e=t.textContent;t.textContent="COPIED",t.style.color="#3ddc84",setTimeout(()=>{t.textContent=e,t.style.color="#888"},900)}catch(t){console.warn("Clipboard unavailable")}})}Ln&&Vn&&Fn&&(Ln.addEventListener("click",()=>{const t=(e=Cn(),`// Generated configuration from frontend\nconst CONFIG = ${JSON.stringify(e,null,2)};`);var e;Fn.style.display="block",Fn.textContent=t,navigator.clipboard.writeText(t).then(()=>{const t=Ln.textContent;Ln.textContent="‚úÖ Copied!",setTimeout(()=>{Ln.textContent=t},1200)}).catch(()=>{console.warn("Clipboard copy failed");const t=Ln.textContent;Ln.textContent="‚ö†Ô∏è Copy failed",setTimeout(()=>{Ln.textContent=t},1200)})}),Vn.addEventListener("click",()=>{const t=Cn();Fn.style.display="block",Fn.innerHTML="\n<strong>üöÄ Build Instructions:</strong><br>\n1. Run: <code>npm run build</code><br>\n2. Your current config will be baked into <code>public/js/bouncy-balls-embed.js</code>";const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download="current-config.json",o.click(),URL.revokeObjectURL(n)})),Le&&Le.addEventListener("input",()=>{rt=parseFloat(Le.value),yn&&(yn.textContent=rt.toFixed(2)),Wt()}),Ve&&Ve.addEventListener("input",()=>{dt=parseFloat(Ve.value),fn&&(fn.textContent=dt.toFixed(4)),Wt()}),Fe&&Fe.addEventListener("input",()=>{ut=parseFloat(Fe.value),vn&&(vn.textContent=ut.toFixed(3)),Wt()}),function(t){if(!t)return;const{size:e,sizeVal:n,sizeVar:o,sizeVarVal:a,soft:i,softVal:l}=t;e&&e.addEventListener("input",()=>{const t=parseFloat(e.value);n&&(n.textContent=t.toFixed(1)),pt=t,bt();for(let t=0;t<he.length;t++)he[t].m=xt;Wt()}),o&&o.addEventListener("input",()=>{const t=parseFloat(o.value);a&&(a.textContent=t.toFixed(1)),yt=t,Wt()}),i&&i.addEventListener("input",()=>{const t=parseInt(i.value,10);l&&(l.textContent=String(t)),s=t,Wt()})}({size:Re,sizeVal:Ae,sizeVar:Te,sizeVarVal:qe,soft:Pe,softVal:ze}),ke&&ke.addEventListener("input",()=>{ht=parseInt(ke.value,10),xn&&(xn.textContent=ht.toString()),he.length>ht&&(he.length=ht)}),Te&&Te.addEventListener("input",()=>{yt=parseFloat(Te.value),qe&&(qe.textContent=yt.toFixed(1)),An()});const Tn=document.getElementById("weightPitSlider"),Pn=document.getElementById("weightPitVal");function An(){const t=(Bt+St)/2;for(let e=0;e<he.length;e++){const n=he[e];if(0===yt)n.r=t;else{const e=.1*t,o=Math.max(1,t-e),a=t+e;n.r=me(o,a)}n.m=xt}}document.getElementById("weightWeightlessSlider"),document.getElementById("weightWeightlessVal"),Oe&&Oe.addEventListener("input",()=>{et=parseFloat(Oe.value),En&&(En.textContent=et.toFixed(0)),at()}),Ne&&Ne.addEventListener("input",()=>{nt=parseFloat(Ne.value),In&&(In.textContent=nt.toFixed(0))}),Ye&&Ye.addEventListener("input",()=>{tt=parseFloat(Ye.value),Mn&&(Mn.textContent=tt.toFixed(0))}),Xe&&Xe.addEventListener("input",()=>{ot=parseFloat(Xe.value),Bn&&(Bn.textContent=ot.toFixed(0))}),Ge&&Ge.addEventListener("input",()=>{Nt=parseFloat(Ge.value),Sn&&(Sn.textContent=Nt.toFixed(0)),Dt=Dt||Yt>0&&Nt>0}),Ue&&Ue.addEventListener("input",()=>{Yt=function(t){const e=Math.max(0,Math.min(_t,Number(t)))/_t;return 2*Math.pow(2,12*(e-.5))*12e3}(Ue.value),bn&&(bn.textContent=Math.round(Yt).toString()),ua&&"off"!==ua.value&&(Dt=Yt>0&&Nt>0)}),De&&De.addEventListener("input",()=>{Xt=parseFloat(De.value),wn&&(wn.textContent=Xt.toFixed(1))});const qn=document.getElementById("performanceModeToggle");document.getElementById("performanceModeStatus"),qn&&qn.addEventListener("change",()=>{!function(){j=!j,H=j?120:60;const t=j?Q.performance:Q.normal;j?(console.log("‚ö° PERFORMANCE MODE: Optimizing for 120 FPS..."),he.length>t.maxBalls&&(he.length=t.maxBalls,console.log(`‚ö° Reduced balls to ${t.maxBalls} for 120 FPS`)),ht=t.maxBalls,re=t.collisionIters):(console.log("üé® NORMAL MODE: Restoring visual quality..."),ht=t.maxBalls,re=t.collisionIters),function(){const t=document.getElementById("performanceModeToggle"),e=document.getElementById("performanceModeStatus"),n=document.getElementById("maxBallsSlider"),o=document.getElementById("maxBallsVal");t&&(t.checked=j),e&&(j?(e.textContent=`‚ö° 120 FPS Mode Active (${he.length} balls)`,e.style.background="rgba(255,165,0,0.3)"):(e.textContent=`üé® Normal Mode (${he.length} balls)`,e.style.background="rgba(0,0,0,0.2)")),n&&o&&(n.value=ht,o.textContent=ht.toString())}(),console.log(`üéØ Target FPS: ${H}, Mode: ${j?"PERFORMANCE":"NORMAL"}`)}()});const zn=document.getElementById("darkModeToggle");document.getElementById("darkModeStatus"),zn&&zn.addEventListener("change",()=>{W=!W,W?(J(),console.log("üåô Auto Dark Mode: ENABLED")):(Z(!1),console.log("‚òÄÔ∏è Auto Dark Mode: DISABLED")),Wt()});const kn=document.getElementById("canvasShadowEnabled"),On=document.getElementById("shadowOffsetX"),Nn=document.getElementById("shadowOffsetXVal"),Yn=document.getElementById("shadowOffsetY"),Xn=document.getElementById("shadowOffsetYVal"),Gn=document.getElementById("shadowBlur"),Un=document.getElementById("shadowBlurVal"),Dn=document.getElementById("shadowOpacity"),$n=document.getElementById("shadowOpacityVal"),jn=document.getElementById("shadowColor"),Hn=document.getElementById("shadowColorVal"),Wn=document.getElementById("shadow2Enabled"),_n=document.getElementById("shadow2Blur"),Zn=document.getElementById("shadow2BlurVal"),Jn=document.getElementById("shadow2Opacity"),Qn=document.getElementById("shadow2OpacityVal");kn&&kn.addEventListener("change",()=>{C=kn.checked,$(),Wt()}),On&&On.addEventListener("input",()=>{L=parseInt(On.value,10),Nn&&(Nn.textContent=L.toString()),$(),Wt()}),Yn&&Yn.addEventListener("input",()=>{V=parseInt(Yn.value,10),Xn&&(Xn.textContent=V.toString()),$(),Wt()}),Gn&&Gn.addEventListener("input",()=>{F=parseInt(Gn.value,10),Un&&(Un.textContent=F.toString()),$(),Wt()}),Dn&&Dn.addEventListener("input",()=>{R=parseFloat(Dn.value),$n&&($n.textContent=R.toFixed(2)),$(),Wt()}),jn&&jn.addEventListener("input",()=>{T=jn.value,Hn&&(Hn.textContent=T.toUpperCase()),$(),Wt()}),Wn&&Wn.addEventListener("change",()=>{P=Wn.checked,$(),Wt()}),_n&&_n.addEventListener("input",()=>{A=parseInt(_n.value,10),Zn&&(Zn.textContent=A.toString()),$(),Wt()}),Jn&&Jn.addEventListener("input",()=>{q=parseFloat(Jn.value),Qn&&(Qn.textContent=q.toFixed(2)),$(),Wt()}),Y.addEventListener("mousemove",t=>{const e=Y.getBoundingClientRect();Gt=(t.clientX-e.left)*D,Ut=(t.clientY-e.top)*D}),Y.addEventListener("mouseleave",()=>{Gt=z,Ut=z}),$e&&$e.addEventListener("change",()=>{qt($e.value)});const Kn=Array.from(document.querySelectorAll(".mode-button")),to=document.getElementById("pitControls"),eo=document.getElementById("fliesControls"),no=document.getElementById("weightlessControls"),oo=document.getElementById("gravityPitSlider"),ao=document.getElementById("gravityPitVal"),so=document.getElementById("repellerEnabledPit"),io=document.getElementById("attractPowerSlider"),lo=document.getElementById("attractPowerVal"),ro=document.getElementById("orbitRadiusSlider"),uo=document.getElementById("orbitRadiusVal"),ho=document.getElementById("swarmSpeedSlider"),co=document.getElementById("swarmSpeedVal"),mo=document.getElementById("weightlessCountSlider"),go=document.getElementById("weightlessCountVal"),po=document.getElementById("weightlessSpeedSlider"),yo=document.getElementById("weightlessSpeedVal"),fo=document.getElementById("weightlessBounceSlider"),vo=document.getElementById("weightlessBounceVal"),xo=document.getElementById("weightlessRepelSlider"),Eo=document.getElementById("weightlessRepelVal"),Io=document.getElementById("weightlessRepelRadiusSlider"),Mo=document.getElementById("weightlessRepelRadiusVal");function Bo(){he.length=0;const t=h,e=Y.width,n=Y.height,o=40*D;for(let a=0;a<t;a++){const t=ge(o+Math.random()*(e-2*o),o+Math.random()*(n-2*o)),a=Math.random()*Math.PI*2,s=c*(.7+.3*Math.random());t.vx=Math.cos(a)*s,t.vy=Math.sin(a)*s,t.driftAx=0,t.driftTime=0}}let So=0,bo=0,wo=0,Co=0,Lo=0;function Vo(){const t=Y.width,e=Y.height;wo=y,So=t/wo,bo=Math.floor(e/So),Co=(t-wo*So)/2,Lo=(e-bo*So)/2}function Fo(t,e){return{x:Co+(t+.5)*So,y:Lo+(e+.5)*So}}function Ro(){he.length=0,Vo();const t=wo*bo,e=Math.min(B,t),n=[];for(let t=0;t<bo;t++)for(let e=0;e<wo;e++)n.push({gridX:e,gridY:t});for(let t=n.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[n[t],n[e]]=[n[e],n[t]]}for(let t=0;t<e;t++){const e=n[t],o=Fo(e.gridX,e.gridY),a=ge(o.x,o.y);a.gridX=e.gridX,a.gridY=e.gridY,a.targetX=o.x,a.targetY=o.y,a.jumpProgress=1,a.vx=0,a.vy=0,a.driftAx=0,a.driftTime=0;const s=f,i=x*Math.random()*s;a.nextJumpTime=s+i}}function To(s){a=s,function(t){const e=document.getElementById("announcer");e&&(e.textContent="",setTimeout(()=>e.textContent=t,100))}(`Switched to ${{[t]:"Ball Pit",[e]:"Flies to Light",[n]:"Zero Gravity",[o]:"Pulse Grid"}[s]} mode`),X.className="",a===t&&X.classList.add("mode-pit"),at(),a===t?(it=i,lt=st*it,Dt=l&&Yt>0&&Nt>0,Ct=!0,he.length=0,pe=0,Me()):a===e?(it=0,lt=st*it,Dt=!1,Ct=!1,function(){he.length=0;const t=.5*Y.width,e=.5*Y.height,n=150*D;for(let o=0;o<60;o++){const o=Math.random()*Math.PI*2,a=Math.random()*n,s=ge(t+Math.cos(o)*a,e+Math.sin(o)*a),i=.5+.5*Math.random(),l=Math.random()*Math.PI*2,r=300*i;s.vx=Math.cos(l)*r,s.vy=Math.sin(l)*r,s.driftAx=0,s.driftTime=0}}(),Me()):a===n?(it=0,lt=st*it,Dt=!1,Ct=!1,Bo(),Me()):a===o&&(it=0,lt=st*it,Dt=!1,Ct=!1,Ro(),Me()),function(){const s=document.getElementById("pulseGridControls");to&&to.classList.toggle("active",a===t),eo&&eo.classList.toggle("active",a===e),no&&no.classList.toggle("active",a===n),s&&s.classList.toggle("active",a===o),Kn.forEach(t=>{const e=t.getAttribute("data-mode")===a;t.classList.toggle("active",e),t.setAttribute("aria-pressed",e?"true":"false")})}()}Kn.forEach(t=>t.addEventListener("click",()=>{To(t.getAttribute("data-mode")),Wt()})),oo&&oo.addEventListener("input",()=>{i=parseFloat(oo.value),ao&&(ao.textContent=i.toFixed(1)),Wt(),a===t&&(it=i,lt=st*it)}),Tn&&Tn.addEventListener("input",()=>{xt=parseFloat(Tn.value),Pn&&(Pn.textContent=xt.toFixed(2));for(let t=0;t<he.length;t++)he[t].m=xt;Mt(),Wt()}),so&&so.addEventListener("change",()=>{l=!!so.checked,a===t&&(Dt=l&&Yt>0&&Nt>0)}),io&&io.addEventListener("input",()=>{r=parseFloat(io.value),lo&&(lo.textContent=Math.round(r).toString())}),ro&&ro.addEventListener("input",()=>{d=parseFloat(ro.value),uo&&(uo.textContent=Math.round(d).toString())}),ho&&ho.addEventListener("input",()=>{u=parseFloat(ho.value),co&&(co.textContent=u.toFixed(1))}),mo&&mo.addEventListener("input",()=>{h=parseInt(mo.value,10),go&&(go.textContent=h.toString()),a===n&&Bo()}),po&&po.addEventListener("input",()=>{c=parseFloat(po.value),yo&&(yo.textContent=Math.round(c).toString())}),fo&&fo.addEventListener("input",()=>{m=parseFloat(fo.value),vo&&(vo.textContent=m.toFixed(2))}),xo&&xo.addEventListener("input",()=>{g=parseFloat(xo.value),Eo&&(Eo.textContent=Math.round(g).toString()),Wt()}),Io&&Io.addEventListener("input",()=>{p=parseFloat(Io.value),Mo&&(Mo.textContent=Math.round(p).toString()),Wt()});const Po=document.getElementById("gridPresetSelect"),Ao=document.getElementById("gridBallCountSlider"),qo=document.getElementById("gridBallCountVal"),zo=document.getElementById("gridColumnsSlider"),ko=document.getElementById("gridColumnsVal"),Oo=document.getElementById("pulseIntervalSlider"),No=document.getElementById("pulseIntervalVal"),Yo=document.getElementById("pulseSpeedSlider"),Xo=document.getElementById("pulseSpeedVal"),Go=document.getElementById("pulseMinStepsSlider"),Uo=document.getElementById("pulseMinStepsVal"),Do=document.getElementById("pulseMaxStepsSlider"),$o=document.getElementById("pulseMaxStepsVal"),jo=document.getElementById("pulseSynchronicitySlider"),Ho=document.getElementById("pulseSynchronicityVal"),Wo=document.getElementById("pulseRandomnessSlider"),_o=document.getElementById("pulseRandomnessVal"),Zo={synchronized:{interval:.6,speed:.2,minSteps:1,maxSteps:2,synchronicity:.1,randomness:.2,easingStyle:"snap",overshoot:1.12,bounce:.18},organic:{interval:.8,speed:.25,minSteps:1,maxSteps:3,synchronicity:.3,randomness:.4,easingStyle:"smooth",overshoot:1.05,bounce:.1},chaotic:{interval:.4,speed:.15,minSteps:2,maxSteps:4,synchronicity:.7,randomness:.8,easingStyle:"bounce",overshoot:1.15,bounce:.25}};Po&&Po.addEventListener("change",()=>{!function(t){const e=Zo[t];if(!e)return;f=e.interval,v=e.speed,I=e.minSteps,M=e.maxSteps,x=e.synchronicity,E=e.randomness,b=e.easingStyle,w=e.overshoot,S=e.bounce,Oo&&(Oo.value=e.interval),No&&(No.textContent=e.interval.toFixed(1)),Yo&&(Yo.value=e.speed),Xo&&(Xo.textContent=e.speed.toFixed(2)),Go&&(Go.value=e.minSteps),Uo&&(Uo.textContent=e.minSteps.toString()),Do&&(Do.value=e.maxSteps),$o&&($o.textContent=e.maxSteps.toString()),jo&&(jo.value=e.synchronicity),Ho&&(Ho.textContent=e.synchronicity.toFixed(2)),Wo&&(Wo.value=e.randomness),_o&&(_o.textContent=e.randomness.toFixed(2));const n=document.getElementById("pulseEasingSelect"),s=document.getElementById("pulseOvershootSlider"),i=document.getElementById("pulseOvershootVal"),l=document.getElementById("pulseBounceSlider"),r=document.getElementById("pulseBounceVal");n&&(n.value=e.easingStyle),s&&(s.value=e.overshoot),i&&(i.textContent=e.overshoot.toFixed(2)),l&&(l.value=e.bounce),r&&(r.textContent=e.bounce.toFixed(2)),a===o&&Ro()}(Po.value),Wt()}),Ao&&Ao.addEventListener("input",()=>{B=parseInt(Ao.value,10),qo&&(qo.textContent=B.toString()),a===o&&Ro(),Wt()}),zo&&zo.addEventListener("input",()=>{y=parseInt(zo.value,10),ko&&(ko.textContent=y.toString()),a===o&&(Vo(),Ro()),Wt()}),Oo&&Oo.addEventListener("input",()=>{f=parseFloat(Oo.value),No&&(No.textContent=f.toFixed(1)),Wt()}),Yo&&Yo.addEventListener("input",()=>{v=parseFloat(Yo.value),Xo&&(Xo.textContent=v.toFixed(2)),Wt()}),Go&&Go.addEventListener("input",()=>{I=parseInt(Go.value,10),Uo&&(Uo.textContent=I.toString()),I>M&&(M=I,Do&&(Do.value=I),$o&&($o.textContent=I.toString())),Wt()}),Do&&Do.addEventListener("input",()=>{M=parseInt(Do.value,10),$o&&($o.textContent=M.toString()),M<I&&(I=M,Go&&(Go.value=M),Uo&&(Uo.textContent=M.toString())),Wt()}),jo&&jo.addEventListener("input",()=>{x=parseFloat(jo.value),Ho&&(Ho.textContent=x.toFixed(2)),Wt()}),Wo&&Wo.addEventListener("input",()=>{E=parseFloat(Wo.value),_o&&(_o.textContent=E.toFixed(2)),Wt()});const Jo=document.getElementById("pulseEasingSelect"),Qo=document.getElementById("pulseOvershootSlider"),Ko=document.getElementById("pulseOvershootVal"),ta=document.getElementById("pulseBounceSlider"),ea=document.getElementById("pulseBounceVal");function na(){for(let t=0;t<he.length;t++)he[t].color=Ot()}function oa(){const t=document.getElementById("color1"),e=document.getElementById("color2"),n=document.getElementById("color3"),o=document.getElementById("color4"),a=document.getElementById("color5"),s=document.getElementById("color6"),i=document.getElementById("color7"),l=document.getElementById("color8"),r=document.getElementById("color1Val"),d=document.getElementById("color2Val"),u=document.getElementById("color3Val"),h=document.getElementById("color4Val"),c=document.getElementById("color5Val"),m=document.getElementById("color6Val"),g=document.getElementById("color7Val"),p=document.getElementById("color8Val");t&&r&&(t.value=Tt[0],r.textContent=Tt[0].toUpperCase()),e&&d&&(e.value=Tt[1],d.textContent=Tt[1].toUpperCase()),n&&u&&(n.value=Tt[2],u.textContent=Tt[2].toUpperCase()),o&&h&&(o.value=Tt[3],h.textContent=Tt[3].toUpperCase()),a&&c&&(a.value=Tt[4],c.textContent=Tt[4].toUpperCase()),s&&m&&(s.value=Tt[5],m.textContent=Tt[5].toUpperCase()),i&&g&&(i.value=Tt[6],g.textContent=Tt[6].toUpperCase()),l&&p&&(l.value=Tt[7],p.textContent=Tt[7].toUpperCase())}Jo&&Jo.addEventListener("change",()=>{b=Jo.value,Wt()}),Qo&&Qo.addEventListener("input",()=>{w=parseFloat(Qo.value),Ko&&(Ko.textContent=w.toFixed(2)),Wt()}),ta&&ta.addEventListener("input",()=>{S=parseFloat(ta.value),ea&&(ea.textContent=S.toFixed(2)),Wt()}),je&&je.addEventListener("input",()=>{Tt[0]=je.value,en&&(en.textContent=je.value.toUpperCase()),na(),zt()}),He&&He.addEventListener("input",()=>{Tt[1]=He.value,nn&&(nn.textContent=He.value.toUpperCase()),na(),zt()}),We&&We.addEventListener("input",()=>{Tt[2]=We.value,on&&(on.textContent=We.value.toUpperCase()),na(),zt()}),_e&&_e.addEventListener("input",()=>{Tt[3]=_e.value,an&&(an.textContent=_e.value.toUpperCase()),na(),zt()}),Ze&&Ze.addEventListener("input",()=>{Tt[4]=Ze.value,sn&&(sn.textContent=Ze.value.toUpperCase()),na(),zt()}),Je&&Je.addEventListener("input",()=>{Tt[5]=Je.value,ln&&(ln.textContent=Je.value.toUpperCase()),na(),zt()}),Qe&&Qe.addEventListener("input",()=>{Tt[6]=Qe.value,rn&&(rn.textContent=Qe.value.toUpperCase()),na(),zt()}),Ke&&Ke.addEventListener("input",()=>{Tt[7]=Ke.value,dn&&(dn.textContent=Ke.value.toUpperCase()),na(),zt()}),tn&&tn.addEventListener("change",()=>{const t=Math.max(1,Math.min(8,parseInt(tn.value,10)))-1;Pt=t,At=Tt[Pt]||At,Wt()}),Rn(en,()=>je.value.toUpperCase()),Rn(nn,()=>He.value.toUpperCase()),Rn(on,()=>We.value.toUpperCase()),Rn(an,()=>_e.value.toUpperCase()),Rn(sn,()=>Ze.value.toUpperCase()),Rn(ln,()=>Je.value.toUpperCase()),Rn(rn,()=>Qe.value.toUpperCase()),Rn(dn,()=>Ke.value.toUpperCase()),un&&un.addEventListener("input",()=>{Zt=parseFloat(un.value),hn&&(hn.textContent=Zt.toFixed(0))}),cn&&cn.addEventListener("input",()=>{Kt=parseFloat(cn.value),mn&&(mn.textContent=Kt.toFixed(3))}),gn&&gn.addEventListener("input",()=>{te=parseFloat(gn.value),pn&&(pn.textContent=te.toFixed(2)+"√ó")});const aa={rubberPlayground:{label:"Rubber ‚Äì Playground",G:1960,REST:.9,FRICTION:.0025,sizeScale:1.8,maxBalls:450,sizeVariation:.2},rubberRacquet:{label:"Rubber ‚Äì Racquetball",G:3320,REST:.97,FRICTION:.0035,sizeScale:.7,maxBalls:350,sizeVariation:.3},rubberSuperball:{label:"Rubber ‚Äì Superball",G:1960,REST:.95,FRICTION:.0015,sizeScale:1.2,maxBalls:450,sizeVariation:.05},rubberSoft:{label:"Rubber ‚Äì Soft",G:1960,REST:.86,FRICTION:.0035,sizeScale:2.2,maxBalls:350,sizeVariation:.25},rubberHeavy:{label:"Rubber ‚Äì Heavy",G:1960,REST:.88,FRICTION:.003,sizeScale:2,maxBalls:400,sizeVariation:.15}},sa={fullRain:{label:"Full Rain (top-half)",EMIT_INTERVAL:.03,xCenter:50,y:-50,w:100,h:50},narrowStrip:{label:"Narrow Strip Top",EMIT_INTERVAL:.05,xCenter:50,y:-40,w:20,h:10},leftGutter:{label:"Left Gutter",EMIT_INTERVAL:.045,xCenter:10,y:-60,w:18,h:20},rightGutter:{label:"Right Gutter",EMIT_INTERVAL:.045,xCenter:90,y:-60,w:18,h:20},centerFountain:{label:"Center Fountain",EMIT_INTERVAL:.02,xCenter:50,y:-30,w:30,h:20},stormBurst:{label:"Storm Burst",EMIT_INTERVAL:.005,xCenter:50,y:-80,w:100,h:30},slowSnow:{label:"Slow Snow",EMIT_INTERVAL:.2,xCenter:50,y:-30,w:100,h:20},edgeDrizzle:{label:"Edge Drizzle",EMIT_INTERVAL:.08,xCenter:15,y:-40,w:30,h:15},twinColumns:{label:"Twin Columns",EMIT_INTERVAL:.03,xCenter:30,y:-50,w:10,h:40},focusedBeam:{label:"Focused Beam",EMIT_INTERVAL:.015,xCenter:50,y:-70,w:6,h:12}},ia={off:{label:"Off",r:710,p:274e3,s:4.4},gentle:{label:"Gentle Breeze",r:120,p:2500,s:2.5},pushField:{label:"Push Field",r:240,p:8e4,s:2},tractor:{label:"Tractor Push",r:320,p:14e4,s:1.6},magnet:{label:"Magnet Repel",r:200,p:18e4,s:3},pulse:{label:"Pulse Strong",r:280,p:22e4,s:1.2},wideSoft:{label:"Wide Soft",r:500,p:8e4,s:4.5},needle:{label:"Needle Point",r:80,p:26e4,s:.8},wall:{label:"Invisible Wall",r:700,p:16e4,s:5},singularity:{label:"Singularity",r:600,p:3e5,s:.5}};function la(t,e,n){t.innerHTML="";for(const[o,a]of Object.entries(e)){const e=document.createElement("option");e.value=o,e.textContent=a.label||o,o===n&&(e.selected=!0),t.appendChild(e)}}const ra=document.getElementById("physicsSelect"),da=document.getElementById("spawnSelect"),ua=document.getElementById("repellerSelect");function ha(t,e,n,o=0){t&&(t.value=String(n)),e&&(e.textContent=o>0?n.toFixed(o):n.toString())}function ca(t){const e=aa[t];if(!e)return;rt=e.REST,dt=e.FRICTION,ht=e.maxBalls,yt=e.sizeVariation;const n=e.sizeScale;pt=n,bt();for(let t=0;t<he.length;t++)he[t].m=xt;he.length>ht&&(he.length=ht),ha(Le,yn,rt,2),ha(Ve,fn,dt,4),ha(Re,Ae,pt,1),ha(ke,xn,ht,0),ha(Te,qe,yt,1),An()}function ma(t){const e=sa[t];e&&(ut=e.EMIT_INTERVAL,tt=e.xCenter,et=e.y,nt=e.w,ot=e.h,ha(Fe,vn,ut,3),ha(Ye,Mn,tt,0),ha(Oe,En,et,0),ha(Ne,In,nt,0),ha(Xe,Bn,ot,0))}function ga(t){const e=ia[t];if(!e)return;Nt=e.r,Yt=1*e.p,Dt="off"!==t,ha(Ge,Sn,Nt,0);const n=function(t){const e=Math.max(1,Number(t))/24e3,n=.5+Math.log2(e)/12;return Math.round(Math.max(0,Math.min(1,n))*_t)}(Yt);Ue&&(Ue.value=String(n)),bn&&(bn.textContent=Math.round(Yt).toString()),ha(De,wn,Xt,1)}ra&&la(ra,aa,"rubberRacquet"),da&&la(da,sa,"fullRain"),ua&&la(ua,ia,"off"),$e&&la($e,Ft,"industrialTeal"),ca("rubberRacquet"),ma("fullRain"),ga("off"),oa(),zt(),ra&&ra.addEventListener("change",()=>ca(ra.value)),da&&da.addEventListener("change",()=>ma(da.value)),ua&&ua.addEventListener("change",()=>ga(ua.value)),bt(),wt(),function(){try{const t=localStorage.getItem(jt);if(t){const e=JSON.parse(t);return e.currentMode&&(a=e.currentMode),void 0!==e.gravityMultiplierPit&&(i=e.gravityMultiplierPit),void 0!==e.repellerEnabledPit&&(l=e.repellerEnabledPit),e.attractionPower&&(r=e.attractionPower),e.orbitRadius&&(d=e.orbitRadius),e.swarmSpeed&&(u=e.swarmSpeed),e.weightlessInitialSpeed&&(c=e.weightlessInitialSpeed),e.weightlessBounce&&(m=e.weightlessBounce),e.weightlessCount&&(h=e.weightlessCount),void 0!==e.weightlessRepellerPower&&(g=e.weightlessRepellerPower),void 0!==e.weightlessRepellerRadius&&(p=e.weightlessRepellerRadius),e.restitution&&(rt=e.restitution),void 0!==e.friction&&(dt=e.friction),e.sizeScale&&(pt=e.sizeScale),void 0!==e.sizeVariation&&(yt=e.sizeVariation),e.ballMassKg&&(xt=e.ballMassKg),e.repelPower&&(Yt=e.repelPower),e.repelRadius&&(Nt=e.repelRadius),e.repelSoft&&(Xt=e.repelSoft),void 0!==e.cornerRadius&&(Zt=e.cornerRadius),void 0!==e.motionBlur&&(trailFade=e.motionBlur),e.trailSubtlety&&(te=e.trailSubtlety),e.currentTemplate&&(Rt=e.currentTemplate),e.cursorBallColor&&(At=e.cursorBallColor),void 0!==e.gridColumns&&(y=e.gridColumns),void 0!==e.gridBallCount&&(B=e.gridBallCount),void 0!==e.pulseInterval&&(f=e.pulseInterval),void 0!==e.pulseSpeed&&(v=e.pulseSpeed),void 0!==e.pulseSynchronicity&&(x=e.pulseSynchronicity),void 0!==e.pulseRandomness&&(E=e.pulseRandomness),void 0!==e.pulseMinSteps&&(I=e.pulseMinSteps),void 0!==e.pulseMaxSteps&&(M=e.pulseMaxSteps),e.pulseEasingStyle&&(b=e.pulseEasingStyle),void 0!==e.pulseOvershoot&&(w=e.pulseOvershoot),void 0!==e.pulseBounceIntensity&&(S=e.pulseBounceIntensity),void 0!==e.canvasShadowEnabled&&(C=e.canvasShadowEnabled),void 0!==e.shadowOffsetX&&(L=e.shadowOffsetX),void 0!==e.shadowOffsetY&&(V=e.shadowOffsetY),void 0!==e.shadowBlur&&(F=e.shadowBlur),void 0!==e.shadowOpacity&&(R=e.shadowOpacity),e.shadowColor&&(T=e.shadowColor),void 0!==e.shadow2Enabled&&(P=e.shadow2Enabled),void 0!==e.shadow2Blur&&(A=e.shadow2Blur),void 0!==e.shadow2Opacity&&(q=e.shadow2Opacity),void 0!==e.autoDarkModeEnabled&&(W=e.autoDarkModeEnabled),console.log("‚úì Settings loaded"),!0}}catch(t){console.warn("Could not load settings:",t)}}(),$(),J(),setInterval(J,6e4),To(a),window.addEventListener("beforeunload",Ht)})();
//# sourceMappingURL=bouncy-balls-embed.js.map