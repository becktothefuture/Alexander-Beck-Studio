!(function(e){function t(e){ya=e}function a(e,t,a,n){const o=+e;return Number.isFinite(o)?Math.min(a,Math.max(t,o)):n}function n(e,t,n,o){const i=a(e,t,n,o);return Math.round(i)}function o(){const e=+va.layoutViewportWidthPx;return Number.isFinite(e)&&e>0?e:Math.max(1,window.innerWidth||1)}function i(e,t){const a=Math.max(1,t||o()),n=+e;return Number.isFinite(n)?n/a*100:0}function r(e,t){const a=Math.max(1,t||o()),n=+e;return Number.isFinite(n)?n/100*a:0}function l(){const e=o(),t=r(va.containerBorderVw,e),a=r(va.simulationPaddingVw,e),n=r(va.contentPaddingVw,e),i=r(va.wallRadiusVw,e),l=Math.max(0,Math.round(va.layoutMinContentPaddingPx||0)),s=Math.max(0,Math.round(va.layoutMinWallRadiusPx||0)),c=r(Number.isFinite(va.wallThicknessVw)&&va.wallThicknessVw>0?va.wallThicknessVw:va.containerBorderVw,e);va.containerBorder=Math.round(t),va.simulationPadding=Math.round(a),va.contentPadding=Math.max(l,Math.round(n));const d=Math.max(.1,va.contentPaddingHorizontalRatio||1);va.contentPaddingY=va.contentPadding,va.contentPaddingX=Math.round(va.contentPadding*d),va.wallRadius=Math.max(s,Math.round(i)),va.cornerRadius=va.wallRadius,va.wallThickness=Math.round(c);const p=Math.max(0,r(va.cursorInfluenceRadiusVw||0,e));va.cursorInfluenceRadiusPx=Math.round(p),va.repelRadius=Math.round(p),va.weightlessRepelRadius=Math.round(p),va.pingPongCursorRadius=Math.round(p),va.bubblesDeflectRadius=Math.round(p)}function s(){const e=document.documentElement;e.style.setProperty("--container-border",va.containerBorder+"px"),e.style.setProperty("--simulation-padding",va.simulationPadding+"px"),e.style.setProperty("--content-padding",va.contentPadding+"px"),e.style.setProperty("--content-padding-x",va.contentPaddingX+"px"),e.style.setProperty("--content-padding-y",va.contentPaddingY+"px"),e.style.setProperty("--wall-radius",va.wallRadius+"px"),e.style.setProperty("--wall-thickness",va.wallThickness+"px")}function c(e){if(va.config={...e},void 0!==e.layoutViewportWidthPx&&(va.layoutViewportWidthPx=a(e.layoutViewportWidthPx,0,4096,0)),e.ballMass&&(va.ballMassKg=e.ballMass),void 0!==e.gravityMultiplier&&(va.gravityMultiplier=e.gravityMultiplier,va.gravityMultiplierPit=e.gravityMultiplier),e.restitution&&(va.REST=e.restitution),e.friction&&(va.FRICTION=e.friction),void 0!==e.ballScale&&(va.sizeScale=e.ballScale),void 0!==e.sizeScale&&(va.sizeScale=e.sizeScale),void 0!==e.sizeVariationGlobalMul&&(va.sizeVariationGlobalMul=a(e.sizeVariationGlobalMul,0,2,va.sizeVariationGlobalMul)),void 0!==e.sizeVariationPit&&(va.sizeVariationPit=a(e.sizeVariationPit,0,1,va.sizeVariationPit)),void 0!==e.sizeVariationPitThrows&&(va.sizeVariationPitThrows=a(e.sizeVariationPitThrows,0,1,va.sizeVariationPitThrows)),void 0!==e.sizeVariationFlies&&(va.sizeVariationFlies=a(e.sizeVariationFlies,0,1,va.sizeVariationFlies)),void 0!==e.sizeVariationWeightless&&(va.sizeVariationWeightless=a(e.sizeVariationWeightless,0,1,va.sizeVariationWeightless)),void 0!==e.sizeVariationWater&&(va.sizeVariationWater=a(e.sizeVariationWater,0,1,va.sizeVariationWater)),void 0!==e.sizeVariationVortex&&(va.sizeVariationVortex=a(e.sizeVariationVortex,0,1,va.sizeVariationVortex)),void 0!==e.sizeVariationPingPong&&(va.sizeVariationPingPong=a(e.sizeVariationPingPong,0,1,va.sizeVariationPingPong)),void 0!==e.sizeVariationMagnetic&&(va.sizeVariationMagnetic=a(e.sizeVariationMagnetic,0,1,va.sizeVariationMagnetic)),void 0!==e.sizeVariationBubbles&&(va.sizeVariationBubbles=a(e.sizeVariationBubbles,0,1,va.sizeVariationBubbles)),void 0!==e.sizeVariationKaleidoscope&&(va.sizeVariationKaleidoscope=a(e.sizeVariationKaleidoscope,0,1,va.sizeVariationKaleidoscope)),void 0!==e.sizeVariationOrbit3d&&(va.sizeVariationOrbit3d=a(e.sizeVariationOrbit3d,0,1,va.sizeVariationOrbit3d)),void 0!==e.sizeVariationCritters&&(va.sizeVariationCritters=a(e.sizeVariationCritters,0,1,va.sizeVariationCritters)),void 0!==e.sizeVariationNeural&&(va.sizeVariationNeural=a(e.sizeVariationNeural,0,1,va.sizeVariationNeural)),void 0!==e.sizeVariationLattice&&(va.sizeVariationLattice=a(e.sizeVariationLattice,0,1,va.sizeVariationLattice)),void 0!==e.sizeVariationParallaxLinear&&(va.sizeVariationParallaxLinear=a(e.sizeVariationParallaxLinear,0,1,va.sizeVariationParallaxLinear)),void 0!==e.sizeVariationParallaxPerspective&&(va.sizeVariationParallaxPerspective=a(e.sizeVariationParallaxPerspective,0,1,va.sizeVariationParallaxPerspective)),void 0!==e.sizeVariation&&(va.sizeVariation=e.sizeVariation),void 0!==e.pitWarmupFrames&&(va.pitWarmupFrames=n(e.pitWarmupFrames,0,240,va.pitWarmupFrames)),void 0!==e.pitThrowsWarmupFrames&&(va.pitThrowsWarmupFrames=n(e.pitThrowsWarmupFrames,0,240,va.pitThrowsWarmupFrames)),void 0!==e.fliesWarmupFrames&&(va.fliesWarmupFrames=n(e.fliesWarmupFrames,0,240,va.fliesWarmupFrames)),void 0!==e.weightlessWarmupFrames&&(va.weightlessWarmupFrames=n(e.weightlessWarmupFrames,0,240,va.weightlessWarmupFrames)),void 0!==e.waterWarmupFrames&&(va.waterWarmupFrames=n(e.waterWarmupFrames,0,240,va.waterWarmupFrames)),void 0!==e.vortexWarmupFrames&&(va.vortexWarmupFrames=n(e.vortexWarmupFrames,0,240,va.vortexWarmupFrames)),void 0!==e.pingPongWarmupFrames&&(va.pingPongWarmupFrames=n(e.pingPongWarmupFrames,0,240,va.pingPongWarmupFrames)),void 0!==e.magneticWarmupFrames&&(va.magneticWarmupFrames=n(e.magneticWarmupFrames,0,240,va.magneticWarmupFrames)),void 0!==e.bubblesWarmupFrames&&(va.bubblesWarmupFrames=n(e.bubblesWarmupFrames,0,240,va.bubblesWarmupFrames)),void 0!==e.kaleidoscopeWarmupFrames&&(va.kaleidoscopeWarmupFrames=n(e.kaleidoscopeWarmupFrames,0,240,va.kaleidoscopeWarmupFrames)),void 0!==e.kaleidoscope1WarmupFrames&&(va.kaleidoscope1WarmupFrames=n(e.kaleidoscope1WarmupFrames,0,240,va.kaleidoscope1WarmupFrames)),void 0!==e.kaleidoscope2WarmupFrames&&(va.kaleidoscope2WarmupFrames=n(e.kaleidoscope2WarmupFrames,0,240,va.kaleidoscope2WarmupFrames)),void 0!==e.kaleidoscope3WarmupFrames&&(va.kaleidoscope3WarmupFrames=n(e.kaleidoscope3WarmupFrames,0,240,va.kaleidoscope3WarmupFrames)),void 0!==e.orbit3dWarmupFrames&&(va.orbit3dWarmupFrames=n(e.orbit3dWarmupFrames,0,240,va.orbit3dWarmupFrames)),void 0!==e.orbit3d2WarmupFrames&&(va.orbit3d2WarmupFrames=n(e.orbit3d2WarmupFrames,0,240,va.orbit3d2WarmupFrames)),void 0!==e.crittersWarmupFrames&&(va.crittersWarmupFrames=n(e.crittersWarmupFrames,0,240,va.crittersWarmupFrames)),void 0!==e.neuralWarmupFrames&&(va.neuralWarmupFrames=n(e.neuralWarmupFrames,0,240,va.neuralWarmupFrames)),void 0!==e.latticeWarmupFrames&&(va.latticeWarmupFrames=n(e.latticeWarmupFrames,0,240,va.latticeWarmupFrames)),void 0!==e.parallaxLinearWarmupFrames&&(va.parallaxLinearWarmupFrames=n(e.parallaxLinearWarmupFrames,0,240,va.parallaxLinearWarmupFrames)),void 0!==e.parallaxPerspectiveWarmupFrames&&(va.parallaxPerspectiveWarmupFrames=n(e.parallaxPerspectiveWarmupFrames,0,240,va.parallaxPerspectiveWarmupFrames)),g(),void 0!==e.maxBalls&&(va.maxBalls=e.maxBalls),void 0!==e.repelRadius&&(va.repelRadius=e.repelRadius),void 0!==e.repelPower&&(va.repelPower=e.repelPower),void 0!==e.repelSoft&&(va.repelSoft=e.repelSoft),void 0!==e.repelSoftness&&(va.repelSoft=e.repelSoftness),void 0!==e.cursorInfluenceRadiusVw?va.cursorInfluenceRadiusVw=a(e.cursorInfluenceRadiusVw,0,80,va.cursorInfluenceRadiusVw):void 0!==e.repelRadius&&(va.cursorInfluenceRadiusVw=a(e.repelRadius/10,0,80,va.cursorInfluenceRadiusVw)),void 0!==e.responsiveScaleMobile&&(va.responsiveScaleMobile=e.responsiveScaleMobile),void 0!==e.mobileObjectReductionFactor&&(va.mobileObjectReductionFactor=a(e.mobileObjectReductionFactor,0,1,va.mobileObjectReductionFactor)),m(),void 0!==e.kaleidoscopeBallCount&&(va.kaleidoscopeBallCount=a(e.kaleidoscopeBallCount,10,300,va.kaleidoscopeBallCount)),void 0!==e.kaleidoscopeDotSizeVh&&(va.kaleidoscopeDotSizeVh=a(e.kaleidoscopeDotSizeVh,.1,6,va.kaleidoscopeDotSizeVh)),void 0!==e.kaleidoscopeDotAreaMul&&(va.kaleidoscopeDotAreaMul=a(e.kaleidoscopeDotAreaMul,.1,2,va.kaleidoscopeDotAreaMul)),void 0!==e.kaleidoscopeSpawnAreaMul&&(va.kaleidoscopeSpawnAreaMul=a(e.kaleidoscopeSpawnAreaMul,.2,2,va.kaleidoscopeSpawnAreaMul)),void 0!==e.kaleidoscopeSizeVariance&&(va.kaleidoscopeSizeVariance=a(e.kaleidoscopeSizeVariance,0,1,va.kaleidoscopeSizeVariance)),void 0!==e.kaleidoscope1BallCount&&(va.kaleidoscope1BallCount=a(e.kaleidoscope1BallCount,3,300,va.kaleidoscope1BallCount)),void 0!==e.kaleidoscope1Wedges&&(va.kaleidoscope1Wedges=a(e.kaleidoscope1Wedges,3,24,va.kaleidoscope1Wedges)),void 0!==e.kaleidoscope1Speed&&(va.kaleidoscope1Speed=a(e.kaleidoscope1Speed,.2,2,va.kaleidoscope1Speed)),void 0!==e.kaleidoscope1DotSizeVh&&(va.kaleidoscope1DotSizeVh=a(e.kaleidoscope1DotSizeVh,.1,6,va.kaleidoscope1DotSizeVh)),void 0!==e.kaleidoscope1DotAreaMul&&(va.kaleidoscope1DotAreaMul=a(e.kaleidoscope1DotAreaMul,.1,2,va.kaleidoscope1DotAreaMul)),void 0!==e.kaleidoscope1SpawnAreaMul&&(va.kaleidoscope1SpawnAreaMul=a(e.kaleidoscope1SpawnAreaMul,.2,2,va.kaleidoscope1SpawnAreaMul)),void 0!==e.kaleidoscope1SizeVariance&&(va.kaleidoscope1SizeVariance=a(e.kaleidoscope1SizeVariance,0,1,va.kaleidoscope1SizeVariance)),void 0!==e.kaleidoscope2BallCount&&(va.kaleidoscope2BallCount=a(e.kaleidoscope2BallCount,3,300,va.kaleidoscope2BallCount)),void 0!==e.kaleidoscope2Wedges&&(va.kaleidoscope2Wedges=a(e.kaleidoscope2Wedges,3,24,va.kaleidoscope2Wedges)),void 0!==e.kaleidoscope2Speed&&(va.kaleidoscope2Speed=a(e.kaleidoscope2Speed,.2,2,va.kaleidoscope2Speed)),void 0!==e.kaleidoscope2DotSizeVh&&(va.kaleidoscope2DotSizeVh=a(e.kaleidoscope2DotSizeVh,.1,6,va.kaleidoscope2DotSizeVh)),void 0!==e.kaleidoscope2DotAreaMul&&(va.kaleidoscope2DotAreaMul=a(e.kaleidoscope2DotAreaMul,.1,2,va.kaleidoscope2DotAreaMul)),void 0!==e.kaleidoscope2SpawnAreaMul&&(va.kaleidoscope2SpawnAreaMul=a(e.kaleidoscope2SpawnAreaMul,.2,2,va.kaleidoscope2SpawnAreaMul)),void 0!==e.kaleidoscope2SizeVariance&&(va.kaleidoscope2SizeVariance=a(e.kaleidoscope2SizeVariance,0,1,va.kaleidoscope2SizeVariance)),void 0!==e.kaleidoscope3BallCount&&(va.kaleidoscope3BallCount=a(e.kaleidoscope3BallCount,3,300,va.kaleidoscope3BallCount)),void 0!==e.kaleidoscope3Wedges&&(va.kaleidoscope3Wedges=a(e.kaleidoscope3Wedges,3,24,va.kaleidoscope3Wedges)),void 0!==e.kaleidoscope3Speed&&(va.kaleidoscope3Speed=a(e.kaleidoscope3Speed,.2,2,va.kaleidoscope3Speed)),void 0!==e.kaleidoscope3DotSizeVh&&(va.kaleidoscope3DotSizeVh=a(e.kaleidoscope3DotSizeVh,.1,6,va.kaleidoscope3DotSizeVh)),void 0!==e.kaleidoscope3DotAreaMul&&(va.kaleidoscope3DotAreaMul=a(e.kaleidoscope3DotAreaMul,.1,2,va.kaleidoscope3DotAreaMul)),void 0!==e.kaleidoscope3SpawnAreaMul&&(va.kaleidoscope3SpawnAreaMul=a(e.kaleidoscope3SpawnAreaMul,.2,2,va.kaleidoscope3SpawnAreaMul)),void 0!==e.kaleidoscope3SizeVariance&&(va.kaleidoscope3SizeVariance=a(e.kaleidoscope3SizeVariance,0,1,va.kaleidoscope3SizeVariance)),void 0!==e.kaleidoscopeWedges?va.kaleidoscopeWedges=a(e.kaleidoscopeWedges,3,24,va.kaleidoscopeWedges):void 0!==e.kaleidoscopeSegments&&(va.kaleidoscopeWedges=a(e.kaleidoscopeSegments,3,24,va.kaleidoscopeWedges)),void 0!==e.kaleidoscopeMirror&&(va.kaleidoscopeMirror=a(e.kaleidoscopeMirror,0,1,va.kaleidoscopeMirror)),void 0!==e.kaleidoscopeSpeed)va.kaleidoscopeSpeed=a(e.kaleidoscopeSpeed,.2,2,va.kaleidoscopeSpeed);else if(void 0!==e.kaleidoscopeSwirlStrength){const t=a(e.kaleidoscopeSwirlStrength,0,800,52);va.kaleidoscopeSpeed=a(.2+t/800*1.8,.2,2,va.kaleidoscopeSpeed)}void 0!==e.critterCount&&(va.critterCount=e.critterCount),void 0!==e.critterSpeed&&(va.critterSpeed=e.critterSpeed),void 0!==e.critterMaxSpeed&&(va.critterMaxSpeed=e.critterMaxSpeed),void 0!==e.critterStepHz&&(va.critterStepHz=e.critterStepHz),void 0!==e.critterStepSharpness&&(va.critterStepSharpness=e.critterStepSharpness),void 0!==e.critterTurnNoise&&(va.critterTurnNoise=e.critterTurnNoise),void 0!==e.critterTurnDamp&&(va.critterTurnDamp=e.critterTurnDamp),void 0!==e.critterTurnSeek&&(va.critterTurnSeek=e.critterTurnSeek),void 0!==e.critterAvoidRadius&&(va.critterAvoidRadius=e.critterAvoidRadius),void 0!==e.critterAvoidForce&&(va.critterAvoidForce=e.critterAvoidForce),void 0!==e.critterEdgeAvoid&&(va.critterEdgeAvoid=e.critterEdgeAvoid),void 0!==e.critterMousePull&&(va.critterMousePull=e.critterMousePull),void 0!==e.layoutMinContentPaddingPx&&(va.layoutMinContentPaddingPx=a(e.layoutMinContentPaddingPx,0,200,va.layoutMinContentPaddingPx)),void 0!==e.layoutMinWallRadiusPx&&(va.layoutMinWallRadiusPx=a(e.layoutMinWallRadiusPx,0,400,va.layoutMinWallRadiusPx)),void 0!==e.critterMouseRadiusVw&&(va.critterMouseRadiusVw=e.critterMouseRadiusVw),void 0!==e.critterRestitution&&(va.critterRestitution=e.critterRestitution),void 0!==e.critterFriction&&(va.critterFriction=e.critterFriction),void 0!==e.neuralBallCount&&(va.neuralBallCount=a(e.neuralBallCount,8,260,va.neuralBallCount)),void 0!==e.neuralLinkDistanceVw&&(va.neuralLinkDistanceVw=a(e.neuralLinkDistanceVw,1,50,va.neuralLinkDistanceVw)),void 0!==e.neuralLineOpacity&&(va.neuralLineOpacity=a(e.neuralLineOpacity,0,1,va.neuralLineOpacity)),void 0!==e.neuralWanderStrength&&(va.neuralWanderStrength=a(e.neuralWanderStrength,0,4e3,va.neuralWanderStrength)),void 0!==e.neuralMaxLinksPerBall&&(va.neuralMaxLinksPerBall=a(e.neuralMaxLinksPerBall,0,16,va.neuralMaxLinksPerBall)),void 0!==e.neuralDamping&&(va.neuralDamping=a(e.neuralDamping,.8,1,va.neuralDamping)),void 0!==e.latticeBallCount&&(va.latticeBallCount=a(e.latticeBallCount,8,260,va.latticeBallCount)),void 0!==e.latticeSpacingVw&&(va.latticeSpacingVw=a(e.latticeSpacingVw,1,40,va.latticeSpacingVw)),void 0!==e.latticeStiffness&&(va.latticeStiffness=a(e.latticeStiffness,0,20,va.latticeStiffness)),void 0!==e.latticeDamping&&(va.latticeDamping=a(e.latticeDamping,.5,1,va.latticeDamping)),void 0!==e.latticeDisruptRadius&&(va.latticeDisruptRadius=a(e.latticeDisruptRadius,50,800,va.latticeDisruptRadius)),void 0!==e.latticeDisruptPower&&(va.latticeDisruptPower=a(e.latticeDisruptPower,0,20,va.latticeDisruptPower)),void 0!==e.latticeMeshWaveStrength&&(va.latticeMeshWaveStrength=a(e.latticeMeshWaveStrength,0,50,va.latticeMeshWaveStrength)),void 0!==e.latticeMeshWaveSpeed&&(va.latticeMeshWaveSpeed=a(e.latticeMeshWaveSpeed,0,3,va.latticeMeshWaveSpeed)),void 0!==e.latticeAlignment&&(va.latticeAlignment=e.latticeAlignment+""),void 0!==e.parallaxLinearDotCount&&(va.parallaxLinearDotCount=a(e.parallaxLinearDotCount,20,220,va.parallaxLinearDotCount)),void 0!==e.parallaxLinearGridJitter&&(va.parallaxLinearGridJitter=a(e.parallaxLinearGridJitter,0,1,va.parallaxLinearGridJitter)),void 0!==e.parallaxLinearFarSpeed&&(va.parallaxLinearFarSpeed=a(e.parallaxLinearFarSpeed,0,1.5,va.parallaxLinearFarSpeed)),void 0!==e.parallaxLinearMidSpeed&&(va.parallaxLinearMidSpeed=a(e.parallaxLinearMidSpeed,0,1.5,va.parallaxLinearMidSpeed)),void 0!==e.parallaxLinearNearSpeed&&(va.parallaxLinearNearSpeed=a(e.parallaxLinearNearSpeed,0,1.5,va.parallaxLinearNearSpeed)),void 0!==e.parallaxLinearGridX&&(va.parallaxLinearGridX=n(e.parallaxLinearGridX,3,40,va.parallaxLinearGridX)),void 0!==e.parallaxLinearGridY&&(va.parallaxLinearGridY=n(e.parallaxLinearGridY,3,40,va.parallaxLinearGridY)),void 0!==e.parallaxLinearGridZ&&(va.parallaxLinearGridZ=n(e.parallaxLinearGridZ,2,20,va.parallaxLinearGridZ)),void 0!==e.parallaxLinearSpanX&&(va.parallaxLinearSpanX=a(e.parallaxLinearSpanX,.2,3,va.parallaxLinearSpanX)),void 0!==e.parallaxLinearSpanY&&(va.parallaxLinearSpanY=a(e.parallaxLinearSpanY,.2,3,va.parallaxLinearSpanY)),void 0!==e.parallaxLinearZNear&&(va.parallaxLinearZNear=a(e.parallaxLinearZNear,10,1200,va.parallaxLinearZNear)),void 0!==e.parallaxLinearZFar&&(va.parallaxLinearZFar=a(e.parallaxLinearZFar,50,3e3,va.parallaxLinearZFar)),void 0!==e.parallaxLinearFocalLength&&(va.parallaxLinearFocalLength=a(e.parallaxLinearFocalLength,80,2e3,va.parallaxLinearFocalLength)),void 0!==e.parallaxLinearParallaxStrength&&(va.parallaxLinearParallaxStrength=a(e.parallaxLinearParallaxStrength,0,2e3,va.parallaxLinearParallaxStrength)),void 0!==e.parallaxLinearDotSizeMul&&(va.parallaxLinearDotSizeMul=a(e.parallaxLinearDotSizeMul,.1,6,va.parallaxLinearDotSizeMul)),void 0!==e.parallaxLinearFollowStrength&&(va.parallaxLinearFollowStrength=a(e.parallaxLinearFollowStrength,1,80,va.parallaxLinearFollowStrength)),void 0!==e.parallaxLinearDamping&&(va.parallaxLinearDamping=a(e.parallaxLinearDamping,1,80,va.parallaxLinearDamping)),void 0!==e.parallaxPerspectiveDotCount&&(va.parallaxPerspectiveDotCount=a(e.parallaxPerspectiveDotCount,40,420,va.parallaxPerspectiveDotCount)),void 0!==e.parallaxPerspectiveDepthMul&&(va.parallaxPerspectiveDepthMul=a(e.parallaxPerspectiveDepthMul,.5,3,va.parallaxPerspectiveDepthMul)),void 0!==e.parallaxPerspectiveFocalLength&&(va.parallaxPerspectiveFocalLength=a(e.parallaxPerspectiveFocalLength,80,1e3,va.parallaxPerspectiveFocalLength)),void 0!==e.parallaxPerspectiveFollowStrength&&(va.parallaxPerspectiveFollowStrength=a(e.parallaxPerspectiveFollowStrength,1,40,va.parallaxPerspectiveFollowStrength)),void 0!==e.parallaxPerspectiveDamping&&(va.parallaxPerspectiveDamping=a(e.parallaxPerspectiveDamping,1,40,va.parallaxPerspectiveDamping)),void 0!==e.parallaxPerspectiveZ1&&(va.parallaxPerspectiveZ1=a(e.parallaxPerspectiveZ1,200,2e3,va.parallaxPerspectiveZ1)),void 0!==e.parallaxPerspectiveZ2&&(va.parallaxPerspectiveZ2=a(e.parallaxPerspectiveZ2,150,1500,va.parallaxPerspectiveZ2)),void 0!==e.parallaxPerspectiveZ3&&(va.parallaxPerspectiveZ3=a(e.parallaxPerspectiveZ3,100,1e3,va.parallaxPerspectiveZ3)),void 0!==e.parallaxPerspectiveZ4&&(va.parallaxPerspectiveZ4=a(e.parallaxPerspectiveZ4,40,600,va.parallaxPerspectiveZ4)),void 0!==e.parallaxPerspectiveZ5&&(va.parallaxPerspectiveZ5=a(e.parallaxPerspectiveZ5,10,300,va.parallaxPerspectiveZ5)),void 0!==e.parallaxPerspectiveGridX&&(va.parallaxPerspectiveGridX=n(e.parallaxPerspectiveGridX,3,50,va.parallaxPerspectiveGridX)),void 0!==e.parallaxPerspectiveGridY&&(va.parallaxPerspectiveGridY=n(e.parallaxPerspectiveGridY,3,50,va.parallaxPerspectiveGridY)),void 0!==e.parallaxPerspectiveGridZ&&(va.parallaxPerspectiveGridZ=n(e.parallaxPerspectiveGridZ,2,25,va.parallaxPerspectiveGridZ)),void 0!==e.parallaxPerspectiveSpanX&&(va.parallaxPerspectiveSpanX=a(e.parallaxPerspectiveSpanX,.2,3,va.parallaxPerspectiveSpanX)),void 0!==e.parallaxPerspectiveSpanY&&(va.parallaxPerspectiveSpanY=a(e.parallaxPerspectiveSpanY,.2,3,va.parallaxPerspectiveSpanY)),void 0!==e.parallaxPerspectiveZNear&&(va.parallaxPerspectiveZNear=a(e.parallaxPerspectiveZNear,10,1200,va.parallaxPerspectiveZNear)),void 0!==e.parallaxPerspectiveZFar&&(va.parallaxPerspectiveZFar=a(e.parallaxPerspectiveZFar,50,4e3,va.parallaxPerspectiveZFar)),void 0!==e.parallaxPerspectiveParallaxStrength&&(va.parallaxPerspectiveParallaxStrength=a(e.parallaxPerspectiveParallaxStrength,0,2e3,va.parallaxPerspectiveParallaxStrength)),void 0!==e.parallaxPerspectiveRandomness&&(va.parallaxPerspectiveRandomness=a(e.parallaxPerspectiveRandomness,0,1,va.parallaxPerspectiveRandomness)),void 0!==e.parallaxPerspectiveDotSizeMul&&(va.parallaxPerspectiveDotSizeMul=a(e.parallaxPerspectiveDotSizeMul,.1,6,va.parallaxPerspectiveDotSizeMul));for(const[a,n]of Object.entries(e||{}))a in va&&"config"!==a&&"soundConfig"!==a&&"soundPreset"!==a&&"function"!=typeof va[a]&&(Array.isArray(n)||null===n||["string","number","boolean"].includes(typeof n))&&void 0!==n&&(va[a]=n);void 0!==e.sceneImpactEnabled&&(va.sceneImpactEnabled=!!e.sceneImpactEnabled),void 0!==e.sceneImpactMul?va.sceneImpactMul=a(e.sceneImpactMul,0,.05,va.sceneImpactMul):void 0!==e.brandLogoImpactMul&&(va.sceneImpactMul=a(e.brandLogoImpactMul,0,.05,va.sceneImpactMul)),void 0!==e.sceneImpactOvershoot?va.sceneImpactOvershoot=a(e.sceneImpactOvershoot,0,.8,va.sceneImpactOvershoot):void 0!==e.brandLogoOvershoot&&(va.sceneImpactOvershoot=a(e.brandLogoOvershoot,0,.8,va.sceneImpactOvershoot)),void 0!==e.sceneImpactAnticipation?va.sceneImpactAnticipation=a(e.sceneImpactAnticipation,0,.6,va.sceneImpactAnticipation):void 0!==e.brandLogoAnticipation&&(va.sceneImpactAnticipation=a(e.brandLogoAnticipation,0,.6,va.sceneImpactAnticipation)),void 0!==e.sceneImpactPressMs?va.sceneImpactPressMs=a(e.sceneImpactPressMs,20,300,va.sceneImpactPressMs):void 0!==e.brandLogoPressMs&&(va.sceneImpactPressMs=a(e.brandLogoPressMs,20,300,va.sceneImpactPressMs)),void 0!==e.sceneImpactReleaseMs?va.sceneImpactReleaseMs=a(e.sceneImpactReleaseMs,40,1200,va.sceneImpactReleaseMs):void 0!==e.brandLogoReleaseMs&&(va.sceneImpactReleaseMs=a(e.brandLogoReleaseMs,40,1200,va.sceneImpactReleaseMs)),void 0!==e.sceneChangeSoundEnabled&&(va.sceneChangeSoundEnabled=!!e.sceneChangeSoundEnabled),void 0!==e.sceneChangeSoundIntensity&&(va.sceneChangeSoundIntensity=a(e.sceneChangeSoundIntensity,0,1,va.sceneChangeSoundIntensity)),void 0!==e.sceneChangeSoundRadius&&(va.sceneChangeSoundRadius=a(e.sceneChangeSoundRadius,6,60,va.sceneChangeSoundRadius)),void 0!==e.containerBorder&&(va.containerBorder=e.containerBorder),void 0!==e.simulationPadding&&(va.simulationPadding=e.simulationPadding),void 0!==e.contentPadding&&(va.contentPadding=e.contentPadding),void 0!==e.bgLight&&(va.bgLight=e.bgLight),void 0!==e.bgDark&&(va.bgDark=e.bgDark),void 0!==e.frameColor&&(va.frameColor=e.frameColor),void 0!==e.textColorLight&&(va.textColorLight=e.textColorLight),void 0!==e.textColorLightMuted&&(va.textColorLightMuted=e.textColorLightMuted),void 0!==e.textColorDark&&(va.textColorDark=e.textColorDark),void 0!==e.textColorDarkMuted&&(va.textColorDarkMuted=e.textColorDarkMuted),void 0!==e.linkHoverColor&&(va.linkHoverColor=e.linkHoverColor),void 0!==e.logoColorLight&&(va.logoColorLight=e.logoColorLight),void 0!==e.logoColorDark&&(va.logoColorDark=e.logoColorDark),void 0!==e.noiseBackOpacity&&(va.noiseBackOpacity=a(e.noiseBackOpacity,0,.3,va.noiseBackOpacity)),void 0!==e.noiseFrontOpacity&&(va.noiseFrontOpacity=a(e.noiseFrontOpacity,0,.3,va.noiseFrontOpacity)),void 0!==e.noiseBackOpacityDark&&(va.noiseBackOpacityDark=a(e.noiseBackOpacityDark,0,.5,va.noiseBackOpacityDark)),void 0!==e.noiseFrontOpacityDark&&(va.noiseFrontOpacityDark=a(e.noiseFrontOpacityDark,0,.5,va.noiseFrontOpacityDark)),void 0!==e.wallThickness&&(va.wallThickness=e.wallThickness),void 0!==e.wallRadius&&(va.wallRadius=e.wallRadius,va.cornerRadius=e.wallRadius),void 0!==e.wallInset&&(va.wallInset=e.wallInset),void 0!==e.wallInset&&(va.wallInset=e.wallInset),void 0!==e.ballSpacing&&(va.ballSpacing=e.ballSpacing),void 0!==e.wallPreset&&(va.wallPreset=e.wallPreset),void 0!==e.wallSoftness&&(va.wallSoftness=e.wallSoftness),void 0!==e.wallBounciness&&(va.wallBounciness=e.wallBounciness),void 0!==e.wallWobbleMaxDeform&&(va.wallWobbleMaxDeform=e.wallWobbleMaxDeform),void 0!==e.wallWobbleStiffness&&(va.wallWobbleStiffness=e.wallWobbleStiffness),void 0!==e.wallWobbleDamping&&(va.wallWobbleDamping=e.wallWobbleDamping),void 0!==e.wallWobbleSigma&&(va.wallWobbleSigma=e.wallWobbleSigma),void 0!==e.wallWobbleCornerClamp&&(va.wallWobbleCornerClamp=e.wallWobbleCornerClamp),void 0!==e.wallWobbleImpactThreshold&&(va.wallWobbleImpactThreshold=e.wallWobbleImpactThreshold),void 0!==e.wallWobbleSettlingSpeed&&(va.wallWobbleSettlingSpeed=e.wallWobbleSettlingSpeed),void 0!==e.gateOverlayEnabled&&(va.gateOverlayEnabled=e.gateOverlayEnabled),void 0!==e.gateOverlayOpacity&&(va.gateOverlayOpacity=e.gateOverlayOpacity),void 0!==e.gateOverlayBlurPx&&(va.gateOverlayBlurPx=e.gateOverlayBlurPx),void 0!==e.gateOverlayTransitionMs&&(va.gateOverlayTransitionMs=e.gateOverlayTransitionMs),void 0!==e.gateOverlayTransitionOutMs&&(va.gateOverlayTransitionOutMs=e.gateOverlayTransitionOutMs),void 0!==e.orbit3dMoonCount&&(va.orbit3dMoonCount=a(e.orbit3dMoonCount,1,1e3,va.orbit3dMoonCount)),void 0!==e.orbit3dGravity&&(va.orbit3dGravity=a(e.orbit3dGravity,1e3,5e5,va.orbit3dGravity)),void 0!==e.orbit3dMoonMass&&(va.orbit3dMoonMass=a(e.orbit3dMoonMass,.1,100,va.orbit3dMoonMass)),void 0!==e.orbit3dVelocityMult&&(va.orbit3dVelocityMult=a(e.orbit3dVelocityMult,10,1e3,va.orbit3dVelocityMult)),void 0!==e.orbit3dTargetOrbit&&(va.orbit3dTargetOrbit=a(e.orbit3dTargetOrbit,1,100,va.orbit3dTargetOrbit)),void 0!==e.orbit3dMinOrbit&&(va.orbit3dMinOrbit=a(e.orbit3dMinOrbit,1,100,va.orbit3dMinOrbit)),void 0!==e.orbit3dMaxOrbit&&(va.orbit3dMaxOrbit=a(e.orbit3dMaxOrbit,1,200,va.orbit3dMaxOrbit)),void 0!==e.orbit3dDepthScale&&(va.orbit3dDepthScale=a(e.orbit3dDepthScale,0,1.5,va.orbit3dDepthScale)),void 0!==e.orbit3dDamping&&(va.orbit3dDamping=a(e.orbit3dDamping,.01,.2,va.orbit3dDamping)),void 0!==e.orbit3d2MoonCount&&(va.orbit3d2MoonCount=a(e.orbit3d2MoonCount,1,300,va.orbit3d2MoonCount)),void 0!==e.orbit3d2Gravity&&(va.orbit3d2Gravity=a(e.orbit3d2Gravity,1e3,5e5,va.orbit3d2Gravity)),void 0!==e.orbit3d2VelocityMult&&(va.orbit3d2VelocityMult=a(e.orbit3d2VelocityMult,.1,2,va.orbit3d2VelocityMult)),void 0!==e.orbit3d2MinOrbit&&(va.orbit3d2MinOrbit=a(e.orbit3d2MinOrbit,1,50,va.orbit3d2MinOrbit)),void 0!==e.orbit3d2MaxOrbit&&(va.orbit3d2MaxOrbit=a(e.orbit3d2MaxOrbit,1,50,va.orbit3d2MaxOrbit)),void 0!==e.orbit3d2DepthScale&&(va.orbit3d2DepthScale=a(e.orbit3d2DepthScale,0,.95,va.orbit3d2DepthScale)),void 0!==e.orbit3d2Damping&&(va.orbit3d2Damping=a(e.orbit3d2Damping,0,1,va.orbit3d2Damping)),void 0!==e.orbit3d2FollowSmoothing&&(va.orbit3d2FollowSmoothing=a(e.orbit3d2FollowSmoothing,1,200,va.orbit3d2FollowSmoothing)),void 0!==e.orbit3d2Softening&&(va.orbit3d2Softening=a(e.orbit3d2Softening,1,100,va.orbit3d2Softening));const t=o();void 0!==e.containerBorderVw&&(va.containerBorderVw=a(e.containerBorderVw,0,20,va.containerBorderVw)),void 0!==e.simulationPaddingVw&&(va.simulationPaddingVw=a(e.simulationPaddingVw,0,20,va.simulationPaddingVw)),void 0!==e.contentPaddingVw&&(va.contentPaddingVw=a(e.contentPaddingVw,0,40,va.contentPaddingVw)),void 0!==e.contentPaddingHorizontalRatio&&(va.contentPaddingHorizontalRatio=a(e.contentPaddingHorizontalRatio,.1,3,va.contentPaddingHorizontalRatio)),void 0!==e.wallRadiusVw&&(va.wallRadiusVw=a(e.wallRadiusVw,0,40,va.wallRadiusVw)),void 0!==e.wallThicknessVw&&(va.wallThicknessVw=a(e.wallThicknessVw,0,20,va.wallThicknessVw)),Number.isFinite(va.containerBorderVw)&&va.containerBorderVw>0||(va.containerBorderVw=i(va.containerBorder,t)),Number.isFinite(va.simulationPaddingVw)&&va.simulationPaddingVw>=0||(va.simulationPaddingVw=i(va.simulationPadding,t)),Number.isFinite(va.contentPaddingVw)&&va.contentPaddingVw>0||(va.contentPaddingVw=i(va.contentPadding,t)),Number.isFinite(va.wallRadiusVw)&&va.wallRadiusVw>0||(va.wallRadiusVw=i(va.wallRadius,t)),Number.isFinite(va.wallThicknessVw)&&va.wallThicknessVw>0||(va.wallThicknessVw=i(va.wallThickness,t)),l()}function d(){return va}function p(e){const t=d(),a=Math.round(+e||0);return Math.max(0,t.isMobile?Math.round(a*Math.max(0,Math.min(1,+(t.mobileObjectReductionFactor??.7)))):a)}function u(e,t,a){va.canvas=e,va.ctx=t,va.container=a}function h(e){va.currentMode=e}function f(){va.balls.length=0}function m(){const e=navigator.userAgent||"",t=/iPad/.test(e)||/Mac/.test(e)&&navigator.maxTouchPoints>1,a=/iPhone/.test(e);let n=!1;try{n=!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(s){}const o=!(!t&&!a),i=n,r=o,l=o||n?va.responsiveScaleMobile:1;if(va.isMobile!==r||va.isMobileViewport!==i||Math.abs((va.responsiveScale??1)-l)>1e-6){va.isMobile=r,va.isMobileViewport=i,va.responsiveScale=l,(va.isMobile||va.isMobileViewport)&&console.log(`✓ Mobile scaling active - ball scale: ${va.responsiveScale}x (${va.isMobile?"device":"viewport"})`),g();try{const e=(va.R_MIN+va.R_MAX)/2;if(Number.isFinite(e)&&e>0&&Array.isArray(va.balls)&&va.balls.length)for(let t=0;va.balls.length>t;t++){const a=va.balls[t];a&&(a.r=e,a.rBase=e)}}catch(s){}}}function g(){va.R_MED=Math.max(1,(va.R_MIN_BASE+va.R_MAX_BASE)/2*va.sizeScale*va.responsiveScale);const e=a(va.sizeVariationCap,0,.5,.12),t=a(va.sizeVariationGlobalMul,0,2,1),n=a(e*t,0,.5,e);va.R_MIN=Math.max(1,va.R_MED*(1-n)),va.R_MAX=Math.max(va.R_MIN,va.R_MED*(1+n))}function b(e,t,a){const n=+e;if(!Number.isFinite(n))return t;const o=Math.floor(n);return t>o?t:o>a?a:o}function M(e){return Array.isArray(e)&&e.every(e=>Number.isFinite(+e))}function y(e){const t=((e||"")+"").trim();if(!t)return null;const a="#"===t[0]?t.slice(1):t;if(3!==a.length&&6!==a.length)return null;const n=parseInt(3===a.length?a[0]+a[0]+a[1]+a[1]+a[2]+a[2]:a,16);return Number.isFinite(n)?{r:(n>>16&255)/255,g:(n>>8&255)/255,b:(255&n)/255}:null}function v(e){return e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92}function x(e){const t=y(e);return t?.2126*v(t.r)+.7152*v(t.g)+.0722*v(t.b):1}function w(e){const t=y(e);if(!t)return 0;const a=Math.max(t.r,t.g,t.b);return a>0?(a-Math.min(t.r,t.g,t.b))/a:0}function S(e,t){const a=t||d(),n=e&&e.length?e:[],o=Math.min(7,n.length-1);if(0>o)return[];const i=Number.isFinite(+a.cursorColorLumaMax)?+a.cursorColorLumaMax:.62,r=M(a.cursorColorAllowIndices)?a.cursorColorAllowIndices.map(e=>b(e,0,7)):[],l=M(a.cursorColorDenyIndices)?a.cursorColorDenyIndices.map(e=>b(e,0,7)):[],s=new Set(l),c=r.length?new Set(r):null,p=[];for(let d=0;o>=d;d++){if(s.has(d))continue;if(c&&!c.has(d))continue;const e=n[d];e&&(x(e)>i||.18>w(e)||p.push(d))}if(p.length)return p;const u=[];for(const d of Ca)d>o||s.has(d)||c&&!c.has(d)||u.push(d);if(u.length)return u;for(let d=0;o>=d;d++)s.has(d)||c&&!c.has(d)||u.push(d);return u}function C(e,{forceMode:t}={}){const a=d(),n=a.currentColors,o=S(n,a),i=b(e,0,7),r=o.includes(i)?i:o[0]??i,l=((e,t)=>{const a=e&&e.length?e:[];return a[b(t,0,Math.max(0,Math.min(7,a.length-1)))]||"#000000"})(n,r);return t&&(a.cursorColorMode=t),a.cursorColorIndex=r,a.cursorColorHex=l,(e=>{try{document.documentElement.style.setProperty("--cursor-color",(e+"").trim()||"#000000")}catch(t){}})(l),{index:r,hex:l}}function P(){const e=d();if("auto"!==e.cursorColorMode)return C(e.cursorColorIndex,{forceMode:e.cursorColorMode}),!1;const t=S(e.currentColors,e);if(!t.length)return!1;const a=Number.isFinite(+e.o)?+e.o:-1;let n=t[Math.random()*t.length|0];return t.length>1&&n===a&&(n=t[Math.random()*t.length|0],n===a&&(n=t[(t.indexOf(a)+1)%t.length])),e.o=n,C(n,{forceMode:"auto"}),!0}function k(e){const t=d(),a=wa[e];return a?t.isDarkMode?a.dark:a.light:wa.industrialTeal.light}function F(){const e=d().currentColors;if(!e||0===e.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let a=0;for(let n=0;Math.min(e.length,8)>n;n++)if(a+=Sa[n],a>=t)return e[n];return e[Math.min(e.length-1,7)]}function T(e){const t=d().currentColors;return t&&0!==t.length?t[Math.max(0,Math.min(7,Math.floor(e)))]||"#ffffff":(console.warn("No colors available, using fallback"),"#ffffff")}function D(e){const t=d();t.currentTemplate=e,t.currentColors=k(e),"auto"!==t.cursorColorMode&&"manual"!==t.cursorColorMode&&(t.cursorColorMode="auto"),C(t.cursorColorIndex,{forceMode:t.cursorColorMode}),(()=>{const e=d(),t=e.balls,a=e.currentColors;if(t.length>0&&a&&a.length>0){const e=Math.min(8,a.length,t.length),n=Math.floor(Math.random()*e);for(let o=0;e>o;o++)t[o].color=a[(n+o)%e];for(let a=e;t.length>a;a++)t[a].color=F();return}for(let n=0;t.length>n;n++)t[n].color=F()})(),(e=>{try{const t=document.documentElement,a=(e&&e.length?e:[]).slice(0,8);for(let e=0;8>e;e++)t.style.setProperty("--ball-"+(e+1),a[e]||"#ffffff")}catch(t){}})(t.currentColors),(()=>{const e=d().currentColors;for(let t=1;8>=t;t++){const a=document.getElementById("color"+t),n=document.getElementById(`color${t}Val`);a&&e[t-1]&&(a.value=e[t-1],n&&(n.textContent=e[t-1].toUpperCase()))}})();try{window.dispatchEvent(new CustomEvent("bb:paletteChanged",{detail:{template:e}}))}catch(a){}}function L(){const e=document.getElementById("colorSelect");if(!e)return;e.innerHTML="";for(const[a,n]of Object.entries(wa)){const t=document.createElement("option");t.value=a,t.textContent=n.label,e.appendChild(t)}const t=d();e.value=t.currentTemplate}function A(e,t=.15){return e*(1+2*(Math.random()-.5)*t)}function I(){try{"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent(Wa,{detail:W()}))}catch(e){}}function K(){if(!ja&&(ja=!0,"undefined"!=typeof window&&window.matchMedia)){const e=window.matchMedia("(prefers-reduced-motion: reduce)");Ha=e.matches,e.addEventListener("change",e=>{Ha=e.matches})}}async function O(){if(Ea)return!0;try{const e=window.AudioContext||window.webkitAudioContext;return e?(La=new e({latencyHint:"interactive",sampleRate:44100}),"suspended"===La.state&&await La.resume(),(()=>{Aa=La.createGain(),Aa.gain.value=Fa.masterGain,Ra=La.createDynamicsCompressor(),Ra.threshold.value=-6,Ra.knee.value=10,Ra.ratio.value=16,Ra.attack.value=5e-4,Ra.release.value=.08,Va=La.createBiquadFilter(),Va.type="highshelf",Va.frequency.value=Fa.highShelfFreq,Va.gain.value=Fa.highShelfGain,Va.Q.value=.7,za=La.createWaveShaper(),za.curve=((e=.55)=>{const t=1024,a=new Float32Array(t),n=1+8*e;for(let o=0;t>o;o++)a[o]=Math.tanh(n*(2*o/(t-1)-1))/Math.tanh(n);return a})(.55),za.oversample="2x",Ka=La.createGain(),Ka.gain.value=1-Fa.reverbWetMix,Oa=La.createGain(),Oa.gain.value=Fa.reverbWetMix,Ia=(()=>{const e=La.createGain(),t=La.createGain(),a=[.029,.037,.053,.067].map(e=>{const t=La.createDelay(.1);return t.delayTime.value=e*Fa.reverbDecay,t}),n=a.map(()=>{const e=La.createGain();return e.gain.value=.4,e}),o=La.createBiquadFilter();return o.type="lowpass",o.frequency.value=2e3*(1-Fa.reverbHighDamp),o.Q.value=.5,a.forEach((t,i)=>{e.connect(t),t.connect(n[i]),n[i].connect(o),n[i].connect(a[(i+1)%a.length])}),o.connect(t),e.connect(t),e.l=t,e})();const e=Ia.l;Ka.connect(za),Oa.connect(Ia),e.connect(za),za.connect(Va),Va.connect(Ra),Ra.connect(Aa),Aa.connect(La.destination),(()=>{Ga=[];for(let e=0;$a>e;e++){const t={id:e,inUse:!1,startTime:0,filter:La.createBiquadFilter(),envelope:La.createGain(),panner:La.createStereoPanner(),reverbSend:La.createGain(),noiseFilter:La.createBiquadFilter(),noiseEnvelope:La.createGain(),osc:null,harmonicOsc:null,sparkleOsc:null,noiseSource:null};t.filter.type="lowpass",t.noiseFilter.type="bandpass",t.noiseFilter.Q.value=1.2,t.filter.connect(t.envelope),t.envelope.connect(t.panner),t.panner.connect(Ka),t.panner.connect(t.reverbSend),t.reverbSend.connect(Oa),t.noiseFilter.connect(t.noiseEnvelope),t.noiseEnvelope.connect(t.panner),Ga.push(t)}})()})(),Ea=!0,Ba=!0,I(),console.log(`✓ Audio unlocked (${(1e3*(La.baseLatency||0)).toFixed(1)}ms base latency)`),!0):(console.warn("Web Audio API not supported"),!1)}catch(e){return console.error("Failed to unlock audio:",e),!1}}function R(e,t,a=.5,n=null){if(!Ba||!Ea||!La||Ha)return;if(Fa.collisionMinImpact>t)return;const o=La.currentTime;if(.005>o-_a)return;if(null!==n){const e=Na.get(n)||0;if(Fa.minTimeBetweenSounds>o-e)return;Na.set(n,o)}if(_a=o,Na.size>200){const e=o-.5;for(const[t,a]of Na)e>a&&Na.delete(t)}const i=(()=>{for(let t=0;$a>t;t++)if(!Ga[t].inUse)return Ga[t];let e=Ga[0];for(let t=1;$a>t;t++)e.startTime>Ga[t].startTime&&(e=Ga[t]);return V(e),e})();i&&((e,t,a,n,o)=>{e.inUse=!0,e.startTime=o;const i=Math.pow(Math.max(0,Math.min(1,a)),Fa.intensityExponent),r=A(t,Fa.variancePitch),l=A(Fa.decayTime,Fa.varianceDecay)*(1-i*(1-Fa.velocityDecayScale)),s=l+.02;let c=Fa.minGain+(Fa.maxGain-Fa.minGain)*i;c*=A(1,Fa.varianceGain);const d=1+(Fa.velocityBrightnessScale-1)*i;let p=Fa.filterBaseFreq+Fa.filterVelocityRange*Math.pow(i,1.3);p*=A(1,Fa.varianceFilter)*d;const u=2*(n-.5)*Fa.maxPan,h=.12+.5*(1-i);({gain:c,filterFreq:p}=((e,t,a)=>{const n=B((e-Fa.toneSafetyMinHz)/(Fa.toneSafetyMaxHz-Fa.toneSafetyMinHz),0,1),o=Fa.toneSafetyExponent,i=Math.pow(n,o),r=B(1-Fa.toneSafetyHighGainAtten*i-Fa.toneSafetyLowGainAtten*Math.pow(1-n,o),.6,1);let l=Math.min(t*r,Fa.voiceGainMax);const s=B(1-Fa.toneSafetyHighBrightAtten*i,.55,1);return{gain:l,filterFreq:B(a*s,Fa.filterMinHz,Fa.filterMaxHz)}})(r,c,p)),e.filter.frequency.value=p,e.filter.Q.value=Fa.filterQ,e.panner.pan.value=u,e.reverbSend.gain.value=h,e.noiseFilter.Q.value=B(Fa.noiseTransientQ||1.2,.5,8),e.envelope.gain.cancelScheduledValues(o),e.envelope.gain.setValueAtTime(c,o),e.envelope.gain.exponentialRampToValueAtTime(.001,o+l);const f=La.createOscillator();if(f.type="sine",f.frequency.value=r,e.osc=f,f.connect(e.filter),(Fa.harmonicGain||0)>.001){const t=La.createOscillator();t.type="sine",t.frequency.value=2*r;const a=La.createGain();a.gain.cancelScheduledValues(o),a.gain.setValueAtTime(c*Fa.harmonicGain,o),a.gain.exponentialRampToValueAtTime(.001,o+l),e.harmonicOsc=t,t.connect(a),a.connect(e.filter),t.onended=()=>{try{a.disconnect()}catch(e){}},t.start(o),t.stop(o+s)}else e.harmonicOsc=null;if((Fa.sparkleGain||0)>.001){const t=La.createOscillator();t.type="sine";const a=Fa.sparkleRatioMin||2.3,n=Fa.sparkleRatioMax||4.1,i=B(a+Math.random()*(n-a),1.2,10);t.frequency.value=r*A(i,.02);const d=La.createGain(),p=Math.max(.012,l*B(Fa.sparkleDecayMul||.65,.25,.95));d.gain.cancelScheduledValues(o),d.gain.setValueAtTime(c*Fa.sparkleGain,o),d.gain.exponentialRampToValueAtTime(.001,o+p),e.sparkleOsc=t,t.connect(d),d.connect(e.filter),t.onended=()=>{try{d.disconnect()}catch(e){}},t.start(o),t.stop(o+s)}else e.sparkleOsc=null;if(Fa.noiseTransientEnabled&&i>.25){const t=(()=>{if(!Za){const e=2*La.sampleRate;Za=La.createBuffer(1,e,La.sampleRate);const t=Za.getChannelData(0);let a=0,n=0,o=0;for(let i=0;e>i;i++){const e=2*Math.random()-1;a=.99765*a+.099046*e,n=.963*n+.2965164*e,o=.57*o+1.0526913*e,t[i]=.25*(a+n+o+.1848*e)}}const e=La.createBufferSource();return e.buffer=Za,e.loopStart=1.5*Math.random(),e.loopEnd=e.loopStart+.1,e.loop=!1,e})();e.noiseSource=t;const a=Math.pow(i,1.4);e.noiseFilter.frequency.value=A(Fa.noiseTransientFilterMin+(Fa.noiseTransientFilterMax-Fa.noiseTransientFilterMin)*a,Fa.varianceNoise);const n=Fa.noiseTransientGain*Fa.velocityNoiseScale*a*c,r=A(Fa.noiseTransientDecay,Fa.varianceNoise);e.noiseEnvelope.gain.cancelScheduledValues(o),e.noiseEnvelope.gain.setValueAtTime(n,o),e.noiseEnvelope.gain.exponentialRampToValueAtTime(.001,o+r),t.connect(e.noiseFilter),t.start(o),t.stop(o+r+.01)}else e.noiseSource=null;f.start(o),f.stop(o+s),f.onended=()=>V(e)})(i,(e=>{const t=1-B((e-8)/47,0,1),a=B(Fa.pitchMinHz||145,40,6e3),n=B(Fa.pitchMaxHz||280,a+10,12e3),o=B(Fa.pitchCurve||1,.5,2.5);return(a+Math.pow(t,o)*(n-a))*A(1,1.5*(Fa.variancePitch||.06))})(e),Math.max(0,Math.min(1,t)),a,o)}function z({intensity:e=.82,radius:t=18,xPosition:a=.72}={}){R(t,e,a,null)}function V(e){if(e.osc){try{e.osc.stop(),e.osc.disconnect()}catch(t){}e.osc=null}if(e.harmonicOsc){try{e.harmonicOsc.stop(),e.harmonicOsc.disconnect()}catch(t){}e.harmonicOsc=null}if(e.sparkleOsc){try{e.sparkleOsc.stop(),e.sparkleOsc.disconnect()}catch(t){}e.sparkleOsc=null}if(e.noiseSource){try{e.noiseSource.stop(),e.noiseSource.disconnect()}catch(t){}e.noiseSource=null}e.inUse=!1}function B(e,t,a){return t>e?t:e>a?a:e}function E(){return!!Ea&&(Ba=!Ba,I(),Ba)}function W(){return{isUnlocked:Ea,isEnabled:Ba,activeSounds:Ga.filter(e=>e.inUse).length,poolSize:$a}}function $(){return{...Fa}}function G(e){for(const[t,a]of Object.entries(e))t in Fa&&(Fa[t]=a);Oa&&Ka&&"reverbWetMix"in e&&(Oa.gain.value=Fa.reverbWetMix,Ka.gain.value=1-Fa.reverbWetMix),Va&&("highShelfFreq"in e||"highShelfGain"in e)&&(Va.frequency.value=Fa.highShelfFreq,Va.gain.value=Fa.highShelfGain),Aa&&"masterGain"in e&&(Aa.gain.value=Fa.masterGain)}function _(e){const t=Ta[e];if(!t)return!1;Da=e;const{label:a,description:n,...o}=t;return G(o),!0}function N(){return Da}function H(){const e=d(),t=e.balls,a=e.canvas,n=e.ballSpacing||0,o=t.length;if(2>o)return[];const i=Math.max(1,2*e.R_MAX*(1+n)),r=Math.ceil(a.width/i)+1;Ya.clear();for(let s=0;o>s;s++){const e=t[s],a=(e.y/i|0)*r+(e.x/i|0);let n=Ya.get(a);n||(n=[],Ya.set(a,n)),n.push(s)}const l=[];for(const[s,c]of Ya){const e=s/r|0,a=s%r;for(let o=-1;1>=o;o++)for(let i=-1;1>=i;i++){const s=Ya.get((e+o)*r+(a+i));if(s)for(let e=0;c.length>e;e++){const a=c[e];for(let e=0;s.length>e;e++){const o=s[e];if(a>=o)continue;const i=t[a],r=t[o],c=r.x-i.x,d=r.y-i.y,p=i.r+r.r+(i.r+r.r)/2*n,u=c*c+d*d;p*p>u&&l.push({i:a,j:o,overlap:p-Math.sqrt(Math.max(u,ma.MIN_DISTANCE_EPSILON))})}}}}return l.sort((e,t)=>t.overlap-e.overlap),l}function Z(e=10){const t=d(),a=t.balls,n=H(),o=t.REST,i=.5*t.DPR,r=t.ballSpacing||0;for(let l=0;e>l;l++)for(let e=0;n.length>e;e++){const{i:s,j:c}=n[e],d=a[s],p=a[c],u=p.x-d.x,h=p.y-d.y,f=d.r+p.r+(d.r+p.r)/2*r,m=u*u+h*h;if(0===m||m>f*f)continue;const g=Math.sqrt(m),b=u/g,M=h/g,y=f-g,v=1/Math.max(d.m,.001),x=1/Math.max(p.m,.001),w=d.isSleeping&&p.isSleeping,S=.8*Math.max(y-i,0)/(v+x),C=S*b,P=S*M;d.x-=C*v,d.y-=P*v,p.x+=C*x,p.y+=P*x;const k="pit"===t.currentMode||"pit-throws"===t.currentMode;if(k&&-.3>M?p.hasSupport=!0:k&&M>.3&&(d.hasSupport=!0),w)continue;const F=p.vx-d.vx,T=p.vy-d.vy,D=F*b+T*M,L=-15*(t.DPR||1)>D;if((!d.isSleeping||L)&&(!p.isSleeping||L)&&(d.isSleeping&&d.wake(),p.isSleeping&&p.wake(),0>D)){const e=-(1+(30>Math.abs(D)?0:o))*D/(v+x),a=e*b,n=e*M;d.vx-=a*v,d.vy-=n*v,p.vx+=a*x,p.vy+=n*x;const i=F-D*b,r=T-D*M,c=Math.hypot(i,r);if(c>.001){const e=0>i*-M+r*b?-1:1,t=ma.SPIN_GAIN_TANGENT;d.omega-=e*t*c/Math.max(d.r,1),p.omega+=e*t*c/Math.max(p.r,1)}const u=Math.min(1,Math.abs(D)/(50*(d.r+p.r))),h=Math.min(t.getSquashMax(),.8*u);d.squashAmount=Math.max(d.squashAmount,.8*h),d.squashNormalAngle=Math.atan2(-M,-b),p.squashAmount=Math.max(p.squashAmount,.8*h),p.squashNormalAngle=Math.atan2(M,b),0===l&&R((d.r+p.r)/2,u,(d.x+p.x)/2/(t.canvas?.width||1),`${s}-${e}`)}}}function j(e,t,a){e.startsWith("corner")||("top"===e?Ua.top.impact(t,a):"bottom"===e?Ua.bottom.impact(t,a):"left"===e?Ua.left.impact(t,a):"right"===e&&Ua.right.impact(t,a))}function Y(e,t,a=1){e.startsWith("corner")||("top"===e?Ua.top.addPressure(t,a):"bottom"===e?Ua.bottom.addPressure(t,a):"left"===e?Ua.left.addPressure(t,a):"right"===e&&Ua.right.addPressure(t,a))}function X(e,t,a){return t>e?t:e>a?a:e}function q(e,t,a){return e+(t-e)*a}function U(e,t){switch(t){case ua.PIT:return e.sizeVariationPit??0;case ua.PIT_THROWS:return e.sizeVariationPitThrows??0;case ua.FLIES:return e.sizeVariationFlies??0;case ua.WEIGHTLESS:return e.sizeVariationWeightless??0;case ua.WATER:return e.sizeVariationWater??0;case ua.VORTEX:return e.sizeVariationVortex??0;case ua.PING_PONG:return e.sizeVariationPingPong??0;case ua.MAGNETIC:return e.sizeVariationMagnetic??0;case ua.BUBBLES:return e.sizeVariationBubbles??0;case ua.KALEIDOSCOPE:case ua.KALEIDOSCOPE_1:case ua.KALEIDOSCOPE_2:case ua.KALEIDOSCOPE_3:return e.sizeVariationKaleidoscope??0;case ua.ORBIT_3D:return e.sizeVariationOrbit3d??0;case ua.ORBIT_3D_2:return e.sizeVariationOrbit3d2??0;case ua.CRITTERS:return e.sizeVariationCritters??0;case ua.NEURAL:return e.sizeVariationNeural??0;case ua.LATTICE:return e.sizeVariationLattice??0;case ua.PARALLAX_LINEAR:return e.sizeVariationParallaxLinear??0;case ua.PARALLAX_PERSPECTIVE:return e.sizeVariationParallaxPerspective??0;default:return 0}}function J(e,t){const a=X(+(e.sizeVariationCap??.12),0,.5),n=X(+(e.sizeVariationGlobalMul??1),0,2),o=X(+(U(e,t)??0),0,1);return X(a*n*o,0,.5)}function Q(e,t){const{minR:a,maxR:n,medR:o}=((e,t)=>{const a=Math.max(1,e.R_MED||.5*(e.R_MIN+e.R_MAX)||10),n=X(+(e.sizeVariationCap??.12),0,.5),o=X(+(e.sizeVariationGlobalMul??1),0,2),i=X(+(U(e,t)??0),0,1),r=X(n*o*i,0,.5);return{minR:Math.max(1,a*(1-r)),maxR:Math.max(1,a*(1+r)),medR:a}})(e,t);return 1e-6>n-a?o:q(a,n,Math.random())}function ee(e,t){const a=d(),n=a.waterDrag||.015;e.vx*=1-n,e.vy*=1-n,e.omega*=1-.5*n;const o=a.DPR||1;for(let r=0;en.length>r;r++){const a=en[r],n=e.x-a.x,i=e.y-a.y,l=Math.sqrt(n*n+i*i),s=40*o;if(l>a.radius-s&&a.radius+s>l){const o=a.strength*(1-Math.abs(l-a.radius)/s);if(l>.1){const a=i/l;e.vx+=n/l*o*t,e.vy+=a*o*t}}}const i=a.waterDriftStrength||25;e.vx+=Math.sin(.5*e.t+.01*e.x)*i*t,e.vy+=Math.cos(.7*e.t+.01*e.y)*i*t}function te(e){const t=d().waterRippleSpeed||300;for(let a=en.length-1;a>=0;a--){const n=en[a];n.radius+=t*e,n.age+=e,n.strength*=.96,(n.age>3||10>n.strength)&&en.splice(a,1)}}function ae(e,t,a=1){const n=d();en.push({x:e,y:t,radius:0,strength:(n.waterRippleStrength||15e3)*Math.min(a,5),age:0})}function ne(e,t,a){a||(a=F());const n=d(),o=Q(n,n.currentMode||ua.PIT),i=new Qa(e,t,o,a),r=.5*n.canvas.width>e?1:-1,l=Math.max(.6,Math.min(1.4,o/(.5*(n.R_MIN+n.R_MAX)))),s=180*l;return i.vx=r*(140*l+Math.random()*s),i.vy=120*-Math.random(),i.driftAx=r*(360+420*Math.random())*l,i.driftTime=.22+.28*Math.random(),n.balls.push(i),i}function oe(e,t){const a=d(),n=(-1e9===a.mouseX?.5*a.canvas.width:a.mouseX)-e.x,o=(-1e9===a.mouseY?.5*a.canvas.height:a.mouseY)-e.y,i=Math.sqrt(n*n+o*o+1),r=o/i;e.vx+=n/i*4e3*t,e.vy+=4e3*r*t;const l=120*a.DPR;let s=0,c=0,p=0;for(let d=0;a.balls.length>d;d++){const t=a.balls[d];if(t===e)continue;const n=e.x-t.x,o=e.y-t.y,i=n*n+o*o;if(l*l>i&&i>0){const e=Math.sqrt(i),t=1-e/l;s+=n/e*t,c+=o/e*t,p++}}if(p>0){const a=15e3;e.vx+=s/p*a*t,e.vy+=c/p*a*t}e.vx+=1e3*(Math.random()-.5)*t,e.vy+=1e3*(Math.random()-.5)*t}function ie(e,t){const a=d(),n=a.repelPower,o=a.repelRadius;if(!a.repellerEnabled||0>=n||0>=o)return;const i=o*a.DPR,r=e.x-a.mouseX,l=e.y-a.mouseY,s=r*r+l*l;if(s>i*i)return;const c=Math.max(Math.sqrt(s),1e-4),p=r/c,u=l/c,h=20*n*Math.pow(Math.max(0,1-c/i),a.repelSoft||3.4),f=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=p*h*t/f,e.vy+=u*h*t/f}function re(e,t,a){return Math.max(t,Math.min(a,e))}function le(e,t){return e+Math.random()*(t-e)}function se(e){const t=0|e.spawnedTotal;return e.spawnedTotal=t+1,8>t?T(t):void 0}function ce(e,t,a,{speedMul:n=1,spreadMul:o=1}={}){const i=e.canvas.width,r=e.canvas.height,l=e.DPR,s=(e.wallThickness||20)*l,c=Math.max(1,i-2*s),d=.35*-r,p=.05*-r,u=re(e.pitThrowInletInset??.06,0,.2),h=0===a?s+c*u:i-s-c*u,f=re(e.pitThrowSpawnSpread??.02,0,.12),m=re(f*o,0,.18),g=h+le(-c*m,c*m),b=le(d,p),M=re(e.pitThrowTargetYFrac??.36,.12,.7),y=re(e.pitThrowCrossBias??.12,0,.35),v=re(e.pitThrowAimJitter??.04,0,.2),x=re(v*o,0,.25),w=i*(.5+(0===a?y:-y)+le(-x,x)),S=r*M,C=re(e.pitThrowSpeed??650,50,4e3)*l,P=re(e.pitThrowSpeedJitter??.22,0,.8),k=re(e.pitThrowAngleJitter??.16,0,.8),F=ne(g,b,t),T=w-g,D=S-b,L=Math.max(1e-4,Math.sqrt(T*T+D*D));let A=T/L,I=D/L;const K=le(-Math.PI,Math.PI)*k,O=Math.cos(K),R=Math.sin(K),z=A*R+I*O;A=A*O-I*R,I=z;const V=C*n*(1+le(-P,P));return F.vx=A*V,F.vy=I*V,F.driftAx=0,F.driftTime=0,F}function de(e){const t=d();if(!t||"pit-throws"!==t.currentMode)return;const a=Math.max(0,p(t.maxBalls??300));if(0>=a)return;if(t.balls.length>=a)return;const n=t.p;if(!n)return;const o=re(t.pitThrowIntervalMs??70,10,2e3)/1e3,i=re(t.pitThrowBatchSize??12,1,100),r=re(t.pitThrowColorPauseMs??400,0,3e3)/1e3,l=re(t.pitThrowPairChance??.35,0,1),s=re(t.pitThrowPairStaggerMs??18,0,300)/1e3,c=re(t.pitThrowSpeedVar??.18,0,1),u=re(t.pitThrowSpreadVar??.25,0,1);n.cooldown-=e,0>n.cooldown&&(n.cooldown=0);let h=0;for(0>n.queueA||(n.queueA-=e),0>n.queueB||(n.queueB-=e);6>h&&a>t.balls.length;){let e=!1;if(n.queueA>=0&&0>=n.queueA){const a=1+le(-c,c),o=1+le(-u,u);ce(t,n.queueColorA,n.queueSideA,{speedMul:a,spreadMul:o}),n.queueA=-1,h++,e=!0}if(h>=6||t.balls.length>=a)break;if(n.queueB>=0&&0>=n.queueB){const a=1+le(-c,c),o=1+le(-u,u);ce(t,n.queueColorB,n.queueSideB,{speedMul:a,spreadMul:o}),n.queueB=-1,h++,e=!0}if(!e)break}if(0>=n.cooldown)for(n.batchPaused&&(n.batchPaused=!1,n.batchCount=0,n.side=1-n.side);6>h&&a>t.balls.length;){if(r>0&&n.batchCount>=i){n.cooldown=r,n.batchPaused=!0;break}const e=n.side,d=1+le(-c,c),p=1+le(-u,u);if(ce(t,se(n),e,{speedMul:d,spreadMul:p}),h++,n.batchCount++,l>Math.random()&&a>t.balls.length&&i>n.batchCount){const t=se(n);0>n.queueA&&(n.queueA=s,n.queueColorA=t,n.queueSideA=e,n.batchCount++)}n.cooldown=o;break}}function pe(e,t){const a=d();if(!a.mouseInCanvas)return;const n=a.weightlessRepelRadius??0,o=a.weightlessRepelPower??0;if(0>=n||0>=o)return;const i=n*(a.DPR||1),r=e.x-a.mouseX,l=e.y-a.mouseY,s=r*r+l*l;if(s>i*i)return;const c=Math.max(Math.sqrt(s),1e-4),p=r/c,u=l/c,h=20*o*Math.pow(Math.max(0,1-c/i),a.weightlessRepelSoft??2.2),f=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=p*h*t/f,e.vy+=u*h*t/f}function ue(){if(tn=document.getElementById("c"),!tn)return void console.error("Canvas not found");an=tn.getContext("2d",{alpha:!0,desynchronized:!0,willReadFrequently:!1}),an||(an=tn.getContext("2d"),console.warn("⚠️ Desynchronized mode unavailable, using standard context")),(()=>{const e=window.devicePixelRatio||1;(navigator.connection?.saveData||4>=navigator.hardwareConcurrency||/Android|iPhone|iPad|iPod/i.test(navigator.userAgent))&&e>1.5?(nn=1.5,console.log("⚡ Adaptive DPR: Reduced to 1.5x for performance")):nn=Math.min(e,2),t(nn)})(),an.imageSmoothingEnabled=!1;const e=()=>{ln&&cancelAnimationFrame(ln),ln=requestAnimationFrame(()=>{he(),ln=null})};if(window.addEventListener("resize",e),window.addEventListener("orientationchange",()=>{setTimeout(he,100),setTimeout(he,300)}),window.visualViewport&&(window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e)),"undefined"!=typeof ResizeObserver){const t=document.getElementById("bravia-balls");t&&new ResizeObserver(()=>{e()}).observe(t)}console.log(`✓ Renderer optimized (DPR: ${nn.toFixed(2)}, desync: ${an.getContextAttributes?.()?.desynchronized??"unknown"})`)}function he(){if(!tn)return;const e=d();try{l(),s()}catch(c){}try{m()}catch(c){}const t=e.container||document.getElementById("bravia-balls"),a=t?t.clientWidth:window.innerWidth,n=t?t.clientHeight:window.innerHeight,o=nn,i=Math.floor(a*o),r=Math.floor(n*o);if(on>0&&rn>0&&e.balls&&e.balls.length>0){const t=i/on,a=r/rn;if(Math.abs(t-1)>.001||Math.abs(a-1)>.001){const n=e.balls;for(let e=0;n.length>e;e++){const o=n[e];if(!o)continue;o.x*=t,o.y*=a;const l=o.r||10;o.x=Math.max(l,Math.min(i-l,o.x)),o.y=Math.max(l,Math.min(r-l,o.y)),o.isSleeping&&(o.isSleeping=!1,o.sleepTimer=0)}}}on=i,rn=r,tn.width=i,tn.height=r,tn.style.width=a+"px",tn.style.height=n+"px",an&&(an.imageSmoothingEnabled=!1),(e=>{const t=d();if(!t.canvasShadowEnabled)return void(e.style.filter="");const a=t.shadow2Enabled?` drop-shadow(0 0 ${t.shadow2Blur||4}px rgba(0,0,0,${t.shadow2Opacity||.1}))`:"";e.style.filter=`drop-shadow(${t.shadowOffsetX||1}px ${t.shadowOffsetY||1}px ${t.shadowBlur||0}px ${((e,t)=>{const a=e.replace("#",""),n=parseInt(a,16);return`rgba(${n>>16&255}, ${n>>8&255}, ${255&n}, ${t})`})(t.shadowColor||"#000000",t.shadowOpacity||.29)})${a}`})(tn)}function fe(){return tn}function me(){return an}function ge(e,t){const a=d();if(a.currentMode!==ua.VORTEX)return;if(!a.mouseInCanvas)return;const n=a.vortexSwirlStrength||420,o=a.vortexRadialPull||180,i=a.vortexSpeedMultiplier??1,r=a.vortexRadius??0,l=a.vortexFalloffCurve??1,s=a.vortexRotationDirection??1,c=a.vortexCoreStrength??1,p=a.vortexAccelerationZone??0,u=a.vortexOutwardPush??0,h=e.x-a.mouseX,f=e.y-a.mouseY,m=Math.max(8,Math.sqrt(h*h+f*f));if(r>0&&m>r){if(u>0){const a=f/m,n=u*((m-r)/r);e.vx+=h/m*n*t,e.vy+=a*n*t}return}let g;g=Math.pow(r>0?1-Math.min(1,m/r):1/(1+m*(a.vortexFalloffRate??.0015)),l);const b=1+(c-1)*(1-Math.min(1,m/(r||400))),M=n*g*b*i,y=o*g*b*i;let v=1;if(p>0){const e=Math.abs(m-p),t=.3*p;t>e&&(v=1+.5*(1-e/t))}const x=h/m,w=f/m,S=x*s,C=M*v;e.vx+=-w*s*C*t,e.vy+=S*C*t;const P=y*v;e.vx-=x*P*t,e.vy-=w*P*t;const k=Math.max(0,Math.min(1,a.vortexDrag??.005));e.vx*=1-k,e.vy*=1-k}function be(e){const t=d();if(t.currentMode!==ua.PING_PONG)return;if(!e.isPingPong)return;if(t.mouseInCanvas){const a=(t.pingPongCursorRadius||100)*t.DPR,n=e.x-t.mouseX,o=e.y-t.mouseY,i=Math.sqrt(n*n+o*o),r=a+e.r;if(r>i&&i>.1){const t=r-i,a=n/i,l=o/i;e.x+=a*t*1.1,e.y+=l*t*1.1;const s=e.vx*a+e.vy*l;0>s&&(e.vx-=2*s*a,e.vy-=2*s*l,e.omega+=.02*s)}}const a=t.pingPongSpeed||400;.9*a>Math.abs(e.vx)&&(e.vx=(0>e.vx?-1:1)*a),e.vy*=Math.max(0,Math.min(1,t.pingPongVerticalDamp??.995))}function Me(e,t){const a=d();if(a.currentMode!==ua.MAGNETIC)return;if(!a.mouseInCanvas)return;const n=a.mouseX-e.x,o=a.mouseY-e.y,i=a.DPR||1,r=Math.max(30*i,Math.sqrt(n*n+o*o)),l=(a.magneticStrength||65e3)/(r*r)*1e3,s=o/r,c=e.charge||1;e.vx+=n/r*l*c*t,e.vy+=s*l*c*t;const p=(a.magneticMaxVelocity||2800)*i,u=Math.sqrt(e.vx*e.vx+e.vy*e.vy);u>p&&(e.vx=e.vx/u*p,e.vy=e.vy/u*p),e.vx*=.998,e.vy*=.998}function ye(){const e=d();if(e.currentMode===ua.MAGNETIC)for(let t=0;e.balls.length>t;t++)e.balls[t].alpha=1}function ve(e,t,a,n=!1){const o=d(),i=o.DPR||1,r=Q(o,ua.BUBBLES),l=new Qa(e,t,n?r:.1,a);return l.isBubble=!0,l.baseRadius=r,l.targetRadius=r,l.wobblePhase=Math.random()*Math.PI*2,l.wobbleFreq=2+3*Math.random(),l.vx=20*(Math.random()-.5)*i,l.vy=(-50-50*Math.random())*i,l.spawning=!n,l.spawnProgress=n?1:0,l.dissipating=!1,l.dissipateProgress=0,l.alpha=1,o.balls.push(l),l}function xe(e){const t=d(),a=t.canvas;if(!a)return;const n=t.DPR||1,o=a.width,i=a.height;e.x=Math.random()*o,e.y=i+(60+30*Math.random())*n,e.vx=20*(Math.random()-.5)*n,e.vy=(-50-50*Math.random())*n,e.wobblePhase=Math.random()*Math.PI*2,e.wobbleFreq=2+3*Math.random(),e.color=F(),e.targetRadius=Q(t,ua.BUBBLES),e.baseRadius=e.targetRadius,e.r=.1,e.rBase=.1,e.spawning=!0,e.spawnProgress=0,e.dissipating=!1,e.dissipateProgress=0,e.alpha=1}function we(e,t){const a=d();if(a.currentMode!==ua.BUBBLES)return;if(!e.isBubble)return;const n=a.canvas;if(!n)return;if(e.spawning&&(e.spawnProgress+=3*t,e.r=e.targetRadius*(1-Math.pow(1-Math.min(1,e.spawnProgress),3)),e.rBase=e.r,1>e.spawnProgress||(e.spawning=!1,e.r=e.targetRadius,e.rBase=e.targetRadius)),e.dissipating){e.dissipateProgress+=3*t;const a=Math.pow(e.dissipateProgress,2);return e.r=e.targetRadius*Math.max(0,1-a),e.rBase=e.r,e.alpha=Math.max(0,1-.5*a),e.vy*=.92,e.vx*=.92,void(1>e.dissipateProgress||xe(e))}const o=.01*(a.bubblesWobble||40);if(e.vy-=(a.bubblesRiseSpeed||150)*a.DPR*t,e.wobblePhase+=e.wobbleFreq*t,e.vx+=Math.sin(e.wobblePhase)*o*100*t,e.vx*=.92,e.vy*=.96,a.mouseInCanvas){const n=e.x-a.mouseX,o=e.y-a.mouseY,i=Math.sqrt(n*n+o*o),r=(a.bubblesDeflectRadius||200)*a.DPR;if(r>i&&i>1){const a=3e3*Math.pow(1-i/r,3),l=n/i,s=o/i;if(e.vx+=l*a*t,e.vy+=s*a*t,.3*r>i){const a=500*(1-i/(.3*r));e.vx+=l*a*t,e.vy+=s*a*t}}}e.y>=2*e.targetRadius||e.dissipating||e.spawning||(e.dissipating=!0,e.dissipateProgress=0),(4*-e.r>e.x||e.x>n.width+4*e.r)&&xe(e)}function Se(){}function Ce(e,t,a){return Math.max(t,Math.min(a,e))}function Pe(e){const t=e.canvas;return t?Ce(Math.min(t.width,t.height)/1e3,.35,3):1}function ke(e,t,a,n){for(let o=0;e.length>o;o++){const i=e[o],r=t-i.x,l=a-i.y,s=n+i.r;if(s*s>r*r+l*l)return!0}return!1}function Fe(e,t,a,n=10){const o=2*n;return e.v+=n*n*(t-e.x)*a,e.v*=Math.max(0,1-o*a),e.x+=e.v*a,e.x}function Te(e,t,a,n){const o=d(),i=Math.max(2,o.wallInset||3)*(o.DPR||1),r=i+e.r,l=t-i-e.r,s=i+e.r,c=a-i-e.r,p=.92,u=Math.max(0,1-.15*n);r>e.x?(e.x=r,e.vx=Math.abs(e.vx)*p*u):e.x>l&&(e.x=l,e.vx=-Math.abs(e.vx)*p*u),s>e.y?(e.y=s,e.vy=Math.abs(e.vy)*p*u):e.y>c&&(e.y=c,e.vy=-Math.abs(e.vy)*p*u)}function De(e){return e.currentMode===ua.KALEIDOSCOPE_1?{count:e.kaleidoscope1BallCount??18,wedges:e.kaleidoscope1Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope1Speed??.8,complexity:.55,spawnAreaMul:e.kaleidoscope1SpawnAreaMul??1,sizeVariance:e.kaleidoscope1SizeVariance??.3}:e.currentMode===ua.KALEIDOSCOPE_2?{count:e.kaleidoscope2BallCount??36,wedges:e.kaleidoscope2Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope2Speed??1.15,complexity:.95,spawnAreaMul:e.kaleidoscope2SpawnAreaMul??1,sizeVariance:e.kaleidoscope2SizeVariance??.3}:e.currentMode===ua.KALEIDOSCOPE_3?{count:e.kaleidoscope3BallCount??54,wedges:e.kaleidoscope3Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope3Speed??1.55,complexity:1.35,spawnAreaMul:e.kaleidoscope3SpawnAreaMul??1,sizeVariance:e.kaleidoscope3SizeVariance??.3}:{count:e.kaleidoscopeBallCount??23,wedges:e.kaleidoscopeWedges??e.kaleidoscopeSegments??12,speed:e.kaleidoscopeSpeed??1,complexity:.75,spawnAreaMul:e.kaleidoscopeSpawnAreaMul??1,sizeVariance:e.kaleidoscopeSizeVariance??.3}}function Le(e,t){function a(e){const a=((e,t)=>{const a=e?.canvas,n=a?.height||0;if(!n)return Q(e,t);const o=X(t===ua.KALEIDOSCOPE_1?+(e.kaleidoscope1DotSizeVh??e.kaleidoscopeDotSizeVh??.95):t===ua.KALEIDOSCOPE_2?+(e.kaleidoscope2DotSizeVh??e.kaleidoscopeDotSizeVh??.95):t===ua.KALEIDOSCOPE_3?+(e.kaleidoscope3DotSizeVh??e.kaleidoscopeDotSizeVh??.95):+(e.kaleidoscopeDotSizeVh??.95),.1,6),i=X(t===ua.KALEIDOSCOPE_1?+(e.kaleidoscope1DotAreaMul??e.kaleidoscopeDotAreaMul??.7):t===ua.KALEIDOSCOPE_2?+(e.kaleidoscope2DotAreaMul??e.kaleidoscopeDotAreaMul??.7):t===ua.KALEIDOSCOPE_3?+(e.kaleidoscope3DotAreaMul??e.kaleidoscopeDotAreaMul??.7):+(e.kaleidoscopeDotAreaMul??.7),.1,2),r=Math.max(1,.01*o*n*Math.sqrt(i)),l=X(.5*(t===ua.KALEIDOSCOPE_1?+(e.kaleidoscope1SizeVariance??e.kaleidoscopeSizeVariance??.3):t===ua.KALEIDOSCOPE_2?+(e.kaleidoscope2SizeVariance??e.kaleidoscopeSizeVariance??.3):t===ua.KALEIDOSCOPE_3?+(e.kaleidoscope3SizeVariance??e.kaleidoscopeSizeVariance??.3):+(e.kaleidoscopeSizeVariance??.3)),0,.5),s=Math.max(1,r*(1-l)),c=Math.max(1,r*(1+l));return 1e-6>c-s?r:q(s,c,Math.random())})(n,t),o=1.2*b,i=l-o,r=l+o,d=s-o,p=s+o;for(let t=0;90>t;t++){const t=Math.random()*sn,o=g+Math.random()*(b-g),u=Ce(l+Math.cos(t)*o,i,r),h=Ce(s+Math.sin(t)*o,d,p),f=a*(1+(n.ballSpacing||0));if(!ke(M,u,h,f)){M.push({x:u,y:h,r:f});const o=new Qa(u,h,a,e);o.u=Math.random()*sn;const i=u-l,r=h-s;o.h=Math.sqrt(i*i+r*r);const d=(12+12*Math.random())*c;return o.vx=-Math.sin(t)*d,o.vy=Math.cos(t)*d,o.driftAx=0,o.driftTime=0,void n.balls.push(o)}}const u=Math.random()*sn,h=g+Math.random()*(b-g),f=l+Math.cos(u)*h,m=s+Math.sin(u)*h,y=new Qa(f,m,a,e);y.u=Math.random()*sn;const v=f-l,x=m-s;y.h=Math.sqrt(v*v+x*x);const w=(12+12*Math.random())*c;y.vx=-Math.sin(u)*w,y.vy=Math.cos(u)*w,y.driftAx=0,y.driftTime=0,n.balls.push(y)}const n=d();f();const o=n.canvas;if(!o)return;const i=o.width,r=o.height,l=.5*i,s=.5*r,c=Pe(n),p=n.maxBalls||300,u=Ce(Math.max(0,0|e),0,p);if(0>=u)return;const h=Ce(De(n).spawnAreaMul??1,.2,2),m=Math.min(i,r),g=.05*m,b=2.8*m*h,M=[],y=Math.min(8,u);for(let d=0;y>d;d++)a(T(d));for(let d=y;u>d;d++)a(F())}function Ae(e){return e===ua.KALEIDOSCOPE||e===ua.KALEIDOSCOPE_1||e===ua.KALEIDOSCOPE_2||e===ua.KALEIDOSCOPE_3}function Ie(e){return De(e).complexity}function Ke(e,t){const a=d();if(!Ae(a.currentMode))return;const n=a.canvas;if(!n)return;const o=.5*n.width,i=.5*n.height,r=Pe(a),l=Ce(De(a).speed??1,.2,2),s=performance.now(),c=120>s-(a.lastPointerMoveMs||0);void 0===a.M&&(a.M=0);const p=c?1:0;a.M+=(p-a.M)*(1-Math.exp(-t/Math.max(1e-4,p>a.M?.45:.65)));const u=a.M,h=.008*Ie(a);if(.01>u){const a=(e.u??0)+.02*e.age+3e-4*s,n=Math.cos(a)*h*8,o=Math.sin(a)*h*8;return e.vx+=n*t,e.vy+=o*t,e.vx*=.96,void(e.vy*=.96)}const f=e.x-o,m=e.y-i,g=Math.max(cn,Math.sqrt(f*f+m*m)),b=f/g,M=m/g,y=b,v=30*r*l*u,x=-2.5*(g-(void 0!==e.h?e.h:g))*l*u;e.vx+=(-M*v+b*x)*t,e.vy+=(y*v+M*x)*t,e.vx*=.992,e.vy*=.992}function Oe(e,t){const a=d(),n=(-1e9===a.mouseX?.5*a.canvas.width:a.mouseX)-e.x,o=(-1e9===a.mouseY?.5*a.canvas.height:a.mouseY)-e.y,i=Math.sqrt(n*n+o*o+1),r=n/i,l=o/i,s=-o/i,c=n/i,p=a.DPR||1,u=40*p;if(u>i){const a=100*(u-i);e.vx-=r*a*t,e.vy-=l*a*t}const h=a.orbit3dGravity??5e3,f=.015*h;e.vx+=s*f*t,e.vy+=c*f*t;const m=.003*h/(1+i/(100*p));e.vx+=r*m*t,e.vy+=l*m*t;const g=60*a.DPR;let b=0,M=0,y=0;for(let d=0;a.balls.length>d;d++){const t=a.balls[d];if(t===e)continue;const n=e.x-t.x,o=e.y-t.y,i=n*n+o*o;if(g*g>i&&i>0){const e=Math.sqrt(i),t=1-e/g;b+=n/e*t,M+=o/e*t,y++}}if(y>0){const a=8e3;e.vx+=b/y*a*t,e.vy+=M/y*a*t}const v=2*(a.orbit3dVelocityMult??150)*p,x=Math.sqrt(e.vx*e.vx+e.vy*e.vy);x>v&&(e.vx=e.vx/x*v,e.vy=e.vy/x*v);const w=1-(a.orbit3dDamping??.02);e.vx*=w,e.vy*=w;const S=a.orbit3dDepthScale??.8;e.z=e.orbitDepth+.2*Math.sin(2*Math.atan2(o,n)),e.z=Math.max(0,Math.min(1,e.z)),e.r=Math.max(2,e.rBase*(.5+e.z*S))}function Re(e,t){const a=d(),n=(-1e9===a.mouseX?.5*a.canvas.width:a.mouseX)-e.x,o=(-1e9===a.mouseY?.5*a.canvas.height:a.mouseY)-e.y,i=Math.sqrt(n*n+o*o+1),r=n/i,l=o/i,s=-o/i,c=n/i,p=a.DPR||1,u=80*p;if(u>i){const a=100*(u-i);e.vx-=r*a*t,e.vy-=l*a*t}const h=a.orbit3d2Gravity??8e4,f=.015*h;e.vx+=s*f*t,e.vy+=c*f*t;const m=.003*h/(1+i/(100*p));e.vx+=r*m*t,e.vy+=l*m*t;const g=100*a.DPR;let b=0,M=0,y=0;for(let d=0;a.balls.length>d;d++){const t=a.balls[d];if(t===e)continue;const n=e.x-t.x,o=e.y-t.y,i=n*n+o*o;if(g*g>i&&i>0){const e=Math.sqrt(i),t=1-e/g;b+=n/e*t,M+=o/e*t,y++}}if(y>0){const a=8e3;e.vx+=b/y*a*t,e.vy+=M/y*a*t}const v=300*p,x=Math.sqrt(e.vx*e.vx+e.vy*e.vy);x>v&&(e.vx=e.vx/x*v,e.vy=e.vy/x*v);const w=1-(a.orbit3d2Damping??.02);e.vx*=w,e.vy*=w;const S=a.orbit3d2DepthScale??.6;e.z=e.orbitDepth+.2*Math.sin(2*Math.atan2(o,n)),e.z=Math.max(0,Math.min(1,e.z)),e.r=Math.max(2,e.rBase*(.5+e.z*S))}function ze(e,t,a){return t>e?t:e>a?a:e}function Ve(e){return e>Math.PI?e-=2*Math.PI:-Math.PI>e&&(e+=2*Math.PI),e}function Be(e,t){const a=d(),n=a.canvas;if(!n)return;const o=a.DPR||1,i=Math.max(0,a.critterSpeed||0),r=Math.max(50,a.critterMaxSpeed||0)*o,l=Math.max(0,a.critterStepHz||0),s=a.critterStepSharpness??2.4,c=Math.max(0,a.critterTurnNoise||0),p=Math.max(.1,a.critterTurnDamp||0),u=Math.max(0,a.critterTurnSeek||0),h=Math.max(0,(a.critterAvoidRadius||0)*(a.DPR||1)),f=Math.max(0,a.critterAvoidForce||0),m=Math.max(0,a.critterEdgeAvoid||0),g=Math.max(0,a.critterMousePull||0),b=Math.max(0,a.critterMouseRadiusVw||0);let M=e.S||0,y=e.C||0,v=e.P||0,x=e.k??v,w=e.F||0;const S=e.T||0;w>0?w=Math.max(0,w-t):.25*t>Math.random()&&(w=.03+.09*Math.random());let C=0,P=0;if(m>0){const t=n.width,o=n.height,i=Math.max(24*(a.DPR||1),.08*Math.min(t,o)),r=e.x,l=e.y;i>r?C+=1-r/i:r>t-i&&(C-=1-(t-r)/i),i>l?P+=1-l/i:l>o-i&&(P-=1-(o-l)/i);const s=1.35*m;C*=s,P*=s}let k=0;if(g>0&&-1e9!==a.mouseX){const t=(window.innerWidth||n.width)/100,o=Math.max(1,b*t)*(a.DPR||1),i=e.x-a.mouseX,r=e.y-a.mouseY,l=i*i+r*r;if(o*o>l){const e=Math.sqrt(l)+1e-6,t=1-e/o;k=t;const a=g*(.85+.65*t);C+=i/e*a,P+=r/e*a;const n=.25*t*a;C+=-r/e*n,P+=i/e*n,w=0}}if(h>0&&f>0){const n=a.balls,o=h*h;let i=0,r=0,l=0;for(let t=0;n.length>t;t++){const a=n[t];if(a===e)continue;const s=e.x-a.x,c=e.y-a.y,d=s*s+c*c;if(d>0&&o>d){const e=Math.sqrt(d),t=1-e/h,a=t*t,n=1/(e+1e-6);i+=s*n*a,r+=c*n*a,l++}}if(l>0){const a=1/l;C+=i*a*1.15,P+=r*a*1.15,e.vx+=i*a*.65*f*t,e.vy+=r*a*.65*f*t}}y+=(c*(1+1.35*k*g)*(2*Math.random()-1)+.35*S*c)*t,C*C+P*P>1e-6&&(y+=Ve(Math.atan2(P,C)-M)*u*t),y*=Math.exp(-p*t),M=Ve(M+y*t),l>0&&(x=v,v+=l*t,v-=0|v);const F=w>0?0:((e,t)=>{const a=(n=ze(n=.5>e?2*e:2-2*e,0,1))*n*(3-2*n);var n;const o=ze(t,.5,6);return Math.pow(a,o)})(v,s),T=1+.95*k*g;if(0>=w&&v>.82){const t=(v-.82)/.18*.1*(.65+.35*T);t>e.squashAmount&&(e.squashAmount=t,e.squashNormalAngle=-Math.PI/2)}if(0>=w&&l>0&&x>v){const t=Math.max(.25,e.m/(a.MASS_BASELINE_KG||129)),n=i*(.55+.55*F)*T*(.85+.3*Math.random()),o=Math.cos(M),r=Math.sin(M),l=-r,s=o,c=.18*(2*Math.random()-1)*(.35+.65*k)*n;e.vx+=(o*n+l*c)/t,e.vy+=(r*n+s*c)/t,e.squashAmount=Math.max(e.squashAmount,.2+.15*k),e.squashNormalAngle=Math.PI/2}const D=i*(.08+.25*F)*T;e.vx+=Math.cos(M)*D*t,e.vy+=Math.sin(M)*D*t;const L=e.vx,A=e.vy,I=L*L+A*A;if(I>r*r){const t=r/(Math.sqrt(I)+1e-6);e.vx=L*t,e.vy=A*t}e.S=M,e.C=y,e.P=v,e.k=x,e.F=w,e.theta=M}function Ee(e,t){const a=d(),n=Math.max(.25,e.m/a.MASS_BASELINE_KG),o=Math.max(0,a.neuralWanderStrength??420),i=(e.D??0)+1.35*t;e.D=i;const r=Math.sin(1.7*i+.3)*o,l=Math.cos(1.1*i+1.2)*o;e.vx+=r*t/n,e.vy+=l*t/n,pn+=t;const s=a.balls,c=s.length;if(c>1){const o=pn>.18;if(o&&(pn=0),o||void 0===a.L){let e=0,t=0;for(let a=0;c>a;a++)e+=s[a].x,t+=s[a].y;a.L=e/c,a.A=t/c}const i=a.L,r=a.A,l=Math.max(0,Math.min(1,a.neuralCohesion??.18)),d=r-e.y;e.vx+=(i-e.x)*l*t/n,e.vy+=d*l*t/n}const p=Math.pow(Math.max(0,Math.min(1,a.neuralDamping??.985)),60*t);e.vx*=p,e.vy*=p}function We(){}function $e(e,t){const a=d(),n=a.canvas;if(!n)return;const o=a.mouseX;if(!1!==a.repellerEnabled&&-1e9!==o&&a.mouseInCanvas){const n=(a.latticeDisruptRadius??600)*a.DPR,i=a.latticeDisruptPower??25,r=e.x-o,l=e.y-a.mouseY,s=r*r+l*l;if(n*n>s){const o=Math.max(Math.sqrt(s),1e-4),c=r/o,d=l/o,p=80*i*Math.pow(Math.max(0,1-o/n),1.8),u=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=c*p*t/u,e.vy+=d*p*t/u}}void 0!==e.latticeHomeX&&void 0!==e.latticeHomeY||(e.latticeHomeX=e.x,e.latticeHomeY=e.y);const i=.001*performance.now(),r=a.latticeMeshWaveStrength??12,l=a.latticeMeshWaveSpeed??.8,s=Math.sin(i*l+.004*e.latticeHomeX)*r,c=Math.cos(i*l*.7+.004*e.latticeHomeY)*r,p=.015*Math.sin(i*l*.5),u=e.latticeHomeX+s+(e.latticeHomeX-.5*n.width)*p-e.x,h=e.latticeHomeY+c+(e.latticeHomeY-.5*n.height)*p-e.y,f=Math.max(0,a.latticeStiffness??2.2),m=Math.max(.25,e.m/a.MASS_BASELINE_KG);e.vx+=u*f*t/m,e.vy+=h*f*t/m;const g=Math.pow(Math.max(0,Math.min(1,a.latticeDamping??.92)),60*t);e.vx*=g,e.vy*=g}function Ge(e){if(!e.I)return;const t=d(),a=t.canvas;if(!a)return;const n=.5*a.width,o=.5*a.height;let i=0,r=0;t.mouseInCanvas&&(i=Math.max(-1,Math.min(1,(t.mouseX-n)/(.5*a.width))),r=Math.max(-1,Math.min(1,(t.mouseY-o)/(.5*a.height))));const l=Math.max(100,t.parallaxLinearFocalLength??400),s=Math.max(0,t.parallaxLinearParallaxStrength??120),{x:c,y:p,z:u}=e.I,h=l/(l+u),f=n+(c+i*s)*h,m=o+(p+r*s)*h;e.r=.768*(t.R_MED||20)*(t.DPR||1)*Math.max(.1,Math.min(6,t.parallaxLinearDotSizeMul??1.8))*(Number.isFinite(e.K)?e.K:1)*h,e.x=f,e.y=m,e.vx=0,e.vy=0}function _e(e){if(!e.I)return;const t=d(),a=t.canvas;if(!a)return;const n=.5*a.width,o=.5*a.height;let i=0,r=0;t.mouseInCanvas&&(i=Math.max(-1,Math.min(1,(t.mouseX-n)/(.5*a.width))),r=Math.max(-1,Math.min(1,(t.mouseY-o)/(.5*a.height))));const l=Math.max(100,t.parallaxPerspectiveFocalLength??400),s=Math.max(0,t.parallaxPerspectiveParallaxStrength??150),{x:c,y:p,z:u}=e.I,h=l/(l+u),f=n+(c+i*s)*h,m=o+(p+r*s)*h;e.r=.6*(t.R_MED||20)*(t.DPR||1)*Math.max(.1,Math.min(6,t.parallaxPerspectiveDotSizeMul??1.8))*(Number.isFinite(e.K)?e.K:1)*h,e.x=f,e.y=m,e.vx=0,e.vy=0}function Ne(e){const t=d(),a=t.currentMode;if(t.currentMode===ua.CRITTERS&&e!==ua.CRITTERS&&(void 0!==t.O&&(t.REST=t.O,delete t.O),void 0!==t.R&&(t.FRICTION=t.R,delete t.R),void 0!==t.V&&(t.ballSpacing=t.V,delete t.V)),h(e),e!==a)try{P?.()}catch(o){}if(console.log("Switching to mode: "+e),(e=>{const t=document.getElementById("announcer");t&&(t.textContent="",setTimeout(()=>{t.textContent=e},10))})(`Switched to ${{pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero Gravity",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope","kaleidoscope-1":"Kaleidoscope I","kaleidoscope-2":"Kaleidoscope II","kaleidoscope-3":"Kaleidoscope III","orbit-3d":"Orbit 3D","orbit-3d-2":"Orbit 3D (Tight Swarm)",critters:"Critters",neural:"Neural Network",lattice:"Crystal Lattice","parallax-linear":"Parallax (Linear)","parallax-perspective":"Parallax (Perspective)"}[e]||e} mode`),t.container){const a=t.container.classList.contains("dark-mode");t.container.className="",e!==ua.PIT&&e!==ua.PIT_THROWS||t.container.classList.add("mode-pit"),(a||t.isDarkMode)&&t.container.classList.add("dark-mode")}he(),e===ua.PIT?(t.gravityMultiplier=t.gravityMultiplierPit,t.G=t.GE*t.gravityMultiplier,t.repellerEnabled=!0,(()=>{const e=d();f(),((e,t)=>{const a=e.DPR,n=-.65*e.canvas.height,o=(e.wallThickness||20)*a,i=o,r=e.canvas.width-o,l=r-i,s=Math.max(1,.22*l),c=i+l*(2/3),d=Math.max(i,c-.5*s),p=Math.min(r,c+.5*s),u=Math.max(0,0|t),h=100*a,f=50*a;for(let m=0;8>m&&u>m;m++){const e=ne(d+Math.random()*(p-d),n+Math.random()*(0-n),T(m));e.vx=(Math.random()-.5)*h,e.vy=Math.random()*f+f,e.driftAx=0,e.driftTime=0}for(let m=8;u>m;m++){const e=ne(d+Math.random()*(p-d),n+Math.random()*(0-n));e.vx=(Math.random()-.5)*h,e.vy=Math.random()*f+f,e.driftAx=0,e.driftTime=0}})(e,p(e.maxBalls??300))})()):e===ua.PIT_THROWS?(t.gravityMultiplier=t.gravityMultiplierPit,t.G=t.GE*t.gravityMultiplier,t.repellerEnabled=!0,(()=>{const e=d();f(),p(e.maxBalls??300)>0&&(e.p={spawnedTotal:0,side:0,cooldown:0,batchCount:0,batchPaused:!1,queueA:-1,queueB:-1,queueColorA:void 0,queueColorB:void 0,queueSideA:0,queueSideB:1},ce(e,se(e.p),e.p.side),e.p.side=1-e.p.side)})()):e===ua.FLIES?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=p(e.fliesBallCount??60);if(0>=t)return;const a=.5*e.canvas.width,n=.5*e.canvas.height,o=150*e.DPR,i=300*e.DPR;for(let r=0;8>r;r++){const e=Math.random()*Math.PI*2,t=Math.random()*o,l=ne(a+Math.cos(e)*t,n+Math.sin(e)*t,T(r)),s=.5+.5*Math.random(),c=Math.random()*Math.PI*2,d=i*s;l.vx=Math.cos(c)*d,l.vy=Math.sin(c)*d,l.driftAx=0,l.driftTime=0}for(let r=8;t>r;r++){const e=Math.random()*Math.PI*2,t=Math.random()*o,r=ne(a+Math.cos(e)*t,n+Math.sin(e)*t),l=.5+.5*Math.random(),s=Math.random()*Math.PI*2,c=i*l;r.vx=Math.cos(s)*c,r.vy=Math.sin(s)*c,r.driftAx=0,r.driftTime=0}})()):e===ua.WEIGHTLESS?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=p(e.weightlessCount);if(0>=t)return;const a=e.canvas.width,n=e.canvas.height,o=e.DPR||1,i=40*o,r=e.weightlessInitialSpeed*o;for(let l=0;8>l&&t>l;l++){const e=ne(i+Math.random()*(a-2*i),i+Math.random()*(n-2*i),T(l)),t=Math.random()*Math.PI*2,o=r*(.7+.3*Math.random());e.vx=Math.cos(t)*o,e.vy=Math.sin(t)*o,e.driftAx=0,e.driftTime=0}for(let l=8;t>l;l++){const e=ne(i+Math.random()*(a-2*i),i+Math.random()*(n-2*i)),t=Math.random()*Math.PI*2,o=r*(.7+.3*Math.random());e.vx=Math.cos(t)*o,e.vy=Math.sin(t)*o,e.driftAx=0,e.driftTime=0}})()):e===ua.WATER?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f(),en.length=0;const t=e.canvas;if(!t)return;const a=t.width,n=t.height,o=p(e.waterBallCount||100);if(0>=o)return;const i=(e.waterInitialVelocity||120)*(e.DPR||1);for(let r=0;8>r&&o>r;r++){const t=Math.random()*a,o=Math.random()*n,l=Q(e,ua.WATER),s=T(r),c=new Qa(t,o,l,s);c.vx=(Math.random()-.5)*i,c.vy=(Math.random()-.5)*i,e.balls.push(c)}for(let r=8;o>r;r++){const t=Math.random()*a,o=Math.random()*n,r=Q(e,ua.WATER),l=F(),s=new Qa(t,o,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}})()):e===ua.VORTEX?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=e.canvas;if(!t)return;const a=t.width,n=t.height,o=p(Math.min(e.vortexBallCount||180,e.maxBalls||500));if(0>=o)return;const i=80*(e.vortexSpeedMultiplier??1)*(e.DPR||1);for(let r=0;8>r&&o>r;r++){const t=Math.random()*a,o=Math.random()*n,l=Q(e,ua.VORTEX),s=T(r),c=new Qa(t,o,l,s);c.vx=(Math.random()-.5)*i,c.vy=(Math.random()-.5)*i,e.balls.push(c)}for(let r=8;o>r;r++){const t=Math.random()*a,o=Math.random()*n,r=Q(e,ua.VORTEX),l=F(),s=new Qa(t,o,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}})()):e===ua.PING_PONG?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=e.canvas;if(!t)return;const a=t.width,n=t.height,o=p(Math.min(e.pingPongBallCount||80,e.maxBalls||300));if(0>=o)return;const i=e.pingPongSpeed||400;for(let r=0;8>r&&o>r;r++){const t=Math.random()*a,o=.15*n+Math.random()*n*.7,l=Q(e,ua.PING_PONG),s=T(r),c=new Qa(t,o,l,s);c.vx=(Math.random()>.5?1:-1)*(.8*i+Math.random()*i*.4),c.vy=0,c.isPingPong=!0,e.balls.push(c)}for(let r=8;o>r;r++){const t=Math.random()*a,o=.15*n+Math.random()*n*.7,r=Q(e,ua.PING_PONG),l=F(),s=new Qa(t,o,r,l);s.vx=(Math.random()>.5?1:-1)*(.8*i+Math.random()*i*.4),s.vy=0,s.isPingPong=!0,e.balls.push(s)}})()):e===ua.MAGNETIC?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=e.canvas;if(!t)return;const a=t.width,n=t.height,o=p(Math.min(e.magneticBallCount||180,e.maxBalls||300));if(0>=o)return;const i=100*(e.DPR||1);for(let r=0;8>r&&o>r;r++){const t=Math.random()*a,o=Math.random()*n,l=Q(e,ua.MAGNETIC),s=T(r),c=new Qa(t,o,l,s);c.vx=(Math.random()-.5)*i,c.vy=(Math.random()-.5)*i,c.charge=Math.random()>.5?1:-1,c.baseAlpha=1,e.balls.push(c)}for(let r=8;o>r;r++){const t=Math.random()*a,o=Math.random()*n,r=Q(e,ua.MAGNETIC),l=F(),s=new Qa(t,o,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,s.charge=Math.random()>.5?1:-1,s.baseAlpha=1,e.balls.push(s)}})()):e===ua.BUBBLES?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();e.balls.length=0;const t=e.canvas;if(!t)return;const a=t.width,n=t.height,o=p(e.bubblesMaxCount||200);if(o>0){for(let e=0;8>e&&o>e;e++)ve(Math.random()*a,Math.random()*n,T(e),!0);for(let e=8;o>e;e++)ve(Math.random()*a,Math.random()*n,F(),!0)}})()):e===ua.KALEIDOSCOPE?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Le(p(d().kaleidoscopeBallCount??23),ua.KALEIDOSCOPE)):e===ua.KALEIDOSCOPE_1?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Le(p(d().kaleidoscope1BallCount??18),ua.KALEIDOSCOPE_1)):e===ua.KALEIDOSCOPE_2?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Le(p(d().kaleidoscope2BallCount??36),ua.KALEIDOSCOPE_2)):e===ua.KALEIDOSCOPE_3?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Le(p(d().kaleidoscope3BallCount??54),ua.KALEIDOSCOPE_3)):e===ua.ORBIT_3D?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=p(Math.max(0,0|(e.orbit3dMoonCount??80)));if(0>=t)return;const a=e.canvas.width,n=e.canvas.height;for(let o=0;t>o;o++){const t=Math.random()*Math.PI*2,i=.15*Math.min(a,n)+Math.random()*Math.min(a,n)*.1,r=ne(.5*a+Math.cos(t)*i,.5*n+Math.sin(t)*i,8>o?T(o):F());if(!r)continue;const l=e.DPR||1,s=(e.orbit3dVelocityMult??150)*(.9+.2*Math.random())*l;r.vx=-Math.sin(t)*s,r.vy=Math.cos(t)*s,r.orbitDepth=Math.random()}})()):e===ua.ORBIT_3D_2?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d();f();const t=p(Math.max(0,0|(e.orbit3d2MoonCount??100)));if(0>=t)return;const a=e.canvas.width,n=e.canvas.height;for(let o=0;t>o;o++){const t=Math.random()*Math.PI*2,i=.35*Math.min(a,n)+Math.random()*Math.min(a,n)*.15,r=ne(.5*a+Math.cos(t)*i,.5*n+Math.sin(t)*i,8>o?T(o):F());if(!r)continue;const l=150*(e.orbit3d2VelocityMult??1.1)*(e.DPR||1);r.vx=-Math.sin(t)*l,r.vy=Math.cos(t)*l,r.orbitDepth=Math.random()}})()):e===ua.CRITTERS?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,void 0===t.O&&(t.O=t.REST),void 0===t.R&&(t.R=t.FRICTION),t.REST=t.critterRestitution??t.REST,t.FRICTION=t.critterFriction??t.FRICTION,void 0===t.V&&(t.V=t.ballSpacing),t.ballSpacing=Math.min(t.ballSpacing||0,1),(()=>{const e=d();f();const t=e.canvas.width,a=e.canvas.height,n=p(Math.max(10,Math.min(260,0|e.critterCount)));if(n>0){for(let o=0;8>o&&n>o;o++){const n=ne(Math.random()*t|0,Math.random()*a|0,T(o)),i=Q(e,ua.CRITTERS);n.r=i,n.rBase=i,n.m=Math.max(1,i*i*.12),n.vx=0,n.vy=0,n.S=Math.random()*Math.PI*2,n.C=0,n.P=Math.random(),n.k=n.P,n.T=2*Math.random()-1,n.F=0}for(let o=8;n>o;o++){const n=ne(Math.random()*t|0,Math.random()*a|0,F()),o=Q(e,ua.CRITTERS);n.r=o,n.rBase=o,n.m=Math.max(1,o*o*.12),n.vx=0,n.vy=0,n.S=Math.random()*Math.PI*2,n.C=0,n.P=Math.random(),n.k=n.P,n.T=2*Math.random()-1,n.F=0}}})()):e===ua.NEURAL?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!0,(()=>{const e=d(),t=e.canvas;if(!t)return;f();const a=p(Math.max(8,Math.min(e.neuralBallCount??80,260)));if(0>=a)return;const n=t.width,o=t.height,i=40*(e.DPR||1),r=Math.min(8,a);for(let l=0;r>l;l++){const t=ne(i+Math.random()*(n-2*i),i+Math.random()*(o-2*i),T(l)),a=Q(e,ua.NEURAL);t.r=a,t.rBase=a,t.m=Math.max(1,a*a*.12),t.vx=0,t.vy=0,t.driftAx=0,t.driftTime=0,t.D=Math.random()*Math.PI*2}for(let l=r;a>l;l++){const t=ne(i+Math.random()*(n-2*i),i+Math.random()*(o-2*i),F()),a=Q(e,ua.NEURAL);t.r=a,t.rBase=a,t.m=Math.max(1,a*a*.12),t.vx=0,t.vy=0,t.driftAx=0,t.driftTime=0,t.D=Math.random()*Math.PI*2}})()):e===ua.LATTICE?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!0,(()=>{const e=d();f();const t=e.canvas,a=t.width,n=t.height,o=Math.max(8,((e,t)=>.01*t*Math.max(1,Math.min(e.width,e.height)))(t,e.latticeSpacingVw??8.5)),i=.8660254037844386*o,r=Math.ceil(a/o)+2,l=Math.ceil(n/i)+2,s=e.isMobile?Math.max(0,Math.min(1,+(e.mobileObjectReductionFactor??.7))):1;if(e.isMobile&&0>=s)return;const c=Math.sqrt(s),p=Math.max(0,Math.round(r*c)),u=Math.max(0,Math.round(l*c));if(0>=p||0>=u)return;const h=e.latticeAlignment??"center",m=(p-1)*o,g=(u-1)*i;let b,M;"center"===h?(b=.5*(a-m),M=.5*(n-g)):"top-left"===h?(b=.5*-o,M=.5*-i):"top-center"===h?(b=.5*(a-m),M=.5*-i):"top-right"===h?(b=a-m+.5*o,M=.5*-i):(b=.5*(a-m),M=.5*(n-g));const y=.25*o;for(let d=0;u>d;d++){const e=1&d?.5*o:0,t=M+d*i;for(let i=0;p>i;i++){const r=b+i*o+e;if(!(-y>r||r>a+y||-y>t||t>n+y)){const e=ne(r,t,T(Math.floor(8*Math.random())));e.latticeHomeX=r,e.latticeHomeY=t,e.latticeRow=d,e.latticeCol=i,e.vx=0,e.vy=0,e.driftAx=0,e.driftTime=0}}}})()):e===ua.PARALLAX_LINEAR?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d(),t=e.canvas;if(!t)return;f();const a=t.width,n=t.height,o=p(Math.max(0,Math.min(40,Math.round(e.parallaxLinearGridX??14)))),i=p(Math.max(0,Math.min(40,Math.round(e.parallaxLinearGridY??10)))),r=p(Math.max(0,Math.min(20,Math.round(e.parallaxLinearGridZ??7))));if(0>=o||0>=i||0>=r)return;const l=Math.max(.2,Math.min(3,e.parallaxLinearSpanX??1.35)),s=Math.max(.2,Math.min(3,e.parallaxLinearSpanY??1.35)),c=-.5*a*l,u=-.5*n*s,h=a*l/Math.max(1,o-1),m=n*s/Math.max(1,i-1),g=Math.max(10,e.parallaxLinearZNear??50),b=(Math.max(g+100,e.parallaxLinearZFar??800)-g)/Math.max(1,r-1),M=Math.max(80,e.parallaxLinearFocalLength??420),y=.768*(e.R_MED||20)*(e.DPR||1)*Math.max(.1,Math.min(6,e.parallaxLinearDotSizeMul??1.8)),v=J(e,ua.PARALLAX_LINEAR),x=.5*a,w=.5*n;let S=0;for(let d=r-1;d>=0;d--){const e=g+d*b;for(let t=0;i>t;t++)for(let a=0;o>a;a++){const n=c+a*h,o=u+t*m,i=e,r=M/(M+i),l=y*r,s=1,p=ne(x+n*r,w+o*r,T(S+2*d&7));p.r=l,p.vx=0,p.vy=0,p.alpha=s,p.I={x:n,y:o,z:i,baseScale:r},p.K=v>1e-6?1+(2*Math.random()-1)*v:1,p.B=!0,S++}}})()):e===ua.PARALLAX_PERSPECTIVE&&(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=d(),t=e.canvas;if(!t)return;f();const a=t.width,n=t.height,o=p(Math.max(0,Math.min(50,Math.round(e.parallaxPerspectiveGridX??16)))),i=p(Math.max(0,Math.min(50,Math.round(e.parallaxPerspectiveGridY??12)))),r=p(Math.max(0,Math.min(25,Math.round(e.parallaxPerspectiveGridZ??8))));if(0>=o||0>=i||0>=r)return;const l=Math.max(.2,Math.min(3,e.parallaxPerspectiveSpanX??1.45)),s=Math.max(.2,Math.min(3,e.parallaxPerspectiveSpanY??1.45)),c=-.5*a*l,u=-.5*n*s,h=a*l/Math.max(1,o-1),m=n*s/Math.max(1,i-1),g=Math.max(10,e.parallaxPerspectiveZNear??40),b=(Math.max(g+100,e.parallaxPerspectiveZFar??1200)-g)/Math.max(1,r-1),M=Math.max(0,Math.min(1,e.parallaxPerspectiveRandomness??.6)),y=Math.max(80,e.parallaxPerspectiveFocalLength??420),v=.6*(e.R_MED||20)*(e.DPR||1)*Math.max(.1,Math.min(6,e.parallaxPerspectiveDotSizeMul??1.8)),x=J(e,ua.PARALLAX_PERSPECTIVE),w=.5*a,S=.5*n;let C=0;for(let d=r-1;d>=0;d--){const e=g+d*b;for(let t=0;i>t;t++)for(let a=0;o>a;a++){const n=u+t*m,o=e,i=c+a*h+(Math.random()-.5)*h*M,r=n+(Math.random()-.5)*m*M,l=o+(Math.random()-.5)*b*M*.5,s=y/(y+l),p=v*s,f=1,g=ne(w+i*s,S+r*s,T(C+3*d&7));g.r=p,g.vx=0,g.vy=0,g.alpha=f,g.I={x:i,y:r,z:l,baseScale:s},g.K=x>1e-6?1+(2*Math.random()-1)*x:1,g.B=!0,C++}}})()),console.log(`Mode ${e} initialized with ${t.balls.length} balls`);const n=Math.max(0,Math.round(((e,t)=>{switch(e){case ua.PIT:return t.pitWarmupFrames??10;case ua.PIT_THROWS:return t.pitThrowsWarmupFrames??10;case ua.FLIES:return t.fliesWarmupFrames??10;case ua.WEIGHTLESS:return t.weightlessWarmupFrames??10;case ua.WATER:return t.waterWarmupFrames??10;case ua.VORTEX:return t.vortexWarmupFrames??10;case ua.PING_PONG:return t.pingPongWarmupFrames??10;case ua.MAGNETIC:return t.magneticWarmupFrames??10;case ua.BUBBLES:return t.bubblesWarmupFrames??10;case ua.KALEIDOSCOPE:return t.kaleidoscopeWarmupFrames??10;case ua.KALEIDOSCOPE_1:return t.kaleidoscope1WarmupFrames??10;case ua.KALEIDOSCOPE_2:return t.kaleidoscope2WarmupFrames??10;case ua.KALEIDOSCOPE_3:return t.kaleidoscope3WarmupFrames??10;case ua.ORBIT_3D:return t.orbit3dWarmupFrames??10;case ua.ORBIT_3D_2:return t.orbit3d2WarmupFrames??10;case ua.CRITTERS:return t.crittersWarmupFrames??10;case ua.NEURAL:return t.neuralWarmupFrames??10;case ua.LATTICE:return t.latticeWarmupFrames??10;case ua.PARALLAX_LINEAR:return t.parallaxLinearWarmupFrames??10;case ua.PARALLAX_PERSPECTIVE:return t.parallaxPerspectiveWarmupFrames??10;default:return 10}})(e,t)||0));if(t.warmupFramesRemaining=n,"undefined"!=typeof window&&e!==a)try{window.dispatchEvent(new CustomEvent("bb:modeChanged",{detail:{prevMode:a,mode:e}}))}catch(o){}}function He(){const e=d();try{P?.()}catch(t){}Ne(e.currentMode)}function Ze(){const e=d();return e.currentMode===ua.FLIES?oe:e.currentMode===ua.PIT||e.currentMode===ua.PIT_THROWS?ie:e.currentMode===ua.WEIGHTLESS?pe:e.currentMode===ua.WATER?ee:e.currentMode===ua.VORTEX?ge:e.currentMode===ua.PING_PONG?be:e.currentMode===ua.MAGNETIC?Me:e.currentMode===ua.BUBBLES?we:e.currentMode===ua.KALEIDOSCOPE||e.currentMode===ua.KALEIDOSCOPE_1||e.currentMode===ua.KALEIDOSCOPE_2||e.currentMode===ua.KALEIDOSCOPE_3?Ke:e.currentMode===ua.ORBIT_3D?Oe:e.currentMode===ua.ORBIT_3D_2?Re:e.currentMode===ua.CRITTERS?Be:e.currentMode===ua.NEURAL?Ee:e.currentMode===ua.LATTICE?$e:e.currentMode===ua.PARALLAX_LINEAR?Ge:e.currentMode===ua.PARALLAX_PERSPECTIVE?_e:null}function je(){const e=d();return e.currentMode===ua.WATER?te:e.currentMode===ua.PIT_THROWS?de:e.currentMode===ua.MAGNETIC?ye:e.currentMode===ua.BUBBLES?Se:null}function Ye(){return d().currentMode===ua.NEURAL?{preRender:We}:null}function Xe(){try{return!!window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches}catch(e){return!1}}function qe(e,t,a){return t>e?t:e>a?a:e}function Ue(e,t){const a=[{x:xn,y:xn},{x:t.width-xn,y:xn},{x:xn,y:t.height-xn},{x:t.width-xn,y:t.height-xn}];for(let n=0;a.length>n;n++){const t=e.x-a[n].x,o=e.y-a[n].y,i=Math.max(1,Math.hypot(t,o));if(xn+e.r>i){const a=(xn+e.r-i)/(xn+e.r)*1800,n=o/i;e.vx+=t/i*a*yn,e.vy+=n*a*yn}}}function Je(e,t){const a=d(),n=a.balls,o=a.canvas;if(!o)return;if(0===n.length)return;if(a.currentMode===ua.KALEIDOSCOPE||a.currentMode===ua.KALEIDOSCOPE_1||a.currentMode===ua.KALEIDOSCOPE_2||a.currentMode===ua.KALEIDOSCOPE_3){const i=Math.min(.033,Math.max(0,e)),r=n.length;for(let e=0;r>e;e++)n[e].step(i,t);(({iterations:e=4,positionalCorrectionPercent:t=.25,positionalCorrectionSlopPx:a=null,maxCorrectionPx:n=null,enableSound:o=!0}={})=>{const i=d(),r=i.balls,l=H(),s=i.REST,c=t,p=a??.5*i.DPR,u=i.ballSpacing||0,h=n??2*(i.DPR||1);for(let d=0;e>d;d++)for(let e=0;l.length>e;e++){const{i:t,j:a}=l[e],n=r[t],f=r[a];if(n.isSleeping&&f.isSleeping)continue;n.isSleeping&&n.wake(),f.isSleeping&&f.wake();const m=f.x-n.x,g=f.y-n.y,b=n.r+f.r+(n.r+f.r)/2*u,M=m*m+g*g;if(0===M||M>b*b)continue;const y=Math.sqrt(M),v=m/y,x=g/y,w=b-y,S=1/Math.max(n.m,.001),C=1/Math.max(f.m,.001);let P=c*Math.max(w-p,0)/(S+C);P>h&&(P=h);const k=P*v,F=P*x;n.x-=k*S,n.y-=F*S,f.x+=k*C,f.y+=F*C;const T=(f.vx-n.vx)*v+(f.vy-n.vy)*x;if(0>T){const e=-(1+(30>Math.abs(T)?0:s))*T/(S+C),r=e*v,l=e*x;if(n.vx-=r*S,n.vy-=l*S,f.vx+=r*C,f.vy+=l*C,o&&0===d){const e=(n.r+f.r)/2,o=(n.x+f.x)/2/(i.canvas?.width||1);R(e,Math.min(1,Math.abs(T)/(50*(n.r+f.r))),o,`${t}-${a}`)}}}})({iterations:3,positionalCorrectionPercent:.22,maxCorrectionPx:1.25*(a.DPR||1),enableSound:!1});for(let e=0;r>e;e++)Te(n[e],o.width,o.height,i);return void(vn=0)}vn+=e;let i=0;for(;vn>=yn&&ma.MAX_PHYSICS_STEPS>i;){const e=n.length;for(let a=0;e>a;a++)n[a].step(yn,t);if(a.currentMode===ua.KALEIDOSCOPE||a.currentMode===ua.KALEIDOSCOPE_1||a.currentMode===ua.KALEIDOSCOPE_2||a.currentMode===ua.KALEIDOSCOPE_3?Z(6):a.currentMode!==ua.FLIES&&a.currentMode!==ua.ORBIT_3D&&a.currentMode!==ua.PARALLAX_LINEAR&&a.currentMode!==ua.PARALLAX_PERSPECTIVE&&Z(10),Ua.clearAllPressure(),a.currentMode!==ua.ORBIT_3D&&a.currentMode!==ua.ORBIT_3D_2&&a.currentMode!==ua.PARALLAX_LINEAR&&a.currentMode!==ua.PARALLAX_PERSPECTIVE&&a.currentMode!==ua.LATTICE){const e=a.currentMode===ua.WEIGHTLESS?a.weightlessBounce:a.REST,t=a.currentMode===ua.PIT||a.currentMode===ua.PIT_THROWS,i=n.length;for(let a=0;i>a;a++)t||Ue(n[a],o),n[a].walls(o.width,o.height,yn,e)}if(a.currentMode===ua.PIT||a.currentMode===ua.PIT_THROWS){Z(3);const e=a.REST,t=n.length;for(let a=0;t>a;a++)n[a].walls(o.width,o.height,yn,e,{registerEffects:!1});const i=a.DPR||1,r=8*i,l=.1,s=a.timeToSleep??.25;for(let a=0;t>a;a++){const e=n[a];if(!e||e.isSleeping)continue;const t=Math.sqrt(e.vx*e.vx+e.vy*e.vy),o=Math.abs(e.omega);(e.isGrounded||e.hasSupport)&&r>t&&l>o?(e.vx*=.5,e.vy*=.5,e.omega*=.5,2*i>t&&(e.vx=0,e.vy=0),.02>o&&(e.omega=0),e.sleepTimer+=yn,s>e.sleepTimer||(e.vx=0,e.vy=0,e.omega=0,e.isSleeping=!0)):e.sleepTimer=0}}vn-=yn,i++}const r=je();r&&r(e),Ua.step(e),vn>yn*ma.ACCUMULATOR_RESET_THRESHOLD&&(vn=0)}function Qe(){return null===Cn&&(Cn=(()=>{try{return!1}catch(e){}try{if("8001"==(globalThis?.location?.port??"")+"")return!0}catch(e){}try{if(Array.from(document.scripts||[]).some(e=>{if("module"!==(e.getAttribute("type")||"").toLowerCase())return!1;const t=e.getAttribute("src")||"";return/(^|\/)main\.js(\?|#|$)/.test(t)}))return!0}catch(e){}return!1})()),Cn}function et(){const e=Math.random();let t=0;for(let a=0;8>a;a++)if(t+=Dn[a],t>=e)return Tn[a];return Tn[0]}function tt({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"],silence:a=!1}={}){if(!Fn){Fn=!0;try{Sn.log("%c"+e,"color: #888; font-style: italic;"),Sn.log("");const a=((e,t=3)=>{const{colorAssignments:a}=((e,t=3)=>{const a=[];for(let r=0;e.length>r;r++){const n=e[r];for(let e=0;n.length>e;e+=t){const o=n.slice(e,e+t);a.push({row:r,col:e,visible:o.trim().length>0})}}const n=a.map((e,t)=>e.visible?t:-1).filter(e=>e>=0),o=Array(a.length).fill(null),i=(e=>{for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e})([...n]);for(let r=0;Math.min(8,i.length)>r;r++)o[i[r]]=Tn[r];for(const r of n)null===o[r]&&(o[r]=et());for(let r=0;a.length>r;r++)null===o[r]&&(o[r]="transparent");return{clusters:a,colorAssignments:o}})(e,t),n=[];let o=0;for(const i of e){let e="";const r=[];for(let n=0;i.length>n;n+=t)e+="%c"+i.slice(n,n+t),r.push(`color: ${a[o]}; font-family: monospace; font-weight: bold;`),o++;n.push([e,...r])}return n})(t,3);for(const e of a)Sn.log(...e);Sn.log("");const n=(new Date).getFullYear();Sn.log("%c© "+n+" Alexander Beck Studio. All rights reserved. Unauthorized reproduction prohibited.","color: #555; font-size: 10px;")}catch(n){}if(a)try{console.log=()=>{},console.info=()=>{},console.warn=()=>{},console.debug=()=>{},console.table=()=>{},console.group=()=>{},console.groupCollapsed=()=>{},console.groupEnd=()=>{}}catch(n){}}}function at(e){if(!Qe())return;const t=("undefined"!=typeof performance&&performance.now?performance.now():Date.now())-kn;Pn+=1,Sn.log(`[${(Pn+"").padStart(2,"0")}] +${t.toFixed(1)}ms ${e}`)}function nt(e){if(Qe())try{performance.mark(e)}catch(t){}}function ot(e,t,a){if(!Qe())return null;try{performance.measure(e,t,a);const n=performance.getEntriesByName(e),o=n&&n.length?n[n.length-1]:null;return o?o.duration:null}catch(n){return null}}function it(e,t){return getComputedStyle(document.documentElement).getPropertyValue(e).trim()||t}function rt(){const e=navigator.userAgent||"",t=/Android/.test(e),a=/iPhone|iPad|iPod/.test(e)||/Mac/.test(e)&&navigator.maxTouchPoints>1,n=t||a,o=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||window.matchMedia&&window.matchMedia("(display-mode: minimal-ui)").matches||!0===navigator.standalone;return n||o}function lt(e){const t=document.documentElement;t.style.setProperty("--wall-color",e),t.style.setProperty("--frame-color-light",e),t.style.setProperty("--frame-color-dark",e)}function st(e){if(Ln&&An){const t=document.documentElement;return t.style.setProperty("--frame-color-light",Ln),t.style.setProperty("--frame-color-dark",An),void t.style.setProperty("--wall-color",e?An:Ln)}lt(it(e?"--frame-color-dark":"--frame-color-light","#0a0a0a"))}function ct(e){Ln&&An||(Ln=it("--frame-color-light","#0a0a0a"),An=it("--frame-color-dark","#0a0a0a")),lt(it(e?"--wall-color-browser-dark":"--wall-color-browser-light",e?"#202124":"#f1f3f4"))}function dt(e,t){return getComputedStyle(document.documentElement).getPropertyValue(e).trim()||t}function pt(e){In=e;let t=!1;t="auto"===e?"dark"===Kn||(()=>{const e=d();if(!e.autoDarkModeEnabled)return!1;const t=Number.isFinite(e.autoDarkNightStartHour)?e.autoDarkNightStartHour:18,a=Number.isFinite(e.autoDarkNightEndHour)?e.autoDarkNightEndHour:6,n=(new Date).getHours();return t!==a&&(a>t?n>=t&&a>n:n>=t||a>n)})():"dark"===e,(e=>{const t=d();t.isDarkMode=e,document.documentElement.style.colorScheme=e?"dark":"light",e?(t.container?.classList.add("dark-mode"),document.body.classList.add("dark-mode"),document.documentElement.classList.add("dark-mode")):(t.container?.classList.remove("dark-mode"),document.body.classList.remove("dark-mode"),document.documentElement.classList.remove("dark-mode")),(e=>{const t=(d().chromeHarmonyMode||"auto")+"",a=(()=>{const e=navigator.userAgent||"",t=navigator.vendor||"";return{isFirefox:/Firefox\//.test(e),isSafari:/Safari\//.test(e)&&/Apple/.test(t)&&!/Chrome\//.test(e)&&!/Chromium\//.test(e),isChromium:/Chrome\//.test(e)||/Chromium\//.test(e)||/Edg\//.test(e),ua:e}})();if("site"===t)return st(e),{mode:t,family:a,themeColorLikelyApplied:rt()};if("browser"===t)return ct(e),{mode:t,family:a,themeColorLikelyApplied:rt()};const n=rt();a.isSafari?st(e):a.isChromium&&!n?ct(e):st(e)})(e),(e=>{const t=(()=>{const e=d();return{light:e?.bgLight||dt("--bg-light","#f5f5f5"),dark:e?.bgDark||dt("--bg-dark","#0a0a0a")}})(),a=dt("--chrome-bg-light",t.light),n=dt("--chrome-bg-dark",t.dark),o=e?n:a;let i=document.querySelector('meta[name="theme-color"]');i||(i=document.createElement("meta"),i.name="theme-color",document.head.appendChild(i)),i.content=o;let r=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: light)"]');r||(r=document.createElement("meta"),r.name="theme-color",r.media="(prefers-color-scheme: light)",document.head.appendChild(r)),r.content=a;let l=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: dark)"]');l||(l=document.createElement("meta"),l.name="theme-color",l.media="(prefers-color-scheme: dark)",document.head.appendChild(l)),l.content=n})(e),D(t.currentTemplate),(()=>{const e=document.getElementById("themeAuto"),t=document.getElementById("themeLight"),a=document.getElementById("themeDark");if(!e||!t||!a)return;[e,t,a].forEach(e=>e.classList.remove("active")),"auto"===In?e.classList.add("active"):"light"===In?t.classList.add("active"):a.classList.add("active");const n=document.getElementById("themeStatus");if(n){const e=d();n.textContent="auto"===In?e.isDarkMode?"🌙 Auto (Dark)":"☀️ Auto (Light)":"light"===In?"☀️ Light Mode":"🌙 Dark Mode"}})()})(t);try{localStorage.setItem("theme-preference",e)}catch(a){}at(`🎨 Theme set to: ${e} (rendering: ${t?"dark":"light"})`)}function ut(){if(On)return;On=!0,(()=>{const e=d(),t=document.documentElement;e?.bgLight&&(t.style.setProperty("--bg-light",e.bgLight),t.style.setProperty("--chrome-bg-light",e.bgLight)),e?.bgDark&&(t.style.setProperty("--bg-dark",e.bgDark),t.style.setProperty("--chrome-bg-dark",e.bgDark)),e?.frameColor&&(t.style.setProperty("--frame-color-light",e.frameColor),t.style.setProperty("--frame-color-dark",e.frameColor),t.style.setProperty("--wall-color",e.frameColor)),e?.textColorLight&&(t.style.setProperty("--text-color-light",e.textColorLight),t.style.setProperty("--text-color-light-base",e.textColorLight)),e?.textColorLightMuted&&t.style.setProperty("--text-color-light-muted",e.textColorLightMuted),e?.textColorDark&&(t.style.setProperty("--text-color-dark",e.textColorDark),t.style.setProperty("--text-color-dark-base",e.textColorDark)),e?.textColorDarkMuted&&t.style.setProperty("--text-color-dark-muted",e.textColorDarkMuted),e?.linkHoverColor&&t.style.setProperty("--link-hover-color",e.linkHoverColor),e?.logoColorLight&&t.style.setProperty("--logo-color-light",e.logoColorLight),e?.logoColorDark&&t.style.setProperty("--logo-color-dark",e.logoColorDark)})(),Kn=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",at("🖥️ System prefers: "+Kn);let e="auto";try{const t=localStorage.getItem("theme-preference");"auto"!==t&&"light"!==t&&"dark"!==t||(e=t)}catch(o){}pt(e);const t=document.getElementById("themeAuto"),a=document.getElementById("themeLight"),n=document.getElementById("themeDark");t&&t.addEventListener("click",()=>pt("auto")),a&&a.addEventListener("click",()=>pt("light")),n&&n.addEventListener("click",()=>pt("dark")),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{Kn=e.matches?"dark":"light",at("🖥️ System preference changed to: "+Kn),"auto"===In&&pt("auto")}),window.setInterval(()=>{"auto"===In&&pt("auto")},6e4),at("✓ Modern dark mode initialized")}function ht(){pt("light"===In?"dark":"light")}function ft(){console.log("⚠️ localStorage is disabled")}function mt(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(ft,500)}function gt(e){return!1!==Vn[e]}function bt(e,t=!0){const a=ba[e];if(!a)return;const n=d();for(const[i,r]of Object.entries(a))"label"!==i&&void 0!==n[i]&&(n[i]=r);n.parallaxLinearPreset=e,t&&Promise.resolve().then(()=>un).then(({resetCurrentMode:e})=>e());try{kt()}catch(o){}console.log("Applied parallax linear preset: "+a.label)}function Mt(e,t=!0){const a=Ma[e];if(!a)return;const n=d();for(const[i,r]of Object.entries(a))"label"!==i&&void 0!==n[i]&&(n[i]=r);n.parallaxPerspectivePreset=e,t&&Promise.resolve().then(()=>un).then(({resetCurrentMode:e})=>e());try{kt()}catch(o){}console.log("Applied parallax perspective preset: "+a.label)}function yt(e){return{id:e,label:"Warmup Frames",stateKey:e,type:"range",min:0,max:240,step:1,default:10,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0,hint:"Pre-runs physics before first render to avoid visible settling on mode start."}}function vt(e,t){try{if("function"==typeof e?.format)return e.format(t)}catch(a){}return(t??"")+""}function xt(){const e=[];for(const t of Object.values(Bn))for(const a of t.controls)e.push({...a,section:t.title});return e}function wt(e){if("divider"===e.type)return`<div class="control-divider"><span class="control-divider-label">${e.label||""}</span></div>`;if(!gt(e.id))return"";const t=e.id+"Slider",a=e.id+"Val";if("color"===e.type)return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${e.default}</span>\n        </div>\n        <input type="color" id="${e.id+"Picker"}" value="${e.default}" aria-label="${e.label}" />\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`;if("select"===e.type){const n=(Array.isArray(e.options)?e.options:[]).map(t=>{const a=t.value+"";return`<option value="${a}" ${e.default+""===a?"selected":""}>${(t.label??t.value)+""}</option>`}).join(""),o=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${vt(e,e.default)}</span>\n        </div>\n        <select id="${t}" class="control-select" aria-label="${e.label}">\n          ${n}\n        </select>\n      </label>\n      ${o}`}if("checkbox"===e.type)return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${e.default?"On":"Off"}</span>\n        </div>\n        <input type="checkbox" id="${t}" ${e.default?"checked":""} aria-label="${e.label}">\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`;const n=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="${a}">${vt(e,e.default)}</span>\n        </div>\n        <input type="range" id="${t}" min="${e.min}" max="${e.max}" step="${e.step}" value="${e.default}">\n      </label>\n      ${n}`}function St(e,t){const a=t.controls.filter(e=>gt(e.id));if(0===a.length)return"";let n=null,o="";for(const s of a)s.group&&s.group!==n?(null!==n&&(o+="</div>"),o+=`<div class="section-title" style="margin-top: 12px;">${s.group}</div><div class="group">`,n=s.group):s.group||null===n||(o+="</div>",n=null),o+=wt(s);null!==n&&(o+="</div>");const i=t.defaultOpen?"open":"",r=`\n    <summary class="panel-section-header">\n      ${t.icon?`<span class="section-icon">${t.icon}</span>`:""}\n      <span class="section-label">${t.title}</span>\n    </summary>`,l=`<div class="panel-section-content">${o}</div>`;return t.mode?`\n      <div id="${t.mode}Controls" class="mode-controls">\n        <details class="panel-section-accordion" ${i}>\n          ${r}\n          ${l}\n        </details>\n      </div>`:`\n    <details class="panel-section-accordion" ${i}>\n      ${r}\n      ${l}\n    </details>`}function Ct(){try{for(const[,e]of Object.entries(Bn)){if(!e?.mode)continue;const t=Array.isArray(e.controls)?e.controls.length:0;4>t&&console.warn(`[panel] Mode "${e.mode}" has only ${t} controls; add at least 4 parameters.`)}}catch(a){}const e=Object.entries(Bn).filter(([,e])=>e?.mode).map(([e,t])=>St(0,t)).join("");let t=`\n    \x3c!-- Screen reader announcements --\x3e\n    <div role="status" aria-live="polite" aria-atomic="true" class="sr-only" id="announcer"></div>\n\n    \x3c!-- Theme --\x3e\n    <details class="panel-section-accordion" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎨</span>\n        <span class="section-label">Theme</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="theme-segment-control" role="group" aria-label="Theme selector">\n          <button id="themeAuto" class="theme-segment-btn" aria-label="Auto theme">Auto</button>\n          <button id="themeLight" class="theme-segment-btn active" aria-label="Light theme">Light</button>\n          <button id="themeDark" class="theme-segment-btn" aria-label="Dark theme">Dark</button>\n        </div>\n        <div id="themeStatus" class="panel-status">☀️ Light Mode</div>\n      </div>\n    </details>\n\n    \x3c!-- Mode --\x3e\n    <details class="panel-section-accordion" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎛️</span>\n        <span class="section-label">Mode</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="mode-switcher" role="group" aria-label="Simulation mode selector">\n          ${(()=>{const e={pit:"🎯",bubbles:"🫧",critters:"🪲",flies:"🕊️","pit-throws":"🎯",water:"🌊",vortex:"🌀",magnetic:"🧲","ping-pong":"🏓",weightless:"🌌",kaleidoscope:"🪞","kaleidoscope-1":"🪞","kaleidoscope-2":"🪞","kaleidoscope-3":"🪞","orbit-3d":"🌪️","orbit-3d-2":"🌪️",lattice:"💎",neural:"🧠"},t={pit:"Pit",bubbles:"Bubbles",critters:"Critters",flies:"Flies","pit-throws":"Throws",water:"Water",vortex:"Vortex",magnetic:"Magnet","ping-pong":"Pong",weightless:"Zero-G",kaleidoscope:"Kalei","kaleidoscope-1":"Kalei I","kaleidoscope-2":"Kalei II","kaleidoscope-3":"Kalei III","orbit-3d":"Orbit","orbit-3d-2":"Swarm",lattice:"Lattice",neural:"Neural"};let a="";return ha.forEach(n=>{const o=t[n]||n;a+=`<button class="mode-button" data-mode="${n}" aria-label="${fa[n]||o} mode">${e[n]||"⚪"} ${o}</button>`}),a})()}\n        </div>\n        ${e}\n      </div>\n    </details>`;for(const[n,o]of Object.entries(Bn))o.mode||(t+=St(0,o));return t+='\n    <details class="panel-section-accordion">\n      <summary class="panel-section-header">\n        <span class="section-icon">🌈</span>\n        <span class="section-label">Colors</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Color Template</span>\n            <span class="control-value"></span>\n          </div>\n          <select id="colorSelect"></select>\n        </label>\n      </div>\n    </details>',t+='\n    <div class="panel-section panel-section--action">\n      <button id="saveConfigBtn" class="primary">💾 Save Config</button>\n    </div>\n    <div class="panel-footer">\n      <kbd>R</kbd> reset · <kbd>/</kbd> panel · <kbd>9</kbd> kalei · Critters + Throws have no key (yet)\n    </div>',t}function Pt(){const e=d();for(const[t,a]of Object.entries(Bn))for(const n of a.controls){const t=document.getElementById(n.id+"Val");if("color"===n.type){const a=document.getElementById(n.id+"Picker");if(!a)continue;a.addEventListener("input",()=>{const o=a.value;n.stateKey&&(e[n.stateKey]=o),n.onChange&&n.onChange(e,o),t&&(t.textContent=o),mt()});continue}if("select"===n.type){const a=document.getElementById(n.id+"Slider");if(!a)continue;a.addEventListener("change",()=>{const o=n.parse?n.parse(a.value):a.value;if(n.stateKey&&(e[n.stateKey]=o),n.onChange&&n.onChange(e,o),t){const a=n.stateKey?e[n.stateKey]:o;t.textContent=n.format?n.format(a):a+""}mt()});continue}if("checkbox"===n.type){const o=document.getElementById(n.id+"Slider");if(!o)continue;o.addEventListener("change",()=>{const i=!!o.checked;n.stateKey&&(e[n.stateKey]=i),n.onChange&&n.onChange(e,i),t&&(t.textContent=i?"On":"Off"),n.reinitMode&&e.currentMode===a.mode&&Promise.resolve().then(()=>un).then(({resetCurrentMode:e})=>e?.()).catch(()=>{}),mt()});continue}const o=document.getElementById(n.id+"Slider");o&&o.addEventListener("input",()=>{const i=n.parse(o.value);if(n.stateKey&&(e[n.stateKey]=i),n.onChange&&n.onChange(e,i),t&&(t.textContent=n.format(n.stateKey?e[n.stateKey]:i)),n.cssVar&&zn){const e={};e[n.cssVar.replace("--","").replace(/-([a-z])/g,(e,t)=>t.toUpperCase())]=i,zn(e)}n.reinitMode&&e.currentMode===a.mode&&Promise.resolve().then(()=>un).then(({resetCurrentMode:e})=>e?.()).catch(()=>{}),mt()})}}function kt(){const e=d();for(const t of Object.values(Bn))for(const a of t.controls){const t=a.id+"Val",n=document.getElementById(a.id+"Slider"),o=document.getElementById(t);if(!n||!a.stateKey)continue;const i=e[a.stateKey];void 0!==i&&("checkbox"===a.type?(n.checked=!!i,o&&(o.textContent=i?"On":"Off")):(n.value=i,o&&(o.textContent=a.format(i))))}}function Ft(){Pt(),document.querySelectorAll(".mode-button").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const a=e.getAttribute("data-mode");console.log("Mode button clicked:",a),Ne(a),Tt(a)})}),L();const e=document.getElementById("colorSelect");e&&e.addEventListener("change",()=>{D(e.value),mt()});const t=document.getElementById("themeAuto"),a=document.getElementById("themeLight"),n=document.getElementById("themeDark");[t,a,n].forEach(e=>{e&&e.addEventListener("click",()=>{[t,a,n].forEach(e=>e?.classList.remove("active")),e.classList.add("active")})})}function Tt(e){document.querySelectorAll(".mode-button").forEach(t=>{const a=t.getAttribute("data-mode")===e;t.classList.toggle("active",a)}),document.querySelectorAll(".mode-controls").forEach(e=>e.classList.remove("active"));const t=document.getElementById(e+"Controls");t&&t.classList.add("active");const a=document.getElementById("announcer");a&&(a.textContent=`Switched to ${{critters:"Critters",pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero-G",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope","kaleidoscope-1":"Kaleidoscope I","kaleidoscope-2":"Kaleidoscope II","kaleidoscope-3":"Kaleidoscope III","orbit-3d":"Orbit 3D","orbit-3d-2":"Orbit 3D (Tight Swarm)",lattice:"Crystal Lattice",neural:"Neural Network"}[e]||e} mode`);try{const t=document.getElementById("edge-chapter-text");t&&(t.textContent=fa?.[e]||"—")}catch(n){}}function Dt(e,t){const a=t();for(const n of Object.values(Gn))for(const t of n.controls){const n=e.querySelector("#sound_"+t.id),o=e.querySelector(`#sound_${t.id}_val`);if(!n||void 0===a[t.id])continue;const i=t.fromConfig(a[t.id]);n.value=i,o&&(o.textContent=t.format(i))}}function Lt(e){try{localStorage.setItem(Zn,e+"")}catch(t){}}function At(){try{const e=document.getElementById("controlPanel");e&&e.remove();const t=document.getElementById("soundPanel");t&&t.remove()}catch(e){}return _n=document.createElement("div"),_n.className="panel-dock",_n.id="panelDock",_n.classList.add("hidden"),Lt(!0),Nn=(()=>{const t=document.createElement("div");t.id="masterPanel",t.className=(()=>{try{const e=localStorage.getItem(jn);return null===e||"true"===e}catch(e){return!0}})()?"panel collapsed":"panel",t.setAttribute("role","region"),t.setAttribute("aria-label","Settings");const a=document.createElement("div");a.className="panel-header";const n=Qe()?"DEV MODE":"BUILD MODE";a.innerHTML=`\n    <div class="mac-titlebar">\n      <div class="mac-traffic" aria-hidden="true">\n        <span class="mac-dot mac-dot--red"></span>\n        <span class="mac-dot mac-dot--yellow"></span>\n        <span class="mac-dot mac-dot--green"></span>\n      </div>\n      <div class="panel-title mac-title">Settings</div>\n      <div class="mac-right">\n        <span class="panel-mode-pill" role="status" aria-label="Runtime mode">${n}</span>\n        <button class="collapse-btn mac-collapse" aria-label="Collapse panel" title="Collapse">▾</button>\n      </div>\n    </div>\n  `;const i=document.createElement("div");i.className="panel-content",i.innerHTML=(()=>{const e=d(),t=+(e.containerBorderVw||0),a=+(e.wallRadiusVw||0),n=+(e.contentPaddingVw||0),i=o(),r=e.layoutViewportWidthPx>0?Math.round(e.layoutViewportWidthPx)+"px":`Auto (${Math.round(i)}px)`,l=Math.max(0,Math.round(e.containerBorder??0)),s=Math.max(0,Math.round(e.wallRadius??e.cornerRadius??0)),c=Math.max(0,Math.round(e.contentPadding??0)),p=Math.max(0,Math.round(e.wallInset??3)),u=Math.max(0,Math.round(e.layoutMinContentPaddingPx??0)),h=+(e.contentPaddingHorizontalRatio||1),f=Math.max(0,Math.round(e.layoutMinWallRadiusPx??0));return`\n    \x3c!-- ═══════════════════════════════════════════════════════════════════════\n         LAYOUT SECTION - Frame & Content Spacing\n         ═══════════════════════════════════════════════════════════════════════ --\x3e\n    <details class="panel-section-accordion" id="layoutSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">📐</span>\n        <span class="section-label">Layout</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Frame</span>\n            <span class="control-value" id="frameValue">${t.toFixed(2)}vw · ${l}px</span>\n          </div>\n          <input type="range" id="layoutFrame" min="0" max="8" step="0.05" value="${t||0}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Content Padding</span>\n            <span class="control-value" id="contentPadValue">${n.toFixed(2)}vw · ${c}px (min ${u}px)</span>\n          </div>\n          <input type="range" id="contentPadding" min="0" max="12" step="0.05" value="${n||0}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Horizontal Ratio</span>\n            <span class="control-value" id="contentPadHorizRatioValue">${h.toFixed(2)}× → ${Math.round(c*h)}px</span>\n          </div>\n          <input type="range" id="contentPadHorizRatio" min="0.5" max="2.5" step="0.05" value="${h}" />\n          <div class="control-hint">Horizontal padding = base × ratio</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Min Content Padding</span>\n            <span class="control-value" id="minContentPadValue">${u}px</span>\n          </div>\n          <input type="range" id="layoutMinContentPaddingPx" min="0" max="64" step="1" value="${u}" />\n          <div class="control-hint">Clamp target on smallest viewports (px).</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Radius</span>\n            <span class="control-value" id="radiusValue">${a.toFixed(2)}vw · ${s}px (min ${f}px)</span>\n          </div>\n          <input type="range" id="layoutRadius" min="0" max="20" step="0.05" value="${a||0}" />\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Min Radius</span>\n            <span class="control-value" id="minRadiusValue">${f}px</span>\n          </div>\n          <input type="range" id="layoutMinWallRadiusPx" min="0" max="120" step="1" value="${f}" />\n          <div class="control-hint">Clamp target on smallest viewports (px).</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Viewport Width</span>\n            <span class="control-value" id="viewportWidthValue">${r}</span>\n          </div>\n          <input type="range" id="layoutViewportWidth" min="0" max="2400" step="10" value="${Math.round(e.layoutViewportWidthPx||0)}" />\n          <div class="control-hint">0 = Auto (uses current window width)</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Wall Inset</span>\n            <span class="control-value" id="wallInsetValue">${p}px</span>\n          </div>\n          <input type="range" id="layoutWallInset" min="0" max="20" value="${p}" />\n        </label>\n      </div>\n    </details>\n\n    \x3c!-- ═══════════════════════════════════════════════════════════════════════\n         SOUND SECTION\n         ═══════════════════════════════════════════════════════════════════════ --\x3e\n    <details class="panel-section-accordion" id="soundSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">🔊</span>\n        <span class="section-label">Sound</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="sound-enable-row">\n          <button id="soundEnableBtn" class="sound-enable-btn" aria-label="Enable sound" title="Enable sound">🔇</button>\n        </div>\n        <div id="soundControlsWrapper" class="sound-controls" style="display: none;">\n          <div class="sound-perf" aria-label="Sound performance controls">\n            <button type="button" id="soundTapBtn" class="sound-perf__btn" aria-label="Play test hit">▶︎</button>\n            <button type="button" id="soundResetBtn" class="sound-perf__btn" aria-label="Reset to preset">↺</button>\n            <button type="button" id="soundShuffleBtn" class="sound-perf__btn" aria-label="Shuffle (subtle) sound">🎲</button>\n            <span class="sound-perf__hint">wheel adjusts · shift/alt = fine</span>\n          </div>\n          <label class="control-row">\n            <span class="control-label">Preset</span>\n            <select id="soundPresetSelect" class="control-select"></select>\n          </label>\n          <p id="presetDescription" class="control-hint"></p>\n          ${(()=>{let e="";for(const[t,a]of Object.entries(Gn)){e+='<div class="sound-dock__section">',e+=`<div class="sound-dock__section-title">${a.title}</div>`,e+='<div class="sound-dock__group">';for(const t of a.controls)e+=`\n        <label class="sound-dock__row">\n          <span class="sound-dock__label">${t.label}</span>\n          <input type="range" \n            id="sound_${t.id}" \n            class="sound-dock__slider" \n            min="${t.min}" \n            max="${t.max}" \n            step="${t.step}">\n          <span class="sound-dock__val" id="sound_${t.id}_val">${t.format(t.fromConfig(0))}</span>\n        </label>`;e+="</div></div>"}return e})()}\n        </div>\n      </div>\n    </details>\n\n    \x3c!-- ═══════════════════════════════════════════════════════════════════════\n         CONTROLS SECTION - Theme & Mode\n         ═══════════════════════════════════════════════════════════════════════ --\x3e\n    <details class="panel-section-accordion" id="controlsSection" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">⚙️</span>\n        <span class="section-label">Controls</span>\n      </summary>\n      <div class="panel-section-content">\n        ${$n}\n      </div>\n    </details>\n  `})(),t.appendChild(a),t.appendChild(i);const r=(()=>{try{const e=localStorage.getItem(Yn);if(!e)return null;const t=JSON.parse(e);if(!t||"object"!=typeof t)return null;const a=+t.width,n=+t.height;return Number.isFinite(a)&&Number.isFinite(n)?{width:Math.round(a),height:Math.round(n)}:null}catch(e){return null}})();r&&(t.style.width=r.width+"px",t.style.height=r.height+"px",t.style.maxHeight="none");const c=a.querySelector(".collapse-btn");return c&&c.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),(t=>{t.classList.toggle("collapsed"),(t=>{try{localStorage.setItem(jn,t+"")}catch(e){}})(t.classList.contains("collapsed"))})(t)}),setTimeout(()=>{Ft(),(()=>{const t=document.getElementById("saveConfigBtn");t&&t.addEventListener("click",()=>{const t=d(),a={};try{const e=xt();for(const n of e){if(!n||!n.stateKey)continue;const e=t[n.stateKey];void 0!==e&&(a[n.stateKey]=e)}}catch(e){}a.gravityMultiplier=t.gravityMultiplierPit,a.restitution=t.REST,a.friction=t.FRICTION,a.ballMass=t.ballMassKg,a.ballScale=t.sizeScale,a.sizeScale=t.sizeScale,a.sizeVariation=t.sizeVariation,a.repelSoft=t.repelSoft,a.repelSoftness=t.repelSoft,a.layoutViewportWidthPx=t.layoutViewportWidthPx||0,a.containerBorderVw=t.containerBorderVw,a.simulationPaddingVw=t.simulationPaddingVw,a.contentPaddingVw=t.contentPaddingVw,a.contentPaddingHorizontalRatio=t.contentPaddingHorizontalRatio,a.wallRadiusVw=t.wallRadiusVw,a.wallThicknessVw=t.wallThicknessVw,a.layoutMinContentPaddingPx=Math.max(0,Math.round(t.layoutMinContentPaddingPx??0)),a.layoutMinWallRadiusPx=Math.max(0,Math.round(t.layoutMinWallRadiusPx??0)),a.wallInset=t.wallInset;try{a.soundPreset=N(),a.soundConfig=$()}catch(e){}a.chromeHarmonyMode=t.chromeHarmonyMode,a.autoDarkModeEnabled=t.autoDarkModeEnabled,a.autoDarkNightStartHour=t.autoDarkNightStartHour,a.autoDarkNightEndHour=t.autoDarkNightEndHour,a.enableLOD=!1;const n=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download="default-config.json",document.body.appendChild(o),o.click(),document.body.removeChild(o)})})(),(e=>{const t=e.querySelector("#soundEnableBtn"),a=e.querySelector("#soundControlsWrapper"),n=e.querySelector("#soundPresetSelect"),o=e.querySelector("#presetDescription"),i=e.querySelector("#soundSection"),r=e.querySelector("#soundTapBtn"),l=e.querySelector("#soundResetBtn"),s=e.querySelector("#soundShuffleBtn"),c=(e,t,a)=>t>e?t:e>a?a:e,d=(e,t)=>e+2*(Math.random()-.5)*t,p=(e,{openIfEnabled:n=!1}={})=>{if(!t)return;const o=e||W(),r=!(!o.isUnlocked||!o.isEnabled),l=!!o.isUnlocked;t.innerHTML=l&&r?'<i class="ti ti-volume-2" aria-hidden="true"></i>':'<i class="ti ti-volume-off" aria-hidden="true"></i>',t.setAttribute("aria-label",l?r?"Sound on":"Sound off":"Enable sound"),t.title=l?r?"Sound on":"Sound off":"Enable sound",t.classList.toggle("enabled",r),a&&(a.style.display=r?"":"none"),n&&r&&i&&!i.open&&(i.open=!0)};if(r&&r.addEventListener("click",()=>{z({intensity:.86,radius:18,xPosition:.72})}),l&&l.addEventListener("click",()=>{const t=N();_(t),o&&Ta[t]&&(o.textContent=Ta[t].description),Dt(e,$)}),s&&s.addEventListener("click",()=>{const t=$();G({filterBaseFreq:c(d(t.filterBaseFreq,120),300,8e3),filterQ:c(d(t.filterQ,.04),.05,.9),pitchCurve:c(d(t.pitchCurve,.06),.6,1.8),sparkleGain:c(d(t.sparkleGain,.03),0,.35),sparkleDecayMul:c(d(t.sparkleDecayMul,.05),.25,.95),noiseTransientQ:c(d(t.noiseTransientQ,.25),.6,6),reverbWetMix:c(d(t.reverbWetMix,.02),0,.35),reverbDecay:c(d(t.reverbDecay,.03),.05,.4),collisionMinImpact:c(d(t.collisionMinImpact,.03),.45,.9),variancePitch:c(d(t.variancePitch,.01),0,.2),varianceGain:c(d(t.varianceGain,.02),0,.35)}),Dt(e,$),z({intensity:.86,radius:18,xPosition:.72})}),t&&t.addEventListener("click",async()=>{const e=W();if(e.isUnlocked){const t=E();p({...e,isEnabled:t})}else await O()&&p(null,{openIfEnabled:!0})}),n){for(const[e,t]of Object.entries(Ta)){const a=document.createElement("option");a.value=e,a.textContent=t.label,n.appendChild(a)}n.value=N(),o&&Ta[N()]&&(o.textContent=Ta[N()].description),n.addEventListener("change",()=>{_(n.value),o&&Ta[n.value]&&(o.textContent=Ta[n.value].description),Dt(e,$)})}((e,t,a)=>{for(const n of Object.values(Gn))for(const t of n.controls){const n=e.querySelector("#sound_"+t.id),o=e.querySelector(`#sound_${t.id}_val`);if(!n)continue;const i=e=>{const i=(r=e,l=parseFloat(n.min),s=parseFloat(n.max),l>r?l:r>s?s:r);var r,l,s;n.value=i+"";const c=t.toConfig(i);o&&(o.textContent=t.format(i)),a({[t.id]:c})};n.addEventListener("input",()=>{i(parseFloat(n.value))}),n.addEventListener("wheel",e=>{if(e.ctrlKey)return;const t=(parseFloat(n.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),a=0>e.deltaY?1:-1,o=parseFloat(n.value);e.preventDefault(),i(o+a*t)},{passive:!1}),o&&o.addEventListener("wheel",e=>{if(e.ctrlKey)return;const t=(parseFloat(n.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),a=0>e.deltaY?1:-1,o=parseFloat(n.value);e.preventDefault(),i(o+a*t)},{passive:!1})}})(e,0,G),Dt(e,$),p(),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(Wa,e=>{p(e&&e.detail?e.detail:null)})})(t),(e=>{const t=e.querySelector("#layoutFrame"),a=e.querySelector("#frameValue"),n=e.querySelector("#contentPadding"),i=e.querySelector("#contentPadValue"),r=e.querySelector("#contentPadHorizRatio"),c=e.querySelector("#contentPadHorizRatioValue"),p=e.querySelector("#layoutMinContentPaddingPx"),u=e.querySelector("#minContentPadValue"),h=e.querySelector("#layoutRadius"),f=e.querySelector("#radiusValue"),m=e.querySelector("#layoutMinWallRadiusPx"),g=e.querySelector("#minRadiusValue"),b=e.querySelector("#layoutViewportWidth"),M=e.querySelector("#viewportWidthValue"),y=e.querySelector("#layoutWallInset"),v=e.querySelector("#wallInsetValue"),x=d(),w=({triggerResize:e=!1}={})=>{if(l(),s(),a&&(a.textContent=`${(x.containerBorderVw||0).toFixed(2)}vw · ${Math.round(x.containerBorder||0)}px`),i){const e=Math.max(0,Math.round(x.layoutMinContentPaddingPx??0));i.textContent=`${(x.contentPaddingVw||0).toFixed(2)}vw · ${Math.round(x.contentPadding||0)}px (min ${e}px)`}if(c&&(c.textContent=`${(x.contentPaddingHorizontalRatio||1).toFixed(2)}× → ${Math.round(x.contentPaddingX||x.contentPadding)}px`),f){const e=Math.max(0,Math.round(x.layoutMinWallRadiusPx??0));f.textContent=`${(x.wallRadiusVw||0).toFixed(2)}vw · ${Math.round(x.wallRadius||0)}px (min ${e}px)`}if(u&&(u.textContent=Math.max(0,Math.round(x.layoutMinContentPaddingPx??0))+"px"),g&&(g.textContent=Math.max(0,Math.round(x.layoutMinWallRadiusPx??0))+"px"),M){const e=o();M.textContent=x.layoutViewportWidthPx>0?Math.round(x.layoutViewportWidthPx)+"px":`Auto (${Math.round(e)}px)`}e&&he(),document.dispatchEvent(new CustomEvent("layout-updated"))};t&&a&&t.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(x.containerBorderVw=t,x.wallThicknessVw=t,w({triggerResize:!0}))}),n&&i&&n.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(x.contentPaddingVw=t,w())}),r&&c&&r.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(x.contentPaddingHorizontalRatio=Math.max(.1,t),w())}),p&&u&&p.addEventListener("input",e=>{const t=parseInt(e.target.value,10);Number.isFinite(t)&&(x.layoutMinContentPaddingPx=Math.max(0,t),w({triggerResize:!0}))}),h&&f&&h.addEventListener("input",e=>{const t=parseFloat(e.target.value);Number.isFinite(t)&&(x.wallRadiusVw=t,w())}),m&&g&&m.addEventListener("input",e=>{const t=parseInt(e.target.value,10);Number.isFinite(t)&&(x.layoutMinWallRadiusPx=Math.max(0,t),w({triggerResize:!0}))}),b&&M&&b.addEventListener("input",e=>{const t=parseInt(e.target.value,10);x.layoutViewportWidthPx=Number.isFinite(t)?Math.max(0,t):0,w({triggerResize:!0})}),y&&v&&y.addEventListener("input",e=>{const t=parseInt(e.target.value,10);v.textContent=t+"px",x.wallInset=t})})(t)},0),t})(),_n.appendChild(Nn),document.body.insertBefore(_n,document.body.firstChild),(()=>{if(!Nn)return;const t=Nn.querySelector(".panel-header");t&&(t.addEventListener("mousedown",It),t.addEventListener("touchstart",It,{passive:!1}),document.addEventListener("mousemove",Kt),document.addEventListener("mouseup",Ot),document.addEventListener("touchmove",Kt,{passive:!1}),document.addEventListener("touchend",Ot),(()=>{try{if(!_n)return;const e=JSON.parse(localStorage.getItem(Hn)||"{}");e.custom&&(_n.style.position="fixed",_n.style.left=e.left,_n.style.top=e.top,_n.style.right="auto")}catch(e){}})())})(),(()=>{if(!Nn)return;if("undefined"==typeof ResizeObserver)return;let t=0;const a=new ResizeObserver(()=>{Nn&&(Nn.classList.contains("collapsed")||(window.clearTimeout(t),t=window.setTimeout(()=>{(t=>{try{if(!t)return;if(t.classList.contains("collapsed"))return;const e=t.getBoundingClientRect();localStorage.setItem(Yn,JSON.stringify({width:Math.round(e.width),height:Math.round(e.height)}))}catch(e){}})(Nn)},150)))});try{a.observe(Nn)}catch(e){}})(),_n}function It(e){if(e.target.closest("button")||e.target.closest("input")||e.target.closest("select"))return;if(!_n)return;const t=e.touches?e.touches[0].clientX:e.clientX,a=e.touches?e.touches[0].clientY:e.clientY,n=_n.getBoundingClientRect();qn=t,Un=a,Jn=n.left,Qn=n.top,Xn=!1}function Kt(e){if(0===qn&&0===Un)return;if(!_n)return;const t=(e.touches?e.touches[0].clientX:e.clientX)-qn,a=(e.touches?e.touches[0].clientY:e.clientY)-Un;if(Xn||5>=Math.abs(t)&&5>=Math.abs(a)||(Xn=!0,_n.classList.add("dragging"),_n.style.position="fixed",_n.style.top=Qn+"px",_n.style.left=Jn+"px",_n.style.right="auto"),Xn){let n=Jn+t,o=Qn+a;const i=_n.getBoundingClientRect();n=Math.max(0,Math.min(window.innerWidth-i.width,n)),o=Math.max(0,Math.min(window.innerHeight-i.height,o)),_n.style.left=n+"px",_n.style.top=o+"px",e.preventDefault()}}function Ot(){Xn&&(Xn=!1,_n&&_n.classList.remove("dragging"),Rt()),qn=0,Un=0,setTimeout(()=>{},10)}function Rt(){try{if(!_n)return;localStorage.setItem(Hn,JSON.stringify({left:_n.style.left,top:_n.style.top,custom:!0}))}catch(e){}}function zt(){if(_n){_n.style.position="",_n.style.left="",_n.style.top="",_n.style.right="";try{localStorage.removeItem(Hn)}catch(e){}}}function Vt(){if(!_n)try{At()}catch(t){return}const e=_n.classList.toggle("hidden");if(Lt(e),!e)try{(()=>{if(!_n)return;if(!_n.style.left&&!_n.style.top)return;const e=_n.getBoundingClientRect(),t=window.innerWidth||0,a=window.innerHeight||0;if(!t||!a)return;const n=10;if(n>e.right||e.left>t-n||n>e.bottom||e.top>a-n)return void zt();const o=(e,t,a)=>t>e?t:e>a?a:e,i=o(e.left,n,Math.max(n,t-e.width-n)),r=o(e.top,n,Math.max(n,a-e.height-n));_n.style.position="fixed",_n.style.left=Math.round(i)+"px",_n.style.top=Math.round(r)+"px",_n.style.right="auto",Rt()})()}catch(t){}}function Bt(e){const t=d(),a=ha;if(!a||!a.length)return;const n=a.indexOf(t?.currentMode||ua.PIT_THROWS),o=a[((0>n?0:n)+e+a.length)%a.length];Ne(o),Tt(o)}function Et(){no||(ao=document.createElement("div"),ao.id="custom-cursor",ao.setAttribute("aria-hidden","true"),document.body.appendChild(ao),ao.style.display="none",no=!0,Wt())}function Wt(){if(!ao)return;const e=d();io=(e.R_MIN+e.R_MAX)/2*e.cursorSize*2,ao.style.width=io+"px",ao.style.height=io+"px",ao.style.borderRadius="50%",ao.style.marginLeft="0",ao.style.marginTop="0",oo||(ao.style.transform="translate(-50%, -50%) scale(1)",ao.style.opacity="1")}function $t(e,t){if(!ao)return;const a=oo;oo=((e,t)=>{const a=document.getElementById("bravia-balls");if(!a)return!1;const n=a.getBoundingClientRect();return!(n.left>e||e>n.right||n.top>t||t>n.bottom)})(e,t),ao.style.left=e+"px",ao.style.top=t+"px",document.body.style.cursor="none",oo?(ao.style.display="block",a?ao.style.transform.includes("scale(0.25)")||(ao.style.transform="translate(-50%, -50%) scale(0.25)",ao.style.opacity="1"):(ao.style.transform="translate(-50%, -50%) scale(1)",ao.style.opacity="1",requestAnimationFrame(()=>{ao.style.transform="translate(-50%, -50%) scale(0.25)",ao.style.opacity="1"}))):(ao.style.display="none",a&&(ao.style.transform="translate(-50%, -50%) scale(1)",ao.style.opacity="1"))}function Gt(){ao&&(ao.style.display="none",document.body.style.cursor="none",oo=!1)}function _t(){ao&&(oo=!1)}function Nt(){try{const e=getComputedStyle(document.documentElement).getPropertyValue("--wall-thickness").trim();if(e)return parseFloat(e)||12}catch(t){}const e=d();return e?.wallThickness||12}function Ht(){if(!lo)return;const e=Nt();lo.style.setProperty("--gate-overlay-blur",e/2+"px")}function Zt(e){if(lo=document.getElementById("gate-overlay"),!lo)return void console.warn("Gate Overlay: #gate-overlay element not found");if(so=!1!==e.gateOverlayEnabled,!so)return console.log("Gate Overlay: Disabled by config"),void(lo.style.display="none");lo.style.display="";const t=e.gateOverlayOpacity??.01,a=e.gateOverlayTransitionMs??400,n=e.gateOverlayTransitionOutMs??250,o=e.gateOverlayContentDelayMs??200,i=e.gateDepthTranslateY??8,r=e.logoOpacityInactive??1,l=e.logoOpacityActive??.2,s=e.logoBlurInactive??0,c=e.logoBlurActive??12,d=document.documentElement;d.style.setProperty("--gate-depth-scale",e.gateDepthScale??.96),d.style.setProperty("--gate-depth-translate-y",i+"px"),d.style.setProperty("--gate-depth-duration",a+"ms"),d.style.setProperty("--gate-depth-out-duration",n+"ms"),d.style.setProperty("--gate-content-delay",o+"ms"),d.style.setProperty("--logo-opacity-inactive",r),d.style.setProperty("--logo-opacity-active-target",l),d.style.setProperty("--logo-opacity-active",r),d.style.setProperty("--logo-blur-inactive",s+"px"),d.style.setProperty("--logo-blur-active-target",c+"px"),d.style.setProperty("--logo-blur-active",s+"px"),Ht(),lo.style.setProperty("--gate-overlay-opacity",t),lo.style.setProperty("--gate-overlay-transition-duration",a+"ms"),lo.style.setProperty("--gate-overlay-transition-out-duration",n+"ms"),lo.classList.remove("active"),lo.setAttribute("aria-hidden","true"),lo.addEventListener("click",jt),window.addEventListener("resize",Ht),document.addEventListener("layout-updated",Ht);const p=Nt()/2;console.log(`Gate Overlay: Initialized (opacity: ${t}, blur: ${p}px [auto from wall thickness], transition: ${a}ms, logo: opacity ${r}→${l}, blur ${s}px→${c}px)`)}function jt(e){if(e.target.closest("button"))return;if(e.target.closest("input"))return;if(e.target.closest("a"))return;if(e.target.closest("select"))return;if(e.target.closest("textarea"))return;const t="cv-gate"===e.target.id||"portfolio-gate"===e.target.id||"contact-gate"===e.target.id||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description");(e.target===lo||t)&&document.dispatchEvent(new CustomEvent("gate-overlay-dismiss",{detail:{instant:!0}}))}function Yt(e){const t=document.documentElement,a=document.getElementById("abs-scene");if(e){const e=getComputedStyle(t).getPropertyValue("--gate-depth-scale").trim()||"0.96",n=getComputedStyle(t).getPropertyValue("--gate-depth-translate-y").trim()||"8px",o=getComputedStyle(t).getPropertyValue("--logo-opacity-active-target").trim()||t.style.getPropertyValue("--logo-opacity-active-target")||"0.2",i=getComputedStyle(t).getPropertyValue("--logo-blur-active-target").trim()||t.style.getPropertyValue("--logo-blur-active-target")||"12px";t.style.setProperty("--gate-depth-scale-active",e),t.style.setProperty("--gate-depth-ty-active",n),t.style.setProperty("--logo-opacity-active",o),t.style.setProperty("--logo-blur-active",i),a&&a.classList.add("gate-depth-active")}else{const e=getComputedStyle(t).getPropertyValue("--logo-opacity-inactive").trim()||"1",n=getComputedStyle(t).getPropertyValue("--logo-blur-inactive").trim()||"0px";t.style.setProperty("--gate-depth-scale-active","1"),t.style.setProperty("--gate-depth-ty-active","0px"),t.style.setProperty("--logo-opacity-active",e),t.style.setProperty("--logo-blur-active",n),a&&a.classList.remove("gate-depth-active")}}function Xt(){if(!lo||!so)return;Ht(),lo.setAttribute("aria-hidden","false"),lo.classList.add("active");const e=document.getElementById("custom-cursor");e&&(e.classList.add("gate-active"),e.style.display="block"),Yt(!0)}function qt(){if(!lo||!so)return;lo.classList.remove("active"),lo.setAttribute("aria-hidden","true");const e=document.getElementById("custom-cursor");e&&e.classList.remove("gate-active"),Yt(!1)}function Ut(){return!!lo&&lo.classList.contains("active")}function Jt(){go&&(window.clearTimeout(go),go=0),bo&&(window.clearTimeout(bo),bo=0)}function Qt(e=1,t={}){if(!fo||!ho)return;const a=d();if(!1===a?.sceneImpactEnabled)return;const n=!1!==t?.scheduleRelease,o=Math.max(0,Math.min(1,+e||0)),i=++mo;Jt(),ho.classList.add("abs-scene--animating"),ho.classList.add("abs-scene--impact"),t?.armManual&&(Mo=!0);const r=a?.sceneImpactPressMs??75,l=a?.sceneImpactReleaseMs??220;ho.style.setProperty(uo,Math.round(r)+"ms"),window.requestAnimationFrame(()=>{fo&&ho&&i===mo&&ho.style.setProperty(po,o+"")}),n&&(go=window.setTimeout(()=>{ea({token:i,releaseMs:l})},0),bo=window.setTimeout(()=>{bo=0,ho&&(ho.classList.remove("abs-scene--impact"),ho.classList.remove("abs-scene--animating"))},Math.max(0,Math.round(l)+80)))}function ea({token:e,releaseMs:t}){Jt(),fo&&ho&&e===mo&&(ho.style.setProperty(uo,Math.round(t)+"ms"),window.requestAnimationFrame(()=>{fo&&ho&&e===mo&&ho.style.setProperty(po,"0")}),bo=window.setTimeout(()=>{bo=0,ho&&(ho.classList.remove("abs-scene--impact"),ho.classList.remove("abs-scene--animating"))},Math.max(0,Math.round(t)+80)))}function ta(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function aa(){try{const e="undefined"!=typeof window?window.__TEXT__:null;return ta(e)?e:null}catch(e){return null}}function na(e,t=""){const a=zo||aa();if(!a)return t;if(!e)return t;const n=(e+"").split(".").filter(Boolean);let o=a;for(const i of n){if(!ta(o)&&!Array.isArray(o))return t;if(o=o?.[i],null==o)return t}return o}function oa(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.classList.add("page-flash--"+t),setTimeout(()=>{e.classList.remove("page-flash--"+t)},"success"===t?600:300)}function ia(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.classList.add("page-flash--"+t),setTimeout(()=>{e.classList.remove("page-flash--"+t)},"success"===t?600:300)}async function ra(){W().isUnlocked?la(E()):await O()?la(!0):(Bo&&(Bo.innerHTML=Vo,Bo.setAttribute("aria-label","Audio unavailable"),Bo.title="Audio unavailable"),setTimeout(()=>{la(!1)},2e3))}function la(e){Bo&&(Bo.setAttribute("data-enabled",e?"true":"false"),Bo.setAttribute("aria-pressed",e?"true":"false"),Bo.setAttribute("aria-label",e?"Sound on":"Sound off"),Bo.title=e?"Sound on":"Sound off",Bo.innerHTML=e?'<i class="ti ti-volume-2" aria-hidden="true"></i>':Vo)}function sa(e){return((e||"")+"").trim().toLowerCase()}function ca(e,t){e&&(e.textContent=(t??"")+"")}function da(e,t,a){if(e&&null!=a)try{e.setAttribute(t,a+"")}catch(n){}}function pa(e){const t=document.documentElement;void 0!==e.noiseSizeBase&&t.style.setProperty("--noise-size-base",e.noiseSizeBase+"px"),void 0!==e.noiseSizeTop&&t.style.setProperty("--noise-size-top",e.noiseSizeTop+"px"),void 0!==e.noiseBackOpacity&&(t.style.setProperty("--noise-back-opacity",e.noiseBackOpacity+""),t.style.setProperty("--noise-back-opacity-light",e.noiseBackOpacity+"")),void 0!==e.noiseFrontOpacity&&(t.style.setProperty("--noise-front-opacity",e.noiseFrontOpacity+""),t.style.setProperty("--noise-front-opacity-light",e.noiseFrontOpacity+"")),void 0!==e.noiseBackOpacityDark&&t.style.setProperty("--noise-back-opacity-dark",e.noiseBackOpacityDark+""),void 0!==e.noiseFrontOpacityDark&&t.style.setProperty("--noise-front-opacity-dark",e.noiseFrontOpacityDark+"")}const ua={PIT:"pit",PIT_THROWS:"pit-throws",FLIES:"flies",WEIGHTLESS:"weightless",WATER:"water",VORTEX:"vortex",PING_PONG:"ping-pong",MAGNETIC:"magnetic",BUBBLES:"bubbles",KALEIDOSCOPE:"kaleidoscope",KALEIDOSCOPE_1:"kaleidoscope-1",KALEIDOSCOPE_2:"kaleidoscope-2",KALEIDOSCOPE_3:"kaleidoscope-3",CRITTERS:"critters",ORBIT_3D:"orbit-3d",ORBIT_3D_2:"orbit-3d-2",NEURAL:"neural",LATTICE:"lattice",PARALLAX_LINEAR:"parallax-linear",PARALLAX_PERSPECTIVE:"parallax-perspective"},ha=[ua.PIT,ua.BUBBLES,ua.CRITTERS,ua.FLIES,ua.PIT_THROWS,ua.WATER,ua.VORTEX,ua.MAGNETIC,ua.PING_PONG,ua.WEIGHTLESS,ua.KALEIDOSCOPE_1,ua.KALEIDOSCOPE_2,ua.KALEIDOSCOPE_3,ua.KALEIDOSCOPE,ua.ORBIT_3D,ua.ORBIT_3D_2,ua.LATTICE,ua.NEURAL,ua.PARALLAX_LINEAR,ua.PARALLAX_PERSPECTIVE],fa={[ua.PIT]:"SOURCE MATERIAL",[ua.BUBBLES]:"SIGNAL NOISE",[ua.CRITTERS]:"CONCEPT MODEL",[ua.FLIES]:"SWARM LOGIC",[ua.PIT_THROWS]:"SOURCE ITERATION",[ua.WATER]:"FLOW STATE",[ua.VORTEX]:"ORDERED CHAOS",[ua.MAGNETIC]:"FORCE FIELDS",[ua.PING_PONG]:"FEEDBACK PATTERNS",[ua.WEIGHTLESS]:"ZERO GRAVITY",[ua.KALEIDOSCOPE]:"A NEW LANGUAGE",[ua.KALEIDOSCOPE_1]:"LANGUAGE SEED",[ua.KALEIDOSCOPE_2]:"LANGUAGE FLOW",[ua.KALEIDOSCOPE_3]:"LANGUAGE BLOOM",[ua.ORBIT_3D]:"AXIAL STORM",[ua.ORBIT_3D_2]:"TIGHT SWARM",[ua.LATTICE]:"CRYSTAL LOGIC",[ua.NEURAL]:"SYNAPTIC WEB",[ua.PARALLAX_LINEAR]:"DEPTH DRIFT",[ua.PARALLAX_PERSPECTIVE]:"PERSPECTIVE FIELD"},ma={DPR:Math.max(1,Math.min(2,window.devicePixelRatio||1)),OFFSCREEN_MOUSE:-1e9,MIN_DISTANCE_EPSILON:1e-6,ACCUMULATOR_RESET_THRESHOLD:3,MAX_PHYSICS_STEPS:4,SPIN_DAMP_PER_S:3,SPIN_GAIN:.25,SPIN_GAIN_TANGENT:.18,ROLL_FRICTION_PER_S:2.5,SQUASH_MAX_BASE:.2,SQUASH_DECAY_PER_S:18,WALL_REST_VEL_THRESHOLD:70,GROUND_COUPLING_PER_S:12,SLEEP_VELOCITY_THRESHOLD:12,SLEEP_ANGULAR_THRESHOLD:.18,TIME_TO_SLEEP:.25,PHYSICS_DT:1/120},ga={rubber:{wallWobbleMaxDeform:45,wallWobbleStiffness:2200,wallWobbleDamping:35,wallWobbleImpactThreshold:140,wallWobbleSettlingSpeed:75,wallWobbleSigma:2,wallWobbleCornerClamp:.6},trampoline:{wallWobbleMaxDeform:55,wallWobbleStiffness:2800,wallWobbleDamping:15,wallWobbleImpactThreshold:100,wallWobbleSettlingSpeed:40,wallWobbleSigma:2.5,wallWobbleCornerClamp:.5},jelly:{wallWobbleMaxDeform:80,wallWobbleStiffness:800,wallWobbleDamping:12,wallWobbleImpactThreshold:80,wallWobbleSettlingSpeed:30,wallWobbleSigma:3.5,wallWobbleCornerClamp:.4},stiff:{wallWobbleMaxDeform:20,wallWobbleStiffness:3e3,wallWobbleDamping:60,wallWobbleImpactThreshold:180,wallWobbleSettlingSpeed:90,wallWobbleSigma:1.5,wallWobbleCornerClamp:.8}},ba={default:{label:"Default (Full View Grid)",parallaxLinearDotSizeMul:1.8,sizeVariationParallaxLinear:0,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:7,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:50,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:260},dense:{label:"Dense (More Vertices)",parallaxLinearDotSizeMul:1.6,sizeVariationParallaxLinear:.1,parallaxLinearGridX:18,parallaxLinearGridY:13,parallaxLinearGridZ:9,parallaxLinearSpanX:1.25,parallaxLinearSpanY:1.25,parallaxLinearZNear:45,parallaxLinearZFar:1e3,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:240},deep:{label:"Deep Field (Stronger Depth)",parallaxLinearDotSizeMul:1.7,sizeVariationParallaxLinear:.08,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:10,parallaxLinearSpanX:1.45,parallaxLinearSpanY:1.45,parallaxLinearZNear:30,parallaxLinearZFar:1500,parallaxLinearFocalLength:520,parallaxLinearParallaxStrength:320},calm:{label:"Calm (Slow Camera)",parallaxLinearDotSizeMul:1.8,sizeVariationParallaxLinear:.05,parallaxLinearGridX:12,parallaxLinearGridY:9,parallaxLinearGridZ:6,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:60,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:160},minimal:{label:"Minimal (Big Dots)",parallaxLinearDotSizeMul:2.4,sizeVariationParallaxLinear:.15,parallaxLinearGridX:10,parallaxLinearGridY:7,parallaxLinearGridZ:4,parallaxLinearSpanX:1.6,parallaxLinearSpanY:1.6,parallaxLinearZNear:70,parallaxLinearZFar:800,parallaxLinearFocalLength:380,parallaxLinearParallaxStrength:220}},Ma={default:{label:"Default (Nebula Grid)",parallaxPerspectiveDotSizeMul:1.8,sizeVariationParallaxPerspective:0,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:8,parallaxPerspectiveSpanX:1.45,parallaxPerspectiveSpanY:1.45,parallaxPerspectiveZNear:40,parallaxPerspectiveZFar:1200,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:280,parallaxPerspectiveRandomness:.6},calm:{label:"Calm Mist",parallaxPerspectiveDotSizeMul:1.9,sizeVariationParallaxPerspective:.08,parallaxPerspectiveGridX:14,parallaxPerspectiveGridY:10,parallaxPerspectiveGridZ:6,parallaxPerspectiveSpanX:1.4,parallaxPerspectiveSpanY:1.4,parallaxPerspectiveZNear:60,parallaxPerspectiveZFar:900,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:180,parallaxPerspectiveRandomness:.25},deep:{label:"Deep Space",parallaxPerspectiveDotSizeMul:1.6,sizeVariationParallaxPerspective:.06,parallaxPerspectiveGridX:18,parallaxPerspectiveGridY:13,parallaxPerspectiveGridZ:12,parallaxPerspectiveSpanX:1.55,parallaxPerspectiveSpanY:1.55,parallaxPerspectiveZNear:30,parallaxPerspectiveZFar:2200,parallaxPerspectiveFocalLength:520,parallaxPerspectiveParallaxStrength:340,parallaxPerspectiveRandomness:.55},wild:{label:"Wild Nebula",parallaxPerspectiveDotSizeMul:1.7,sizeVariationParallaxPerspective:.18,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:10,parallaxPerspectiveSpanX:1.6,parallaxPerspectiveSpanY:1.6,parallaxPerspectiveZNear:20,parallaxPerspectiveZFar:1600,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:360,parallaxPerspectiveRandomness:.9},minimal:{label:"Minimal Stars",parallaxPerspectiveDotSizeMul:2.6,sizeVariationParallaxPerspective:.22,parallaxPerspectiveGridX:10,parallaxPerspectiveGridY:7,parallaxPerspectiveGridZ:5,parallaxPerspectiveSpanX:1.75,parallaxPerspectiveSpanY:1.75,parallaxPerspectiveZNear:70,parallaxPerspectiveZFar:1100,parallaxPerspectiveFocalLength:380,parallaxPerspectiveParallaxStrength:220,parallaxPerspectiveRandomness:.35}};let ya=Math.max(1,Math.min(2,window.devicePixelRatio||1));const va={config:{},currentMode:ua.CRITTERS,warmupFramesRemaining:0,balls:[],canvas:null,ctx:null,container:null,mouseX:ma.OFFSCREEN_MOUSE,mouseY:ma.OFFSCREEN_MOUSE,mouseInCanvas:!1,lastPointerMoveMs:0,lastPointerMoveX:ma.OFFSCREEN_MOUSE,lastPointerMoveY:ma.OFFSCREEN_MOUSE,GE:1960,G:0,gravityScale:1,gravityMultiplier:0,gravityMultiplierPit:1.1,pitThrowSpeed:650,pitThrowSpeedJitter:.22,pitThrowAngleJitter:.16,pitThrowBatchSize:18,pitThrowIntervalMs:70,pitThrowColorPauseMs:180,pitThrowTargetYFrac:.36,pitThrowInletInset:.06,pitThrowCrossBias:.12,pitThrowSpawnSpread:.02,pitThrowAimJitter:.04,pitThrowPairChance:.35,pitThrowPairStaggerMs:18,pitThrowSpeedVar:.18,pitThrowSpreadVar:.25,REST:.69,FRICTION:.006,ballMassKg:129,MASS_BASELINE_KG:129,MASS_REST_EXP:.15,MASS_GRAVITY_EXP:.35,get DPR(){return ya},sizeScale:1.2,sizeVariationGlobalMul:1,sizeVariationCap:.12,sizeVariationPit:0,sizeVariationPitThrows:0,sizeVariationFlies:0,sizeVariationWeightless:0,sizeVariationWater:0,sizeVariationVortex:.2,sizeVariationPingPong:0,sizeVariationMagnetic:0,sizeVariationBubbles:.2,sizeVariationKaleidoscope:0,sizeVariationOrbit3d:0,sizeVariationCritters:.2,sizeVariationNeural:0,sizeVariationLattice:0,sizeVariationParallaxLinear:0,sizeVariationParallaxPerspective:0,pitWarmupFrames:10,pitThrowsWarmupFrames:10,fliesWarmupFrames:10,weightlessWarmupFrames:10,waterWarmupFrames:10,vortexWarmupFrames:10,pingPongWarmupFrames:10,magneticWarmupFrames:10,bubblesWarmupFrames:10,kaleidoscopeWarmupFrames:10,kaleidoscope1WarmupFrames:10,kaleidoscope2WarmupFrames:10,kaleidoscope3WarmupFrames:10,orbit3dWarmupFrames:10,orbit3d2WarmupFrames:10,crittersWarmupFrames:10,neuralWarmupFrames:10,latticeWarmupFrames:10,parallaxLinearWarmupFrames:10,parallaxPerspectiveWarmupFrames:10,sizeVariation:0,responsiveScale:1,responsiveScaleMobile:.75,isMobile:!1,isMobileViewport:!1,mobileObjectReductionFactor:.7,R_MIN_BASE:6,R_MAX_BASE:24,R_MED:0,R_MIN:0,R_MAX:0,cursorSize:1,cursorColorMode:"auto",cursorColorIndex:5,cursorColorHex:"#ff4013",cursorColorLumaMax:.62,cursorColorAllowIndices:[],cursorColorDenyIndices:[],mouseTrailEnabled:!0,mouseTrailLength:18,mouseTrailSize:1.3,mouseTrailFadeMs:220,mouseTrailOpacity:.35,ballSoftness:20,ballSpacing:.08,sleepVelocityThreshold:12,sleepAngularThreshold:.18,timeToSleep:.25,critterCount:90,critterSpeed:680,critterMaxSpeed:1400,critterStepHz:5,critterStepSharpness:2.4,critterTurnNoise:2.2,critterTurnDamp:10,critterTurnSeek:10,critterAvoidRadius:90,critterAvoidForce:9500,critterEdgeAvoid:1,critterMousePull:1,critterMouseRadiusVw:30,critterRestitution:.18,critterFriction:.018,cornerRadius:42,layoutViewportWidthPx:0,containerBorderVw:0,simulationPaddingVw:0,contentPaddingVw:0,contentPaddingHorizontalRatio:1,wallRadiusVw:0,wallThicknessVw:0,noiseBackOpacity:.025,noiseFrontOpacity:.055,noiseBackOpacityDark:.12,noiseFrontOpacityDark:.08,layoutMinContentPaddingPx:16,layoutMinWallRadiusPx:28,wallInset:3,vortexSwirlStrength:420,vortexRadialPull:180,vortexBallCount:180,vortexSpeedMultiplier:1,vortexRadius:0,vortexFalloffCurve:1,vortexRotationDirection:1,vortexCoreStrength:1,vortexAccelerationZone:0,vortexOutwardPush:0,vortexFalloffRate:.0015,magneticBallCount:180,magneticStrength:65e3,magneticMaxVelocity:2800,magneticExplosionInterval:5,bubblesSpawnRate:8,bubblesRiseSpeed:150,bubblesWobble:40,bubblesMaxCount:200,bubblesDeflectRadius:200,pingPongBallCount:35,pingPongSpeed:800,pingPongCursorRadius:50,currentColors:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],currentTemplate:"industrialTeal",fliesBallCount:60,attractionPower:5e3,orbitRadius:180,swarmSpeed:.4,fliesSeparation:15e3,weightlessCount:80,weightlessInitialSpeed:250,weightlessBounce:.97,weightlessRepelRadius:220,weightlessRepelPower:22e4,weightlessRepelSoft:2.2,kaleidoscopeBallCount:23,kaleidoscopeWedges:12,kaleidoscopeMirror:1,kaleidoscopeSpeed:1,kaleidoscopeDotSizeVh:.95,kaleidoscopeDotAreaMul:.7,kaleidoscopeSpawnAreaMul:1,kaleidoscopeSizeVariance:.3,kaleidoscope1BallCount:18,kaleidoscope1Wedges:8,kaleidoscope1Speed:.8,kaleidoscope1DotSizeVh:.95,kaleidoscope1DotAreaMul:.7,kaleidoscope1SpawnAreaMul:1,kaleidoscope1SizeVariance:.3,kaleidoscope2BallCount:36,kaleidoscope2Wedges:8,kaleidoscope2Speed:1.15,kaleidoscope2DotSizeVh:.95,kaleidoscope2DotAreaMul:.7,kaleidoscope2SpawnAreaMul:1,kaleidoscope2SizeVariance:.3,kaleidoscope3BallCount:54,kaleidoscope3Wedges:8,kaleidoscope3Speed:1.55,kaleidoscope3DotSizeVh:.95,kaleidoscope3DotAreaMul:.7,kaleidoscope3SpawnAreaMul:1,kaleidoscope3SizeVariance:.3,orbit3dPreset:"serene",orbit3dMoonCount:80,orbit3dGravity:5e3,orbit3dMoonMass:1,orbit3dVelocityMult:150,orbit3dTargetOrbit:12,orbit3dMinOrbit:3,orbit3dMaxOrbit:3,orbit3dDepthScale:.8,orbit3dDamping:.02,orbit3d2MoonCount:60,orbit3d2Gravity:3e3,orbit3d2VelocityMult:200,orbit3d2MinOrbit:5,orbit3d2MaxOrbit:30,orbit3d2DepthScale:.5,orbit3d2Damping:.98,orbit3d2MoonMass:1,orbit3d2MaxSpeed:800,neuralBallCount:80,neuralLinkDistanceVw:14,neuralLineOpacity:.22,neuralWanderStrength:420,neuralMaxLinksPerBall:4,neuralDamping:.985,latticeBallCount:90,latticeSpacingVw:8.5,latticeStiffness:2.2,latticeDamping:.92,latticeDisruptRadius:600,latticeDisruptPower:25,latticeMeshWaveStrength:12,latticeMeshWaveSpeed:.8,latticeAlignment:"center",parallaxLinearDotCount:95,parallaxLinearRowPattern:"thirds",parallaxLinearSpacingPattern:"even",parallaxLinearFarPct:.42,parallaxLinearMidPct:.32,parallaxLinearFarSpeed:.15,parallaxLinearMidSpeed:.5,parallaxLinearNearSpeed:1,parallaxLinearFollowStrength:16,parallaxLinearDamping:12,parallaxPerspectiveDotCount:240,parallaxPerspectiveDepthMul:1.6,parallaxPerspectiveFocalLength:400,parallaxPerspectiveFollowStrength:16,parallaxPerspectiveDamping:12,parallaxPerspectiveZ1:1200,parallaxPerspectiveZ2:700,parallaxPerspectiveZ3:350,parallaxPerspectiveZ4:120,parallaxPerspectiveZ5:35,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:7,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:50,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:260,parallaxLinearDotSizeMul:1.8,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:8,parallaxPerspectiveSpanX:1.45,parallaxPerspectiveSpanY:1.45,parallaxPerspectiveZNear:40,parallaxPerspectiveZFar:1200,parallaxPerspectiveParallaxStrength:280,parallaxPerspectiveRandomness:.6,parallaxPerspectiveDotSizeMul:1.8,waterBallCount:300,waterDrag:.015,waterRippleSpeed:300,waterRippleStrength:18e3,waterDriftStrength:40,waterInitialVelocity:200,vortexDrag:.005,pingPongCursorRadius:100,pingPongVerticalDamp:.995,magneticDamping:.98,repelRadius:120,repelPower:274e3,repelSoft:3.4,repellerEnabled:!1,cursorInfluenceRadiusVw:14,cursorInfluenceRadiusPx:140,emitterTimer:0,autoDarkModeEnabled:!0,isDarkMode:!1,chromeHarmonyMode:"site",autoDarkNightStartHour:18,autoDarkNightEndHour:6,clickCycleEnabled:!0,sceneImpactEnabled:!0,sceneImpactMul:.004,sceneImpactOvershoot:.22,sceneImpactAnticipation:0,sceneImpactPressMs:75,sceneImpactReleaseMs:220,sceneChangeSoundEnabled:!0,sceneChangeSoundIntensity:.35,sceneChangeSoundRadius:18,brandLogoImpactMul:.014,brandLogoSquashMul:1,brandLogoOvershoot:.22,brandLogoAnticipation:0,brandLogoTiltDeg:0,brandLogoSkewDeg:0,brandLogoPressMs:75,brandLogoHoldMs:55,brandLogoReleaseMs:220,containerBorder:20,simulationPadding:0,contentPadding:40,contentPaddingX:40,contentPaddingY:40,bgLight:"#f5f5f5",bgDark:"#0a0a0a",frameColor:"#0a0a0a",textColorLight:"#161616",textColorLightMuted:"#2f2f2f",textColorDark:"rgba(255,255,255,0.7)",textColorDarkMuted:"rgba(255,255,255,0.5)",linkHoverColor:"#ff4013",logoColorLight:"#161616",logoColorDark:"#d5d5d5",wallThickness:12,wallRadius:42,wallInset:3,wallPreset:"rubber",wallSoftness:50,wallBounciness:50,wallWobbleMaxDeform:45,wallWobbleStiffness:2200,wallWobbleDamping:35,wallWobbleSigma:2,wallWobbleCornerClamp:.6,wallWobbleImpactThreshold:140,wallWobbleSettlingSpeed:75,gateOverlayEnabled:!0,gateOverlayOpacity:.01,gateOverlayBlurPx:16,gateOverlayTransitionMs:800,gateOverlayTransitionOutMs:600,gateOverlayContentDelayMs:200,gateDepthScale:.96,gateDepthTranslateY:8,logoOpacityInactive:1,logoOpacityActive:.2,logoBlurInactive:0,logoBlurActive:12,getSquashMax(){return 0===this.ballSoftness?0:ma.SQUASH_MAX_BASE*(this.ballSoftness/40)},getCanvasCornerRadius(){return Math.max(0,this.cornerRadius-this.simulationPadding)}};var xa=Object.freeze({__proto__:null,applyLayoutCSSVars:s,applyLayoutFromVwToPx:l,clearBalls:f,detectResponsiveScale:m,getBalls:()=>va.balls,getConfig:()=>va.config,getEffectiveDPR:()=>ya,getGlobals:d,getLayoutViewportWidthPx:o,getMobileAdjustedCount:p,getState:()=>va,initState:c,pxToVw:i,setCanvas:u,setEffectiveDPR:t,setMode:h,updateBallSizes:g,vwToPx:r});const wa={industrialTeal:{label:"Industrial Teal",light:["#b7bcb7","#d0d0d0","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#6b726b","#3d453d","#8a928a","#00e6c3","#d5d5d5","#ff6b47","#5b9aff","#ffb84d"]},sunsetCoral:{label:"Sunset Coral",light:["#bdbbb8","#e8e6e3","#ffffff","#ff3b3b","#000000","#00f5d4","#1e40af","#fb923c"],dark:["#716f6b","#3f3d3a","#8e8c88","#ff6b6b","#d8d8d8","#00ffe7","#6ba3ff","#ffb570"]},violetPunch:{label:"Violet Punch",light:["#b8b7c2","#e6e5ed","#ffffff","#9333ea","#000000","#dc2626","#0ea5e9","#facc15"],dark:["#6d6c7a","#3a3845","#8b8a98","#c266ff","#dad6e8","#ff5c5c","#42d4ff","#fff066"]},citrusBlast:{label:"Citrus Blast",light:["#bfbdb5","#eae8df","#ffffff","#ea580c","#000000","#e11d48","#2563eb","#059669"],dark:["#74726a","#403e38","#918f87","#ff8c4d","#dbd9d1","#ff5c7a","#6ba3ff","#00d699"]},cobaltSpark:{label:"Cobalt Spark",light:["#b5b8be","#e3e6eb","#ffffff","#1d4ed8","#000000","#ea580c","#db2777","#d97706"],dark:["#696d75","#3a3e45","#878b93","#6b9dff","#d6dae2","#ff8c5c","#ff66b3","#ffc266"]}},Sa=[.5,.25,.12,.06,.03,.02,.01,.01],Ca=[3,5,6,7];var Pa=Object.freeze({__proto__:null,COLOR_TEMPLATES:wa,applyColorTemplate:D,applyCursorColorIndex:C,getColorByIndex:T,getCurrentPalette:k,getCursorCandidateIndices:S,maybeAutoPickCursorColor:P,pickRandomColor:F,populateColorSelect:L});const ka={attackTime:.005,decayTime:.075,harmonicGain:0,filterBaseFreq:580,filterVelocityRange:400,filterQ:.18,filterMinHz:350,filterMaxHz:2800,pitchMinHz:145,pitchMaxHz:280,pitchCurve:1,reverbDecay:.14,reverbWetMix:.08,reverbHighDamp:.8,minGain:.008,maxGain:.09,masterGain:.28,voiceGainMax:.14,minTimeBetweenSounds:.012,maxPan:.15,noiseTransientEnabled:!0,noiseTransientGain:.045,noiseTransientDecay:.008,noiseTransientFilterMin:500,noiseTransientFilterMax:1800,noiseTransientQ:1.2,sparkleGain:0,sparkleRatioMin:2.3,sparkleRatioMax:4.1,sparkleDecayMul:.65,variancePitch:.06,varianceDecay:.2,varianceGain:.15,varianceFilter:.18,varianceNoise:.25,velocityNoiseScale:1.8,velocityBrightnessScale:1.4,velocityDecayScale:.65,intensityExponent:1.5,toneSafetyMinHz:130,toneSafetyMaxHz:480,toneSafetyExponent:2.2,toneSafetyHighGainAtten:.25,toneSafetyLowGainAtten:.06,toneSafetyHighBrightAtten:.45,collisionMinImpact:.58,highShelfFreq:2200,highShelfGain:-6};let Fa=null;const Ta={organicImpact:{label:"Organic Impact",description:"Warm, natural thuds with intensity dynamics",...ka},glassMarbles:{label:"Glass Marbles",description:"Clear, glassy impacts with more presence",...ka,pitchMinHz:260,pitchMaxHz:780,pitchCurve:1.05,filterBaseFreq:850,filterVelocityRange:600,noiseTransientGain:.065,noiseTransientFilterMin:650,noiseTransientFilterMax:2200,noiseTransientQ:1.6,decayTime:.055,intensityExponent:1.3,highShelfGain:-4.5},crystalPebbles:{label:"Crystal Pebbles ★",description:"Crisp, close, soothing micro-chimes (non-repetitive)",...ka,pitchMinHz:420,pitchMaxHz:1600,pitchCurve:1.15,filterBaseFreq:1300,filterVelocityRange:1700,filterQ:.22,filterMaxHz:6200,decayTime:.04,intensityExponent:1.65,collisionMinImpact:.7,minTimeBetweenSounds:.018,noiseTransientGain:.02,noiseTransientDecay:.006,noiseTransientFilterMin:1200,noiseTransientFilterMax:7e3,noiseTransientQ:2.8,sparkleGain:.12,sparkleRatioMin:2.6,sparkleRatioMax:4.4,sparkleDecayMul:.55,reverbWetMix:.04,reverbDecay:.1,highShelfGain:-4,masterGain:.24},woodenBeads:{label:"Wooden Beads ★",description:"Ultra-soft, muted thuds (recommended)",...ka,filterBaseFreq:420,filterVelocityRange:200,noiseTransientGain:.025,noiseTransientFilterMin:380,noiseTransientFilterMax:1400,noiseTransientQ:1.1,decayTime:.095,intensityExponent:1.7,collisionMinImpact:.62,highShelfGain:-7.5,reverbWetMix:.12},rubberBalls:{label:"Rubber Balls",description:"Bouncy, playful with longer decay",...ka,pitchMinHz:160,pitchMaxHz:360,filterBaseFreq:520,filterVelocityRange:350,noiseTransientGain:.035,noiseTransientFilterMin:450,noiseTransientFilterMax:1600,noiseTransientQ:1.2,decayTime:.12,intensityExponent:1.4,reverbWetMix:.14,highShelfGain:-5},metallicClick:{label:"Metallic Click",description:"Crisp, percussive impacts",...ka,pitchMinHz:220,pitchMaxHz:620,pitchCurve:1.1,filterBaseFreq:720,filterVelocityRange:550,noiseTransientGain:.08,noiseTransientFilterMin:700,noiseTransientFilterMax:2400,noiseTransientQ:1.8,noiseTransientDecay:.006,decayTime:.045,intensityExponent:1.2,highShelfGain:-3.5,collisionMinImpact:.5}};let Da="crystalPebbles";Fa={...Ta[Da]},delete Fa.label,delete Fa.description;let La=null,Aa=null,Ia=null,Ka=null,Oa=null,Ra=null,za=null,Va=null,Ba=!1,Ea=!1;const Wa="bravia-balls:sound-state",$a=8;let Ga=[],_a=0,Na=new Map,Ha=!1,Za=null,ja=!1;const Ya=new Map,Xa=12;class qa{constructor(){this.deformations=new Float32Array(Xa),this.velocities=new Float32Array(Xa),this.pressure=new Float32Array(Xa)}impact(e,t){const a=d(),n=Math.max(0,Math.min(.45,a.wallWobbleCornerClamp??.1)),o=11*Math.max(n,Math.min(1-n,e)),i=(a.wallWobbleMaxDeform??45)*t,r=Math.max(.25,a.wallWobbleSigma??2);for(let l=1;11>l;l++){const e=Math.abs(l-o);this.velocities[l]+=i*Math.exp(-e*e/(2*r*r))*Math.min(1,Math.min(l,11-l)/2)}}addPressure(e,t){const a=11*Math.max(.1,Math.min(.9,e)),n=Math.max(1,Math.floor(a-2)),o=Math.min(10,Math.ceil(a+2));for(let i=n;o>=i;i++)this.pressure[i]=Math.min(1,this.pressure[i]+t*Math.max(0,1-Math.abs(i-a)/3))}clearPressure(){this.pressure.fill(0)}step(e){const t=d(),a=Math.max(1,t.wallWobbleStiffness??2200),n=Math.max(0,t.wallWobbleDamping??35),o=Math.max(0,t.wallWobbleMaxDeform??45),i=Math.max(0,Math.min(100,t.wallWobbleSettlingSpeed??50))/100,r=2*Math.sqrt(a),l=5+30*i;this.deformations[0]=0,this.deformations[11]=0,this.velocities[0]=0,this.velocities[11]=0,this.pressure[0]=0,this.pressure[11]=0;const s=.5+1.5*i;for(let c=1;11>c;c++){const t=Math.abs(this.velocities[c]),i=Math.abs(this.deformations[c]);this.velocities[c]+=(-a*this.deformations[c]-Math.min(n*(1+1*Math.max(0,Math.min(1,1-i/20)))*(1+this.pressure[c]*l),.95*r)*this.velocities[c])*e,this.deformations[c]+=this.velocities[c]*e,this.deformations[c]=Math.max(0,Math.min(o,this.deformations[c])),(this.pressure[c]>.5?.3:this.pressure[c]>.1?.8:2)*s>i&&(this.pressure[c]>.5?.5:this.pressure[c]>.1?3:10)*s>t&&(this.deformations[c]=0,this.velocities[c]=0)}}getDeformAt(e){const t=11*Math.max(0,Math.min(1,e)),a=Math.floor(t),n=t-a,o=n*n*(3-2*n);return this.deformations[a]*(1-o)+this.deformations[Math.min(a+1,11)]*o}getMaxDeformation(){let e=0;for(let t=0;Xa>t;t++)this.deformations[t]>e&&(e=this.deformations[t]);return e}hasDeformation(){return this.getMaxDeformation()>2}reset(){this.deformations.fill(0),this.velocities.fill(0),this.pressure.fill(0)}}const Ua={top:new qa,bottom:new qa,left:new qa,right:new qa,clearAllPressure(){this.top.clearPressure(),this.bottom.clearPressure(),this.left.clearPressure(),this.right.clearPressure()},step(e){this.top.step(e),this.bottom.step(e),this.left.step(e),this.right.step(e)},reset(){this.top.reset(),this.bottom.reset(),this.left.reset(),this.right.reset()},hasAnyDeformation(){return this.top.hasDeformation()||this.bottom.hasDeformation()||this.left.hasDeformation()||this.right.hasDeformation()}};let Ja=0;class Qa{constructor(e,t,a,n){const o=d();this.x=e,this.y=t,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=a,this.rBase=a,this.m=o.ballMassKg,this.color=n,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1,this.isSleeping=!1,this.sleepTimer=0,this.isGrounded=!1,this.hasSupport=!1,this.W="ball-"+Ja++}step(e,t){const a=d(),{currentMode:n,G:o,gravityScale:i,FRICTION:r,MASS_BASELINE_KG:l}=a;if(this.t+=e,this.age+=e,this.isSleeping&&(n===ua.PIT||n===ua.PIT_THROWS)){const e=(a.repelRadius||710)*a.DPR*1.2,t=this.x-a.mouseX,n=this.y-a.mouseY;e*e>t*t+n*n&&this.wake()}if(this.isSleeping)return;const s=a.DPR||1,c=this.isGrounded,p=this.hasSupport;this.isGrounded=!1,this.hasSupport=!1,n!==ua.WEIGHTLESS&&(!c&&!p||-8*s>this.vy)&&(this.vy+=o*i*e);const u=Math.max(.25,this.m/l),h=Math.max(0,1-(n===ua.WEIGHTLESS||n===ua.ORBIT_3D||n===ua.ORBIT_3D_2?0:r)*(1+1*Math.max(0,Math.min(1,1-Math.sqrt(this.vx*this.vx+this.vy*this.vy)/(100*s))))/u);if(this.vx*=h,this.vy*=h,n!==ua.ORBIT_3D&&n!==ua.ORBIT_3D_2){const e=2*s;e>Math.abs(this.vx)&&(this.vx=0),e>Math.abs(this.vy)&&n===ua.WEIGHTLESS&&(this.vy=0)}0!==this.driftAx&&this.driftTime>this.age?this.vx+=this.driftAx*e/u:0!==this.driftAx&&(this.driftAx=0),t&&t(this,e),this.x+=this.vx*e,this.y+=this.vy*e,this.omega*=Math.max(0,1-ma.SPIN_DAMP_PER_S*(1+.5*Math.max(0,Math.min(1,1-Math.abs(this.omega)/2)))*e),this.theta+=this.omega*e,.01>Math.abs(this.omega)&&(this.omega=0),this.squashAmount+=(0-this.squashAmount)*Math.min(1,ma.SQUASH_DECAY_PER_S*e),this.squash=1-this.squashAmount}updateSleepState(e,t){const a=Math.sqrt(this.vx*this.vx+this.vy*this.vy),n=Math.abs(this.omega),o=t.DPR||1,i=(Number.isFinite(t.sleepVelocityThreshold)?t.sleepVelocityThreshold:ma.SLEEP_VELOCITY_THRESHOLD)*o,r=Number.isFinite(t.sleepAngularThreshold)?t.sleepAngularThreshold:ma.SLEEP_ANGULAR_THRESHOLD,l=Number.isFinite(t.timeToSleep)?t.timeToSleep:ma.TIME_TO_SLEEP;(this.isGrounded||this.hasSupport)&&i>a&&r>n?(this.sleepTimer+=e,l>this.sleepTimer||(this.vx=0,this.vy=0,this.omega=0,this.isSleeping=!0)):this.sleepTimer=0}wake(){this.isSleeping=!1,this.sleepTimer=0}walls(e,t,a,n,o={}){const i=!1!==o.registerEffects,r=d(),{REST:l,MASS_BASELINE_KG:s,MASS_REST_EXP:c,currentMode:p,DPR:u}=r,h=void 0!==n?n:l,f=r.wallWobbleImpactThreshold??ma.WALL_REST_VEL_THRESHOLD,m=this.r*(1+(r.ballSpacing||0)),g="function"==typeof r.getCanvasCornerRadius?r.getCanvasCornerRadius():r.cornerRadius??r.wallRadius??42,b=Math.max(0,g)*(u||1),M=Math.max(0,r.wallInset??3)*(u||1),y=Math.max(0,b-M);let v=!1;const x=[{cx:b,cy:b},{cx:e-b,cy:b},{cx:b,cy:t-b},{cx:e-b,cy:t-b}];for(let d=0;x.length>d;d++){if((p===ua.PIT||p===ua.PIT_THROWS)&&2>d)continue;const a=x[d];if((d%2==0?b>this.x:this.x>e-b)&&(2>d?b>this.y:this.y>t-b)){const e=this.x-a.cx,t=this.y-a.cy,n=Math.sqrt(e*e+t*t),o=y-m;if(n>o&&o>0){v=!0;const a=n-o,i=e/n,r=t/n;this.x-=i*a,this.y-=r*a;const l=this.vx*i+this.vy*r;l>0&&(this.vx-=(1+h)*l*i,this.vy-=(1+h)*l*r)}}}const w=M,S=e-M,C=M,P=t-M;if(this.y+m>P){v=!0,this.isGrounded=!0,this.y=P-m;const t=this.vy,n=this.vx-this.omega*this.r,o=Math.max(.25,this.m/s);this.omega+=n/this.r*ma.SPIN_GAIN/o,this.vx*=Math.max(0,1-ma.ROLL_FRICTION_PER_S*(1+1*Math.max(0,Math.min(1,1-Math.abs(this.vx)/(80*u))))*a/o),3*u>Math.abs(this.vx)&&(this.vx=0),this.vy=(f>Math.abs(t)?0:h)*Math.pow(s/this.m,c)*-this.vy;const l=Math.min(1,Math.abs(t)/(90*this.r));if(this.squashAmount=Math.min(r.getSquashMax(),.8*l),this.squashNormalAngle=-Math.PI/2,this.omega+=(this.vx/this.r-this.omega)*Math.min(1,ma.GROUND_COUPLING_PER_S*a),.05>Math.abs(this.omega)&&(this.omega=0),i){R(this.r,.7*l,this.x/e,this.W),this.isSleeping||0>=t||f>t||j("bottom",this.x/e,l);const a=this.isSleeping?1:Math.min(1,(f-Math.abs(t))/f);a>.1&&Y("bottom",this.x/e,a)}}if(p!==ua.PIT&&p!==ua.PIT_THROWS&&C>this.y-m){v=!0,this.y=C+m;const t=this.vy;this.vy=-this.vy*h;const a=Math.min(1,Math.abs(t)/(90*this.r));if(this.squashAmount=Math.min(r.getSquashMax(),.8*a),this.squashNormalAngle=Math.PI/2,i){R(this.r,.7*a,this.x/e,this.W),this.isSleeping||t>=0||f>Math.abs(t)||j("top",this.x/e,a);const n=this.isSleeping?1:Math.min(1,(f-Math.abs(t))/f);n>.1&&Y("top",this.x/e,n)}}if(this.x+m>S){v=!0,this.x=S-m;const e=this.vx;this.omega+=(this.vy-this.omega*this.r)/this.r*.5*ma.SPIN_GAIN/Math.max(.25,this.m/s),this.vx=l*Math.pow(s/this.m,c)*-this.vx;const a=Math.min(1,Math.abs(e)/(70*this.r));if(this.squashAmount=Math.min(r.getSquashMax(),.8*a),this.squashNormalAngle=Math.PI,i){R(this.r,.6*a,1,this.W),this.isSleeping||0>=e||f>e||j("right",this.y/t,a);const n=this.isSleeping?1:Math.min(1,(f-Math.abs(e))/f);n>.1&&Y("right",this.y/t,n)}}if(w>this.x-m){v=!0,this.x=w+m;const e=this.vx;this.omega+=(this.vy-this.omega*this.r)/this.r*.5*ma.SPIN_GAIN/Math.max(.25,this.m/s),this.vx=l*Math.pow(s/this.m,c)*-this.vx;const a=Math.min(1,Math.abs(e)/(70*this.r));if(this.squashAmount=Math.min(r.getSquashMax(),.8*a),this.squashNormalAngle=0,i){R(this.r,.6*a,0,this.W),this.isSleeping||e>=0||f>Math.abs(e)||j("left",this.y/t,a);const n=this.isSleeping?1:Math.min(1,(f-Math.abs(e))/f);n>.1&&Y("left",this.y/t,n)}}v&&this.isSleeping&&this.wake()}draw(e){const t=this.squashAmount>.001,a=1>this.alpha;t||a?(e.save(),e.translate(this.x,this.y),t?(e.rotate(this.theta+this.squashNormalAngle),e.scale(1-.3*this.squashAmount,1+.3*this.squashAmount),e.rotate(-this.squashNormalAngle)):e.rotate(this.theta),a&&(e.globalAlpha=this.alpha),e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI),e.fillStyle=this.color,e.fill(),e.restore()):(e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.r,0,2*Math.PI),e.fill())}}const en=[];let tn,an,nn=ma.DPR,on=0,rn=0,ln=null;const sn=2*Math.PI,cn=1e-6;let dn=0,pn=0;var un=Object.freeze({__proto__:null,MODES:ua,getForceApplicator:Ze,getModeRenderer:Ye,getModeUpdater:je,resetCurrentMode:He,setMode:Ne});let hn=0,fn=null,mn=null,gn=null,bn=0,Mn=0;const yn=ma.PHYSICS_DT;let vn=0;const xn=42,wn=1/60,Sn=(()=>{try{return{log:console.log?.bind(console)??(()=>{}),info:console.info?.bind(console)??(()=>{}),warn:console.warn?.bind(console)??(()=>{}),error:console.error?.bind(console)??(()=>{}),debug:console.debug?.bind(console)??(()=>{}),groupCollapsed:console.groupCollapsed?.bind(console)??(()=>{}),groupEnd:console.groupEnd?.bind(console)??(()=>{}),table:console.table?.bind(console)??(()=>{})}}catch(e){return{log(){},info(){},warn(){},error(){},debug(){},groupCollapsed(){},groupEnd(){},table(){}}}})();let Cn=null,Pn=0,kn="undefined"!=typeof performance&&performance.now?performance.now():Date.now(),Fn=!1;const Tn=["#b7bcb7","#d0d0d0","#ffffff","#00695c","#1a1a1a","#ff4013","#0d5cb6","#ffa000"],Dn=[.5,.25,.12,.06,.03,.02,.01,.01];let Ln=null,An=null,In="auto",Kn="light",On=!1;var Rn=Object.freeze({__proto__:null,getCurrentTheme:()=>In,initializeDarkMode:ut,setTheme:pt,toggleDarkMode:ht});let zn=null,Vn={};(()=>{try{const e=localStorage.getItem("panel_control_visibility");e&&(Vn=JSON.parse(e))}catch(e){Vn={}}})();const Bn={environment:{title:"Browser",icon:"🧭",defaultOpen:!1,controls:[{id:"chromeHarmonyMode",label:"Chrome Harmony",stateKey:"chromeHarmonyMode",type:"select",options:[{value:"auto",label:"Auto (adapt only when needed)"},{value:"site",label:"Site (benchmark)"},{value:"browser",label:"Browser (force adapt)"}],default:"site",format:e=>e+"",parse:e=>e+"",hint:"If desktop browsers ignore theme-color, the wall adapts to match the browser UI palette.",onChange(){Promise.resolve().then(()=>Rn).then(({getCurrentTheme:e,setTheme:t})=>{t(e())}).catch(()=>{})}},{id:"autoDarkModeEnabled",label:"Auto Dark (Night)",stateKey:"autoDarkModeEnabled",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,hint:"In Auto theme, prefer Dark during the night window (privacy-first: local clock only).",onChange(){Promise.resolve().then(()=>Rn).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}},{id:"autoDarkNightStartHour",label:"Night Starts",stateKey:"autoDarkNightStartHour",type:"range",min:0,max:23,step:1,default:18,format:e=>Math.round(e)+":00",parse:e=>parseInt(e,10),onChange(){Promise.resolve().then(()=>Rn).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}},{id:"autoDarkNightEndHour",label:"Night Ends",stateKey:"autoDarkNightEndHour",type:"range",min:0,max:23,step:1,default:6,format:e=>Math.round(e)+":00",parse:e=>parseInt(e,10),onChange(){Promise.resolve().then(()=>Rn).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}}]},balls:{title:"Balls",icon:"🎱",defaultOpen:!1,controls:[{id:"sizeGlobal",label:"Size",stateKey:"sizeScale",type:"range",min:.1,max:6,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat,onChange(e){Promise.resolve().then(()=>xa).then(({updateBallSizes:t})=>{t();const a=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=a,e.rBase=a})}),Promise.resolve().then(()=>ro).then(({updateCursorSize:e})=>{e()})}},{id:"responsiveScaleMobile",label:"Mobile Scale",stateKey:"responsiveScaleMobile",type:"range",min:.5,max:1.5,step:.05,default:.75,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Ball size multiplier for iPad/iPhone (requires reload)",onChange(e){Promise.resolve().then(()=>xa).then(({detectResponsiveScale:t})=>{t();const a=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=a,e.rBase=a})})}},{id:"mobileObjectReductionFactor",label:"Mobile Density",stateKey:"mobileObjectReductionFactor",type:"range",min:0,max:1,step:.05,default:.7,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Scales object counts on mobile (0% = none). Resets the current mode.",onChange(e){Promise.resolve().then(()=>un).then(({setMode:t})=>{t(e.currentMode)}).catch(()=>{})}},{id:"ballSoftnessGlobal",label:"Softness",stateKey:"ballSoftness",type:"range",min:0,max:100,step:1,default:20,format:e=>e+"",parse:e=>parseInt(e,10)},{id:"ballSpacing",label:"Spacing",stateKey:"ballSpacing",type:"range",min:0,max:.5,step:.01,default:.08,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Collision gap as % of ball radius (affects physics)"},{id:"sizeVariationGlobalMul",label:"Variation Scale",stateKey:"sizeVariationGlobalMul",type:"range",min:0,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Global multiplier for per-mode size variation",onChange(){Promise.resolve().then(()=>xa).then(({updateBallSizes:e})=>{e()})}},{id:"sizeVariationCap",label:"Variation Cap",stateKey:"sizeVariationCap",type:"range",min:0,max:.5,step:.01,default:.12,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Max radius deviation from medium (12% = ±12%)",onChange(){Promise.resolve().then(()=>xa).then(({updateBallSizes:e})=>{e()})}}]},cursor:{title:"Cursor",icon:"👆",defaultOpen:!1,controls:[{id:"cursorSize",label:"Size",stateKey:"cursorSize",type:"range",min:.1,max:3,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,onChange(){Promise.resolve().then(()=>ro).then(({updateCursorSize:e})=>{e()})}},{id:"cursorInfluenceRadiusVw",label:"Influence Radius",stateKey:"cursorInfluenceRadiusVw",type:"range",min:0,max:80,step:.5,default:14,format:e=>e.toFixed(1)+"vw",parse:parseFloat,hint:"Universal cursor interaction zone (scales with viewport width)."}]},trail:{title:"Trail",icon:"✨",defaultOpen:!1,controls:[{id:"mouseTrailEnabled",label:"Enabled",stateKey:"mouseTrailEnabled",type:"checkbox",default:!0},{id:"mouseTrailLength",label:"Length",stateKey:"mouseTrailLength",type:"range",min:4,max:96,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),hint:"Max samples kept (higher = smoother, slightly more work)"},{id:"mouseTrailSize",label:"Size",stateKey:"mouseTrailSize",type:"range",min:.5,max:10,step:.1,default:1.3,format:e=>e.toFixed(1)+"px",parse:parseFloat},{id:"mouseTrailFadeMs",label:"Fade",stateKey:"mouseTrailFadeMs",type:"range",min:40,max:1200,step:10,default:220,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10)},{id:"mouseTrailOpacity",label:"Opacity",stateKey:"mouseTrailOpacity",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat}]},scene:{title:"Scene",icon:"⬚",defaultOpen:!1,controls:[{id:"sceneImpactEnabled",label:"Enabled",stateKey:"sceneImpactEnabled",type:"checkbox",default:!0,hint:"If disabled, mode changes will not animate the scene."},{id:"sceneImpactMul",label:"Click Depth",stateKey:"sceneImpactMul",type:"range",min:0,max:.05,step:.001,default:.004,format:e=>e.toFixed(3),parse:parseFloat,hint:"How far the entire scene “presses in” on simulation change.",onChange(e,t){const a=document.getElementById("abs-scene");a&&a.style.setProperty("--abs-scene-impact-mul",t+"")}},{id:"sceneImpactPressMs",label:"Press",stateKey:"sceneImpactPressMs",type:"range",min:20,max:300,step:5,default:75,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Press-in duration."},{id:"sceneImpactReleaseMs",label:"Release",stateKey:"sceneImpactReleaseMs",type:"range",min:40,max:1200,step:10,default:220,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Release duration (“bounce out” length)."},{id:"sceneImpactAnticipation",label:"Anticipation",stateKey:"sceneImpactAnticipation",type:"range",min:0,max:.6,step:.01,default:0,format:e=>e.toFixed(2),parse:parseFloat,hint:"Micro pre-pop before the click-in (0 = off)."},{id:"sceneChangeSoundEnabled",label:"Scene Sound",stateKey:"sceneChangeSoundEnabled",type:"checkbox",default:!0,hint:"Plays a soft “pebble-like” tick when switching simulations (only if sound is enabled)."},{id:"sceneChangeSoundIntensity",label:"Scene Sound Intensity",stateKey:"sceneChangeSoundIntensity",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat},{id:"sceneChangeSoundRadius",label:"Scene Sound Pitch",stateKey:"sceneChangeSoundRadius",type:"range",min:6,max:60,step:1,default:18,format:e=>""+Math.round(e),parse:e=>parseInt(e,10),hint:"Higher = lower pitch (maps like “ball size”)."}]},overlay:{title:"Overlay",icon:"🌫️",defaultOpen:!1,controls:[{id:"gateOverlayEnabled",label:"Enabled",stateKey:"gateOverlayEnabled",type:"checkbox",default:!0},{id:"gateOverlayOpacity",label:"White Wash",stateKey:"gateOverlayOpacity",type:"range",min:0,max:.1,step:.001,default:.01,format:e=>e.toFixed(3),parse:parseFloat,onChange(e,t){Promise.resolve().then(()=>co).then(({updateOverlayOpacity:e})=>{e(t)})}},{id:"gateOverlayTransitionMs",label:"Anim In Speed",stateKey:"gateOverlayTransitionMs",type:"range",min:200,max:1500,step:50,default:800,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration for blur & depth zoom when opening",onChange(e,t){Promise.resolve().then(()=>co).then(({updateOverlayTransition:e})=>{e(t)})}},{id:"gateOverlayTransitionOutMs",label:"Anim Out Speed",stateKey:"gateOverlayTransitionOutMs",type:"range",min:200,max:1200,step:50,default:600,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration for blur & depth zoom when closing",onChange(e,t){Promise.resolve().then(()=>co).then(({updateOverlayTransitionOut:e})=>{e(t)})}},{id:"gateOverlayContentDelayMs",label:"Content Delay",stateKey:"gateOverlayContentDelayMs",type:"range",min:0,max:1e3,step:50,default:200,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Wait before showing dialog content",onChange(e,t){Promise.resolve().then(()=>co).then(({updateGateContentDelay:e})=>{e(t)})}},{id:"gateDepthScale",label:"Depth Scale",stateKey:"gateDepthScale",type:"range",min:.9,max:1,step:.001,default:.96,format:e=>e.toFixed(3),parse:parseFloat,hint:"Scene scale when gate opens (0.9-1.0)",onChange(e,t){Promise.resolve().then(()=>co).then(({updateGateDepthScale:e})=>{e(t)})}},{id:"gateDepthTranslateY",label:"Depth Shift",stateKey:"gateDepthTranslateY",type:"range",min:0,max:30,step:1,default:8,format:e=>Math.round(e)+"px",parse:parseInt,hint:"Vertical shift when gate opens",onChange(e,t){Promise.resolve().then(()=>co).then(({updateGateDepthTranslateY:e})=>{e(t)})}},{id:"logoOpacityInactive",label:"Logo Opacity Closed",stateKey:"logoOpacityInactive",type:"range",min:0,max:1,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,hint:"Logo opacity when gate is closed (1 = fully visible)",onChange(e,t){Promise.resolve().then(()=>co).then(({updateLogoOpacityInactive:e})=>{e(t)})}},{id:"logoOpacityActive",label:"Logo Opacity Open",stateKey:"logoOpacityActive",type:"range",min:0,max:1,step:.05,default:.2,format:e=>e.toFixed(2),parse:parseFloat,hint:"Logo opacity when gate is active (0.2 = more faded)",onChange(e,t){Promise.resolve().then(()=>co).then(({updateLogoOpacityActive:e})=>{e(t)})}},{id:"logoBlurInactive",label:"Logo Blur Closed",stateKey:"logoBlurInactive",type:"range",min:0,max:20,step:.5,default:0,format:e=>e.toFixed(1)+"px",parse:parseFloat,hint:"Logo blur when gate is closed (0 = sharp)",onChange(e,t){Promise.resolve().then(()=>co).then(({updateLogoBlurInactive:e})=>{e(t)})}},{id:"logoBlurActive",label:"Logo Blur Open",stateKey:"logoBlurActive",type:"range",min:0,max:30,step:.5,default:12,format:e=>e.toFixed(1)+"px",parse:parseFloat,hint:"Logo blur when gate is active (12px = soft blur)",onChange(e,t){Promise.resolve().then(()=>co).then(({updateLogoBlurActive:e})=>{e(t)})}}]},colors:{title:"Colors",icon:"🎨",defaultOpen:!1,controls:[{type:"divider",label:"Backgrounds"},{id:"bgLight",label:"Light Mode",stateKey:"bgLight",type:"color",default:"#f5f5f5",hint:"Background color for light mode",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--bg-light",t),!e.isDarkMode){a.style.setProperty("--chrome-bg",t);const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t)}}},{id:"bgDark",label:"Dark Mode",stateKey:"bgDark",type:"color",default:"#0a0a0a",hint:"Background color for dark mode",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--bg-dark",t),e.isDarkMode){a.style.setProperty("--chrome-bg",t);const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t)}}},{id:"frameColor",label:"Frame/Wall",stateKey:"frameColor",type:"color",default:"#0a0a0a",hint:"Color for the wall/frame border",onChange(e,t){const a=document.documentElement;a.style.setProperty("--frame-color-light",t),a.style.setProperty("--frame-color-dark",t),a.style.setProperty("--wall-color",t)}},{type:"divider",label:"Text · Light Mode"},{id:"textColorLight",label:"Primary",stateKey:"textColorLight",type:"color",default:"#161616",hint:"Main text color in light mode",onChange(e,t){const a=document.documentElement;a.style.setProperty("--text-color-light",t),a.style.setProperty("--text-color-light-base",t)}},{id:"textColorLightMuted",label:"Muted",stateKey:"textColorLightMuted",type:"color",default:"#2f2f2f",hint:"Secondary/muted text in light mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-light-muted",t)}},{type:"divider",label:"Text · Dark Mode"},{id:"textColorDark",label:"Primary",stateKey:"textColorDark",type:"color",default:"#b3b3b3",hint:"Main text color in dark mode",onChange(e,t){const a=document.documentElement;a.style.setProperty("--text-color-dark",t),a.style.setProperty("--text-color-dark-base",t)}},{id:"textColorDarkMuted",label:"Muted",stateKey:"textColorDarkMuted",type:"color",default:"#808080",hint:"Secondary/muted text in dark mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-dark-muted",t)}},{type:"divider",label:"Links"},{id:"linkHoverColor",label:"Hover Accent",stateKey:"linkHoverColor",type:"color",default:"#ff4013",hint:"Link hover color (accent)",onChange(e,t){document.documentElement.style.setProperty("--link-hover-color",t)}},{type:"divider",label:"Logo"},{id:"logoColorLight",label:"Light Mode",stateKey:"logoColorLight",type:"color",default:"#161616",hint:"Logo color in light mode",onChange(e,t){document.documentElement.style.setProperty("--logo-color-light",t)}},{id:"logoColorDark",label:"Dark Mode",stateKey:"logoColorDark",type:"color",default:"#d5d5d5",hint:"Logo color in dark mode",onChange(e,t){document.documentElement.style.setProperty("--logo-color-dark",t)}}]},wall:{title:"Wall",icon:"🏗️",defaultOpen:!1,controls:[{id:"wallPreset",label:"Material",stateKey:"wallPreset",type:"select",options:Object.keys(ga).map(e=>({value:e,label:e.charAt(0).toUpperCase()+e.slice(1)})),default:"rubber",format:e=>e.charAt(0).toUpperCase()+e.slice(1),onChange(e,t){((e,t)=>{ga[e]&&(t.wallPreset=e)})(t,e),kt()}},{id:"frameColor",label:"Color",stateKey:"frameColor",type:"color",default:"#0a0a0a",hint:"Wall/frame border color (same as Colors → Frame Color)",onChange(e,t){const a=document.documentElement;a.style.setProperty("--frame-color-light",t),a.style.setProperty("--frame-color-dark",t),a.style.setProperty("--wall-color",t)}},{id:"wallThicknessVw",label:"Thickness",stateKey:"wallThicknessVw",type:"range",min:0,max:8,step:.1,default:1.3,format:e=>e.toFixed(1)+"vw",parse:parseFloat,onChange(){Promise.resolve().then(()=>xa).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars(),Promise.resolve().then(()=>co).then(({updateBlurFromWallThickness:e})=>{e()})})}},{id:"wallRadiusVw",label:"Corner Radius",stateKey:"wallRadiusVw",type:"range",min:0,max:12,step:.1,default:3.7,format:e=>e.toFixed(1)+"vw",parse:parseFloat,onChange(){Promise.resolve().then(()=>xa).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars()})}},{id:"wallInset",label:"Collision Inset",stateKey:"wallInset",type:"range",min:0,max:20,step:1,default:2,format:e=>e+"px",parse:e=>parseInt(e,10),hint:"Physics padding inside the visual wall"},{id:"wallWobbleMaxDeform",label:"Strength (Max Deform)",stateKey:"wallWobbleMaxDeform",type:"range",min:0,max:150,step:1,default:45,format:e=>e+"px",parse:e=>parseInt(e,10),group:"Advanced Physics",groupCollapsed:!0},{id:"wallWobbleStiffness",label:"Stiffness",stateKey:"wallWobbleStiffness",type:"range",min:50,max:3e3,step:10,default:2200,format:e=>e+"",parse:e=>parseInt(e,10),group:"Advanced Physics"},{id:"wallWobbleDamping",label:"Damping",stateKey:"wallWobbleDamping",type:"range",min:0,max:80,step:1,default:35,format:e=>e+"",parse:e=>parseInt(e,10),group:"Advanced Physics"},{id:"wallWobbleSigma",label:"Impact Spread",stateKey:"wallWobbleSigma",type:"range",min:.5,max:4,step:.1,default:2,format:e=>e.toFixed(1),parse:parseFloat,group:"Advanced Physics"},{id:"wallWobbleCornerClamp",label:"Corner Stickiness",stateKey:"wallWobbleCornerClamp",type:"range",min:0,max:1,step:.01,default:.6,format:e=>e.toFixed(2),parse:parseFloat,group:"Advanced Physics"},{id:"wallWobbleImpactThreshold",label:"Impact Threshold",stateKey:"wallWobbleImpactThreshold",type:"range",min:20,max:200,step:1,default:140,format:e=>e+" px/s",parse:e=>parseInt(e,10),group:"Advanced Physics",hint:"Minimum velocity to trigger wall wobble"},{id:"wallWobbleSettlingSpeed",label:"Settling Speed",stateKey:"wallWobbleSettlingSpeed",type:"range",min:0,max:100,step:1,default:75,format:e=>e+"%",parse:e=>parseInt(e,10),group:"Advanced Physics",hint:"How aggressively walls stop moving"}]},noise:{title:"Noise",icon:"📺",defaultOpen:!1,controls:[{id:"noiseSizeBase",label:"Back Size",stateKey:"noiseSizeBase",type:"range",min:50,max:200,step:5,default:100,format:e=>e+"",parse:e=>parseInt(e,10),cssVar:"--noise-size-base"},{id:"noiseSizeTop",label:"Front Size",stateKey:"noiseSizeTop",type:"range",min:40,max:150,step:5,default:80,format:e=>e+"",parse:e=>parseInt(e,10),cssVar:"--noise-size-top"},{id:"noiseBackOpacity",label:"Back Opacity (Light)",stateKey:"noiseBackOpacity",type:"range",min:0,max:.3,step:.005,default:.025,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-back-opacity"},{id:"noiseFrontOpacity",label:"Front Opacity (Light)",stateKey:"noiseFrontOpacity",type:"range",min:0,max:.3,step:.005,default:.055,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-front-opacity"},{id:"noiseBackOpacityDark",label:"Back Opacity (Dark)",stateKey:"noiseBackOpacityDark",type:"range",min:0,max:.5,step:.005,default:.12,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-back-opacity-dark"},{id:"noiseFrontOpacityDark",label:"Front Opacity (Dark)",stateKey:"noiseFrontOpacityDark",type:"range",min:0,max:.5,step:.005,default:.08,format:e=>e.toFixed(3),parse:parseFloat,cssVar:"--noise-front-opacity-dark"}]},critters:{title:"Critters",icon:"🪲",mode:"critters",defaultOpen:!1,controls:[{id:"critterCount",label:"Count",stateKey:"critterCount",type:"range",min:10,max:260,step:5,default:90,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"critterSpeed",label:"Speed",stateKey:"critterSpeed",type:"range",min:0,max:1800,step:10,default:680,format:e=>""+Math.round(e),parse:parseFloat},{id:"critterMaxSpeed",label:"Max Speed",stateKey:"critterMaxSpeed",type:"range",min:200,max:4e3,step:25,default:1400,format:e=>""+Math.round(e),parse:parseFloat},{id:"critterStepHz",label:"Step Rate",stateKey:"critterStepHz",type:"range",min:0,max:16,step:.1,default:5,format:e=>e.toFixed(1)+" Hz",parse:parseFloat},{id:"critterStepSharpness",label:"Step Sharpness",stateKey:"critterStepSharpness",type:"range",min:.5,max:6,step:.1,default:2.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnNoise",label:"Wander",stateKey:"critterTurnNoise",type:"range",min:0,max:8,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnDamp",label:"Turn Inertia",stateKey:"critterTurnDamp",type:"range",min:.5,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnSeek",label:"Steering",stateKey:"critterTurnSeek",type:"range",min:0,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterAvoidRadius",label:"Avoid Radius",stateKey:"critterAvoidRadius",type:"range",min:0,max:260,step:5,default:90,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"critterAvoidForce",label:"Avoid Force",stateKey:"critterAvoidForce",type:"range",min:0,max:25e3,step:250,default:9500,format:e=>Math.round(e)+"",parse:parseFloat},{id:"critterEdgeAvoid",label:"Edge Avoid",stateKey:"critterEdgeAvoid",type:"range",min:0,max:3,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat},{id:"critterMousePull",label:"Mouse Fear",stateKey:"critterMousePull",type:"range",min:0,max:4,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Flee strength inside the mouse zone"},{id:"critterMouseRadiusVw",label:"Mouse Zone",stateKey:"critterMouseRadiusVw",type:"range",min:0,max:80,step:1,default:30,format:e=>Math.round(e)+"vw",parse:parseFloat},{id:"critterRestitution",label:"Bounciness",stateKey:"critterRestitution",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat,hint:"Mode-only override",onChange(e,t){"critters"===e.currentMode&&(e.REST=t)}},{id:"critterFriction",label:"Friction",stateKey:"critterFriction",type:"range",min:0,max:.06,step:.001,default:.018,format:e=>e.toFixed(3),parse:parseFloat,hint:"Mode-only override",onChange(e,t){"critters"===e.currentMode&&(e.FRICTION=t)}},yt("crittersWarmupFrames")]},pit:{title:"Ball Pit",icon:"🎯",mode:"pit",defaultOpen:!1,controls:[{id:"gravityPit",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange(e,t){"pit"===e.currentMode&&(e.G=e.GE*t)}},{id:"weightPit",label:"Weight",stateKey:"ballMassKg",type:"range",min:10,max:200,step:1,default:129,format:e=>e.toFixed(0),parse:parseFloat,onChange(e,t){e.balls.forEach(e=>{e.m=t})}},{id:"restitution",label:"Bounciness",stateKey:"REST",type:"range",min:0,max:1,step:.01,default:.69,format:e=>e.toFixed(2),parse:parseFloat},{id:"friction",label:"Air Friction",stateKey:"FRICTION",type:"range",min:0,max:.01,step:5e-4,default:.006,format:e=>e.toFixed(4),parse:parseFloat},{id:"repelPower",label:"Repel Power",stateKey:"repelPower",type:"range",min:0,max:1e4,step:100,default:8500,format:e=>""+Math.round(e),parse:parseFloat,onChange(e,t){e.repelPower=24e3*Math.pow(2,12*(Math.max(0,Math.min(1e4,t))/1e4-.5))}},{id:"sleepVelocityThreshold",label:"Sleep Speed",stateKey:"sleepVelocityThreshold",type:"range",min:0,max:40,step:.5,default:12,format:e=>(+e).toFixed(1)+" px/s",parse:parseFloat,hint:"Pit modes only. Higher = settles sooner."},{id:"sleepAngularThreshold",label:"Sleep Spin",stateKey:"sleepAngularThreshold",type:"range",min:0,max:1,step:.01,default:.18,format:e=>(+e).toFixed(2)+" rad/s",parse:parseFloat,hint:"Pit modes only. Higher = stops spinning sooner."},{id:"timeToSleep",label:"Sleep Time",stateKey:"timeToSleep",type:"range",min:.05,max:2,step:.05,default:.25,format:e=>(+e).toFixed(2)+"s",parse:parseFloat,hint:"Pit modes only. Lower = sleeps faster."},yt("pitWarmupFrames")]},pitThrows:{title:"Ball Pit (Throws)",icon:"🎯",mode:"pit-throws",defaultOpen:!1,controls:[{id:"gravityPitThrows",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange(e,t){"pit-throws"===e.currentMode&&(e.G=e.GE*t)}},{id:"pitThrowsSpeed",label:"Throw Speed",stateKey:"pitThrowSpeed",type:"range",min:100,max:2e3,step:25,default:650,format:e=>Math.round(e)+"",parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpeedVar",label:"Speed Variance",stateKey:"pitThrowSpeedVar",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},{id:"sleepVelocityThresholdThrows",label:"Sleep Speed",stateKey:"sleepVelocityThreshold",type:"range",min:0,max:40,step:.5,default:12,format:e=>(+e).toFixed(1)+" px/s",parse:parseFloat,hint:"Pit modes only. Higher = settles sooner."},{id:"sleepAngularThresholdThrows",label:"Sleep Spin",stateKey:"sleepAngularThreshold",type:"range",min:0,max:1,step:.01,default:.18,format:e=>(+e).toFixed(2)+" rad/s",parse:parseFloat,hint:"Pit modes only. Higher = stops spinning sooner."},{id:"timeToSleepThrows",label:"Sleep Time",stateKey:"timeToSleep",type:"range",min:.05,max:2,step:.05,default:.25,format:e=>(+e).toFixed(2)+"s",parse:parseFloat,hint:"Pit modes only. Lower = sleeps faster."},{id:"pitThrowsInterval",label:"Throw Interval",stateKey:"pitThrowIntervalMs",type:"range",min:10,max:500,step:5,default:70,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsColorPause",label:"Color Pause",stateKey:"pitThrowColorPauseMs",type:"range",min:0,max:1200,step:10,default:180,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsPairChance",label:"Pair Chance",stateKey:"pitThrowPairChance",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsPairStagger",label:"Pair Stagger",stateKey:"pitThrowPairStaggerMs",type:"range",min:0,max:120,step:1,default:18,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsBatchSize",label:"Batch Size",stateKey:"pitThrowBatchSize",type:"range",min:1,max:60,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"pitThrowsTargetYFrac",label:"Throw Aim (Y)",stateKey:"pitThrowTargetYFrac",type:"range",min:.12,max:.7,step:.01,default:.36,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAngleJitter",label:"Angle Jitter",stateKey:"pitThrowAngleJitter",type:"range",min:0,max:.6,step:.01,default:.16,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpreadVar",label:"Spread Variance",stateKey:"pitThrowSpreadVar",type:"range",min:0,max:.8,step:.01,default:.25,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsSpeedJitter",label:"Speed Jitter",stateKey:"pitThrowSpeedJitter",type:"range",min:0,max:.8,step:.01,default:.22,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsInletInset",label:"Inlet Inset",stateKey:"pitThrowInletInset",type:"range",min:0,max:.2,step:.005,default:.06,format:e=>e.toFixed(3),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpawnSpread",label:"Spawn Spread",stateKey:"pitThrowSpawnSpread",type:"range",min:0,max:.12,step:.0025,default:.02,format:e=>e.toFixed(4),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAimJitter",label:"Aim Jitter",stateKey:"pitThrowAimJitter",type:"range",min:0,max:.2,step:.005,default:.04,format:e=>e.toFixed(3),parse:parseFloat},{id:"pitThrowsCrossBias",label:"Cross Aim",stateKey:"pitThrowCrossBias",type:"range",min:0,max:.3,step:.005,default:.12,format:e=>e.toFixed(3),parse:parseFloat},yt("pitThrowsWarmupFrames")]},flies:{title:"Flies",icon:"🕊️",mode:"flies",defaultOpen:!1,controls:[{id:"fliesBallCount",label:"Ball Count",stateKey:"fliesBallCount",type:"range",min:20,max:150,step:5,default:60,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"attractPower",label:"Attraction",stateKey:"attractionPower",type:"range",min:100,max:8e3,step:50,default:5e3,format:e=>""+Math.round(e),parse:parseFloat},{id:"swarmSpeed",label:"Swarm Speed",stateKey:"swarmSpeed",type:"range",min:.2,max:5,step:.1,default:.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"fliesSeparation",label:"Separation",stateKey:"fliesSeparation",type:"range",min:5e3,max:3e4,step:1e3,default:15e3,format:e=>""+Math.round(e),parse:parseFloat},yt("fliesWarmupFrames")]},weightless:{title:"Zero-G",icon:"🌌",mode:"weightless",defaultOpen:!1,controls:[{id:"weightlessCount",label:"Ball Count",stateKey:"weightlessCount",type:"range",min:20,max:200,step:10,default:80,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"weightlessSpeed",label:"Initial Speed",stateKey:"weightlessInitialSpeed",type:"range",min:100,max:600,step:25,default:250,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"weightlessBounce",label:"Bounce",stateKey:"weightlessBounce",type:"range",min:.5,max:1,step:.05,default:.95,format:e=>e.toFixed(2),parse:parseFloat},{id:"weightlessRepelPower",label:"Cursor Blast Power",stateKey:"weightlessRepelPower",type:"range",min:0,max:6e5,step:1e4,default:22e4,format:e=>""+Math.round(e),parse:parseFloat},{id:"weightlessRepelSoft",label:"Cursor Blast Falloff",stateKey:"weightlessRepelSoft",type:"range",min:.5,max:6,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},yt("weightlessWarmupFrames")]},water:{title:"Water",icon:"🌊",mode:"water",defaultOpen:!1,controls:[{id:"waterBallCount",label:"Ball Count",stateKey:"waterBallCount",type:"range",min:50,max:400,step:10,default:300,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"waterDrag",label:"Water Resistance",stateKey:"waterDrag",type:"range",min:.001,max:.05,step:.001,default:.015,format:e=>e.toFixed(3),parse:parseFloat},{id:"waterRippleStrength",label:"Ripple Strength",stateKey:"waterRippleStrength",type:"range",min:5e3,max:3e4,step:1e3,default:18e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"waterMotion",label:"Drift Strength",stateKey:"waterDriftStrength",type:"range",min:0,max:80,step:1,default:40,format:e=>e.toFixed(0),parse:parseFloat,onChange(e,t){e.waterInitialVelocity=5*t},reinitMode:!0},yt("waterWarmupFrames")]},vortex:{title:"Vortex",icon:"🌀",mode:"vortex",defaultOpen:!1,controls:[{id:"vortexBallCount",label:"Ball Count",stateKey:"vortexBallCount",type:"range",min:50,max:500,step:10,default:180,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"vortexSwirl",label:"Swirl Strength",stateKey:"vortexSwirlStrength",type:"range",min:100,max:3e3,step:50,default:420,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexPull",label:"Radial Pull",stateKey:"vortexRadialPull",type:"range",min:0,max:2e3,step:20,default:180,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexSpeedMultiplier",label:"Speed Multiplier",stateKey:"vortexSpeedMultiplier",type:"range",min:.1,max:3,step:.1,default:1,format:e=>e.toFixed(1),parse:parseFloat},{id:"vortexRadius",label:"Vortex Radius",stateKey:"vortexRadius",type:"range",min:0,max:800,step:20,default:0,format:e=>0===e?"Unlimited":e.toFixed(0)+"px",parse:parseFloat,tooltip:"Maximum effective radius (0 = unlimited, uses distance falloff)"},{id:"vortexFalloffCurve",label:"Falloff Curve",stateKey:"vortexFalloffCurve",type:"range",min:.3,max:3,step:.1,default:1,format:e=>e.toFixed(1),parse:parseFloat,tooltip:"Falloff shape: 1.0 = linear, 2.0 = quadratic (sharper), 0.5 = gentle"},{id:"vortexRotationDirection",label:"Rotation Direction",stateKey:"vortexRotationDirection",type:"range",min:-1,max:1,step:2,default:1,format:e=>1===e?"Counterclockwise":"Clockwise",parse:parseFloat},{id:"vortexCoreStrength",label:"Core Strength",stateKey:"vortexCoreStrength",type:"range",min:.5,max:3,step:.1,default:1,format:e=>e.toFixed(1)+"x",parse:parseFloat,tooltip:"Strength multiplier at vortex center"},{id:"vortexAccelerationZone",label:"Acceleration Zone",stateKey:"vortexAccelerationZone",type:"range",min:0,max:400,step:20,default:0,format:e=>0===e?"Disabled":e.toFixed(0)+"px",parse:parseFloat,tooltip:"Radius where extra acceleration occurs (0 = disabled)"},{id:"vortexOutwardPush",label:"Outward Push",stateKey:"vortexOutwardPush",type:"range",min:0,max:1e3,step:20,default:0,format:e=>0===e?"Disabled":e.toFixed(0),parse:parseFloat,tooltip:"Outward force at edges (only when radius is set)"},{id:"vortexDrag",label:"Drag",stateKey:"vortexDrag",type:"range",min:.001,max:.05,step:.001,default:.005,format:e=>e.toFixed(3),parse:parseFloat},yt("vortexWarmupFrames")]},"ping-pong":{title:"Ping Pong",icon:"🏓",mode:"ping-pong",defaultOpen:!1,controls:[{id:"pingPongBallCount",label:"Ball Count",stateKey:"pingPongBallCount",type:"range",min:10,max:100,step:5,default:35,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"pingPongSpeed",label:"Ball Speed",stateKey:"pingPongSpeed",type:"range",min:200,max:1600,step:50,default:800,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"pingPongCursorRadius",label:"Cursor Radius",stateKey:"pingPongCursorRadius",type:"range",min:30,max:200,step:5,default:100,format:e=>e.toFixed(0),parse:parseFloat},{id:"pingPongVerticalDamp",label:"Vertical Damping",stateKey:"pingPongVerticalDamp",type:"range",min:.8,max:.999,step:.001,default:.995,format:e=>e.toFixed(3),parse:parseFloat},yt("pingPongWarmupFrames")]},magnetic:{title:"Magnetic",icon:"🧲",mode:"magnetic",defaultOpen:!1,controls:[{id:"magneticBallCount",label:"Ball Count",stateKey:"magneticBallCount",type:"range",min:50,max:300,step:10,default:180,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"magneticStrength",label:"Strength",stateKey:"magneticStrength",type:"range",min:1e4,max:1e5,step:5e3,default:65e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticVelocity",label:"Max Velocity",stateKey:"magneticMaxVelocity",type:"range",min:500,max:4e3,step:100,default:2800,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticDamping",label:"Damping",stateKey:"magneticDamping",type:"range",min:.8,max:.999,step:.001,default:.98,format:e=>e.toFixed(3),parse:parseFloat},yt("magneticWarmupFrames")]},bubbles:{title:"Bubbles",icon:"🫧",mode:"bubbles",defaultOpen:!1,controls:[{id:"bubblesRate",label:"Bubble Rate",stateKey:"bubblesSpawnRate",type:"range",min:1,max:20,step:1,default:8,format:e=>e+"",parse:e=>parseInt(e,10)},{id:"bubblesSpeed",label:"Rise Speed",stateKey:"bubblesRiseSpeed",type:"range",min:50,max:400,step:25,default:150,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesWobble",label:"Wobble",stateKey:"bubblesWobble",type:"range",min:0,max:100,step:5,default:40,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesMax",label:"Max Bubbles",stateKey:"bubblesMaxCount",type:"range",min:50,max:300,step:10,default:150,format:e=>e+"",parse:e=>parseInt(e,10)},yt("bubblesWarmupFrames")]},tilt:{title:"Tilt",icon:"⚖️",mode:"tilt",defaultOpen:!1,controls:[{id:"tiltBallCount",label:"Particle Count",stateKey:"tiltBallCount",type:"range",min:100,max:500,step:10,default:300,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"tiltMaxAngle",label:"Max Angle",stateKey:"tiltMaxAngle",type:"range",min:.5,max:10,step:.5,default:2,format:e=>e.toFixed(1)+"°",parse:parseFloat},{id:"tiltLerpSpeed",label:"Smoothness",stateKey:"tiltLerpSpeed",type:"range",min:.01,max:.5,step:.01,default:.08,format:e=>e.toFixed(2),parse:parseFloat},{id:"tiltGlassMass",label:"Particle Mass",stateKey:"tiltGlassBallMass",type:"range",min:.02,max:.3,step:.01,default:.08,format:e=>e.toFixed(2)+"x",parse:parseFloat,reinitMode:!0},{id:"tiltFriction",label:"Friction",stateKey:"tiltFriction",type:"range",min:.002,max:.02,step:.001,default:.008,format:e=>e.toFixed(3),parse:parseFloat}]},kaleidoscope:{title:"Kaleidoscope",icon:"🪞",mode:"kaleidoscope",defaultOpen:!1,controls:[{id:"kaleiBallCount",label:"Ball Count",stateKey:"kaleidoscopeBallCount",type:"range",min:15,max:120,step:1,default:23,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kaleiWedges",label:"Wedges",stateKey:"kaleidoscopeWedges",type:"range",min:4,max:16,step:1,default:12,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kaleiMirror",label:"Mirror",type:"range",min:0,max:1,step:1,default:1,format:e=>e?"On":"Off",parse:e=>parseInt(e,10)},{id:"kaleiSpeed",label:"Speed",stateKey:"kaleidoscopeSpeed",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat},{id:"kaleiDotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscopeDotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kaleiDotAreaMul",label:"Dot Area",stateKey:"kaleidoscopeDotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kaleiSpawnArea",label:"Spawn Density",stateKey:"kaleidoscopeSpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kaleiSizeVar",label:"Size Variance",stateKey:"kaleidoscopeSizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},yt("kaleidoscopeWarmupFrames")]},kaleidoscope1:{title:"Kaleidoscope I (Variant)",icon:"🪞",mode:"kaleidoscope-1",defaultOpen:!1,controls:[{id:"kalei1BallCount",label:"Ball Count",stateKey:"kaleidoscope1BallCount",type:"range",min:6,max:180,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei1Wedges",label:"Wedges",stateKey:"kaleidoscope1Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei1Speed",label:"Speed",stateKey:"kaleidoscope1Speed",type:"range",min:.2,max:2,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei1DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope1DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei1DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope1DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei1SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope1SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei1SizeVar",label:"Size Variance",stateKey:"kaleidoscope1SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},yt("kaleidoscope1WarmupFrames")]},kaleidoscope2:{title:"Kaleidoscope II (Variant)",icon:"🪞",mode:"kaleidoscope-2",defaultOpen:!1,controls:[{id:"kalei2BallCount",label:"Ball Count",stateKey:"kaleidoscope2BallCount",type:"range",min:10,max:260,step:2,default:36,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei2Wedges",label:"Wedges",stateKey:"kaleidoscope2Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei2Speed",label:"Speed",stateKey:"kaleidoscope2Speed",type:"range",min:.2,max:2,step:.05,default:1.15,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei2DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope2DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei2DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope2DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei2SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope2SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei2SizeVar",label:"Size Variance",stateKey:"kaleidoscope2SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},yt("kaleidoscope2WarmupFrames")]},kaleidoscope3:{title:"Kaleidoscope III (Variant)",icon:"🪞",mode:"kaleidoscope-3",defaultOpen:!1,controls:[{id:"kalei3BallCount",label:"Ball Count",stateKey:"kaleidoscope3BallCount",type:"range",min:12,max:300,step:3,default:54,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei3Wedges",label:"Wedges",stateKey:"kaleidoscope3Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei3Speed",label:"Speed",stateKey:"kaleidoscope3Speed",type:"range",min:.2,max:2,step:.05,default:1.55,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei3DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope3DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei3DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope3DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei3SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope3SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei3SizeVar",label:"Size Variance",stateKey:"kaleidoscope3SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},yt("kaleidoscope3WarmupFrames")]},orbit3d:{title:"Orbit 3D: Zero Gravity",icon:"🌪️",mode:"orbit-3d",defaultOpen:!1,controls:[{id:"orbit3dMoonCount",label:"Body Count",stateKey:"orbit3dMoonCount",type:"range",min:10,max:200,step:10,default:80,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"orbit3dGravity",label:"Gravity Pull",stateKey:"orbit3dGravity",type:"range",min:1e3,max:1e4,step:500,default:5e3,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3dVelocityMult",label:"Orbital Speed",stateKey:"orbit3dVelocityMult",type:"range",min:50,max:300,step:10,default:150,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3dDepthScale",label:"Depth Effect",stateKey:"orbit3dDepthScale",type:"range",min:0,max:1.5,step:.1,default:.8,format:e=>e.toFixed(1),parse:parseFloat},{id:"orbit3dDamping",label:"Stability",stateKey:"orbit3dDamping",type:"range",min:.005,max:.05,step:.005,default:.02,format:e=>e.toFixed(3),parse:parseFloat},{id:"sizeVariationOrbit3d",label:"Size Variation",stateKey:"sizeVariationOrbit3d",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},yt("orbit3dWarmupFrames")]},orbit3d2:{title:"Orbit 3D (Tight Swarm)",icon:"🌪️",mode:"orbit-3d-2",defaultOpen:!1,controls:[{id:"orbit3d2MoonCount",label:"Moon Count",stateKey:"orbit3d2MoonCount",type:"range",min:20,max:200,step:10,default:100,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"orbit3d2Gravity",label:"Gravity (G×M)",stateKey:"orbit3d2Gravity",type:"range",min:1e4,max:3e5,step:1e4,default:8e4,format:e=>Math.round(e/1e3)+"k",parse:parseFloat,reinitMode:!0},{id:"orbit3d2VelocityMult",label:"Initial Velocity",stateKey:"orbit3d2VelocityMult",type:"range",min:.5,max:1.5,step:.05,default:1.1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"orbit3d2MinOrbit",label:"Min Orbit (vw)",stateKey:"orbit3d2MinOrbit",type:"range",min:2,max:15,step:1,default:4,format:e=>e+"vw",parse:parseFloat,reinitMode:!0},{id:"orbit3d2MaxOrbit",label:"Max Orbit (vw)",stateKey:"orbit3d2MaxOrbit",type:"range",min:3,max:25,step:1,default:12,format:e=>e+"vw",parse:parseFloat,reinitMode:!0},{id:"orbit3d2DepthScale",label:"Depth Effect",stateKey:"orbit3d2DepthScale",type:"range",min:0,max:.8,step:.05,default:.6,format:e=>e.toFixed(2),parse:parseFloat},{id:"orbit3d2Damping",label:"Damping",stateKey:"orbit3d2Damping",type:"range",min:0,max:.2,step:.005,default:.01,format:e=>e.toFixed(3),parse:parseFloat},{id:"orbit3d2FollowSmoothing",label:"Cursor Follow Speed",stateKey:"orbit3d2FollowSmoothing",type:"range",min:1,max:200,step:1,default:40,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3d2Softening",label:"Gravity Softening",stateKey:"orbit3d2Softening",type:"range",min:1,max:100,step:1,default:15,format:e=>Math.round(e),parse:parseFloat},{id:"sizeVariationOrbit3d2",label:"Size Variation",stateKey:"sizeVariationOrbit3d2",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},yt("orbit3d2WarmupFrames")]},lattice:{title:"Crystal Lattice",icon:"💎",mode:"lattice",defaultOpen:!1,controls:[{id:"sizeVariationLattice",label:"Size Variation",stateKey:"sizeVariationLattice",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"latticeSpacingVw",label:"Spacing (vw)",stateKey:"latticeSpacingVw",type:"range",min:1,max:20,step:.25,default:8.5,format:e=>e.toFixed(2)+"vw",parse:parseFloat,reinitMode:!0},{id:"latticeStiffness",label:"Stiffness",stateKey:"latticeStiffness",type:"range",min:0,max:10,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},{id:"latticeDamping",label:"Damping",stateKey:"latticeDamping",type:"range",min:.5,max:1,step:.01,default:.92,format:e=>e.toFixed(2),parse:parseFloat},{id:"latticeDisruptRadius",label:"Mesh Stretch Radius",stateKey:"latticeDisruptRadius",type:"range",min:50,max:1e3,step:25,default:600,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"latticeDisruptPower",label:"Mesh Stretch Power",stateKey:"latticeDisruptPower",type:"range",min:0,max:50,step:1,default:25,format:e=>e.toFixed(1),parse:parseFloat},{id:"latticeMeshWaveStrength",label:"Wave Amplitude",stateKey:"latticeMeshWaveStrength",type:"range",min:0,max:50,step:1,default:12,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"latticeMeshWaveSpeed",label:"Wave Speed",stateKey:"latticeMeshWaveSpeed",type:"range",min:0,max:3,step:.1,default:.8,format:e=>e.toFixed(1)+"x",parse:parseFloat},{id:"latticeAlignment",label:"Grid Alignment",stateKey:"latticeAlignment",type:"select",options:[{value:"center",label:"Center (Fill)"},{value:"top-left",label:"Top-Left"},{value:"top-center",label:"Top-Center"},{value:"top-right",label:"Top-Right"}],default:"center",format:e=>e+"",parse:e=>e+"",reinitMode:!0},yt("latticeWarmupFrames")]},neural:{title:"Neural Network",icon:"🧠",mode:"neural",defaultOpen:!1,controls:[{id:"neuralBallCount",label:"Ball Count",stateKey:"neuralBallCount",type:"range",min:8,max:260,step:1,default:80,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"sizeVariationNeural",label:"Size Variation",stateKey:"sizeVariationNeural",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"neuralWanderStrength",label:"Wander Strength",stateKey:"neuralWanderStrength",type:"range",min:0,max:2e3,step:10,default:420,format:e=>Math.round(e)+"",parse:parseFloat},{id:"neuralDamping",label:"Damping",stateKey:"neuralDamping",type:"range",min:.8,max:1,step:.005,default:.985,format:e=>e.toFixed(3),parse:parseFloat},{id:"neuralCohesion",label:"Cohesion",stateKey:"neuralCohesion",type:"range",min:0,max:1,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},yt("neuralWarmupFrames")]},parallaxLinear:{title:"Parallax (Linear)",icon:"🫧",mode:"parallax-linear",defaultOpen:!1,controls:[{id:"parallaxLinearPreset",label:"Preset",stateKey:"parallaxLinearPreset",type:"select",options:Object.keys(ba).map(e=>({value:e,label:ba[e].label})),default:"default",format:e=>ba[e]?.label||e,onChange(e){bt(e,!0)}},{id:"parallaxLinearDotSizeMul",label:"Dot Size",stateKey:"parallaxLinearDotSizeMul",type:"range",min:.2,max:6,step:.1,default:1.8,format:e=>e.toFixed(1)+"×",parse:parseFloat,reinitMode:!0},{id:"sizeVariationParallaxLinear",label:"Size Variation",stateKey:"sizeVariationParallaxLinear",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"parallaxLinearGridX",label:"Grid X (Cols)",stateKey:"parallaxLinearGridX",type:"range",min:3,max:40,step:1,default:14,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearGridY",label:"Grid Y (Rows)",stateKey:"parallaxLinearGridY",type:"range",min:3,max:40,step:1,default:10,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearGridZ",label:"Grid Z (Layers)",stateKey:"parallaxLinearGridZ",type:"range",min:2,max:20,step:1,default:7,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearSpanX",label:"Span X",stateKey:"parallaxLinearSpanX",type:"range",min:.2,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0,hint:"World-space width as a multiple of the viewport width. Use >1 to fill edge-to-edge."},{id:"parallaxLinearSpanY",label:"Span Y",stateKey:"parallaxLinearSpanY",type:"range",min:.2,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0,hint:"World-space height as a multiple of the viewport height."},{id:"parallaxLinearZNear",label:"Z Near",stateKey:"parallaxLinearZNear",type:"range",min:10,max:1200,step:10,default:50,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearZFar",label:"Z Far",stateKey:"parallaxLinearZFar",type:"range",min:50,max:3e3,step:25,default:900,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearFocalLength",label:"Focal Length",stateKey:"parallaxLinearFocalLength",type:"range",min:80,max:2e3,step:10,default:420,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10)},{id:"parallaxLinearParallaxStrength",label:"Parallax Strength",stateKey:"parallaxLinearParallaxStrength",type:"range",min:0,max:2e3,step:10,default:260,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},yt("parallaxLinearWarmupFrames")]},parallaxPerspective:{title:"Parallax (Perspective)",icon:"🫧",mode:"parallax-perspective",defaultOpen:!1,controls:[{id:"parallaxPerspectivePreset",label:"Preset",stateKey:"parallaxPerspectivePreset",type:"select",options:Object.keys(Ma).map(e=>({value:e,label:Ma[e].label})),default:"default",format:e=>Ma[e]?.label||e,onChange(e){Mt(e,!0)}},{id:"parallaxPerspectiveRandomness",label:"Randomness",stateKey:"parallaxPerspectiveRandomness",type:"range",min:0,max:1,step:.05,default:.6,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0,hint:"0 = perfect grid. 1 = full jitter from grid vertices."},{id:"parallaxPerspectiveDotSizeMul",label:"Dot Size",stateKey:"parallaxPerspectiveDotSizeMul",type:"range",min:.2,max:6,step:.1,default:1.8,format:e=>e.toFixed(1)+"×",parse:parseFloat,reinitMode:!0},{id:"sizeVariationParallaxPerspective",label:"Size Variation",stateKey:"sizeVariationParallaxPerspective",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveGridX",label:"Grid X (Cols)",stateKey:"parallaxPerspectiveGridX",type:"range",min:3,max:50,step:1,default:16,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveGridY",label:"Grid Y (Rows)",stateKey:"parallaxPerspectiveGridY",type:"range",min:3,max:50,step:1,default:12,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveGridZ",label:"Grid Z (Layers)",stateKey:"parallaxPerspectiveGridZ",type:"range",min:2,max:25,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveSpanX",label:"Span X",stateKey:"parallaxPerspectiveSpanX",type:"range",min:.2,max:3,step:.05,default:1.45,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveSpanY",label:"Span Y",stateKey:"parallaxPerspectiveSpanY",type:"range",min:.2,max:3,step:.05,default:1.45,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveZNear",label:"Z Near",stateKey:"parallaxPerspectiveZNear",type:"range",min:10,max:1200,step:10,default:40,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveZFar",label:"Z Far",stateKey:"parallaxPerspectiveZFar",type:"range",min:50,max:4e3,step:50,default:1200,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveFocalLength",label:"Focal Length",stateKey:"parallaxPerspectiveFocalLength",type:"range",min:80,max:2e3,step:10,default:420,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10)},{id:"parallaxPerspectiveParallaxStrength",label:"Parallax Strength",stateKey:"parallaxPerspectiveParallaxStrength",type:"range",min:0,max:2e3,step:10,default:280,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},yt("parallaxPerspectiveWarmupFrames")]}};var En=Object.freeze({__proto__:null,CONTROL_SECTIONS:Bn,applyParallaxLinearPreset:bt,applyParallaxPerspectivePreset:Mt,bindRegisteredControls:Pt,generatePanelHTML:Ct,getAllControls:xt,isControlVisible:gt,setApplyVisualCSSVars(e){zn=e},syncSlidersToState:kt}),Wn=Object.freeze({__proto__:null,setupControls:Ft,updateModeButtonsUI:Tt});const $n=Ct(),Gn={core:{title:"Core",controls:[{id:"masterGain",label:"Master Volume",min:10,max:100,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"collisionMinImpact",label:"Silence Threshold",min:20,max:85,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e}]},envelope:{title:"Envelope",controls:[{id:"decayTime",label:"Click Length",min:20,max:180,step:1,format:e=>Math.round(e)+"ms",toConfig:e=>e/1e3,fromConfig:e=>1e3*e}]},tone:{title:"Tone",controls:[{id:"filterBaseFreq",label:"Brightness",min:300,max:6e3,step:50,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"harmonicGain",label:"Warmth",min:0,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"filterQ",label:"Resonance",min:10,max:200,step:5,format:e=>""+(e/100).toFixed(2),toConfig:e=>e/100,fromConfig:e=>100*e}]},crystal:{title:"Crystal",controls:[{id:"pitchMinHz",label:"Pitch Low",min:80,max:1200,step:10,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"pitchMaxHz",label:"Pitch High",min:200,max:4e3,step:20,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"pitchCurve",label:"Pitch Curve",min:70,max:160,step:1,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleGain",label:"Sparkle",min:0,max:35,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMin",label:"Sparkle Min",min:120,max:600,step:10,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMax",label:"Sparkle Max",min:160,max:800,step:10,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleDecayMul",label:"Sparkle Decay",min:20,max:95,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"noiseTransientQ",label:"Sparkle Q",min:60,max:600,step:5,format:e=>""+(e/100).toFixed(2),toConfig:e=>e/100,fromConfig:e=>100*e}]},space:{title:"Space",controls:[{id:"reverbWetMix",label:"Reverb Mix",min:0,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"reverbDecay",label:"Room Size",min:5,max:80,step:1,format:e=>(e/100).toFixed(2)+"s",toConfig:e=>e/100,fromConfig:e=>100*e}]},dynamics:{title:"Dynamics",controls:[{id:"minGain",label:"Min Hit Volume",min:0,max:20,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"maxGain",label:"Max Hit Volume",min:5,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e}]},realism:{title:"Realism",controls:[{id:"noiseTransientGain",label:"Impact Snap",min:0,max:80,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"varianceGain",label:"Volume Variance",min:0,max:50,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"variancePitch",label:"Pitch Variance",min:0,max:25,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"velocityNoiseScale",label:"Hard Hit Crack",min:100,max:500,step:10,format:e=>(e/100).toFixed(1)+"×",toConfig:e=>e/100,fromConfig:e=>100*e}]}};let _n=null,Nn=null;const Hn="panel_dock_position_v2",Zn="panel_dock_hidden",jn="master_panel_collapsed",Yn="panel_dock_size";let Xn=!1,qn=0,Un=0,Jn=0,Qn=0;var eo=Object.freeze({__proto__:null,createPanelDock:At,resetPanelPositions:zt,toggleDock:Vt});let to=!1,ao=null,no=!1,oo=!1,io=0;var ro=Object.freeze({__proto__:null,hideCursor:Gt,setupCustomCursor:Et,showCursor:_t,updateCursorPosition:$t,updateCursorSize:Wt});let lo=null,so=!0;var co=Object.freeze({__proto__:null,hideOverlay:qt,initGateOverlay:Zt,isOverlayActive:Ut,showOverlay:Xt,updateGateContentDelay(e){document.documentElement.style.setProperty("--gate-content-delay",e+"ms")},updateGateDepthScale(e){document.documentElement.style.setProperty("--gate-depth-scale",e)},updateGateDepthTranslateY(e){document.documentElement.style.setProperty("--gate-depth-translate-y",e+"px")},updateLogoBlurActive(e){const t=document.documentElement;t.style.setProperty("--logo-blur-active-target",e+"px"),Ut()&&t.style.setProperty("--logo-blur-active",e+"px")},updateLogoBlurInactive(e){const t=document.documentElement;t.style.setProperty("--logo-blur-inactive",e+"px"),Ut()||t.style.setProperty("--logo-blur-active",e+"px")},updateLogoOpacityActive(e){const t=document.documentElement,a=e;t.style.setProperty("--logo-opacity-active-target",a),Ut()&&t.style.setProperty("--logo-opacity-active",a)},updateLogoOpacityInactive(e){const t=document.documentElement;t.style.setProperty("--logo-opacity-inactive",e),Ut()||t.style.setProperty("--logo-opacity-active",e)},updateOverlayOpacity(e){lo&&lo.style.setProperty("--gate-overlay-opacity",e)},updateOverlayTransition(e){lo&&(lo.style.setProperty("--gate-overlay-transition-duration",e+"ms"),document.documentElement.style.setProperty("--gate-depth-duration",e+"ms"))},updateOverlayTransitionOut(e){lo&&(lo.style.setProperty("--gate-overlay-transition-out-duration",e+"ms"),document.documentElement.style.setProperty("--gate-depth-out-duration",e+"ms"))}});const po="--abs-scene-impact",uo="--abs-scene-impact-dur";let ho=null,fo=!1,mo=0,go=0,bo=0,Mo=!1,yo=0,vo=0,xo=0,wo=0,So=!1,Co=null,Po=0,ko=0,Fo=0,To=0,Do=performance.now()/1e3,Lo=0,Ao=!0,Io=null;const Ko=1e3/60;let Oo=[],Ro=0,zo=null;const Vo='<i class="ti ti-volume-off" aria-hidden="true"></i>';let Bo=null;const Eo=new Map([["apple music",'<i class="ti ti-brand-apple" aria-hidden="true"></i>'],["instagram",'<i class="ti ti-brand-instagram" aria-hidden="true"></i>'],["linkedin",'<i class="ti ti-brand-linkedin" aria-hidden="true"></i>']]),Wo=new Map([["ai integration","bg-ball-4"],["ui/ux design","bg-ball-2"],["creative strategy","bg-story-grey"],["frontend development","bg-ball-5"],["brand identity","bg-ball-8"],["3d design","bg-ball-7"],["art direction","bg-ball-6"]]);let $o=!1;(async()=>{document.documentElement.classList.add("js-enabled");try{await(async()=>{if(zo)return zo;const e=aa();if(e)return zo=e,zo;const t=await(async()=>{const e=["config/text.json","js/text.json","../public/js/text.json"];for(const a of e)try{const e=await fetch(a,{cache:"no-cache"});if(!e.ok)continue;const t=await e.json();if(ta(t))return t}catch(t){}throw Error("No text.json found")})();zo=t;try{"undefined"!=typeof window&&(window.__TEXT__=t)}catch(a){}return zo})(),(()=>{try{(()=>{const e=na("meta.title","");e&&(document.title=e);const t=na("meta.description","");if(t){const e=document.querySelector('meta[name="description"]');e&&e.setAttribute("content",t)}})(),ca(document.getElementById("edge-chapter-text"),na("edge.chapterText","")),ca(document.querySelector(".edge-copyright__text"),na("edge.copyright","")),(()=>{const e=document.getElementById("expertise-legend");da(e,"aria-label",na("legend.ariaLabel",""));const t=na("legend.items",null);if(!Array.isArray(t)||!e)return;const a=e.querySelectorAll(".legend__item span");for(let n=0;a.length>n&&t.length>n;n++){const e=t?.[n]?.label;e&&(a[n].textContent=e)}})(),(()=>{const e=document.querySelector(".decorative-script p");if(!e)return;const t=na("philosophy.textBeforeLink",""),a=na("philosophy.link.id","contact-email-inline")||"contact-email-inline",n=na("philosophy.link.href","#")||"#",o=na("philosophy.link.text","")||"";let i=document.getElementById(a);if(i||(i=e.querySelector("a")),!i)return;i.id=a,i.setAttribute("href",n),i.textContent=o;const r=i.previousSibling;r&&r.nodeType===Node.TEXT_NODE?r.nodeValue=t:e.insertBefore(document.createTextNode(t),i);const l=i.nextSibling;l&&l.nodeType===Node.TEXT_NODE&&(l.nodeValue="")})(),(()=>{da(document.getElementById("footer-links-container"),"aria-label",na("footer.navAriaLabel",""));const e=na("footer.links",null);if(e&&"object"==typeof e)for(const t of["contact","portfolio","cv"]){const a=e?.[t];if(!a)continue;const n=document.getElementById(a.id||"");n&&(a.href&&n.setAttribute("href",a.href),a.text&&(n.textContent=a.text))}})(),(()=>{const e=document.getElementById("social-links");da(e,"aria-label",na("socials.ariaLabel",""));const t=na("socials.items",null);if(!e||!t||"object"!=typeof t)return;const a=["appleMusic","instagram","linkedin"],n=e.querySelectorAll("a.footer_icon-link");for(let o=0;n.length>o&&3>o;o++){const e=n[o],i=t?.[a[o]];if(!i)continue;i.url&&e.setAttribute("href",i.url),i.ariaLabel&&e.setAttribute("aria-label",i.ariaLabel);const r=e.querySelector(".screen-reader");r&&i.screenReaderText&&(r.textContent=i.screenReaderText)}})()}catch(e){}})()}catch(e){}if(Qe()?tt():(({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"]}={})=>{Qe()||tt({sentence:e,ascii:t,silence:!0})})(),Qe())try{const e=await Promise.resolve().then(()=>En);e.setApplyVisualCSSVars?.(pa)}catch(e){}try{Qe()&&Sn.groupCollapsed("BouncyBalls bootstrap"),nt("bb:start"),at("🚀 Initializing modular bouncy balls...");const t=await(async()=>{try{try{if("undefined"!=typeof window&&window.__RUNTIME_CONFIG__&&"object"==typeof window.__RUNTIME_CONFIG__)return window.__RUNTIME_CONFIG__}catch(e){}const t=["config/default-config.json","js/config.json","../public/js/config.json"];for(const a of t)try{const e=await fetch(a,{cache:"no-cache"});if(e.ok)return await e.json()}catch(e){}throw Error("No config found")}catch(e){return console.warn("Config load failed, using defaults"),{gravityMultiplier:1.05,ballMass:91,maxBalls:300}}})();c(t),nt("bb:config"),at("✓ Config loaded");try{const e=d();"undefined"!=typeof window&&(window.REST=e.REST,window.FRICTION=e.FRICTION,window.MAX_BALLS=e.maxBalls,window.repelRadius=e.repelRadius,window.repelPower=e.repelPower)}catch(e){}s(),at("✓ Layout applied"),pa(t),at("✓ Visual effects configured"),(()=>{const e=document.querySelector(".noise");if(!e)return;const t=e.closest("#bravia-balls")||document.getElementById("bravia-balls")||e.parentElement||document.body,a=getComputedStyle(e),n=a.backgroundImage&&"none"!==a.backgroundImage?a.backgroundImage:null;if(!document.querySelector(".noise-2")){const e=document.createElement("div");e.className="noise-2",n&&(e.style.backgroundImage=n),t.appendChild(e),console.log("✓ Created .noise-2 element")}if(!document.querySelector(".noise-3")){const e=document.createElement("div");e.className="noise-3",n&&(e.style.backgroundImage=n),t.appendChild(e),console.log("✓ Created .noise-3 element")}})(),ue();const a=fe(),n=me(),o=document.getElementById("bravia-balls");if(!a||!n||!o)throw Error("Missing DOM elements");try{a.setAttribute("role","application"),a.getAttribute("aria-label")||a.setAttribute("aria-label","Interactive bouncy balls physics simulation")}catch(e){}u(a,n,o),he(),nt("bb:renderer"),at("✓ Canvas initialized (container-relative sizing)"),d().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),(()=>{function t(e){return!(!e||!e.closest||!(e.closest("#panelDock")||e.closest("#masterPanel")||e.closest("#dockToggle")||e.closest(".panel-dock")||e.closest(".panel")))}function a(e,t){return!p&&c||(c=l.getBoundingClientRect(),p=!1),{x:(e-c.left)*s,y:(t-c.top)*s,inBounds:!(c.left>e||e>c.right||c.top>t||t>c.bottom)}}function n(e,n,o,{isMouseLike:i}={isMouseLike:!0}){if(i?$t(e,n):Gt(),r.currentMode!==ua.ORBIT_3D&&r.currentMode!==ua.ORBIT_3D_2&&t(o))return;if(Ut())return;const l=a(e,n),s=performance.now(),c=s-xo;if(c>0&&xo>0){const e=l.x-yo,t=l.y-vo;wo=Math.sqrt(e*e+t*t)/c}r.mouseX=l.x,r.mouseY=l.y,r.mouseInCanvas=l.inBounds,"undefined"!=typeof window&&(window.mouseInCanvas=l.inBounds);const p=Math.hypot(l.x-(r.lastPointerMoveX??l.x),l.y-(r.lastPointerMoveY??l.y));p>.5&&(r.lastPointerMoveMs=s,r.lastPointerMoveX=l.x,r.lastPointerMoveY=l.y),i&&p>.5&&((e,t,a,n)=>{const o=d();if(!o?.mouseTrailEnabled)return;if(!n)return;if(Xe())return;if((e=>{const t=Math.max(0,0|e);t>0&&(hn===t&&fn&&mn&&gn||(hn=t,fn=new Float32Array(hn),mn=new Float32Array(hn),gn=new Float64Array(hn),bn=0,Mn=0))})(qe(0|(o.mouseTrailLength??18),4,96)),!hn)return;const i=o.DPR||1,r=qe(+(o.mouseTrailSize??1.3),.5,10)*i,l=Math.max(.35,.55*r),s=l*l;if(Mn>0){const n=(bn-1+hn)%hn;if(((e,t,a,n)=>{const o=e-a,i=t-n;return o*o+i*i})(e,t,fn[n],mn[n])<s)return void(gn[n]=a)}fn[bn]=e,mn[bn]=t,gn[bn]=a,bn=(bn+1)%hn,hn>Mn&&Mn++})(l.x,l.y,s,l.inBounds),r.currentMode===ua.WATER&&l.inBounds&&wo>.3&&s-Po>80&&(ae(l.x,l.y,Math.min(2*wo,3)),Po=s),yo=l.x,vo=l.y,xo=s}function o(e,n,o,i=null){So||t(o)||(e=>!(!e||!e.closest||!(e.closest("a")||e.closest("button")||e.closest("input")||e.closest("select")||e.closest("textarea"))))(o)||Ut()||r.clickCycleEnabled&&a(e,n).inBounds&&(So=!0,Co=i,Qt(1,{armManual:!0,scheduleRelease:!1}))}function i(e=null){So&&(null!==Co&&null!==e&&e!==Co||(So=!1,Co=null,(()=>{const e=d(),t=ha,a=t.indexOf(e.currentMode),n=t[((0>a?0:a)+1)%t.length];Promise.resolve().then(()=>un).then(({setMode:e})=>{e(n)}),Promise.resolve().then(()=>Wn).then(({updateModeButtonsUI:e})=>{e(n)})})(),(()=>{if(!fo||!ho)return;const e=d();!1!==e?.sceneImpactEnabled&&ea({token:mo,releaseMs:e?.sceneImpactReleaseMs??220})})()))}const r=d(),l=r.canvas;if(void 0===r.clickCycleEnabled&&(r.clickCycleEnabled=!1),!l)return void console.error("Canvas not available for pointer setup");const s=r.DPR;let c=null,p=!0;try{window.addEventListener("resize",()=>{p=!0},{passive:!0})}catch(e){}document.addEventListener("mousemove",e=>{window.PointerEvent||n(e.clientX,e.clientY,e.target,{isMouseLike:!0})},{passive:!0}),document.addEventListener("pointermove",e=>{n(e.clientX,e.clientY,e.target,{isMouseLike:"mouse"===e.pointerType||"pen"===e.pointerType})},{passive:!0}),window.PointerEvent?(document.addEventListener("pointerdown",e=>{o(e.clientX,e.clientY,e.target,e.pointerId)},{passive:!0}),document.addEventListener("pointerup",e=>{i(e.pointerId)},{passive:!0}),document.addEventListener("pointercancel",e=>{i(e.pointerId)},{passive:!0})):(document.addEventListener("mousedown",e=>{o(e.clientX,e.clientY,e.target,null)},{passive:!0}),document.addEventListener("mouseup",()=>{i(null)},{passive:!0})),document.addEventListener("touchmove",e=>{if(!Ut()&&e.touches&&e.touches[0]){const t=a(e.touches[0].clientX,e.touches[0].clientY);r.mouseX=t.x,r.mouseY=t.y,r.mouseInCanvas=t.inBounds;const n=performance.now();Math.hypot(t.x-(r.lastPointerMoveX??t.x),t.y-(r.lastPointerMoveY??t.y))>.5&&(r.lastPointerMoveMs=n,r.lastPointerMoveX=t.x,r.lastPointerMoveY=t.y),r.currentMode===ua.WATER&&t.inBounds&&n-Po>80&&(ae(t.x,t.y,2),Po=n)}},{passive:!0}),document.addEventListener("touchstart",e=>{if(!window.PointerEvent&&!t(e.target)&&!Ut()&&(Gt(),!e.target.closest("a")&&!e.target.closest("button")&&!e.target.closest("input")&&!e.target.closest("select")&&!e.target.closest("textarea")&&e.touches&&e.touches[0])){if(!a(e.touches[0].clientX,e.touches[0].clientY).inBounds)return;r.clickCycleEnabled&&(So=!0,Co=null,Qt(1,{armManual:!0,scheduleRelease:!1}))}},{passive:!0}),document.addEventListener("touchend",()=>{window.PointerEvent||i(null)},{passive:!0}),document.addEventListener("touchcancel",()=>{window.PointerEvent||i(null)},{passive:!0}),document.addEventListener("mouseleave",()=>{r.mouseX=ma.OFFSCREEN_MOUSE,r.mouseY=ma.OFFSCREEN_MOUSE,r.mouseInCanvas=!1,wo=0,"undefined"!=typeof window&&(window.mouseInCanvas=!1),Gt()}),document.addEventListener("mouseenter",()=>{_t()}),document.addEventListener("touchend",()=>{r.mouseX=ma.OFFSCREEN_MOUSE,r.mouseY=ma.OFFSCREEN_MOUSE,r.mouseInCanvas=!1},{passive:!0}),console.log("✓ Unified pointer system configured (document-level)"),r.$=!0,"undefined"!=typeof window&&(window.$=!0)})(),at("✓ Pointer tracking configured"),Et(),nt("bb:input"),at("✓ Custom cursor initialized"),(()=>{if("undefined"==typeof window||"undefined"==typeof document)return;let t=null;try{t=d()}catch(e){}ho=document.querySelector("#abs-scene")||null,ho&&(ho.style.setProperty(po,"0"),ho.style.setProperty(uo,"100ms"),t&&void 0!==t.sceneImpactMul&&ho.style.setProperty("--abs-scene-impact-mul",t.sceneImpactMul+""),(()=>{try{return!(!window.matchMedia||!window.matchMedia("(prefers-reduced-motion: reduce)").matches)}catch(e){return!1}})()||(fo=!0,window.addEventListener("bb:modeChanged",e=>{const t=d();if(!1===t?.sceneImpactEnabled)return;if(Mo)return void(Mo=!1);const a=e?.detail||{};Qt(a.prevMode&&a.mode&&a.prevMode!==a.mode?1:.75,{armManual:!1})},{passive:!0})))})(),console.log("⚠️ localStorage is disabled - using defaults"),K();try{(e=>{const t=e&&"object"==typeof e?e:null;if(!t)return;if("string"==typeof t.soundPreset&&_(t.soundPreset),t.soundConfig&&"object"==typeof t.soundConfig)return void G(t.soundConfig);const a={};let n=!1;for(const[o,i]of Object.entries(t))o in Fa&&(a[o]=i,n=!0);n&&G(a)})(t)}catch(e){}if(at("✓ Sound engine primed (awaiting user unlock)"),"undefined"!=typeof window&&($o||($o=!0,window.addEventListener("bb:modeChanged",e=>{const t=d();if(!1===t?.sceneChangeSoundEnabled)return;const a=e?.detail||{};a.prevMode&&a.mode&&a.prevMode!==a.mode&&R(+(t?.sceneChangeSoundRadius??18),+(t?.sceneChangeSoundIntensity??.35),.5,null)},{passive:!0}))),Qe())try{const e=await Promise.resolve().then(()=>eo);e.createPanelDock?.();const t=await Promise.resolve().then(()=>Pa);t.populateColorSelect?.()}catch(e){}nt("bb:ui"),at(Qe()?"✓ Panel dock created (Sound + Controls)":"✓ UI initialized (panel disabled in production)"),ut(),nt("bb:theme"),(()=>{const e=document.getElementById("expertise-legend");if(!e)return;const t=Array.from(e.querySelectorAll(".legend__item"));for(const a of t){const e=a.querySelector("span"),t=a.querySelector(".circle");if(!e||!t)continue;const n=sa(e.textContent),o=Wo.get(n);if(o){for(const e of Array.from(t.classList))(e.startsWith("bg-ball-")||e.startsWith("bg-story-"))&&t.classList.remove(e);t.classList.add(o)}}})(),to||(to=!0,window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName))return;const t=e.key.toLowerCase();if("/"===t||"Slash"===e.code)return e.preventDefault(),void Vt();if("r"!==t)return"ArrowRight"===e.key?(e.preventDefault(),void Bt(1)):"ArrowLeft"===e.key?(e.preventDefault(),void Bt(-1)):void 0;e.preventDefault(),He();try{Tt(d().currentMode)}catch(e){}})),at("✓ Keyboard shortcuts registered"),Zt(t),at("✓ Gate overlay system initialized"),(()=>{const t=document.getElementById("cv-gate-trigger"),a=document.getElementById("brand-logo"),n=document.getElementById("cv-gate"),o=document.getElementById("portfolio-gate"),i=document.getElementById("contact-gate"),r=Array.from(document.querySelectorAll(".cv-digit")),l=document.getElementById("page-flash"),s=document.getElementById("cv-gate-label");if(!t||!a||!n||0===r.length)return void console.warn("CV Gate: Missing required elements");const c=na("gates.common.backText","BACK"),d=na("gates.common.backAriaLabel","Back"),p=na("gates.cv.title","Bio/CV"),u=na("gates.cv.description","Because spam bots don't deserve nice things—and neither do recruiters who don't read portfolios. This keeps my inbox slightly more civilized.");s&&(s.innerHTML=`\n            <div class="gate-nav">\n                <button type="button" class="gate-back" data-gate-back aria-label="${d}">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>${c}</span>\n                </button>\n            </div>\n            <h2 class="gate-title">${p}</h2>\n            <p class="gate-description">${u}</p>\n        `);const h=l||(()=>{const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e})();let f=!1;const m=()=>n&&n.classList.contains("active")||o&&o.classList.contains("active")||i&&i.classList.contains("active"),g=(e=!1)=>{f=!1,r.forEach(e=>e.value=""),e?(n.style.transition="none",a.style.transition="none",n.classList.remove("active"),n.setAttribute("aria-hidden","true"),n.classList.add("hidden"),a.classList.remove("fade-out-up"),m()||qt(),requestAnimationFrame(()=>{n.style.removeProperty("transition"),a.style.removeProperty("transition")})):(n.classList.remove("active"),n.setAttribute("aria-hidden","true"),a.classList.remove("fade-out-up"),setTimeout(()=>{f||n.classList.add("hidden"),m()||qt()},400))};try{const e=s?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",g)}catch(e){}n.addEventListener("click",e=>{(e.target===n||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&g(!0)});const b=()=>{const e=r.map(e=>e.value).join("");4===e.length&&("1111"===e?(oa(h,"success"),setTimeout(()=>{window.location.href="cv.html"},500)):(oa(h,"error"),setTimeout(()=>{r.forEach(e=>e.value=""),r[0].focus()},350)))};t.addEventListener("click",e=>{e.preventDefault();const t=m();o&&o.classList.contains("active")&&(o.classList.remove("active"),o.setAttribute("aria-hidden","true"),setTimeout(()=>{o.classList.add("hidden")},400)),i&&i.classList.contains("active")&&(i.classList.remove("active"),i.setAttribute("aria-hidden","true"),setTimeout(()=>{i.classList.add("hidden")},400)),f=!0,t||Xt(),a.classList.add("fade-out-up"),n.classList.remove("hidden"),n.setAttribute("aria-hidden","false"),n.classList.add("active"),r[0].focus()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&f&&g()}),document.addEventListener("gate-overlay-dismiss",e=>{f&&g(e.detail?.instant||!1)}),r.forEach((e,t)=>{e.addEventListener("keydown",a=>{"Backspace"===a.key&&""===e.value&&(t>0?r[t-1].focus():g())}),e.addEventListener("input",e=>{const a=e.target.value;if(/^\d*$/.test(a)){if(1===a.length)r.length-1>t?r[t+1].focus():b();else if(a.length>1){const n=a.split("");e.target.value=n[0];let o=t+1;for(let e=1;n.length>e&&r.length>o;e++)r[o].value=n[e],o++;r.length>o?r[o].focus():b()}}else e.target.value=a.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})})(),at("✓ CV password gate initialized"),(()=>{const t=document.getElementById("portfolio-gate-trigger"),a=document.getElementById("brand-logo"),n=document.getElementById("portfolio-gate"),o=document.getElementById("cv-gate"),i=document.getElementById("contact-gate"),r=Array.from(document.querySelectorAll(".portfolio-digit")),l=document.getElementById("page-flash"),s=document.getElementById("portfolio-gate-label");if(!t||!a||!n||0===r.length)return void console.warn("Portfolio Gate: Missing required elements");const c=na("gates.common.backText","BACK"),d=na("gates.common.backAriaLabel","Back"),p=na("gates.portfolio.title","View Portfolio"),u=na("gates.portfolio.description","Good work deserves good context. This small step ensures you're here with intention, not just browsing. Quality takes time—yours and mine.");s&&(s.innerHTML=`\n            <div class="gate-nav">\n                <button type="button" class="gate-back" data-gate-back aria-label="${d}">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>${c}</span>\n                </button>\n            </div>\n            <h2 class="gate-title">${p}</h2>\n            <p class="gate-description">${u}</p>\n        `);const h=l||(()=>{const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e})();let f=!1;const m=()=>n&&n.classList.contains("active")||o&&o.classList.contains("active")||i&&i.classList.contains("active"),g=(e=!1)=>{f=!1,r.forEach(e=>e.value=""),e?(n.style.transition="none",a.style.transition="none",n.classList.remove("active"),n.setAttribute("aria-hidden","true"),n.classList.add("hidden"),a.classList.remove("fade-out-up"),m()||qt(),requestAnimationFrame(()=>{n.style.removeProperty("transition"),a.style.removeProperty("transition")})):(n.classList.remove("active"),n.setAttribute("aria-hidden","true"),a.classList.remove("fade-out-up"),setTimeout(()=>{f||n.classList.add("hidden"),m()||qt()},400))};try{const e=s?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",g)}catch(e){}n.addEventListener("click",e=>{(e.target===n||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&g(!0)});const b=()=>{const e=r.map(e=>e.value).join("");4===e.length&&("1234"===e?(ia(h,"success"),setTimeout(()=>{window.location.href="portfolio.html"},500)):(ia(h,"error"),setTimeout(()=>{r.forEach(e=>e.value=""),r[0].focus()},350)))};t.addEventListener("click",e=>{e.preventDefault();const t=m();o&&o.classList.contains("active")&&(o.classList.remove("active"),o.setAttribute("aria-hidden","true"),setTimeout(()=>{o.classList.add("hidden")},400)),i&&i.classList.contains("active")&&(i.classList.remove("active"),i.setAttribute("aria-hidden","true"),setTimeout(()=>{i.classList.add("hidden")},400)),f=!0,t||Xt(),a.classList.add("fade-out-up"),n.classList.remove("hidden"),n.setAttribute("aria-hidden","false"),n.classList.add("active"),r[0].focus()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&f&&g()}),document.addEventListener("gate-overlay-dismiss",e=>{f&&g(e.detail?.instant||!1)}),r.forEach((e,t)=>{e.addEventListener("keydown",a=>{"Backspace"===a.key&&""===e.value&&(t>0?r[t-1].focus():g())}),e.addEventListener("input",e=>{const a=e.target.value;if(/^\d*$/.test(a)){if(1===a.length)r.length-1>t?r[t+1].focus():b();else if(a.length>1){const n=a.split("");e.target.value=n[0];let o=t+1;for(let e=1;n.length>e&&r.length>o;e++)r[o].value=n[e],o++;r.length>o?r[o].focus():b()}}else e.target.value=a.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})})(),at("✓ Portfolio password gate initialized"),(()=>{const t=na("contact.email","alexander@beck.fyi"),a=na("gates.common.backText","BACK"),n=na("gates.common.backAriaLabel","Back"),o=na("gates.contact.title","Contact"),i=na("gates.contact.description","For collaborations, product design work, AI prototyping, or anything that needs a crisp creative + technical brain."),r=na("contact.copy.buttonAriaLabel","Copy email address"),l=na("contact.copy.statusCopied","Copied"),s=na("contact.copy.statusError","Copy failed"),c=[document.getElementById("contact-email"),document.getElementById("contact-email-inline")].filter(Boolean),d=document.getElementById("brand-logo"),p=document.getElementById("contact-gate"),u=document.getElementById("contact-gate-label"),h=document.getElementById("contact-gate-inputs"),f=document.getElementById("cv-gate"),m=document.getElementById("portfolio-gate");if(!(c.length&&d&&p&&u&&h))return void console.warn("Contact Gate: Missing required elements");u.innerHTML=`\n    <div class="gate-nav">\n      <button type="button" class="gate-back" data-gate-back aria-label="${n}">\n        <i class="ti ti-arrow-left" aria-hidden="true"></i>\n        <span>${a}</span>\n      </button>\n    </div>\n    <h2 class="gate-title">${o}</h2>\n    <p class="gate-description">\n      ${i}\n    </p>\n  `,h.innerHTML=`\n    <div class="contact-email-row" data-email-row>\n      <button type="button" class="contact-email-value" data-copy-email aria-label="${r}">\n        <span class="contact-email-text">${t}</span>\n      </button>\n      <button type="button" class="contact-email-copy" data-copy-email-icon aria-label="${r}">\n        <i class="ti ti-copy" aria-hidden="true"></i>\n      </button>\n    </div>\n    <div class="contact-copy-status" data-copy-status aria-live="polite"></div>\n  `;const g=u.querySelector("[data-gate-back]"),b=h.querySelector("[data-copy-email]"),M=h.querySelector("[data-copy-email-icon]"),y=h.querySelector("[data-email-row]"),v=h.querySelector("[data-copy-status]"),x=h.querySelector(".contact-email-copy i");let w=!1,S=null;const C=()=>p&&p.classList.contains("active")||f&&f.classList.contains("active")||m&&m.classList.contains("active"),P=e=>{if(b&&M&&v){if(S&&window.clearTimeout(S),"copied"===e)return y?.classList?.add?.("is-copied"),y?.classList?.remove?.("is-error"),v.textContent=l,x&&(x.className="ti ti-check"),void(S=window.setTimeout(()=>P("idle"),1200));if("error"===e)return y?.classList?.add?.("is-error"),y?.classList?.remove?.("is-copied"),v.textContent=s,x&&(x.className="ti ti-alert-triangle"),void(S=window.setTimeout(()=>P("idle"),1200));y?.classList?.remove?.("is-copied","is-error"),v.textContent="",x&&(x.className="ti ti-copy")}},k=e=>{e?.preventDefault?.();const t=C();f&&f.classList.contains("active")&&(f.classList.remove("active"),f.setAttribute("aria-hidden","true"),setTimeout(()=>f.classList.add("hidden"),400)),m&&m.classList.contains("active")&&(m.classList.remove("active"),m.setAttribute("aria-hidden","true"),setTimeout(()=>m.classList.add("hidden"),400)),w=!0,t||Xt(),P("idle"),d.classList.add("fade-out-up"),p.classList.remove("hidden"),p.setAttribute("aria-hidden","false"),p.classList.add("active"),b?.focus?.()},F=(e=!1)=>{w=!1,P("idle"),e?(p.style.transition="none",d.style.transition="none",p.classList.remove("active"),p.setAttribute("aria-hidden","true"),p.classList.add("hidden"),d.classList.remove("fade-out-up"),C()||qt(),requestAnimationFrame(()=>{p.style.removeProperty("transition"),d.style.removeProperty("transition")})):(p.classList.remove("active"),p.setAttribute("aria-hidden","true"),d.classList.remove("fade-out-up"),setTimeout(()=>{w||p.classList.add("hidden"),C()||qt()},400))};c.forEach(e=>e.addEventListener("click",k,{capture:!0})),g?.addEventListener("click",F),p.addEventListener("click",e=>{(e.target===p||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&F(!0)});const T=async()=>{const a=await(async t=>{try{if(navigator?.clipboard?.writeText)return await navigator.clipboard.writeText(t),!0}catch(e){}try{const e=document.createElement("textarea");e.value=t,e.setAttribute("readonly","true"),e.style.position="fixed",e.style.left="-9999px",e.style.top="0",document.body.appendChild(e),e.select();const a=!0===document.execCommand?.("copy");return document.body.removeChild(e),a}catch(e){return!1}})(t);P(a?"copied":"error")};b?.addEventListener("click",T),M?.addEventListener("click",T),document.addEventListener("keydown",e=>{"Escape"===e.key&&w&&F()}),document.addEventListener("gate-overlay-dismiss",e=>{w&&F(e.detail?.instant||!1)})})(),at("✓ Contact gate initialized"),(()=>{const e=document.getElementById("social-links");if(!e)return;if(e.querySelector("i.ti"))return;const t=Array.from(e.querySelectorAll("a.footer_icon-link[aria-label]"));for(const a of t){const e=(a.getAttribute("aria-label")||"").trim().toLowerCase(),t=Eo.get(e);if(!t)continue;const n=a.querySelector("svg");n?(a.insertAdjacentHTML("afterbegin",t),n.remove()):a.insertAdjacentHTML("afterbegin",t)}})(),(()=>{function e(){t.textContent=n.format(new Date).toUpperCase()}const t=document.getElementById("time-display"),a=document.getElementById("site-year");if(!t)return;const n=new Intl.DateTimeFormat("en-GB",{timeZone:"Europe/London",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});e(),setInterval(e,1e3),a&&(a.style.cursor="pointer",a.addEventListener("click",ht))})(),(()=>{try{const e=document.getElementById("cv-gate-trigger");if(e&&!e.querySelector(".footer-link-nowrap")){const t=((na("footer.links.cv.text","")||"")+"").trim(),a=(e.textContent||"").trim().replace(/\s+/g," "),n=t||a;n&&n.includes("/")&&a===n&&(e.innerHTML=`<span class="footer-link-nowrap">${n}</span>`)}}catch(e){}})(),(()=>{if(K(),"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return console.log("⏸ Sound toggle hidden (prefers-reduced-motion)"),null;Bo=document.createElement("button"),Bo.className="sound-toggle",Bo.id="sound-toggle",Bo.type="button",Bo.setAttribute("aria-label","Toggle collision sounds"),Bo.setAttribute("aria-pressed","false"),Bo.setAttribute("data-enabled","false"),Bo.innerHTML=Vo,Bo.title="Sound off",Bo.addEventListener("click",ra);const t=document.getElementById("fade-content"),a=document.getElementById("sound-toggle-slot"),n=document.getElementById("top-elements-soundRow"),o=document.getElementById("social-links"),i=document.querySelector(".ui-meta-right"),r=!!a,l=o&&(!t||t.contains(o)),s="undefined"!=typeof window&&"function"==typeof window.matchMedia&&window.matchMedia("(max-width: 600px)").matches,c=t=>{if(!t)return!1;try{Bo.parentElement&&Bo.parentElement!==t&&Bo.parentElement.removeChild(Bo)}catch(e){}if(t.classList.contains("ui-meta-right")){const e=t.querySelector("time");if(e)return t.insertBefore(Bo,e),!0}return t.appendChild(Bo),!0};if(s&&n)Bo.classList.add("sound-toggle--top"),Bo.classList.add("sound-toggle--topwide"),c(n);else if(r)Bo.classList.add("sound-toggle--top"),c(a);else if(i)c(i);else if(l){const e=document.createElement("li");e.className="margin-bottom_none sound-toggle-item",Bo.classList.add("sound-toggle--social"),e.appendChild(Bo),o.appendChild(e)}else t?t.appendChild(Bo):document.body.appendChild(Bo);try{if("undefined"!=typeof window&&"function"==typeof window.matchMedia){const e=window.matchMedia("(max-width: 600px)"),t=()=>{const t=document.getElementById("top-elements-soundRow"),a=document.getElementById("sound-toggle-slot"),n=e.matches&&!!t;Bo.classList.toggle("sound-toggle--topwide",n),n?c(t):a&&c(a)};"function"==typeof e.addEventListener?e.addEventListener("change",t):"function"==typeof e.addListener&&e.addListener(t)}}catch(e){}console.log("✓ Sound toggle created");try{const e=W();la(!(!e.isUnlocked||!e.isEnabled))}catch(e){}"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(Wa,e=>{const t=e&&e.detail?e.detail:null;t&&la(!(!t.isUnlocked||!t.isEnabled))})})(),at("✓ Sound toggle button created"),at("✓ Theme toggle button created");const i=ua.PIT;P?.(),Ne(i);try{const e=await Promise.resolve().then(()=>Wn);e.updateModeButtonsUI?.(i)}catch(e){}nt("bb:mode"),at("✓ Mode initialized");const r=()=>Ze();(e=>{function t(a){if(!Ao)return void(Io=null);const n=a-Lo;if(Ko>n)return void(Io=requestAnimationFrame(t));Lo=a-n%Ko,(e=>{if(Oo.push(e),Oo.length>30&&Oo.shift(),30===Oo.length){const e=1e3/(Oo.reduce((e,t)=>e+t,0)/30);30>e&&2>Ro?(Ro++,console.log(`⚡ Adaptive throttle increased to level ${Ro} (avg FPS: ${e.toFixed(1)})`)):e>55&&Ro>0&&(Ro--,console.log(`⚡ Adaptive throttle decreased to level ${Ro} (avg FPS: ${e.toFixed(1)})`))}})(n);const o=a/1e3;let i=Math.min(.033,o-Do);Do=o,(2>Ro||Math.random()>.5)&&(async(e,t)=>{const a=d(),n=a.balls;if(!a.canvas)return;if(!n||0===n.length)return;const o=Math.max(0,Math.round(a.warmupFramesRemaining||0));if(o>0){a.warmupFramesRemaining=0,vn=0;for(let e=0;o>e;e++)Je(wn,t)}else Je(e,t)})(i,e),(()=>{const e=d(),t=e.ctx,a=e.balls,n=e.canvas;if(!t||!n)return;t.clearRect(0,0,n.width,n.height);const o=Ye();if(o&&o.preRender&&o.preRender(t),e.currentMode===ua.KALEIDOSCOPE||e.currentMode===ua.KALEIDOSCOPE_1||e.currentMode===ua.KALEIDOSCOPE_2||e.currentMode===ua.KALEIDOSCOPE_3)(e=>{const t=d();if(!Ae(t.currentMode))return;const a=t.canvas;if(!a)return;const n=(()=>{const e=performance.now(),t=dn||e;return dn=e,Ce((e-t)/1e3,0,.05)})(),o=t.balls,i=a.width,r=a.height,l=Pe(t),s=De(t).wedges??12,c=Ce(Math.round(s),3,24),p=!!(t.kaleidoscopeMirror??1),u=(e=>.5*e.width)(a),h=(e=>.5*e.height)(a),f=sn/c,m=Math.max(1e-5,1e-4*f),g=t.mouseInCanvas?t.mouseX:u,b=t.mouseInCanvas?t.mouseY:h,M=g-u,y=b-h,v=Math.atan2(y,M),x=Ce(Math.hypot(M,y)/Math.max(1,.5*Math.min(i,r)),0,1);t._||(t._={phase:{x:0,v:0},panX:{x:0,v:0},panY:{x:0,v:0},lastMouseX:g,lastMouseY:b,lastInCanvas:!!t.mouseInCanvas});const w=t._,S=!!t.mouseInCanvas,C=Math.hypot(g-w.lastMouseX,b-w.lastMouseY)>.5||S!==w.lastInCanvas,P=Ce(De(t).speed??1,.2,2),k=Ie(t),F=.65*P*k,T=M*F*(t.mouseInCanvas?1:0),D=y*F*(t.mouseInCanvas?1:0),L=.7*v*k*(t.mouseInCanvas?1:0);C?(w.lastMouseX=g,w.lastMouseY=b,w.lastInCanvas=S,Fe(w.phase,L,n,4.5),Fe(w.panX,T,n,5),Fe(w.panY,D,n,5)):(w.phase.v=0,w.panX.v=0,w.panY.v=0);const A=w.phase.x,I=w.panX.x,K=w.panY.x,O=.22+.18*Ce((P-.2)/1.8,0,1),R=1-O+2*O*(1-x);for(let d=0;o.length>d;d++){const t=o[d],a=t.x-u+I,n=t.y-h+K,i=3.5*l,r=Math.hypot(a,n)*i*R;if(cn>r)continue;const s=p?2*f:f;let g=Math.atan2(n,a)+A;g=(g%s+s)%s,p&&g>f&&(g=s-g),g=Ce(g,m,f-m);for(let o=0;c>o;o++){const a=o*f+g,n=u+Math.cos(a)*r,i=h+Math.sin(a)*r;1>t.alpha&&(e.globalAlpha=t.alpha),e.fillStyle=t.color,e.beginPath(),e.arc(n,i,t.r,0,sn),e.fill(),1>t.alpha&&(e.globalAlpha=1)}}})(t);else for(let i=0;a.length>i;i++)a[i].draw(t);o&&o.postRender&&o.postRender(t),(e=>{const t=d();if(!t?.mouseTrailEnabled)return;if(Xe())return;if(!e||!Mn||!hn)return;const a=performance.now(),n=qe(+(t.mouseTrailFadeMs??220),40,2e3),o=qe(+(t.mouseTrailOpacity??.35),0,1);if(0>=o)return;const i=t.DPR||1,r=qe(+(t.mouseTrailSize??1.3),.5,10)*i;for(;Mn>0&&a-gn[(bn-Mn+hn)%hn]>n;)Mn--;if(!Mn)return;if(2>Mn)return;const l=(()=>{const e=d();return e&&"string"==typeof e.cursorColorHex&&e.cursorColorHex?e.cursorColorHex:"#000000"})(),s=e.globalAlpha,c=e.globalCompositeOperation,p=e.lineCap,u=e.lineJoin,h=e.strokeStyle,f=e.lineWidth;e.globalCompositeOperation="source-over",e.lineCap="round",e.lineJoin="round",e.strokeStyle=l,e.lineWidth=r,e.globalAlpha=o;const m=Mn,g=(bn-m+hn)%hn;if(e.beginPath(),e.moveTo(fn[g],mn[g]),2===m)e.lineTo(fn[(g+1)%hn],mn[(g+1)%hn]);else{for(let a=1;m-1>a;a++){const t=(g+a)%hn,n=(g+a+1)%hn,o=fn[t],i=mn[t];e.quadraticCurveTo(o,i,.5*(o+fn[n]),.5*(i+mn[n]))}const t=(g+m-1)%hn;e.lineTo(fn[t],mn[t])}e.stroke(),e.globalAlpha=s,e.globalCompositeOperation=c,e.lineCap=p,e.lineJoin=u,e.strokeStyle=h,e.lineWidth=f})(t),((e,t,a)=>{const n=d(),o=(()=>{try{return getComputedStyle(document.documentElement).getPropertyValue("--wall-color").trim()||"#0a0a0a"}catch{return"#0a0a0a"}})(),i=(n.wallThickness||12)*(n.DPR||1);if(e.save(),e.fillStyle=o,Ua.bottom.hasDeformation()){e.beginPath(),e.moveTo(0,a+i);for(let n=0;Xa>=n;n++){const o=n/Xa,i=o*t,r=Ua.bottom.getDeformAt(o);e.lineTo(i,a-r)}e.lineTo(t,a+i),e.closePath(),e.fill()}if(Ua.top.hasDeformation()){e.beginPath(),e.moveTo(0,-i);for(let a=0;Xa>=a;a++){const n=a/Xa,o=n*t,i=Ua.top.getDeformAt(n);e.lineTo(o,i)}e.lineTo(t,-i),e.closePath(),e.fill()}if(Ua.left.hasDeformation()){e.beginPath(),e.moveTo(-i,0);for(let t=0;Xa>=t;t++){const n=t/Xa,o=n*a,i=Ua.left.getDeformAt(n);e.lineTo(i,o)}e.lineTo(-i,a),e.closePath(),e.fill()}if(Ua.right.hasDeformation()){e.beginPath(),e.moveTo(t+i,0);for(let n=0;Xa>=n;n++){const o=n/Xa,i=o*a,r=Ua.right.getDeformAt(o);e.lineTo(t-r,i)}e.lineTo(t+i,a),e.closePath(),e.fill()}e.restore()})(t,n.width,n.height)})(),(e=>{if(Fo++,e-ko>1e3){To=Fo,Fo=0,ko=e;const t=document.getElementById("render-fps");t&&(t.textContent=To+"")}})(performance.now()),Io=requestAnimationFrame(t)}document.addEventListener("visibilitychange",()=>{Ao=!document.hidden,Ao?(Do=performance.now()/1e3,Lo=performance.now(),console.log("▶️ Animation resumed"),Io||(Io=requestAnimationFrame(t))):(console.log("⏸️ Animation paused (tab hidden)"),Io&&(cancelAnimationFrame(Io),Io=null))}),Io=requestAnimationFrame(t),console.log("✓ Render loop started (60fps throttle, visibility-aware)")})((e,t)=>{const a=r();a&&a(e,t)}),nt("bb:end"),at("✅ Bouncy Balls running (modular)");const l=[{phase:"config",ms:ot("bb:m:config","bb:start","bb:config")},{phase:"renderer",ms:ot("bb:m:renderer","bb:config","bb:renderer")},{phase:"input",ms:ot("bb:m:input","bb:renderer","bb:input")},{phase:"ui",ms:ot("bb:m:ui","bb:input","bb:ui")},{phase:"theme",ms:ot("bb:m:theme","bb:ui","bb:theme")},{phase:"mode+loop",ms:ot("bb:m:mode","bb:theme","bb:mode")},{phase:"total",ms:ot("bb:m:total","bb:start","bb:end")}].filter(e=>"number"==typeof e.ms);l.length&&(t=>{if(Qe())try{Sn.table(t)}catch(e){}})(l.map(e=>({...e,ms:+e.ms.toFixed(2)}))),Qe()&&Sn.groupEnd();const p=400,h=3e3,f="cubic-bezier(0.16, 1, 0.3, 1)",m=p+h+750,g=(e,t)=>{e.style.opacity="1",console.warn(`⚠️ Fade failsafe: forcing #fade-content visible (${t})`)};setTimeout(()=>{const e=document.getElementById("fade-content");if(!e)return void console.warn("⚠️ #fade-content not found (fade skipped)");if(window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches)return e&&(e.style.opacity="1"),void console.log("✓ Page fade-in skipped (prefers-reduced-motion)");if(e&&"function"!=typeof e.animate)return void g(e,"WAAPI unsupported");const t=(e=>e&&"function"==typeof e.animate?e.animate([{opacity:0},{opacity:1}],{duration:h,easing:f,fill:"forwards"}):null)(e);t?.addEventListener?.("finish",()=>{e&&(e.style.opacity="1"),console.log("✓ Page fade-in finished")}),t?.addEventListener?.("cancel",()=>{e&&g(e,"animation canceled")}),console.log("✓ Page fade-in started (WAAPI)"),setTimeout(()=>{e&&"0"===window.getComputedStyle(e).opacity&&g(e,"opacity still 0 after failsafe window")},m)},p)}catch(t){console.error("❌ Initialization failed:",t),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${t.message}\n${t.stack}</pre>\n    </div>`}})(),e.applyFramePaddingCSSVars=()=>{s()},e.applyVisualCSSVars=pa})({});