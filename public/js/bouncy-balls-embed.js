!(function(e){function t(e,t=""){const a=(e+"").startsWith("--")?e:"--"+e,o=(()=>{try{if("undefined"==typeof window)return null;const e=window.__TOKENS__;return e&&"object"==typeof e?e:null}catch(e){return null}})(),n=(e=>{try{return"undefined"==typeof document?"":getComputedStyle(document.documentElement).getPropertyValue(e).trim()}catch(t){return""}})(a);if(n&&!n.includes("var("))return n;if(o){const e=((e,t)=>{const a=(e||"")+"";if(!a.includes("var("))return a.trim();if(!t)return a.trim();const o=/var\((--[a-z0-9-_]+)(?:\s*,\s*([^)]+))?\)/gi;let n=a,i=0;for(;n.includes("var(")&&8>i;)n=n.replace(o,(e,a,o)=>{const n=t.resolved?.[a]??t.cssVars?.[a];return null!=n?(n+"").trim():o?(o+"").trim():""}),i+=1;return n.trim()})(o.resolved?.[a]??o.cssVars?.[a]??n,o);if(e&&!e.includes("var("))return e}return n&&!n.includes("var(")?n:t}function a(e,a){const o=t(e,""),n=parseFloat(o);return Number.isFinite(n)?n:a}function o(e,a){const o=t(e,"");if(!o)return a;const n=parseFloat((o+"").replace(/px$/i,""));return Number.isFinite(n)?n:a}function n(e,a){const o=t(e,"");if(!o)return a;const n=(o+"").trim().toLowerCase(),i=parseFloat(n);return Number.isFinite(i)?n.endsWith("ms")?i:n.endsWith("s")?1e3*i:i:a}function i(e){ho=e}function r(e,t,a,o){const n=+e;return Number.isFinite(n)?Math.min(a,Math.max(t,n)):o}function l(e,t,a,o){const n=r(e,t,a,o);return Math.round(n)}function s(){const e=+fo.layoutViewportWidthPx;return Number.isFinite(e)&&e>0?e:Math.max(1,window.innerWidth||1)}function c(){try{const e=window.visualViewport;if(e&&"number"==typeof e.height&&e.height>0)return Math.max(1,e.height)}catch(e){}return Math.max(1,window.innerHeight||1)}function d(){return s()*c()}function p(e=64e4){const t=d();return t>0&&e>0?t/e:1}function u(e,t){const a=Math.max(1,t||s()),o=+e;return Number.isFinite(o)?o/a*100:0}function h(e,t){const a=Math.max(1,t||s()),o=+e;return Number.isFinite(o)?o/100*a:0}function f(){const e=s(),t=c(),a=Number.isFinite(fo.wallThicknessVw)&&fo.wallThicknessVw>0?fo.wallThicknessVw:0,o=a>0?a:Number.isFinite(fo.containerBorderVw)?fo.containerBorderVw:0;fo.containerBorderVw=o;const n=h(o,e),i=h(fo.simulationPaddingVw,e),r=h(fo.wallRadiusVw,e),l=Math.max(0,Math.round(fo.layoutMinWallRadiusPx||0)),d=h(a>0?a:o,e)*(1+(p()-1)*(Number.isFinite(fo.wallThicknessAreaMultiplier)&&fo.wallThicknessAreaMultiplier>=0?fo.wallThicknessAreaMultiplier:0)),u=fo.isMobile||fo.isMobileViewport?Math.max(.5,fo.mobileWallThicknessXFactor||1):1;fo.containerBorder=Math.round(n),fo.containerBorderX=Math.round(n*u),fo.simulationPadding=Math.round(i),fo.wallThickness=Math.round(d*u);const f=Math.max(1,Math.sqrt(e*t)),m=Number.isFinite(fo.contentPaddingRatio)?fo.contentPaddingRatio:0;fo.contentPadding=Math.round(fo.wallThickness+f*(Math.abs(m)>1?m/f:m));const g=Math.max(.1,fo.contentPaddingHorizontalRatio||1);fo.contentPaddingY=fo.contentPadding,fo.contentPaddingX=Math.round(fo.contentPadding*g),fo.wallRadius=Math.max(l,Math.round(r)),fo.cornerRadius=fo.wallRadius;const b=Math.max(0,h(fo.cursorInfluenceRadiusVw||0,e));fo.cursorInfluenceRadiusPx=Math.round(b),fo.repelRadius=Math.round(b),fo.weightlessRepelRadius=Math.round(b),fo.pingPongCursorRadius=Math.round(b),fo.bubblesDeflectRadius=Math.round(b)}function m(){const e=document.documentElement,t=fo.isMobile||fo.isMobileViewport,a=t?Math.max(.5,fo.mobileWallThicknessXFactor||1):1;e.style.setProperty("--container-border",fo.containerBorder+"px"),e.style.setProperty("--container-border-x",fo.containerBorderX+"px"),e.style.setProperty("--container-border-y",fo.containerBorder+"px"),e.style.setProperty("--simulation-padding",fo.simulationPadding+"px"),e.style.setProperty("--content-padding",fo.contentPadding+"px"),e.style.setProperty("--content-padding-x",fo.contentPaddingX+"px"),e.style.setProperty("--content-padding-y",fo.contentPaddingY+"px"),e.style.setProperty("--wall-radius",fo.wallRadius+"px"),e.style.setProperty("--wall-thickness",fo.wallThickness+"px");try{const t=s(),a=c(),o=Math.max(0,t*a),n=Math.sqrt(o);e.style.setProperty("--layout-viewport-area-px",Math.round(o)+""),e.style.setProperty("--layout-viewport-size-px",Math.round(n)+"px")}catch(r){}const o=fo.containerBorderVw||1.3;e.style.setProperty("--container-border-vw",""+o),e.style.setProperty("--container-border-x-vw",""+o*a),e.style.setProperty("--wall-thickness-vw",""+(Number.isFinite(fo.wallThicknessVw)&&fo.wallThicknessVw>0?fo.wallThicknessVw:fo.containerBorderVw)*a);const n=fo.edgeLabelInsetAdjustPx||0;e.style.setProperty("--edge-label-inset",fo.wallThickness+8+n+"px"),e.style.setProperty("--edge-label-inset-adjust",n+"px");const i=fo.wallThickness+fo.contentPadding;e.style.setProperty("--edge-inset",i+"px"),e.style.setProperty("--edge-inset-lg",i+"px"),e.style.setProperty("--edge-label-mobile-display",t&&fo.mobileEdgeLabelsVisible?"flex":"none"),e.style.setProperty("--ui-hit-area-mul",(fo.uiHitAreaMul??1)+""),e.style.setProperty("--ui-icon-corner-radius-mul",(fo.uiIconCornerRadiusMul??.4)+""),Number.isFinite(fo.uiIconFramePx)&&fo.uiIconFramePx>0?e.style.setProperty("--ui-icon-frame-size",Math.round(fo.uiIconFramePx)+"px"):e.style.removeProperty("--ui-icon-frame-size"),Number.isFinite(fo.uiIconGlyphPx)&&fo.uiIconGlyphPx>0?e.style.setProperty("--ui-icon-glyph-size",Math.round(fo.uiIconGlyphPx)+"px"):e.style.removeProperty("--ui-icon-glyph-size"),Number.isFinite(fo.uiIconGroupMarginPx)&&0!==fo.uiIconGroupMarginPx?e.style.setProperty("--ui-icon-group-margin",Math.round(fo.uiIconGroupMarginPx)+"px"):e.style.removeProperty("--ui-icon-group-margin")}function g(e){if(fo.config={...e},void 0!==e.layoutViewportWidthPx&&(fo.layoutViewportWidthPx=r(e.layoutViewportWidthPx,0,4096,0)),e.ballMass&&(fo.ballMassKg=e.ballMass),void 0!==e.gravityMultiplier&&(fo.gravityMultiplier=e.gravityMultiplier,fo.gravityMultiplierPit=e.gravityMultiplier),e.restitution&&(fo.REST=e.restitution),e.friction&&(fo.FRICTION=e.friction),void 0!==e.ballScale&&(fo.sizeScale=e.ballScale),void 0!==e.sizeScale&&(fo.sizeScale=e.sizeScale),void 0!==e.sizeVariationGlobalMul&&(fo.sizeVariationGlobalMul=r(e.sizeVariationGlobalMul,0,2,fo.sizeVariationGlobalMul)),void 0!==e.sizeVariationCap&&(fo.sizeVariationCap=r(e.sizeVariationCap,0,.2,fo.sizeVariationCap)),void 0!==e.sizeVariationPit&&(fo.sizeVariationPit=r(e.sizeVariationPit,0,1,fo.sizeVariationPit)),void 0!==e.sizeVariationPitThrows&&(fo.sizeVariationPitThrows=r(e.sizeVariationPitThrows,0,1,fo.sizeVariationPitThrows)),void 0!==e.sizeVariationFlies&&(fo.sizeVariationFlies=r(e.sizeVariationFlies,0,1,fo.sizeVariationFlies)),void 0!==e.sizeVariationWeightless&&(fo.sizeVariationWeightless=r(e.sizeVariationWeightless,0,1,fo.sizeVariationWeightless)),void 0!==e.sizeVariationWater&&(fo.sizeVariationWater=r(e.sizeVariationWater,0,1,fo.sizeVariationWater)),void 0!==e.sizeVariationVortex&&(fo.sizeVariationVortex=r(e.sizeVariationVortex,0,1,fo.sizeVariationVortex)),void 0!==e.sizeVariationPingPong&&(fo.sizeVariationPingPong=r(e.sizeVariationPingPong,0,1,fo.sizeVariationPingPong)),void 0!==e.sizeVariationMagnetic&&(fo.sizeVariationMagnetic=r(e.sizeVariationMagnetic,0,1,fo.sizeVariationMagnetic)),void 0!==e.sizeVariationBubbles&&(fo.sizeVariationBubbles=r(e.sizeVariationBubbles,0,1,fo.sizeVariationBubbles)),void 0!==e.sizeVariationKaleidoscope&&(fo.sizeVariationKaleidoscope=r(e.sizeVariationKaleidoscope,0,1,fo.sizeVariationKaleidoscope)),void 0!==e.sizeVariationOrbit3d&&(fo.sizeVariationOrbit3d=r(e.sizeVariationOrbit3d,0,1,fo.sizeVariationOrbit3d)),void 0!==e.sizeVariationCritters&&(fo.sizeVariationCritters=r(e.sizeVariationCritters,0,1,fo.sizeVariationCritters)),void 0!==e.sizeVariationNeural&&(fo.sizeVariationNeural=r(e.sizeVariationNeural,0,1,fo.sizeVariationNeural)),void 0!==e.sizeVariationLattice&&(fo.sizeVariationLattice=r(e.sizeVariationLattice,0,1,fo.sizeVariationLattice)),void 0!==e.sizeVariationParallaxLinear&&(fo.sizeVariationParallaxLinear=r(e.sizeVariationParallaxLinear,0,1,fo.sizeVariationParallaxLinear)),void 0!==e.sizeVariationParallaxPerspective&&(fo.sizeVariationParallaxPerspective=r(e.sizeVariationParallaxPerspective,0,1,fo.sizeVariationParallaxPerspective)),void 0!==e.sizeVariation&&(fo.sizeVariation=e.sizeVariation),Array.isArray(e.colorDistribution)){const t=e.colorDistribution,a=Array.isArray(fo.colorDistribution)?fo.colorDistribution:[],o=[];for(let e=0;7>e;e++){const n=a[e]||{},i=t[e]||{},r="string"==typeof i.label&&i.label.trim()?i.label.trim():"string"==typeof n.label?n.label:"Discipline "+(e+1),s=l(i.colorIndex,0,7,l(n.colorIndex,0,7,0)),c=l(i.weight,0,100,l(n.weight,0,100,0));o.push({label:r,colorIndex:s,weight:c})}fo.colorDistribution=o}if(void 0!==e.pitWarmupFrames&&(fo.pitWarmupFrames=l(e.pitWarmupFrames,0,240,fo.pitWarmupFrames)),void 0!==e.pitThrowsWarmupFrames&&(fo.pitThrowsWarmupFrames=l(e.pitThrowsWarmupFrames,0,240,fo.pitThrowsWarmupFrames)),void 0!==e.fliesWarmupFrames&&(fo.fliesWarmupFrames=l(e.fliesWarmupFrames,0,240,fo.fliesWarmupFrames)),void 0!==e.weightlessWarmupFrames&&(fo.weightlessWarmupFrames=l(e.weightlessWarmupFrames,0,240,fo.weightlessWarmupFrames)),void 0!==e.waterWarmupFrames&&(fo.waterWarmupFrames=l(e.waterWarmupFrames,0,240,fo.waterWarmupFrames)),void 0!==e.vortexWarmupFrames&&(fo.vortexWarmupFrames=l(e.vortexWarmupFrames,0,240,fo.vortexWarmupFrames)),void 0!==e.pingPongWarmupFrames&&(fo.pingPongWarmupFrames=l(e.pingPongWarmupFrames,0,240,fo.pingPongWarmupFrames)),void 0!==e.magneticWarmupFrames&&(fo.magneticWarmupFrames=l(e.magneticWarmupFrames,0,240,fo.magneticWarmupFrames)),void 0!==e.bubblesWarmupFrames&&(fo.bubblesWarmupFrames=l(e.bubblesWarmupFrames,0,240,fo.bubblesWarmupFrames)),void 0!==e.kaleidoscopeWarmupFrames&&(fo.kaleidoscopeWarmupFrames=l(e.kaleidoscopeWarmupFrames,0,240,fo.kaleidoscopeWarmupFrames)),void 0!==e.kaleidoscope1WarmupFrames&&(fo.kaleidoscope1WarmupFrames=l(e.kaleidoscope1WarmupFrames,0,240,fo.kaleidoscope1WarmupFrames)),void 0!==e.kaleidoscope2WarmupFrames&&(fo.kaleidoscope2WarmupFrames=l(e.kaleidoscope2WarmupFrames,0,240,fo.kaleidoscope2WarmupFrames)),void 0!==e.kaleidoscope3WarmupFrames&&(fo.kaleidoscope3WarmupFrames=l(e.kaleidoscope3WarmupFrames,0,240,fo.kaleidoscope3WarmupFrames)),void 0!==e.orbit3dWarmupFrames&&(fo.orbit3dWarmupFrames=l(e.orbit3dWarmupFrames,0,240,fo.orbit3dWarmupFrames)),void 0!==e.orbit3d2WarmupFrames&&(fo.orbit3d2WarmupFrames=l(e.orbit3d2WarmupFrames,0,240,fo.orbit3d2WarmupFrames)),void 0!==e.crittersWarmupFrames&&(fo.crittersWarmupFrames=l(e.crittersWarmupFrames,0,240,fo.crittersWarmupFrames)),void 0!==e.neuralWarmupFrames&&(fo.neuralWarmupFrames=l(e.neuralWarmupFrames,0,240,fo.neuralWarmupFrames)),void 0!==e.latticeWarmupFrames&&(fo.latticeWarmupFrames=l(e.latticeWarmupFrames,0,240,fo.latticeWarmupFrames)),void 0!==e.parallaxLinearWarmupFrames&&(fo.parallaxLinearWarmupFrames=l(e.parallaxLinearWarmupFrames,0,240,fo.parallaxLinearWarmupFrames)),void 0!==e.parallaxPerspectiveWarmupFrames&&(fo.parallaxPerspectiveWarmupFrames=l(e.parallaxPerspectiveWarmupFrames,0,240,fo.parallaxPerspectiveWarmupFrames)),S(),void 0!==e.maxBalls&&(fo.maxBalls=e.maxBalls),void 0!==e.repelRadius&&(fo.repelRadius=e.repelRadius),void 0!==e.repelPower&&(fo.repelPower=e.repelPower),void 0!==e.repelSoft&&(fo.repelSoft=e.repelSoft),void 0!==e.repelSoftness&&(fo.repelSoft=e.repelSoftness),void 0!==e.cursorInfluenceRadiusVw?fo.cursorInfluenceRadiusVw=r(e.cursorInfluenceRadiusVw,0,80,fo.cursorInfluenceRadiusVw):void 0!==e.repelRadius&&(fo.cursorInfluenceRadiusVw=r(e.repelRadius/10,0,80,fo.cursorInfluenceRadiusVw)),void 0!==e.responsiveScaleMobile&&(fo.responsiveScaleMobile=e.responsiveScaleMobile),void 0!==e.mobileObjectReductionFactor&&(fo.mobileObjectReductionFactor=r(e.mobileObjectReductionFactor,0,1,fo.mobileObjectReductionFactor)),x(),void 0!==e.kaleidoscopeBallCount&&(fo.kaleidoscopeBallCount=r(e.kaleidoscopeBallCount,10,300,fo.kaleidoscopeBallCount)),void 0!==e.kaleidoscopeDotSizeVh&&(fo.kaleidoscopeDotSizeVh=r(e.kaleidoscopeDotSizeVh,.1,6,fo.kaleidoscopeDotSizeVh)),void 0!==e.kaleidoscopeDotAreaMul&&(fo.kaleidoscopeDotAreaMul=r(e.kaleidoscopeDotAreaMul,.1,2,fo.kaleidoscopeDotAreaMul)),void 0!==e.kaleidoscopeSpawnAreaMul&&(fo.kaleidoscopeSpawnAreaMul=r(e.kaleidoscopeSpawnAreaMul,.2,2,fo.kaleidoscopeSpawnAreaMul)),void 0!==e.kaleidoscopeSizeVariance&&(fo.kaleidoscopeSizeVariance=r(e.kaleidoscopeSizeVariance,0,1,fo.kaleidoscopeSizeVariance)),void 0!==e.kaleidoscope1BallCount&&(fo.kaleidoscope1BallCount=r(e.kaleidoscope1BallCount,3,300,fo.kaleidoscope1BallCount)),void 0!==e.kaleidoscope1Wedges&&(fo.kaleidoscope1Wedges=r(e.kaleidoscope1Wedges,3,24,fo.kaleidoscope1Wedges)),void 0!==e.kaleidoscope1Speed&&(fo.kaleidoscope1Speed=r(e.kaleidoscope1Speed,.2,2,fo.kaleidoscope1Speed)),void 0!==e.kaleidoscope1DotSizeVh&&(fo.kaleidoscope1DotSizeVh=r(e.kaleidoscope1DotSizeVh,.1,6,fo.kaleidoscope1DotSizeVh)),void 0!==e.kaleidoscope1DotAreaMul&&(fo.kaleidoscope1DotAreaMul=r(e.kaleidoscope1DotAreaMul,.1,2,fo.kaleidoscope1DotAreaMul)),void 0!==e.kaleidoscope1SpawnAreaMul&&(fo.kaleidoscope1SpawnAreaMul=r(e.kaleidoscope1SpawnAreaMul,.2,2,fo.kaleidoscope1SpawnAreaMul)),void 0!==e.kaleidoscope1SizeVariance&&(fo.kaleidoscope1SizeVariance=r(e.kaleidoscope1SizeVariance,0,1,fo.kaleidoscope1SizeVariance)),void 0!==e.kaleidoscope2BallCount&&(fo.kaleidoscope2BallCount=r(e.kaleidoscope2BallCount,3,300,fo.kaleidoscope2BallCount)),void 0!==e.kaleidoscope2Wedges&&(fo.kaleidoscope2Wedges=r(e.kaleidoscope2Wedges,3,24,fo.kaleidoscope2Wedges)),void 0!==e.kaleidoscope2Speed&&(fo.kaleidoscope2Speed=r(e.kaleidoscope2Speed,.2,2,fo.kaleidoscope2Speed)),void 0!==e.kaleidoscope2DotSizeVh&&(fo.kaleidoscope2DotSizeVh=r(e.kaleidoscope2DotSizeVh,.1,6,fo.kaleidoscope2DotSizeVh)),void 0!==e.kaleidoscope2DotAreaMul&&(fo.kaleidoscope2DotAreaMul=r(e.kaleidoscope2DotAreaMul,.1,2,fo.kaleidoscope2DotAreaMul)),void 0!==e.kaleidoscope2SpawnAreaMul&&(fo.kaleidoscope2SpawnAreaMul=r(e.kaleidoscope2SpawnAreaMul,.2,2,fo.kaleidoscope2SpawnAreaMul)),void 0!==e.kaleidoscope2SizeVariance&&(fo.kaleidoscope2SizeVariance=r(e.kaleidoscope2SizeVariance,0,1,fo.kaleidoscope2SizeVariance)),void 0!==e.kaleidoscope3BallCount&&(fo.kaleidoscope3BallCount=r(e.kaleidoscope3BallCount,3,300,fo.kaleidoscope3BallCount)),void 0!==e.kaleidoscope3Wedges&&(fo.kaleidoscope3Wedges=r(e.kaleidoscope3Wedges,3,24,fo.kaleidoscope3Wedges)),void 0!==e.kaleidoscope3Speed&&(fo.kaleidoscope3Speed=r(e.kaleidoscope3Speed,.2,2,fo.kaleidoscope3Speed)),void 0!==e.kaleidoscope3DotSizeVh&&(fo.kaleidoscope3DotSizeVh=r(e.kaleidoscope3DotSizeVh,.1,6,fo.kaleidoscope3DotSizeVh)),void 0!==e.kaleidoscope3DotAreaMul&&(fo.kaleidoscope3DotAreaMul=r(e.kaleidoscope3DotAreaMul,.1,2,fo.kaleidoscope3DotAreaMul)),void 0!==e.kaleidoscope3SpawnAreaMul&&(fo.kaleidoscope3SpawnAreaMul=r(e.kaleidoscope3SpawnAreaMul,.2,2,fo.kaleidoscope3SpawnAreaMul)),void 0!==e.kaleidoscope3SizeVariance&&(fo.kaleidoscope3SizeVariance=r(e.kaleidoscope3SizeVariance,0,1,fo.kaleidoscope3SizeVariance)),void 0!==e.kaleidoscopeWedges?fo.kaleidoscopeWedges=r(e.kaleidoscopeWedges,3,24,fo.kaleidoscopeWedges):void 0!==e.kaleidoscopeSegments&&(fo.kaleidoscopeWedges=r(e.kaleidoscopeSegments,3,24,fo.kaleidoscopeWedges)),void 0!==e.kaleidoscopeMirror&&(fo.kaleidoscopeMirror=r(e.kaleidoscopeMirror,0,1,fo.kaleidoscopeMirror)),void 0!==e.kaleidoscopeSpeed)fo.kaleidoscopeSpeed=r(e.kaleidoscopeSpeed,.2,2,fo.kaleidoscopeSpeed);else if(void 0!==e.kaleidoscopeSwirlStrength){const t=r(e.kaleidoscopeSwirlStrength,0,800,52);fo.kaleidoscopeSpeed=r(.2+t/800*1.8,.2,2,fo.kaleidoscopeSpeed)}void 0!==e.critterCount&&(fo.critterCount=e.critterCount),void 0!==e.critterSpeed&&(fo.critterSpeed=e.critterSpeed),void 0!==e.critterMaxSpeed&&(fo.critterMaxSpeed=e.critterMaxSpeed),void 0!==e.critterStepHz&&(fo.critterStepHz=e.critterStepHz),void 0!==e.critterStepSharpness&&(fo.critterStepSharpness=e.critterStepSharpness),void 0!==e.critterTurnNoise&&(fo.critterTurnNoise=e.critterTurnNoise),void 0!==e.critterTurnDamp&&(fo.critterTurnDamp=e.critterTurnDamp),void 0!==e.critterTurnSeek&&(fo.critterTurnSeek=e.critterTurnSeek),void 0!==e.critterAvoidRadius&&(fo.critterAvoidRadius=e.critterAvoidRadius),void 0!==e.critterAvoidForce&&(fo.critterAvoidForce=e.critterAvoidForce),void 0!==e.critterEdgeAvoid&&(fo.critterEdgeAvoid=e.critterEdgeAvoid),void 0!==e.critterMousePull&&(fo.critterMousePull=e.critterMousePull),fo.layoutMinWallRadiusPx=void 0!==e.layoutMinWallRadiusPx?r(e.layoutMinWallRadiusPx,0,400,fo.layoutMinWallRadiusPx):o("--layout-min-wall-radius",fo.layoutMinWallRadiusPx),void 0!==e.critterMouseRadiusVw&&(fo.critterMouseRadiusVw=e.critterMouseRadiusVw),void 0!==e.critterRestitution&&(fo.critterRestitution=e.critterRestitution),void 0!==e.critterFriction&&(fo.critterFriction=e.critterFriction),void 0!==e.neuralBallCount&&(fo.neuralBallCount=r(e.neuralBallCount,8,260,fo.neuralBallCount)),void 0!==e.neuralLinkDistanceVw&&(fo.neuralLinkDistanceVw=r(e.neuralLinkDistanceVw,1,50,fo.neuralLinkDistanceVw)),void 0!==e.neuralLineOpacity&&(fo.neuralLineOpacity=r(e.neuralLineOpacity,0,1,fo.neuralLineOpacity)),void 0!==e.neuralWanderStrength&&(fo.neuralWanderStrength=r(e.neuralWanderStrength,0,4e3,fo.neuralWanderStrength)),void 0!==e.neuralMaxLinksPerBall&&(fo.neuralMaxLinksPerBall=r(e.neuralMaxLinksPerBall,0,16,fo.neuralMaxLinksPerBall)),void 0!==e.neuralDamping&&(fo.neuralDamping=r(e.neuralDamping,.8,1,fo.neuralDamping)),void 0!==e.latticeBallCount&&(fo.latticeBallCount=r(e.latticeBallCount,8,260,fo.latticeBallCount)),void 0!==e.latticeSpacingVw&&(fo.latticeSpacingVw=r(e.latticeSpacingVw,1,40,fo.latticeSpacingVw)),void 0!==e.latticeStiffness&&(fo.latticeStiffness=r(e.latticeStiffness,0,20,fo.latticeStiffness)),void 0!==e.latticeDamping&&(fo.latticeDamping=r(e.latticeDamping,.5,1,fo.latticeDamping)),void 0!==e.latticeDisruptRadius&&(fo.latticeDisruptRadius=r(e.latticeDisruptRadius,50,800,fo.latticeDisruptRadius)),void 0!==e.latticeDisruptPower&&(fo.latticeDisruptPower=r(e.latticeDisruptPower,0,20,fo.latticeDisruptPower)),void 0!==e.latticeMeshWaveStrength&&(fo.latticeMeshWaveStrength=r(e.latticeMeshWaveStrength,0,50,fo.latticeMeshWaveStrength)),void 0!==e.latticeMeshWaveSpeed&&(fo.latticeMeshWaveSpeed=r(e.latticeMeshWaveSpeed,0,3,fo.latticeMeshWaveSpeed)),void 0!==e.latticeAlignment&&(fo.latticeAlignment=e.latticeAlignment+""),void 0!==e.parallaxLinearDotCount&&(fo.parallaxLinearDotCount=r(e.parallaxLinearDotCount,20,220,fo.parallaxLinearDotCount)),void 0!==e.parallaxLinearGridJitter&&(fo.parallaxLinearGridJitter=r(e.parallaxLinearGridJitter,0,1,fo.parallaxLinearGridJitter)),void 0!==e.parallaxLinearFarSpeed&&(fo.parallaxLinearFarSpeed=r(e.parallaxLinearFarSpeed,0,1.5,fo.parallaxLinearFarSpeed)),void 0!==e.parallaxLinearMidSpeed&&(fo.parallaxLinearMidSpeed=r(e.parallaxLinearMidSpeed,0,1.5,fo.parallaxLinearMidSpeed)),void 0!==e.parallaxLinearNearSpeed&&(fo.parallaxLinearNearSpeed=r(e.parallaxLinearNearSpeed,0,1.5,fo.parallaxLinearNearSpeed)),void 0!==e.parallaxLinearGridX&&(fo.parallaxLinearGridX=l(e.parallaxLinearGridX,3,40,fo.parallaxLinearGridX)),void 0!==e.parallaxLinearGridY&&(fo.parallaxLinearGridY=l(e.parallaxLinearGridY,3,40,fo.parallaxLinearGridY)),void 0!==e.parallaxLinearGridZ&&(fo.parallaxLinearGridZ=l(e.parallaxLinearGridZ,2,20,fo.parallaxLinearGridZ)),void 0!==e.parallaxLinearSpanX&&(fo.parallaxLinearSpanX=r(e.parallaxLinearSpanX,.2,3,fo.parallaxLinearSpanX)),void 0!==e.parallaxLinearSpanY&&(fo.parallaxLinearSpanY=r(e.parallaxLinearSpanY,.2,3,fo.parallaxLinearSpanY)),void 0!==e.parallaxLinearZNear&&(fo.parallaxLinearZNear=r(e.parallaxLinearZNear,10,1200,fo.parallaxLinearZNear)),void 0!==e.parallaxLinearZFar&&(fo.parallaxLinearZFar=r(e.parallaxLinearZFar,50,3e3,fo.parallaxLinearZFar)),void 0!==e.parallaxLinearFocalLength&&(fo.parallaxLinearFocalLength=r(e.parallaxLinearFocalLength,80,2e3,fo.parallaxLinearFocalLength)),void 0!==e.parallaxLinearParallaxStrength&&(fo.parallaxLinearParallaxStrength=r(e.parallaxLinearParallaxStrength,0,2e3,fo.parallaxLinearParallaxStrength)),void 0!==e.parallaxLinearDotSizeMul&&(fo.parallaxLinearDotSizeMul=r(e.parallaxLinearDotSizeMul,.1,6,fo.parallaxLinearDotSizeMul)),void 0!==e.parallaxLinearFollowStrength&&(fo.parallaxLinearFollowStrength=r(e.parallaxLinearFollowStrength,1,80,fo.parallaxLinearFollowStrength)),void 0!==e.parallaxLinearDamping&&(fo.parallaxLinearDamping=r(e.parallaxLinearDamping,1,80,fo.parallaxLinearDamping)),void 0!==e.parallaxPerspectiveDotCount&&(fo.parallaxPerspectiveDotCount=r(e.parallaxPerspectiveDotCount,40,420,fo.parallaxPerspectiveDotCount)),void 0!==e.parallaxPerspectiveDepthMul&&(fo.parallaxPerspectiveDepthMul=r(e.parallaxPerspectiveDepthMul,.5,3,fo.parallaxPerspectiveDepthMul)),void 0!==e.parallaxPerspectiveFocalLength&&(fo.parallaxPerspectiveFocalLength=r(e.parallaxPerspectiveFocalLength,80,1e3,fo.parallaxPerspectiveFocalLength)),void 0!==e.parallaxPerspectiveFollowStrength&&(fo.parallaxPerspectiveFollowStrength=r(e.parallaxPerspectiveFollowStrength,1,40,fo.parallaxPerspectiveFollowStrength)),void 0!==e.parallaxPerspectiveDamping&&(fo.parallaxPerspectiveDamping=r(e.parallaxPerspectiveDamping,1,40,fo.parallaxPerspectiveDamping)),void 0!==e.parallaxPerspectiveZ1&&(fo.parallaxPerspectiveZ1=r(e.parallaxPerspectiveZ1,200,2e3,fo.parallaxPerspectiveZ1)),void 0!==e.parallaxPerspectiveZ2&&(fo.parallaxPerspectiveZ2=r(e.parallaxPerspectiveZ2,150,1500,fo.parallaxPerspectiveZ2)),void 0!==e.parallaxPerspectiveZ3&&(fo.parallaxPerspectiveZ3=r(e.parallaxPerspectiveZ3,100,1e3,fo.parallaxPerspectiveZ3)),void 0!==e.parallaxPerspectiveZ4&&(fo.parallaxPerspectiveZ4=r(e.parallaxPerspectiveZ4,40,600,fo.parallaxPerspectiveZ4)),void 0!==e.parallaxPerspectiveZ5&&(fo.parallaxPerspectiveZ5=r(e.parallaxPerspectiveZ5,10,300,fo.parallaxPerspectiveZ5)),void 0!==e.parallaxPerspectiveGridX&&(fo.parallaxPerspectiveGridX=l(e.parallaxPerspectiveGridX,3,50,fo.parallaxPerspectiveGridX)),void 0!==e.parallaxPerspectiveGridY&&(fo.parallaxPerspectiveGridY=l(e.parallaxPerspectiveGridY,3,50,fo.parallaxPerspectiveGridY)),void 0!==e.parallaxPerspectiveGridZ&&(fo.parallaxPerspectiveGridZ=l(e.parallaxPerspectiveGridZ,2,25,fo.parallaxPerspectiveGridZ)),void 0!==e.parallaxPerspectiveSpanX&&(fo.parallaxPerspectiveSpanX=r(e.parallaxPerspectiveSpanX,.2,3,fo.parallaxPerspectiveSpanX)),void 0!==e.parallaxPerspectiveSpanY&&(fo.parallaxPerspectiveSpanY=r(e.parallaxPerspectiveSpanY,.2,3,fo.parallaxPerspectiveSpanY)),void 0!==e.parallaxPerspectiveZNear&&(fo.parallaxPerspectiveZNear=r(e.parallaxPerspectiveZNear,10,1200,fo.parallaxPerspectiveZNear)),void 0!==e.parallaxPerspectiveZFar&&(fo.parallaxPerspectiveZFar=r(e.parallaxPerspectiveZFar,50,4e3,fo.parallaxPerspectiveZFar)),void 0!==e.parallaxPerspectiveParallaxStrength&&(fo.parallaxPerspectiveParallaxStrength=r(e.parallaxPerspectiveParallaxStrength,0,2e3,fo.parallaxPerspectiveParallaxStrength)),void 0!==e.parallaxPerspectiveRandomness&&(fo.parallaxPerspectiveRandomness=r(e.parallaxPerspectiveRandomness,0,1,fo.parallaxPerspectiveRandomness)),void 0!==e.parallaxPerspectiveDotSizeMul&&(fo.parallaxPerspectiveDotSizeMul=r(e.parallaxPerspectiveDotSizeMul,.1,6,fo.parallaxPerspectiveDotSizeMul));for(const[t,a]of Object.entries(e||{}))t in fo&&"config"!==t&&"soundConfig"!==t&&"soundPreset"!==t&&"function"!=typeof fo[t]&&(Array.isArray(a)||null===a||["string","number","boolean"].includes(typeof a))&&void 0!==a&&(fo[t]=a);if(void 0!==e.sceneImpactEnabled&&(fo.sceneImpactEnabled=!!e.sceneImpactEnabled),void 0!==e.sceneImpactMul?fo.sceneImpactMul=r(e.sceneImpactMul,0,.05,fo.sceneImpactMul):void 0!==e.brandLogoImpactMul&&(fo.sceneImpactMul=r(e.brandLogoImpactMul,0,.05,fo.sceneImpactMul)),void 0!==e.sceneImpactMobileMulFactor&&(fo.sceneImpactMobileMulFactor=r(e.sceneImpactMobileMulFactor,.25,3,fo.sceneImpactMobileMulFactor)),void 0!==e.sceneImpactLogoCompMul&&(fo.sceneImpactLogoCompMul=r(e.sceneImpactLogoCompMul,.25,6,fo.sceneImpactLogoCompMul)),void 0!==e.sceneImpactOvershoot?fo.sceneImpactOvershoot=r(e.sceneImpactOvershoot,0,.8,fo.sceneImpactOvershoot):void 0!==e.brandLogoOvershoot&&(fo.sceneImpactOvershoot=r(e.brandLogoOvershoot,0,.8,fo.sceneImpactOvershoot)),void 0!==e.sceneImpactAnticipation?fo.sceneImpactAnticipation=r(e.sceneImpactAnticipation,0,.6,fo.sceneImpactAnticipation):void 0!==e.brandLogoAnticipation&&(fo.sceneImpactAnticipation=r(e.brandLogoAnticipation,0,.6,fo.sceneImpactAnticipation)),void 0!==e.sceneImpactPressMs?fo.sceneImpactPressMs=r(e.sceneImpactPressMs,20,300,fo.sceneImpactPressMs):void 0!==e.brandLogoPressMs&&(fo.sceneImpactPressMs=r(e.brandLogoPressMs,20,300,fo.sceneImpactPressMs)),void 0!==e.sceneImpactReleaseMs?fo.sceneImpactReleaseMs=r(e.sceneImpactReleaseMs,40,1200,fo.sceneImpactReleaseMs):void 0!==e.brandLogoReleaseMs&&(fo.sceneImpactReleaseMs=r(e.brandLogoReleaseMs,40,1200,fo.sceneImpactReleaseMs)),void 0!==e.sceneChangeSoundEnabled&&(fo.sceneChangeSoundEnabled=!!e.sceneChangeSoundEnabled),void 0!==e.sceneChangeSoundIntensity&&(fo.sceneChangeSoundIntensity=r(e.sceneChangeSoundIntensity,0,1,fo.sceneChangeSoundIntensity)),void 0!==e.sceneChangeSoundRadius&&(fo.sceneChangeSoundRadius=r(e.sceneChangeSoundRadius,6,60,fo.sceneChangeSoundRadius)),void 0!==e.containerBorder&&(fo.containerBorder=e.containerBorder),void 0!==e.simulationPadding&&(fo.simulationPadding=e.simulationPadding),void 0!==e.contentPadding&&(fo.contentPadding=e.contentPadding),fo.bgLight=void 0!==e.bgLight?e.bgLight:t("--bg-light",fo.bgLight),fo.bgDark=void 0!==e.bgDark?e.bgDark:t("--bg-dark",fo.bgDark),fo.frameColorLight=void 0!==e.frameColorLight?e.frameColorLight:t("--frame-color-light",fo.frameColorLight),fo.frameColorDark=void 0!==e.frameColorDark?e.frameColorDark:t("--frame-color-dark",fo.frameColorDark),void 0!==e.frameColor?(fo.frameColor=e.frameColor,fo.frameColorLight=e.frameColor,fo.frameColorDark=e.frameColor):fo.frameColor=fo.frameColorLight,fo.textColorLight=void 0!==e.textColorLight?e.textColorLight:t("--text-color-light",fo.textColorLight),fo.textColorLightMuted=void 0!==e.textColorLightMuted?e.textColorLightMuted:t("--text-color-light-muted",fo.textColorLightMuted),fo.textColorDark=void 0!==e.textColorDark?e.textColorDark:t("--text-color-dark",fo.textColorDark),fo.textColorDarkMuted=void 0!==e.textColorDarkMuted?e.textColorDarkMuted:t("--text-color-dark-muted",fo.textColorDarkMuted),fo.edgeLabelColorLight=void 0!==e.edgeLabelColorLight?e.edgeLabelColorLight:t("--edge-label-color-light",fo.edgeLabelColorLight),fo.edgeLabelColorDark=void 0!==e.edgeLabelColorDark?e.edgeLabelColorDark:t("--edge-label-color-dark",fo.edgeLabelColorDark),void 0!==e.edgeLabelInsetAdjustPx&&(fo.edgeLabelInsetAdjustPx=r(e.edgeLabelInsetAdjustPx,-500,500,fo.edgeLabelInsetAdjustPx)),void 0!==e.topLogoWidthVw&&(fo.topLogoWidthVw=r(e.topLogoWidthVw,0,120,fo.topLogoWidthVw)),void 0!==e.homeMainLinksBelowLogoPx&&(fo.homeMainLinksBelowLogoPx=r(e.homeMainLinksBelowLogoPx,-500,500,fo.homeMainLinksBelowLogoPx)),void 0!==e.footerNavBarTopVh&&(fo.footerNavBarTopVh=r(e.footerNavBarTopVh,0,100,fo.footerNavBarTopVh)),void 0!==e.footerNavBarGapVw&&(fo.footerNavBarGapVw=r(e.footerNavBarGapVw,0,30,fo.footerNavBarGapVw)),fo.linkHoverColor=void 0!==e.linkHoverColor?e.linkHoverColor:t("--link-hover-color",fo.linkHoverColor),void 0!==e.uiHitAreaMul&&(fo.uiHitAreaMul=r(e.uiHitAreaMul,.5,3,fo.uiHitAreaMul)),void 0!==e.uiIconCornerRadiusMul&&(fo.uiIconCornerRadiusMul=r(e.uiIconCornerRadiusMul,0,1,fo.uiIconCornerRadiusMul)),fo.uiIconFramePx=l(void 0!==e.uiIconFramePx?e.uiIconFramePx:o("--ui-icon-frame-size",fo.uiIconFramePx),0,240,fo.uiIconFramePx),fo.uiIconGlyphPx=l(void 0!==e.uiIconGlyphPx?e.uiIconGlyphPx:o("--ui-icon-glyph-size",fo.uiIconGlyphPx),0,120,fo.uiIconGlyphPx),fo.uiIconGroupMarginPx=l(void 0!==e.uiIconGroupMarginPx?e.uiIconGroupMarginPx:o("--ui-icon-group-margin",fo.uiIconGroupMarginPx),-200,200,fo.uiIconGroupMarginPx),void 0!==e.linkTextPadding&&(fo.linkTextPadding=r(e.linkTextPadding,0,200,fo.linkTextPadding)),void 0!==e.linkIconPadding&&(fo.linkIconPadding=r(e.linkIconPadding,0,200,fo.linkIconPadding)),void 0!==e.linkColorInfluence&&(fo.linkColorInfluence=r(e.linkColorInfluence,0,1,fo.linkColorInfluence)),void 0!==e.linkImpactScale&&(fo.linkImpactScale=r(e.linkImpactScale,.5,1,fo.linkImpactScale)),void 0!==e.linkImpactBlur&&(fo.linkImpactBlur=r(e.linkImpactBlur,0,40,fo.linkImpactBlur)),void 0!==e.linkImpactDuration&&(fo.linkImpactDuration=l(e.linkImpactDuration,0,3e3,fo.linkImpactDuration)),fo.logoColorLight=void 0!==e.logoColorLight?e.logoColorLight:t("--logo-color-light",fo.logoColorLight),fo.logoColorDark=void 0!==e.logoColorDark?e.logoColorDark:t("--logo-color-dark",fo.logoColorDark),fo.portfolioLogoColorLight=void 0!==e.portfolioLogoColorLight?e.portfolioLogoColorLight:t("--portfolio-logo-color-light",fo.portfolioLogoColorLight),fo.portfolioLogoColorDark=void 0!==e.portfolioLogoColorDark?e.portfolioLogoColorDark:t("--portfolio-logo-color-dark",fo.portfolioLogoColorDark),void 0!==e.noiseBackOpacity&&(fo.noiseBackOpacity=r(e.noiseBackOpacity,0,.3,fo.noiseBackOpacity)),void 0!==e.noiseFrontOpacity&&(fo.noiseFrontOpacity=r(e.noiseFrontOpacity,0,.3,fo.noiseFrontOpacity)),void 0!==e.noiseBackOpacityDark&&(fo.noiseBackOpacityDark=r(e.noiseBackOpacityDark,0,.5,fo.noiseBackOpacityDark)),void 0!==e.noiseFrontOpacityDark&&(fo.noiseFrontOpacityDark=r(e.noiseFrontOpacityDark,0,.5,fo.noiseFrontOpacityDark)),void 0!==e.noiseEnabled&&(fo.noiseEnabled=!!e.noiseEnabled),void 0!==e.noiseSeed&&(fo.noiseSeed=l(e.noiseSeed,0,999999,fo.noiseSeed)),void 0!==e.noiseTextureSize&&(fo.noiseTextureSize=l(e.noiseTextureSize,64,512,fo.noiseTextureSize)),void 0!==e.noiseDistribution){const t=e.noiseDistribution+"";fo.noiseDistribution="uniform"===t||"gaussian"===t?t:fo.noiseDistribution}if(void 0!==e.noiseMonochrome&&(fo.noiseMonochrome=!!e.noiseMonochrome),void 0!==e.noiseChroma&&(fo.noiseChroma=r(e.noiseChroma,0,1,fo.noiseChroma)),void 0!==e.noiseMotion){const t=e.noiseMotion+"";fo.noiseMotion="jitter"===t||"drift"===t||"static"===t?t:fo.noiseMotion}void 0!==e.noiseMotionAmount&&(fo.noiseMotionAmount=r(e.noiseMotionAmount,0,2.5,fo.noiseMotionAmount)),void 0!==e.noiseSpeedBackMs&&(fo.noiseSpeedBackMs=l(e.noiseSpeedBackMs,0,1e4,fo.noiseSpeedBackMs)),void 0!==e.noiseSpeedFrontMs&&(fo.noiseSpeedFrontMs=l(e.noiseSpeedFrontMs,0,1e4,fo.noiseSpeedFrontMs)),void 0!==e.noiseFlicker&&(fo.noiseFlicker=r(e.noiseFlicker,0,1,fo.noiseFlicker)),void 0!==e.noiseFlickerSpeedMs&&(fo.noiseFlickerSpeedMs=l(e.noiseFlickerSpeedMs,0,5e3,fo.noiseFlickerSpeedMs)),void 0!==e.noiseBlurPx&&(fo.noiseBlurPx=r(e.noiseBlurPx,0,6,fo.noiseBlurPx)),void 0!==e.noiseContrast&&(fo.noiseContrast=r(e.noiseContrast,.25,5,fo.noiseContrast)),void 0!==e.noiseBrightness&&(fo.noiseBrightness=r(e.noiseBrightness,.25,3,fo.noiseBrightness)),void 0!==e.noiseSaturation&&(fo.noiseSaturation=r(e.noiseSaturation,0,3,fo.noiseSaturation)),void 0!==e.noiseHue&&(fo.noiseHue=r(e.noiseHue,0,360,fo.noiseHue)),void 0!==e.noiseSizeBase&&(fo.noiseSizeBase=r(e.noiseSizeBase,20,400,fo.noiseSizeBase)),void 0!==e.noiseSizeTop&&(fo.noiseSizeTop=r(e.noiseSizeTop,20,600,fo.noiseSizeTop)),void 0!==e.noiseTopOpacity&&(fo.noiseTopOpacity=r(e.noiseTopOpacity,0,.25,fo.noiseTopOpacity)),void 0!==e.detailNoiseOpacity&&(fo.detailNoiseOpacity=r(e.detailNoiseOpacity,0,1,fo.detailNoiseOpacity)),void 0!==e.wallThickness&&(fo.wallThickness=e.wallThickness),void 0!==e.wallRadius&&(fo.wallRadius=e.wallRadius,fo.cornerRadius=e.wallRadius),void 0!==e.wallInset&&(fo.wallInset=e.wallInset),void 0!==e.wallInset&&(fo.wallInset=e.wallInset),void 0!==e.ballSpacing&&(fo.ballSpacing=e.ballSpacing),void 0!==e.wallPreset&&(fo.wallPreset=e.wallPreset),void 0!==e.wallSoftness&&(fo.wallSoftness=e.wallSoftness),void 0!==e.wallBounciness&&(fo.wallBounciness=e.wallBounciness),void 0!==e.wallWobbleMaxDeform&&(fo.wallWobbleMaxDeform=e.wallWobbleMaxDeform),void 0!==e.wallWobbleStiffness&&(fo.wallWobbleStiffness=e.wallWobbleStiffness),void 0!==e.wallWobbleDamping&&(fo.wallWobbleDamping=e.wallWobbleDamping),void 0!==e.wallWobbleSigma&&(fo.wallWobbleSigma=e.wallWobbleSigma),void 0!==e.wallWobbleCornerClamp&&(fo.wallWobbleCornerClamp=e.wallWobbleCornerClamp),void 0!==e.wallWobbleMaxVel&&(fo.wallWobbleMaxVel=e.wallWobbleMaxVel),void 0!==e.wallWobbleMaxImpulse&&(fo.wallWobbleMaxImpulse=e.wallWobbleMaxImpulse),void 0!==e.wallWobbleMaxEnergyPerStep&&(fo.wallWobbleMaxEnergyPerStep=e.wallWobbleMaxEnergyPerStep),void 0!==e.wallWobbleImpactThreshold&&(fo.wallWobbleImpactThreshold=e.wallWobbleImpactThreshold),void 0!==e.wallWobbleSettlingSpeed&&(fo.wallWobbleSettlingSpeed=e.wallWobbleSettlingSpeed),void 0!==e.wallPhysicsSamples&&(fo.wallPhysicsSamples=e.wallPhysicsSamples),void 0!==e.wallPhysicsSkipInactive&&(fo.wallPhysicsSkipInactive=e.wallPhysicsSkipInactive),void 0!==e.wallPhysicsUpdateHz&&(fo.wallPhysicsUpdateHz=e.wallPhysicsUpdateHz),void 0!==e.wallPhysicsMaxSubstepHz&&(fo.wallPhysicsMaxSubstepHz=e.wallPhysicsMaxSubstepHz),void 0!==e.wallPhysicsInterpolation&&(fo.wallPhysicsInterpolation=e.wallPhysicsInterpolation),void 0!==e.wallPhysicsAdaptiveSamples&&(fo.wallPhysicsAdaptiveSamples=e.wallPhysicsAdaptiveSamples),void 0!==e.wallPhysicsMinSamples&&(fo.wallPhysicsMinSamples=e.wallPhysicsMinSamples),void 0!==e.wallVisualDeformMul&&(fo.wallVisualDeformMul=e.wallVisualDeformMul),void 0!==e.wallRenderDecimation&&(fo.wallRenderDecimation=e.wallRenderDecimation),void 0!==e.wallColorLight&&(fo.frameColorLight=e.wallColorLight,fo.frameColor=e.wallColorLight),void 0!==e.wallColorDark&&(fo.frameColorDark=e.wallColorDark,e.wallColorLight||(fo.frameColor=e.wallColorDark)),void 0!==e.gateOverlayEnabled&&(fo.gateOverlayEnabled=e.gateOverlayEnabled),void 0!==e.gateOverlayOpacity&&(fo.gateOverlayOpacity=e.gateOverlayOpacity),void 0!==e.gateOverlayBlurPx&&(fo.gateOverlayBlurPx=e.gateOverlayBlurPx),void 0!==e.gateOverlayTransitionMs&&(fo.gateOverlayTransitionMs=e.gateOverlayTransitionMs),void 0!==e.gateOverlayTransitionOutMs&&(fo.gateOverlayTransitionOutMs=e.gateOverlayTransitionOutMs),void 0!==e.orbit3dMoonCount&&(fo.orbit3dMoonCount=r(e.orbit3dMoonCount,1,1e3,fo.orbit3dMoonCount)),void 0!==e.orbit3dGravity&&(fo.orbit3dGravity=r(e.orbit3dGravity,1e3,5e5,fo.orbit3dGravity)),void 0!==e.orbit3dMoonMass&&(fo.orbit3dMoonMass=r(e.orbit3dMoonMass,.1,100,fo.orbit3dMoonMass)),void 0!==e.orbit3dVelocityMult&&(fo.orbit3dVelocityMult=r(e.orbit3dVelocityMult,10,1e3,fo.orbit3dVelocityMult)),void 0!==e.orbit3dTargetOrbit&&(fo.orbit3dTargetOrbit=r(e.orbit3dTargetOrbit,1,100,fo.orbit3dTargetOrbit)),void 0!==e.orbit3dMinOrbit&&(fo.orbit3dMinOrbit=r(e.orbit3dMinOrbit,1,100,fo.orbit3dMinOrbit)),void 0!==e.orbit3dMaxOrbit&&(fo.orbit3dMaxOrbit=r(e.orbit3dMaxOrbit,1,200,fo.orbit3dMaxOrbit)),void 0!==e.orbit3dDepthScale&&(fo.orbit3dDepthScale=r(e.orbit3dDepthScale,0,1.5,fo.orbit3dDepthScale)),void 0!==e.orbit3dDamping&&(fo.orbit3dDamping=r(e.orbit3dDamping,.01,.2,fo.orbit3dDamping)),void 0!==e.orbit3d2MoonCount&&(fo.orbit3d2MoonCount=r(e.orbit3d2MoonCount,1,300,fo.orbit3d2MoonCount)),void 0!==e.orbit3d2Gravity&&(fo.orbit3d2Gravity=r(e.orbit3d2Gravity,1e3,5e5,fo.orbit3d2Gravity)),void 0!==e.orbit3d2VelocityMult&&(fo.orbit3d2VelocityMult=r(e.orbit3d2VelocityMult,.1,2,fo.orbit3d2VelocityMult)),void 0!==e.orbit3d2MinOrbit&&(fo.orbit3d2MinOrbit=r(e.orbit3d2MinOrbit,1,50,fo.orbit3d2MinOrbit)),void 0!==e.orbit3d2MaxOrbit&&(fo.orbit3d2MaxOrbit=r(e.orbit3d2MaxOrbit,1,50,fo.orbit3d2MaxOrbit)),void 0!==e.orbit3d2DepthScale&&(fo.orbit3d2DepthScale=r(e.orbit3d2DepthScale,0,.95,fo.orbit3d2DepthScale)),void 0!==e.orbit3d2Damping&&(fo.orbit3d2Damping=r(e.orbit3d2Damping,0,1,fo.orbit3d2Damping)),void 0!==e.orbit3d2FollowSmoothing&&(fo.orbit3d2FollowSmoothing=r(e.orbit3d2FollowSmoothing,1,200,fo.orbit3d2FollowSmoothing)),void 0!==e.orbit3d2Softening&&(fo.orbit3d2Softening=r(e.orbit3d2Softening,1,100,fo.orbit3d2Softening));const n=s();if(void 0!==e.containerBorderVw&&(fo.containerBorderVw=r(e.containerBorderVw,0,20,fo.containerBorderVw)),void 0!==e.simulationPaddingVw&&(fo.simulationPaddingVw=r(e.simulationPaddingVw,0,20,fo.simulationPaddingVw)),void 0!==e.contentPaddingRatio){const t=+e.contentPaddingRatio;Number.isFinite(t)&&(fo.contentPaddingRatio=Math.abs(t)>1?r(t,-500,500,fo.contentPaddingRatio):r(t,-.2,.2,fo.contentPaddingRatio))}if(void 0!==e.contentPaddingHorizontalRatio&&(fo.contentPaddingHorizontalRatio=r(e.contentPaddingHorizontalRatio,.1,3,fo.contentPaddingHorizontalRatio)),void 0!==e.mobileWallThicknessXFactor&&(fo.mobileWallThicknessXFactor=r(e.mobileWallThicknessXFactor,.5,3,fo.mobileWallThicknessXFactor)),void 0!==e.mobileEdgeLabelsVisible&&(fo.mobileEdgeLabelsVisible=!!e.mobileEdgeLabelsVisible),void 0!==e.wallRadiusVw&&(fo.wallRadiusVw=r(e.wallRadiusVw,0,40,fo.wallRadiusVw)),void 0!==e.wallThicknessVw&&(fo.wallThicknessVw=r(e.wallThicknessVw,0,20,fo.wallThicknessVw)),void 0!==e.wallThicknessAreaMultiplier&&(fo.wallThicknessAreaMultiplier=r(e.wallThicknessAreaMultiplier,0,10,fo.wallThicknessAreaMultiplier)),!Number.isFinite(fo.containerBorderVw)||0>=fo.containerBorderVw){const e=a("--container-border-vw",null);Number.isFinite(e)&&e>0&&(fo.containerBorderVw=e)}if(!Number.isFinite(fo.wallRadiusVw)||0>=fo.wallRadiusVw){const e=a("--wall-radius-vw",null);Number.isFinite(e)&&e>0&&(fo.wallRadiusVw=e)}if(!Number.isFinite(fo.wallThicknessVw)||0>=fo.wallThicknessVw){const e=a("--wall-thickness-vw",null);Number.isFinite(e)&&e>0&&(fo.wallThicknessVw=e)}Number.isFinite(fo.containerBorderVw)&&fo.containerBorderVw>0||(fo.containerBorderVw=u(fo.containerBorder,n)),Number.isFinite(fo.simulationPaddingVw)&&fo.simulationPaddingVw>=0||(fo.simulationPaddingVw=u(fo.simulationPadding,n)),Number.isFinite(fo.wallRadiusVw)&&fo.wallRadiusVw>0||(fo.wallRadiusVw=u(fo.wallRadius,n)),Number.isFinite(fo.wallThicknessVw)&&fo.wallThicknessVw>0||(fo.wallThicknessVw=u(fo.wallThickness,n)),f()}function b(){return fo}function y(e){const t=b(),a=Math.round(+e||0);return Math.max(0,t.isMobile?Math.round(a*Math.max(0,Math.min(1,+(t.mobileObjectReductionFactor??.7)))):a)}function M(e,t,a){fo.canvas=e,fo.ctx=t,fo.container=a}function v(e){fo.currentMode=e}function w(){fo.balls.length=0}function x(){const e=navigator.userAgent||"",t=/iPad/.test(e)||/Mac/.test(e)&&navigator.maxTouchPoints>1,a=/iPhone/.test(e);let o=!1;try{o=!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(s){}const n=!(!t&&!a),i=o,r=n,l=n||o?fo.responsiveScaleMobile:1;if(fo.isMobile!==r||fo.isMobileViewport!==i||Math.abs((fo.responsiveScale??1)-l)>1e-6){fo.isMobile=r,fo.isMobileViewport=i,fo.responsiveScale=l,(fo.isMobile||fo.isMobileViewport)&&console.log(`✓ Mobile scaling active - ball scale: ${fo.responsiveScale}x (${fo.isMobile?"device":"viewport"})`),S();try{const e=(fo.R_MIN+fo.R_MAX)/2;if(Number.isFinite(e)&&e>0&&Array.isArray(fo.balls)&&fo.balls.length)for(let t=0;fo.balls.length>t;t++){const a=fo.balls[t];a&&(a.r=e,a.rBase=e)}}catch(s){}}}function S(){fo.R_MED=Math.max(1,(fo.R_MIN_BASE+fo.R_MAX_BASE)/2*fo.sizeScale*fo.responsiveScale);const e=r(fo.sizeVariationCap,0,.2,.12),t=r(fo.sizeVariationGlobalMul,0,2,1),a=r(e*t,0,.2,e);fo.R_MIN=Math.max(1,fo.R_MED*(1-a)),fo.R_MAX=Math.max(fo.R_MIN,fo.R_MED*(1+a))}function k(e){const t=+e;return Number.isFinite(t)?0>t?0:t>1?1:t:0}function C(e){const t=((e||"")+"").trim();if(!t)return null;const a="#"===t[0]?t.slice(1):t;if(3!==a.length&&6!==a.length)return null;const o=parseInt(3===a.length?a[0]+a[0]+a[1]+a[1]+a[2]+a[2]:a,16);return Number.isFinite(o)?{r:o>>16&255,g:o>>8&255,b:255&o}:null}function P({r:e,g:t,b:a}){return"#"+((255&e)<<16|(255&t)<<8|255&a).toString(16).padStart(6,"0")}function F(e,{satMul:t=0,valMul:a=0}={}){const o=C(e);if(!o)return((e||"")+"").trim()||"#ffffff";const n=(({r:e,g:t,b:a})=>{const o=k(e),n=k(t),i=k(a),r=Math.max(o,n,i),l=r-Math.min(o,n,i);let s=0;return l>0&&(s=r===o?(n-i)/l%6:r===n?(i-o)/l+2:(o-n)/l+4,s*=60,0>s&&(s+=360)),{h:s,s:r>0?l/r:0,v:r}})({r:o.r/255,g:o.g/255,b:o.b/255}),i=(e=>Math.max(0,Math.min(.88,+e||0)))(n.s*(1+(+t||0))),r=k(n.v*(1+(+a||0))),l=(({h:e,s:t,v:a})=>{const o=(+e%360+360)%360,n=k(t),i=k(a),r=i*n,l=r*(1-Math.abs(o/60%2-1)),s=i-r;let c=0,d=0,p=0;return 60>o?(c=r,d=l,p=0):120>o?(c=l,d=r,p=0):180>o?(c=0,d=r,p=l):240>o?(c=0,d=l,p=r):300>o?(c=l,d=0,p=r):(c=r,d=0,p=l),{r:c+s,g:d+s,b:p+s}})({h:n.h,s:i,v:r});return P({r:Math.round(255*l.r),g:Math.round(255*l.g),b:Math.round(255*l.b)})}function T(e,t,a){return Math.round(e+(t-e)*a)}function I(e,t,a){const o=k(a),n=C(e),i=C(t);return n||i?n?i?P({r:T(n.r,i.r,o),g:T(n.g,i.g,o),b:T(n.b,i.b,o)}):e+"":t+"":"#ffffff"}function D(e){const t=+e;return Number.isFinite(t)?0>t?0:t>255?255:t:0}function L(e,t,a=1){const o=Math.max(1,+a||1),n=C(e),i=C(t);return n||i?n&&i?P({r:D(n.r+(i.r-n.r)*o),g:D(n.g+(i.g-n.g)*o),b:D(n.b+(i.b-n.b)*o)}):t+"":"#ffffff"}function A(e,t,a=.5){const o=k(a),n=[,,,,,,,,];for(let i=0;8>i;i++)n[i]=I(e?.[i],t?.[i],o);return n}function K(e,t,a=1.25){const o=[,,,,,,,,];for(let i=0;8>i;i++)o[i]=t?.[i];const n=[3,5,6,7];for(let i=0;n.length>i;i++){const r=n[i];o[r]=L(e?.[r],t?.[r],a)}return o}function O(e,t){const a=[,,,,,,,,];for(let n=0;8>n;n++)a[n]=e?.[n];const o=[3,5,6,7];for(let n=0;o.length>n;n++){const e=o[n];a[e]=F(a[e],t)}return a}function W(e,t=.2){const a=[,,,,,,,,];for(let i=0;8>i;i++)a[i]=e?.[i];let o=-1,n=-1;for(let i=0;8>i;i++){const e=a[i];if(!e)continue;const t=$(e);t>n&&(n=t,o=i)}return 0>o||(a[o]=F(a[o],{satMul:t,valMul:0})),a}function z(e,t,a,o=t){const n=+e;if(!Number.isFinite(n))return o;const i=Math.floor(n);return t>i?t:i>a?a:i}function E(e,t,a){const o=+e;if(!Number.isFinite(o))return t;const n=Math.floor(o);return t>n?t:n>a?a:n}function R(e){return Array.isArray(e)&&e.every(e=>Number.isFinite(+e))}function B(e){const t=((e||"")+"").trim();if(!t)return null;const a="#"===t[0]?t.slice(1):t;if(3!==a.length&&6!==a.length)return null;const o=parseInt(3===a.length?a[0]+a[0]+a[1]+a[1]+a[2]+a[2]:a,16);return Number.isFinite(o)?{r:(o>>16&255)/255,g:(o>>8&255)/255,b:(255&o)/255}:null}function V(e){return e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92}function N(e){const t=B(e);return t?.2126*V(t.r)+.7152*V(t.g)+.0722*V(t.b):1}function $(e){const t=B(e);if(!t)return 0;const a=Math.max(t.r,t.g,t.b);return a>0?(a-Math.min(t.r,t.g,t.b))/a:0}function _(e,t){const a=t||b(),o=e&&e.length?e:[],n=Math.min(7,o.length-1);if(0>n)return[];const i=Number.isFinite(+a.cursorColorLumaMax)?+a.cursorColorLumaMax:.62,r=R(a.cursorColorAllowIndices)?a.cursorColorAllowIndices.map(e=>E(e,0,7)):[],l=R(a.cursorColorDenyIndices)?a.cursorColorDenyIndices.map(e=>E(e,0,7)):[],s=new Set(l),c=r.length?new Set(r):null,d=[];for(let u=0;n>=u;u++){if(s.has(u))continue;if(c&&!c.has(u))continue;const e=o[u];e&&(N(e)>i||.18>$(e)||d.push(u))}if(d.length)return d;const p=[];for(const u of Po)u>n||s.has(u)||c&&!c.has(u)||p.push(u);if(p.length)return p;for(let u=0;n>=u;u++)s.has(u)||c&&!c.has(u)||p.push(u);return p}function G(e,{forceMode:t}={}){const a=b(),o=a.currentColors,n=_(o,a),i=E(e,0,7),r=n.includes(i)?i:n[0]??i,l=((e,t)=>{const a=e&&e.length?e:[];return a[E(t,0,Math.max(0,Math.min(7,a.length-1)))]||"#000000"})(o,r);return t&&(a.cursorColorMode=t),a.cursorColorIndex=r,a.cursorColorHex=l,(e=>{try{document.documentElement.style.setProperty("--cursor-color",(e+"").trim()||"#000000")}catch(t){}})(l),{index:r,hex:l}}function H(){const e=b();if("auto"!==e.cursorColorMode)return G(e.cursorColorIndex,{forceMode:e.cursorColorMode}),!1;const t=_(e.currentColors,e);if(!t.length)return!1;const a=Number.isFinite(+e.o)?+e.o:-1;let o=t[Math.random()*t.length|0];return t.length>1&&o===a&&(o=t[Math.random()*t.length|0],o===a&&(o=t[(t.indexOf(a)+1)%t.length])),e.o=o,G(o,{forceMode:"auto"}),!0}function j(e){const t=b(),a=xo[e];return a?t.isDarkMode?a.dark:a.light:xo.industrialTeal.light}function Z(){const e=b(),t=e.currentColors;if(!t||0===t.length)return console.warn("No colors available, using fallback"),"#ffffff";const a=(e=>{const t=e?.colorDistribution;return Array.isArray(t)?t:null})(e);if(a&&a.length){let e=0;for(let t=0;a.length>t;t++){const o=+a[t]?.weight;Number.isFinite(o)&&o>0&&(e+=o)}if(e>0){let o=Math.random()*e;for(let e=0;a.length>e;e++){const n=a[e],i=+n?.weight;if(Number.isFinite(i)&&i>0&&(o-=i,0>=o))return t[z(n?.colorIndex,0,7,0)]||t[0]||"#ffffff"}const n=a[a.length-1];return t[z(n?.colorIndex,0,7,0)]||t[0]||"#ffffff"}}const o=Math.random();let n=0;const i=Math.min(t.length,8,8);for(let r=0;i>r;r++)if(n+=Co[r],n>=o)return t[r];return t[Math.min(t.length-1,7)]||"#ffffff"}function Y(e){const t=b();t.currentTemplate=e,t.currentColors=j(e);try{localStorage.setItem(ko,(e||"")+"")}catch(a){}try{const t=document.getElementById("colorSelect");t&&(t.value=e)}catch(a){}"auto"!==t.cursorColorMode&&"manual"!==t.cursorColorMode&&(t.cursorColorMode="auto"),G(t.cursorColorIndex,{forceMode:t.cursorColorMode}),(()=>{const e=b().balls;for(let t=0;e.length>t;t++)e[t].color=Z()})(),(e=>{try{const t=document.documentElement,a=(e&&e.length?e:[]).slice(0,8);for(let e=0;8>e;e++)t.style.setProperty("--ball-"+(e+1),a[e]||"#ffffff")}catch(a){}})(t.currentColors),(()=>{const e=b().currentColors;for(let t=1;8>=t;t++){const a=document.getElementById("color"+t),o=document.getElementById(`color${t}Val`);a&&e[t-1]&&(a.value=e[t-1],o&&(o.textContent=e[t-1].toUpperCase()))}})();try{window.dispatchEvent(new CustomEvent("bb:paletteChanged",{detail:{template:e}}))}catch(a){}}function X(){const e=document.getElementById("colorSelect");if(!e)return;e.innerHTML="";for(const a of So){const t=xo[a];if(!t)continue;const o=document.createElement("option");o.value=a,o.textContent=t.label,e.appendChild(o)}const t=b();e.value=t.currentTemplate}function U(){const e=b(),t=So.length?So:Object.keys(xo);if(!t.length)return null;let a=null;try{a=localStorage.getItem(ko)}catch(i){}const o="string"==typeof a?t.indexOf(a):-1,n=t[0>o?Math.random()*t.length|0:(o+1)%t.length];e.currentTemplate=n;try{localStorage.setItem(ko,n)}catch(i){}return n}function q(e,t=.15){return e*(1+2*(Math.random()-.5)*t)}function J(){try{"undefined"!=typeof window&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent(_o,{detail:re()}))}catch(e){}}function Q(){if(!Uo&&(Uo=!0,"undefined"!=typeof window&&window.matchMedia)){const e=window.matchMedia("(prefers-reduced-motion: reduce)");Yo=e.matches,e.addEventListener("change",e=>{Yo=e.matches})}}async function ee(){if($o)return!0;try{const e=window.AudioContext||window.webkitAudioContext;return e?(Ao=new e({latencyHint:"interactive",sampleRate:44100}),"suspended"===Ao.state&&await Ao.resume(),(()=>{Ko=Ao.createGain(),Ko.gain.value=Io.masterGain,Eo=Ao.createDynamicsCompressor(),Eo.threshold.value=-6,Eo.knee.value=10,Eo.ratio.value=16,Eo.attack.value=5e-4,Eo.release.value=.08,Bo=Ao.createBiquadFilter(),Bo.type="highshelf",Bo.frequency.value=Io.highShelfFreq,Bo.gain.value=Io.highShelfGain,Bo.Q.value=.7,Ro=Ao.createWaveShaper(),Ro.curve=((e=.55)=>{const t=1024,a=new Float32Array(t),o=1+8*e;for(let n=0;t>n;n++)a[n]=Math.tanh(o*(2*n/(t-1)-1))/Math.tanh(o);return a})(.55),Ro.oversample="2x",Wo=Ao.createGain(),Wo.gain.value=1-Io.reverbWetMix,zo=Ao.createGain(),zo.gain.value=Io.reverbWetMix,Oo=(()=>{const e=Ao.createGain(),t=Ao.createGain(),a=[.029,.037,.053,.067].map(e=>{const t=Ao.createDelay(.1);return t.delayTime.value=e*Io.reverbDecay,t}),o=a.map(()=>{const e=Ao.createGain();return e.gain.value=.4,e}),n=Ao.createBiquadFilter();return n.type="lowpass",n.frequency.value=2e3*(1-Io.reverbHighDamp),n.Q.value=.5,a.forEach((t,i)=>{e.connect(t),t.connect(o[i]),o[i].connect(n),o[i].connect(a[(i+1)%a.length])}),n.connect(t),e.connect(t),e.l=t,e})();const e=Oo.l;Wo.connect(Ro),zo.connect(Oo),e.connect(Ro),Ro.connect(Bo),Bo.connect(Eo),Eo.connect(Ko),Ko.connect(Ao.destination),(()=>{if(Ao){if(Vo)try{Vo.disconnect()}catch(e){}else Vo=Ao.createGain(),Vo.gain.value=1;Vo.connect(Eo||Ao.destination)}})(),(()=>{Ho=[];for(let e=0;Go>e;e++){const t={id:e,inUse:!1,startTime:0,filter:Ao.createBiquadFilter(),envelope:Ao.createGain(),panner:Ao.createStereoPanner(),reverbSend:Ao.createGain(),noiseFilter:Ao.createBiquadFilter(),noiseEnvelope:Ao.createGain(),osc:null,harmonicOsc:null,sparkleOsc:null,noiseSource:null};t.filter.type="lowpass",t.noiseFilter.type="bandpass",t.noiseFilter.Q.value=1.2,t.filter.connect(t.envelope),t.envelope.connect(t.panner),t.panner.connect(Wo),t.panner.connect(t.reverbSend),t.reverbSend.connect(zo),t.noiseFilter.connect(t.noiseEnvelope),t.noiseEnvelope.connect(t.panner),Ho.push(t)}})()})(),$o=!0,No=!0,J(),console.log(`✓ Audio unlocked (${(1e3*(Ao.baseLatency||0)).toFixed(1)}ms base latency)`),!0):(console.warn("Web Audio API not supported"),!1)}catch(e){return console.error("Failed to unlock audio:",e),!1}}function te(e,t,a=.5,o=null){if(!No||!$o||!Ao||Yo)return;if(Io.collisionMinImpact>t)return;const n=Ao.currentTime;if(.005>n-jo)return;if(null!==o){const e=Zo.get(o)||0;if(Io.minTimeBetweenSounds>n-e)return;Zo.set(o,n)}if(jo=n,Zo.size>200){const e=n-.5;for(const[t,a]of Zo)e>a&&Zo.delete(t)}const i=(()=>{for(let t=0;Go>t;t++)if(!Ho[t].inUse)return Ho[t];let e=Ho[0];for(let t=1;Go>t;t++)e.startTime>Ho[t].startTime&&(e=Ho[t]);return oe(e),e})();i&&((e,t,a,o,n)=>{e.inUse=!0,e.startTime=n;const i=Math.pow(Math.max(0,Math.min(1,a)),Io.intensityExponent),r=q(t,Io.variancePitch),l=q(Io.decayTime,Io.varianceDecay)*(1-i*(1-Io.velocityDecayScale)),s=l+.02;let c=Io.minGain+(Io.maxGain-Io.minGain)*i;c*=q(1,Io.varianceGain);const d=1+(Io.velocityBrightnessScale-1)*i;let p=Io.filterBaseFreq+Io.filterVelocityRange*Math.pow(i,1.3);p*=q(1,Io.varianceFilter)*d;const u=2*(o-.5)*Io.maxPan,h=.12+.5*(1-i);({gain:c,filterFreq:p}=((e,t,a)=>{const o=ne((e-Io.toneSafetyMinHz)/(Io.toneSafetyMaxHz-Io.toneSafetyMinHz),0,1),n=Io.toneSafetyExponent,i=Math.pow(o,n),r=ne(1-Io.toneSafetyHighGainAtten*i-Io.toneSafetyLowGainAtten*Math.pow(1-o,n),.6,1);let l=Math.min(t*r,Io.voiceGainMax);const s=ne(1-Io.toneSafetyHighBrightAtten*i,.55,1);return{gain:l,filterFreq:ne(a*s,Io.filterMinHz,Io.filterMaxHz)}})(r,c,p)),e.filter.frequency.value=p,e.filter.Q.value=Io.filterQ,e.panner.pan.value=u,e.reverbSend.gain.value=h,e.noiseFilter.Q.value=ne(Io.noiseTransientQ||1.2,.5,8),e.envelope.gain.cancelScheduledValues(n),e.envelope.gain.setValueAtTime(c,n),e.envelope.gain.exponentialRampToValueAtTime(.001,n+l);const f=Ao.createOscillator();if(f.type="sine",f.frequency.value=r,e.osc=f,f.connect(e.filter),(Io.harmonicGain||0)>.001){const t=Ao.createOscillator();t.type="sine",t.frequency.value=2*r;const a=Ao.createGain();a.gain.cancelScheduledValues(n),a.gain.setValueAtTime(c*Io.harmonicGain,n),a.gain.exponentialRampToValueAtTime(.001,n+l),e.harmonicOsc=t,t.connect(a),a.connect(e.filter),t.onended=()=>{try{a.disconnect()}catch(e){}},t.start(n),t.stop(n+s)}else e.harmonicOsc=null;if((Io.sparkleGain||0)>.001){const t=Ao.createOscillator();t.type="sine";const a=Io.sparkleRatioMin||2.3,o=Io.sparkleRatioMax||4.1,i=ne(a+Math.random()*(o-a),1.2,10);t.frequency.value=r*q(i,.02);const d=Ao.createGain(),p=Math.max(.012,l*ne(Io.sparkleDecayMul||.65,.25,.95));d.gain.cancelScheduledValues(n),d.gain.setValueAtTime(c*Io.sparkleGain,n),d.gain.exponentialRampToValueAtTime(.001,n+p),e.sparkleOsc=t,t.connect(d),d.connect(e.filter),t.onended=()=>{try{d.disconnect()}catch(e){}},t.start(n),t.stop(n+s)}else e.sparkleOsc=null;if(Io.noiseTransientEnabled&&i>.25){const t=(()=>{if(!Xo){const e=2*Ao.sampleRate;Xo=Ao.createBuffer(1,e,Ao.sampleRate);const t=Xo.getChannelData(0);let a=0,o=0,n=0;for(let i=0;e>i;i++){const e=2*Math.random()-1;a=.99765*a+.099046*e,o=.963*o+.2965164*e,n=.57*n+1.0526913*e,t[i]=.25*(a+o+n+.1848*e)}}const e=Ao.createBufferSource();return e.buffer=Xo,e.loopStart=1.5*Math.random(),e.loopEnd=e.loopStart+.1,e.loop=!1,e})();e.noiseSource=t;const a=Math.pow(i,1.4);e.noiseFilter.frequency.value=q(Io.noiseTransientFilterMin+(Io.noiseTransientFilterMax-Io.noiseTransientFilterMin)*a,Io.varianceNoise);const o=Io.noiseTransientGain*Io.velocityNoiseScale*a*c,r=q(Io.noiseTransientDecay,Io.varianceNoise);e.noiseEnvelope.gain.cancelScheduledValues(n),e.noiseEnvelope.gain.setValueAtTime(o,n),e.noiseEnvelope.gain.exponentialRampToValueAtTime(.001,n+r),t.connect(e.noiseFilter),t.start(n),t.stop(n+r+.01)}else e.noiseSource=null;f.start(n),f.stop(n+s),f.onended=()=>oe(e)})(i,(e=>{const t=1-ne((e-8)/47,0,1),a=ne(Io.pitchMinHz||145,40,6e3),o=ne(Io.pitchMaxHz||280,a+10,12e3),n=ne(Io.pitchCurve||1,.5,2.5);return(a+Math.pow(t,n)*(o-a))*q(1,1.5*(Io.variancePitch||.06))})(e),Math.max(0,Math.min(1,t)),a,n)}function ae({intensity:e=.82,radius:t=18,xPosition:a=.72}={}){te(t,e,a,null)}function oe(e){if(e.osc){try{e.osc.stop(),e.osc.disconnect()}catch(t){}e.osc=null}if(e.harmonicOsc){try{e.harmonicOsc.stop(),e.harmonicOsc.disconnect()}catch(t){}e.harmonicOsc=null}if(e.sparkleOsc){try{e.sparkleOsc.stop(),e.sparkleOsc.disconnect()}catch(t){}e.sparkleOsc=null}if(e.noiseSource){try{e.noiseSource.stop(),e.noiseSource.disconnect()}catch(t){}e.noiseSource=null}e.inUse=!1}function ne(e,t,a){return t>e?t:e>a?a:e}function ie(){return!!$o&&(No=!No,J(),No)}function re(){return{isUnlocked:$o,isEnabled:No,activeSounds:Ho.filter(e=>e.inUse).length,poolSize:Go}}function le(){return{...Io}}function se(e){for(const[t,a]of Object.entries(e))t in Io&&(Io[t]=a);zo&&Wo&&"reverbWetMix"in e&&(zo.gain.value=Io.reverbWetMix,Wo.gain.value=1-Io.reverbWetMix),Bo&&("highShelfFreq"in e||"highShelfGain"in e)&&(Bo.frequency.value=Io.highShelfFreq,Bo.gain.value=Io.highShelfGain),Ko&&"masterGain"in e&&(Ko.gain.value=Io.masterGain)}function ce(e){const t=Do[e];if(!t)return!1;Lo=e;const{label:a,description:o,...n}=t;return se(n),!0}function de(){return Lo}function pe(){const e=b(),t=e.balls,a=e.canvas,o=e.R_MAX,n=e.ballSpacing||0,i=t.length;if(Jo.length=0,2>i)return Jo;const r=!1!==e.physicsSpatialGridOptimization;if(r){let e=!1;for(let a=0;i>a;a++){const o=t[a];if(o&&!o.isSleeping){e=!0;break}}if(!e)return Jo}const l=Math.max(1,2*o*(1+n)),s=Math.ceil(a.width/l)+1;if(r)for(const c of qo.values())c.length=0;else qo.clear();for(let c=0;i>c;c++){const e=t[c],a=(e.y/l|0)*s+(e.x/l|0);let o=qo.get(a);o||(o=[],qo.set(a,o)),o.push(c)}for(const[c,d]of qo){if(0===d.length)continue;const e=c/s|0,a=c%s;for(let o=-1;1>=o;o++)for(let i=-1;1>=i;i++){const r=qo.get((e+o)*s+(a+i));if(r&&0!==r.length)for(let e=0;d.length>e;e++){const a=d[e];for(let e=0;r.length>e;e++){const o=r[e];if(a>=o)continue;const i=t[a],l=t[o],s=l.x-i.x,c=l.y-i.y,d=i.r+l.r+(i.r+l.r)/2*n,p=s*s+c*c;if(d*d>p){const e=d-Math.sqrt(Math.max(p,so.MIN_DISTANCE_EPSILON)),t=Jo.length;let n=Qo[t];n||(n={i:0,j:0,overlap:0},Qo[t]=n),n.i=a,n.j=o,n.overlap=e,Jo.push(n)}}}}}return Jo.sort((e,t)=>t.overlap-e.overlap),Jo}function ue(e=10){const t=b(),a=t.balls,o=pe(),n=t.REST,i=.5*t.DPR,r=t.ballSpacing||0,l=!!t.physicsSkipSleepingCollisions;for(let s=0;e>s;s++)for(let e=0;o.length>e;e++){const{i:c,j:d}=o[e],p=a[c],u=a[d],h=u.x-p.x,f=u.y-p.y,m=p.r+u.r+(p.r+u.r)/2*r,g=h*h+f*f;if(0===g||g>m*m)continue;const b=Math.sqrt(g),y=h/b,M=f/b,v=m-b,w=1/Math.max(p.m,.001),x=1/Math.max(u.m,.001),S=p.isSleeping&&u.isSleeping,k=.8*Math.max(v-i,0)/(w+x),C=k*y,P=k*M;p.x-=C*w,p.y-=P*w,u.x+=C*x,u.y+=P*x;const F="pit"===t.currentMode||"pit-throws"===t.currentMode;if(F&&-.3>M?u.hasSupport=!0:F&&M>.3&&(p.hasSupport=!0),l&&S)continue;if(S)continue;const T=u.vx-p.vx,I=u.vy-p.vy,D=T*y+I*M,L=-15*(t.DPR||1)>D;if((!p.isSleeping||L)&&(!u.isSleeping||L)&&(p.isSleeping&&p.wake(),u.isSleeping&&u.wake(),0>D)){const e=-(1+(30>Math.abs(D)?0:n))*D/(w+x),a=e*y,o=e*M;p.vx-=a*w,p.vy-=o*w,u.vx+=a*x,u.vy+=o*x;const i=T-D*y,r=I-D*M,l=Math.hypot(i,r);if(l>.001){const e=0>i*-M+r*y?-1:1,t=so.SPIN_GAIN_TANGENT;p.omega-=e*t*l/Math.max(p.r,1),u.omega+=e*t*l/Math.max(u.r,1)}const d=Math.min(1,Math.abs(D)/(50*(p.r+u.r))),h=Math.min(t.getSquashMax(),.8*d);p.squashAmount=Math.max(p.squashAmount,.8*h),p.squashNormalAngle=Math.atan2(-M,-y),u.squashAmount=Math.max(u.squashAmount,.8*h),u.squashNormalAngle=Math.atan2(M,y),0===s&&te((p.r+u.r)/2,d,(p.x+u.x)/2/(t.canvas?.width||1),`${c}-${e}`)}}}function he(){try{const e=document.documentElement,t=document.body,a=document.getElementById("bravia-balls"),o=(e,t)=>{if(!e)return"";try{return getComputedStyle(e).getPropertyValue(t).trim()||getComputedStyle(e).getPropertyValue(t).trim()}catch(a){return""}};let n=o(e,"--wall-color");return n||(n=e.classList.contains("dark-mode")||t.classList.contains("dark-mode")?o(e,"--wall-color-dark")||o(e,"--frame-color-dark"):o(e,"--wall-color-light")||o(e,"--frame-color-light")),n||(n=o(t,"--wall-color")||o(a,"--wall-color")),n||"#0a0a0a"}catch{return"#0a0a0a"}}function fe(e,t,a){return t>e?t:e>a?a:e}function me(e,t,a){return e+(t-e)*a}function ge(e,t){switch(t){case io.PIT:return e.sizeVariationPit??0;case io.PIT_THROWS:return e.sizeVariationPitThrows??0;case io.FLIES:return e.sizeVariationFlies??0;case io.WEIGHTLESS:return e.sizeVariationWeightless??0;case io.WATER:return e.sizeVariationWater??0;case io.VORTEX:return e.sizeVariationVortex??0;case io.PING_PONG:return e.sizeVariationPingPong??0;case io.MAGNETIC:return e.sizeVariationMagnetic??0;case io.BUBBLES:return e.sizeVariationBubbles??0;case io.KALEIDOSCOPE:case io.KALEIDOSCOPE_1:case io.KALEIDOSCOPE_2:case io.KALEIDOSCOPE_3:return e.sizeVariationKaleidoscope??0;case io.ORBIT_3D:return e.sizeVariationOrbit3d??0;case io.ORBIT_3D_2:return e.sizeVariationOrbit3d2??0;case io.CRITTERS:return e.sizeVariationCritters??0;case io.NEURAL:return e.sizeVariationNeural??0;case io.LATTICE:return e.sizeVariationLattice??0;case io.PARALLAX_LINEAR:return e.sizeVariationParallaxLinear??0;case io.PARALLAX_PERSPECTIVE:return e.sizeVariationParallaxPerspective??0;default:return 0}}function be(e,t){const a=fe(+(e.sizeVariationCap??.12),0,dn),o=fe(+(e.sizeVariationGlobalMul??1),0,2),n=fe(+(ge(e,t)??0),0,1);return fe(a*o*n,0,dn)}function ye(e,t){const a=Number.isFinite(e?.R_MIN)?Math.max(1,e.R_MIN):0,o=Number.isFinite(e?.R_MAX)?Math.max(a||1,e.R_MAX):0;if(a>0&&o>0)return fe(t,a,o);const n=Math.max(1,e?.R_MED||t||1);return fe(t,.8*n,1.2*n)}function Me(e,t){const{minR:a,maxR:o,medR:n}=((e,t)=>{const a=Math.max(1,e.R_MED||.5*(e.R_MIN+e.R_MAX)||10),o=fe(+(e.sizeVariationCap??.12),0,dn),n=fe(+(e.sizeVariationGlobalMul??1),0,2),i=fe(+(ge(e,t)??0),0,1),r=fe(o*n*i,0,dn);return{minR:Math.max(1,a*(1-r)),maxR:Math.max(1,a*(1+r)),medR:a}})(e,t);return 1e-6>o-a?n:me(a,o,Math.random())}function ve(e){const t=b().waterRippleSpeed||300;for(let a=pn.length-1;a>=0;a--){const o=pn[a];o.radius+=t*e,o.age+=e,o.strength*=.96,(o.age>3||10>o.strength)&&pn.splice(a,1)}}function we(e,t,a=1){const o=b();pn.push({x:e,y:t,radius:0,strength:(o.waterRippleStrength||15e3)*Math.min(a,5),age:0})}function xe(e,t,a){a||(a=Z());const o=b(),n=Me(o,o.currentMode||io.PIT),i=new cn(e,t,n,a),r=.5*o.canvas.width>e?1:-1,l=Math.max(.6,Math.min(1.4,n/(.5*(o.R_MIN+o.R_MAX)))),s=180*l;return i.vx=r*(140*l+Math.random()*s),i.vy=120*-Math.random(),i.driftAx=r*(360+420*Math.random())*l,i.driftTime=.22+.28*Math.random(),o.balls.push(i),i}function Se(e,t,a){return Math.max(t,Math.min(a,e))}function ke(e,t){return e+Math.random()*(t-e)}function Ce(e){e.spawnedTotal=1+(0|e.spawnedTotal)}function Pe(e,t,a,{speedMul:o=1,spreadMul:n=1}={}){const i=e.canvas.width,r=e.canvas.height,l=e.DPR,s=(e.wallThickness||20)*l,c=Math.max(1,i-2*s),d=.35*-r,p=.05*-r,u=Se(e.pitThrowInletInset??.06,0,.2),h=0===a?s+c*u:i-s-c*u,f=Se(e.pitThrowSpawnSpread??.02,0,.12),m=Se(f*n,0,.18),g=h+ke(-c*m,c*m),b=ke(d,p),y=Se(e.pitThrowTargetYFrac??.36,.12,.7),M=Se(e.pitThrowCrossBias??.12,0,.35),v=Se(e.pitThrowAimJitter??.04,0,.2),w=Se(v*n,0,.25),x=i*(.5+(0===a?M:-M)+ke(-w,w)),S=r*y,k=Se(e.pitThrowSpeed??650,50,4e3)*l,C=Se(e.pitThrowSpeedJitter??.22,0,.8),P=Se(e.pitThrowAngleJitter??.16,0,.8),F=xe(g,b,t),T=x-g,I=S-b,D=Math.max(1e-4,Math.sqrt(T*T+I*I));let L=T/D,A=I/D;const K=ke(-Math.PI,Math.PI)*P,O=Math.cos(K),W=Math.sin(K),z=L*W+A*O;L=L*O-A*W,A=z;const E=k*o*(1+ke(-C,C));return F.vx=L*E,F.vy=A*E,F.driftAx=0,F.driftTime=0,F}function Fe(e){const t=b();if(!t||"pit-throws"!==t.currentMode)return;const a=Math.max(0,y(t.maxBalls??300));if(0>=a)return;if(t.balls.length>=a)return;const o=t.p;if(!o)return;const n=Se(t.pitThrowIntervalMs??70,10,2e3)/1e3,i=Se(t.pitThrowBatchSize??12,1,100),r=Se(t.pitThrowColorPauseMs??400,0,3e3)/1e3,l=Se(t.pitThrowPairChance??.35,0,1),s=Se(t.pitThrowPairStaggerMs??18,0,300)/1e3,c=Se(t.pitThrowSpeedVar??.18,0,1),d=Se(t.pitThrowSpreadVar??.25,0,1);o.cooldown-=e,0>o.cooldown&&(o.cooldown=0);let p=0;for(0>o.queueA||(o.queueA-=e),0>o.queueB||(o.queueB-=e);6>p&&a>t.balls.length;){let e=!1;if(o.queueA>=0&&0>=o.queueA){const a=1+ke(-c,c),n=1+ke(-d,d);Pe(t,o.queueColorA,o.queueSideA,{speedMul:a,spreadMul:n}),o.queueA=-1,p++,e=!0}if(p>=6||t.balls.length>=a)break;if(o.queueB>=0&&0>=o.queueB){const a=1+ke(-c,c),n=1+ke(-d,d);Pe(t,o.queueColorB,o.queueSideB,{speedMul:a,spreadMul:n}),o.queueB=-1,p++,e=!0}if(!e)break}if(0>=o.cooldown)for(o.batchPaused&&(o.batchPaused=!1,o.batchCount=0,o.side=1-o.side);6>p&&a>t.balls.length;){if(r>0&&o.batchCount>=i){o.cooldown=r,o.batchPaused=!0;break}const e=o.side,u=1+ke(-c,c),h=1+ke(-d,d);if(Pe(t,Ce(o),e,{speedMul:u,spreadMul:h}),p++,o.batchCount++,l>Math.random()&&a>t.balls.length&&i>o.batchCount){const t=Ce(o);0>o.queueA&&(o.queueA=s,o.queueColorA=t,o.queueSideA=e,o.batchCount++)}o.cooldown=n;break}}function Te(e){yn=e}function Ie(){if(un=document.getElementById("c"),!un)return void console.error("Canvas not found");hn=un.getContext("2d",{alpha:!0,desynchronized:!0,willReadFrequently:!1}),hn||(hn=un.getContext("2d"),console.warn("⚠️ Desynchronized mode unavailable, using standard context")),(()=>{const e=window.devicePixelRatio||1;(navigator.connection?.saveData||4>=navigator.hardwareConcurrency||/Android|iPhone|iPad|iPod/i.test(navigator.userAgent))&&e>1.5?(fn=1.5,console.log("⚡ Adaptive DPR: Reduced to 1.5x for performance")):fn=Math.min(e,2),i(fn)})(),hn.imageSmoothingEnabled=!1;const e=()=>{bn&&cancelAnimationFrame(bn),bn=requestAnimationFrame(()=>{De(),bn=null})};if(window.addEventListener("resize",e),window.addEventListener("orientationchange",()=>{setTimeout(De,100),setTimeout(De,300)}),window.visualViewport&&(window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e)),"undefined"!=typeof ResizeObserver){const t=document.getElementById("bravia-balls");t&&new ResizeObserver(()=>{e()}).observe(t)}console.log(`✓ Renderer optimized (DPR: ${fn.toFixed(2)}, desync: ${hn.getContextAttributes?.()?.desynchronized??"unknown"})`)}function De(){if(!un)return;const e=b();try{const e=window.visualViewport,t=e&&"number"==typeof e.height?e.height:window.innerHeight,a=e&&"number"==typeof e.width?e.width:window.innerWidth,o=t>0?t:window.innerHeight,n=a>0?a:window.innerWidth,i=e&&"number"==typeof e.offsetTop?e.offsetTop:0,r=e&&"number"==typeof e.offsetLeft?e.offsetLeft:0,l=Number.isFinite(i)?i:0,s=Number.isFinite(r)?r:0;let c=l+o/2,d=s+n/2;d>0||(d=window.innerWidth/2),c>0||(c=window.innerHeight/2);const p=document.documentElement?.style;p?.setProperty("--abs-viewport-h",o+"px"),p?.setProperty("--abs-vv-offset-top",l+"px"),p?.setProperty("--abs-vv-offset-left",s+"px"),p?.setProperty("--abs-vv-h",o+"px"),p?.setProperty("--abs-vv-w",n+"px"),p?.setProperty("--abs-vv-center-x",d+"px"),p?.setProperty("--abs-vv-center-y",c+"px")}catch(d){}try{f(),m()}catch(d){}try{x()}catch(d){}const t=e.container||document.getElementById("bravia-balls"),a=t?t.clientWidth:window.innerWidth,o=t?t.clientHeight:window.innerHeight;if(0>=a||0>=o)return;const n=a,i=o,r=fn,l=Math.floor(n*r),s=Math.floor(i*r);if(0>=l||0>=s)return;if(l===mn&&s===gn)return;if(mn>0&&gn>0&&e.balls&&e.balls.length>0){const t=l/mn,a=s/gn;if(t>.1&&10>t&&a>.1&&10>a){const o=e.balls;for(let e=0;o.length>e;e++){const n=o[e];if(!n)continue;n.x*=t,n.y*=a;const i=n.r||10;n.x=Math.max(i,Math.min(l-i,n.x)),n.y=Math.max(i,Math.min(s-i,n.y)),n.isSleeping&&(n.isSleeping=!1,n.sleepTimer=0)}}}mn=l,gn=s;const c=un.width!==l||un.height!==s;if(c&&(un.width=l,un.height=s,hn&&(hn.imageSmoothingEnabled=!1)),un.style.width=n+"px",un.style.height=i+"px",c&&((e=>{e.style.filter=""})(un),yn))try{yn()}catch(d){}try{const t=0;(un.width!==Mn||un.height!==vn||Math.abs(t-wn)>.001)&&(Mn=un.width,vn=un.height,wn=t,e.canvasClipPath=((e,t,a)=>{const o=Math.max(0,Math.min(a,.5*Math.min(e,t)));if("undefined"==typeof Path2D)return null;const n=new Path2D;return o>0?(n.moveTo(o,0),n.lineTo(e-o,0),n.arcTo(e,0,e,o,o),n.lineTo(e,t-o),n.arcTo(e,t,e-o,t,o),n.lineTo(o,t),n.arcTo(0,t,0,t-o,o),n.lineTo(0,o),n.arcTo(0,0,o,0,o),n.closePath(),n):(n.rect(0,0,e,t),n)})(un.width,un.height,t))}catch(d){}}function Le(){return un}function Ae(){const e=b();if(e.currentMode===io.MAGNETIC)for(let t=0;e.balls.length>t;t++)e.balls[t].alpha=1}function Ke(e,t,a,o=!1){const n=b(),i=n.DPR||1,r=Me(n,io.BUBBLES),l=new cn(e,t,o?r:.1,a);return l.isBubble=!0,l.baseRadius=r,l.targetRadius=r,l.wobblePhase=Math.random()*Math.PI*2,l.wobbleFreq=2+3*Math.random(),l.vx=20*(Math.random()-.5)*i,l.vy=(-50-50*Math.random())*i,l.spawning=!o,l.spawnProgress=o?1:0,l.dissipating=!1,l.dissipateProgress=0,l.alpha=1,n.balls.push(l),l}function Oe(){}function We(e,t,a){return Math.max(t,Math.min(a,e))}function ze(e){const t=e.canvas;return t?We(Math.min(t.width,t.height)/1e3,.35,3):1}function Ee(e,t,a,o){for(let n=0;e.length>n;n++){const i=e[n],r=t-i.x,l=a-i.y,s=o+i.r;if(s*s>r*r+l*l)return!0}return!1}function Re(e,t,a,o=10){const n=2*o;return e.v+=o*o*(t-e.x)*a,e.v*=Math.max(0,1-n*a),e.x+=e.v*a,e.x}function Be(e,t,a,o){const n=b(),i=Math.max(2,n.wallInset||3)*(n.DPR||1),r=i+e.r,l=t-i-e.r,s=i+e.r,c=a-i-e.r,d=.92,p=Math.max(0,1-.15*o);r>e.x?(e.x=r,e.vx=Math.abs(e.vx)*d*p):e.x>l&&(e.x=l,e.vx=-Math.abs(e.vx)*d*p),s>e.y?(e.y=s,e.vy=Math.abs(e.vy)*d*p):e.y>c&&(e.y=c,e.vy=-Math.abs(e.vy)*d*p)}function Ve(e){return e.currentMode===io.KALEIDOSCOPE_1?{count:e.kaleidoscope1BallCount??18,wedges:e.kaleidoscope1Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope1Speed??.8,complexity:.55,spawnAreaMul:e.kaleidoscope1SpawnAreaMul??1,sizeVariance:e.kaleidoscope1SizeVariance??.3}:e.currentMode===io.KALEIDOSCOPE_2?{count:e.kaleidoscope2BallCount??36,wedges:e.kaleidoscope2Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope2Speed??1.15,complexity:.95,spawnAreaMul:e.kaleidoscope2SpawnAreaMul??1,sizeVariance:e.kaleidoscope2SizeVariance??.3}:e.currentMode===io.KALEIDOSCOPE_3?{count:e.kaleidoscope3BallCount??54,wedges:e.kaleidoscope3Wedges??e.kaleidoscopeWedges??12,speed:e.kaleidoscope3Speed??1.55,complexity:1.35,spawnAreaMul:e.kaleidoscope3SpawnAreaMul??1,sizeVariance:e.kaleidoscope3SizeVariance??.3}:{count:e.kaleidoscopeBallCount??23,wedges:e.kaleidoscopeWedges??e.kaleidoscopeSegments??12,speed:e.kaleidoscopeSpeed??1,complexity:.75,spawnAreaMul:e.kaleidoscopeSpawnAreaMul??1,sizeVariance:e.kaleidoscopeSizeVariance??.3}}function Ne(e,t){function a(e){const a=((e,t)=>{const a=e?.canvas,o=a?.height||0;if(!o)return Me(e,t);const n=fe(t===io.KALEIDOSCOPE_1?+(e.kaleidoscope1DotSizeVh??e.kaleidoscopeDotSizeVh??.95):t===io.KALEIDOSCOPE_2?+(e.kaleidoscope2DotSizeVh??e.kaleidoscopeDotSizeVh??.95):t===io.KALEIDOSCOPE_3?+(e.kaleidoscope3DotSizeVh??e.kaleidoscopeDotSizeVh??.95):+(e.kaleidoscopeDotSizeVh??.95),.1,6),i=fe(t===io.KALEIDOSCOPE_1?+(e.kaleidoscope1DotAreaMul??e.kaleidoscopeDotAreaMul??.7):t===io.KALEIDOSCOPE_2?+(e.kaleidoscope2DotAreaMul??e.kaleidoscopeDotAreaMul??.7):t===io.KALEIDOSCOPE_3?+(e.kaleidoscope3DotAreaMul??e.kaleidoscopeDotAreaMul??.7):+(e.kaleidoscopeDotAreaMul??.7),.1,2),r=Math.max(1,.01*n*o*Math.sqrt(i)),l=fe(.5*(t===io.KALEIDOSCOPE_1?+(e.kaleidoscope1SizeVariance??e.kaleidoscopeSizeVariance??.3):t===io.KALEIDOSCOPE_2?+(e.kaleidoscope2SizeVariance??e.kaleidoscopeSizeVariance??.3):t===io.KALEIDOSCOPE_3?+(e.kaleidoscope3SizeVariance??e.kaleidoscopeSizeVariance??.3):+(e.kaleidoscopeSizeVariance??.3)),0,dn),s=Math.max(1,r*(1-l)),c=Math.max(1,r*(1+l));return ye(e,1e-6>c-s?r:me(s,c,Math.random()))})(o,t),n=1.2*m,i=l-n,r=l+n,d=s-n,p=s+n;for(let t=0;90>t;t++){const t=Math.random()*Sn,n=f+Math.random()*(m-f),u=We(l+Math.cos(t)*n,i,r),h=We(s+Math.sin(t)*n,d,p),b=a*(1+(o.ballSpacing||0));if(!Ee(g,u,h,b)){g.push({x:u,y:h,r:b});const n=new cn(u,h,a,e);n.u=Math.random()*Sn;const i=u-l,r=h-s;n.M=Math.sqrt(i*i+r*r);const d=(12+12*Math.random())*c;return n.vx=-Math.sin(t)*d,n.vy=Math.cos(t)*d,n.driftAx=0,n.driftTime=0,void o.balls.push(n)}}const u=Math.random()*Sn,h=f+Math.random()*(m-f),b=l+Math.cos(u)*h,y=s+Math.sin(u)*h,M=new cn(b,y,a,e);M.u=Math.random()*Sn;const v=b-l,w=y-s;M.M=Math.sqrt(v*v+w*w);const x=(12+12*Math.random())*c;M.vx=-Math.sin(u)*x,M.vy=Math.cos(u)*x,M.driftAx=0,M.driftTime=0,o.balls.push(M)}const o=b();w();const n=o.canvas;if(!n)return;const i=n.width,r=n.height,l=.5*i,s=.5*r,c=ze(o),d=o.maxBalls||300,p=We(Math.max(0,0|e),0,d);if(0>=p)return;const u=We(Ve(o).spawnAreaMul??1,.2,2),h=Math.min(i,r),f=.05*h,m=2.8*h*u,g=[],y=Math.min(8,p);for(let b=0;y>b;b++)a(Z());for(let b=y;p>b;b++)a(Z())}function $e(){}function _e(e){const t=b(),a=t.currentMode;if(t.currentMode===io.CRITTERS&&e!==io.CRITTERS&&(void 0!==t.S&&(t.REST=t.S,delete t.S),void 0!==t.k&&(t.FRICTION=t.k,delete t.k),void 0!==t.C&&(t.ballSpacing=t.C,delete t.C)),v(e),e!==a)try{H?.()}catch(n){}if(console.log("Switching to mode: "+e),(e=>{const t=document.getElementById("announcer");t&&(t.textContent="",setTimeout(()=>{t.textContent=e},10))})(`Switched to ${{pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero Gravity",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope","kaleidoscope-1":"Kaleidoscope I","kaleidoscope-2":"Kaleidoscope II","kaleidoscope-3":"Kaleidoscope III","orbit-3d":"Orbit 3D","orbit-3d-2":"Orbit 3D (Tight Swarm)",critters:"Critters",neural:"Neural Network",lattice:"Crystal Lattice","parallax-linear":"Parallax (Linear)","parallax-perspective":"Parallax (Perspective)"}[e]||e} mode`),t.container){const a=t.container.classList.contains("dark-mode");t.container.className="",e!==io.PIT&&e!==io.PIT_THROWS||t.container.classList.add("mode-pit"),(a||t.isDarkMode)&&t.container.classList.add("dark-mode")}De(),e===io.PIT?(t.gravityMultiplier=t.gravityMultiplierPit,t.G=t.GE*t.gravityMultiplier,t.repellerEnabled=!0,(()=>{const e=b();w(),((e,t)=>{const a=e.DPR,o=-.65*e.canvas.height,n=(e.wallThickness||20)*a,i=n,r=e.canvas.width-n,l=r-i,s=Math.max(1,.22*l),c=i+l*(2/3),d=Math.max(i,c-.5*s),p=Math.min(r,c+.5*s),u=Math.max(0,0|t),h=100*a,f=50*a;for(let m=0;u>m;m++){const e=xe(d+Math.random()*(p-d),o+Math.random()*(0-o));e.vx=(Math.random()-.5)*h,e.vy=Math.random()*f+f,e.driftAx=0,e.driftTime=0}})(e,y(e.maxBalls??300))})()):e===io.PIT_THROWS?(t.gravityMultiplier=t.gravityMultiplierPit,t.G=t.GE*t.gravityMultiplier,t.repellerEnabled=!0,(()=>{const e=b();w(),y(e.maxBalls??300)>0&&(e.p={spawnedTotal:0,side:0,cooldown:0,batchCount:0,batchPaused:!1,queueA:-1,queueB:-1,queueColorA:void 0,queueColorB:void 0,queueSideA:0,queueSideB:1},Pe(e,Ce(e.p),e.p.side),e.p.side=1-e.p.side)})()):e===io.FLIES?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=b();w();const t=y(e.fliesBallCount??60);if(0>=t)return;const a=.5*e.canvas.width,o=.5*e.canvas.height,n=150*e.DPR,i=300*e.DPR;for(let r=0;8>r;r++){const e=Math.random()*Math.PI*2,t=Math.random()*n,r=xe(a+Math.cos(e)*t,o+Math.sin(e)*t,Z()),l=.5+.5*Math.random(),s=Math.random()*Math.PI*2,c=i*l;r.vx=Math.cos(s)*c,r.vy=Math.sin(s)*c,r.driftAx=0,r.driftTime=0}for(let r=8;t>r;r++){const e=Math.random()*Math.PI*2,t=Math.random()*n,r=xe(a+Math.cos(e)*t,o+Math.sin(e)*t),l=.5+.5*Math.random(),s=Math.random()*Math.PI*2,c=i*l;r.vx=Math.cos(s)*c,r.vy=Math.sin(s)*c,r.driftAx=0,r.driftTime=0}})()):e===io.WEIGHTLESS?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=b();w();const t=y(e.weightlessCount);if(0>=t)return;const a=e.canvas.width,o=e.canvas.height,n=e.DPR||1,i=40*n,r=e.weightlessInitialSpeed*n;for(let l=0;t>l;l++){const e=xe(i+Math.random()*(a-2*i),i+Math.random()*(o-2*i)),t=Math.random()*Math.PI*2,n=r*(.7+.3*Math.random());e.vx=Math.cos(t)*n,e.vy=Math.sin(t)*n,e.driftAx=0,e.driftTime=0}})()):e===io.WATER?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=b();w(),pn.length=0;const t=e.canvas;if(!t)return;const a=t.width,o=t.height,n=y(e.waterBallCount||100);if(0>=n)return;const i=(e.waterInitialVelocity||120)*(e.DPR||1);for(let r=0;8>r&&n>r;r++){const t=Math.random()*a,n=Math.random()*o,r=Me(e,io.WATER),l=Z(),s=new cn(t,n,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}for(let r=8;n>r;r++){const t=Math.random()*a,n=Math.random()*o,r=Me(e,io.WATER),l=Z(),s=new cn(t,n,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}})()):e===io.VORTEX?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=b();w();const t=e.canvas;if(!t)return;const a=t.width,o=t.height,n=y(Math.min(e.vortexBallCount||180,e.maxBalls||500));if(0>=n)return;const i=80*(e.vortexSpeedMultiplier??1)*(e.DPR||1);for(let r=0;8>r&&n>r;r++){const t=Math.random()*a,n=Math.random()*o,r=Me(e,io.VORTEX),l=Z(),s=new cn(t,n,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}for(let r=8;n>r;r++){const t=Math.random()*a,n=Math.random()*o,r=Me(e,io.VORTEX),l=Z(),s=new cn(t,n,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,e.balls.push(s)}})()):e===io.PING_PONG?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=b();w();const t=e.canvas;if(!t)return;const a=t.width,o=t.height,n=y(Math.min(e.pingPongBallCount||80,e.maxBalls||300));if(0>=n)return;const i=e.pingPongSpeed||400;for(let r=0;8>r&&n>r;r++){const t=Math.random()*a,n=.15*o+Math.random()*o*.7,r=Me(e,io.PING_PONG),l=Z(),s=new cn(t,n,r,l);s.vx=(Math.random()>.5?1:-1)*(.8*i+Math.random()*i*.4),s.vy=0,s.isPingPong=!0,e.balls.push(s)}for(let r=8;n>r;r++){const t=Math.random()*a,n=.15*o+Math.random()*o*.7,r=Me(e,io.PING_PONG),l=Z(),s=new cn(t,n,r,l);s.vx=(Math.random()>.5?1:-1)*(.8*i+Math.random()*i*.4),s.vy=0,s.isPingPong=!0,e.balls.push(s)}})()):e===io.MAGNETIC?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=b();w();const t=e.canvas;if(!t)return;const a=t.width,o=t.height,n=y(Math.min(e.magneticBallCount||180,e.maxBalls||300));if(0>=n)return;const i=100*(e.DPR||1);for(let r=0;8>r&&n>r;r++){const t=Math.random()*a,n=Math.random()*o,r=Me(e,io.MAGNETIC),l=Z(),s=new cn(t,n,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,s.charge=Math.random()>.5?1:-1,s.baseAlpha=1,e.balls.push(s)}for(let r=8;n>r;r++){const t=Math.random()*a,n=Math.random()*o,r=Me(e,io.MAGNETIC),l=Z(),s=new cn(t,n,r,l);s.vx=(Math.random()-.5)*i,s.vy=(Math.random()-.5)*i,s.charge=Math.random()>.5?1:-1,s.baseAlpha=1,e.balls.push(s)}})()):e===io.BUBBLES?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=b();e.balls.length=0;const t=e.canvas;if(!t)return;const a=t.width,o=t.height,n=y(e.bubblesMaxCount||200);if(n>0){for(let e=0;8>e&&n>e;e++)Ke(Math.random()*a,Math.random()*o,Z(),!0);for(let e=8;n>e;e++)Ke(Math.random()*a,Math.random()*o,Z(),!0)}})()):e===io.KALEIDOSCOPE?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Ne(y(b().kaleidoscopeBallCount??23),io.KALEIDOSCOPE)):e===io.KALEIDOSCOPE_1?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Ne(y(b().kaleidoscope1BallCount??18),io.KALEIDOSCOPE_1)):e===io.KALEIDOSCOPE_2?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Ne(y(b().kaleidoscope2BallCount??36),io.KALEIDOSCOPE_2)):e===io.KALEIDOSCOPE_3?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,Ne(y(b().kaleidoscope3BallCount??54),io.KALEIDOSCOPE_3)):e===io.ORBIT_3D?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=b();w();const t=y(Math.max(0,0|(e.orbit3dMoonCount??80)));if(0>=t)return;const a=e.canvas.width,o=e.canvas.height;for(let n=0;t>n;n++){const t=Math.random()*Math.PI*2,n=.15*Math.min(a,o)+Math.random()*Math.min(a,o)*.1,i=xe(.5*a+Math.cos(t)*n,.5*o+Math.sin(t)*n,Z());if(!i)continue;const r=e.DPR||1,l=(e.orbit3dVelocityMult??150)*(.9+.2*Math.random())*r;i.vx=-Math.sin(t)*l,i.vy=Math.cos(t)*l,i.orbitDepth=Math.random()}})()):e===io.ORBIT_3D_2?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=b();w();const t=y(Math.max(0,0|(e.orbit3d2MoonCount??100)));if(0>=t)return;const a=e.canvas.width,o=e.canvas.height;for(let n=0;t>n;n++){const t=Math.random()*Math.PI*2,n=.35*Math.min(a,o)+Math.random()*Math.min(a,o)*.15,i=xe(.5*a+Math.cos(t)*n,.5*o+Math.sin(t)*n,Z());if(!i)continue;const r=150*(e.orbit3d2VelocityMult??1.1)*(e.DPR||1);i.vx=-Math.sin(t)*r,i.vy=Math.cos(t)*r,i.orbitDepth=Math.random()}})()):e===io.CRITTERS?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,void 0===t.S&&(t.S=t.REST),void 0===t.k&&(t.k=t.FRICTION),t.REST=t.critterRestitution??t.REST,t.FRICTION=t.critterFriction??t.FRICTION,void 0===t.C&&(t.C=t.ballSpacing),t.ballSpacing=Math.min(t.ballSpacing||0,1),(()=>{const e=b();w();const t=e.canvas.width,a=e.canvas.height,o=y(Math.max(10,Math.min(260,0|e.critterCount)));if(o>0){for(let n=0;8>n&&o>n;n++){const o=xe(Math.random()*t|0,Math.random()*a|0,Z()),n=Me(e,io.CRITTERS);o.r=n,o.rBase=n,o.m=Math.max(1,n*n*.12),o.vx=0,o.vy=0,o.P=Math.random()*Math.PI*2,o.F=0,o.T=Math.random(),o.I=o.T,o.D=2*Math.random()-1,o.L=0}for(let n=8;o>n;n++){const o=xe(Math.random()*t|0,Math.random()*a|0,Z()),n=Me(e,io.CRITTERS);o.r=n,o.rBase=n,o.m=Math.max(1,n*n*.12),o.vx=0,o.vy=0,o.P=Math.random()*Math.PI*2,o.F=0,o.T=Math.random(),o.I=o.T,o.D=2*Math.random()-1,o.L=0}}})()):e===io.NEURAL?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!0,(()=>{const e=b(),t=e.canvas;if(!t)return;w();const a=y(Math.max(8,Math.min(e.neuralBallCount??80,260)));if(0>=a)return;const o=t.width,n=t.height,i=40*(e.DPR||1),r=Math.min(8,a);for(let l=0;r>l;l++){const t=xe(i+Math.random()*(o-2*i),i+Math.random()*(n-2*i),Z()),a=Me(e,io.NEURAL);t.r=a,t.rBase=a,t.m=Math.max(1,a*a*.12),t.vx=0,t.vy=0,t.driftAx=0,t.driftTime=0,t.A=Math.random()*Math.PI*2}for(let l=r;a>l;l++){const t=xe(i+Math.random()*(o-2*i),i+Math.random()*(n-2*i),Z()),a=Me(e,io.NEURAL);t.r=a,t.rBase=a,t.m=Math.max(1,a*a*.12),t.vx=0,t.vy=0,t.driftAx=0,t.driftTime=0,t.A=Math.random()*Math.PI*2}})()):e===io.LATTICE?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!0,(()=>{const e=b();w();const t=e.canvas,a=t.width,o=t.height,n=Math.max(8,((e,t)=>.01*t*Math.max(1,Math.min(e.width,e.height)))(t,e.latticeSpacingVw??8.5)),i=.8660254037844386*n,r=Math.ceil(a/n)+2,l=Math.ceil(o/i)+2,s=e.isMobile?Math.max(0,Math.min(1,+(e.mobileObjectReductionFactor??.7))):1;if(e.isMobile&&0>=s)return;const c=Math.sqrt(s),d=Math.max(0,Math.round(r*c)),p=Math.max(0,Math.round(l*c));if(0>=d||0>=p)return;const u=e.latticeAlignment??"center",h=(d-1)*n,f=(p-1)*i;let m,g;"center"===u?(m=.5*(a-h),g=.5*(o-f)):"top-left"===u?(m=.5*-n,g=.5*-i):"top-center"===u?(m=.5*(a-h),g=.5*-i):"top-right"===u?(m=a-h+.5*n,g=.5*-i):(m=.5*(a-h),g=.5*(o-f));const y=.25*n;for(let b=0;p>b;b++){const e=1&b?.5*n:0,t=g+b*i;for(let i=0;d>i;i++){const r=m+i*n+e;if(!(-y>r||r>a+y||-y>t||t>o+y)){const e=xe(r,t,Z());e.latticeHomeX=r,e.latticeHomeY=t,e.latticeRow=b,e.latticeCol=i,e.vx=0,e.vy=0,e.driftAx=0,e.driftTime=0}}}})()):e===io.PARALLAX_LINEAR?(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=b(),t=e.canvas;if(!t)return;w();const a=t.width,o=t.height,n=y(Math.max(0,Math.min(40,Math.round(e.parallaxLinearGridX??14)))),i=y(Math.max(0,Math.min(40,Math.round(e.parallaxLinearGridY??10)))),r=y(Math.max(0,Math.min(20,Math.round(e.parallaxLinearGridZ??7))));if(0>=n||0>=i||0>=r)return;const l=Math.max(.2,Math.min(3,e.parallaxLinearSpanX??1.35)),s=Math.max(.2,Math.min(3,e.parallaxLinearSpanY??1.35)),c=-.5*a*l,d=-.5*o*s,p=a*l/Math.max(1,n-1),u=o*s/Math.max(1,i-1),h=Math.max(10,e.parallaxLinearZNear??50),f=(Math.max(h+100,e.parallaxLinearZFar??800)-h)/Math.max(1,r-1),m=Math.max(80,e.parallaxLinearFocalLength??420),g=.768*(e.R_MED||20)*(e.DPR||1)*Math.max(.1,Math.min(6,e.parallaxLinearDotSizeMul??1.8)),M=be(e,io.PARALLAX_LINEAR),v=.5*a,x=.5*o;for(let b=r-1;b>=0;b--){const t=h+b*f;for(let a=0;i>a;a++)for(let o=0;n>o;o++){const n=c+o*p,i=d+a*u,r=t,l=m/(m+r),s=g*l,h=1,f=xe(v+n*l,x+i*l,Z());f.r=ye(e,s),f.vx=0,f.vy=0,f.alpha=h,f.K={x:n,y:i,z:r,baseScale:l},f.O=M>1e-6?1+(2*Math.random()-1)*M:1,f.W=!0}}})()):e===io.PARALLAX_PERSPECTIVE&&(t.gravityMultiplier=0,t.G=0,t.repellerEnabled=!1,(()=>{const e=b(),t=e.canvas;if(!t)return;w();const a=t.width,o=t.height,n=y(Math.max(0,Math.min(50,Math.round(e.parallaxPerspectiveGridX??16)))),i=y(Math.max(0,Math.min(50,Math.round(e.parallaxPerspectiveGridY??12)))),r=y(Math.max(0,Math.min(25,Math.round(e.parallaxPerspectiveGridZ??8))));if(0>=n||0>=i||0>=r)return;const l=Math.max(.2,Math.min(3,e.parallaxPerspectiveSpanX??1.45)),s=Math.max(.2,Math.min(3,e.parallaxPerspectiveSpanY??1.45)),c=-.5*a*l,d=-.5*o*s,p=a*l/Math.max(1,n-1),u=o*s/Math.max(1,i-1),h=Math.max(10,e.parallaxPerspectiveZNear??40),f=(Math.max(h+100,e.parallaxPerspectiveZFar??1200)-h)/Math.max(1,r-1),m=Math.max(0,Math.min(1,e.parallaxPerspectiveRandomness??.6)),g=Math.max(80,e.parallaxPerspectiveFocalLength??420),M=.6*(e.R_MED||20)*(e.DPR||1)*Math.max(.1,Math.min(6,e.parallaxPerspectiveDotSizeMul??1.8)),v=be(e,io.PARALLAX_PERSPECTIVE),x=.5*a,S=.5*o;for(let b=r-1;b>=0;b--){const t=h+b*f;for(let a=0;i>a;a++)for(let o=0;n>o;o++){const n=d+a*u,i=t,r=c+o*p+(Math.random()-.5)*p*m,l=n+(Math.random()-.5)*u*m,s=i+(Math.random()-.5)*f*m*.5,h=g/(g+s),b=M*h,y=1,w=xe(x+r*h,S+l*h,Z());w.r=ye(e,b),w.vx=0,w.vy=0,w.alpha=y,w.K={x:r,y:l,z:s,baseScale:h},w.O=v>1e-6?1+(2*Math.random()-1)*v:1,w.W=!0}}})()),console.log(`Mode ${e} initialized with ${t.balls.length} balls`);const o=Math.max(0,Math.round(((e,t)=>{switch(e){case io.PIT:return t.pitWarmupFrames??10;case io.PIT_THROWS:return t.pitThrowsWarmupFrames??10;case io.FLIES:return t.fliesWarmupFrames??10;case io.WEIGHTLESS:return t.weightlessWarmupFrames??10;case io.WATER:return t.waterWarmupFrames??10;case io.VORTEX:return t.vortexWarmupFrames??10;case io.PING_PONG:return t.pingPongWarmupFrames??10;case io.MAGNETIC:return t.magneticWarmupFrames??10;case io.BUBBLES:return t.bubblesWarmupFrames??10;case io.KALEIDOSCOPE:return t.kaleidoscopeWarmupFrames??10;case io.KALEIDOSCOPE_1:return t.kaleidoscope1WarmupFrames??10;case io.KALEIDOSCOPE_2:return t.kaleidoscope2WarmupFrames??10;case io.KALEIDOSCOPE_3:return t.kaleidoscope3WarmupFrames??10;case io.ORBIT_3D:return t.orbit3dWarmupFrames??10;case io.ORBIT_3D_2:return t.orbit3d2WarmupFrames??10;case io.CRITTERS:return t.crittersWarmupFrames??10;case io.NEURAL:return t.neuralWarmupFrames??10;case io.LATTICE:return t.latticeWarmupFrames??10;case io.PARALLAX_LINEAR:return t.parallaxLinearWarmupFrames??10;case io.PARALLAX_PERSPECTIVE:return t.parallaxPerspectiveWarmupFrames??10;default:return 10}})(e,t)||0));if(t.warmupFramesRemaining=o,"undefined"!=typeof window&&e!==a)try{window.dispatchEvent(new CustomEvent("bb:modeChanged",{detail:{prevMode:a,mode:e}}))}catch(n){}}function Ge(){const e=b();try{H?.()}catch(t){}_e(e.currentMode)}function He(){const e=b();return e.currentMode===io.WATER?ve:e.currentMode===io.PIT_THROWS?Fe:e.currentMode===io.MAGNETIC?Ae:e.currentMode===io.BUBBLES?Oe:null}function je(){return b().currentMode===io.NEURAL?{preRender:$e}:null}function Ze(){const e=b();return e?.cursorColorHex&&"string"==typeof e.cursorColorHex?e.cursorColorHex:"#000000"}function Ye(){Fn||(Pn=document.createElement("div"),Pn.id="custom-cursor",Pn.setAttribute("aria-hidden","true"),document.body.appendChild(Pn),Pn.style.display="none",Pn.style.opacity="0",Fn=!0,Xe(),(()=>{if(Ln||!Pn)return;Ln=!0;const e=b(),t=(e.entranceWallTransitionDelay||300)+.3*(e.entranceWallTransitionDuration||800)+(e.entranceElementDuration||200)+600,a="cubic-bezier(0.16, 1, 0.3, 1)";window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches?setTimeout(()=>{Pn&&(Pn.style.opacity="1")},t):setTimeout(()=>{Pn&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(Pn){if("function"!=typeof Pn.animate)return Pn.style.opacity="1",void(Pn.style.transition="opacity 800ms "+a);Tn&&(Pn.style.display="block"),An=Pn.animate([{opacity:0},{opacity:1}],{duration:800,easing:a,fill:"forwards"}),An?.addEventListener?.("finish",()=>{Pn&&(Pn.style.opacity="1")}),An?.addEventListener?.("cancel",()=>{Pn&&(Pn.style.opacity="1")})}})})},t)})())}function Xe(){if(!Pn)return;const e=b(),t=.5*(e.R_MIN+e.R_MAX)*e.cursorSize*2;Pn.style.width=t+"px",Pn.style.height=t+"px",Pn.style.borderRadius="50%",Pn.style.marginLeft="0",Pn.style.marginTop="0",Tn||(Pn.style.transform="translate(-50%, -50%) scale(1)")}function Ue(e,t){if(!Pn)return;if((()=>{try{return!!document?.body?.classList?.contains?.("abs-link-hovering")}catch(e){return!1}})())return void(Pn.style.display="none");const a=Tn;Tn=((e,t)=>{const a=document.getElementById("bravia-balls");if(!a)return!1;const o=performance.now();return In&&100>=o-Dn||(In=a.getBoundingClientRect(),Dn=o),!(In.left>e||e>In.right||In.top>t||t>In.bottom)})(e,t),Pn.style.left=e+"px",Pn.style.top=t+"px",document.body.style.cursor="none",Tn?(Pn.style.display="block",a?Pn.style.transform!==Kn&&(Pn.style.transform=Kn):(Pn.style.transform=On,requestAnimationFrame(()=>{Pn.style.transform=Kn}))):(Pn.style.display="none",a&&(Pn.style.transform=On,Pn.style.backgroundColor="",Pn.style.filter=""))}function qe(){Pn&&(Pn.style.display="none",document.body.style.cursor="none",Tn=!1)}function Je(){Pn&&(Tn=!1)}function Qe(){const e=(()=>{try{return!!document?.body?.classList?.contains?.("abs-link-hovering")}catch(e){return!1}})();return e&&!$n&&(Vn=0,Nn=0),$n=e,e}function et(){try{return!!window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches}catch(e){return!1}}function tt(e,t,a){return t>e?t:e>a?a:e}function at(e,t){const a=[{x:Hn,y:Hn},{x:t.width-Hn,y:Hn},{x:Hn,y:t.height-Hn},{x:t.width-Hn,y:t.height-Hn}];for(let o=0;a.length>o;o++){const t=e.x-a[o].x,n=e.y-a[o].y,i=Math.max(1,Math.hypot(t,n));if(Hn+e.r>i){const a=(Hn+e.r-i)/(Hn+e.r)*1800,o=n/i;e.vx+=t/i*a*_n,e.vy+=o*a*_n}}}function ot(e,t){const a=b(),o=a.balls,n=a.canvas;if(!n)return;if(0===o.length)return;if(a.currentMode===io.KALEIDOSCOPE||a.currentMode===io.KALEIDOSCOPE_1||a.currentMode===io.KALEIDOSCOPE_2||a.currentMode===io.KALEIDOSCOPE_3){const i=Math.min(.033,Math.max(0,e)),r=o.length;for(let e=0;r>e;e++)o[e].step(i,t);(({iterations:e=4,positionalCorrectionPercent:t=.25,positionalCorrectionSlopPx:a=null,maxCorrectionPx:o=null,enableSound:n=!0}={})=>{const i=b(),r=i.balls,l=pe(),s=i.REST,c=t,d=a??.5*i.DPR,p=i.ballSpacing||0,u=o??2*(i.DPR||1);for(let h=0;e>h;h++)for(let e=0;l.length>e;e++){const{i:t,j:a}=l[e],o=r[t],f=r[a];if(o.isSleeping&&f.isSleeping)continue;o.isSleeping&&o.wake(),f.isSleeping&&f.wake();const m=f.x-o.x,g=f.y-o.y,b=o.r+f.r+(o.r+f.r)/2*p,y=m*m+g*g;if(0===y||y>b*b)continue;const M=Math.sqrt(y),v=m/M,w=g/M,x=b-M,S=1/Math.max(o.m,.001),k=1/Math.max(f.m,.001);let C=c*Math.max(x-d,0)/(S+k);C>u&&(C=u);const P=C*v,F=C*w;o.x-=P*S,o.y-=F*S,f.x+=P*k,f.y+=F*k;const T=(f.vx-o.vx)*v+(f.vy-o.vy)*w;if(0>T){const e=-(1+(30>Math.abs(T)?0:s))*T/(S+k),r=e*v,l=e*w;if(o.vx-=r*S,o.vy-=l*S,f.vx+=r*k,f.vy+=l*k,n&&0===h){const e=(o.r+f.r)/2,n=(o.x+f.x)/2/(i.canvas?.width||1);te(e,Math.min(1,Math.abs(T)/(50*(o.r+f.r))),n,`${t}-${a}`)}}}})({iterations:3,positionalCorrectionPercent:.22,maxCorrectionPx:1.25*(a.DPR||1),enableSound:!1});for(let e=0;r>e;e++)Be(o[e],n.width,n.height,i);return void(Gn=0)}Gn+=e;let i=0;for(ln.clearPressureFrame();Gn>=_n&&so.MAX_PHYSICS_STEPS>i;){const e=o.length;for(let a=0;e>a;a++)o[a].step(_n,t);const r=Math.max(1,Math.min(20,Math.round(+(a.physicsCollisionIterations??10)||10)));if(a.currentMode===io.KALEIDOSCOPE||a.currentMode===io.KALEIDOSCOPE_1||a.currentMode===io.KALEIDOSCOPE_2||a.currentMode===io.KALEIDOSCOPE_3?ue(6):a.currentMode!==io.FLIES&&a.currentMode!==io.ORBIT_3D&&a.currentMode!==io.PARALLAX_LINEAR&&a.currentMode!==io.PARALLAX_PERSPECTIVE&&ue(r),ln.resetStepBudgets(),a.currentMode!==io.ORBIT_3D&&a.currentMode!==io.ORBIT_3D_2&&a.currentMode!==io.PARALLAX_LINEAR&&a.currentMode!==io.PARALLAX_PERSPECTIVE&&a.currentMode!==io.LATTICE){const e=a.currentMode===io.WEIGHTLESS?a.weightlessBounce:a.REST,t=a.currentMode===io.PIT||a.currentMode===io.PIT_THROWS,i=o.length;for(let a=0;i>a;a++)t||at(o[a],n),o[a].walls(n.width,n.height,_n,e)}if(a.currentMode===io.PIT||a.currentMode===io.PIT_THROWS){ue(3);const e=a.REST,t=o.length;for(let a=0;t>a;a++)o[a].walls(n.width,n.height,_n,e,{registerEffects:!1});const i=a.DPR||1,r=(Number.isFinite(a.sleepVelocityThreshold)?a.sleepVelocityThreshold:12)*i,l=Number.isFinite(a.sleepAngularThreshold)?a.sleepAngularThreshold:.18,s=a.timeToSleep??.25;for(let a=0;t>a;a++){const e=o[a];if(!e||e.isSleeping)continue;const t=Math.sqrt(e.vx*e.vx+e.vy*e.vy),n=Math.abs(e.omega);(e.isGrounded||e.hasSupport)&&r>t&&l>n?(e.vx*=.5,e.vy*=.5,e.omega*=.5,2*i>t&&(e.vx=0,e.vy=0),.02>n&&(e.omega=0),e.sleepTimer+=_n,s>e.sleepTimer||(e.vx=0,e.vy=0,e.omega=0,e.isSleeping=!0)):e.sleepTimer=0}}if(!1!==a.physicsSkipSleepingSteps){const e=a.currentMode;if(e!==io.FLIES&&e!==io.ORBIT_3D&&e!==io.ORBIT_3D_2&&e!==io.PARALLAX_LINEAR&&e!==io.PARALLAX_PERSPECTIVE&&e!==io.KALEIDOSCOPE&&e!==io.KALEIDOSCOPE_1&&e!==io.KALEIDOSCOPE_2&&e!==io.KALEIDOSCOPE_3&&e!==io.PIT&&e!==io.PIT_THROWS){const e=a.DPR||1,t=Math.max(0,+(a.physicsSleepThreshold??12)||0)*e,n=Math.max(0,+(a.physicsSleepTime??.25)||0),i=Number.isFinite(a.sleepAngularThreshold)?a.sleepAngularThreshold:.18;if(t>0&&n>0){const e=o.length;for(let a=0;e>a;a++){const e=o[a];e&&!e.isSleeping&&(t>Math.sqrt(e.vx*e.vx+e.vy*e.vy)&&i>Math.abs(e.omega)?(e.sleepTimer+=_n,n>e.sleepTimer||(e.vx=0,e.vy=0,e.omega=0,e.isSleeping=!0)):e.sleepTimer=0)}}}}Gn-=_n,i++}const r=He();r&&r(e),ln.step(e),Gn>_n*so.ACCUMULATOR_RESET_THRESHOLD&&(Gn=0)}async function nt(e,t){const a=b(),o=a.balls;if(!a.canvas)return;if(!o||0===o.length)return;const n=Math.max(0,Math.round(a.warmupFramesRemaining||0));if(n>0){a.warmupFramesRemaining=0,Gn=0;for(let e=0;n>e;e++)ot(jn,t)}else ot(e,t)}function it(){const e=b(),t=e.ctx,a=e.balls,o=e.canvas;if(!t||!o)return;t.clearRect(0,0,o.width,o.height);const n=e.canvasClipPath;if(n){t.save();try{t.clip(n)}catch(r){}}const i=je();if(i&&i.preRender&&i.preRender(t),e.currentMode===io.KALEIDOSCOPE||e.currentMode===io.KALEIDOSCOPE_1||e.currentMode===io.KALEIDOSCOPE_2||e.currentMode===io.KALEIDOSCOPE_3)(e=>{const t=b();if((a=t.currentMode)!==io.KALEIDOSCOPE&&a!==io.KALEIDOSCOPE_1&&a!==io.KALEIDOSCOPE_2&&a!==io.KALEIDOSCOPE_3)return;var a;const o=t.canvas;if(!o)return;const n=(()=>{const e=performance.now(),t=kn||e;return kn=e,We((e-t)/1e3,0,.05)})(),i=t.balls,r=o.width,l=o.height,s=ze(t),c=Ve(t).wedges??12,d=We(Math.round(c),3,24),p=!!(t.kaleidoscopeMirror??1),u=(e=>.5*e.width)(o),h=(e=>.5*e.height)(o),f=Sn/d,m=Math.max(1e-5,1e-4*f),g=t.mouseInCanvas?t.mouseX:u,y=t.mouseInCanvas?t.mouseY:h,M=g-u,v=y-h,w=Math.atan2(v,M),x=We(Math.hypot(M,v)/Math.max(1,.5*Math.min(r,l)),0,1);t.R||(t.R={phase:{x:0,v:0},panX:{x:0,v:0},panY:{x:0,v:0},lastMouseX:g,lastMouseY:y,lastInCanvas:!!t.mouseInCanvas});const S=t.R,k=!!t.mouseInCanvas,C=Math.hypot(g-S.lastMouseX,y-S.lastMouseY)>.5||k!==S.lastInCanvas,P=We(Ve(t).speed??1,.2,2),F=(e=>Ve(e).complexity)(t),T=.65*P*F,I=M*T*(t.mouseInCanvas?1:0),D=v*T*(t.mouseInCanvas?1:0),L=.7*w*F*(t.mouseInCanvas?1:0);C?(S.lastMouseX=g,S.lastMouseY=y,S.lastInCanvas=k,Re(S.phase,L,n,4.5),Re(S.panX,I,n,5),Re(S.panY,D,n,5)):(S.phase.v=0,S.panX.v=0,S.panY.v=0);const A=S.phase.x,K=S.panX.x,O=S.panY.x,W=.22+.18*We((P-.2)/1.8,0,1),z=1-W+2*W*(1-x);for(let b=0;i.length>b;b++){const t=i[b],a=t.x-u+K,o=t.y-h+O,n=3.5*s,r=Math.hypot(a,o)*n*z;if(1e-6>r)continue;const l=p?2*f:f;let c=Math.atan2(o,a)+A;c=(c%l+l)%l,p&&c>f&&(c=l-c),c=We(c,m,f-m);for(let i=0;d>i;i++){const a=i*f+c,o=u+Math.cos(a)*r,n=h+Math.sin(a)*r;1>t.alpha&&(e.globalAlpha=t.alpha),e.fillStyle=t.color,e.beginPath(),e.arc(o,n,t.r,0,Sn),e.fill(),1>t.alpha&&(e.globalAlpha=1)}}})(t);else for(let l=0;a.length>l;l++)a[l].draw(t);i&&i.postRender&&i.postRender(t),n&&t.restore(),(e=>{if(Qe())return;const t=b();if(!t?.mouseTrailEnabled)return;if(et())return;if(!e||!Nn||!zn)return;const a=performance.now(),o=tt(+(t.mouseTrailFadeMs??220),40,2e3),n=tt(+(t.mouseTrailOpacity??.35),0,1);if(0>=n)return;const i=t.DPR||1,r=tt(+(t.mouseTrailSize??1.3),.5,10)*i;for(;Nn>0&&a-Bn[(Vn-Nn+zn)%zn]>o;)Nn--;if(!Nn)return;if(2>Nn)return;const l=Ze(),s=e.globalAlpha,c=e.globalCompositeOperation,d=e.lineCap,p=e.lineJoin,u=e.strokeStyle,h=e.lineWidth;e.globalCompositeOperation="source-over",e.lineCap="round",e.lineJoin="round",e.strokeStyle=l,e.lineWidth=r,e.globalAlpha=n;const f=Nn,m=(Vn-f+zn)%zn;if(e.beginPath(),e.moveTo(En[m],Rn[m]),2===f)e.lineTo(En[(m+1)%zn],Rn[(m+1)%zn]);else{for(let a=1;f-1>a;a++){const t=(m+a)%zn,o=(m+a+1)%zn,n=En[t],i=Rn[t];e.quadraticCurveTo(n,i,.5*(n+En[o]),.5*(i+Rn[o]))}const t=(m+f-1)%zn;e.lineTo(En[t],Rn[t])}e.stroke(),e.globalAlpha=s,e.globalCompositeOperation=c,e.lineCap=d,e.lineJoin=p,e.strokeStyle=u,e.lineWidth=h})(t),((e,t,a)=>{const o=b();if(!e)return;const n=nn||he(),i=o.DPR||1,l=Math.max(0,Math.min(10,+(o.wallVisualDeformMul??1)||1)),s="function"==typeof o.getCanvasCornerRadius?o.getCanvasCornerRadius():o.cornerRadius??o.wallRadius??0,c=Math.max(0,(+s||0)*i),d=Math.max(0,(+o.wallThickness||0)*i),p=Math.max(1,t-2*d),u=Math.max(1,a-2*d),h=Math.max(0,Math.min(c,.5*p,.5*u));ln.ringPhysics.ensureGeometry(p,u,h),ln.ringRender.ensureGeometry(p,u,h);const f=Math.max(2,2*i);e.save(),e.fillStyle=n,e.beginPath(),e.moveTo(-f,-f),e.lineTo(t+f,-f),e.lineTo(t+f,a+f),e.lineTo(-f,a+f),e.closePath();const m=ln.ringPhysics,g=ln.ringRender,y=m.n,M=g.n;if(M>0&&y>0){const n=!1!==o.wallPhysicsInterpolation?Math.max(0,Math.min(1,ln.B||0)):1,r=g.renderDeformations,s=ln.V,c=ln.N;if(s&&c&&s.length===M&&c.length===M)for(let e=0;M>e;e++){const t=s[e];r[e]=t+(c[e]-t)*n}else{const e=m.deformations,t=g.deformations;for(let a=0;M>a;a++){const o=a/M*y,n=Math.floor(o)%y,i=o-n;t[a]=(1-i)*e[n]+i*e[(n+1)%y]}for(let a=0;M>a;a++)r[a]=(t[(a-2+M)%M]+4*t[(a-1+M)%M]+6*t[a]+4*t[(a+1)%M]+t[(a+2)%M])*(1/16)}const p=g.baseX,u=g.baseY,h=g.normX,f=g.normY,b=Math.min(Math.max(0,.18*Math.max(1,Math.min(t,a))),Math.max(0,+(o.wallWobbleMaxDeform??tn)||tn)*i*1*l),v=e=>{const t=r[e]*i*1*l;return t>0?t>b?b:t:0},w=e=>p[e]+h[e]*v(e)+d,x=e=>u[e]+f[e]*v(e)+d;e.moveTo(w(M-1),x(M-1));for(let t=M-2;t>=0;t--)e.lineTo(w(t),x(t));e.closePath()}try{e.fill("evenodd")}catch(r){e.fill()}e.restore()})(t,o.width,o.height)}function rt(){nn=he()}function lt(){return null===Xn&&(Xn=(()=>{try{return!1}catch(e){}try{if("8001"==(globalThis?.location?.port??"")+"")return!0}catch(e){}try{if(Array.from(document.scripts||[]).some(e=>{if("module"!==(e.getAttribute("type")||"").toLowerCase())return!1;const t=e.getAttribute("src")||"";return/(^|\/)main\.js(\?|#|$)/.test(t)}))return!0}catch(e){}return!1})()),Xn}function st(e){const t=Math.random();let a=0;for(let o=0;8>o;o++)if(a+=ei[o],a>=t)return e[o];return e[0]}function ct({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"],silence:a=!1}={}){if(!Jn){Jn=!0;try{Yn.log("%c"+e,"color: #888; font-style: italic;"),Yn.log("");try{const e=((e,t=3)=>{const{colorAssignments:a}=((e,t=3)=>{let a;try{a=(()=>{try{const e=b(),t=e?.currentColors;if(Array.isArray(t)&&t.length>=8)return t.slice(0,8)}catch(e){}return Qn})(),Array.isArray(a)&&a.length>=8||(a=Qn)}catch(l){a=Qn}const o=[];for(let s=0;e.length>s;s++){const a=e[s];for(let e=0;a.length>e;e+=t){const n=a.slice(e,e+t);o.push({row:s,col:e,visible:n.trim().length>0})}}const n=o.map((e,t)=>e.visible?t:-1).filter(e=>e>=0),i=Array(o.length).fill(null),r=(e=>{for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e})([...n]);for(let s=0;Math.min(8,r.length)>s;s++){const e=Math.min(s,a.length-1);i[r[s]]=a[e]||Qn[e]}for(const s of n)null===i[s]&&(i[s]=st(a));for(let s=0;o.length>s;s++)null===i[s]&&(i[s]="transparent");return{clusters:o,colorAssignments:i}})(e,t),o=[];let n=0;for(const i of e){let e="";const r=[];for(let o=0;i.length>o;o+=t)e+="%c"+i.slice(o,o+t),r.push(`color: ${a[n]}; font-family: monospace; font-weight: bold; font-size: 12px; letter-spacing: 0;`),n++;o.push([e,...r])}return o})(t,3);for(const t of e)Yn.log(...t)}catch(o){for(const e of t)Yn.log(e)}Yn.log("");const a=(new Date).getFullYear();Yn.log("%c© "+a+" Alexander Beck Studio. All rights reserved. Unauthorized reproduction prohibited.","color: #555; font-size: 10px;")}catch(n){}if(a)try{console.log=()=>{},console.info=()=>{},console.warn=()=>{},console.debug=()=>{},console.table=()=>{},console.group=()=>{},console.groupCollapsed=()=>{},console.groupEnd=()=>{}}catch(n){}}}function dt(){lt()&&Yn.groupEnd()}function pt(e){if(!lt())return;const t=("undefined"!=typeof performance&&performance.now?performance.now():Date.now())-qn;Un+=1,Yn.log(`[${(Un+"").padStart(2,"0")}] +${t.toFixed(1)}ms ${e}`)}function ut(e){if(lt())try{performance.mark(e)}catch(t){}}function ht(){const e=navigator.userAgent||"",t=/Android/.test(e),a=/iPhone|iPad|iPod/.test(e)||/Mac/.test(e)&&navigator.maxTouchPoints>1,o=t||a,n=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||window.matchMedia&&window.matchMedia("(display-mode: minimal-ui)").matches||!0===navigator.standalone;return o||n}function ft(){if(ti&&ai){const e=document.documentElement;return e.style.setProperty("--frame-color-light",ti),void e.style.setProperty("--frame-color-dark",ai)}const e=b(),a=document.documentElement,o=e?.frameColorLight||e?.frameColor||t("--frame-color-light","#0a0a0a"),n=e?.frameColorDark||e?.frameColor||t("--frame-color-dark","#0a0a0a");a.style.setProperty("--frame-color-light",o),a.style.setProperty("--frame-color-dark",n)}function mt(e){(()=>{if(ti&&ai)return;const e=b();ti=e?.frameColorLight||e?.frameColor||t("--frame-color-light","#0a0a0a"),ai=e?.frameColorDark||e?.frameColor||t("--frame-color-dark","#0a0a0a")})(),(e=>{const t=document.documentElement;t.style.setProperty("--frame-color-light",e),t.style.setProperty("--frame-color-dark",e)})(t(e?"--wall-color-browser-dark":"--wall-color-browser-light",e?"#202124":"#f1f3f4"))}function gt(e){oi=e;let a=!1;a="auto"===e?"dark"===ni||(()=>{const e=b();if(!e.autoDarkModeEnabled)return!1;const t=Number.isFinite(e.autoDarkNightStartHour)?e.autoDarkNightStartHour:18,a=Number.isFinite(e.autoDarkNightEndHour)?e.autoDarkNightEndHour:6,o=(new Date).getHours();return t!==a&&(a>t?o>=t&&a>o:o>=t||a>o)})():"dark"===e,(e=>{const a=b();a.isDarkMode=e,document.documentElement.style.colorScheme=e?"dark":"light",e?(a.container?.classList.add("dark-mode"),document.body.classList.add("dark-mode"),document.documentElement.classList.add("dark-mode")):(a.container?.classList.remove("dark-mode"),document.body.classList.remove("dark-mode"),document.documentElement.classList.remove("dark-mode")),(e=>{const t=(b().chromeHarmonyMode||"auto")+"",a=(()=>{const e=navigator.userAgent||"",t=navigator.vendor||"";return{isFirefox:/Firefox\//.test(e),isSafari:/Safari\//.test(e)&&/Apple/.test(t)&&!/Chrome\//.test(e)&&!/Chromium\//.test(e),isChromium:/Chrome\//.test(e)||/Chromium\//.test(e)||/Edg\//.test(e),ua:e}})();if("site"===t)return ft(),{mode:t,family:a,themeColorLikelyApplied:ht()};if("browser"===t)return mt(e),{mode:t,family:a,themeColorLikelyApplied:ht()};const o=ht();a.isSafari?ft():a.isChromium&&!o?mt(e):ft()})(e),(e=>{const a=b(),o=a?.frameColorLight||t("--frame-color-light","#0a0a0a"),n=a?.frameColorDark||t("--frame-color-dark","#0a0a0a"),i=e?n:o;let r=document.querySelector('meta[name="theme-color"]');r||(r=document.createElement("meta"),r.name="theme-color",document.head.appendChild(r)),r.content=i;let l=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: light)"]');l||(l=document.createElement("meta"),l.name="theme-color",l.media="(prefers-color-scheme: light)",document.head.appendChild(l)),l.content=o;let s=document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: dark)"]');s||(s=document.createElement("meta"),s.name="theme-color",s.media="(prefers-color-scheme: dark)",document.head.appendChild(s)),s.content=n})(e),rt(),Y(a.currentTemplate),(()=>{const e=document.getElementById("themeAuto"),t=document.getElementById("themeLight"),a=document.getElementById("themeDark");if(!e||!t||!a)return;[e,t,a].forEach(e=>e.classList.remove("active")),"auto"===oi?e.classList.add("active"):"light"===oi?t.classList.add("active"):a.classList.add("active");const o=document.getElementById("themeStatus");if(o){const e=b();o.textContent="auto"===oi?e.isDarkMode?"🌙 Auto (Dark)":"☀️ Auto (Light)":"light"===oi?"☀️ Light Mode":"🌙 Dark Mode"}})()})(a);try{localStorage.setItem("theme-preference",e)}catch(o){}pt(`🎨 Theme set to: ${e} (rendering: ${a?"dark":"light"})`)}function bt(){if(ii)return;ii=!0,(()=>{const e=b(),t=document.documentElement;e?.bgLight&&(t.style.setProperty("--bg-light",e.bgLight),t.style.setProperty("--chrome-bg-light",e.bgLight)),e?.bgDark&&(t.style.setProperty("--bg-dark",e.bgDark),t.style.setProperty("--chrome-bg-dark",e.bgDark)),e?.frameColorLight&&t.style.setProperty("--frame-color-light",e.frameColorLight),e?.frameColorDark&&t.style.setProperty("--frame-color-dark",e.frameColorDark);const a=e.isDarkMode?e?.frameColorDark:e?.frameColorLight;if(a){const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=a),t.style.setProperty("--chrome-bg",a)}e?.textColorLight&&t.style.setProperty("--text-color-light",e.textColorLight),e?.textColorLightMuted&&t.style.setProperty("--text-color-light-muted",e.textColorLightMuted),e?.textColorDark&&t.style.setProperty("--text-color-dark",e.textColorDark),e?.textColorDarkMuted&&t.style.setProperty("--text-color-dark-muted",e.textColorDarkMuted),e?.edgeLabelColorLight&&t.style.setProperty("--edge-label-color-light",e.edgeLabelColorLight),e?.edgeLabelColorDark&&t.style.setProperty("--edge-label-color-dark",e.edgeLabelColorDark),Number.isFinite(e?.edgeLabelInsetAdjustPx)&&t.style.setProperty("--edge-label-inset-adjust",e.edgeLabelInsetAdjustPx+"px"),e?.linkHoverColor&&t.style.setProperty("--link-hover-color",e.linkHoverColor),e?.logoColorLight&&t.style.setProperty("--logo-color-light",e.logoColorLight),e?.logoColorDark&&t.style.setProperty("--logo-color-dark",e.logoColorDark),e?.portfolioLogoColorLight&&t.style.setProperty("--portfolio-logo-color-light",e.portfolioLogoColorLight),e?.portfolioLogoColorDark&&t.style.setProperty("--portfolio-logo-color-dark",e.portfolioLogoColorDark)})(),ni=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",pt("🖥️ System prefers: "+ni);let e="auto";try{const t=localStorage.getItem("theme-preference");"auto"!==t&&"light"!==t&&"dark"!==t||(e=t)}catch(n){}gt(e);const t=document.getElementById("themeAuto"),a=document.getElementById("themeLight"),o=document.getElementById("themeDark");t&&t.addEventListener("click",()=>gt("auto")),a&&a.addEventListener("click",()=>gt("light")),o&&o.addEventListener("click",()=>gt("dark")),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{ni=e.matches?"dark":"light",pt("🖥️ System preference changed to: "+ni),"auto"===oi&&gt("auto")}),window.setInterval(()=>{"auto"===oi&&gt("auto")},6e4),pt("✓ Modern dark mode initialized")}function yt(){gt("light"===oi?"dark":"light")}function Mt(e){const t={};if(!e||"object"!=typeof e)return t;for(const a of yi)({}).hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}function vt(e,t,a,o){const n="number"==typeof e?e:+e;return Number.isFinite(n)?Math.min(a,Math.max(t,n)):o}function wt(e,t,a,o){const n="number"==typeof e?e:+e;return Number.isFinite(n)?Math.min(a,Math.max(t,Math.round(n))):o}function xt(e,t=0){return vt(e,0,1,t)}function St(e,t,a){return t.includes(e)?e:a}function kt(e,t){try{const a=getComputedStyle(document.documentElement).getPropertyValue(e).trim(),o=Number.parseFloat(a);return Number.isFinite(o)?o:t}catch{return t}}function Ct(e){let t=e>>>0;return()=>{t+=1831565813;let e=t;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}}function Pt(e){const t=(e()+e()+e())/3;return Math.max(0,Math.min(1,.5+1.15*(t-.5)))}function Ft(e){const t=document.documentElement;t.style.setProperty("--abs-noise-enabled",e.noiseEnabled?"1":"0");const a=e.noiseMotion,o="drift"===a?"linear":"steps(1, end)";t.style.setProperty("--abs-noise-keyframes","static"===a?"none":"drift"===a?"abs-noise-drift":"abs-noise-jitter"),t.style.setProperty("--abs-noise-timing",o),t.style.setProperty("--abs-noise-speed-back",Math.max(0,Math.round(e.noiseSpeedBackMs))+"ms"),t.style.setProperty("--abs-noise-speed-front",Math.max(0,Math.round(e.noiseSpeedFrontMs))+"ms"),t.style.setProperty("--abs-noise-motion-amount",e.noiseMotionAmount+""),t.style.setProperty("--abs-noise-flicker",e.noiseFlicker+""),t.style.setProperty("--abs-noise-flicker-speed",Math.max(0,Math.round(e.noiseFlickerSpeedMs))+"ms");const n=vt(e.noiseBlurPx,0,6,0);t.style.setProperty("--abs-noise-blur",n.toFixed(2)+"px"),t.style.setProperty("--abs-noise-filter",n>0?`blur(${n.toFixed(2)}px)`:"none");const i=vt(e.noiseMotionAmount,0,2.5,1),r="static"!==e.noiseMotion&&i>0,l=vt(.55*vt(e.noiseSizeTop,20,600,150),24,120,82),s=r?l*i:0;t.style.setProperty("--abs-noise-overscan",`-${Math.ceil(s+(n>0?6*n:0)+32)}px`);const c=Ct((2772082231^e.noiseSeed)>>>0);for(let p=1;40>=p;p++){const e=.9*(2*c()-1)*s,a=.9*(2*c()-1)*s;t.style.setProperty(`--abs-noise-j${p}-x`,Math.round(e)+"px"),t.style.setProperty(`--abs-noise-j${p}-y`,Math.round(a)+"px")}const d=c()*Math.PI*2;t.style.setProperty("--abs-noise-drift-x",Math.round(Math.cos(d)*s)+"px"),t.style.setProperty("--abs-noise-drift-y",Math.round(Math.sin(d)*s)+"px"),t.style.setProperty("--noise-size-base",Math.round(e.noiseSizeBase)+"px"),t.style.setProperty("--noise-size-top",Math.round(e.noiseSizeTop)+"px"),t.style.setProperty("--noise-back-opacity-light",e.noiseBackOpacity+""),t.style.setProperty("--noise-front-opacity-light",e.noiseFrontOpacity+""),t.style.setProperty("--noise-back-opacity-dark",e.noiseBackOpacityDark+""),t.style.setProperty("--noise-front-opacity-dark",e.noiseFrontOpacityDark+""),t.style.setProperty("--noise-top-opacity",e.noiseTopOpacity+""),t.style.setProperty("--detail-noise-opacity",(e.detailNoiseOpacity??1)+"")}function Tt(e={}){const t=kt("--noise-size-base",100),a=kt("--noise-size-top",150),o=kt("--noise-back-opacity-light",.025),n=kt("--noise-front-opacity-light",.055),i=kt("--noise-back-opacity-dark",.12),r=kt("--noise-front-opacity-dark",.08),l=kt("--noise-top-opacity",.01),s={noiseSeed:wt(e.noiseSeed,0,999999,1337),noiseTextureSize:wt(e.noiseTextureSize,64,512,256),noiseDistribution:St(e.noiseDistribution,["uniform","gaussian"],"gaussian"),noiseMonochrome:void 0===e.noiseMonochrome||!!e.noiseMonochrome,noiseChroma:xt(e.noiseChroma,.35),noiseEnabled:void 0===e.noiseEnabled||!!e.noiseEnabled,noiseMotion:St(e.noiseMotion,["jitter","drift","static"],"jitter"),noiseMotionAmount:vt(e.noiseMotionAmount,0,2.5,1),noiseSpeedBackMs:wt(e.noiseSpeedBackMs,0,1e4,1800),noiseSpeedFrontMs:wt(e.noiseSpeedFrontMs,0,1e4,1100),noiseFlicker:vt(e.noiseFlicker,0,1,.12),noiseFlickerSpeedMs:wt(e.noiseFlickerSpeedMs,0,5e3,220),noiseBlurPx:vt(e.noiseBlurPx,0,6,0),noiseContrast:vt(e.noiseContrast,.25,5,1.35),noiseBrightness:vt(e.noiseBrightness,.25,3,1),noiseSaturation:vt(e.noiseSaturation,0,3,1),noiseHue:vt(e.noiseHue,0,360,0),noiseSizeBase:vt(e.noiseSizeBase,20,400,t),noiseSizeTop:vt(e.noiseSizeTop,20,600,a),noiseBackOpacity:vt(e.noiseBackOpacity,0,.3,o),noiseFrontOpacity:vt(e.noiseFrontOpacity,0,.3,n),noiseBackOpacityDark:vt(e.noiseBackOpacityDark,0,.5,i),noiseFrontOpacityDark:vt(e.noiseFrontOpacityDark,0,.5,r),noiseTopOpacity:vt(e.noiseTopOpacity,0,.25,l),detailNoiseOpacity:vt(e.detailNoiseOpacity,0,1,1)};return s.noiseMonochrome&&(s.noiseChroma=xt(s.noiseChroma,.35)),s}function It(e,{force:t=!1}={}){const a=JSON.stringify({seed:e.noiseSeed,size:e.noiseTextureSize,distribution:e.noiseDistribution,monochrome:e.noiseMonochrome,chroma:e.noiseChroma,contrast:(+e.noiseContrast).toFixed(3),brightness:(+e.noiseBrightness).toFixed(3),saturation:(+e.noiseSaturation).toFixed(3),hue:(+e.noiseHue).toFixed(1)});if(e.noiseEnabled)(t||a!==bi)&&(bi=a,gi&&window.clearTimeout(gi),gi=window.setTimeout(async()=>{gi=null;const t=++mi,a=await(async({size:e,seed:t,distribution:a,monochrome:o,chroma:n,contrast:i,brightness:r,saturation:l,hue:s})=>{const c=(e=>(ci||(ci=document.createElement("canvas"),di=ci.getContext("2d",{willReadFrequently:!0})),di?(ci.width!==e&&(ci.width=e),ci.height!==e&&(ci.height=e),hi!==e&&(hi=e,pi=null,ui=null),di):null))(e);if(!c)return null;pi||(pi=c.createImageData(e,e),ui=new Uint32Array(pi.data.buffer));const d=ui,p=Ct(t),u="gaussian"===a,h=xt(n,0),f=1-h,m=vt(i,.25,5,1),g=vt(r,.25,3,1),b=vt(l,0,3,1),y=vt(s,0,360,0),M=1!==m||1!==g,v=1!==b,w=0!==y,x=.213,S=.715,k=.072;let C=1,P=0,F=0,T=0,I=1,D=0,L=0,A=0,K=1;if(w){const e=y*Math.PI/180,t=Math.cos(e),a=Math.sin(e);C=x+.787*t-a*x,P=S-t*S-a*S,F=k-t*k+.928*a,T=x-t*x+.143*a,I=S+t*(1-S)+.14*a,D=k-t*k-.283*a,L=x-t*x-.787*a,A=S-t*S+a*S,K=k+.928*t+a*k}for(let W=0;d.length>W;W++){const e=u?Pt(p):p();let t=e,a=e,n=e;if(o||(t=e*f+(u?Pt(p):p())*h,a=e*f+(u?Pt(p):p())*h,n=e*f+(u?Pt(p):p())*h),M&&(t=(t-.5)*m+.5,a=(a-.5)*m+.5,n=(n-.5)*m+.5,t*=g,a*=g,n*=g),v){const e=t*x+a*S+n*k;t=e*(1-b)+t*b,a=e*(1-b)+a*b,n=e*(1-b)+n*b}if(w){const e=t*T+a*I+n*D,o=t*L+a*A+n*K;t=t*C+a*P+n*F,a=e,n=o}const i=Math.max(0,Math.min(255,Math.round(255*t))),r=Math.max(0,Math.min(255,Math.round(255*a)));d[W]=255<<24|Math.max(0,Math.min(255,Math.round(255*n)))<<16|r<<8|i}c.putImageData(pi,0,0);const O=await(async e=>await new Promise(t=>{try{e.toBlob(e=>t(e),"image/png")}catch(a){t(null)}}))(ci);return O?URL.createObjectURL(O):null})({size:e.noiseTextureSize,seed:e.noiseSeed,distribution:e.noiseDistribution,monochrome:e.noiseMonochrome,chroma:e.noiseChroma,contrast:e.noiseContrast,brightness:e.noiseBrightness,saturation:e.noiseSaturation,hue:e.noiseHue});if(t===mi){if(a)try{document.documentElement.style.setProperty("--abs-noise-texture",`url("${a}")`),fi&&URL.revokeObjectURL(fi),fi=a}catch(o){URL.revokeObjectURL(a)}}else a&&URL.revokeObjectURL(a)},140));else{gi&&window.clearTimeout(gi),gi=null,mi++,bi="";try{document.documentElement.style.setProperty("--abs-noise-texture","none")}catch(o){}if(fi)try{URL.revokeObjectURL(fi)}catch(o){}fi=null}}function Dt(e={}){const t=si||Tt({});return Tt({...t,...Mt(e)})}function Lt(e={}){si=Dt(e),li=!0,Ft(si),It(si,{force:!0})}function At(e={}){li||Lt(e),si=Dt(e),Ft(si),It(si)}function Kt(){console.log("⚠️ localStorage is disabled")}function Ot(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(Kt,500)}async function Wt(e,t,a){if(!lt())return;if(!t)return void console.warn("[config-sync] Invalid sync request:",{configType:e,path:t});const o=((e,t)=>`${e}:${t}`)(e,t);Mi.set(o,{configType:e,path:t,value:a}),vi.has(o)&&clearTimeout(vi.get(o));const n=setTimeout(async()=>{vi.delete(o);const e=Mi.get(o);if(e){Mi.delete(o);try{const t=await fetch("http://localhost:8002/api/config-sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({configType:e.configType,path:e.path,value:e.value})});if(!t.ok){const e=await t.json().catch(()=>({error:"Unknown error"}));return void console.warn("[config-sync] Sync failed:",e.error||"HTTP "+t.status)}await t.json().catch(()=>null)}catch(t){"TypeError"!==t?.name&&console.warn("[config-sync] Sync error:",t?.message)}}},300);vi.set(o,n)}function zt(e){return!1!==wi[e]}function Et(e){return{id:e,label:"Warmup Frames",stateKey:e,type:"range",min:0,max:240,step:1,default:10,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0,hint:"Pre-runs physics before first render to avoid visible settling on mode start."}}function Rt(e,t){try{if("function"==typeof e?.format)return e.format(t)}catch(a){}return(t??"")+""}function Bt(){const e=[];for(const t of Object.values(ki))for(const a of t.controls)e.push({...a,section:t.title});return e}function Vt(e){if("divider"===e.type)return`<div class="control-divider"><span class="control-divider-label">${e.label||""}</span></div>`;if(!zt(e.id))return"";const t=e.id+"Slider",a=e.id+"Val",o=e.id+"Picker",n=e.hint?` title="${i=e.hint,((i??"")+"").replaceAll("&","&amp;").replaceAll('"',"&quot;").replaceAll("'","&#39;").replaceAll("<","&lt;").replaceAll(">","&gt;")}"`:"";var i;if("colorDistribution"===e.type){const t=(Array.isArray(e.labels)?e.labels:[]).map((e,t)=>{const a=((e||"")+"").trim();return`\n        <div class="color-dist-row" data-color-dist-row="${t}">\n          <div class="color-dist-row-label">${a}</div>\n          <div class="color-dist-row-controls">\n            <span class="color-dist-swatch" id="${"colorDistSwatch"+t}" aria-hidden="true"></span>\n            <select id="${"colorDistColor"+t}" class="control-select color-dist-select" aria-label="${a} color"></select>\n            <input type="range" id="${"colorDistWeight"+t}" min="0" max="100" step="1" value="0" aria-label="${a} weight">\n            <span class="color-dist-weight" id="${"colorDistWeightVal"+t}">0%</span>\n          </div>\n        </div>`}).join("");return`\n      <div class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label">${e.label}</span>\n          <span class="control-value" id="colorDistTotalVal">100%</span>\n        </div>\n        <div class="color-dist-grid" id="colorDistGrid">\n          ${t}\n        </div>\n        <div class="color-dist-actions">\n          <button type="button" class="secondary" id="colorDistResetBtn" aria-label="Reset color distribution to defaults">Reset Defaults</button>\n        </div>\n      </div>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`}if("color"===e.type)return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label"${n}>${e.label}</span>\n          <span class="control-value" id="${a}">${e.default}</span>\n        </div>\n        <input type="color" id="${o}" value="${e.default}" aria-label="${e.label}" />\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`;if("select"===e.type){const o=(Array.isArray(e.options)?e.options:[]).map(t=>{const a=t.value+"";return`<option value="${a}" ${e.default+""===a?"selected":""}>${(t.label??t.value)+""}</option>`}).join(""),i=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label"${n}>${e.label}</span>\n          <span class="control-value" id="${a}">${Rt(e,e.default)}</span>\n        </div>\n        <select id="${t}" class="control-select" aria-label="${e.label}">\n          ${o}\n        </select>\n      </label>\n      ${i}`}if("checkbox"===e.type||"toggle"===e.type)return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label"${n}>${e.label}</span>\n          <span class="control-value" id="${a}">${e.default?"On":"Off"}</span>\n        </div>\n        <input type="checkbox" id="${t}" ${e.default?"checked":""} aria-label="${e.label}">\n      </label>\n      ${e.hint?`<p class="control-hint">${e.hint}</p>`:""}`;const r=e.hint?`<p class="control-hint">${e.hint}</p>`:"";return`\n      <label class="control-row" data-control-id="${e.id}">\n        <div class="control-row-header">\n          <span class="control-label"${n}>${e.label}</span>\n          <span class="control-value" id="${a}">${Rt(e,e.default)}</span>\n        </div>\n        <input type="range" id="${t}" min="${e.min}" max="${e.max}" step="${e.step}" value="${e.default}">\n      </label>\n      ${r}`}function Nt(e,t){const a=t.controls.filter(e=>zt(e.id));if(0===a.length)return"";let o=null,n="";for(const s of a)s.group&&s.group!==o?(null!==o&&(n+="</div>"),n+=`<div class="section-title" style="margin-top: 12px;">${s.group}</div><div class="group ${s.groupLayout||""}">`,o=s.group):s.group||null===o||(n+="</div>",o=null),n+=Vt(s);null!==o&&(n+="</div>");const i=t.defaultOpen?"open":"",r=`\n    <summary class="panel-section-header">\n      ${t.icon?`<span class="section-icon">${t.icon}</span>`:""}\n      <span class="section-label">${t.title}</span>\n    </summary>`,l=`<div class="panel-section-content">${n}</div>`;return t.mode?`\n      <div id="${t.mode}Controls" class="mode-controls">\n        <details class="panel-section-accordion" ${i}>\n          ${r}\n          ${l}\n        </details>\n      </div>`:`\n    <details class="panel-section-accordion" ${i}>\n      ${r}\n      ${l}\n    </details>`}function $t({open:e=!0}={}){return`\n    <details class="panel-section-accordion" ${e?"open":""}>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎨</span>\n        <span class="section-label">Theme</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="theme-segment-control" role="group" aria-label="Theme selector">\n          <button id="themeAuto" class="theme-segment-btn" aria-label="Auto theme">Auto</button>\n          <button id="themeLight" class="theme-segment-btn active" aria-label="Light theme">Light</button>\n          <button id="themeDark" class="theme-segment-btn" aria-label="Dark theme">Dark</button>\n        </div>\n        <div id="themeStatus" class="panel-status">☀️ Light Mode</div>\n      </div>\n    </details>`}function _t({open:e=!1}={}){return`\n    <details class="panel-section-accordion" ${e?"open":""}>\n      <summary class="panel-section-header">\n        <span class="section-icon">🌈</span>\n        <span class="section-label">Palette</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Color Template</span>\n            <span class="control-value"></span>\n          </div>\n          <select id="colorSelect"></select>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Rotate on Reload</span>\n            <span class="control-value"></span>\n          </div>\n          <input id="paletteRotateOnReload" type="checkbox" />\n        </label>\n      </div>\n    </details>`}function Gt(){let e="",t=null;for(const a of xi){if(!ki[a])continue;const o=Si[a]||null;o&&o!==t?(null!==t&&(e+="</div>"),e+=`\n        <div class="panel-category-group">\n          <div class="panel-category-label">${o}</div>`,t=o):o||null===t||(e+="</div>",t=null),e+=Nt(0,ki[a])}return null!==t&&(e+="</div>"),e}function Ht(){let e=`\n    <div role="status" aria-live="polite" aria-atomic="true" class="sr-only" id="announcer"></div>\n    ${(()=>{const e=Object.entries(ki).filter(([,e])=>e?.mode).map(([e,t])=>Nt(0,t)).join("");return`\n    <details class="panel-section-accordion" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">🎛️</span>\n        <span class="section-label">Mode</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="mode-switcher" role="group" aria-label="Simulation mode selector">\n          ${(()=>{const e={pit:"🎯",bubbles:"🫧",critters:"🪲",flies:"🕊️","pit-throws":"🎯",water:"🌊",vortex:"🌀",magnetic:"🧲","ping-pong":"🏓",weightless:"🌌",kaleidoscope:"🪞","kaleidoscope-1":"🪞","kaleidoscope-2":"🪞","kaleidoscope-3":"🪞","orbit-3d":"🌪️","orbit-3d-2":"🌪️",lattice:"💎",neural:"🧠"},t={pit:"Pit",bubbles:"Bubbles",critters:"Critters",flies:"Flies","pit-throws":"Throws",water:"Water",vortex:"Vortex",magnetic:"Magnet","ping-pong":"Pong",weightless:"Zero-G",kaleidoscope:"Kalei","kaleidoscope-1":"Kalei I","kaleidoscope-2":"Kalei II","kaleidoscope-3":"Kalei III","orbit-3d":"Orbit","orbit-3d-2":"Swarm",lattice:"Lattice",neural:"Neural"};let a="";return ro.forEach(o=>{const n=t[o]||o;a+=`<button class="mode-button" data-mode="${o}" aria-label="${lo[o]||n} mode">${e[o]||"⚪"} ${n}</button>`}),a})()}\n        </div>\n        ${e}\n      </div>\n    </details>`})()}\n  `;for(const[t,a]of Object.entries(ki))a?.mode||xi.includes(t)||(e+=Nt(0,a));return e}function jt(e={}){const t=b(),a=!1!==e.runOnChange;for(const o of Object.values(ki))for(const e of o.controls){if("colorDistribution"===e.type)continue;const o=e.id+"Val",n=document.getElementById("color"===e.type?e.id+"Picker":e.id+"Slider"),i=document.getElementById(o);if(!n||!e.stateKey)continue;const r=t[e.stateKey];void 0!==r&&("checkbox"===e.type||"toggle"===e.type?(n.checked=!!r,i&&(i.textContent=r?"On":"Off")):"color"===e.type?(n.value=r,i&&(i.textContent=r)):(n.value=r,i&&(i.textContent=e.format?e.format(r):r+"")),a&&e.onChange&&"wallPreset"!==e.id&&e.onChange(t,r))}}function Zt(){(()=>{const e=b();for(const[a,o]of Object.entries(ki))for(const n of o.controls){const i=document.getElementById(n.id+"Val");if("colorDistribution"===n.type){const l=Array.isArray(n.labels)?n.labels:[],s=document.getElementById("colorDistResetBtn");function c(e){return((e||"")+"").trim().toLowerCase()}function d(e,t,a,o=t){const n=+e;if(!Number.isFinite(n))return o;const i=Math.floor(n);return t>i?t:i>a?a:i}function p(e){const t=[];for(let a=0;8>a;a++)t.push({value:a+"",label:`Ball ${a+1}${e[a]?" — "+e[a]:""}`});return t}function u(t){const a=Array.isArray(e.colorDistribution)?e.colorDistribution:[],o=new Map;for(const e of a)o.set(c(e?.label),e);const n=Array.isArray(t)?t:a,i=[],r=new Set;for(let e=0;l.length>e;e++){const t=((l[e]||"")+"").trim(),a=c(t),s=n.find(e=>c(e?.label)===a)||o.get(a)||{};let p=d(s?.colorIndex,0,7,d(o.get(a)?.colorIndex,0,7,0));if(r.has(p))for(let e=0;8>e;e++)if(!r.has(e)){p=e;break}r.add(p);const u=d(s?.weight,0,100,d(o.get(a)?.weight,0,100,0));i.push({label:t,colorIndex:p,weight:u})}return i}function h(e,t=0){const a=e.map(e=>d(e,0,100,0));let o=0;for(let l=0;a.length>l;l++)o+=a[l];if(100===o)return a;if(0===o)return a[t]=100,a;const n=Array(a.length).fill(0);let i=0;for(let l=0;a.length>l;l++){const e=Math.round(a[l]/o*100);n[l]=e,i+=e}let r=100-i;for(;0!==r;)if(r>0){let e=0;for(let t=1;n.length>t;t++)n[t]>n[e]&&(e=t);n[e]+=1,r-=1}else{let e=-1;for(let t=0;n.length>t;t++)n[t]>0&&(-1===e||n[t]>n[e])&&(e=t);if(-1===e)break;n[e]-=1,r+=1}return n.map(e=>d(e,0,100,0))}function f(e,t,a){const o=e.map(e=>d(e?.weight,0,100,0));return o[t]=d(a,0,100,o[t]),100===o.reduce((e,t)=>e+t,0)?o:h(o,t)}function m(){const t={pit:null,"pit-throws":null,flies:e.fliesBallCount,weightless:e.weightlessCount,water:e.waterBallCount,vortex:e.vortexBallCount,"ping-pong":e.pingPongBallCount,magnetic:e.magneticBallCount,bubbles:e.bubblesMaxCount,kaleidoscope:e.kaleidoscopeBallCount,"kaleidoscope-1":e.kaleidoscope1BallCount,"kaleidoscope-2":e.kaleidoscope2BallCount,"kaleidoscope-3":e.kaleidoscope3BallCount,critters:e.critterCount,neural:e.neuralBallCount,lattice:e.latticeBallCount,orbit3d:e.orbit3dMoonCount,orbit3d2:e.orbit3d2MoonCount}[e.currentMode];return Number.isFinite(+t)?+t:null}function g(){Promise.resolve().then(()=>kr).then(({applyExpertiseLegendColors:e})=>e?.()).catch(()=>{}),Promise.resolve().then(()=>Fo).then(({pickRandomColor:t})=>{if("function"!=typeof t)return;const a=e.balls||[];for(let e=0;a.length>e;e++)a[e].color=t()}).catch(()=>{})}function y(){const t=u(e.colorDistribution),a=h(t.map(e=>e.weight),0);for(let e=0;t.length>e;e++)t[e].weight=a[e];e.colorDistribution=t;const o={};for(let e=0;t.length>e;e++)o[t[e].colorIndex]=t[e].label;const n=p(o),i=m();for(let e=0;l.length>e;e++){const a=t[e]||{colorIndex:0,weight:0},r=document.getElementById("colorDistSwatch"+e),l=document.getElementById("colorDistColor"+e),s=document.getElementById("colorDistWeight"+e),c=document.getElementById("colorDistWeightVal"+e);if(l){l.innerHTML="";for(const e of n){const t=document.createElement("option");t.value=e.value,t.textContent=e.label;const n=d(e.value,0,7,0);o[n]&&!(n===a.colorIndex)&&(t.disabled=!0),l.appendChild(t)}l.value=a.colorIndex+""}if(s&&(s.value=d(a.weight,0,100,0)+""),c){const e=d(a.weight,0,100,0),t=null!=i?Math.round(e/100*i):null;c.textContent=null!=t?`${e}% (≈${t})`:e+"%"}if(r){const e=d(a.colorIndex,0,7,0);r.style.backgroundColor=`var(--ball-${e+1})`}}const r=document.getElementById("colorDistTotalVal");if(r){let e=0;for(let a=0;t.length>a;a++)e+=t[a].weight;r.textContent=e+"%"}}try{y()}catch(t){}s&&s.addEventListener("click",()=>{const t=e?.config?.colorDistribution;e.colorDistribution=u(t);const a=h(e.colorDistribution.map(e=>e.weight),0);for(let o=0;e.colorDistribution.length>o;o++)e.colorDistribution[o].weight=a[o];y(),g(),Ot()});for(let M=0;l.length>M;M++){const v=document.getElementById("colorDistColor"+M),w=document.getElementById("colorDistWeight"+M);v&&v.addEventListener("change",()=>{const t=d(v.value,0,7,0),a=u(e.colorDistribution);a[M].colorIndex=t,e.colorDistribution=a,y(),g(),Ot()}),w&&w.addEventListener("input",()=>{const t=d(w.value,0,100,0),a=u(e.colorDistribution),o=f(a,M,t);for(let e=0;a.length>e;e++)a[e].weight=o[e];e.colorDistribution=a,y(),g(),Ot()})}continue}if("color"===n.type){const x=document.getElementById(n.id+"Picker");if(!x)continue;x.addEventListener("input",()=>{const t=x.value;n.stateKey&&(e[n.stateKey]=t),n.onChange&&n.onChange(e,t),i&&(i.textContent=t),n.stateKey&&Wt("default",n.stateKey,t),Ot()});continue}if("select"===n.type){const S=document.getElementById(n.id+"Slider");if(!S)continue;S.addEventListener("change",()=>{const t=n.parse?n.parse(S.value):S.value;if(n.stateKey&&(e[n.stateKey]=t),n.onChange&&n.onChange(e,t),i){const a=n.stateKey?e[n.stateKey]:t;i.textContent=n.format?n.format(a):a+""}n.stateKey&&Wt("default",n.stateKey,t),Ot()});continue}if("checkbox"===n.type||"toggle"===n.type){const k=document.getElementById(n.id+"Slider");if(!k)continue;k.addEventListener("change",()=>{const t=!!k.checked;n.stateKey&&(e[n.stateKey]=t),n.onChange&&n.onChange(e,t),i&&(i.textContent=t?"On":"Off"),n.reinitMode&&e.currentMode===o.mode&&Promise.resolve().then(()=>Cn).then(({resetCurrentMode:e})=>e?.()).catch(()=>{}),n.stateKey&&Wt("default",n.stateKey,t),Ot()});continue}const r=document.getElementById(n.id+"Slider");r&&r.addEventListener("input",()=>{const t="function"==typeof n?.parse?n.parse(r.value):Number.parseFloat(r.value);n.stateKey&&(e[n.stateKey]=t),n.onChange&&n.onChange(e,t),i&&(i.textContent=n.format(n.stateKey?e[n.stateKey]:t)),n.reinitMode&&e.currentMode===o.mode&&Promise.resolve().then(()=>Cn).then(({resetCurrentMode:e})=>e?.()).catch(()=>{}),n.stateKey&&Wt("default",n.stateKey,t),Ot()})}})(),X();const e=document.getElementById("colorSelect");e&&e.addEventListener("change",()=>{Y(e.value),Ot()});const t=document.getElementById("themeAuto"),a=document.getElementById("themeLight"),o=document.getElementById("themeDark");[t,a,o].forEach(e=>{e&&e.addEventListener("click",()=>{[t,a,o].forEach(e=>e?.classList.remove("active")),e.classList.add("active")})})}function Yt(){Zt(),document.querySelectorAll(".mode-button").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const a=e.getAttribute("data-mode");console.log("Mode button clicked:",a),Promise.resolve().then(()=>Cn).then(({setMode:e})=>{e(a),Xt(a)}).catch(()=>{})})})}function Xt(e){document.querySelectorAll(".mode-button").forEach(t=>{const a=t.getAttribute("data-mode")===e;t.classList.toggle("active",a)}),document.querySelectorAll(".mode-controls").forEach(e=>e.classList.remove("active"));const t=document.getElementById(e+"Controls");t&&t.classList.add("active");const a=document.getElementById("announcer");a&&(a.textContent=`Switched to ${{critters:"Critters",pit:"Ball Pit","pit-throws":"Ball Pit (Throws)",flies:"Flies to Light",weightless:"Zero-G",water:"Water Swimming",vortex:"Vortex Sheets","ping-pong":"Ping Pong",magnetic:"Magnetic",bubbles:"Carbonated Bubbles",kaleidoscope:"Kaleidoscope","kaleidoscope-1":"Kaleidoscope I","kaleidoscope-2":"Kaleidoscope II","kaleidoscope-3":"Kaleidoscope III","orbit-3d":"Orbit 3D","orbit-3d-2":"Orbit 3D (Tight Swarm)",lattice:"Crystal Lattice",neural:"Neural Network"}[e]||e} mode`);try{const t=document.getElementById("edge-chapter-text");t&&(t.textContent=lo?.[e]||"—")}catch(o){}}function Ut(e,t){const a=t();for(const o of Object.values(Fi))for(const t of o.controls){const o=e.querySelector("#sound_"+t.id),n=e.querySelector(`#sound_${t.id}_val`);if(!o||void 0===a[t.id])continue;const i=t.fromConfig(a[t.id]);o.value=i,n&&(n.textContent=t.format(i))}}function qt(e){try{localStorage.setItem(Di.dockHidden,e+"")}catch(t){}}function Jt(e){if(e.target.closest("button")||e.target.closest("input")||e.target.closest("select"))return;if(!Ti)return;const t=e.touches?e.touches[0].clientX:e.clientX,a=e.touches?e.touches[0].clientY:e.clientY,o=Ti.getBoundingClientRect();Ai=t,Ki=a,Oi=o.left,Wi=o.top,Li=!1}function Qt(e){if(0===Ai&&0===Ki)return;if(!Ti)return;const t=(e.touches?e.touches[0].clientX:e.clientX)-Ai,a=(e.touches?e.touches[0].clientY:e.clientY)-Ki;if(Li||5>=Math.abs(t)&&5>=Math.abs(a)||(Li=!0,Ti.classList.add("dragging"),Ti.style.position="fixed",Ti.style.top=Wi+"px",Ti.style.left=Oi+"px",Ti.style.right="auto"),Li){let o=Oi+t,n=Wi+a;const i=Ti.getBoundingClientRect();o=Math.max(0,Math.min(window.innerWidth-i.width,o)),n=Math.max(0,Math.min(window.innerHeight-i.height,n)),Ti.style.left=o+"px",Ti.style.top=n+"px",e.preventDefault()}}function ea(){Li&&(Li=!1,Ti&&Ti.classList.remove("dragging"),ta()),Ai=0,Ki=0,setTimeout(()=>{},10)}function ta(){try{if(!Ti)return;localStorage.setItem(Di.position,JSON.stringify({left:Ti.style.left,top:Ti.style.top,custom:!0}))}catch(e){}}function aa(){if(!Ti)try{((e={})=>{if(!document.querySelector('link[href*="panel.css"]')){const e=document.createElement("link");e.rel="stylesheet",e.href="css/panel.css",document.head.appendChild(e)}const t=e.page||"home",a=e.pageLabel||("portfolio"===t?"Portfolio":"Home"),o=e.pageHTML||Pi,n=!!e.includePageSaveButton,i=e.pageSaveButtonId||"savePortfolioConfigBtn",r=e.footerHint||("portfolio"===t?"<kbd>/</kbd> panel":"<kbd>R</kbd> reset · <kbd>/</kbd> panel · <kbd>9</kbd> kalei · Critters + Throws have no key (yet)"),l=e.panelTitle||"Settings",c=e.modeLabel||(lt()?"DEV MODE":"BUILD MODE"),d=!!e.bindShortcut,p="function"==typeof e.setupPageControls?e.setupPageControls:null;try{const e=document.getElementById("controlPanel");e&&e.remove();const t=document.getElementById("soundPanel");t&&t.remove()}catch(h){}Ti=document.createElement("div"),Ti.className="panel-dock",Ti.id="panelDock";let u=(({defaultHidden:e=!0}={})=>{try{const t=localStorage.getItem(Di.dockHidden);return null===t?!!e:"true"===t}catch(h){return!!e}})({defaultHidden:"portfolio"===t||!lt()});try{u=!0}catch(h){}Ti.classList.toggle("hidden",!!u),qt(!!u),Ii=(({page:e,panelTitle:t,pageLabel:a,pageHTML:o,includePageSaveButton:n,pageSaveButtonId:i,footerHint:r,setupPageControls:l}={})=>{const c=document.createElement("div");c.id="masterPanel",c.className=(()=>{try{const e=localStorage.getItem(Di.panelCollapsed);return null===e||"true"===e}catch(h){return!0}})()?"panel collapsed":"panel",c.setAttribute("role","region"),c.setAttribute("aria-label","Settings");const d=document.createElement("div");d.className="panel-header",d.innerHTML=`\n    <div class="mac-titlebar">\n      <div class="mac-traffic" aria-hidden="true">\n        <span class="mac-dot mac-dot--red"></span>\n        <span class="mac-dot mac-dot--yellow"></span>\n        <span class="mac-dot mac-dot--green"></span>\n      </div>\n      <div class="panel-title mac-title">${t}</div>\n      <div class="mac-right">\n        ${lt()?'<button id="saveConfigBtn" class="panel-save-btn" aria-label="Save config" title="Save config to file">Save</button>':""}\n        <button class="collapse-btn mac-collapse" aria-label="Collapse panel" title="Collapse">▾</button>\n      </div>\n    </div>\n  `;const p=document.createElement("div");p.className="panel-content",p.innerHTML=(({pageLabel:e="Home",pageHTML:t=Pi,includePageSaveButton:a=!1,pageSaveButtonId:o="savePortfolioConfigBtn",footerHint:n="<kbd>R</kbd> reset · <kbd>/</kbd> panel · <kbd>9</kbd> kalei · Critters + Throws have no key (yet)"}={})=>{const i=b(),r=s(),l=i.layoutViewportWidthPx>0?Math.round(i.layoutViewportWidthPx)+"px":`Auto (${Math.round(r)}px)`,c=Math.max(0,Math.round(i.wallInset??3)),d=`\n    <details class="panel-section-accordion" id="layoutSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">📐</span>\n        <span class="section-label">Layout</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Viewport Width</span>\n            <span class="control-value" id="viewportWidthValue">${l}</span>\n          </div>\n          <input type="range" id="layoutViewportWidth" min="0" max="2400" step="10" value="${Math.round(i.layoutViewportWidthPx||0)}" />\n          <div class="control-hint">0 = Auto (uses current window width)</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Wall Inset</span>\n            <span class="control-value" id="wallInsetValue">${c}px</span>\n          </div>\n          <input type="range" id="layoutWallInset" min="0" max="20" value="${c}" />\n        </label>\n      </div>\n    </details>\n  `,p=`\n    <details class="panel-section-accordion" id="soundSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">🔊</span>\n        <span class="section-label">Sound</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="sound-enable-row">\n          <button id="soundEnableBtn" class="sound-enable-btn" aria-label="Enable sound" title="Enable sound">🔇</button>\n        </div>\n        <div id="soundControlsWrapper" class="sound-controls" style="display: none;">\n          <div class="sound-perf" aria-label="Sound performance controls">\n            <button type="button" id="soundTapBtn" class="sound-perf__btn" aria-label="Play test hit">▶︎</button>\n            <button type="button" id="soundResetBtn" class="sound-perf__btn" aria-label="Reset to preset">↺</button>\n            <button type="button" id="soundShuffleBtn" class="sound-perf__btn" aria-label="Shuffle (subtle) sound">🎲</button>\n            <span class="sound-perf__hint">wheel adjusts · shift/alt = fine</span>\n          </div>\n          <label class="control-row">\n            <span class="control-label">Preset</span>\n            <select id="soundPresetSelect" class="control-select"></select>\n          </label>\n          <p id="presetDescription" class="control-hint"></p>\n          ${(()=>{let e="";for(const[t,a]of Object.entries(Fi)){e+='<div class="sound-dock__section">',e+=`<div class="sound-dock__section-title">${a.title}</div>`,e+='<div class="sound-dock__group">';for(const t of a.controls)e+=`\n        <label class="sound-dock__row">\n          <span class="sound-dock__label">${t.label}</span>\n          <input type="range" \n            id="sound_${t.id}" \n            class="sound-dock__slider" \n            min="${t.min}" \n            max="${t.max}" \n            step="${t.step}">\n          <span class="sound-dock__val" id="sound_${t.id}_val">${t.format(t.fromConfig(0))}</span>\n        </label>`;e+="</div></div>"}return e})()}\n        </div>\n      </div>\n    </details>\n  `,u=`\n    <details class="panel-section-accordion" id="pageSection" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">⚙️</span>\n        <span class="section-label">${e}</span>\n      </summary>\n      <div class="panel-section-content">\n        ${t}\n      </div>\n    </details>\n  `,h=`\n    <div class="panel-section panel-section--action">\n      <button id="saveRuntimeConfigBtn" class="primary">💾 Save Config</button>\n      ${a?`<button id="${o}" class="primary">💾 Save ${e} Config</button>`:""}\n    </div>\n    <div class="panel-footer">${n}</div>\n  `;return`\n    ${$t({open:!0})}\n    ${Gt()}\n    ${d}\n    ${p}\n    ${_t({open:!1})}\n    ${u}\n    ${h}\n  `})({pageLabel:a,pageHTML:o,includePageSaveButton:n,pageSaveButtonId:i,footerHint:r}),c.appendChild(d),c.appendChild(p);const u=(()=>{try{const e=localStorage.getItem(Di.panelSize);if(!e)return null;const t=JSON.parse(e);if(!t||"object"!=typeof t)return null;const a=+t.width,o=+t.height;return Number.isFinite(a)&&Number.isFinite(o)?{width:Math.round(a),height:Math.round(o)}:null}catch(h){return null}})();if(u){const e=.8*window.innerHeight;(Math.abs(u.width-368)>5||Math.abs(u.height-e)>5)&&(c.style.width=u.width+"px",c.style.height=u.height+"px",c.style.maxHeight="none")}const g=d.querySelector("#saveConfigBtn");g&&lt()&&g.addEventListener("click",async e=>{e.preventDefault(),e.stopPropagation(),await(async()=>{if(!lt())return;const t=b(),a=document.getElementById("saveConfigBtn"),o=a?.textContent||"Save";a&&(a.textContent="Saving...",a.disabled=!0);try{const n={};try{const e=Bt();for(const a of e){if(!a||!a.stateKey)continue;const e=t[a.stateKey];void 0!==e&&(n[a.stateKey]=e)}}catch(e){console.warn("[save-config] Error collecting controls:",e)}n.chromeHarmonyMode=t.chromeHarmonyMode,n.autoDarkModeEnabled=t.autoDarkModeEnabled,n.autoDarkNightStartHour=t.autoDarkNightStartHour,n.autoDarkNightEndHour=t.autoDarkNightEndHour,n.ballMassKg=t.ballMassKg,n.REST=t.REST,n.FRICTION=t.FRICTION,n.physicsCollisionIterations=t.physicsCollisionIterations,n.physicsSkipSleepingCollisions=t.physicsSkipSleepingCollisions,n.physicsSpatialGridOptimization=t.physicsSpatialGridOptimization,n.physicsSleepThreshold=t.physicsSleepThreshold,n.physicsSleepTime=t.physicsSleepTime,n.physicsSkipSleepingSteps=t.physicsSkipSleepingSteps,n.sizeScale=t.sizeScale,n.responsiveScaleMobile=t.responsiveScaleMobile,n.mobileObjectReductionFactor=t.mobileObjectReductionFactor,n.ballSoftness=t.ballSoftness,n.ballSpacing=t.ballSpacing,n.sizeVariationGlobalMul=t.sizeVariationGlobalMul,n.sizeVariationCap=t.sizeVariationCap,n.cursorInfluenceRadiusVw=t.cursorInfluenceRadiusVw,n.cursorSize=t.cursorSize,n.mouseTrailEnabled=t.mouseTrailEnabled,n.mouseTrailLength=t.mouseTrailLength,n.mouseTrailSize=t.mouseTrailSize,n.mouseTrailFadeMs=t.mouseTrailFadeMs,n.mouseTrailOpacity=t.mouseTrailOpacity,n.contentPaddingRatio=t.contentPaddingRatio,n.contentPaddingHorizontalRatio=t.contentPaddingHorizontalRatio,void 0!==t.uiHitAreaMul&&(n.uiHitAreaMul=t.uiHitAreaMul),void 0!==t.uiIconCornerRadiusMul&&(n.uiIconCornerRadiusMul=t.uiIconCornerRadiusMul),t.uiIconFramePx&&(n.uiIconFramePx=t.uiIconFramePx),t.uiIconGlyphPx&&(n.uiIconGlyphPx=t.uiIconGlyphPx),void 0!==t.uiIconGroupMarginPx&&(n.uiIconGroupMarginPx=t.uiIconGroupMarginPx),n.linkTextPadding=t.linkTextPadding,n.linkIconPadding=t.linkIconPadding,void 0!==t.footerNavBarTopVh&&(n.footerNavBarTopVh=t.footerNavBarTopVh),void 0!==t.footerNavBarGapVw&&(n.footerNavBarGapVw=t.footerNavBarGapVw),void 0!==t.homeMainLinksBelowLogoPx&&(n.homeMainLinksBelowLogoPx=t.homeMainLinksBelowLogoPx),void 0!==t.edgeLabelInsetAdjustPx&&(n.edgeLabelInsetAdjustPx=t.edgeLabelInsetAdjustPx),n.linkColorInfluence=t.linkColorInfluence,n.linkImpactScale=t.linkImpactScale,n.linkImpactBlur=t.linkImpactBlur,n.linkImpactDuration=t.linkImpactDuration,n.sceneImpactEnabled=t.sceneImpactEnabled,n.sceneImpactMul=t.sceneImpactMul,n.sceneImpactLogoCompMul=t.sceneImpactLogoCompMul,n.sceneImpactMobileMulFactor=t.sceneImpactMobileMulFactor,n.sceneImpactPressMs=t.sceneImpactPressMs,n.sceneImpactReleaseMs=t.sceneImpactReleaseMs,n.sceneImpactAnticipation=t.sceneImpactAnticipation,n.sceneChangeSoundEnabled=t.sceneChangeSoundEnabled,n.sceneChangeSoundIntensity=t.sceneChangeSoundIntensity,n.sceneChangeSoundRadius=t.sceneChangeSoundRadius,n.gateOverlayEnabled=t.gateOverlayEnabled,n.gateOverlayOpacity=t.gateOverlayOpacity,n.gateOverlayTransitionMs=t.gateOverlayTransitionMs,n.gateOverlayTransitionOutMs=t.gateOverlayTransitionOutMs,n.gateOverlayContentDelayMs=t.gateOverlayContentDelayMs,n.gateDepthScale=t.gateDepthScale,n.gateDepthTranslateY=t.gateDepthTranslateY,n.logoOpacityInactive=t.logoOpacityInactive,n.logoOpacityActive=t.logoOpacityActive,n.logoBlurInactive=t.logoBlurInactive,n.logoBlurActive=t.logoBlurActive,n.bgLight=t.bgLight,n.bgDark=t.bgDark,n.textColorLight=t.textColorLight,n.textColorLightMuted=t.textColorLightMuted,n.textColorDark=t.textColorDark,n.textColorDarkMuted=t.textColorDarkMuted,n.edgeLabelColorLight=t.edgeLabelColorLight,n.edgeLabelColorDark=t.edgeLabelColorDark,n.linkHoverColor=t.linkHoverColor,n.logoColorLight=t.logoColorLight,n.logoColorDark=t.logoColorDark,n.topLogoWidthVw=t.topLogoWidthVw,n.portfolioLogoColorLight=t.portfolioLogoColorLight,n.portfolioLogoColorDark=t.portfolioLogoColorDark,n.colorDistribution=t.colorDistribution,n.frameColorLight=t.frameColorLight,n.frameColorDark=t.frameColorDark,n.wallPreset=t.wallPreset,n.wallThicknessVw=t.wallThicknessVw,n.wallThicknessAreaMultiplier=t.wallThicknessAreaMultiplier,n.wallRadiusVw=t.wallRadiusVw,n.wallInset=t.wallInset,n.mobileWallThicknessXFactor=t.mobileWallThicknessXFactor,n.mobileEdgeLabelsVisible=t.mobileEdgeLabelsVisible,n.wallWobbleMaxDeform=t.wallWobbleMaxDeform,n.wallWobbleStiffness=t.wallWobbleStiffness,n.wallWobbleDamping=t.wallWobbleDamping,n.wallWobbleSigma=t.wallWobbleSigma,n.wallWobbleSettlingSpeed=t.wallWobbleSettlingSpeed,n.wallWobbleCornerClamp=t.wallWobbleCornerClamp,n.wallWobbleImpactThreshold=t.wallWobbleImpactThreshold,n.wallWobbleMaxVel=t.wallWobbleMaxVel,n.wallWobbleMaxImpulse=t.wallWobbleMaxImpulse,n.wallWobbleMaxEnergyPerStep=t.wallWobbleMaxEnergyPerStep,n.wallPhysicsSamples=t.wallPhysicsSamples,n.wallPhysicsSkipInactive=t.wallPhysicsSkipInactive,n.wallRenderDecimation=t.wallRenderDecimation,n.noiseEnabled=t.noiseEnabled,n.noiseSeed=t.noiseSeed,n.noiseTextureSize=t.noiseTextureSize,n.noiseDistribution=t.noiseDistribution,n.noiseMonochrome=t.noiseMonochrome,n.noiseChroma=t.noiseChroma,n.noiseSizeBase=t.noiseSizeBase,n.noiseSizeTop=t.noiseSizeTop,n.noiseTopOpacity=t.noiseTopOpacity,n.noiseBackOpacity=t.noiseBackOpacity,n.noiseFrontOpacity=t.noiseFrontOpacity,n.noiseBackOpacityDark=t.noiseBackOpacityDark,n.noiseFrontOpacityDark=t.noiseFrontOpacityDark,n.noiseMotion=t.noiseMotion,n.noiseMotionAmount=t.noiseMotionAmount,n.noiseSpeedBackMs=t.noiseSpeedBackMs,n.noiseSpeedFrontMs=t.noiseSpeedFrontMs,n.noiseFlicker=t.noiseFlicker,n.noiseFlickerSpeedMs=t.noiseFlickerSpeedMs,n.noiseBlurPx=t.noiseBlurPx,n.noiseContrast=t.noiseContrast,n.noiseBrightness=t.noiseBrightness,n.noiseSaturation=t.noiseSaturation,n.noiseHue=t.noiseHue,void 0!==t.entranceEnabled&&(n.entranceEnabled=t.entranceEnabled),void 0!==t.entranceWallTransitionDelay&&(n.entranceWallTransitionDelay=t.entranceWallTransitionDelay),void 0!==t.entranceWallTransitionDuration&&(n.entranceWallTransitionDuration=t.entranceWallTransitionDuration),void 0!==t.entranceWallInitialScale&&(n.entranceWallInitialScale=t.entranceWallInitialScale),void 0!==t.entranceWallEasing&&(n.entranceWallEasing=t.entranceWallEasing),void 0!==t.entranceElementDuration&&(n.entranceElementDuration=t.entranceElementDuration),void 0!==t.entranceElementScaleStart&&(n.entranceElementScaleStart=t.entranceElementScaleStart),void 0!==t.entranceElementTranslateZStart&&(n.entranceElementTranslateZStart=t.entranceElementTranslateZStart),void 0!==t.entrancePerspectiveLandscape&&(n.entrancePerspectiveLandscape=t.entrancePerspectiveLandscape),void 0!==t.entrancePerspectiveSquare&&(n.entrancePerspectiveSquare=t.entrancePerspectiveSquare),void 0!==t.entrancePerspectivePortrait&&(n.entrancePerspectivePortrait=t.entrancePerspectivePortrait),n.gravityMultiplier=t.gravityMultiplierPit,n.restitution=t.REST,n.friction=t.FRICTION,n.ballMass=t.ballMassKg,n.ballScale=t.sizeScale,n.sizeVariation=t.sizeVariation,n.repelSoft=t.repelSoft,n.repelSoftness=t.repelSoft,n.layoutViewportWidthPx=t.layoutViewportWidthPx||0,n.containerBorderVw=t.containerBorderVw,n.simulationPaddingVw=t.simulationPaddingVw,n.layoutMinWallRadiusPx=Math.max(0,Math.round(t.layoutMinWallRadiusPx??0));try{n.soundPreset=de(),n.soundConfig=le()}catch(e){}n.enableLOD=!1;const i=await(async(t,a)=>{if(!lt())return!1;try{const e=await fetch("http://localhost:8002/api/config-sync-bulk",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({configType:"default",config:a})});if(!e.ok){const t=await e.json().catch(()=>({error:"Unknown error"}));return console.warn("[config-sync] Bulk save failed:",t.error||"HTTP "+e.status),!1}return(await e.json()).success}catch(e){return"TypeError"===e.name&&e.message.includes("fetch")||console.warn("[config-sync] Bulk save error:",e.message),!1}})(0,n);a&&(i?(a.textContent="Saved!",setTimeout(()=>{a.textContent=o,a.disabled=!1},1500)):(a.textContent="Error",setTimeout(()=>{a.textContent=o,a.disabled=!1},2e3),console.warn("[save-config] Failed to save config")))}catch(e){console.error("[save-config] Error saving config:",e),a&&(a.textContent="Error",setTimeout(()=>{a.textContent=o,a.disabled=!1},2e3))}})()});const y=d.querySelector(".collapse-btn");return y&&y.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),(t=>{t.classList.toggle("collapsed"),(t=>{try{localStorage.setItem(Di.panelCollapsed,t+"")}catch(e){}})(t.classList.contains("collapsed"))})(c)}),setTimeout(()=>{"home"===e?Yt():Zt(),(()=>{const e=document.getElementById("saveRuntimeConfigBtn");e&&e.addEventListener("click",()=>{const e=b(),t={};try{const a=Bt();for(const o of a){if(!o||!o.stateKey)continue;const a=e[o.stateKey];void 0!==a&&(t[o.stateKey]=a)}}catch(h){}t.gravityMultiplier=e.gravityMultiplierPit,t.restitution=e.REST,t.friction=e.FRICTION,t.ballMass=e.ballMassKg,t.ballScale=e.sizeScale,t.sizeScale=e.sizeScale,t.sizeVariation=e.sizeVariation,t.repelSoft=e.repelSoft,t.repelSoftness=e.repelSoft,t.layoutViewportWidthPx=e.layoutViewportWidthPx||0,t.containerBorderVw=e.containerBorderVw,t.simulationPaddingVw=e.simulationPaddingVw,t.contentPaddingVw=e.contentPaddingVw,t.contentPaddingHorizontalRatio=e.contentPaddingHorizontalRatio,t.wallRadiusVw=e.wallRadiusVw,t.wallThicknessVw=e.wallThicknessVw,t.layoutMinContentPaddingPx=Math.max(0,Math.round(e.layoutMinContentPaddingPx??0)),t.layoutMinWallRadiusPx=Math.max(0,Math.round(e.layoutMinWallRadiusPx??0)),t.wallInset=e.wallInset;try{t.soundPreset=de(),t.soundConfig=le()}catch(h){}t.chromeHarmonyMode=e.chromeHarmonyMode,t.autoDarkModeEnabled=e.autoDarkModeEnabled,t.autoDarkNightStartHour=e.autoDarkNightStartHour,t.autoDarkNightEndHour=e.autoDarkNightEndHour,t.enableLOD=!1;const a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(a),o.download="default-config.json",document.body.appendChild(o),o.click(),document.body.removeChild(o)})})(),(e=>{const t=e.querySelector("#soundEnableBtn"),a=e.querySelector("#soundControlsWrapper"),o=e.querySelector("#soundPresetSelect"),n=e.querySelector("#presetDescription"),i=e.querySelector("#soundSection"),r=e.querySelector("#soundTapBtn"),l=e.querySelector("#soundResetBtn"),s=e.querySelector("#soundShuffleBtn"),c=(e,t,a)=>t>e?t:e>a?a:e,d=(e,t)=>e+2*(Math.random()-.5)*t,p=(e,{openIfEnabled:o=!1}={})=>{if(!t)return;const n=e||re(),r=!(!n.isUnlocked||!n.isEnabled),l=!!n.isUnlocked;t.innerHTML=l&&r?'<i class="ti ti-volume-2" aria-hidden="true"></i>':'<i class="ti ti-volume-off" aria-hidden="true"></i>',t.setAttribute("aria-label",l?r?"Sound on":"Sound off":"Enable sound"),t.title=l?r?"Sound on":"Sound off":"Enable sound",t.classList.toggle("enabled",r),a&&(a.style.display=r?"":"none"),o&&r&&i&&!i.open&&(i.open=!0)};if(r&&r.addEventListener("click",()=>{ae({intensity:.86,radius:18,xPosition:.72})}),l&&l.addEventListener("click",()=>{const t=de();ce(t),n&&Do[t]&&(n.textContent=Do[t].description),Ut(e,le)}),s&&s.addEventListener("click",()=>{const t=le();se({filterBaseFreq:c(d(t.filterBaseFreq,120),300,8e3),filterQ:c(d(t.filterQ,.04),.05,.9),pitchCurve:c(d(t.pitchCurve,.06),.6,1.8),sparkleGain:c(d(t.sparkleGain,.03),0,.35),sparkleDecayMul:c(d(t.sparkleDecayMul,.05),.25,.95),noiseTransientQ:c(d(t.noiseTransientQ,.25),.6,6),reverbWetMix:c(d(t.reverbWetMix,.02),0,.35),reverbDecay:c(d(t.reverbDecay,.03),.05,.4),collisionMinImpact:c(d(t.collisionMinImpact,.03),.45,.9),variancePitch:c(d(t.variancePitch,.01),0,.2),varianceGain:c(d(t.varianceGain,.02),0,.35)}),Ut(e,le),ae({intensity:.86,radius:18,xPosition:.72})}),t&&t.addEventListener("click",async()=>{const e=re();if(e.isUnlocked){const t=ie();p({...e,isEnabled:t})}else await ee()&&p(null,{openIfEnabled:!0})}),o){for(const[e,t]of Object.entries(Do)){const a=document.createElement("option");a.value=e,a.textContent=t.label,o.appendChild(a)}o.value=de(),n&&Do[de()]&&(n.textContent=Do[de()].description),o.addEventListener("change",()=>{ce(o.value),n&&Do[o.value]&&(n.textContent=Do[o.value].description),Ut(e,le)})}((e,t,a)=>{for(const o of Object.values(Fi))for(const t of o.controls){const o=e.querySelector("#sound_"+t.id),n=e.querySelector(`#sound_${t.id}_val`);if(!o)continue;const i=e=>{const i=(r=e,l=parseFloat(o.min),s=parseFloat(o.max),l>r?l:r>s?s:r);var r,l,s;o.value=i+"";const c=t.toConfig(i);n&&(n.textContent=t.format(i)),a({[t.id]:c})};o.addEventListener("input",()=>{i(parseFloat(o.value))}),o.addEventListener("wheel",e=>{if(e.ctrlKey)return;const t=(parseFloat(o.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),a=0>e.deltaY?1:-1,n=parseFloat(o.value);e.preventDefault(),i(n+a*t)},{passive:!1}),n&&n.addEventListener("wheel",e=>{if(e.ctrlKey)return;const t=(parseFloat(o.step)||1)*(e.altKey?.1:e.shiftKey?.2:1),a=0>e.deltaY?1:-1,n=parseFloat(o.value);e.preventDefault(),i(n+a*t)},{passive:!1})}})(e,0,se),Ut(e,le),p(),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(_o,e=>{p(e&&e.detail?e.detail:null)})})(c),(e=>{const t=e.querySelector("#layoutViewportWidth"),a=e.querySelector("#viewportWidthValue"),o=e.querySelector("#layoutWallInset"),n=e.querySelector("#wallInsetValue"),i=b();t&&a&&t.addEventListener("input",e=>{const t=parseInt(e.target.value,10);i.layoutViewportWidthPx=Number.isFinite(t)?Math.max(0,t):0,(({triggerResize:t=!1}={})=>{if(f(),m(),a){const e=s();a.textContent=i.layoutViewportWidthPx>0?Math.round(i.layoutViewportWidthPx)+"px":`Auto (${Math.round(e)}px)`}if(t)try{De()}catch(e){}document.dispatchEvent(new CustomEvent("layout-updated"))})({triggerResize:!0})}),o&&n&&o.addEventListener("input",e=>{const t=parseInt(e.target.value,10);n.textContent=t+"px",i.wallInset=t})})(c);try{l?.(c)}catch(h){}},0),c})({page:t,panelTitle:l,modeLabel:c,pageLabel:a,pageHTML:o,includePageSaveButton:n,pageSaveButtonId:i,footerHint:r,setupPageControls:p}),Ti.appendChild(Ii),document.body.insertBefore(Ti,document.body.firstChild),Ii&&(Ii.addEventListener("mousedown",e=>{const t=Ii.getBoundingClientRect();e.clientY-t.top>12||e.target.closest("button")||e.target.closest("input")||e.target.closest("select")||Jt(e)}),Ii.addEventListener("touchstart",e=>{const t=Ii.getBoundingClientRect();e.touches[0].clientY-t.top>12||e.target.closest("button")||e.target.closest("input")||e.target.closest("select")||Jt(e)},{passive:!1}),document.addEventListener("mousemove",Qt),document.addEventListener("mouseup",ea),document.addEventListener("touchmove",Qt,{passive:!1}),document.addEventListener("touchend",ea),(()=>{try{if(!Ti)return;const e=JSON.parse(localStorage.getItem(Di.position)||"{}");e.custom&&(Ti.style.position="fixed",Ti.style.left=e.left,Ti.style.top=e.top,Ti.style.right="auto")}catch(h){}})()),(()=>{if(!Ii)return;if("undefined"==typeof ResizeObserver)return;let e=0;const t=new ResizeObserver(()=>{Ii&&(Ii.classList.contains("collapsed")||(window.clearTimeout(e),e=window.setTimeout(()=>{(e=>{try{if(!e)return;if(e.classList.contains("collapsed"))return;const t=e.getBoundingClientRect();localStorage.setItem(Di.panelSize,JSON.stringify({width:Math.round(t.width),height:Math.round(t.height)}))}catch(h){}})(Ii)},150)))});try{t.observe(Ii)}catch(h){}})(),d&&(zi||(zi=!0,window.addEventListener("keydown",e=>{try{const t=e.target?.tagName,a=["INPUT","TEXTAREA","SELECT"].includes(t),o=!!e.target?.closest?.(".panel-dock");if(a&&!o)return}catch(h){}"/"!==(e.key?.toLowerCase?.()||"")&&"Slash"!==e.code||(e.preventDefault(),aa())})))})()}catch(t){return}const e=Ti.classList.toggle("hidden");if(qt(e),!e)try{(()=>{if(!Ti)return;if(!Ti.style.left&&!Ti.style.top)return;const e=Ti.getBoundingClientRect(),a=window.innerWidth||0,o=window.innerHeight||0;if(!a||!o)return;const n=10;if(n>e.right||e.left>a-n||n>e.bottom||e.top>o-n)return void(()=>{if(Ti){Ti.style.position="",Ti.style.left="",Ti.style.top="",Ti.style.right="";try{localStorage.removeItem(Di.position)}catch(t){}}})();const i=(e,t,a)=>t>e?t:e>a?a:e,r=i(e.left,n,Math.max(n,a-e.width-n)),l=i(e.top,n,Math.max(n,o-e.height-n));Ti.style.position="fixed",Ti.style.left=Math.round(r)+"px",Ti.style.top=Math.round(l)+"px",Ti.style.right="auto",ta()})()}catch(t){}}function oa(e){const t=b(),a=ro;if(!a||!a.length)return;const o=a.indexOf(t?.currentMode||io.PIT_THROWS),n=a[((0>o?0:o)+e+a.length)%a.length];_e(n),Xt(n)}function na(){if(!Ri)return null;if(Vi&&Vi.isConnected)return Vi;let e=document.getElementById("gate-modal-host");return e||(e=document.createElement("div"),e.id="gate-modal-host",e.className="gate-modal-host",Ri.appendChild(e)),Vi=e,Vi}function ia(e){if(!Ri||!e)return;const t=na();t&&(Ni.has(e)||Ni.set(e,{parent:e.parentNode,nextSibling:e.nextSibling}),t.appendChild(e))}function ra(e){if(!e)return;const t=Ni.get(e);if(t&&t.parent)try{t.nextSibling&&t.nextSibling.parentNode===t.parent?t.parent.insertBefore(e,t.nextSibling):t.parent.appendChild(e)}catch(a){}}function la(){const e=t("--wall-thickness","");if(e&&!/calc\(|vw|vh|vmin|vmax|%/i.test(e)){const t=parseFloat(e);if(Number.isFinite(t)&&t>0)return t}const a=b();return a?.wallThickness||12}function sa(){if(!Ri)return;const e=la();Ri.style.setProperty("--gate-overlay-blur",e/2+"px")}function ca(e){if(Ri=document.getElementById("gate-overlay"),!Ri)return void console.warn("Gate Overlay: #gate-overlay element not found");if(Bi=!1!==e.gateOverlayEnabled,!Bi)return console.log("Gate Overlay: Disabled by config"),void(Ri.style.display="none");Ri.style.display="",na();const t=e.gateOverlayOpacity??a("--gate-overlay-opacity",.01),i=e.gateOverlayTransitionMs??n("--gate-overlay-transition-duration",800),r=e.gateOverlayTransitionOutMs??n("--gate-overlay-transition-out-duration",600),l=e.gateOverlayContentDelayMs??n("--gate-content-delay",200),s=e.gateDepthScale??a("--gate-depth-scale",.96),c=e.gateDepthTranslateY??o("--gate-depth-translate-y",8),d=e.logoOpacityInactive??a("--logo-opacity-inactive",1),p=e.logoOpacityActive??a("--logo-opacity-active-target",.2),u=e.logoBlurInactive??o("--logo-blur-inactive",0),h=e.logoBlurActive??o("--logo-blur-active-target",12),f=document.documentElement;f.style.setProperty("--gate-depth-scale",s),f.style.setProperty("--gate-depth-translate-y",c+"px"),f.style.setProperty("--gate-depth-duration",i+"ms"),f.style.setProperty("--gate-depth-out-duration",r+"ms"),f.style.setProperty("--gate-content-delay",l+"ms"),f.style.setProperty("--logo-opacity-inactive",d),f.style.setProperty("--logo-opacity-active-target",p),f.style.setProperty("--logo-opacity-active",d),f.style.setProperty("--logo-blur-inactive",u+"px"),f.style.setProperty("--logo-blur-active-target",h+"px"),f.style.setProperty("--logo-blur-active",u+"px"),sa(),Ri.style.setProperty("--gate-overlay-opacity",t),Ri.style.setProperty("--gate-overlay-transition-duration",i+"ms"),Ri.style.setProperty("--gate-overlay-transition-out-duration",r+"ms"),Ri.classList.remove("active"),Ri.setAttribute("aria-hidden","true"),Ri.addEventListener("click",da),window.addEventListener("resize",sa),document.addEventListener("layout-updated",sa);const m=la()/2;console.log(`Gate Overlay: Initialized (opacity: ${t}, blur: ${m}px [auto from wall thickness], transition: ${i}ms, logo: opacity ${d}→${p}, blur ${u}px→${h}px)`)}function da(e){if(e.target.closest("button"))return;if(e.target.closest("input"))return;if(e.target.closest("a"))return;if(e.target.closest("select"))return;if(e.target.closest("textarea"))return;const t="cv-gate"===e.target.id||"portfolio-gate"===e.target.id||"contact-gate"===e.target.id||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description");(e.target===Ri||"gate-modal-host"===e.target?.id||t)&&document.dispatchEvent(new CustomEvent("gate-overlay-dismiss",{detail:{instant:!0}}))}function pa(e){const t=document.documentElement,a=document.getElementById("abs-scene");if(e){const e=getComputedStyle(t).getPropertyValue("--gate-depth-scale").trim()||"0.96",o=getComputedStyle(t).getPropertyValue("--gate-depth-translate-y").trim()||"8px",n=getComputedStyle(t).getPropertyValue("--logo-opacity-active-target").trim()||t.style.getPropertyValue("--logo-opacity-active-target")||"0.2",i=getComputedStyle(t).getPropertyValue("--logo-blur-active-target").trim()||t.style.getPropertyValue("--logo-blur-active-target")||"12px";t.style.setProperty("--gate-depth-scale-active",e),t.style.setProperty("--gate-depth-ty-active",o),t.style.setProperty("--logo-opacity-active",n),t.style.setProperty("--logo-blur-active",i),a&&a.classList.add("gate-depth-active")}else{const e=getComputedStyle(t).getPropertyValue("--logo-opacity-inactive").trim()||"1",o=getComputedStyle(t).getPropertyValue("--logo-blur-inactive").trim()||"0px";t.style.setProperty("--gate-depth-scale-active","1"),t.style.setProperty("--gate-depth-ty-active","0px"),t.style.setProperty("--logo-opacity-active",e),t.style.setProperty("--logo-blur-active",o),a&&a.classList.remove("gate-depth-active")}}function ua(){if(!Ri||!Bi)return;sa(),Ri.setAttribute("aria-hidden","false"),Ri.classList.add("active");const e=document.getElementById("custom-cursor");if(e){let a=!1;try{a=!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(t){}a?(e.classList.remove("gate-active"),e.style.display="none"):(e.classList.add("gate-active"),e.style.display="block")}pa(!0)}function ha(){if(!Ri||!Bi)return;Ri.classList.remove("active"),Ri.setAttribute("aria-hidden","true");const e=document.getElementById("custom-cursor");e&&e.classList.remove("gate-active"),pa(!1)}function fa(){return!!Ri&&Ri.classList.contains("active")}function ma(e){const t=+e?.sceneImpactMul,a=Number.isFinite(t)?t:0,o=+e?.sceneImpactMobileMulFactor,n=Number.isFinite(o)&&o>0?o:1;return a*((e=>{if(e?.isMobile||e?.isMobileViewport)return!0;try{return!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(t){return!1}})(e)?n:1)}function ga(){if(!ji)return;let e=null;try{e=b()}catch(o){}if(!e)return;const t=ma(e);ji.style.setProperty("--abs-scene-impact-mul",t+"");const a=+e.sceneImpactLogoCompMul;Number.isFinite(a)&&a>0&&ji.style.setProperty("--abs-scene-impact-logo-comp-mul",a+"")}function ba(e,t){const a=ma(t),o=Math.max(0,+e||0)*a,n=1/Math.max(.001,1-o),i=+t?.sceneImpactLogoCompMul;return Math.max(.5,Math.min(4,n*(1+((Number.isFinite(i)&&i>0?i:1)-1)*o)))}function ya(){Xi&&(window.clearTimeout(Xi),Xi=0),Ui&&(window.clearTimeout(Ui),Ui=0)}function Ma(e=1,t={}){if(!Zi||!ji)return;const a=b();if(!1===a?.sceneImpactEnabled)return;const o=!1!==t?.scheduleRelease,n=Math.max(0,Math.min(1,+e||0)),i=++Yi;ya(),ji.classList.add("abs-scene--animating"),t?.armManual&&(qi=!0);const r=a?.sceneImpactPressMs??75,l=a?.sceneImpactReleaseMs??220,s=Math.max(1,Math.round(.8*(+r||0))),c=Math.max(1,Math.round(1.2*(+l||0)));ji.style.setProperty(Gi,Math.round(s)+"ms"),window.requestAnimationFrame(()=>{Zi&&ji&&i===Yi&&(ji.style.setProperty(_i,n+""),ji.style.setProperty(Hi,ba(n,a)+""))}),o&&(Xi=window.setTimeout(()=>{wa({token:i,releaseMs:c})},0),Ui=window.setTimeout(()=>{Ui=0,ji&&ji.classList.remove("abs-scene--animating")},Math.max(0,Math.round(c)+80)))}function va(){if(!Zi||!ji)return;const e=b();return!1!==e?.sceneImpactEnabled?wa({token:Yi,releaseMs:Math.max(1,Math.round(1.2*(+(e?.sceneImpactReleaseMs??220)||0)))}):void 0}function wa({token:e,releaseMs:t}){ya(),Zi&&ji&&e===Yi&&(ji.style.setProperty(Gi,Math.round(t)+"ms"),window.requestAnimationFrame(()=>{Zi&&ji&&e===Yi&&(ji.style.setProperty(_i,"0"),ji.style.setProperty(Hi,"1"))}),Ui=window.setTimeout(()=>{Ui=0,ji&&ji.classList.remove("abs-scene--animating")},Math.max(0,Math.round(t)+80)))}function xa(){const e=b(),t=ro,a=t.indexOf(e.currentMode),o=t[((0>a?0:a)+1)%t.length];Promise.resolve().then(()=>Cn).then(({setMode:e})=>{e(o)}),Promise.resolve().then(()=>Ci).then(({updateModeButtonsUI:e})=>{e(o)})}function Sa(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function ka(){try{const e="undefined"!=typeof window?window.__TEXT__:null;return Sa(e)?e:null}catch(e){return null}}function Ca(e,t=""){const a=vr||ka();if(!a)return t;if(!e)return t;const o=(e+"").split(".").filter(Boolean);let n=a;for(const i of o){if(!Sa(n)&&!Array.isArray(n))return t;if(n=n?.[i],null==n)return t}return n}function Pa(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.classList.add("page-flash--"+t),setTimeout(()=>{e.classList.remove("page-flash--"+t)},"success"===t?600:300)}function Fa(e,t){e.classList.remove("page-flash--success","page-flash--error"),e.classList.add("page-flash--"+t),setTimeout(()=>{e.classList.remove("page-flash--"+t)},"success"===t?600:300)}async function Ta(){re().isUnlocked?Ia(ie()):await ee()?Ia(!0):(xr&&(xr.innerHTML=wr,xr.setAttribute("aria-label","Audio unavailable"),xr.title="Audio unavailable"),setTimeout(()=>{Ia(!1)},2e3))}function Ia(e){xr&&(xr.setAttribute("data-enabled",e?"true":"false"),xr.setAttribute("aria-pressed",e?"true":"false"),xr.setAttribute("aria-label",e?"Sound on":"Sound off"),xr.title=e?"Sound on":"Sound off",xr.innerHTML=e?'<i class="ti ti-volume-2" aria-hidden="true"></i>':wr)}function Da(e){return((e||"")+"").trim().toLowerCase()}function La(e,t,a,o=t){const n=+e;if(!Number.isFinite(n))return o;const i=Math.floor(n);return t>i?t:i>a?a:i}function Aa(e){const t=b(),a=Da(e),o=Array.isArray(t.colorDistribution)?t.colorDistribution:null;if(!o)return null;for(let n=0;o.length>n;n++){const e=o[n];if(Da(e?.label)===a)return"bg-ball-"+(La(e?.colorIndex,0,7,0)+1)}return null}function Ka(){const e=document.getElementById("expertise-legend");if(!e)return;const t=Array.from(e.querySelectorAll(".legend__item"));for(const a of t){const e=a.querySelector("span"),t=a.querySelector(".circle");if(!e||!t)continue;const o=Aa(Da(e.textContent));if(o){for(const e of Array.from(t.classList))(e.startsWith("bg-ball-")||e.startsWith("bg-story-"))&&t.classList.remove(e);t.classList.add(o)}}}function Oa(e){const t=Number.parseFloat(((e||"")+"").trim());return Number.isFinite(t)?t:0}function Wa(e){return 0>e?0:e>1?1:e}function za(e){const t=Number.parseInt(e,16);return Number.isFinite(t)?t:0}function Ea(e){const t=((e||"")+"").trim();if(!t)return null;if("#"===t[0]){const e=t.slice(1).trim();return 3===e.length?{r:za(e[0]+e[0]),g:za(e[1]+e[1]),b:za(e[2]+e[2])}:6===e.length?{r:za(e.slice(0,2)),g:za(e.slice(2,4)),b:za(e.slice(4,6))}:null}const a=t.match(/rgba?\(([^)]+)\)/i);if(a){const e=a[1].split(",").map(e=>Oa(e));if(e.length>=3)return{r:Math.round(e[0]),g:Math.round(e[1]),b:Math.round(e[2])}}return null}function Ra(e){const t=Wa(e/255);return t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92}function Ba({r:e,g:t,b:a}){return.2126*Ra(e)+.7152*Ra(t)+.0722*Ra(a)}function Va(e,t){const a=Ba(e),o=Ba(t);return(Math.max(a,o)+.05)/(Math.min(a,o)+.05)}function Na(e,t,a){const o=Wa(a);return{r:Math.round(e.r+(t.r-e.r)*o),g:Math.round(e.g+(t.g-e.g)*o),b:Math.round(e.b+(t.b-e.b)*o)}}function $a({r:e,g:t,b:a},o){return`rgb(${e} ${t} ${a} / ${Wa(o)})`}function _a(e){return!(!e||!e.closest||!(e.closest("#panelDock")||e.closest("#masterPanel")||e.closest("#dockToggle")||e.closest(".panel-dock")||e.closest(".panel")))}function Ga(e){if(!e||!e.closest)return null;const t=e.closest('a, button, [role="button"]');if(!t)return null;try{if(t.classList?.contains?.("slide"))return null;if(t.closest?.(".slide"))return null}catch(a){}return t}function Ha(e){try{e?.style?.removeProperty?.(Lr),e?.style?.removeProperty?.(zr),e?.style?.removeProperty?.(Er)}catch(t){}}function ja(e){const t=(()=>{const e=document.getElementById("custom-cursor");if(!e)return 0;const t=window.getComputedStyle(e),a=Math.max(Oa(t.width),Oa(t.height));return a>0?.25*a:0})();if(t>0)try{e.style.setProperty(Lr,t+"px")}catch(a){}else Ha(e)}function Za(e){try{if(document.body.classList.contains("portfolio-page"))return"ui";if(document.body.classList.contains("detail-open"))return"ui"}catch(t){}if((()=>{try{const e=document.getElementById("gate-overlay");return!!e&&(e.classList.contains("active")||"false"===e.getAttribute("aria-hidden"))}catch(t){return!1}})())return"ui";try{if(e?.closest?.(".project-detail"))return"ui";if(e?.closest?.("#gate-overlay"))return"ui";if(e?.closest?.(".gate-modal-host"))return"ui";if(e?.closest?.("#cv-gate")||e?.closest?.("#portfolio-gate")||e?.closest?.("#contact-gate"))return"ui"}catch(t){}return"index"}function Ya(){try{const e=Ea(getComputedStyle(document.documentElement).getPropertyValue("--cursor-color").trim());if(e)return e}catch(e){}return null}function Xa(){try{document.body.classList.remove(Tr)}catch(e){}if(Pr){try{Pr.classList.remove(Kr),Pr.classList.remove(Or),Pr.classList.remove(Wr),Pr.classList.remove("abs-cursor-pulse"),Pr.querySelectorAll?.("."+Ar)?.forEach?.(e=>e.remove())}catch(e){}Ha(Pr)}Pr=null;try{document.body.classList.remove(Ir),document.body.classList.remove(Dr)}catch(e){}}function Ua(){Fr||(Fr=!0,requestAnimationFrame(()=>{Fr=!1,Pr&&ja(Pr)}))}function qa(e){const t=Ga(e.target);t&&(_a(t)||(t=>{if(!t)return;Pr&&Pr!==t&&Ha(Pr),Pr=t;const a=Za(Pr);(t=>{try{document.body.classList.toggle(Ir,"index"===t),document.body.classList.toggle(Dr,"ui"===t)}catch(e){}})(a);try{Pr.classList.add(Kr),Pr.classList.toggle(Or,"index"===a),Pr.classList.toggle(Wr,"ui"===a)}catch(e){}ja(Pr);try{Pr.getBoundingClientRect?.()}catch(e){}if("index"===a){const t=Ya(),a=(()=>{const t=[document.querySelector(".wall-frame"),document.getElementById("bravia-balls"),document.getElementById("fade-content"),document.body,document.documentElement].filter(Boolean);for(const a of t)try{const e=getComputedStyle(a).backgroundColor,t=Ea(e);if(!t)continue;if(0===t.r&&0===t.g&&0===t.b&&e.includes("rgba")&&/,\s*0(\.0+)?\s*\)/.test(e))continue;return t}catch(e){}return{r:245,g:245,b:245}})();if(t){const o=.12,n=Na(a,t,o),i=((e,t,a=null)=>{const o={r:255,g:255,b:255},n={r:0,g:0,b:0},i=a=>{let o=null;for(let n=0;20>=n;n+=1){const i=n/20,r=Na(e,a,i),l=Va(r,t);if(l>=4.5){o={rgb:r,t:i,cr:l};break}}return o},r=i(o),l=i(n);if(r&&l)return"black"===a?l.rgb:"white"===a?r.rgb:r.t>l.t?l.rgb:r.rgb;if(r)return r.rgb;if(l)return l.rgb;const s=Va(e,t),c=Va(o,t),d=Va(n,t);return 4.5>s?d>c?n:o:e})(t,n,Ba(n)>.45?"black":"white");try{Pr.style.setProperty(zr,$a(t,o)),Pr.style.setProperty(Er,(({r:e,g:t,b:a})=>`rgb(${e} ${t} ${a})`)(i))}catch(e){}}else Ha(Pr)}else try{Pr.style.removeProperty(zr),Pr.style.removeProperty(Er)}catch(e){}try{document.body.classList.add(Tr)}catch(e){}})(t))}function Ja(e){const t=Ga(e.target);if(!t||t!==Pr)return;const a=e.relatedTarget;a&&t.contains(a)||Xa()}function Qa(){Pr&&Ua()}function eo(e){const t=Ga(e.target);if(!t)return;if(_a(t))return;if(Pr&&t!==Pr)return;if(!Pr)return;Ua();const a=Za(Pr);((t,a)=>{if(t)try{const o=document.createElement("span");o.className=Ar,o.setAttribute("aria-hidden","true");const n=Ya(),i="index"===a?.22:.18,r=n?$a(n,i):`rgb(var(--abs-rgb-black) / ${i})`;o.style.setProperty("--abs-pulse-color",r),o.style.setProperty("--abs-pulse-ms","520ms"),o.style.setProperty("--abs-pulse-size",`var(${Lr}, 24px)`),o.style.setProperty("--abs-pulse-mode",a),t.appendChild(o);const l=()=>{try{o.remove()}catch(e){}};o.addEventListener("animationend",l,{once:!0}),window.setTimeout(l,640)}catch(e){}})(Pr,a)}function to(e,t){e&&(e.textContent=(t??"")+"")}function ao(e,t,a){if(e&&null!=a)try{e.setAttribute(t,a+"")}catch(o){}}function oo(){m()}function no(){const e=window.innerWidth/window.innerHeight;return e>1.1?"landscape":.9>e?"portrait":"square"}const io={PIT:"pit",PIT_THROWS:"pit-throws",FLIES:"flies",WEIGHTLESS:"weightless",WATER:"water",VORTEX:"vortex",PING_PONG:"ping-pong",MAGNETIC:"magnetic",BUBBLES:"bubbles",KALEIDOSCOPE:"kaleidoscope",KALEIDOSCOPE_1:"kaleidoscope-1",KALEIDOSCOPE_2:"kaleidoscope-2",KALEIDOSCOPE_3:"kaleidoscope-3",CRITTERS:"critters",ORBIT_3D:"orbit-3d",ORBIT_3D_2:"orbit-3d-2",NEURAL:"neural",LATTICE:"lattice",PARALLAX_LINEAR:"parallax-linear",PARALLAX_PERSPECTIVE:"parallax-perspective"},ro=[io.PIT,io.FLIES,io.LATTICE,io.BUBBLES,io.PIT_THROWS,io.MAGNETIC,io.WATER,io.PING_PONG,io.NEURAL,io.VORTEX,io.ORBIT_3D,io.WEIGHTLESS,io.PARALLAX_LINEAR,io.CRITTERS,io.ORBIT_3D_2,io.PARALLAX_PERSPECTIVE,io.KALEIDOSCOPE_1,io.KALEIDOSCOPE_2,io.KALEIDOSCOPE_3,io.KALEIDOSCOPE],lo={[io.PIT]:"SOURCE MATERIAL",[io.FLIES]:"IDEA SPARK",[io.LATTICE]:"SYSTEM FRAME",[io.BUBBLES]:"NOISE SIGNAL",[io.PIT_THROWS]:"PROTOTYPE LOOP",[io.MAGNETIC]:"DESIGN FORCES",[io.WATER]:"USER FLOW",[io.PING_PONG]:"FEEDBACK CYCLE",[io.NEURAL]:"CONNECTION MAP",[io.VORTEX]:"EMERGENT ORDER",[io.ORBIT_3D]:"SYSTEM DYNAMICS",[io.WEIGHTLESS]:"OPEN SPACE",[io.PARALLAX_LINEAR]:"PERSPECTIVE SHIFT",[io.CRITTERS]:"BEHAVIOR MODEL",[io.ORBIT_3D_2]:"EDGE CASES",[io.PARALLAX_PERSPECTIVE]:"CONTEXT FIELD",[io.KALEIDOSCOPE_1]:"VOCAB SEED",[io.KALEIDOSCOPE_2]:"VOCAB FLOW",[io.KALEIDOSCOPE_3]:"VOCAB BLOOM",[io.KALEIDOSCOPE]:"VISUAL LANGUAGE"},so={DPR:Math.max(1,Math.min(2,window.devicePixelRatio||1)),OFFSCREEN_MOUSE:-1e9,MIN_DISTANCE_EPSILON:1e-6,ACCUMULATOR_RESET_THRESHOLD:3,MAX_PHYSICS_STEPS:4,SPIN_DAMP_PER_S:3,SPIN_GAIN:.25,SPIN_GAIN_TANGENT:.18,ROLL_FRICTION_PER_S:2.5,SQUASH_MAX_BASE:.2,SQUASH_DECAY_PER_S:18,WALL_REST_VEL_THRESHOLD:70,GROUND_COUPLING_PER_S:12,SLEEP_VELOCITY_THRESHOLD:12,SLEEP_ANGULAR_THRESHOLD:.18,TIME_TO_SLEEP:.25,PHYSICS_DT:1/120},co={rubber:{label:"Rubber (balanced)",description:"Balanced rubber ring with clear bounce and crisp ripples.",values:{wallWobbleMaxDeform:50,wallWobbleStiffness:2100,wallWobbleDamping:34,wallWobbleSigma:2.2,wallWobbleCornerClamp:.6,wallWobbleImpactThreshold:110,wallWobbleSettlingSpeed:70,wallWobbleMaxVel:900,wallWobbleMaxImpulse:240,wallWobbleMaxEnergyPerStep:24e3,wallInset:3}},pudding:{label:"Pudding (thick, soft)",description:"Overdamped, broad blobs. Big squish, quick settling, minimal ringing.",values:{wallWobbleMaxDeform:85,wallWobbleStiffness:520,wallWobbleDamping:82,wallWobbleSigma:5.2,wallWobbleCornerClamp:.25,wallWobbleImpactThreshold:55,wallWobbleSettlingSpeed:94,wallWobbleMaxVel:650,wallWobbleMaxImpulse:180,wallWobbleMaxEnergyPerStep:22e3,wallInset:3}},trampoline:{label:"Trampoline (snappy)",description:"High elasticity and low viscosity. Fast rebound with lively oscillation.",values:{wallWobbleMaxDeform:60,wallWobbleStiffness:2900,wallWobbleDamping:14,wallWobbleSigma:2.4,wallWobbleCornerClamp:.55,wallWobbleImpactThreshold:95,wallWobbleSettlingSpeed:35,wallWobbleMaxVel:1200,wallWobbleMaxImpulse:320,wallWobbleMaxEnergyPerStep:3e4,wallInset:3}},jelly:{label:"Jelly (slow wobble)",description:"Soft and springy with slow, smooth undulation. More “gel sheet”.",values:{wallWobbleMaxDeform:95,wallWobbleStiffness:820,wallWobbleDamping:16,wallWobbleSigma:3.6,wallWobbleCornerClamp:.4,wallWobbleImpactThreshold:75,wallWobbleSettlingSpeed:28,wallWobbleMaxVel:900,wallWobbleMaxImpulse:260,wallWobbleMaxEnergyPerStep:26e3,wallInset:3}},stiff:{label:"Stiff (rigid-ish)",description:"Small deformation with heavy damping: feels like thick industrial gasket.",values:{wallWobbleMaxDeform:28,wallWobbleStiffness:3200,wallWobbleDamping:62,wallWobbleSigma:1.7,wallWobbleCornerClamp:.8,wallWobbleImpactThreshold:160,wallWobbleSettlingSpeed:92,wallWobbleMaxVel:700,wallWobbleMaxImpulse:160,wallWobbleMaxEnergyPerStep:2e4,wallInset:3}},steel:{label:"Steel (almost solid)",description:"Barely moves; impact gating high. Useful as a near-static control case.",values:{wallWobbleMaxDeform:10,wallWobbleStiffness:3600,wallWobbleDamping:75,wallWobbleSigma:1.2,wallWobbleCornerClamp:.9,wallWobbleImpactThreshold:190,wallWobbleSettlingSpeed:98,wallWobbleMaxVel:500,wallWobbleMaxImpulse:90,wallWobbleMaxEnergyPerStep:16e3,wallInset:3}},latex:{label:"Latex (tight snap)",description:"Taut membrane: smaller blobs, higher tension, crisp rebounds.",values:{wallWobbleMaxDeform:55,wallWobbleStiffness:2600,wallWobbleDamping:22,wallWobbleSigma:1.8,wallWobbleCornerClamp:.7,wallWobbleImpactThreshold:105,wallWobbleSettlingSpeed:55,wallWobbleMaxVel:1100,wallWobbleMaxImpulse:300,wallWobbleMaxEnergyPerStep:28e3,wallInset:3}},memoryFoam:{label:"Memory Foam (slow sink)",description:"Very soft with heavy damping: sinks in and slowly recovers.",values:{wallWobbleMaxDeform:120,wallWobbleStiffness:420,wallWobbleDamping:88,wallWobbleSigma:6,wallWobbleCornerClamp:.2,wallWobbleImpactThreshold:45,wallWobbleSettlingSpeed:96,wallWobbleMaxVel:520,wallWobbleMaxImpulse:150,wallWobbleMaxEnergyPerStep:22e3,wallInset:3}},hydraulic:{label:"Hydraulic (damped)",description:"Medium squish with very high viscosity: controlled, “mechanical” response.",values:{wallWobbleMaxDeform:70,wallWobbleStiffness:1400,wallWobbleDamping:78,wallWobbleSigma:3,wallWobbleCornerClamp:.55,wallWobbleImpactThreshold:85,wallWobbleSettlingSpeed:90,wallWobbleMaxVel:650,wallWobbleMaxImpulse:200,wallWobbleMaxEnergyPerStep:24e3,wallInset:3}},gelSheet:{label:"Gel Sheet (wide ripples)",description:"Wide, slow waves with moderate bounce. Feels like a gel panel.",values:{wallWobbleMaxDeform:95,wallWobbleStiffness:1e3,wallWobbleDamping:28,wallWobbleSigma:4.8,wallWobbleCornerClamp:.35,wallWobbleImpactThreshold:70,wallWobbleSettlingSpeed:45,wallWobbleMaxVel:900,wallWobbleMaxImpulse:260,wallWobbleMaxEnergyPerStep:26e3,wallDeformPhysicsPrecision:75,wallInset:3}}},po={default:{label:"Default (Full View Grid)",parallaxLinearDotSizeMul:1.8,sizeVariationParallaxLinear:0,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:7,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:50,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:260},dense:{label:"Dense (More Vertices)",parallaxLinearDotSizeMul:1.6,sizeVariationParallaxLinear:.1,parallaxLinearGridX:18,parallaxLinearGridY:13,parallaxLinearGridZ:9,parallaxLinearSpanX:1.25,parallaxLinearSpanY:1.25,parallaxLinearZNear:45,parallaxLinearZFar:1e3,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:240},deep:{label:"Deep Field (Stronger Depth)",parallaxLinearDotSizeMul:1.7,sizeVariationParallaxLinear:.08,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:10,parallaxLinearSpanX:1.45,parallaxLinearSpanY:1.45,parallaxLinearZNear:30,parallaxLinearZFar:1500,parallaxLinearFocalLength:520,parallaxLinearParallaxStrength:320},calm:{label:"Calm (Slow Camera)",parallaxLinearDotSizeMul:1.8,sizeVariationParallaxLinear:.05,parallaxLinearGridX:12,parallaxLinearGridY:9,parallaxLinearGridZ:6,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:60,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:160},minimal:{label:"Minimal (Big Dots)",parallaxLinearDotSizeMul:2.4,sizeVariationParallaxLinear:.15,parallaxLinearGridX:10,parallaxLinearGridY:7,parallaxLinearGridZ:4,parallaxLinearSpanX:1.6,parallaxLinearSpanY:1.6,parallaxLinearZNear:70,parallaxLinearZFar:800,parallaxLinearFocalLength:380,parallaxLinearParallaxStrength:220}},uo={default:{label:"Default (Nebula Grid)",parallaxPerspectiveDotSizeMul:1.8,sizeVariationParallaxPerspective:0,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:8,parallaxPerspectiveSpanX:1.45,parallaxPerspectiveSpanY:1.45,parallaxPerspectiveZNear:40,parallaxPerspectiveZFar:1200,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:280,parallaxPerspectiveRandomness:.6},calm:{label:"Calm Mist",parallaxPerspectiveDotSizeMul:1.9,sizeVariationParallaxPerspective:.08,parallaxPerspectiveGridX:14,parallaxPerspectiveGridY:10,parallaxPerspectiveGridZ:6,parallaxPerspectiveSpanX:1.4,parallaxPerspectiveSpanY:1.4,parallaxPerspectiveZNear:60,parallaxPerspectiveZFar:900,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:180,parallaxPerspectiveRandomness:.25},deep:{label:"Deep Space",parallaxPerspectiveDotSizeMul:1.6,sizeVariationParallaxPerspective:.06,parallaxPerspectiveGridX:18,parallaxPerspectiveGridY:13,parallaxPerspectiveGridZ:12,parallaxPerspectiveSpanX:1.55,parallaxPerspectiveSpanY:1.55,parallaxPerspectiveZNear:30,parallaxPerspectiveZFar:2200,parallaxPerspectiveFocalLength:520,parallaxPerspectiveParallaxStrength:340,parallaxPerspectiveRandomness:.55},wild:{label:"Wild Nebula",parallaxPerspectiveDotSizeMul:1.7,sizeVariationParallaxPerspective:.18,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:10,parallaxPerspectiveSpanX:1.6,parallaxPerspectiveSpanY:1.6,parallaxPerspectiveZNear:20,parallaxPerspectiveZFar:1600,parallaxPerspectiveFocalLength:420,parallaxPerspectiveParallaxStrength:360,parallaxPerspectiveRandomness:.9},minimal:{label:"Minimal Stars",parallaxPerspectiveDotSizeMul:2.6,sizeVariationParallaxPerspective:.22,parallaxPerspectiveGridX:10,parallaxPerspectiveGridY:7,parallaxPerspectiveGridZ:5,parallaxPerspectiveSpanX:1.75,parallaxPerspectiveSpanY:1.75,parallaxPerspectiveZNear:70,parallaxPerspectiveZFar:1100,parallaxPerspectiveFocalLength:380,parallaxPerspectiveParallaxStrength:220,parallaxPerspectiveRandomness:.35}};let ho=Math.max(1,Math.min(2,window.devicePixelRatio||1));const fo={config:{},currentMode:io.CRITTERS,warmupFramesRemaining:0,balls:[],canvas:null,ctx:null,container:null,mouseX:so.OFFSCREEN_MOUSE,mouseY:so.OFFSCREEN_MOUSE,mouseInCanvas:!1,lastPointerMoveMs:0,lastPointerMoveX:so.OFFSCREEN_MOUSE,lastPointerMoveY:so.OFFSCREEN_MOUSE,GE:1960,G:0,gravityScale:1,gravityMultiplier:0,gravityMultiplierPit:1.1,pitThrowSpeed:650,pitThrowSpeedJitter:.22,pitThrowAngleJitter:.16,pitThrowBatchSize:18,pitThrowIntervalMs:70,pitThrowColorPauseMs:180,pitThrowTargetYFrac:.36,pitThrowInletInset:.06,pitThrowCrossBias:.12,pitThrowSpawnSpread:.02,pitThrowAimJitter:.04,pitThrowPairChance:.35,pitThrowPairStaggerMs:18,pitThrowSpeedVar:.18,pitThrowSpreadVar:.25,REST:.31,FRICTION:.011,ballMassKg:240,MASS_BASELINE_KG:240,MASS_REST_EXP:.15,MASS_GRAVITY_EXP:.35,get DPR(){return ho},sizeScale:1.2,sizeVariationGlobalMul:1,sizeVariationCap:.12,sizeVariationPit:0,sizeVariationPitThrows:0,sizeVariationFlies:0,sizeVariationWeightless:0,sizeVariationWater:0,sizeVariationVortex:.2,sizeVariationPingPong:0,sizeVariationMagnetic:0,sizeVariationBubbles:.2,sizeVariationKaleidoscope:0,sizeVariationOrbit3d:0,sizeVariationCritters:.2,sizeVariationNeural:0,sizeVariationLattice:0,sizeVariationParallaxLinear:0,sizeVariationParallaxPerspective:0,pitWarmupFrames:10,pitThrowsWarmupFrames:10,fliesWarmupFrames:10,weightlessWarmupFrames:10,waterWarmupFrames:10,vortexWarmupFrames:10,pingPongWarmupFrames:10,magneticWarmupFrames:10,bubblesWarmupFrames:10,kaleidoscopeWarmupFrames:10,kaleidoscope1WarmupFrames:10,kaleidoscope2WarmupFrames:10,kaleidoscope3WarmupFrames:10,orbit3dWarmupFrames:10,orbit3d2WarmupFrames:10,crittersWarmupFrames:10,neuralWarmupFrames:10,latticeWarmupFrames:10,parallaxLinearWarmupFrames:10,parallaxPerspectiveWarmupFrames:10,sizeVariation:0,responsiveScale:1,responsiveScaleMobile:.75,isMobile:!1,isMobileViewport:!1,mobileObjectReductionFactor:.7,R_MIN_BASE:6,R_MAX_BASE:24,R_MED:0,R_MIN:0,R_MAX:0,cursorSize:1,cursorColorMode:"auto",cursorColorIndex:5,cursorColorHex:"#ff4013",cursorColorLumaMax:.62,cursorColorAllowIndices:[],cursorColorDenyIndices:[],mouseTrailEnabled:!0,mouseTrailLength:18,mouseTrailSize:1.3,mouseTrailFadeMs:220,mouseTrailOpacity:.35,ballSoftness:20,ballSpacing:.08,sleepVelocityThreshold:12,sleepAngularThreshold:.18,timeToSleep:.25,physicsCollisionIterations:10,physicsSkipSleepingCollisions:!0,physicsSleepThreshold:12,physicsSleepTime:.25,physicsSkipSleepingSteps:!0,physicsSpatialGridOptimization:!0,wallPhysicsSamples:48,wallPhysicsSkipInactive:!0,wallPhysicsUpdateHz:30,wallPhysicsMaxSubstepHz:60,wallPhysicsInterpolation:!0,wallPhysicsAdaptiveSamples:!0,wallPhysicsMinSamples:24,wallVisualDeformMul:1,wallRenderDecimation:2,critterCount:90,critterSpeed:680,critterMaxSpeed:1400,critterStepHz:5,critterStepSharpness:2.4,critterTurnNoise:2.2,critterTurnDamp:10,critterTurnSeek:10,critterAvoidRadius:90,critterAvoidForce:9500,critterEdgeAvoid:1,critterMousePull:1,critterMouseRadiusVw:30,critterRestitution:.18,critterFriction:.018,cornerRadius:42,layoutViewportWidthPx:0,containerBorderVw:0,simulationPaddingVw:0,contentPaddingRatio:0,contentPaddingHorizontalRatio:1,mobileWallThicknessXFactor:1.4,mobileEdgeLabelsVisible:!0,wallRadiusVw:0,wallThicknessVw:0,wallThicknessAreaMultiplier:1,noiseBackOpacity:.015,noiseFrontOpacity:.045,noiseBackOpacityDark:.06,noiseFrontOpacityDark:.08,noiseEnabled:!0,noiseSeed:1337,noiseTextureSize:256,noiseDistribution:"gaussian",noiseMonochrome:!0,noiseChroma:.35,noiseMotion:"jitter",noiseMotionAmount:1.2,noiseSpeedBackMs:1400,noiseSpeedFrontMs:900,noiseFlicker:.08,noiseFlickerSpeedMs:180,noiseBlurPx:0,noiseContrast:1.2,noiseBrightness:1.15,noiseSaturation:1,noiseHue:0,noiseSizeBase:65,noiseSizeTop:85,noiseTopOpacity:0,detailNoiseOpacity:1,layoutMinWallRadiusPx:28,wallInset:3,vortexSwirlStrength:420,vortexRadialPull:180,vortexBallCount:180,vortexSpeedMultiplier:1,vortexRadius:0,vortexFalloffCurve:1,vortexRotationDirection:1,vortexCoreStrength:1,vortexAccelerationZone:0,vortexOutwardPush:0,vortexFalloffRate:.0015,magneticBallCount:180,magneticStrength:65e3,magneticMaxVelocity:2800,magneticExplosionInterval:5,bubblesSpawnRate:8,bubblesRiseSpeed:150,bubblesWobble:40,bubblesMaxCount:200,bubblesDeflectRadius:0,pingPongBallCount:35,pingPongSpeed:800,pingPongCursorRadius:0,currentColors:["#b5b7b6","#bbbdbd","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],currentTemplate:"industrialTeal",paletteRotateOnReload:!1,colorDistribution:[{label:"AI Integration",colorIndex:0,weight:30},{label:"UI/UX Design",colorIndex:4,weight:18},{label:"Creative Strategy",colorIndex:3,weight:15},{label:"Frontend Development",colorIndex:2,weight:12},{label:"Brand Identity",colorIndex:5,weight:10},{label:"3D Design",colorIndex:6,weight:10},{label:"Art Direction",colorIndex:7,weight:5}],fliesBallCount:60,attractionPower:5e3,orbitRadius:180,swarmSpeed:.4,fliesSeparation:15e3,weightlessCount:80,weightlessInitialSpeed:250,weightlessBounce:.97,weightlessRepelRadius:220,weightlessRepelPower:22e4,weightlessRepelSoft:2.2,kaleidoscopeBallCount:23,kaleidoscopeWedges:12,kaleidoscopeMirror:1,kaleidoscopeSpeed:1,kaleidoscopeDotSizeVh:.95,kaleidoscopeDotAreaMul:.7,kaleidoscopeSpawnAreaMul:1,kaleidoscopeSizeVariance:.3,kaleidoscope1BallCount:18,kaleidoscope1Wedges:8,kaleidoscope1Speed:.8,kaleidoscope1DotSizeVh:.95,kaleidoscope1DotAreaMul:.7,kaleidoscope1SpawnAreaMul:1,kaleidoscope1SizeVariance:.3,kaleidoscope2BallCount:36,kaleidoscope2Wedges:8,kaleidoscope2Speed:1.15,kaleidoscope2DotSizeVh:.95,kaleidoscope2DotAreaMul:.7,kaleidoscope2SpawnAreaMul:1,kaleidoscope2SizeVariance:.3,kaleidoscope3BallCount:54,kaleidoscope3Wedges:8,kaleidoscope3Speed:1.55,kaleidoscope3DotSizeVh:.95,kaleidoscope3DotAreaMul:.7,kaleidoscope3SpawnAreaMul:1,kaleidoscope3SizeVariance:.3,orbit3dPreset:"serene",orbit3dMoonCount:80,orbit3dGravity:5e3,orbit3dMoonMass:1,orbit3dVelocityMult:150,orbit3dTargetOrbit:12,orbit3dMinOrbit:3,orbit3dMaxOrbit:3,orbit3dDepthScale:.8,orbit3dDamping:.02,orbit3d2MoonCount:60,orbit3d2Gravity:3e3,orbit3d2VelocityMult:200,orbit3d2MinOrbit:5,orbit3d2MaxOrbit:30,orbit3d2DepthScale:.5,orbit3d2Damping:.98,orbit3d2MoonMass:1,orbit3d2MaxSpeed:800,neuralBallCount:80,neuralLinkDistanceVw:14,neuralLineOpacity:.22,neuralWanderStrength:420,neuralMaxLinksPerBall:4,neuralDamping:.985,latticeBallCount:90,latticeSpacingVw:8.5,latticeStiffness:2.2,latticeDamping:.92,latticeDisruptRadius:600,latticeDisruptPower:25,latticeMeshWaveStrength:12,latticeMeshWaveSpeed:.8,latticeAlignment:"center",parallaxLinearDotCount:95,parallaxLinearRowPattern:"thirds",parallaxLinearSpacingPattern:"even",parallaxLinearFarPct:.42,parallaxLinearMidPct:.32,parallaxLinearFarSpeed:.15,parallaxLinearMidSpeed:.5,parallaxLinearNearSpeed:1,parallaxLinearFollowStrength:16,parallaxLinearDamping:12,parallaxPerspectiveDotCount:240,parallaxPerspectiveDepthMul:1.6,parallaxPerspectiveFocalLength:400,parallaxPerspectiveFollowStrength:16,parallaxPerspectiveDamping:12,parallaxPerspectiveZ1:1200,parallaxPerspectiveZ2:700,parallaxPerspectiveZ3:350,parallaxPerspectiveZ4:120,parallaxPerspectiveZ5:35,parallaxLinearGridX:14,parallaxLinearGridY:10,parallaxLinearGridZ:7,parallaxLinearSpanX:1.35,parallaxLinearSpanY:1.35,parallaxLinearZNear:50,parallaxLinearZFar:900,parallaxLinearFocalLength:420,parallaxLinearParallaxStrength:260,parallaxLinearDotSizeMul:1.8,parallaxPerspectiveGridX:16,parallaxPerspectiveGridY:12,parallaxPerspectiveGridZ:8,parallaxPerspectiveSpanX:1.45,parallaxPerspectiveSpanY:1.45,parallaxPerspectiveZNear:40,parallaxPerspectiveZFar:1200,parallaxPerspectiveParallaxStrength:280,parallaxPerspectiveRandomness:.6,parallaxPerspectiveDotSizeMul:1.8,waterBallCount:300,waterDrag:.015,waterRippleSpeed:300,waterRippleStrength:18e3,waterDriftStrength:40,waterInitialVelocity:200,vortexDrag:.005,pingPongVerticalDamp:.995,magneticDamping:.98,repelRadius:120,repelPower:274e3,repelSoft:3.4,repellerEnabled:!1,cursorInfluenceRadiusVw:14,cursorInfluenceRadiusPx:140,emitterTimer:0,autoDarkModeEnabled:!0,isDarkMode:!1,chromeHarmonyMode:"site",autoDarkNightStartHour:18,autoDarkNightEndHour:6,clickCycleEnabled:!0,sceneImpactEnabled:!0,sceneImpactMul:.005,sceneImpactMobileMulFactor:1,sceneImpactLogoCompMul:1.8,sceneImpactOvershoot:.22,sceneImpactAnticipation:0,sceneImpactPressMs:0,sceneImpactReleaseMs:620,sceneChangeSoundEnabled:!0,sceneChangeSoundIntensity:.35,sceneChangeSoundRadius:18,brandLogoImpactMul:.014,brandLogoSquashMul:1,brandLogoOvershoot:.22,brandLogoAnticipation:0,brandLogoTiltDeg:0,brandLogoSkewDeg:0,brandLogoPressMs:75,brandLogoHoldMs:55,brandLogoReleaseMs:220,containerBorder:20,containerBorderX:20,simulationPadding:0,contentPadding:40,contentPaddingX:40,contentPaddingY:40,bgLight:"#f5f5f5",bgDark:"#0a0a0a",frameColor:"#0a0a0a",frameColorLight:"#0a0a0a",frameColorDark:"#0a0a0a",textColorLight:"#161616",textColorLightMuted:"#2f2f2f",textColorDark:"#7a8fa3",textColorDarkMuted:"#9db0c4",edgeLabelColorLight:"#2f2f2f",edgeLabelColorDark:"#8a9ba8",edgeLabelInsetAdjustPx:0,linkHoverColor:"#ff4013",logoColorLight:"#161616",logoColorDark:"#b8c5d3",portfolioLogoColorLight:"#161616",portfolioLogoColorDark:"#374862",topLogoWidthVw:35,homeMainLinksBelowLogoPx:40,footerNavBarTopVh:50,footerNavBarGapVw:2.5,wallThickness:12,wallRadius:42,wallInset:3,wallPreset:"pudding",wallSoftness:50,wallBounciness:50,wallWobbleMaxDeform:70,wallWobbleStiffness:420,wallWobbleDamping:92,wallWobbleSigma:5.5,wallWobbleCornerClamp:.25,wallWobbleMaxVel:620,wallWobbleMaxImpulse:160,wallWobbleMaxEnergyPerStep:2e4,wallWobbleImpactThreshold:60,wallWobbleSettlingSpeed:94,gateOverlayEnabled:!0,gateOverlayOpacity:.01,gateOverlayBlurPx:16,gateOverlayTransitionMs:800,gateOverlayTransitionOutMs:600,gateOverlayContentDelayMs:200,gateDepthScale:.96,gateDepthTranslateY:8,logoOpacityInactive:1,logoOpacityActive:.2,logoBlurInactive:0,logoBlurActive:12,entranceEnabled:!0,entranceWallTransitionDelay:300,entranceWallTransitionDuration:800,entranceWallInitialScale:1.1,entranceWallEasing:"cubic-bezier(0.16, 1, 0.3, 1)",entranceElementDuration:200,entranceElementScaleStart:.95,entranceElementTranslateZStart:-20,entranceElementEasing:"ease-out",entrancePerspectiveLandscape:1200,entrancePerspectiveSquare:1e3,entrancePerspectivePortrait:800,uiHitAreaMul:1,uiIconCornerRadiusMul:.4,uiIconFramePx:0,uiIconGlyphPx:0,uiIconGroupMarginPx:0,linkTextPadding:30,linkIconPadding:24,linkColorInfluence:1,linkImpactScale:.95,linkImpactBlur:10,linkImpactDuration:150,getSquashMax(){return 0===this.ballSoftness?0:so.SQUASH_MAX_BASE*(this.ballSoftness/40)},getCanvasCornerRadius(){return Math.max(0,this.cornerRadius-this.simulationPadding)}};var mo=Object.freeze({__proto__:null,applyLayoutCSSVars:m,applyLayoutFromVwToPx:f,clearBalls:w,detectResponsiveScale:x,getBalls:()=>fo.balls,getConfig:()=>fo.config,getEffectiveDPR:()=>ho,getGlobals:b,getLayoutViewportHeightPx:c,getLayoutViewportWidthPx:s,getMobileAdjustedCount:y,getNormalizedScreenArea:p,getScreenAreaPx:d,getState:()=>fo,initState:g,pxToVw:u,setCanvas:M,setEffectiveDPR:i,setMode:v,updateBallSizes:S,vwToPx:h});const go=.85,bo=["#b5b7b6","#bbbdbd","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],yo=["#5b8378","#345d51","#8a928a","#00e6c3","#d5d5d5","#ff6b47","#5b9aff","#ffb84d"],Mo=1.35,vo={satMul:.1,valMul:.03},wo={satMul:.14,valMul:.07},xo={industrialTeal:{label:"Industrial Teal",light:W(bo,.2),dark:W(yo,.2)},industrialRust:{label:"Industrial Rust",light:W(O(A(bo,K(bo,["#b5b7b6","#bbbdbd","#ffffff","#a33a22","#000000","#00695c","#1f4bb8","#ff8a1f"],Mo),go),vo),.2),dark:W(O(A(yo,K(yo,["#7f6f64","#54433a","#b6b1aa","#ff6a3d","#d5d5d5","#00e6c3","#6aa0ff","#ffb15a"],Mo),go),wo),.2)},industrialSlate:{label:"Industrial Slate",light:W(O(A(bo,K(bo,["#b5b7b6","#bbbdbd","#ffffff","#1f2937","#000000","#00a8cc","#7c3aed","#ff5d2e"],Mo),go),vo),.2),dark:W(O(A(yo,K(yo,["#6f7780","#3f4851","#98a2b3","#7dd3fc","#d5d5d5","#22d3ee","#c084fc","#ff7a45"],Mo),go),wo),.2)},industrialAmber:{label:"Industrial Amber",light:W(O(A(bo,K(bo,["#b5b7b6","#bbbdbd","#ffffff","#d97706","#000000","#00695c","#6b46c1","#ff4013"],Mo),go),vo),.2),dark:W(O(A(yo,K(yo,["#82745d","#5a4b35","#a9a193","#fbbf24","#d5d5d5","#00e6c3","#c4b5fd","#ff6b47"],Mo),go),wo),.2)},industrialViolet:{label:"Industrial Violet",light:W(O(A(bo,K(bo,["#b5b7b6","#bbbdbd","#ffffff","#6b46c1","#000000","#00695c","#7fbf2a","#d94666"],Mo),go),vo),.2),dark:W(O(A(yo,K(yo,["#7a6f83","#52475b","#a7a0b0","#c084fc","#d5d5d5","#00e6c3","#bef264","#fb7185"],Mo),go),wo),.2)},industrialForest:{label:"Industrial Forest",light:W(O(A(bo,K(bo,["#b5b7b6","#bbbdbd","#ffffff","#166534","#000000","#00695c","#f59e0b","#7c3aed"],Mo),go),vo),.2),dark:W(O(A(yo,K(yo,["#637563","#3d4f3f","#98a593","#4ade80","#d5d5d5","#00e6c3","#fcd34d","#c4b5fd"],Mo),go),wo),.2)},industrialSteel:{label:"Industrial Steel",light:W(O(A(bo,K(bo,["#b5b7b6","#bbbdbd","#ffffff","#334155","#000000","#0ea5e9","#c2410c","#65a30d"],Mo),go),vo),.2),dark:W(O(A(yo,K(yo,["#6f737a","#464a52","#98a2ab","#94a3b8","#d5d5d5","#38bdf8","#fb923c","#a3e635"],Mo),go),wo),.2)}},So=["industrialTeal","industrialRust","industrialSlate","industrialAmber","industrialViolet","industrialForest","industrialSteel"],ko="abs_palette_chapter",Co=[.5,.25,.12,.06,.03,.02,.01,.01],Po=[3,5,6,7];var Fo=Object.freeze({__proto__:null,COLOR_TEMPLATES:xo,PALETTE_CHAPTER_ORDER:So,applyColorTemplate:Y,applyCursorColorIndex:G,getCurrentPalette:j,getCursorCandidateIndices:_,maybeAutoPickCursorColor:H,pickRandomColor:Z,populateColorSelect:X,rotatePaletteChapterOnReload:U});const To={attackTime:.005,decayTime:.075,harmonicGain:0,filterBaseFreq:580,filterVelocityRange:400,filterQ:.18,filterMinHz:350,filterMaxHz:2800,pitchMinHz:145,pitchMaxHz:280,pitchCurve:1,reverbDecay:.14,reverbWetMix:.08,reverbHighDamp:.8,minGain:.008,maxGain:.09,masterGain:.28,voiceGainMax:.14,minTimeBetweenSounds:.012,maxPan:.15,noiseTransientEnabled:!0,noiseTransientGain:.045,noiseTransientDecay:.008,noiseTransientFilterMin:500,noiseTransientFilterMax:1800,noiseTransientQ:1.2,sparkleGain:0,sparkleRatioMin:2.3,sparkleRatioMax:4.1,sparkleDecayMul:.65,variancePitch:.06,varianceDecay:.2,varianceGain:.15,varianceFilter:.18,varianceNoise:.25,velocityNoiseScale:1.8,velocityBrightnessScale:1.4,velocityDecayScale:.65,intensityExponent:1.5,toneSafetyMinHz:130,toneSafetyMaxHz:480,toneSafetyExponent:2.2,toneSafetyHighGainAtten:.25,toneSafetyLowGainAtten:.06,toneSafetyHighBrightAtten:.45,collisionMinImpact:.58,highShelfFreq:2200,highShelfGain:-6};let Io=null;const Do={organicImpact:{label:"Organic Impact",description:"Warm, natural thuds with intensity dynamics",...To},glassMarbles:{label:"Glass Marbles",description:"Clear, glassy impacts with more presence",...To,pitchMinHz:260,pitchMaxHz:780,pitchCurve:1.05,filterBaseFreq:850,filterVelocityRange:600,noiseTransientGain:.065,noiseTransientFilterMin:650,noiseTransientFilterMax:2200,noiseTransientQ:1.6,decayTime:.055,intensityExponent:1.3,highShelfGain:-4.5},crystalPebbles:{label:"Crystal Pebbles ★",description:"Crisp, close, soothing micro-chimes (non-repetitive)",...To,pitchMinHz:420,pitchMaxHz:1600,pitchCurve:1.15,filterBaseFreq:1300,filterVelocityRange:1700,filterQ:.22,filterMaxHz:6200,decayTime:.04,intensityExponent:1.65,collisionMinImpact:.7,minTimeBetweenSounds:.018,noiseTransientGain:.02,noiseTransientDecay:.006,noiseTransientFilterMin:1200,noiseTransientFilterMax:7e3,noiseTransientQ:2.8,sparkleGain:.12,sparkleRatioMin:2.6,sparkleRatioMax:4.4,sparkleDecayMul:.55,reverbWetMix:.04,reverbDecay:.1,highShelfGain:-4,masterGain:.24},woodenBeads:{label:"Wooden Beads ★",description:"Ultra-soft, muted thuds (recommended)",...To,filterBaseFreq:420,filterVelocityRange:200,noiseTransientGain:.025,noiseTransientFilterMin:380,noiseTransientFilterMax:1400,noiseTransientQ:1.1,decayTime:.095,intensityExponent:1.7,collisionMinImpact:.62,highShelfGain:-7.5,reverbWetMix:.12},rubberBalls:{label:"Rubber Balls",description:"Bouncy, playful with longer decay",...To,pitchMinHz:160,pitchMaxHz:360,filterBaseFreq:520,filterVelocityRange:350,noiseTransientGain:.035,noiseTransientFilterMin:450,noiseTransientFilterMax:1600,noiseTransientQ:1.2,decayTime:.12,intensityExponent:1.4,reverbWetMix:.14,highShelfGain:-5},metallicClick:{label:"Metallic Click",description:"Crisp, percussive impacts",...To,pitchMinHz:220,pitchMaxHz:620,pitchCurve:1.1,filterBaseFreq:720,filterVelocityRange:550,noiseTransientGain:.08,noiseTransientFilterMin:700,noiseTransientFilterMax:2400,noiseTransientQ:1.8,noiseTransientDecay:.006,decayTime:.045,intensityExponent:1.2,highShelfGain:-3.5,collisionMinImpact:.5}};let Lo="crystalPebbles";Io={...Do[Lo]},delete Io.label,delete Io.description;let Ao=null,Ko=null,Oo=null,Wo=null,zo=null,Eo=null,Ro=null,Bo=null,Vo=null,No=!1,$o=!1;const _o="bravia-balls:sound-state",Go=8;let Ho=[],jo=0,Zo=new Map,Yo=!1,Xo=null,Uo=!1;const qo=new Map,Jo=[],Qo=[],en=384,tn=45,an=1/30,on=.25;let nn=null;class rn{constructor(e){const t=Math.max(8,Math.round(e||en));this.n=t,this.deformations=new Float32Array(t),this.velocities=new Float32Array(t),this.pressure=new Float32Array(t),this.renderDeformations=new Float32Array(t),this.$=0,this._=0,this.H=0,this.Z=0,this.Y=0,this.X=0,this.U=0,this.q=0,this.J=0,this.ee=0,this.te=0,this.ae=0,this.oe=0,this.ne=0,this.ie=0,this.baseX=new Float32Array(t),this.baseY=new Float32Array(t),this.normX=new Float32Array(t),this.normY=new Float32Array(t),this.cornerMask=new Float32Array(t),this.re=0,this.le=0,this.se=!1,this.ce=0}ensureSampleCount(e){const t=Math.max(8,Math.round(+e||en));if(t===this.n)return;const a=this.n,o=this.deformations,n=this.velocities,i=this.pressure,r=new Float32Array(t),l=new Float32Array(t),s=new Float32Array(t),c=new Float32Array(t);if(a>0){let e=0,c=0;for(let d=0;t>d;d++){const p=d/t*a,u=Math.floor(p)%a,h=p-u,f=(u+1)%a,m=(1-h)*o[u]+h*o[f],g=(1-h)*n[u]+h*n[f],b=(1-h)*i[u]+h*i[f];r[d]=m,l[d]=g,s[d]=b,m>e&&(e=m);const y=Math.abs(g);y>c&&(c=y)}this.re=e,this.le=c,this.se=e>0||c>0}else this.re=0,this.le=0,this.se=!1;this.n=t,this.deformations=r,this.velocities=l,this.pressure=s,this.renderDeformations=c,this.baseX=new Float32Array(t),this.baseY=new Float32Array(t),this.normX=new Float32Array(t),this.normY=new Float32Array(t),this.cornerMask=new Float32Array(t),this.$=0,this._=0,this.H=0,this.Z=0,this.Y=0,this.X=0,this.U=0,this.q=0,this.J=0,this.ee=0,this.te=0,this.ae=0,this.oe=0,this.ne=0,this.ie=0}clearPressure(){this.pressure.fill(0)}reset(){this.deformations.fill(0),this.velocities.fill(0),this.pressure.fill(0),this.renderDeformations.fill(0),this.re=0,this.le=0,this.se=!1,this.ce=0}hasDeformation(){return this.re>2}ensureGeometry(e,t,a){const o=Math.max(1,0|e),n=Math.max(1,0|t),i=Math.max(0,Math.min(+a||0,.5*Math.min(o,n)));if(o===this.$&&n===this._&&.001>Math.abs(i-this.H))return;if(this.$=o,this._=n,this.H=i,0>=i){const e=o,t=n,a=2*(e+t);this.Z=e,this.Y=t,this.X=0,this.U=a,this.ee=0,this.J=e/2,this.q=e/2+t,this.te=e/2+t+e,this.ae=0,this.oe=0,this.ne=0,this.ie=0;for(let i=0;this.n>i;i++){const r=(i/this.n*a+e/2)%a;if(e/2>r)this.baseX[i]=o/2+r,this.baseY[i]=n,this.normX[i]=0,this.normY[i]=-1;else if(e/2+t>r){const t=r-e/2;this.baseX[i]=o,this.baseY[i]=t,this.normX[i]=-1,this.normY[i]=0}else if(e/2+t+e>r)this.baseX[i]=o-(r-(e/2+t)),this.baseY[i]=0,this.normX[i]=0,this.normY[i]=1;else if(e/2+t+e+t>r){const a=r-(e/2+t+e);this.baseX[i]=0,this.baseY[i]=n-a,this.normX[i]=1,this.normY[i]=0}else this.baseX[i]=r-(e/2+t+e+t),this.baseY[i]=n,this.normX[i]=0,this.normY[i]=-1;this.cornerMask[i]=0}return}const r=Math.max(0,o-2*i),l=Math.max(0,n-2*i),s=.5*Math.PI*i,c=2*(r+l)+4*s;this.Z=r,this.Y=l,this.X=s,this.U=c,this.ee=0,this.ie=r/2,this.J=r/2+s,this.oe=r/2+s+l,this.q=r/2+s+l+s,this.ae=r/2+s+l+s+r,this.te=r/2+s+l+s+r+s,this.ne=r/2+s+l+s+r+s+l;const d=o,p=n,u=i,h=this.n,f=(e,t,a,o,n,i)=>{const r=o+(n-o)*i,l=Math.cos(r),s=Math.sin(r);return{x:e+a*l,y:t+a*s,nx:-l,ny:-s}},m=r/2,g=m+s,b=g+l,y=b+s,M=y+r,v=M+s,w=v+l,x=w+s,S=u+r/2,k=d-u,C=u;for(let P=0;h>P;P++){let e=(P/h*c+r/2)%c,t=0,a=0,o=0,n=0,i=0;if(m>e)t=S+e,a=p,o=0,n=-1;else if(g>e){const r=f(d-u,p-u,u,Math.PI/2,0,(e-m)/s);t=r.x,a=r.y,o=r.nx,n=r.ny,i=1}else if(b>e)t=d,a=p-u-(e-g),o=-1,n=0;else if(y>e){const r=f(d-u,u,u,0,-Math.PI/2,(e-b)/s);t=r.x,a=r.y,o=r.nx,n=r.ny,i=1}else if(M>e)t=k-(e-y),a=0,o=0,n=1;else if(v>e){const r=f(u,u,u,3*Math.PI/2,Math.PI,(e-M)/s);t=r.x,a=r.y,o=r.nx,n=r.ny,i=1}else if(w>e)t=0,a=u+(e-v),o=1,n=0;else if(x>e){const r=f(u,p-u,u,Math.PI,Math.PI/2,(e-w)/s);t=r.x,a=r.y,o=r.nx,n=r.ny,i=1}else t=C+(e-x),a=p,o=0,n=-1;this.baseX[P]=t,this.baseY[P]=a,this.normX[P]=o,this.normY[P]=n,this.cornerMask[P]=i?1:0}}tFromPoint(e,t){const a=this.$,o=this._;if(0===this.n||0>=a||0>=o)return 0;const n=a,i=o,r=this.H,l=e>n-r&&r>t,s=r>e&&t>i-r,c=e>n-r&&t>i-r;let d=0;if(r>e&&r>t){const a=e-r,o=t-r;if(Math.sqrt(a*a+o*o)>0){const e=this.ae/this.U,t=(this.ae+this.X)/this.U;d=e+Math.max(0,Math.min(1,(Math.atan2(o,a)-Math.PI)/(Math.PI/2)))*(t-e)}else d=this.ae/this.U}else if(l){const a=e-(n-r),o=t-r;if(Math.sqrt(a*a+o*o)>0){const e=this.oe/this.U,t=(this.oe+this.X)/this.U;d=e+Math.max(0,Math.min(1,(Math.atan2(o,a)+Math.PI/2)/(Math.PI/2)))*(t-e)}else d=this.oe/this.U}else if(c){const a=e-(n-r),o=t-(i-r);if(Math.sqrt(a*a+o*o)>0){const e=this.ie/this.U,t=(this.ie+this.X)/this.U;d=e+Math.max(0,Math.min(1,Math.atan2(o,a)/(Math.PI/2)))*(t-e)}else d=this.ie/this.U}else if(s){const a=e-r,o=t-(i-r);if(Math.sqrt(a*a+o*o)>0){const e=this.ne/this.U,t=1;d=e+Math.max(0,Math.min(1,(Math.atan2(o,a)-Math.PI/2)/(Math.PI/2)))*(t-e),1>d||(d-=1)}else d=this.ne/this.U}else if(r>t)d=(this.q+Math.max(0,Math.min(this.Z,e-r)))/this.U;else if(e>n-r)d=(this.J+Math.max(0,Math.min(this.Y,t-r)))/this.U;else if(t>i-r){const t=n-r-e;t>this.Z/2?(d=(this.ee+(this.Z/2+(this.Z/2-(e-r))))/this.U,1>d||(d-=1)):d=(this.ee+(this.Z/2-t))/this.U}else r>e&&(d=(this.te+Math.max(0,Math.min(this.Y,i-r-t)))/this.U);return(d%1+1)%1}getDeformationAtPoint(e,t){const a=this.n;if(0===a)return 0;const o=this.tFromPoint(e,t)*a,n=Math.floor(o)%a,i=o-n;return(1-i)*this.deformations[n]+i*this.deformations[(n+1)%a]}impactAtPoint(e,t,a){const o=this.tFromPoint(e,t);this.impactAtT(o,a)}addPressureAtPoint(e,t,a,o={}){const n=this.tFromPoint(e,t);this.addPressureAtT(n,a,o)}tFromWall(e,t){const a=this.$,o=this._,n=this.H,i=this.Z,r=this.Y,l=this.U;if(0>=l)return 0;const s=Math.max(0,Math.min(1,+t||0));return"top"===e?(this.q+Math.max(0,Math.min(i,s*a-n)))/l:"right"===e?(this.J+Math.max(0,Math.min(r,s*o-n)))/l:"bottom"===e?(this.ee+Math.max(0,Math.min(i,a-n-s*a)))/l:"left"===e?(this.te+Math.max(0,Math.min(r,o-n-s*o)))/l:0}impactAtT(e,t){const a=b(),o=this.n;if(0>=o)return;const n=Math.max(0,a.wallWobbleMaxDeform??tn)*Math.max(0,Math.min(1,+t||0));if(0>=n)return;const i=Math.max(.25,Math.min(6,a.wallWobbleSigma??2)),r=((+e||0)%1+1)%1*o,l=Math.max(0,+(a.wallWobbleMaxImpulse??220)||0),s=Math.max(0,+(a.wallWobbleMaxVel??800)||0),c=Math.max(0,+(a.wallWobbleMaxEnergyPerStep??2e4)||0),d=Math.max(2,Math.min(o,Math.min(24,Math.ceil(3*i))));for(let p=-d;d>=p;p++){const e=((Math.round(r)+p)%o+o)%o,t=Math.abs(r-e),a=Math.min(t,o-t);let d=n*Math.exp(-a*a/(2*i*i));l>0&&d>l&&(d=l);const u=this.pressure[e]||0;if(u>0&&(d*=Math.max(on,1-.65*u)),c>0){const e=c-this.ce;if(0>=e)break;d>e&&(d=e)}let h=this.velocities[e]+d;if(s>0){const t=this.pressure[e]||0,a=t>0?s*Math.max(on,1-.55*t):s;h>a?h=a:-a>h&&(h=-a)}this.velocities[e]=h,c>0&&(this.ce+=Math.abs(d))}this.se=!0}addPressureAtT(e,t,a={}){const o=this.n;if(0>=o)return;const n=Math.max(0,Math.min(1,+t||0));if(0>=n)return;const i=Math.round(((+e||0)%1+1)%1*o)%o,r=a.fast?1:3;for(let l=-r;r>=l;l++){const e=((i+l)%o+o)%o,t=this.pressure[e]+n*Math.max(0,1-Math.abs(l)/(r+1));this.pressure[e]=t>1?1:t}this.se=!0}step(e){const t=b(),a=this.n;if(0>=a)return;const o=Math.min(an,Math.max(0,+e||0));if(0>=o)return;if(!this.se){let e=!1;const n=200,i=3,r=5;for(let l=0;a>l;l++)if(this.deformations[l]>.001||Math.abs(this.velocities[l])>.001){e=!0;const a=1>this.baseY[l]&&!this.cornerMask[l]&&this.normY[l]>.7,s=!this.cornerMask[l]&&this.H+2>this.baseX[l]&&this.H+2>this.baseY[l],c=s||!this.cornerMask[l]&&this.baseX[l]>this.$-this.H-1&&this.H+1>this.baseY[l],d=this.cornerMask[l]&&this.H+3>this.baseX[l]&&this.H+3>this.baseY[l],p=d||this.cornerMask[l]&&this.baseX[l]>this.$-this.H-2&&this.H+2>this.baseY[l];this.velocities[l]+=(-(d||s?n*i*r:a||c||p?n*i:n)*this.deformations[l]-20*this.velocities[l])*o,this.deformations[l]+=this.velocities[l]*o;const u=Math.max(0,t.wallWobbleMaxDeform??tn);-u>this.deformations[l]?(this.deformations[l]=-u,this.velocities[l]=0):this.deformations[l]>u&&(this.deformations[l]=u,this.velocities[l]=0);const h=a||c||p,f=d||s;(f?.01:h?.02:.1)>this.deformations[l]&&(f?.2:h?.3:1)>Math.abs(this.velocities[l])&&(this.deformations[l]=0,this.velocities[l]=0)}return this.se=e,void(e||(this.re=0,this.le=0))}const n=Math.max(1,t.wallWobbleStiffness??2200),i=Math.max(0,t.wallWobbleDamping??35),r=Math.max(0,t.wallWobbleMaxDeform??tn),l=Math.max(0,+(t.wallWobbleMaxVel??800)||0),s=1+5*Math.max(0,Math.min(1,+t.wallWobbleCornerClamp||0)),c=.18*n,d=Math.max(0,Math.min(100,t.wallWobbleSettlingSpeed??50))/100,p=5+30*d,u=.5+1.5*d;let h=0,f=0;for(let m=0;a>m;m++){const e=0===m?a-1:m-1,t=m===a-1?0:m+1,d=this.deformations[m],g=this.velocities[m],b=this.cornerMask[m]?1:0,y=b&&this.H+3>this.baseX[m]&&this.H+3>this.baseY[m]?3:b&&this.baseX[m]>this.$-this.H-2&&this.H+2>this.baseY[m]?2:1,M=n*(b?s*y:b?y:!b&&1>this.baseY[m]&&this.normY[m]>.7||!b&&this.H+2>this.baseX[m]&&this.H+2>this.baseY[m]||!b&&this.baseX[m]>this.$-this.H-1&&this.H+1>this.baseY[m]?4:2),v=Math.abs(d),w=Math.abs(g),x=this.pressure[m];let S=g+(-M*d+c*(this.deformations[e]+this.deformations[t]-2*d)-Math.min(i*(1+1*Math.max(0,Math.min(1,1-v/20)))*(1+x*p),1.9*Math.sqrt(M+2*c))*g)*o;if(l>0){const e=this.pressure[m]||0,t=e>0?l*Math.max(on,1-.55*e):l;S>t?S=t:-t>S&&(S=-t)}let k=d+S*o,C=!1,P=!1;-r>k&&(k=-r,C=!0),k>r&&(k=r,P=!0),C&&0>S&&(S=0),P&&S>0&&(S=0);const F=!b&&1>this.baseY[m]&&this.normY[m]>.7||!b&&this.H+2>this.baseX[m]&&this.H+2>this.baseY[m]||!b&&this.baseX[m]>this.$-this.H-1&&this.H+1>this.baseY[m]||b&&this.H+3>this.baseX[m]&&this.H+3>this.baseY[m]||b&&this.baseX[m]>this.$-this.H-2&&this.H+2>this.baseY[m]?5:this.cornerMask[m]?1:3,T=(x>.5?.5:x>.1?3:10)*u*F;(x>.5?.3:x>.1?.8:2)*u*F>Math.abs(k)&&T>w?(this.deformations[m]=0,this.velocities[m]=0):(this.deformations[m]=k,this.velocities[m]=S),this.deformations[m]>h&&(h=this.deformations[m]);const I=Math.abs(this.velocities[m]);I>f&&(f=I)}Number.isFinite(h)&&Number.isFinite(f)?(this.re=h,this.le=f,this.se=h>0||f>0):this.reset()}}const ln={ringPhysics:new rn(en),ringRender:new rn(en),de:0,pe:0,ue:1/30,he:0,B:0,fe:null,V:null,N:null,me:null,resetStepBudgets(){this.de=0,this.pe=0,this.ringPhysics.ce=0},clearPressureFrame(){this.ringPhysics.clearPressure()},step(e){const t=b(),a=!1!==t.wallPhysicsAdaptiveSamples,o=Math.max(8,Math.min(48,Math.round(+(t.wallPhysicsMinSamples??24)||24))),n=Math.min(en,Math.round(+(t.wallPhysicsSamples??en)||en));if(!1!==t.wallPhysicsSkipInactive&&!this.ringPhysics.se)return this.ringPhysics.step(e),this.ringRender.step(e),void(this.B=1);const i=1/Math.max(10,Math.min(60,+(t.wallPhysicsUpdateHz??30)||30)),r=!1!==t.wallPhysicsInterpolation;if(this.he+=e,i>this.he)this.B=r?Math.max(0,Math.min(1,this.he/i)):1;else{if(a){const e=this.ringPhysics.n;let t=e;t=this.ringPhysics.se?5>(this.ringPhysics.re||0)&&2>(this.ringPhysics.le||0)?Math.max(o,Math.min(n,e-1)):Math.min(n,Math.max(o,e+1)):Math.max(o,Math.min(n,e-1)),t!==e&&this.ringPhysics.ensureSampleCount(t)}else{const e=Math.max(8,Math.min(en,n));this.ringPhysics.n!==e&&this.ringPhysics.ensureSampleCount(e)}if(r&&this.ringPhysics.n>0){const e=this.ringPhysics.n;this.fe&&this.fe.length===e||(this.fe=new Float32Array(e)),this.fe.set(this.ringPhysics.deformations)}let e=i;this.he-=i;const s=1/Math.max(30,Math.min(240,+(t.wallPhysicsMaxSubstepHz??60)||60));let c=0;const d=6;for(;e>1e-6&&d>c;){const t=e>s?s:e;this.ringPhysics.step(t),e-=t,c++}try{const e=this.ringPhysics,t=0|e.n,a=0|this.ringRender.n;if(t>0&&a>0){this.V&&this.V.length===a?this.V.set(this.N):(this.V=new Float32Array(a),this.N=new Float32Array(a),this.me=new Float32Array(a));const o=e.deformations,n=this.me,i=this.N;for(let e=0;a>e;e++){const i=e/a*t,r=Math.floor(i)%t,l=i-r;n[e]=(1-l)*o[r]+l*o[(r+1)%t]}for(let e=0;a>e;e++)i[e]=(n[(e-2+a)%a]+4*n[(e-1+a)%a]+6*n[e]+4*n[(e+1)%a]+n[(e+2)%a])*(1/16)}}catch(l){}this.B=r?Math.max(0,Math.min(1,this.he/i)):1}},reset(){this.ringPhysics.reset(),this.ringRender.reset(),this.he=0,this.B=0,this.fe=null,this.V=null,this.N=null,this.me=null},hasAnyDeformation(){return this.ringPhysics.hasDeformation()},getDeformationAtPoint(e,t){const a=this.ringPhysics;if(!a||0===a.n)return 0;const o=b();if(!o.canvas)return 0;const n=o.DPR||1,i=Math.max(0,(+o.wallThickness||0)*n),r=a.getDeformationAtPoint(e-i,t-i);return r>0?r*n:0}};let sn=0;class cn{constructor(e,t,a,o){const n=b();this.x=e,this.y=t,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=a,this.rBase=a,this.m=n.ballMassKg,this.color=o,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1,this.isSleeping=!1,this.sleepTimer=0,this.isGrounded=!1,this.hasSupport=!1,this.ge="ball-"+sn++}step(e,t){const a=b(),{currentMode:o,G:n,gravityScale:i,FRICTION:r,MASS_BASELINE_KG:l}=a;if(this.t+=e,this.age+=e,this.isSleeping){const e=(a.repelRadius||710)*a.DPR*1.2,t=this.x-a.mouseX,o=this.y-a.mouseY;e*e>t*t+o*o&&this.wake()}if(this.isSleeping&&!1!==a.physicsSkipSleepingSteps)return;const s=a.DPR||1,c=this.isGrounded,d=this.hasSupport;this.isGrounded=!1,this.hasSupport=!1,o!==io.WEIGHTLESS&&(!c&&!d||-8*s>this.vy)&&(this.vy+=n*i*e);const p=Math.max(.25,this.m/l),u=Math.max(0,1-(o===io.WEIGHTLESS||o===io.ORBIT_3D||o===io.ORBIT_3D_2?0:r)*(1+1*Math.max(0,Math.min(1,1-Math.sqrt(this.vx*this.vx+this.vy*this.vy)/(100*s))))/p);if(this.vx*=u,this.vy*=u,o!==io.ORBIT_3D&&o!==io.ORBIT_3D_2){const e=2*s;e>Math.abs(this.vx)&&(this.vx=0),e>Math.abs(this.vy)&&o===io.WEIGHTLESS&&(this.vy=0)}0!==this.driftAx&&this.driftTime>this.age?this.vx+=this.driftAx*e/p:0!==this.driftAx&&(this.driftAx=0),t&&t(this,e),this.x+=this.vx*e,this.y+=this.vy*e,this.omega*=Math.max(0,1-so.SPIN_DAMP_PER_S*(1+.5*Math.max(0,Math.min(1,1-Math.abs(this.omega)/2)))*e),this.theta+=this.omega*e,.01>Math.abs(this.omega)&&(this.omega=0),this.squashAmount+=(0-this.squashAmount)*Math.min(1,so.SQUASH_DECAY_PER_S*e),this.squash=1-this.squashAmount}updateSleepState(e,t){const a=Math.sqrt(this.vx*this.vx+this.vy*this.vy),o=Math.abs(this.omega),n=t.DPR||1,i=(Number.isFinite(t.sleepVelocityThreshold)?t.sleepVelocityThreshold:so.SLEEP_VELOCITY_THRESHOLD)*n,r=Number.isFinite(t.sleepAngularThreshold)?t.sleepAngularThreshold:so.SLEEP_ANGULAR_THRESHOLD,l=Number.isFinite(t.timeToSleep)?t.timeToSleep:so.TIME_TO_SLEEP;(this.isGrounded||this.hasSupport)&&i>a&&r>o?(this.sleepTimer+=e,l>this.sleepTimer||(this.vx=0,this.vy=0,this.omega=0,this.isSleeping=!0)):this.sleepTimer=0}wake(){this.isSleeping=!1,this.sleepTimer=0}walls(e,t,a,o,n={}){const i=!1!==n.registerEffects,r=b(),{REST:l,MASS_BASELINE_KG:s,currentMode:c,DPR:d}=r,p=void 0!==o?o:l,u=r.wallWobbleImpactThreshold??so.WALL_REST_VEL_THRESHOLD,h=this.r*(1+(r.ballSpacing||0)),f="function"==typeof r.getCanvasCornerRadius?r.getCanvasCornerRadius():r.cornerRadius??r.wallRadius??0,m=Math.max(0,+f||0)*(d||1),g=Math.max(0,(r.wallThickness??0)*(d||1)),y=Math.max(0,r.wallInset??3)*(d||1),M=Math.max(1,e-2*g),v=Math.max(1,t-2*g);let w=!1;const x=c===io.PIT||c===io.PIT_THROWS,S=.5*M,k=.5*v,C=Math.max(0,Math.min(m,.5*M,.5*v)),P=this.x-(g+S),F=this.y-(g+k),T=Math.abs(P)-(S-C),I=Math.abs(F)-(k-C),D=Math.hypot(Math.max(T,0),Math.max(I,0))+Math.min(Math.max(T,I),0)-C;let L=0,A=0;if(T>0&&I>0){const e=Math.hypot(T,I);e>1e-6&&(L=T/e,A=I/e)}else T>I?(L=1,A=0):(L=0,A=1);L*=0>P?-1:1,A*=0>F?-1:1;const K=D+(h+y);if(K>0&&(!x||A>=-.5)){w=!0;const t=this.vx*L+this.vy*A;this.x-=L*K,this.y-=A*K,t>0&&(this.vx-=(1+p)*t*L,this.vy-=(1+p)*t*A);const o=A>.7,n=Math.abs(t),l=Math.min(1,n/(80*this.r));if(o){this.isGrounded=!0;const e=Math.max(.25,this.m/s);this.vx*=Math.max(0,1-so.ROLL_FRICTION_PER_S*(1+Math.max(0,Math.min(1,1-Math.abs(this.vx)/(80*d))))*a/e),3*d>Math.abs(this.vx)&&(this.vx=0),this.omega+=(this.vx-this.omega*this.r)/this.r*so.SPIN_GAIN/e,this.omega+=(this.vx/this.r-this.omega)*Math.min(1,so.GROUND_COUPLING_PER_S*a),.05>Math.abs(this.omega)&&(this.omega=0)}if(this.squashAmount=Math.min(r.getSquashMax(),.8*l),this.squashNormalAngle=Math.atan2(-A,-L),i){te(this.r,.65*l,this.x/Math.max(1,e),this.ge);const a=Math.max(0,t);this.isSleeping||u>a||((e,t,a)=>{const o=b(),n=o.canvas;if(!n)return;const i="function"==typeof o.getCanvasCornerRadius?o.getCanvasCornerRadius():o.cornerRadius??o.wallRadius??0,r=Math.max(0,(+i||0)*(o.DPR||1)),l=Math.max(0,(+o.wallThickness||0)*(o.DPR||1)),s=Math.max(1,n.width-2*l),c=Math.max(1,n.height-2*l);ln.ringPhysics.ensureGeometry(s,c,Math.max(0,Math.min(r,.5*s,.5*c)));const d=e-l,p=t-l;if(64>ln.de)ln.ringPhysics.impactAtPoint(d,p,a);else{const e=ln.ringPhysics.n;if(e>0){const t=ln.ringPhysics.tFromPoint(d,p);ln.ringPhysics.velocities[Math.round(((+t||0)%1+1)%1*e)%e]+=Math.max(0,o.wallWobbleMaxDeform??tn)*Math.max(0,Math.min(1,+a||0)),ln.ringPhysics.se=!0}}ln.de++})(this.x-L*h,this.y-A*h,Math.min(1,a/(80*this.r)));const o=this.isSleeping?1:Math.max(0,(u-n)/u);o>.1&&((e,t,a=1)=>{const o=b(),n=o.canvas;if(!n)return;const i="function"==typeof o.getCanvasCornerRadius?o.getCanvasCornerRadius():o.cornerRadius??o.wallRadius??0,r=Math.max(0,(+i||0)*(o.DPR||1)),l=Math.max(0,(+o.wallThickness||0)*(o.DPR||1)),s=Math.max(1,n.width-2*l),c=Math.max(1,n.height-2*l);ln.ringPhysics.ensureGeometry(s,c,Math.max(0,Math.min(r,.5*s,.5*c))),ln.ringPhysics.addPressureAtPoint(e-l,t-l,a,{fast:ln.pe>=256}),ln.pe++})(this.x-L*h,this.y-A*h,o)}}w&&this.isSleeping&&this.wake()}draw(e){const t=this.squashAmount>.001,a=1>this.alpha;t||a?(e.save(),e.translate(this.x,this.y),t?(e.rotate(this.theta+this.squashNormalAngle),e.scale(1-.3*this.squashAmount,1+.3*this.squashAmount),e.rotate(-this.squashNormalAngle)):e.rotate(this.theta),a&&(e.globalAlpha=this.alpha),e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI),e.fillStyle=this.color,e.fill(),e.restore()):(e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.r,0,2*Math.PI),e.fill())}}const dn=.2,pn=[];let un,hn,fn=so.DPR,mn=0,gn=0,bn=null,yn=null,Mn=0,vn=0,wn=0;var xn=Object.freeze({__proto__:null,getCanvas:Le,resize:De,setForceRenderCallback:Te,setupRenderer:Ie});const Sn=2*Math.PI;let kn=0;var Cn=Object.freeze({__proto__:null,MODES:io,getModeRenderer:je,getModeUpdater:He,resetCurrentMode:Ge,setMode:_e});let Pn=null,Fn=!1,Tn=!1,In=null,Dn=0,Ln=!1,An=null;const Kn="translate(-50%, -50%) scale(0.25)",On="translate(-50%, -50%) scale(1)";var Wn=Object.freeze({__proto__:null,getCursorColor:Ze,hideCursor:qe,setupCustomCursor:Ye,showCursor:Je,updateCursorPosition:Ue,updateCursorSize:Xe});let zn=0,En=null,Rn=null,Bn=null,Vn=0,Nn=0,$n=!1;const _n=so.PHYSICS_DT;let Gn=0;const Hn=42,jn=1/60;var Zn=Object.freeze({__proto__:null,getBalls:()=>b().balls||[],render:it,syncChromeColor:rt,updatePhysics:nt});const Yn=(()=>{try{return{log:console.log?.bind(console)??(()=>{}),info:console.info?.bind(console)??(()=>{}),warn:console.warn?.bind(console)??(()=>{}),error:console.error?.bind(console)??(()=>{}),debug:console.debug?.bind(console)??(()=>{}),groupCollapsed:console.groupCollapsed?.bind(console)??(()=>{}),groupEnd:console.groupEnd?.bind(console)??(()=>{}),table:console.table?.bind(console)??(()=>{})}}catch(e){return{log(){},info(){},warn(){},error(){},debug(){},groupCollapsed(){},groupEnd(){},table(){}}}})();let Xn=null,Un=0,qn="undefined"!=typeof performance&&performance.now?performance.now():Date.now(),Jn=!1;const Qn=["#b7bcb7","#d0d0d0","#ffffff","#00695c","#1a1a1a","#ff4013","#0d5cb6","#ffa000"],ei=[.5,.25,.12,.06,.03,.02,.01,.01];let ti=null,ai=null,oi="auto",ni="light",ii=!1;var ri=Object.freeze({__proto__:null,getCurrentTheme:()=>oi,initializeDarkMode:bt,setTheme:gt,toggleDarkMode:yt});let li=!1,si=null,ci=null,di=null,pi=null,ui=null,hi=0,fi=null,mi=0,gi=null,bi="";const yi=["noiseEnabled","noiseSeed","noiseTextureSize","noiseDistribution","noiseMonochrome","noiseChroma","noiseMotion","noiseMotionAmount","noiseSpeedBackMs","noiseSpeedFrontMs","noiseFlicker","noiseFlickerSpeedMs","noiseBlurPx","noiseContrast","noiseBrightness","noiseSaturation","noiseHue","noiseSizeBase","noiseSizeTop","noiseBackOpacity","noiseFrontOpacity","noiseBackOpacityDark","noiseFrontOpacityDark","noiseTopOpacity","detailNoiseOpacity"],Mi=new Map,vi=new Map;let wi={};(()=>{try{const e=localStorage.getItem("panel_control_visibility");e&&(wi=JSON.parse(e))}catch(e){wi={}}})();const xi=["physics","wall","balls","colorDistribution","colors","uiSpacing","noise","cursor","trail","links","scene","overlay","entrance","environment"],Si={physics:"MATERIAL WORLD",wall:"MATERIAL WORLD",balls:"MATERIAL WORLD",colorDistribution:"LOOK & PALETTE",colors:"LOOK & PALETTE",noise:"LOOK & PALETTE",cursor:"INTERACTION",trail:"INTERACTION",links:"INTERACTION",scene:"MOTION",entrance:"MOTION",overlay:"DEPTH & LAYOUT",layout:"DEPTH & LAYOUT",uiSpacing:"DEPTH & LAYOUT",sound:"SOUND",environment:"ENVIRONMENT"},ki={environment:{title:"Browser",icon:"🧭",defaultOpen:!1,controls:[{id:"chromeHarmonyMode",label:"Chrome Harmony",stateKey:"chromeHarmonyMode",type:"select",options:[{value:"auto",label:"Auto (adapt only when needed)"},{value:"site",label:"Site (benchmark)"},{value:"browser",label:"Browser (force adapt)"}],default:"site",format:e=>e+"",parse:e=>e+"",hint:"If desktop browsers ignore theme-color, the wall adapts to match the browser UI palette.",onChange(){Promise.resolve().then(()=>ri).then(({getCurrentTheme:e,setTheme:t})=>{t(e())}).catch(()=>{})}},{id:"autoDarkModeEnabled",label:"Auto Dark (Night)",stateKey:"autoDarkModeEnabled",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,hint:"In Auto theme, prefer Dark during the night window (privacy-first: local clock only).",onChange(){Promise.resolve().then(()=>ri).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}},{id:"autoDarkNightStartHour",label:"Night Starts",stateKey:"autoDarkNightStartHour",type:"range",min:0,max:23,step:1,default:18,format:e=>Math.round(e)+":00",parse:e=>parseInt(e,10),onChange(){Promise.resolve().then(()=>ri).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}},{id:"autoDarkNightEndHour",label:"Night Ends",stateKey:"autoDarkNightEndHour",type:"range",min:0,max:23,step:1,default:6,format:e=>Math.round(e)+":00",parse:e=>parseInt(e,10),onChange(){Promise.resolve().then(()=>ri).then(({getCurrentTheme:e,setTheme:t})=>{"auto"===e()&&t("auto")}).catch(()=>{})}}]},physics:{title:"Material World",icon:"⚖️",defaultOpen:!1,controls:[{id:"ballMassKg",label:"Ball Mass",stateKey:"ballMassKg",type:"range",min:20,max:400,step:1,default:91,format:e=>Math.round(e)+" kg",parse:e=>parseInt(e,10),hint:"Heavier = snooker feel (more inertia, less jitter).",onChange(e,t){const a=+t;if(Number.isFinite(a)&&Array.isArray(e.balls))for(let o=0;e.balls.length>o;o++){const t=e.balls[o];t&&(t.m=a)}}},{id:"REST",label:"Restitution",stateKey:"REST",type:"range",min:0,max:.95,step:.01,default:.42,format:e=>e.toFixed(2),parse:parseFloat,hint:"Global bounciness for collisions (modes may override)."},{id:"FRICTION",label:"Friction",stateKey:"FRICTION",type:"range",min:0,max:.06,step:.001,default:.018,format:e=>e.toFixed(3),parse:parseFloat,hint:"Global drag/energy loss (modes may override)."},{id:"physicsCollisionIterations",label:"Collision Iterations",stateKey:"physicsCollisionIterations",type:"range",min:3,max:20,step:1,default:10,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Performance",groupCollapsed:!0,hint:"How many times per frame we resolve collisions. Lower = faster, higher = tighter stacks."},{id:"physicsSkipSleepingCollisions",label:"Skip Sleeping Pairs",stateKey:"physicsSkipSleepingCollisions",type:"toggle",default:!0,group:"Performance",hint:"When enabled, collisions between two sleeping balls are skipped until something wakes them. Big CPU win with piles."},{id:"physicsSpatialGridOptimization",label:"Grid Reuse",stateKey:"physicsSpatialGridOptimization",type:"toggle",default:!0,group:"Performance",hint:"Reuses the spatial grid data structures to reduce allocations/GC. Keep on unless debugging."},{id:"physicsSleepThreshold",label:"Sleep Threshold",stateKey:"physicsSleepThreshold",type:"range",min:0,max:30,step:1,default:12,format:e=>Math.round(e)+" px/s",parse:e=>parseInt(e,10),group:"Performance",hint:"Velocity below which a ball is considered “at rest” (non‑Pit modes). 0 disables sleeping."},{id:"physicsSleepTime",label:"Sleep Time",stateKey:"physicsSleepTime",type:"range",min:0,max:1,step:.05,default:.25,format:e=>e.toFixed(2)+"s",parse:parseFloat,group:"Performance",hint:"How long a ball must stay under the Sleep Threshold before it sleeps. Higher = more stability + more performance."},{id:"physicsSkipSleepingSteps",label:"Skip Sleeping Steps",stateKey:"physicsSkipSleepingSteps",type:"toggle",default:!0,group:"Performance",hint:"When enabled, sleeping balls don’t run physics integration each tick. Improves performance; tiny motions may be delayed until wake."}]},balls:{title:"Balls",icon:"🎱",defaultOpen:!1,controls:[{id:"sizeGlobal",label:"Size",stateKey:"sizeScale",type:"range",min:.1,max:6,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat,onChange(e){Promise.resolve().then(()=>mo).then(({updateBallSizes:t})=>{t();const a=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=a,e.rBase=a})}),Promise.resolve().then(()=>Wn).then(({updateCursorSize:e})=>{e()})}},{id:"responsiveScaleMobile",label:"Mobile Scale",stateKey:"responsiveScaleMobile",type:"range",min:.5,max:1.5,step:.05,default:.75,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Ball size multiplier for iPad/iPhone (requires reload)",onChange(e){Promise.resolve().then(()=>mo).then(({detectResponsiveScale:t})=>{t();const a=(e.R_MIN+e.R_MAX)/2;e.balls.forEach(e=>{e.r=a,e.rBase=a})})}},{id:"mobileObjectReductionFactor",label:"Mobile Density",stateKey:"mobileObjectReductionFactor",type:"range",min:0,max:1,step:.05,default:.7,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Scales object counts on mobile (0% = none). Resets the current mode.",onChange(e){Promise.resolve().then(()=>Cn).then(({setMode:t})=>{t(e.currentMode)}).catch(()=>{})}},{id:"ballSoftnessGlobal",label:"Softness",stateKey:"ballSoftness",type:"range",min:0,max:100,step:1,default:20,format:e=>e+"",parse:e=>parseInt(e,10)},{id:"ballSpacing",label:"Spacing",stateKey:"ballSpacing",type:"range",min:0,max:.5,step:.01,default:.08,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Collision gap as % of ball radius (affects physics)"},{id:"sizeVariationGlobalMul",label:"Variation Scale",stateKey:"sizeVariationGlobalMul",type:"range",min:0,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Global multiplier for per-mode size variation",onChange(){Promise.resolve().then(()=>mo).then(({updateBallSizes:e})=>{e()})}},{id:"sizeVariationCap",label:"Variation Cap",stateKey:"sizeVariationCap",type:"range",min:0,max:.2,step:.01,default:.2,format:e=>Math.round(100*e)+"%",parse:parseFloat,hint:"Max radius deviation from medium (20% = ±20%)",onChange(){Promise.resolve().then(()=>mo).then(({updateBallSizes:e})=>{e()})}}]},cursor:{title:"Hand",icon:"🖐️",defaultOpen:!1,controls:[{id:"cursorInfluenceRadiusVw",label:"Influence Radius",stateKey:"cursorInfluenceRadiusVw",type:"range",min:0,max:80,step:.5,default:14,format:e=>e.toFixed(1)+"vw",parse:parseFloat,hint:"Universal cursor interaction zone (scales with viewport width)."}]},trail:{title:"Mouse & Trail",icon:"🖐️",defaultOpen:!1,controls:[{id:"cursorSize",label:"Cursor Size",stateKey:"cursorSize",type:"range",min:.1,max:3,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,onChange(){Promise.resolve().then(()=>Wn).then(({updateCursorSize:e})=>{e()})}},{id:"mouseTrailEnabled",label:"Trail Enabled",stateKey:"mouseTrailEnabled",type:"checkbox",default:!0},{id:"mouseTrailLength",label:"Trail Length",stateKey:"mouseTrailLength",type:"range",min:4,max:96,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),hint:"Max samples kept (higher = smoother, slightly more work)"},{id:"mouseTrailSize",label:"Trail Size",stateKey:"mouseTrailSize",type:"range",min:.5,max:10,step:.1,default:1.3,format:e=>e.toFixed(1)+"px",parse:parseFloat},{id:"mouseTrailFadeMs",label:"Trail Fade",stateKey:"mouseTrailFadeMs",type:"range",min:40,max:1200,step:10,default:220,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10)},{id:"mouseTrailOpacity",label:"Trail Opacity",stateKey:"mouseTrailOpacity",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat}]},uiSpacing:{title:"UI Spacing",icon:"📏",defaultOpen:!1,controls:[{type:"divider",label:"Content"},{id:"contentPaddingRatio",label:"Padding Additive",stateKey:"contentPaddingRatio",type:"range",min:-.05,max:.1,step:.001,default:0,format:e=>(100*+e).toFixed(1)+"%",parse:parseFloat,hint:"Additive padding as a fraction of viewport size (sqrt(w*h)). Back-compat: old px values are auto-converted.",onChange(e,t){const a=void 0!==t?t:void 0!==e.contentPaddingRatio?e.contentPaddingRatio:0;Wt("default","contentPaddingRatio",a),Promise.resolve().then(()=>mo).then(({applyLayoutFromVwToPx:t,applyLayoutCSSVars:o})=>{t(),o();try{const t=document.getElementById("contentPaddingRatioVal");if(t){const o=+a||0,n=(()=>{try{const e=getComputedStyle(document.documentElement).getPropertyValue("--layout-viewport-size-px").trim(),t=parseFloat(e);return Number.isFinite(t)?t:0}catch(e){return 0}})(),i=Math.round(n*o),r=Math.round(e.contentPadding||0);t.textContent=`${0>o?"":"+"}${(100*o).toFixed(1)}% (${0>i?"":"+"}${i}px) → ${r}px`}}catch(n){}try{document.dispatchEvent(new CustomEvent("layout-updated"))}catch(n){}}).catch(()=>{}),Promise.resolve().then(()=>xn).then(({resize:e})=>{try{e()}catch(t){}}).catch(()=>{})}},{id:"contentPaddingHorizontalRatio",label:"Horizontal Ratio",stateKey:"contentPaddingHorizontalRatio",type:"range",min:.5,max:2.5,step:.05,default:1,format:e=>(+e).toFixed(2)+"×",parse:parseFloat,hint:"Horizontal padding = base × ratio.",onChange(e){Promise.resolve().then(()=>mo).then(({applyLayoutFromVwToPx:t,applyLayoutCSSVars:a})=>{t(),a();try{const t=document.getElementById("contentPaddingHorizontalRatioVal");t&&(t.textContent=`${(+(e.contentPaddingHorizontalRatio||1)).toFixed(2)}× → ${Math.round(e.contentPaddingX||e.contentPadding)}px`)}catch(o){}}).catch(()=>{})}},{type:"divider",label:"Hit Areas"},{id:"uiHitAreaMul",label:"Hit Area Mul",stateKey:"uiHitAreaMul",type:"range",min:.5,max:2.5,step:.05,default:1,format:e=>(+e).toFixed(2)+"×",parse:parseFloat,hint:"Scales most UI button/link hit areas (drives --ui-hit-area-mul).",onChange(e,t){document.documentElement.style.setProperty("--ui-hit-area-mul",t+"")}},{type:"divider",label:"Icon Buttons"},{id:"uiIconFramePx",label:"Icon Frame Size",stateKey:"uiIconFramePx",type:"range",min:0,max:120,step:1,default:0,format:e=>+e>0?Math.round(e)+"px":"Auto",parse:e=>parseInt(e,10),hint:"Square icon button frame size (height/width). 0 = auto (derived from icon padding tokens).",onChange(e,t){const a=document.documentElement;+t>0?a.style.setProperty("--ui-icon-frame-size",Math.round(t)+"px"):a.style.removeProperty("--ui-icon-frame-size")}},{id:"uiIconGlyphPx",label:"Icon Glyph Size",stateKey:"uiIconGlyphPx",type:"range",min:0,max:64,step:1,default:0,format:e=>+e>0?Math.round(e)+"px":"Auto",parse:e=>parseInt(e,10),hint:"Icon glyph size inside the square frame. 0 = auto (uses token defaults).",onChange(e,t){const a=document.documentElement;+t>0?a.style.setProperty("--ui-icon-glyph-size",Math.round(t)+"px"):a.style.removeProperty("--ui-icon-glyph-size")}},{id:"uiIconGroupMarginPx",label:"Icon Group Margin",stateKey:"uiIconGroupMarginPx",type:"range",min:-60,max:60,step:1,default:0,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Margin applied to the social icon group. Use negative values to push icons outward.",onChange(e,t){const a=document.documentElement;0===+t?a.style.removeProperty("--ui-icon-group-margin"):a.style.setProperty("--ui-icon-group-margin",Math.round(t)+"px")}},{id:"uiIconCornerRadiusMul",label:"Corner Radius",stateKey:"uiIconCornerRadiusMul",type:"range",min:0,max:1,step:.01,default:.4,format:e=>Math.round(100*+e)+"% of wall",parse:parseFloat,hint:"Icon button corner radius as a fraction of wall radius (drives --ui-icon-corner-radius-mul).",onChange(e,t){document.documentElement.style.setProperty("--ui-icon-corner-radius-mul",t+"")}},{id:"uiIconFramePx",label:"Frame Size",stateKey:"uiIconFramePx",type:"range",min:0,max:140,step:1,default:0,format:e=>Math.round(+e)>0?Math.round(+e)+"px":"Auto",parse:e=>parseInt(e,10),hint:"Square icon button frame size (px). 0 = use token-derived default (--ui-icon-frame-size).",onChange(e,t){try{const e=document.documentElement,a=Math.round(+(t||0));a>0?e.style.setProperty("--ui-icon-frame-size",a+"px"):e.style.removeProperty("--ui-icon-frame-size")}catch(a){}}},{id:"uiIconGlyphPx",label:"Glyph Size",stateKey:"uiIconGlyphPx",type:"range",min:0,max:80,step:1,default:0,format:e=>Math.round(+e)>0?Math.round(+e)+"px":"Auto",parse:e=>parseInt(e,10),hint:"Icon glyph size (px). 0 = use token-derived default (--ui-icon-glyph-size).",onChange(e,t){try{const e=document.documentElement,a=Math.round(+(t||0));a>0?e.style.setProperty("--ui-icon-glyph-size",a+"px"):e.style.removeProperty("--ui-icon-glyph-size")}catch(a){}}},{type:"divider",label:"Links"},{id:"linkTextPadding",label:"Text Link Padding",stateKey:"linkTextPadding",type:"range",min:4,max:40,step:1,default:30,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Padding for text links (footer links, CV links).",onChange(e,t){document.documentElement.style.setProperty("--link-text-padding",t+"px"),document.documentElement.style.setProperty("--link-text-margin",-t+"px")}},{id:"linkIconPadding",label:"Icon Link Padding",stateKey:"linkIconPadding",type:"range",min:4,max:40,step:1,default:24,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Legacy: used to derive auto icon button sizing when Icon Frame Size is set to Auto.",onChange(e,t){document.documentElement.style.setProperty("--link-icon-padding",t+"px"),document.documentElement.style.setProperty("--link-icon-margin",-t+"px")}},{type:"divider",label:"Footer + Labels"},{id:"footerNavBarTopVh",label:"Nav Bar Position",stateKey:"footerNavBarTopVh",type:"range",min:0,max:100,step:.5,default:50,format:e=>(+e).toFixed(1)+"vh",parse:e=>parseFloat(e),hint:"Vertical position of footer nav bar from top of viewport.",onChange(e,t){const a=document.documentElement;a.style.setProperty("--footer-nav-bar-top",t+"vh"),a.style.setProperty("--footer-nav-bar-top-svh",t+"svh"),a.style.setProperty("--footer-nav-bar-top-dvh",t+"dvh")}},{id:"footerNavBarGapVw",label:"Nav Link Gap",stateKey:"footerNavBarGapVw",type:"range",min:0,max:10,step:.1,default:2.5,format:e=>(+e).toFixed(1)+"vw",parse:e=>parseFloat(e),hint:"Horizontal gap between nav bar links (vw → clamp).",onChange(e,t){const a=+t;if(!Number.isFinite(a))return;const o=Math.round(9.6*a);document.documentElement.style.setProperty("--footer-nav-bar-gap",`clamp(${o}px, ${a}vw, ${Math.round(1.67*o)}px)`)}},{id:"homeMainLinksBelowLogoPx",label:"Links Offset",stateKey:"homeMainLinksBelowLogoPx",type:"range",min:-120,max:240,step:1,default:40,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Index: move the main links up/down below the logo.",onChange(e,t){document.documentElement.style.setProperty("--home-main-links-below-logo-px",t+"")}},{id:"edgeLabelInsetAdjustPx",label:"Edge Label Inset",stateKey:"edgeLabelInsetAdjustPx",type:"range",min:-120,max:240,step:1,default:0,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Adjusts edge label inset relative to wall. Higher = inward; lower = outward.",onChange(){Promise.resolve().then(()=>mo).then(e=>{e.applyLayoutCSSVars()}).catch(()=>{})}}]},links:{title:"Links",icon:"🔗",defaultOpen:!1,controls:[{id:"linkColorInfluence",label:"Color Influence",stateKey:"linkColorInfluence",type:"range",min:0,max:1,step:.01,default:1,format:e=>e.toFixed(2),parse:parseFloat,hint:"How much cursor color affects link colors (0 = none, 1 = full)",onChange(e,t){document.documentElement.style.setProperty("--link-color-influence",t+"")}},{id:"linkImpactScale",label:"Impact Scale",stateKey:"linkImpactScale",type:"range",min:.7,max:1,step:.01,default:.95,format:e=>e.toFixed(2),parse:parseFloat,hint:"Scale when link is pressed (lower = more dramatic press)",onChange(e,t){document.documentElement.style.setProperty("--link-impact-scale",t+"")}},{id:"linkImpactBlur",label:"Impact Blur",stateKey:"linkImpactBlur",type:"range",min:0,max:20,step:.5,default:10,format:e=>e.toFixed(1)+"px",parse:parseFloat,hint:"Blur amount when link is pressed (creates depth effect)",onChange(e,t){document.documentElement.style.setProperty("--link-impact-blur",t+"px")}},{id:"linkImpactDuration",label:"Impact Duration",stateKey:"linkImpactDuration",type:"range",min:50,max:300,step:10,default:150,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration of press animation (fast and subtle)",onChange(e,t){document.documentElement.style.setProperty("--link-impact-duration",t+"ms")}}]},scene:{title:"Scene Impact",icon:"🎬",defaultOpen:!1,controls:[{id:"sceneImpactEnabled",label:"Enabled",stateKey:"sceneImpactEnabled",type:"checkbox",default:!0,hint:"If disabled, mode changes will not animate the scene."},{id:"sceneImpactMul",label:"Click Depth",stateKey:"sceneImpactMul",type:"range",min:0,max:.05,step:.001,default:.01,format:e=>e.toFixed(3),parse:parseFloat,hint:"How far the entire scene “presses in” on simulation change.",onChange(e,t){const a=document.getElementById("abs-scene");if(!a)return;const o=e||{},n=+o.sceneImpactMobileMulFactor;a.style.setProperty("--abs-scene-impact-mul",+t*((o.isMobile||o.isMobileViewport)&&Number.isFinite(n)&&n>0?n:1)+"")}},{id:"sceneImpactLogoCompMul",label:"Logo Comp",stateKey:"sceneImpactLogoCompMul",type:"range",min:.25,max:6,step:.05,default:3.6,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"How strongly the logo counter-scales against the scene press (higher = logo feels more “anchored”).",onChange(e,t){const a=document.getElementById("abs-scene");if(!a)return;const o=+t;a.style.setProperty("--abs-scene-impact-logo-comp-mul",(Number.isFinite(o)&&o>0?o:1)+"")}},{id:"sceneImpactMobileMulFactor",label:"Mobile Depth ×",stateKey:"sceneImpactMobileMulFactor",type:"range",min:.25,max:3,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Multiplier applied to Click Depth on mobile-sized viewports.",onChange(e,t){const a=document.getElementById("abs-scene");if(!a)return;const o=e||{},n=+o.sceneImpactMul,i=+t;a.style.setProperty("--abs-scene-impact-mul",(Number.isFinite(n)?n:0)*((o.isMobile||o.isMobileViewport)&&Number.isFinite(i)&&i>0?i:1)+"")}},{id:"sceneImpactPressMs",label:"Press",stateKey:"sceneImpactPressMs",type:"range",min:20,max:300,step:5,default:90,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Press-in duration."},{id:"sceneImpactReleaseMs",label:"Release",stateKey:"sceneImpactReleaseMs",type:"range",min:40,max:1200,step:10,default:310,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Release duration (“bounce out” length)."},{id:"sceneImpactAnticipation",label:"Anticipation",stateKey:"sceneImpactAnticipation",type:"range",min:0,max:.6,step:.01,default:0,format:e=>e.toFixed(2),parse:parseFloat,hint:"Micro pre-pop before the click-in (0 = off)."},{id:"sceneChangeSoundEnabled",label:"Scene Sound",stateKey:"sceneChangeSoundEnabled",type:"checkbox",default:!0,hint:"Plays a soft “pebble-like” tick when switching simulations (only if sound is enabled)."},{id:"sceneChangeSoundIntensity",label:"Scene Sound Intensity",stateKey:"sceneChangeSoundIntensity",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat},{id:"sceneChangeSoundRadius",label:"Scene Sound Pitch",stateKey:"sceneChangeSoundRadius",type:"range",min:6,max:60,step:1,default:18,format:e=>""+Math.round(e),parse:e=>parseInt(e,10),hint:"Higher = lower pitch (maps like “ball size”)."}]},overlay:{title:"Depth & Blur",icon:"🌫️",defaultOpen:!1,controls:[{id:"gateOverlayEnabled",label:"Enabled",stateKey:"gateOverlayEnabled",type:"checkbox",default:!0},{id:"gateOverlayOpacity",label:"White Wash",stateKey:"gateOverlayOpacity",type:"range",min:0,max:.1,step:.001,default:.01,format:e=>e.toFixed(3),parse:parseFloat,onChange(e,t){Promise.resolve().then(()=>$i).then(({updateOverlayOpacity:e})=>{e(t)})}},{id:"gateOverlayTransitionMs",label:"Anim In Speed",stateKey:"gateOverlayTransitionMs",type:"range",min:200,max:1500,step:50,default:800,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration for blur & depth zoom when opening",onChange(e,t){Promise.resolve().then(()=>$i).then(({updateOverlayTransition:e})=>{e(t)})}},{id:"gateOverlayTransitionOutMs",label:"Anim Out Speed",stateKey:"gateOverlayTransitionOutMs",type:"range",min:200,max:1200,step:50,default:600,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration for blur & depth zoom when closing",onChange(e,t){Promise.resolve().then(()=>$i).then(({updateOverlayTransitionOut:e})=>{e(t)})}},{id:"gateOverlayContentDelayMs",label:"Content Delay",stateKey:"gateOverlayContentDelayMs",type:"range",min:0,max:1e3,step:50,default:200,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Wait before showing dialog content",onChange(e,t){Promise.resolve().then(()=>$i).then(({updateGateContentDelay:e})=>{e(t)})}},{id:"gateDepthScale",label:"Depth Scale",stateKey:"gateDepthScale",type:"range",min:.9,max:1,step:.001,default:.96,format:e=>e.toFixed(3),parse:parseFloat,hint:"Scene scale when gate opens (0.9-1.0)",onChange(e,t){Promise.resolve().then(()=>$i).then(({updateGateDepthScale:e})=>{e(t)})}},{id:"gateDepthTranslateY",label:"Depth Shift",stateKey:"gateDepthTranslateY",type:"range",min:0,max:30,step:1,default:8,format:e=>Math.round(e)+"px",parse:parseInt,hint:"Vertical shift when gate opens",onChange(e,t){Promise.resolve().then(()=>$i).then(({updateGateDepthTranslateY:e})=>{e(t)})}},{id:"logoOpacityInactive",label:"Logo Opacity Closed",stateKey:"logoOpacityInactive",type:"range",min:0,max:1,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat,hint:"Logo opacity when gate is closed (1 = fully visible)",onChange(e,t){Promise.resolve().then(()=>$i).then(({updateLogoOpacityInactive:e})=>{e(t)})}},{id:"logoOpacityActive",label:"Logo Opacity Open",stateKey:"logoOpacityActive",type:"range",min:0,max:1,step:.05,default:.2,format:e=>e.toFixed(2),parse:parseFloat,hint:"Logo opacity when gate is active (0.2 = more faded)",onChange(e,t){Promise.resolve().then(()=>$i).then(({updateLogoOpacityActive:e})=>{e(t)})}},{id:"logoBlurInactive",label:"Logo Blur Closed",stateKey:"logoBlurInactive",type:"range",min:0,max:20,step:.5,default:0,format:e=>e.toFixed(1)+"px",parse:parseFloat,hint:"Logo blur when gate is closed (0 = sharp)",onChange(e,t){Promise.resolve().then(()=>$i).then(({updateLogoBlurInactive:e})=>{e(t)})}},{id:"logoBlurActive",label:"Logo Blur Open",stateKey:"logoBlurActive",type:"range",min:0,max:30,step:.5,default:12,format:e=>e.toFixed(1)+"px",parse:parseFloat,hint:"Logo blur when gate is active (12px = soft blur)",onChange(e,t){Promise.resolve().then(()=>$i).then(({updateLogoBlurActive:e})=>{e(t)})}}]},colors:{title:"Color & Surface",icon:"🎨",defaultOpen:!1,controls:[{type:"divider",label:"Backgrounds"},{id:"bgLight",label:"Light Mode",stateKey:"bgLight",type:"color",default:"#f5f5f5",hint:"Background color for light mode",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--bg-light",t),!e.isDarkMode){a.style.setProperty("--chrome-bg",t);const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t)}}},{id:"bgDark",label:"Dark Mode",stateKey:"bgDark",type:"color",default:"#0a0a0a",hint:"Background color for dark mode",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--bg-dark",t),e.isDarkMode){a.style.setProperty("--chrome-bg",t);const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t)}}},{type:"divider",label:"Text · Light Mode"},{id:"textColorLight",label:"Primary",stateKey:"textColorLight",type:"color",default:"#161616",hint:"Main text color in light mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-light",t)}},{id:"textColorLightMuted",label:"Muted",stateKey:"textColorLightMuted",type:"color",default:"#2f2f2f",hint:"Secondary/muted text in light mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-light-muted",t)}},{type:"divider",label:"Text · Dark Mode"},{id:"textColorDark",label:"Primary",stateKey:"textColorDark",type:"color",default:"#b3b3b3",hint:"Main text color in dark mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-dark",t)}},{id:"textColorDarkMuted",label:"Muted",stateKey:"textColorDarkMuted",type:"color",default:"#808080",hint:"Secondary/muted text in dark mode",onChange(e,t){document.documentElement.style.setProperty("--text-color-dark-muted",t)}},{type:"divider",label:"Edge Labels"},{id:"edgeLabelColorLight",label:"Light Mode",stateKey:"edgeLabelColorLight",type:"color",default:"#2f2f2f",hint:"Color for the vertical edge labels in light mode",onChange(e,t){document.documentElement.style.setProperty("--edge-label-color-light",t)}},{id:"edgeLabelColorDark",label:"Dark Mode",stateKey:"edgeLabelColorDark",type:"color",default:"#b3b3b3",hint:"Color for the vertical edge labels in dark mode",onChange(e,t){document.documentElement.style.setProperty("--edge-label-color-dark",t)}},{type:"divider",label:"Links"},{id:"linkHoverColor",label:"Hover Accent",stateKey:"linkHoverColor",type:"color",default:"#ff4013",hint:"Link hover color (accent)",onChange(e,t){document.documentElement.style.setProperty("--link-hover-color",t)}},{type:"divider",label:"Logo"},{id:"logoColorLight",label:"Light Mode",stateKey:"logoColorLight",type:"color",default:"#161616",hint:"Logo color in light mode",onChange(e,t){document.documentElement.style.setProperty("--logo-color-light",t)}},{id:"logoColorDark",label:"Dark Mode",stateKey:"logoColorDark",type:"color",default:"#d5d5d5",hint:"Logo color in dark mode",onChange(e,t){document.documentElement.style.setProperty("--logo-color-dark",t)}},{id:"topLogoWidthVw",label:"Logo Size",stateKey:"topLogoWidthVw",type:"range",min:15,max:45,step:.25,default:35,format:e=>parseFloat(e).toFixed(2)+"vw",parse:parseFloat,hint:"Top-center logo width (clamped by min/max tokens).",onChange(e,t){document.documentElement.style.setProperty("--top-logo-width-vw",t+"")}},{type:"divider",label:"Portfolio Logo"},{id:"portfolioLogoColorLight",label:"Light Mode",stateKey:"portfolioLogoColorLight",type:"color",default:"#161616",hint:"Portfolio logo color in light mode (separate from index)",onChange(e,t){document.documentElement.style.setProperty("--portfolio-logo-color-light",t)}},{id:"portfolioLogoColorDark",label:"Dark Mode",stateKey:"portfolioLogoColorDark",type:"color",default:"#d5d5d5",hint:"Portfolio logo color in dark mode (separate from index)",onChange(e,t){document.documentElement.style.setProperty("--portfolio-logo-color-dark",t)}}]},colorDistribution:{title:"Palette Mix",icon:"🧩",defaultOpen:!1,controls:[{id:"colorDistribution",label:"Disciplines",stateKey:"colorDistribution",type:"colorDistribution",labels:["AI Integration","UI/UX Design","Creative Strategy","Frontend Development","Brand Identity","3D Design","Art Direction"],hint:"Assign each discipline to a palette color, then set weights that sum to 100%. Used for all ball spawns across modes."}]},wall:{title:"WALL",icon:"🫧",defaultOpen:!1,controls:[{id:"frameColorLight",label:"Color · Light Mode",stateKey:"frameColorLight",type:"color",default:"#0a0a0a",hint:"Wall color in light mode (also used for browser chrome)",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--frame-color-light",t),!e.isDarkMode){const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t),a.style.setProperty("--chrome-bg",t)}Promise.resolve().then(()=>Zn).then(e=>{e.syncChromeColor()})}},{id:"frameColorDark",label:"Color · Dark Mode",stateKey:"frameColorDark",type:"color",default:"#0a0a0a",hint:"Wall color in dark mode (also used for browser chrome)",onChange(e,t){const a=document.documentElement;if(a.style.setProperty("--frame-color-dark",t),e.isDarkMode){const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=t),a.style.setProperty("--chrome-bg",t)}Promise.resolve().then(()=>Zn).then(e=>{e.syncChromeColor()})}},{id:"wallPreset",label:"Wall Preset",stateKey:"wallPreset",type:"select",options:Object.entries(co).map(([e,t])=>({value:e,label:t?.label?t.label:e})),default:"pudding",format:e=>e+"",onChange(e,t){((e,t)=>{co[e]&&(t.wallPreset=e)})(t+"",e),jt({runOnChange:!1});try{ln?.reset?.()}catch(a){}try{const t=Array.isArray(e?.balls)?e.balls:[];for(let e=0;t.length>e;e++)t[e]?.wake?.()}catch(a){}try{const e=document.getElementById("wallPresetSlider");e&&"function"==typeof e.blur?e.blur():document.activeElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()}catch(a){}},hint:"Curated wall “types” that set multiple wall sliders at once."},{id:"wallThicknessVw",label:"Wall Thickness",stateKey:"wallThicknessVw",type:"range",min:0,max:8,step:.1,default:1.3,format:e=>e.toFixed(1)+"vw",parse:parseFloat,hint:"Wall tube thickness (content padding is layout-only)",onChange(){Promise.resolve().then(()=>mo).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars(),Promise.resolve().then(()=>$i).then(({updateBlurFromWallThickness:e})=>{e()})})}},{id:"wallThicknessAreaMultiplier",label:"Area Scaling",stateKey:"wallThicknessAreaMultiplier",type:"range",min:0,max:2,step:.01,default:0,format:e=>e.toFixed(2)+"×",parse:parseFloat,hint:"Area-based scaling multiplier (0.0 = vw-only, 1.0 = full area scaling, >1.0 = exaggerated)",onChange(){Promise.resolve().then(()=>mo).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars(),Promise.resolve().then(()=>$i).then(({updateBlurFromWallThickness:e})=>{e()})})}},{id:"wallRadiusVw",label:"Corner Radius",stateKey:"wallRadiusVw",type:"range",min:0,max:12,step:.1,default:3.7,format:e=>e.toFixed(1)+"vw",parse:parseFloat,onChange(){Promise.resolve().then(()=>mo).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars()})}},{id:"wallInset",label:"Collision Inset",stateKey:"wallInset",type:"range",min:0,max:20,step:1,default:2,format:e=>e+"px",parse:e=>parseInt(e,10),hint:"Physics padding inside the visual wall"},{id:"mobileWallThicknessXFactor",label:"Mobile L/R Thickness",stateKey:"mobileWallThicknessXFactor",type:"range",min:.5,max:3,step:.05,default:1.4,format:e=>e.toFixed(2)+"×",parse:parseFloat,hint:"Wall thickness multiplier for LEFT/RIGHT sides on mobile",onChange(){Promise.resolve().then(()=>mo).then(e=>{e.applyLayoutFromVwToPx(),e.applyLayoutCSSVars()})}},{id:"mobileEdgeLabelsVisible",label:"Mobile Edge Labels",stateKey:"mobileEdgeLabelsVisible",type:"toggle",default:!0,hint:"Show side edge labels on mobile (chapter/copyright)",onChange(){Promise.resolve().then(()=>mo).then(e=>{e.applyLayoutCSSVars()})}},{id:"mobileEdgeLabelSizeFactor",label:"Mobile Label Size",stateKey:"mobileEdgeLabelSizeFactor",type:"range",min:.3,max:2,step:.05,default:.85,format:e=>e.toFixed(2)+"×",parse:parseFloat,hint:"Font size multiplier for edge labels on mobile",onChange(){Promise.resolve().then(()=>mo).then(e=>{e.applyLayoutCSSVars()})}},{id:"mobileEdgeLabelOpacity",label:"Mobile Label Opacity",stateKey:"mobileEdgeLabelOpacity",type:"range",min:0,max:1,step:.05,default:.5,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,hint:"Opacity for edge labels on mobile",onChange(){Promise.resolve().then(()=>mo).then(e=>{e.applyLayoutCSSVars()})}},{id:"wallWobbleMaxDeform",label:"Deformation",stateKey:"wallWobbleMaxDeform",type:"range",min:10,max:150,step:5,default:60,format:e=>e+"px",parse:e=>parseInt(e,10),group:"Wall Material",groupLayout:"grid-2col",hint:"Max flex distance. Low = rigid, High = soft"},{id:"wallWobbleStiffness",label:"Stiffness",stateKey:"wallWobbleStiffness",type:"range",min:50,max:3e3,step:10,default:120,format:e=>e+"",parse:e=>parseInt(e,10),group:"Wall Material",hint:"Spring strength. Low = soft, High = firm"},{id:"restitution",label:"Bounce",stateKey:"restitution",type:"range",min:.3,max:.95,step:.05,default:.7,format:e=>Math.round(100*e)+"%",parse:parseFloat,group:"Wall Material",hint:"Energy kept on bounce. 100% = elastic, 30% = soft"},{id:"wallWobbleDamping",label:"Damping",stateKey:"wallWobbleDamping",type:"range",min:0,max:80,step:1,default:35,format:e=>e+"",parse:e=>parseInt(e,10),group:"Wall Material",hint:"Oscillation decay. High = viscous/slow"},{id:"wallWobbleSigma",label:"Impact Spread",stateKey:"wallWobbleSigma",type:"range",min:.5,max:6,step:.1,default:2,format:e=>e.toFixed(1),parse:parseFloat,group:"Wall Material",hint:"Blob size. High = pudding, Low = rubber"},{id:"wallWobbleSettlingSpeed",label:"Settle Speed",stateKey:"wallWobbleSettlingSpeed",type:"range",min:0,max:100,step:1,default:75,format:e=>e+"%",parse:e=>parseInt(e,10),group:"Wall Material",hint:"Snap-to-flat aggression when still"},{id:"wallWobbleCornerClamp",label:"Corner Stiffness",stateKey:"wallWobbleCornerClamp",type:"range",min:0,max:1,step:.01,default:.6,format:e=>e.toFixed(2),parse:parseFloat,group:"Wall Behavior",groupLayout:"grid-2col",groupCollapsed:!0,hint:"1.0 = locked corners, 0 = flexible corners"},{id:"wallWobbleImpactThreshold",label:"Impact Gate",stateKey:"wallWobbleImpactThreshold",type:"range",min:20,max:200,step:1,default:140,format:e=>e+" px/s",parse:e=>parseInt(e,10),group:"Wall Behavior",hint:"Min impact speed to trigger deformation"},{id:"wallWobbleMaxVel",label:"Max Wall Speed",stateKey:"wallWobbleMaxVel",type:"range",min:100,max:2e3,step:10,default:800,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Performance Caps",groupLayout:"grid-2col",groupCollapsed:!0,hint:"Velocity cap to prevent erratic spikes"},{id:"wallWobbleMaxImpulse",label:"Max Impulse",stateKey:"wallWobbleMaxImpulse",type:"range",min:20,max:600,step:5,default:220,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Performance Caps",hint:"Per-sample impact cap for smoother behavior"},{id:"wallWobbleMaxEnergyPerStep",label:"Max Energy/Tick",stateKey:"wallWobbleMaxEnergyPerStep",type:"range",min:1e3,max:8e4,step:500,default:2e4,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Performance Caps",hint:"Safety budget to prevent runaway spikes"},{id:"wallPhysicsSamples",label:"Physics Samples",stateKey:"wallPhysicsSamples",type:"range",min:8,max:96,step:1,default:48,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Performance",groupCollapsed:!0,hint:"Visual-only. Lower = faster, higher = smoother blobs."},{id:"wallPhysicsSkipInactive",label:"Skip When Still",stateKey:"wallPhysicsSkipInactive",type:"toggle",default:!0,group:"Performance",hint:"Stops integrating the wall when it's already at rest."},{id:"wallRenderDecimation",label:"Render Detail",stateKey:"wallRenderDecimation",type:"range",min:1,max:12,step:1,default:2,format:e=>""+Math.round(e),parse:e=>parseInt(e,10),group:"Performance",hint:"1=ultra smooth, 2=default, 4=faster, 12=very fast/polygonal (rendering only)."}]},noise:{title:"Grain",icon:"🧂",defaultOpen:!1,controls:[{id:"noiseEnabled",label:"Enabled",stateKey:"noiseEnabled",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,group:"Render",hint:"Procedural noise texture (no GIF).",onChange:(e,t)=>At({noiseEnabled:t})},{id:"noiseSeed",label:"Seed",stateKey:"noiseSeed",type:"range",min:0,max:999999,step:1,default:1337,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),group:"Texture",hint:"Changes the generated grain pattern.",onChange:(e,t)=>At({noiseSeed:t})},{id:"noiseTextureSize",label:"Tile Size",stateKey:"noiseTextureSize",type:"range",min:64,max:512,step:32,default:256,format:e=>Math.round(e)+" px",parse:e=>parseInt(e,10),group:"Texture",hint:"Bigger tiles reduce repetition but cost more memory.",onChange:(e,t)=>At({noiseTextureSize:t})},{id:"noiseDistribution",label:"Distribution",stateKey:"noiseDistribution",type:"select",options:[{value:"gaussian",label:"Gaussian (filmic)"},{value:"uniform",label:"Uniform (flat)"}],default:"gaussian",format:e=>e+"",parse:e=>e+"",group:"Texture",onChange:(e,t)=>At({noiseDistribution:t})},{id:"noiseMonochrome",label:"Monochrome",stateKey:"noiseMonochrome",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,group:"Texture",hint:"Off = subtle RGB grain.",onChange:(e,t)=>At({noiseMonochrome:t})},{id:"noiseChroma",label:"Chroma",stateKey:"noiseChroma",type:"range",min:0,max:1,step:.01,default:.35,format:e=>Math.round(100*e)+"%",parse:parseFloat,group:"Texture",hint:"How different R/G/B channels are (ignored when Monochrome is on).",onChange:(e,t)=>At({noiseChroma:t})},{id:"noiseSizeBase",label:"Back Scale",stateKey:"noiseSizeBase",type:"range",min:20,max:400,step:5,default:100,format:e=>Math.round(e)+" px",parse:e=>parseInt(e,10),group:"Layers",onChange:(e,t)=>At({noiseSizeBase:t})},{id:"noiseSizeTop",label:"Front Scale",stateKey:"noiseSizeTop",type:"range",min:20,max:600,step:5,default:150,format:e=>Math.round(e)+" px",parse:e=>parseInt(e,10),group:"Layers",onChange:(e,t)=>At({noiseSizeTop:t})},{id:"noiseTopOpacity",label:"Top Opacity",stateKey:"noiseTopOpacity",type:"range",min:0,max:.25,step:.005,default:.01,format:e=>e.toFixed(3),parse:parseFloat,group:"Layers",hint:"Extra subtle layer (used by .noise-3).",onChange:(e,t)=>At({noiseTopOpacity:t})},{id:"noiseBackOpacity",label:"Back Opacity (Light)",stateKey:"noiseBackOpacity",type:"range",min:0,max:.3,step:.005,default:.025,format:e=>e.toFixed(3),parse:parseFloat,group:"Layers",onChange:(e,t)=>At({noiseBackOpacity:t})},{id:"noiseFrontOpacity",label:"Front Opacity (Light)",stateKey:"noiseFrontOpacity",type:"range",min:0,max:.3,step:.005,default:.055,format:e=>e.toFixed(3),parse:parseFloat,group:"Layers",onChange:(e,t)=>At({noiseFrontOpacity:t})},{id:"noiseBackOpacityDark",label:"Back Opacity (Dark)",stateKey:"noiseBackOpacityDark",type:"range",min:0,max:.5,step:.005,default:.12,format:e=>e.toFixed(3),parse:parseFloat,group:"Layers",onChange:(e,t)=>At({noiseBackOpacityDark:t})},{id:"noiseFrontOpacityDark",label:"Front Opacity (Dark)",stateKey:"noiseFrontOpacityDark",type:"range",min:0,max:.5,step:.005,default:.08,format:e=>e.toFixed(3),parse:parseFloat,group:"Layers",onChange:(e,t)=>At({noiseFrontOpacityDark:t})},{id:"noiseMotion",label:"Motion",stateKey:"noiseMotion",type:"select",options:[{value:"jitter",label:"Jitter (film grain)"},{value:"drift",label:"Drift (slow pan)"},{value:"static",label:"Static"}],default:"jitter",format:e=>e+"",parse:e=>e+"",group:"Motion",onChange:(e,t)=>At({noiseMotion:t})},{id:"noiseMotionAmount",label:"Motion Amount",stateKey:"noiseMotionAmount",type:"range",min:0,max:2.5,step:.01,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,group:"Motion",onChange:(e,t)=>At({noiseMotionAmount:t})},{id:"noiseSpeedBackMs",label:"Back Speed",stateKey:"noiseSpeedBackMs",type:"range",min:0,max:1e4,step:50,default:1800,format:e=>Math.round(e)+" ms",parse:e=>parseInt(e,10),group:"Motion",onChange:(e,t)=>At({noiseSpeedBackMs:t})},{id:"noiseSpeedFrontMs",label:"Front Speed",stateKey:"noiseSpeedFrontMs",type:"range",min:0,max:1e4,step:50,default:1100,format:e=>Math.round(e)+" ms",parse:e=>parseInt(e,10),group:"Motion",onChange:(e,t)=>At({noiseSpeedFrontMs:t})},{id:"noiseFlicker",label:"Flicker",stateKey:"noiseFlicker",type:"range",min:0,max:1,step:.01,default:.12,format:e=>Math.round(100*e)+"%",parse:parseFloat,group:"Motion",onChange:(e,t)=>At({noiseFlicker:t})},{id:"noiseFlickerSpeedMs",label:"Flicker Speed",stateKey:"noiseFlickerSpeedMs",type:"range",min:0,max:5e3,step:20,default:220,format:e=>Math.round(e)+" ms",parse:e=>parseInt(e,10),group:"Motion",onChange:(e,t)=>At({noiseFlickerSpeedMs:t})},{id:"noiseBlurPx",label:"Blur",stateKey:"noiseBlurPx",type:"range",min:0,max:6,step:.05,default:0,format:e=>e.toFixed(2)+" px",parse:parseFloat,group:"Look",onChange:(e,t)=>At({noiseBlurPx:t})},{id:"noiseContrast",label:"Contrast",stateKey:"noiseContrast",type:"range",min:.25,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"x",parse:parseFloat,group:"Look",onChange:(e,t)=>At({noiseContrast:t})},{id:"noiseBrightness",label:"Brightness",stateKey:"noiseBrightness",type:"range",min:.25,max:2,step:.01,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,group:"Look",onChange:(e,t)=>At({noiseBrightness:t})},{id:"noiseSaturation",label:"Saturation",stateKey:"noiseSaturation",type:"range",min:0,max:3,step:.01,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,group:"Look",onChange:(e,t)=>At({noiseSaturation:t})},{id:"noiseHue",label:"Hue Rotate",stateKey:"noiseHue",type:"range",min:0,max:360,step:1,default:0,format:e=>Math.round(e)+"°",parse:e=>parseInt(e,10),group:"Look",onChange:(e,t)=>At({noiseHue:t})}]},critters:{title:"Critters",icon:"🪲",mode:"critters",defaultOpen:!1,controls:[{id:"critterCount",label:"Count",stateKey:"critterCount",type:"range",min:10,max:260,step:5,default:90,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"critterSpeed",label:"Speed",stateKey:"critterSpeed",type:"range",min:0,max:1800,step:10,default:680,format:e=>""+Math.round(e),parse:parseFloat},{id:"critterMaxSpeed",label:"Max Speed",stateKey:"critterMaxSpeed",type:"range",min:200,max:4e3,step:25,default:1400,format:e=>""+Math.round(e),parse:parseFloat},{id:"critterStepHz",label:"Step Rate",stateKey:"critterStepHz",type:"range",min:0,max:16,step:.1,default:5,format:e=>e.toFixed(1)+" Hz",parse:parseFloat},{id:"critterStepSharpness",label:"Step Sharpness",stateKey:"critterStepSharpness",type:"range",min:.5,max:6,step:.1,default:2.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnNoise",label:"Wander",stateKey:"critterTurnNoise",type:"range",min:0,max:8,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnDamp",label:"Turn Inertia",stateKey:"critterTurnDamp",type:"range",min:.5,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterTurnSeek",label:"Steering",stateKey:"critterTurnSeek",type:"range",min:0,max:30,step:.5,default:10,format:e=>e.toFixed(1),parse:parseFloat},{id:"critterAvoidRadius",label:"Avoid Radius",stateKey:"critterAvoidRadius",type:"range",min:0,max:260,step:5,default:90,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"critterAvoidForce",label:"Avoid Force",stateKey:"critterAvoidForce",type:"range",min:0,max:25e3,step:250,default:9500,format:e=>Math.round(e)+"",parse:parseFloat},{id:"critterEdgeAvoid",label:"Edge Avoid",stateKey:"critterEdgeAvoid",type:"range",min:0,max:3,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat},{id:"critterMousePull",label:"Mouse Fear",stateKey:"critterMousePull",type:"range",min:0,max:4,step:.05,default:1,format:e=>e.toFixed(2)+"x",parse:parseFloat,hint:"Flee strength inside the mouse zone"},{id:"critterMouseRadiusVw",label:"Mouse Zone",stateKey:"critterMouseRadiusVw",type:"range",min:0,max:80,step:1,default:30,format:e=>Math.round(e)+"vw",parse:parseFloat},{id:"critterRestitution",label:"Bounciness",stateKey:"critterRestitution",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat,hint:"Mode-only override",onChange(e,t){"critters"===e.currentMode&&(e.REST=t)}},{id:"critterFriction",label:"Friction",stateKey:"critterFriction",type:"range",min:0,max:.06,step:.001,default:.018,format:e=>e.toFixed(3),parse:parseFloat,hint:"Mode-only override",onChange(e,t){"critters"===e.currentMode&&(e.FRICTION=t)}},Et("crittersWarmupFrames")]},pit:{title:"Ball Pit",icon:"🎯",mode:"pit",defaultOpen:!1,controls:[{id:"gravityPit",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange(e,t){"pit"===e.currentMode&&(e.G=e.GE*t)}},{id:"repelPower",label:"Repel Power",stateKey:"repelPower",type:"range",min:0,max:1e4,step:100,default:8500,format:e=>""+Math.round(e),parse:parseFloat,onChange(e,t){e.repelPower=24e3*Math.pow(2,12*(Math.max(0,Math.min(1e4,t))/1e4-.5))}},{id:"sleepVelocityThreshold",label:"Sleep Speed",stateKey:"sleepVelocityThreshold",type:"range",min:0,max:40,step:.5,default:12,format:e=>(+e).toFixed(1)+" px/s",parse:parseFloat,hint:"Pit modes only. Higher = settles sooner."},{id:"sleepAngularThreshold",label:"Sleep Spin",stateKey:"sleepAngularThreshold",type:"range",min:0,max:1,step:.01,default:.18,format:e=>(+e).toFixed(2)+" rad/s",parse:parseFloat,hint:"Pit modes only. Higher = stops spinning sooner."},{id:"timeToSleep",label:"Sleep Time",stateKey:"timeToSleep",type:"range",min:.05,max:2,step:.05,default:.25,format:e=>(+e).toFixed(2)+"s",parse:parseFloat,hint:"Pit modes only. Lower = sleeps faster."},Et("pitWarmupFrames")]},pitThrows:{title:"Ball Pit (Throws)",icon:"🎯",mode:"pit-throws",defaultOpen:!1,controls:[{id:"gravityPitThrows",label:"Gravity",stateKey:"gravityMultiplierPit",type:"range",min:0,max:2,step:.05,default:1.1,format:e=>e.toFixed(2),parse:parseFloat,onChange(e,t){"pit-throws"===e.currentMode&&(e.G=e.GE*t)}},{id:"pitThrowsSpeed",label:"Throw Speed",stateKey:"pitThrowSpeed",type:"range",min:100,max:2e3,step:25,default:650,format:e=>Math.round(e)+"",parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpeedVar",label:"Speed Variance",stateKey:"pitThrowSpeedVar",type:"range",min:0,max:.6,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},{id:"sleepVelocityThresholdThrows",label:"Sleep Speed",stateKey:"sleepVelocityThreshold",type:"range",min:0,max:40,step:.5,default:12,format:e=>(+e).toFixed(1)+" px/s",parse:parseFloat,hint:"Pit modes only. Higher = settles sooner."},{id:"sleepAngularThresholdThrows",label:"Sleep Spin",stateKey:"sleepAngularThreshold",type:"range",min:0,max:1,step:.01,default:.18,format:e=>(+e).toFixed(2)+" rad/s",parse:parseFloat,hint:"Pit modes only. Higher = stops spinning sooner."},{id:"timeToSleepThrows",label:"Sleep Time",stateKey:"timeToSleep",type:"range",min:.05,max:2,step:.05,default:.25,format:e=>(+e).toFixed(2)+"s",parse:parseFloat,hint:"Pit modes only. Lower = sleeps faster."},{id:"pitThrowsInterval",label:"Throw Interval",stateKey:"pitThrowIntervalMs",type:"range",min:10,max:500,step:5,default:70,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsColorPause",label:"Color Pause",stateKey:"pitThrowColorPauseMs",type:"range",min:0,max:1200,step:10,default:180,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsPairChance",label:"Pair Chance",stateKey:"pitThrowPairChance",type:"range",min:0,max:1,step:.01,default:.35,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsPairStagger",label:"Pair Stagger",stateKey:"pitThrowPairStaggerMs",type:"range",min:0,max:120,step:1,default:18,format:e=>Math.round(e)+"ms",parse:parseFloat},{id:"pitThrowsBatchSize",label:"Batch Size",stateKey:"pitThrowBatchSize",type:"range",min:1,max:60,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"pitThrowsTargetYFrac",label:"Throw Aim (Y)",stateKey:"pitThrowTargetYFrac",type:"range",min:.12,max:.7,step:.01,default:.36,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAngleJitter",label:"Angle Jitter",stateKey:"pitThrowAngleJitter",type:"range",min:0,max:.6,step:.01,default:.16,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpreadVar",label:"Spread Variance",stateKey:"pitThrowSpreadVar",type:"range",min:0,max:.8,step:.01,default:.25,format:e=>e.toFixed(2),parse:parseFloat},{id:"pitThrowsSpeedJitter",label:"Speed Jitter",stateKey:"pitThrowSpeedJitter",type:"range",min:0,max:.8,step:.01,default:.22,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"pitThrowsInletInset",label:"Inlet Inset",stateKey:"pitThrowInletInset",type:"range",min:0,max:.2,step:.005,default:.06,format:e=>e.toFixed(3),parse:parseFloat,reinitMode:!0},{id:"pitThrowsSpawnSpread",label:"Spawn Spread",stateKey:"pitThrowSpawnSpread",type:"range",min:0,max:.12,step:.0025,default:.02,format:e=>e.toFixed(4),parse:parseFloat,reinitMode:!0},{id:"pitThrowsAimJitter",label:"Aim Jitter",stateKey:"pitThrowAimJitter",type:"range",min:0,max:.2,step:.005,default:.04,format:e=>e.toFixed(3),parse:parseFloat},{id:"pitThrowsCrossBias",label:"Cross Aim",stateKey:"pitThrowCrossBias",type:"range",min:0,max:.3,step:.005,default:.12,format:e=>e.toFixed(3),parse:parseFloat},Et("pitThrowsWarmupFrames")]},flies:{title:"Flies",icon:"🕊️",mode:"flies",defaultOpen:!1,controls:[{id:"fliesBallCount",label:"Ball Count",stateKey:"fliesBallCount",type:"range",min:20,max:150,step:5,default:60,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"attractPower",label:"Attraction",stateKey:"attractionPower",type:"range",min:100,max:8e3,step:50,default:5e3,format:e=>""+Math.round(e),parse:parseFloat},{id:"swarmSpeed",label:"Swarm Speed",stateKey:"swarmSpeed",type:"range",min:.2,max:5,step:.1,default:.4,format:e=>e.toFixed(1),parse:parseFloat},{id:"fliesSeparation",label:"Separation",stateKey:"fliesSeparation",type:"range",min:5e3,max:3e4,step:1e3,default:15e3,format:e=>""+Math.round(e),parse:parseFloat},Et("fliesWarmupFrames")]},weightless:{title:"Zero-G",icon:"🌌",mode:"weightless",defaultOpen:!1,controls:[{id:"weightlessCount",label:"Ball Count",stateKey:"weightlessCount",type:"range",min:20,max:200,step:10,default:80,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"weightlessSpeed",label:"Initial Speed",stateKey:"weightlessInitialSpeed",type:"range",min:100,max:600,step:25,default:250,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"weightlessBounce",label:"Bounce",stateKey:"weightlessBounce",type:"range",min:.5,max:1,step:.05,default:.95,format:e=>e.toFixed(2),parse:parseFloat},{id:"weightlessRepelPower",label:"Cursor Blast Power",stateKey:"weightlessRepelPower",type:"range",min:0,max:6e5,step:1e4,default:22e4,format:e=>""+Math.round(e),parse:parseFloat},{id:"weightlessRepelSoft",label:"Cursor Blast Falloff",stateKey:"weightlessRepelSoft",type:"range",min:.5,max:6,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},Et("weightlessWarmupFrames")]},water:{title:"Water",icon:"🌊",mode:"water",defaultOpen:!1,controls:[{id:"waterBallCount",label:"Ball Count",stateKey:"waterBallCount",type:"range",min:50,max:400,step:10,default:300,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"waterDrag",label:"Water Resistance",stateKey:"waterDrag",type:"range",min:.001,max:.05,step:.001,default:.015,format:e=>e.toFixed(3),parse:parseFloat},{id:"waterRippleStrength",label:"Ripple Strength",stateKey:"waterRippleStrength",type:"range",min:5e3,max:3e4,step:1e3,default:18e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"waterMotion",label:"Drift Strength",stateKey:"waterDriftStrength",type:"range",min:0,max:80,step:1,default:40,format:e=>e.toFixed(0),parse:parseFloat,onChange(e,t){e.waterInitialVelocity=5*t},reinitMode:!0},Et("waterWarmupFrames")]},vortex:{title:"Vortex",icon:"🌀",mode:"vortex",defaultOpen:!1,controls:[{id:"vortexBallCount",label:"Ball Count",stateKey:"vortexBallCount",type:"range",min:50,max:500,step:10,default:180,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"vortexSwirl",label:"Swirl Strength",stateKey:"vortexSwirlStrength",type:"range",min:100,max:3e3,step:50,default:420,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexPull",label:"Radial Pull",stateKey:"vortexRadialPull",type:"range",min:0,max:2e3,step:20,default:180,format:e=>e.toFixed(0),parse:parseFloat},{id:"vortexSpeedMultiplier",label:"Speed Multiplier",stateKey:"vortexSpeedMultiplier",type:"range",min:.1,max:3,step:.1,default:1,format:e=>e.toFixed(1),parse:parseFloat},{id:"vortexRadius",label:"Vortex Radius",stateKey:"vortexRadius",type:"range",min:0,max:800,step:20,default:0,format:e=>0===e?"Unlimited":e.toFixed(0)+"px",parse:parseFloat,tooltip:"Maximum effective radius (0 = unlimited, uses distance falloff)"},{id:"vortexFalloffCurve",label:"Falloff Curve",stateKey:"vortexFalloffCurve",type:"range",min:.3,max:3,step:.1,default:1,format:e=>e.toFixed(1),parse:parseFloat,tooltip:"Falloff shape: 1.0 = linear, 2.0 = quadratic (sharper), 0.5 = gentle"},{id:"vortexRotationDirection",label:"Rotation Direction",stateKey:"vortexRotationDirection",type:"range",min:-1,max:1,step:2,default:1,format:e=>1===e?"Counterclockwise":"Clockwise",parse:parseFloat},{id:"vortexCoreStrength",label:"Core Strength",stateKey:"vortexCoreStrength",type:"range",min:.5,max:3,step:.1,default:1,format:e=>e.toFixed(1)+"x",parse:parseFloat,tooltip:"Strength multiplier at vortex center"},{id:"vortexAccelerationZone",label:"Acceleration Zone",stateKey:"vortexAccelerationZone",type:"range",min:0,max:400,step:20,default:0,format:e=>0===e?"Disabled":e.toFixed(0)+"px",parse:parseFloat,tooltip:"Radius where extra acceleration occurs (0 = disabled)"},{id:"vortexOutwardPush",label:"Outward Push",stateKey:"vortexOutwardPush",type:"range",min:0,max:1e3,step:20,default:0,format:e=>0===e?"Disabled":e.toFixed(0),parse:parseFloat,tooltip:"Outward force at edges (only when radius is set)"},{id:"vortexDrag",label:"Drag",stateKey:"vortexDrag",type:"range",min:.001,max:.05,step:.001,default:.005,format:e=>e.toFixed(3),parse:parseFloat},Et("vortexWarmupFrames")]},"ping-pong":{title:"Ping Pong",icon:"🏓",mode:"ping-pong",defaultOpen:!1,controls:[{id:"pingPongBallCount",label:"Ball Count",stateKey:"pingPongBallCount",type:"range",min:10,max:100,step:5,default:35,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"pingPongSpeed",label:"Ball Speed",stateKey:"pingPongSpeed",type:"range",min:200,max:1600,step:50,default:800,format:e=>e.toFixed(0),parse:parseFloat,reinitMode:!0},{id:"pingPongVerticalDamp",label:"Vertical Damping",stateKey:"pingPongVerticalDamp",type:"range",min:.8,max:.999,step:.001,default:.995,format:e=>e.toFixed(3),parse:parseFloat},Et("pingPongWarmupFrames")]},magnetic:{title:"Magnetic",icon:"🧲",mode:"magnetic",defaultOpen:!1,controls:[{id:"magneticBallCount",label:"Ball Count",stateKey:"magneticBallCount",type:"range",min:50,max:300,step:10,default:180,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"magneticStrength",label:"Strength",stateKey:"magneticStrength",type:"range",min:1e4,max:1e5,step:5e3,default:65e3,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticVelocity",label:"Max Velocity",stateKey:"magneticMaxVelocity",type:"range",min:500,max:4e3,step:100,default:2800,format:e=>e.toFixed(0),parse:parseFloat},{id:"magneticDamping",label:"Damping",stateKey:"magneticDamping",type:"range",min:.8,max:.999,step:.001,default:.98,format:e=>e.toFixed(3),parse:parseFloat},Et("magneticWarmupFrames")]},bubbles:{title:"Bubbles",icon:"🫧",mode:"bubbles",defaultOpen:!1,controls:[{id:"bubblesRate",label:"Bubble Rate",stateKey:"bubblesSpawnRate",type:"range",min:1,max:20,step:1,default:8,format:e=>e+"",parse:e=>parseInt(e,10)},{id:"bubblesSpeed",label:"Rise Speed",stateKey:"bubblesRiseSpeed",type:"range",min:50,max:400,step:25,default:150,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesWobble",label:"Wobble",stateKey:"bubblesWobble",type:"range",min:0,max:100,step:5,default:40,format:e=>e.toFixed(0),parse:parseFloat},{id:"bubblesMax",label:"Max Bubbles",stateKey:"bubblesMaxCount",type:"range",min:50,max:300,step:10,default:150,format:e=>e+"",parse:e=>parseInt(e,10)},Et("bubblesWarmupFrames")]},tilt:{title:"Tilt",icon:"⚖️",mode:"tilt",defaultOpen:!1,controls:[{id:"tiltBallCount",label:"Particle Count",stateKey:"tiltBallCount",type:"range",min:100,max:500,step:10,default:300,format:e=>e+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"tiltMaxAngle",label:"Max Angle",stateKey:"tiltMaxAngle",type:"range",min:.5,max:10,step:.5,default:2,format:e=>e.toFixed(1)+"°",parse:parseFloat},{id:"tiltLerpSpeed",label:"Smoothness",stateKey:"tiltLerpSpeed",type:"range",min:.01,max:.5,step:.01,default:.08,format:e=>e.toFixed(2),parse:parseFloat},{id:"tiltGlassMass",label:"Particle Mass",stateKey:"tiltGlassBallMass",type:"range",min:.02,max:.3,step:.01,default:.08,format:e=>e.toFixed(2)+"x",parse:parseFloat,reinitMode:!0},{id:"tiltFriction",label:"Friction",stateKey:"tiltFriction",type:"range",min:.002,max:.02,step:.001,default:.008,format:e=>e.toFixed(3),parse:parseFloat}]},kaleidoscope:{title:"Kaleidoscope",icon:"🪞",mode:"kaleidoscope",defaultOpen:!1,controls:[{id:"kaleiBallCount",label:"Ball Count",stateKey:"kaleidoscopeBallCount",type:"range",min:15,max:120,step:1,default:23,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kaleiWedges",label:"Wedges",stateKey:"kaleidoscopeWedges",type:"range",min:4,max:16,step:1,default:12,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kaleiMirror",label:"Mirror",type:"range",min:0,max:1,step:1,default:1,format:e=>e?"On":"Off",parse:e=>parseInt(e,10)},{id:"kaleiSpeed",label:"Speed",stateKey:"kaleidoscopeSpeed",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2),parse:parseFloat},{id:"kaleiDotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscopeDotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kaleiDotAreaMul",label:"Dot Area",stateKey:"kaleidoscopeDotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kaleiSpawnArea",label:"Spawn Density",stateKey:"kaleidoscopeSpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kaleiSizeVar",label:"Size Variance",stateKey:"kaleidoscopeSizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},Et("kaleidoscopeWarmupFrames")]},kaleidoscope1:{title:"Kaleidoscope I (Variant)",icon:"🪞",mode:"kaleidoscope-1",defaultOpen:!1,controls:[{id:"kalei1BallCount",label:"Ball Count",stateKey:"kaleidoscope1BallCount",type:"range",min:6,max:180,step:1,default:18,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei1Wedges",label:"Wedges",stateKey:"kaleidoscope1Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei1Speed",label:"Speed",stateKey:"kaleidoscope1Speed",type:"range",min:.2,max:2,step:.05,default:.8,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei1DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope1DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei1DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope1DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei1SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope1SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei1SizeVar",label:"Size Variance",stateKey:"kaleidoscope1SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},Et("kaleidoscope1WarmupFrames")]},kaleidoscope2:{title:"Kaleidoscope II (Variant)",icon:"🪞",mode:"kaleidoscope-2",defaultOpen:!1,controls:[{id:"kalei2BallCount",label:"Ball Count",stateKey:"kaleidoscope2BallCount",type:"range",min:10,max:260,step:2,default:36,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei2Wedges",label:"Wedges",stateKey:"kaleidoscope2Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei2Speed",label:"Speed",stateKey:"kaleidoscope2Speed",type:"range",min:.2,max:2,step:.05,default:1.15,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei2DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope2DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei2DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope2DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei2SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope2SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei2SizeVar",label:"Size Variance",stateKey:"kaleidoscope2SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},Et("kaleidoscope2WarmupFrames")]},kaleidoscope3:{title:"Kaleidoscope III (Variant)",icon:"🪞",mode:"kaleidoscope-3",defaultOpen:!1,controls:[{id:"kalei3BallCount",label:"Ball Count",stateKey:"kaleidoscope3BallCount",type:"range",min:12,max:300,step:3,default:54,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"kalei3Wedges",label:"Wedges",stateKey:"kaleidoscope3Wedges",type:"range",min:3,max:24,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},{id:"kalei3Speed",label:"Speed",stateKey:"kaleidoscope3Speed",type:"range",min:.2,max:2,step:.05,default:1.55,format:e=>e.toFixed(2),parse:parseFloat},{id:"kalei3DotSizeVh",label:"Dot Size (vh)",stateKey:"kaleidoscope3DotSizeVh",type:"range",min:.2,max:2.5,step:.05,default:.95,format:e=>e.toFixed(2)+"vh",parse:parseFloat,reinitMode:!0},{id:"kalei3DotAreaMul",label:"Dot Area",stateKey:"kaleidoscope3DotAreaMul",type:"range",min:.3,max:1.5,step:.05,default:.7,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei3SpawnArea",label:"Spawn Density",stateKey:"kaleidoscope3SpawnAreaMul",type:"range",min:.2,max:2,step:.05,default:1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"kalei3SizeVar",label:"Size Variance",stateKey:"kaleidoscope3SizeVariance",type:"range",min:0,max:1,step:.05,default:.3,format:e=>(100*e).toFixed(0)+"%",parse:parseFloat,reinitMode:!0},Et("kaleidoscope3WarmupFrames")]},orbit3d:{title:"Orbit 3D: Zero Gravity",icon:"🌪️",mode:"orbit-3d",defaultOpen:!1,controls:[{id:"orbit3dMoonCount",label:"Body Count",stateKey:"orbit3dMoonCount",type:"range",min:10,max:200,step:10,default:80,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"orbit3dGravity",label:"Gravity Pull",stateKey:"orbit3dGravity",type:"range",min:1e3,max:1e4,step:500,default:5e3,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3dVelocityMult",label:"Orbital Speed",stateKey:"orbit3dVelocityMult",type:"range",min:50,max:300,step:10,default:150,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3dDepthScale",label:"Depth Effect",stateKey:"orbit3dDepthScale",type:"range",min:0,max:1.5,step:.1,default:.8,format:e=>e.toFixed(1),parse:parseFloat},{id:"orbit3dDamping",label:"Stability",stateKey:"orbit3dDamping",type:"range",min:.005,max:.05,step:.005,default:.02,format:e=>e.toFixed(3),parse:parseFloat},{id:"sizeVariationOrbit3d",label:"Size Variation",stateKey:"sizeVariationOrbit3d",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},Et("orbit3dWarmupFrames")]},orbit3d2:{title:"Orbit 3D (Tight Swarm)",icon:"🌪️",mode:"orbit-3d-2",defaultOpen:!1,controls:[{id:"orbit3d2MoonCount",label:"Moon Count",stateKey:"orbit3d2MoonCount",type:"range",min:20,max:200,step:10,default:100,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"orbit3d2Gravity",label:"Gravity (G×M)",stateKey:"orbit3d2Gravity",type:"range",min:1e4,max:3e5,step:1e4,default:8e4,format:e=>Math.round(e/1e3)+"k",parse:parseFloat,reinitMode:!0},{id:"orbit3d2VelocityMult",label:"Initial Velocity",stateKey:"orbit3d2VelocityMult",type:"range",min:.5,max:1.5,step:.05,default:1.1,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"orbit3d2MinOrbit",label:"Min Orbit (vw)",stateKey:"orbit3d2MinOrbit",type:"range",min:2,max:15,step:1,default:4,format:e=>e+"vw",parse:parseFloat,reinitMode:!0},{id:"orbit3d2MaxOrbit",label:"Max Orbit (vw)",stateKey:"orbit3d2MaxOrbit",type:"range",min:3,max:25,step:1,default:12,format:e=>e+"vw",parse:parseFloat,reinitMode:!0},{id:"orbit3d2DepthScale",label:"Depth Effect",stateKey:"orbit3d2DepthScale",type:"range",min:0,max:.8,step:.05,default:.6,format:e=>e.toFixed(2),parse:parseFloat},{id:"orbit3d2Damping",label:"Damping",stateKey:"orbit3d2Damping",type:"range",min:0,max:.2,step:.005,default:.01,format:e=>e.toFixed(3),parse:parseFloat},{id:"orbit3d2FollowSmoothing",label:"Cursor Follow Speed",stateKey:"orbit3d2FollowSmoothing",type:"range",min:1,max:200,step:1,default:40,format:e=>Math.round(e),parse:parseFloat},{id:"orbit3d2Softening",label:"Gravity Softening",stateKey:"orbit3d2Softening",type:"range",min:1,max:100,step:1,default:15,format:e=>Math.round(e),parse:parseFloat},{id:"sizeVariationOrbit3d2",label:"Size Variation",stateKey:"sizeVariationOrbit3d2",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},Et("orbit3d2WarmupFrames")]},lattice:{title:"Crystal Lattice",icon:"💎",mode:"lattice",defaultOpen:!1,controls:[{id:"sizeVariationLattice",label:"Size Variation",stateKey:"sizeVariationLattice",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"latticeSpacingVw",label:"Spacing (vw)",stateKey:"latticeSpacingVw",type:"range",min:1,max:20,step:.25,default:8.5,format:e=>e.toFixed(2)+"vw",parse:parseFloat,reinitMode:!0},{id:"latticeStiffness",label:"Stiffness",stateKey:"latticeStiffness",type:"range",min:0,max:10,step:.1,default:2.2,format:e=>e.toFixed(1),parse:parseFloat},{id:"latticeDamping",label:"Damping",stateKey:"latticeDamping",type:"range",min:.5,max:1,step:.01,default:.92,format:e=>e.toFixed(2),parse:parseFloat},{id:"latticeDisruptRadius",label:"Mesh Stretch Radius",stateKey:"latticeDisruptRadius",type:"range",min:50,max:1e3,step:25,default:600,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"latticeDisruptPower",label:"Mesh Stretch Power",stateKey:"latticeDisruptPower",type:"range",min:0,max:50,step:1,default:25,format:e=>e.toFixed(1),parse:parseFloat},{id:"latticeMeshWaveStrength",label:"Wave Amplitude",stateKey:"latticeMeshWaveStrength",type:"range",min:0,max:50,step:1,default:12,format:e=>Math.round(e)+"px",parse:parseFloat},{id:"latticeMeshWaveSpeed",label:"Wave Speed",stateKey:"latticeMeshWaveSpeed",type:"range",min:0,max:3,step:.1,default:.8,format:e=>e.toFixed(1)+"x",parse:parseFloat},{id:"latticeAlignment",label:"Grid Alignment",stateKey:"latticeAlignment",type:"select",options:[{value:"center",label:"Center (Fill)"},{value:"top-left",label:"Top-Left"},{value:"top-center",label:"Top-Center"},{value:"top-right",label:"Top-Right"}],default:"center",format:e=>e+"",parse:e=>e+"",reinitMode:!0},Et("latticeWarmupFrames")]},neural:{title:"Neural Network",icon:"🧠",mode:"neural",defaultOpen:!1,controls:[{id:"neuralBallCount",label:"Ball Count",stateKey:"neuralBallCount",type:"range",min:8,max:260,step:1,default:80,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"sizeVariationNeural",label:"Size Variation",stateKey:"sizeVariationNeural",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"neuralWanderStrength",label:"Wander Strength",stateKey:"neuralWanderStrength",type:"range",min:0,max:2e3,step:10,default:420,format:e=>Math.round(e)+"",parse:parseFloat},{id:"neuralDamping",label:"Damping",stateKey:"neuralDamping",type:"range",min:.8,max:1,step:.005,default:.985,format:e=>e.toFixed(3),parse:parseFloat},{id:"neuralCohesion",label:"Cohesion",stateKey:"neuralCohesion",type:"range",min:0,max:1,step:.01,default:.18,format:e=>e.toFixed(2),parse:parseFloat},Et("neuralWarmupFrames")]},parallaxLinear:{title:"Parallax (Linear)",icon:"🫧",mode:"parallax-linear",defaultOpen:!1,controls:[{id:"parallaxLinearPreset",label:"Preset",stateKey:"parallaxLinearPreset",type:"select",options:Object.keys(po).map(e=>({value:e,label:po[e].label})),default:"default",format:e=>po[e]?.label||e,onChange(e){((e,t=!0)=>{const a=po[e];if(!a)return;const o=b();for(const[i,r]of Object.entries(a))"label"!==i&&void 0!==o[i]&&(o[i]=r);o.parallaxLinearPreset=e,t&&Promise.resolve().then(()=>Cn).then(({resetCurrentMode:e})=>e());try{jt()}catch(n){}console.log("Applied parallax linear preset: "+a.label)})(e,!0)}},{id:"parallaxLinearDotSizeMul",label:"Dot Size",stateKey:"parallaxLinearDotSizeMul",type:"range",min:.2,max:6,step:.1,default:1.8,format:e=>e.toFixed(1)+"×",parse:parseFloat,reinitMode:!0},{id:"sizeVariationParallaxLinear",label:"Size Variation",stateKey:"sizeVariationParallaxLinear",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"parallaxLinearGridX",label:"Grid X (Cols)",stateKey:"parallaxLinearGridX",type:"range",min:3,max:40,step:1,default:14,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearGridY",label:"Grid Y (Rows)",stateKey:"parallaxLinearGridY",type:"range",min:3,max:40,step:1,default:10,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearGridZ",label:"Grid Z (Layers)",stateKey:"parallaxLinearGridZ",type:"range",min:2,max:20,step:1,default:7,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearSpanX",label:"Span X",stateKey:"parallaxLinearSpanX",type:"range",min:.2,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0,hint:"World-space width as a multiple of the viewport width. Use >1 to fill edge-to-edge."},{id:"parallaxLinearSpanY",label:"Span Y",stateKey:"parallaxLinearSpanY",type:"range",min:.2,max:3,step:.05,default:1.35,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0,hint:"World-space height as a multiple of the viewport height."},{id:"parallaxLinearZNear",label:"Z Near",stateKey:"parallaxLinearZNear",type:"range",min:10,max:1200,step:10,default:50,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearZFar",label:"Z Far",stateKey:"parallaxLinearZFar",type:"range",min:50,max:3e3,step:25,default:900,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxLinearFocalLength",label:"Focal Length",stateKey:"parallaxLinearFocalLength",type:"range",min:80,max:2e3,step:10,default:420,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10)},{id:"parallaxLinearParallaxStrength",label:"Parallax Strength",stateKey:"parallaxLinearParallaxStrength",type:"range",min:0,max:2e3,step:10,default:260,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},Et("parallaxLinearWarmupFrames")]},parallaxPerspective:{title:"Parallax (Perspective)",icon:"🫧",mode:"parallax-perspective",defaultOpen:!1,controls:[{id:"parallaxPerspectivePreset",label:"Preset",stateKey:"parallaxPerspectivePreset",type:"select",options:Object.keys(uo).map(e=>({value:e,label:uo[e].label})),default:"default",format:e=>uo[e]?.label||e,onChange(e){((e,t=!0)=>{const a=uo[e];if(!a)return;const o=b();for(const[i,r]of Object.entries(a))"label"!==i&&void 0!==o[i]&&(o[i]=r);o.parallaxPerspectivePreset=e,t&&Promise.resolve().then(()=>Cn).then(({resetCurrentMode:e})=>e());try{jt()}catch(n){}console.log("Applied parallax perspective preset: "+a.label)})(e,!0)}},{id:"parallaxPerspectiveRandomness",label:"Randomness",stateKey:"parallaxPerspectiveRandomness",type:"range",min:0,max:1,step:.05,default:.6,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0,hint:"0 = perfect grid. 1 = full jitter from grid vertices."},{id:"parallaxPerspectiveDotSizeMul",label:"Dot Size",stateKey:"parallaxPerspectiveDotSizeMul",type:"range",min:.2,max:6,step:.1,default:1.8,format:e=>e.toFixed(1)+"×",parse:parseFloat,reinitMode:!0},{id:"sizeVariationParallaxPerspective",label:"Size Variation",stateKey:"sizeVariationParallaxPerspective",type:"range",min:0,max:1,step:.05,default:0,format:e=>e.toFixed(2),parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveGridX",label:"Grid X (Cols)",stateKey:"parallaxPerspectiveGridX",type:"range",min:3,max:50,step:1,default:16,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveGridY",label:"Grid Y (Rows)",stateKey:"parallaxPerspectiveGridY",type:"range",min:3,max:50,step:1,default:12,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveGridZ",label:"Grid Z (Layers)",stateKey:"parallaxPerspectiveGridZ",type:"range",min:2,max:25,step:1,default:8,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveSpanX",label:"Span X",stateKey:"parallaxPerspectiveSpanX",type:"range",min:.2,max:3,step:.05,default:1.45,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveSpanY",label:"Span Y",stateKey:"parallaxPerspectiveSpanY",type:"range",min:.2,max:3,step:.05,default:1.45,format:e=>e.toFixed(2)+"×",parse:parseFloat,reinitMode:!0},{id:"parallaxPerspectiveZNear",label:"Z Near",stateKey:"parallaxPerspectiveZNear",type:"range",min:10,max:1200,step:10,default:40,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveZFar",label:"Z Far",stateKey:"parallaxPerspectiveZFar",type:"range",min:50,max:4e3,step:50,default:1200,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10),reinitMode:!0},{id:"parallaxPerspectiveFocalLength",label:"Focal Length",stateKey:"parallaxPerspectiveFocalLength",type:"range",min:80,max:2e3,step:10,default:420,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10)},{id:"parallaxPerspectiveParallaxStrength",label:"Parallax Strength",stateKey:"parallaxPerspectiveParallaxStrength",type:"range",min:0,max:2e3,step:10,default:280,format:e=>Math.round(e)+"",parse:e=>parseInt(e,10)},Et("parallaxPerspectiveWarmupFrames")]},entrance:{title:"Entrance",icon:"🎭",defaultOpen:!1,controls:[{id:"entranceEnabled",label:"Enabled",stateKey:"entranceEnabled",type:"checkbox",default:!0,format:e=>e?"On":"Off",parse:e=>!!e,hint:"Enable dramatic entrance animation (browser default → wall-state)",onChange(){"undefined"!=typeof window&&setTimeout(()=>window.location.reload(),300)}},{id:"entranceWallTransitionDelay",label:"Wall Transition Delay",stateKey:"entranceWallTransitionDelay",type:"range",min:0,max:2e3,step:50,default:300,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Delay before wall background transition starts"},{id:"entranceWallTransitionDuration",label:"Wall Growth Duration",stateKey:"entranceWallTransitionDuration",type:"range",min:200,max:2e3,step:50,default:800,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration of wall scaling down into viewport animation"},{id:"entranceWallInitialScale",label:"Initial Scale",stateKey:"entranceWallInitialScale",type:"range",min:1.05,max:1.5,step:.05,default:1.1,format:e=>e.toFixed(2),parse:e=>parseFloat(e),hint:"Starting scale (wall starts slightly larger, scales down to 1.0)"},{id:"entranceWallEasing",label:"Wall Growth Easing",stateKey:"entranceWallEasing",type:"select",options:[{value:"cubic-bezier(0.16, 1, 0.3, 1)",label:"Organic (default)"},{value:"ease-out",label:"Ease Out"},{value:"ease-in-out",label:"Ease In Out"},{value:"cubic-bezier(0.34, 1.56, 0.64, 1)",label:"Bounce"},{value:"cubic-bezier(0.68, -0.55, 0.265, 1.55)",label:"Overshoot"}],default:"cubic-bezier(0.16, 1, 0.3, 1)",format:e=>e+"",parse:e=>e+"",hint:"Easing function for wall growth animation"},{id:"entranceElementDuration",label:"Element Duration",stateKey:"entranceElementDuration",type:"range",min:100,max:1e3,step:50,default:200,format:e=>Math.round(e)+"ms",parse:e=>parseInt(e,10),hint:"Duration for individual element animations"},{id:"entranceElementScaleStart",label:"Element Scale Start",stateKey:"entranceElementScaleStart",type:"range",min:.5,max:1,step:.01,default:.95,format:e=>e.toFixed(2),parse:e=>parseFloat(e),hint:"Initial scale for elements (0-1)"},{id:"entranceElementTranslateZStart",label:"Element Z Start",stateKey:"entranceElementTranslateZStart",type:"range",min:-100,max:0,step:5,default:-20,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"Initial z-axis position (negative = back in 3D space)"},{id:"entrancePerspectiveLandscape",label:"Perspective (Landscape)",stateKey:"entrancePerspectiveLandscape",type:"range",min:500,max:3e3,step:50,default:1200,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"3D perspective for landscape aspect ratio",onChange(){Promise.resolve().then(()=>Vr).then(({applyPerspectiveCSS:e})=>{e()}).catch(()=>{})}},{id:"entrancePerspectiveSquare",label:"Perspective (Square)",stateKey:"entrancePerspectiveSquare",type:"range",min:500,max:3e3,step:50,default:1e3,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"3D perspective for square aspect ratio",onChange(){Promise.resolve().then(()=>Vr).then(({applyPerspectiveCSS:e})=>{e()}).catch(()=>{})}},{id:"entrancePerspectivePortrait",label:"Perspective (Portrait)",stateKey:"entrancePerspectivePortrait",type:"range",min:500,max:3e3,step:50,default:800,format:e=>Math.round(e)+"px",parse:e=>parseInt(e,10),hint:"3D perspective for portrait aspect ratio",onChange(){Promise.resolve().then(()=>Vr).then(({applyPerspectiveCSS:e})=>{e()}).catch(()=>{})}}]}};var Ci=Object.freeze({__proto__:null,setupIndexControls:Yt,setupMasterControls:Zt,updateModeButtonsUI:Xt});(()=>{try{for(const[,e]of Object.entries(ki)){if(!e?.mode)continue;const t=Array.isArray(e.controls)?e.controls.length:0;4>t&&console.warn(`[panel] Mode "${e.mode}" has only ${t} controls; add at least 4 parameters.`)}}catch(e){}$t({open:!0}),Gt(),Ht(),_t({open:!1})})();const Pi=Ht(),Fi={core:{title:"Core",controls:[{id:"masterGain",label:"Master Volume",min:10,max:100,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"collisionMinImpact",label:"Silence Threshold",min:20,max:85,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e}]},envelope:{title:"Envelope",controls:[{id:"decayTime",label:"Click Length",min:20,max:180,step:1,format:e=>Math.round(e)+"ms",toConfig:e=>e/1e3,fromConfig:e=>1e3*e}]},tone:{title:"Tone",controls:[{id:"filterBaseFreq",label:"Brightness",min:300,max:6e3,step:50,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"harmonicGain",label:"Warmth",min:0,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"filterQ",label:"Resonance",min:10,max:200,step:5,format:e=>""+(e/100).toFixed(2),toConfig:e=>e/100,fromConfig:e=>100*e}]},crystal:{title:"Crystal",controls:[{id:"pitchMinHz",label:"Pitch Low",min:80,max:1200,step:10,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"pitchMaxHz",label:"Pitch High",min:200,max:4e3,step:20,format:e=>Math.round(e)+"Hz",toConfig:e=>e,fromConfig:e=>e},{id:"pitchCurve",label:"Pitch Curve",min:70,max:160,step:1,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleGain",label:"Sparkle",min:0,max:35,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMin",label:"Sparkle Min",min:120,max:600,step:10,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleRatioMax",label:"Sparkle Max",min:160,max:800,step:10,format:e=>(e/100).toFixed(2)+"×",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"sparkleDecayMul",label:"Sparkle Decay",min:20,max:95,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"noiseTransientQ",label:"Sparkle Q",min:60,max:600,step:5,format:e=>""+(e/100).toFixed(2),toConfig:e=>e/100,fromConfig:e=>100*e}]},space:{title:"Space",controls:[{id:"reverbWetMix",label:"Reverb Mix",min:0,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"reverbDecay",label:"Room Size",min:5,max:80,step:1,format:e=>(e/100).toFixed(2)+"s",toConfig:e=>e/100,fromConfig:e=>100*e}]},dynamics:{title:"Dynamics",controls:[{id:"minGain",label:"Min Hit Volume",min:0,max:20,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"maxGain",label:"Max Hit Volume",min:5,max:50,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e}]},realism:{title:"Realism",controls:[{id:"noiseTransientGain",label:"Impact Snap",min:0,max:80,step:1,format:e=>Math.round(e)+"%",toConfig:e=>e/100,fromConfig:e=>100*e},{id:"varianceGain",label:"Volume Variance",min:0,max:50,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"variancePitch",label:"Pitch Variance",min:0,max:25,step:1,format:e=>`±${Math.round(e)}%`,toConfig:e=>e/100,fromConfig:e=>100*e},{id:"velocityNoiseScale",label:"Hard Hit Crack",min:100,max:500,step:10,format:e=>(e/100).toFixed(1)+"×",toConfig:e=>e/100,fromConfig:e=>100*e}]}};let Ti=null,Ii=null;const Di={position:"panel_dock_position_v2",dockHidden:"panel_dock_hidden",panelCollapsed:"master_panel_collapsed",panelSize:lt()?"panel_dock_size_dev_v3":"panel_dock_size_prod_v3"};let Li=!1,Ai=0,Ki=0,Oi=0,Wi=0,zi=!1,Ei=!1,Ri=null,Bi=!0,Vi=null;const Ni=new WeakMap;var $i=Object.freeze({__proto__:null,hideOverlay:ha,initGateOverlay:ca,isOverlayActive:fa,mountGateIntoOverlay:ia,showOverlay:ua,unmountGateFromOverlay:ra,updateBlurFromWallThickness:sa,updateGateContentDelay(e){document.documentElement.style.setProperty("--gate-content-delay",e+"ms")},updateGateDepthScale(e){document.documentElement.style.setProperty("--gate-depth-scale",e)},updateGateDepthTranslateY(e){document.documentElement.style.setProperty("--gate-depth-translate-y",e+"px")},updateLogoBlurActive(e){const t=document.documentElement;t.style.setProperty("--logo-blur-active-target",e+"px"),fa()&&t.style.setProperty("--logo-blur-active",e+"px")},updateLogoBlurInactive(e){const t=document.documentElement;t.style.setProperty("--logo-blur-inactive",e+"px"),fa()||t.style.setProperty("--logo-blur-active",e+"px")},updateLogoOpacityActive(e){const t=document.documentElement,a=e;t.style.setProperty("--logo-opacity-active-target",a),fa()&&t.style.setProperty("--logo-opacity-active",a)},updateLogoOpacityInactive(e){const t=document.documentElement;t.style.setProperty("--logo-opacity-inactive",e),fa()||t.style.setProperty("--logo-opacity-active",e)},updateOverlayOpacity(e){Ri&&Ri.style.setProperty("--gate-overlay-opacity",e)},updateOverlayTransition(e){Ri&&(Ri.style.setProperty("--gate-overlay-transition-duration",e+"ms"),document.documentElement.style.setProperty("--gate-depth-duration",e+"ms"))},updateOverlayTransitionOut(e){Ri&&(Ri.style.setProperty("--gate-overlay-transition-out-duration",e+"ms"),document.documentElement.style.setProperty("--gate-depth-out-duration",e+"ms"))}});const _i="--abs-scene-impact",Gi="--abs-scene-impact-dur",Hi="--abs-scene-impact-logo-scale";let ji=null,Zi=!1,Yi=0,Xi=0,Ui=0,qi=!1,Ji=0,Qi=0,er=0,tr=0,ar=!1,or=null,nr=0,ir=0,rr=0,lr=!1,sr=0,cr=0,dr=0,pr=0,ur=0,hr=performance.now()/1e3,fr=0,mr=!0,gr=null;const br=1e3/60;let yr=[],Mr=0,vr=null;const wr='<i class="ti ti-volume-off" aria-hidden="true"></i>';let xr=null;const Sr=new Map([["apple music",'<i class="ti ti-brand-apple" aria-hidden="true"></i>'],["instagram",'<i class="ti ti-brand-instagram" aria-hidden="true"></i>'],["linkedin",'<i class="ti ti-brand-linkedin" aria-hidden="true"></i>'],["x",'<i class="ti ti-brand-x" aria-hidden="true"></i>']]);var kr=Object.freeze({__proto__:null,applyExpertiseLegendColors:Ka});let Cr=!1,Pr=null,Fr=!1;const Tr="abs-link-hovering",Ir="abs-hover-mode-index",Dr="abs-hover-mode-ui",Lr="--abs-cursor-hop-dot-size",Ar="abs-hover-pulse-ring",Kr="abs-hover-target",Or="abs-hover-target--index",Wr="abs-hover-target--ui",zr="--abs-hover-index-bg",Er="--abs-hover-index-fg";let Rr=!1;const Br=['1em "Geist"','1em "Geist Mono"','1em "Sarina"','1em "tabler-icons"'];(async()=>{document.documentElement.classList.add("js-enabled");try{await(async()=>{if(vr)return vr;const e=ka();if(e)return vr=e,vr;const t=await(async()=>{const e=["config/contents-home.json","js/contents-home.json","../public/js/contents-home.json","config/text.json","js/text.json","../public/js/text.json"];for(const a of e)try{const e=await fetch(a,{cache:"no-cache"});if(!e.ok)continue;const t=await e.json();if(Sa(t))return t}catch(t){}throw Error("No contents-home.json found")})();vr=t;try{"undefined"!=typeof window&&(window.__TEXT__=t)}catch(a){}return vr})(),(()=>{try{(()=>{const e=Ca("meta.title","");e&&(document.title=e);const t=Ca("meta.description","");if(t){const e=document.querySelector('meta[name="description"]');e&&e.setAttribute("content",t)}})(),to(document.getElementById("edge-chapter-text"),Ca("edge.chapterText","")),to(document.querySelector(".edge-copyright__text"),Ca("edge.copyright","")),(()=>{const e=document.getElementById("expertise-legend");ao(e,"aria-label",Ca("legend.ariaLabel",""));const t=Ca("legend.items",null);if(!Array.isArray(t)||!e)return;const a=e.querySelectorAll(".legend__item span");for(let o=0;a.length>o&&t.length>o;o++){const e=t?.[o]?.label;e&&(a[o].textContent=e)}})(),(()=>{const e=document.querySelector(".decorative-script p");if(!e)return;const t=Ca("philosophy.textBeforeLink",""),a=Ca("philosophy.link.id","contact-email-inline")||"contact-email-inline",o=Ca("philosophy.link.href","#")||"#",n=Ca("philosophy.link.text","")||"";let i=document.getElementById(a);if(i||(i=e.querySelector("a")),!i)return;i.id=a,i.setAttribute("href",o),i.textContent=n;const r=i.previousSibling;r&&r.nodeType===Node.TEXT_NODE?r.nodeValue=t:e.insertBefore(document.createTextNode(t),i);const l=i.nextSibling;l&&l.nodeType===Node.TEXT_NODE&&(l.nodeValue="")})(),(()=>{ao(document.getElementById("footer-links-container"),"aria-label",Ca("footer.navAriaLabel",""));const e=Ca("footer.links",null);if(e&&"object"==typeof e)for(const t of["contact","portfolio","cv"]){const a=e?.[t];if(!a)continue;const o=document.getElementById(a.id||"");o&&(a.href&&o.setAttribute("href",a.href),a.text&&(o.textContent=a.text))}})(),(()=>{const e=document.getElementById("social-links");ao(e,"aria-label",Ca("socials.ariaLabel",""));const t=Ca("socials.items",null);if(!e||!t||"object"!=typeof t)return;const a=["appleMusic","x","linkedin"],o=e.querySelectorAll("a.footer_icon-link");for(let n=0;o.length>n&&3>n;n++){const e=o[n],i=t?.[a[n]];if(!i)continue;i.url&&e.setAttribute("href",i.url),i.ariaLabel&&e.setAttribute("aria-label",i.ariaLabel);const r=e.querySelector(".screen-reader");r&&i.screenReaderText&&(r.textContent=i.screenReaderText)}})(),(()=>{const e=document.getElementById("header-cv-link");if(!e)return;const t=Ca("footer.links.cv",null);t&&"object"==typeof t&&(t.href&&e.setAttribute("href",t.href),t.text&&(e.textContent=t.text))})(),(()=>{const e=document.querySelector("[data-portfolio-ui] .decorative-script p");if(!e)return;const t=Ca("portfolio.blurb","");t&&(e.textContent=t)})()}catch(e){}})()}catch(e){}try{lt()&&Yn.groupCollapsed("BouncyBalls bootstrap"),ut("bb:start");const a=await(async()=>{try{try{if("undefined"!=typeof window&&window.__RUNTIME_CONFIG__&&"object"==typeof window.__RUNTIME_CONFIG__)return window.__RUNTIME_CONFIG__}catch(e){}const t=["config/default-config.json","js/config.json","../public/js/config.json"];for(const a of t)try{const e=await fetch(a,{cache:"no-cache"});if(e.ok)return await e.json()}catch(e){}throw Error("No config found")}catch(e){return console.warn("Config load failed, using defaults"),{gravityMultiplier:1.05,ballMass:91,maxBalls:300}}})();g(a),ut("bb:config"),oo(),ut("bb:layout");try{Y(),H()}catch(e){}(()=>{const e=document.querySelector(".noise");if(!e)return;const t=e.closest("#bravia-balls")||document.getElementById("bravia-balls")||e.parentElement||document.body,a=getComputedStyle(e),o=a.backgroundImage&&"none"!==a.backgroundImage?a.backgroundImage:null;if(!document.querySelector(".noise-2")){const e=document.createElement("div");e.className="noise-2",o&&(e.style.backgroundImage=o),t.appendChild(e)}if(!document.querySelector(".noise-3")){const e=document.createElement("div");e.className="noise-3",o&&(e.style.backgroundImage=o),t.appendChild(e)}})(),Lt(a),Ie(),M(Le()),Te(it),De(),ut("bb:renderer"),b().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),(()=>{function t(e){return!(!e||!e.closest||!(e.closest("#panelDock")||e.closest("#masterPanel")||e.closest("#dockToggle")||e.closest(".panel-dock")||e.closest(".panel")))}function a(e,t){const a=d.getBoundingClientRect();return{x:d.width/(a.width||1)*(e-a.left),y:d.height/(a.height||1)*(t-a.top),inBounds:!(a.left>e||e>a.right||a.top>t||t>a.bottom)}}function o(e,o,n,{isMouseLike:i}={isMouseLike:!0}){const r=a(e,o),l=performance.now(),s=l-er;if(s>0&&er>0){const e=r.x-Ji,t=r.y-Qi;tr=Math.sqrt(e*e+t*t)/s}if(i?Ue(e,o):qe(),c.currentMode!==io.ORBIT_3D&&c.currentMode!==io.ORBIT_3D_2&&t(n))return;if(fa())return;c.mouseX=r.x,c.mouseY=r.y,c.mouseInCanvas=r.inBounds,"undefined"!=typeof window&&(window.mouseInCanvas=r.inBounds);const d=Math.hypot(r.x-(c.lastPointerMoveX??r.x),r.y-(c.lastPointerMoveY??r.y));d>.5&&(c.lastPointerMoveMs=l,c.lastPointerMoveX=r.x,c.lastPointerMoveY=r.y),i&&d>.5&&((e,t,a,o)=>{if(Qe())return;const n=b();if(!n?.mouseTrailEnabled)return;if(!o)return;if(et())return;if((e=>{const t=Math.max(0,0|e);t>0&&(zn===t&&En&&Rn&&Bn||(zn=t,En=new Float32Array(zn),Rn=new Float32Array(zn),Bn=new Float64Array(zn),Vn=0,Nn=0))})(tt(0|(n.mouseTrailLength??18),4,96)),!zn)return;const i=n.DPR||1,r=tt(+(n.mouseTrailSize??1.3),.5,10)*i,l=Math.max(.35,.55*r),s=l*l;if(Nn>0){const o=(Vn-1+zn)%zn;if(((e,t,a,o)=>{const n=e-a,i=t-o;return n*n+i*i})(e,t,En[o],Rn[o])<s)return void(Bn[o]=a)}En[Vn]=e,Rn[Vn]=t,Bn[Vn]=a,Vn=(Vn+1)%zn,zn>Nn&&Nn++})(r.x,r.y,l,r.inBounds),c.currentMode===io.WATER&&r.inBounds&&tr>.3&&l-cr>80&&(we(r.x,r.y,Math.min(2*tr,3)),cr=l),Ji=r.x,Qi=r.y,er=l}function n(){if(c?.isMobile||c?.isMobileViewport)return!0;try{return!(!window.matchMedia||!window.matchMedia("(max-width: 768px)").matches)}catch(e){return!1}}function i(){if(sr){try{window.clearTimeout(sr)}catch(e){}sr=0}}function r(e,o,r,l=null){ar||t(r)||(e=>!(!e||!e.closest||!(e.closest("a")||e.closest("button")||e.closest("input")||e.closest("select")||e.closest("textarea"))))(r)||fa()||c.clickCycleEnabled&&a(e,o).inBounds&&(ar=!0,or=l,nr=e,ir=o,rr=0,lr=!1,i(),n()||(lr=!0,Ma(1,{armManual:!0,scheduleRelease:!1})))}function l(e=null,t="mouse"){if(!ar)return;if(null!==or&&null!==e&&e!==or)return;const a=rr;ar=!1,or=null,rr=0;const o=lr;if(lr=!1,"touch"!==t&&"pen"!==t||15>=a){if(n()){Ma(1,{armManual:!0,scheduleRelease:!1});const e=Math.max(1,Math.round(.8*(+(c.sceneImpactPressMs??75)||0))),t=Math.round(Math.min(80,Math.max(0,.4*(+e||0))));return i(),void(sr=window.setTimeout(()=>{sr=0,xa(),va()},Math.max(0,Math.round(e)+t)))}xa(),va()}else o&&va()}function s(e=null){ar&&(null!==or&&null!==e&&e!==or||(ar=!1,or=null,rr=0,i(),lr&&va(),lr=!1))}const c=b(),d=c.canvas;void 0===c.clickCycleEnabled&&(c.clickCycleEnabled=!1),d?(document.addEventListener("mousemove",e=>{window.PointerEvent||o(e.clientX,e.clientY,e.target,{isMouseLike:!0})},{passive:!0}),document.addEventListener("pointermove",e=>{o(e.clientX,e.clientY,e.target,{isMouseLike:"mouse"===e.pointerType||"pen"===e.pointerType})},{passive:!0}),window.PointerEvent?(document.addEventListener("pointerdown",e=>{r(e.clientX,e.clientY,e.target,e.pointerId)},{passive:!0}),document.addEventListener("pointermove",e=>{ar&&or===e.pointerId&&(rr=Math.max(rr,Math.hypot(e.clientX-nr,e.clientY-ir)))},{passive:!0}),document.addEventListener("pointerup",e=>{l(e.pointerId,e.pointerType)},{passive:!0}),document.addEventListener("pointercancel",e=>{s(e.pointerId)},{passive:!0})):(document.addEventListener("mousedown",e=>{r(e.clientX,e.clientY,e.target,null)},{passive:!0}),document.addEventListener("mouseup",()=>{l(null,"mouse")},{passive:!0})),document.addEventListener("touchmove",e=>{if(!fa()&&e.touches&&e.touches[0]){const t=a(e.touches[0].clientX,e.touches[0].clientY);c.mouseX=t.x,c.mouseY=t.y,c.mouseInCanvas=t.inBounds;const o=performance.now();Math.hypot(t.x-(c.lastPointerMoveX??t.x),t.y-(c.lastPointerMoveY??t.y))>.5&&(c.lastPointerMoveMs=o,c.lastPointerMoveX=t.x,c.lastPointerMoveY=t.y),c.currentMode===io.WATER&&t.inBounds&&o-cr>80&&(we(t.x,t.y,2),cr=o)}},{passive:!0}),document.addEventListener("touchstart",e=>{if(!window.PointerEvent&&!t(e.target)&&!fa()&&(qe(),!e.target.closest("a")&&!e.target.closest("button")&&!e.target.closest("input")&&!e.target.closest("select")&&!e.target.closest("textarea")&&e.touches&&e.touches[0])){const t=e.touches[0];if(!a(t.clientX,t.clientY).inBounds)return;c.clickCycleEnabled&&(ar=!0,or=null,nr=t.clientX,ir=t.clientY,rr=0)}},{passive:!0}),document.addEventListener("touchmove",e=>{if(!window.PointerEvent&&ar&&e.touches&&e.touches[0]){const t=e.touches[0];rr=Math.max(rr,Math.hypot(t.clientX-nr,t.clientY-ir))}},{passive:!0}),document.addEventListener("touchend",()=>{window.PointerEvent||l(null,"touch")},{passive:!0}),document.addEventListener("touchcancel",()=>{window.PointerEvent||s(null)},{passive:!0}),document.addEventListener("mouseleave",()=>{c.mouseX=so.OFFSCREEN_MOUSE,c.mouseY=so.OFFSCREEN_MOUSE,c.mouseInCanvas=!1,tr=0,"undefined"!=typeof window&&(window.mouseInCanvas=!1),qe()}),document.addEventListener("mouseenter",()=>{Je()}),document.addEventListener("touchend",()=>{c.mouseX=so.OFFSCREEN_MOUSE,c.mouseY=so.OFFSCREEN_MOUSE,c.mouseInCanvas=!1},{passive:!0}),console.log("✓ Unified pointer system configured (document-level)"),c.be=!0,"undefined"!=typeof window&&(window.be=!0)):console.error("Canvas not available for pointer setup")})(),"undefined"!=typeof document&&document.addEventListener("touchmove",e=>{var t;(t=e.target)instanceof Element&&(t.closest(".panel-dock .panel .panel-content")||t.closest("#controlPanel"))||e.preventDefault()},{passive:!1,capture:!0}),Ye(),Cr||(Cr=!0,Xa(),document.addEventListener("pointerover",qa,!0),document.addEventListener("pointerout",Ja,!0),document.addEventListener("pointermove",Qa,{passive:!0}),document.addEventListener("pointerdown",eo,!0),window.PointerEvent||(document.addEventListener("mouseover",qa,!0),document.addEventListener("mouseout",Ja,!0),document.addEventListener("mousemove",Qa,{passive:!0}),document.addEventListener("mousedown",eo,!0)),window.addEventListener("blur",Xa,{passive:!0}),window.addEventListener("mouseout",e=>{e.relatedTarget||e.toElement||Xa()},{passive:!0}),window.addEventListener("resize",()=>{if(Pr){try{Pr.getBoundingClientRect?.()}catch(e){}Ua()}},{passive:!0}),window.addEventListener("scroll",()=>{if(Pr){try{Pr.getBoundingClientRect?.()}catch(e){}Ua()}},{passive:!0,capture:!0})),(()=>{if("undefined"!=typeof window&&"undefined"!=typeof document&&(ji=document.querySelector("#abs-scene")||null,ji&&(ji.style.setProperty(_i,"0"),ji.style.setProperty(Gi,"100ms"),ji.style.setProperty(Hi,"1"),ga(),!(()=>{try{return!(!window.matchMedia||!window.matchMedia("(prefers-reduced-motion: reduce)").matches)}catch(e){return!1}})()))){Zi=!0,ji.classList.add("abs-scene--impact");try{window.addEventListener("resize",ga,{passive:!0})}catch(e){}window.addEventListener("bb:modeChanged",e=>{const t=b();if(!1===t?.sceneImpactEnabled)return;if(qi)return void(qi=!1);const a=e?.detail||{};((e=1,t={})=>{if(!Zi||!ji)return;const a=b();if(!1===a?.sceneImpactEnabled)return;const o=Math.max(0,Math.min(1,+e||0)),n=++Yi;ya(),ji.classList.add("abs-scene--animating"),t?.armManual&&(qi=!0);const i=a?.sceneImpactPressMs??75,r=a?.sceneImpactReleaseMs??220,l=Math.max(1,Math.round(.8*(+i||0))),s=Math.max(1,Math.round(1.2*(+r||0))),c=Math.round(Math.min(80,Math.max(0,.4*(+l||0))));ji.style.setProperty(Gi,Math.round(l)+"ms"),window.requestAnimationFrame(()=>{Zi&&ji&&n===Yi&&(ji.style.setProperty(_i,o+""),ji.style.setProperty(Hi,ba(o,a)+""))}),Xi=window.setTimeout(()=>{wa({token:n,releaseMs:s})},Math.max(0,Math.round(l)+c)),Ui=window.setTimeout(()=>{Ui=0,ji&&ji.classList.remove("abs-scene--animating")},Math.max(0,Math.round(l)+c+Math.round(s)+80))})(a.prevMode&&a.mode&&a.prevMode!==a.mode?1:.75,{armManual:!1})},{passive:!0})}})(),console.log("⚠️ localStorage is disabled - using defaults"),U(),Q();try{(e=>{const t=e&&"object"==typeof e?e:null;if(!t)return;if("string"==typeof t.soundPreset&&ce(t.soundPreset),t.soundConfig&&"object"==typeof t.soundConfig)return void se(t.soundConfig);const a={};let o=!1;for(const[n,i]of Object.entries(t))n in Io&&(a[n]=i,o=!0);o&&se(a)})(a)}catch(e){}"undefined"!=typeof window&&(Rr||(Rr=!0,window.addEventListener("bb:modeChanged",e=>{const t=b();if(!1===t?.sceneChangeSoundEnabled)return;const a=e?.detail||{};a.prevMode&&a.mode&&a.prevMode!==a.mode&&te(+(t?.sceneChangeSoundRadius??18),+(t?.sceneChangeSoundIntensity??.35),.5,null)},{passive:!0}))),ut("bb:ui"),pt("✓ UI initialized (panel stripped from production build)"),bt(),ut("bb:theme"),Ka(),Ei||(Ei=!0,window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName))return;const t=e.key.toLowerCase();if("/"===t||"Slash"===e.code)return e.preventDefault(),void aa();if("r"!==t)return"ArrowRight"===e.key?(e.preventDefault(),void oa(1)):"ArrowLeft"===e.key?(e.preventDefault(),void oa(-1)):void 0;e.preventDefault(),Ge();try{Xt(b().currentMode)}catch(e){}})),ca(a),(()=>{const t=document.getElementById("cv-gate-trigger"),a=document.getElementById("brand-logo"),o=document.getElementById("cv-gate"),n=document.getElementById("portfolio-gate"),i=document.getElementById("contact-gate"),r=Array.from(document.querySelectorAll(".cv-digit")),l=document.getElementById("page-flash"),s=document.getElementById("cv-gate-label");if(!t||!a||!o||0===r.length)return void console.warn("CV Gate: Missing required elements");const c=Ca("gates.common.backText","BACK"),d=Ca("gates.common.backAriaLabel","Back"),p=Ca("gates.cv.title","Bio/CV"),u=Ca("gates.cv.description","Because spam bots don't deserve nice things—and neither do recruiters who don't read portfolios. This keeps my inbox slightly more civilized.");s&&(s.innerHTML=`\n            <div class="gate-nav">\n                <button type="button" class="gate-back abs-icon-btn" data-gate-back aria-label="${d}">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>${c}</span>\n                </button>\n            </div>\n            <h2 class="gate-title">${p}</h2>\n            <p class="gate-description">${u}</p>\n        `);const h=l||(()=>{const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e})();let f=!1;const m=()=>o&&o.classList.contains("active")||n&&n.classList.contains("active")||i&&i.classList.contains("active"),g=e=>{e?.preventDefault?.();const t=m();n&&n.classList.contains("active")&&(n.classList.remove("active"),n.setAttribute("aria-hidden","true"),setTimeout(()=>{n.classList.add("hidden"),ra(n)},400)),i&&i.classList.contains("active")&&(i.classList.remove("active"),i.setAttribute("aria-hidden","true"),setTimeout(()=>{i.classList.add("hidden"),ra(i)},400)),f=!0,t||ua(),a.classList.add("fade-out-up"),ia(o),o.classList.remove("hidden"),o.setAttribute("aria-hidden","false"),o.classList.add("active"),r[0].focus()},b=(e=!1)=>{f=!1,r.forEach(e=>e.value=""),e?(o.style.transition="none",a.style.transition="none",o.classList.remove("active"),o.setAttribute("aria-hidden","true"),o.classList.add("hidden"),ra(o),a.classList.remove("fade-out-up"),m()||ha(),requestAnimationFrame(()=>{o.style.removeProperty("transition"),a.style.removeProperty("transition")})):(o.classList.remove("active"),o.setAttribute("aria-hidden","true"),a.classList.remove("fade-out-up"),setTimeout(()=>{f||(o.classList.add("hidden"),ra(o)),m()||ha()},400))};try{const e=s?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",b)}catch(e){}o.addEventListener("click",e=>{(e.target===o||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&b(!0)});const y=()=>{const e=r.map(e=>e.value).join("");4===e.length&&("1111"===e?(Pa(h,"success"),setTimeout(()=>{window.location.href="cv.html"},500)):(Pa(h,"error"),setTimeout(()=>{r.forEach(e=>e.value=""),r[0].focus()},350)))};t.addEventListener("click",g);try{sessionStorage.getItem("abs_open_cv_gate")&&(sessionStorage.removeItem("abs_open_cv_gate"),setTimeout(()=>g(),300))}catch(e){}document.addEventListener("keydown",e=>{"Escape"===e.key&&f&&b()}),document.addEventListener("gate-overlay-dismiss",e=>{f&&b(e.detail?.instant||!1)}),r.forEach((e,t)=>{e.addEventListener("keydown",a=>{"Backspace"===a.key&&""===e.value&&(t>0?r[t-1].focus():b())}),e.addEventListener("input",e=>{const a=e.target.value;if(/^\d*$/.test(a)){if(1===a.length)r.length-1>t?r[t+1].focus():y();else if(a.length>1){const o=a.split("");e.target.value=o[0];let n=t+1;for(let e=1;o.length>e&&r.length>n;e++)r[n].value=o[e],n++;r.length>n?r[n].focus():y()}}else e.target.value=a.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})})(),(()=>{const t=document.getElementById("portfolio-gate-trigger"),a=document.getElementById("portfolio-gate"),o=document.getElementById("brand-logo"),n=document.getElementById("cv-gate"),i=document.getElementById("contact-gate"),r=Array.from(document.querySelectorAll(".portfolio-digit")),l=document.getElementById("page-flash"),s=document.getElementById("portfolio-gate-label");if(!t||!a||0===r.length)return void console.warn("Portfolio Gate: Missing required elements");const c=Ca("gates.common.backText","BACK"),d=Ca("gates.common.backAriaLabel","Back"),p=Ca("gates.portfolio.title","View Portfolio"),u=Ca("gates.portfolio.description","Good work deserves good context. This small step ensures you're here with intention, not just browsing. Quality takes time—yours and mine.");s&&(s.innerHTML=`\n            <div class="gate-nav">\n                <button type="button" class="gate-back abs-icon-btn" data-gate-back aria-label="${d}">\n                    <i class="ti ti-arrow-left" aria-hidden="true"></i>\n                    <span>${c}</span>\n                </button>\n            </div>\n            <h2 class="gate-title">${p}</h2>\n            <p class="gate-description">${u}</p>\n        `);const h=l||(()=>{const e=document.createElement("div");return e.id="page-flash",e.className="page-flash",e.setAttribute("aria-hidden","true"),document.body.appendChild(e),e})();let f=!1;const m=()=>a&&a.classList.contains("active")||n&&n.classList.contains("active")||i&&i.classList.contains("active"),g=e=>{e&&e.preventDefault();const t=m(),l=(()=>{try{const e=window.PORTFOLIO_BASE||"";return e&&!e.endsWith("/")?e+"/":e}catch(e){return""}})(),s=document.createElement("link");s.rel="prefetch",s.href=l+"js/portfolio-bundle.js",document.head.appendChild(s);const c=document.createElement("link");c.rel="preload",c.as="image",c.href=l+"images/portfolio/pages/chapter-0-1.webp",document.head.appendChild(c),n&&n.classList.contains("active")&&(n.classList.remove("active"),n.setAttribute("aria-hidden","true"),setTimeout(()=>{n.classList.add("hidden"),ra(n)},400)),i&&i.classList.contains("active")&&(i.classList.remove("active"),i.setAttribute("aria-hidden","true"),setTimeout(()=>{i.classList.add("hidden"),ra(i)},400)),f=!0,t||ua(),o&&o.classList.add("fade-out-up"),ia(a),a.classList.remove("hidden"),a.setAttribute("aria-hidden","false"),a.classList.add("active"),r[0].focus()},b=(e=!1)=>{f=!1,r.forEach(e=>e.value=""),e?(a.style.transition="none",o&&(o.style.transition="none"),a.classList.remove("active"),a.setAttribute("aria-hidden","true"),a.classList.add("hidden"),ra(a),o&&o.classList.remove("fade-out-up"),m()||ha(),requestAnimationFrame(()=>{a.style.removeProperty("transition"),o&&o.style.removeProperty("transition")})):(a.classList.remove("active"),a.setAttribute("aria-hidden","true"),o&&o.classList.remove("fade-out-up"),setTimeout(()=>{f||(a.classList.add("hidden"),ra(a)),m()||ha()},400))};try{const e=s?.querySelector?.("[data-gate-back]");e&&e.addEventListener("click",b)}catch(e){}a.addEventListener("click",e=>{(e.target===a||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&b(!0)});const y=()=>{const e=r.map(e=>e.value).join("");4===e.length&&("1234"===e?(Fa(h,"success"),sessionStorage.setItem("abs_portfolio_ok",Date.now()),setTimeout(()=>{window.location.href="portfolio.html"},500)):(Fa(h,"error"),setTimeout(()=>{r.forEach(e=>e.value=""),r[0].focus()},350)))};sessionStorage.getItem("abs_open_portfolio_gate")&&(sessionStorage.removeItem("abs_open_portfolio_gate"),setTimeout(()=>g(),300)),t.addEventListener("click",g),document.addEventListener("keydown",e=>{"Escape"===e.key&&f&&b()}),document.addEventListener("gate-overlay-dismiss",e=>{f&&b(e.detail?.instant||!1)}),r.forEach((e,t)=>{e.addEventListener("keydown",a=>{"Backspace"===a.key&&""===e.value&&(t>0?r[t-1].focus():b())}),e.addEventListener("input",e=>{const a=e.target.value;if(/^\d*$/.test(a)){if(1===a.length)r.length-1>t?r[t+1].focus():y();else if(a.length>1){const o=a.split("");e.target.value=o[0];let n=t+1;for(let e=1;o.length>e&&r.length>n;e++)r[n].value=o[e],n++;r.length>n?r[n].focus():y()}}else e.target.value=a.replace(/\D/g,"")}),e.addEventListener("focus",()=>{e.select()})})})(),(()=>{const t=Ca("contact.email","alexander@beck.fyi"),a=Ca("gates.common.backText","BACK"),o=Ca("gates.common.backAriaLabel","Back"),n=Ca("gates.contact.title","Contact"),i=Ca("gates.contact.description","For collaborations, product design work, AI prototyping, or anything that needs a crisp creative + technical brain."),r=Ca("contact.copy.buttonAriaLabel","Copy email address"),l=Ca("contact.copy.statusCopied","Copied"),s=Ca("contact.copy.statusError","Copy failed"),c=[document.getElementById("contact-email"),document.getElementById("contact-email-inline")].filter(Boolean),d=document.getElementById("brand-logo"),p=document.getElementById("contact-gate"),u=document.getElementById("contact-gate-label"),h=document.getElementById("contact-gate-inputs"),f=document.getElementById("cv-gate"),m=document.getElementById("portfolio-gate");if(!(c.length&&d&&p&&u&&h))return void console.warn("Contact Gate: Missing required elements");u.innerHTML=`\n    <div class="gate-nav">\n      <button type="button" class="gate-back abs-icon-btn" data-gate-back aria-label="${o}">\n        <i class="ti ti-arrow-left" aria-hidden="true"></i>\n        <span>${a}</span>\n      </button>\n    </div>\n    <h2 class="gate-title">${n}</h2>\n    <p class="gate-description">\n      ${i}\n    </p>\n  `,h.innerHTML=`\n    <div class="contact-email-row" data-email-row>\n      <button type="button" class="contact-email-value" data-copy-email aria-label="${r}">\n        <span class="contact-email-text">${t}</span>\n      </button>\n      <button type="button" class="contact-email-copy abs-icon-btn" data-copy-email-icon aria-label="${r}">\n        <i class="ti ti-copy" aria-hidden="true"></i>\n      </button>\n    </div>\n    <div class="contact-copy-status" data-copy-status aria-live="polite"></div>\n  `;const g=u.querySelector("[data-gate-back]"),b=h.querySelector("[data-copy-email]"),y=h.querySelector("[data-copy-email-icon]"),M=h.querySelector("[data-email-row]"),v=h.querySelector("[data-copy-status]"),w=h.querySelector(".contact-email-copy i");let x=!1,S=null;const k=()=>p&&p.classList.contains("active")||f&&f.classList.contains("active")||m&&m.classList.contains("active"),C=e=>{if(b&&y&&v){if(S&&window.clearTimeout(S),"copied"===e)return M?.classList?.add?.("is-copied"),M?.classList?.remove?.("is-error"),v.textContent=l,w&&(w.className="ti ti-check"),void(S=window.setTimeout(()=>C("idle"),1200));if("error"===e)return M?.classList?.add?.("is-error"),M?.classList?.remove?.("is-copied"),v.textContent=s,w&&(w.className="ti ti-alert-triangle"),void(S=window.setTimeout(()=>C("idle"),1200));M?.classList?.remove?.("is-copied","is-error"),v.textContent="",w&&(w.className="ti ti-copy")}},P=e=>{e?.preventDefault?.();const t=k();f&&f.classList.contains("active")&&(f.classList.remove("active"),f.setAttribute("aria-hidden","true"),setTimeout(()=>{f.classList.add("hidden"),ra(f)},400)),m&&m.classList.contains("active")&&(m.classList.remove("active"),m.setAttribute("aria-hidden","true"),setTimeout(()=>{m.classList.add("hidden"),ra(m)},400)),x=!0,t||ua(),C("idle"),d.classList.add("fade-out-up"),ia(p),p.classList.remove("hidden"),p.setAttribute("aria-hidden","false"),p.classList.add("active"),b?.focus?.()},F=(e=!1)=>{x=!1,C("idle"),e?(p.style.transition="none",d.style.transition="none",p.classList.remove("active"),p.setAttribute("aria-hidden","true"),p.classList.add("hidden"),ra(p),d.classList.remove("fade-out-up"),k()||ha(),requestAnimationFrame(()=>{p.style.removeProperty("transition"),d.style.removeProperty("transition")})):(p.classList.remove("active"),p.setAttribute("aria-hidden","true"),d.classList.remove("fade-out-up"),setTimeout(()=>{x||(p.classList.add("hidden"),ra(p)),k()||ha()},400))};c.forEach(e=>e.addEventListener("click",P,{capture:!0})),g?.addEventListener("click",F),p.addEventListener("click",e=>{(e.target===p||e.target.classList.contains("gate-label")||e.target.classList.contains("gate-description")||"H2"===e.target.tagName||"P"===e.target.tagName)&&F(!0)});const T=async()=>{const a=await(async t=>{try{if(navigator?.clipboard?.writeText)return await navigator.clipboard.writeText(t),!0}catch(e){}try{const e=document.createElement("textarea");e.value=t,e.setAttribute("readonly","true"),e.style.position="fixed",e.style.left="-9999px",e.style.top="0",document.body.appendChild(e),e.select();const a=!0===document.execCommand?.("copy");return document.body.removeChild(e),a}catch(e){return!1}})(t);C(a?"copied":"error")};b?.addEventListener("click",T),y?.addEventListener("click",T),document.addEventListener("keydown",e=>{"Escape"===e.key&&x&&F()}),document.addEventListener("gate-overlay-dismiss",e=>{x&&F(e.detail?.instant||!1)});try{sessionStorage.getItem("abs_open_contact_gate")&&(sessionStorage.removeItem("abs_open_contact_gate"),requestAnimationFrame(()=>P()))}catch(e){}})(),(()=>{const e=document.getElementById("social-links");if(!e)return;if(e.querySelector("i.ti"))return;const t=Array.from(e.querySelectorAll("a.footer_icon-link[aria-label]"));for(const a of t){const e=(a.getAttribute("aria-label")||"").trim().toLowerCase(),t=Sr.get(e);if(!t)continue;const o=a.querySelector("svg");o?(a.insertAdjacentHTML("afterbegin",t),o.remove()):a.insertAdjacentHTML("afterbegin",t)}})(),(()=>{function e(){t.textContent=o.format(new Date).toUpperCase()}const t=document.getElementById("time-display"),a=document.getElementById("site-year");if(!t)return;const o=new Intl.DateTimeFormat("en-GB",{timeZone:"Europe/London",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});e(),setInterval(e,1e3),a&&a.addEventListener("click",yt)})(),(()=>{try{const e=document.getElementById("cv-gate-trigger");if(e&&!e.querySelector(".footer-link-nowrap")){const t=(e.textContent||"").trim().replace(/\s+/g," ");t&&t.includes("/")&&(e.innerHTML=`<span class="footer-link-nowrap">${t}</span>`)}}catch(e){}})(),(()=>{if(Q(),"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return console.log("⏸ Sound toggle hidden (prefers-reduced-motion)"),null;xr=document.createElement("button"),xr.className="sound-toggle abs-icon-btn",xr.id="sound-toggle",xr.type="button",xr.setAttribute("aria-label","Toggle collision sounds"),xr.setAttribute("aria-pressed","false"),xr.setAttribute("data-enabled","false"),xr.innerHTML=wr,xr.title="Sound off",xr.addEventListener("click",Ta);const t=document.getElementById("fade-content"),a=document.getElementById("sound-toggle-slot"),o=document.getElementById("top-elements-soundRow"),n=document.getElementById("social-links"),i=document.querySelector(".ui-meta-right"),r=!!a,l=n&&(!t||t.contains(n)),s="undefined"!=typeof window&&"function"==typeof window.matchMedia&&window.matchMedia("(max-width: 600px)").matches,c=t=>{if(!t)return!1;try{xr.parentElement&&xr.parentElement!==t&&xr.parentElement.removeChild(xr)}catch(e){}if(t.classList.contains("ui-meta-right")){const e=t.querySelector("time");if(e)return t.insertBefore(xr,e),!0}return t.appendChild(xr),!0};if(s&&o)xr.classList.add("sound-toggle--top"),xr.classList.add("sound-toggle--topwide"),c(o);else if(r)xr.classList.add("sound-toggle--top"),c(a);else if(i)c(i);else if(l){const e=document.createElement("li");e.className="margin-bottom_none sound-toggle-item",xr.classList.add("sound-toggle--social"),e.appendChild(xr),n.appendChild(e)}else t?t.appendChild(xr):document.body.appendChild(xr);try{if("undefined"!=typeof window&&"function"==typeof window.matchMedia){const e=window.matchMedia("(max-width: 600px)"),t=()=>{const t=document.getElementById("top-elements-soundRow"),a=document.getElementById("sound-toggle-slot"),o=e.matches&&!!t;xr.classList.toggle("sound-toggle--topwide",o),o?c(t):a&&c(a)};"function"==typeof e.addEventListener?e.addEventListener("change",t):"function"==typeof e.addListener&&e.addListener(t)}}catch(e){}console.log("✓ Sound toggle created");try{const e=re();Ia(!(!e.isUnlocked||!e.isEnabled))}catch(e){}"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(_o,e=>{const t=e&&e.detail?e.detail:null;t&&Ia(!(!t.isUnlocked||!t.isEnabled))})})();try{await(async({timeoutMs:e=4e3,fontFaces:t=Br}={})=>{const a=document.documentElement;if(a&&a.classList.add("fonts-loading"),!document.fonts||!document.fonts.ready)return a&&a.classList.remove("fonts-loading"),!1;let o;const n=new Promise(t=>{o=window.setTimeout(()=>t(!1),e)}),i=Promise.all(t.map(e=>document.fonts.load(e).catch(()=>null))).then(()=>document.fonts.ready).then(()=>!0).catch(()=>!1),r=await Promise.race([i,n]);return o&&window.clearTimeout(o),a&&a.classList.remove("fonts-loading"),r})()}catch(e){}(()=>{const e=t("--ease-fade","cubic-bezier(0.16, 1, 0.3, 1)"),a=(e,t)=>{e.style.opacity="1",e.style.transform="translateZ(0)",console.warn(`⚠️ Fade failsafe: forcing #fade-content visible (${t})`)};window.setTimeout(()=>{const t=document.getElementById("fade-content");if(!t)return void console.warn("⚠️ #fade-content not found (fade skipped)");if(window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches)return t.style.opacity="1",void(t.style.transform="translateZ(0)");if("function"!=typeof t.animate)return void a(t,"WAAPI unsupported");const o=t.animate([{opacity:0},{opacity:1}],{duration:260,easing:e,fill:"forwards"});o?.addEventListener?.("finish",()=>{t.style.opacity="1",t.style.transform="translateZ(0)"}),o?.addEventListener?.("cancel",()=>{a(t,"animation canceled")}),window.setTimeout(()=>{"0"===window.getComputedStyle(t).opacity&&a(t,"opacity still 0 after failsafe window")},1410)},400)})();const o=io.PIT;_e(o),(()=>{function e(t){if(!mr)return void(gr=null);const a=t-fr;if(br>a)return void(gr=requestAnimationFrame(e));fr=t-a%br,(e=>{if(yr.push(e),yr.length>30&&yr.shift(),30===yr.length){const e=1e3/(yr.reduce((e,t)=>e+t,0)/30);30>e&&2>Mr?(Mr++,console.log(`⚡ Adaptive throttle increased to level ${Mr} (avg FPS: ${e.toFixed(1)})`)):e>55&&Mr>0&&(Mr--,console.log(`⚡ Adaptive throttle decreased to level ${Mr} (avg FPS: ${e.toFixed(1)})`))}})(a);const o=t/1e3;let n=Math.min(.033,o-hr);hr=o,(2>Mr||Math.random()>.5)&&nt(n,void 0),it(),(e=>{if(pr++,e-dr>1e3){ur=pr,pr=0,dr=e;const t=document.getElementById("render-fps");t&&(t.textContent=ur+"")}})(performance.now()),gr=requestAnimationFrame(e)}document.addEventListener("visibilitychange",()=>{mr=!document.hidden,mr?(hr=performance.now()/1e3,fr=performance.now(),console.log("▶️ Animation resumed"),gr||(gr=requestAnimationFrame(e))):(console.log("⏸️ Animation paused (tab hidden)"),gr&&(cancelAnimationFrame(gr),gr=null))}),gr=requestAnimationFrame(e),console.log("✓ Render loop started (60fps throttle, visibility-aware)")})(),(({sentence:e="Curious mind detected. Design meets engineering at 60fps.",ascii:t=["██████  ███████  ██████ ██   ██","██   ██ ██      ██      ██  ██ ","██████  █████   ██      █████  ","██   ██ ██      ██      ██  ██ ","██████  ███████  ██████ ██   ██"]}={})=>{lt()||ct({sentence:e,ascii:t,silence:!0})})();try{ct(t("--panel-brand","#f59e0b"))}catch(e){}(t=>{if(!lt())return null;try{performance.measure(t,"bb:start","bb:theme");const e=performance.getEntriesByName(t),a=e&&e.length?e[e.length-1]:null;return a?a.duration:null}catch(e){return null}})("bb:total"),dt();try{(t=>{if(lt())try{Yn.table(t)}catch(e){}})([{mode:o,panel:"removed"}])}catch(e){}}catch(e){try{dt()}catch(a){}console.error(e)}})();var Vr=Object.freeze({__proto__:null,applyPerspectiveCSS(){const e=(()=>{const e=b();switch(no()){case"landscape":return e.entrancePerspectiveLandscape||1200;case"portrait":return e.entrancePerspectivePortrait||800;default:return e.entrancePerspectiveSquare||1e3}})();document.documentElement.style.setProperty("--entrance-perspective",e+"px")},detectAspectRatioCategory:no});e.applyFramePaddingCSSVars=oo,e.applyVisualCSSVars=e=>{const t=document.documentElement;void 0!==e.topLogoWidthVw&&t.style.setProperty("--top-logo-width-vw",e.topLogoWidthVw+""),void 0!==e.noiseSizeBase&&t.style.setProperty("--noise-size-base",e.noiseSizeBase+"px"),void 0!==e.noiseSizeTop&&t.style.setProperty("--noise-size-top",e.noiseSizeTop+"px"),void 0!==e.noiseBackOpacity&&(t.style.setProperty("--noise-back-opacity",e.noiseBackOpacity+""),t.style.setProperty("--noise-back-opacity-light",e.noiseBackOpacity+"")),void 0!==e.noiseFrontOpacity&&(t.style.setProperty("--noise-front-opacity",e.noiseFrontOpacity+""),t.style.setProperty("--noise-front-opacity-light",e.noiseFrontOpacity+"")),void 0!==e.noiseBackOpacityDark&&t.style.setProperty("--noise-back-opacity-dark",e.noiseBackOpacityDark+""),void 0!==e.noiseFrontOpacityDark&&t.style.setProperty("--noise-front-opacity-dark",e.noiseFrontOpacityDark+"")}})({});