// Bouncy Balls Simulation - Minified with Terser
(()=>{function t(){return 0===q?0:xt*(q/40)}function e(){if(!ot)return void(Et.style.filter="none");const t=(t,e)=>`rgba(${parseInt(t.slice(1,3),16)}, ${parseInt(t.slice(3,5),16)}, ${parseInt(t.slice(5,7),16)}, ${e})`,e=`drop-shadow(${at}px ${it}px ${st}px ${t(rt,lt)})`,n=dt?` drop-shadow(${at}px ${Math.round(.5*it)}px ${ht}px ${t(rt,ut)})`:"";Et.style.filter=e+n}function n(t){Lt=t,t?It.classList.add("dark-mode"):It.classList.remove("dark-mode"),r(ae),function(){const t=document.getElementById("darkModeToggle"),e=document.getElementById("darkModeStatus");if(t&&(t.checked=Ct),e){const t=new Date,n=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`;Lt?(e.textContent=`🌙 Night Mode (${n})`,e.style.background="rgba(100,100,255,0.3)"):(e.textContent=`☀️ Day Mode (${n})`,e.style.background="rgba(255,200,0,0.3)")}}()}function o(){Ct&&n(function(){const t=new Date,e=t.getHours(),n=e>=18||e<6;return console.log(`🌍 Time check: ${e}:${t.getMinutes().toString().padStart(2,"0")} → ${n?"Night":"Day"} (sunset: 18, sunrise: 6)`),n}())}function a(){const t=A===MODES.PIT?ct:mt,e=window.innerHeight*t;if(Et.width=Math.floor(window.innerWidth*Bt),Et.height=Math.floor(e*Bt),A===MODES.PULSE_GRID){M();for(let t=0;t<Ve.length;t++){const e=Ve[t];e.gridX=Math.max(0,Math.min(zo-1,e.gridX)),e.gridY=Math.max(0,Math.min(Go-1,e.gridY));const n=B(e.gridX,e.gridY);e.x=n.x,e.y=n.y,e.targetX=n.x,e.targetY=n.y}}}function i(){Jt=Math.max(.5,Math.min(3,Math.pow(_t/1,.35)))}function s(){$t=(Et.clientWidth||window.innerWidth)<=768?.4:1;const t=Ht*$t;if(null===jt)return jt=t,Qt=Yt*t,void(Kt=Xt*t);const e=t/jt;if(1!==e){for(let t=0;t<Ve.length;t++)Ve[t].r*=e;jt=t}Qt=Yt*t,Kt=Xt*t}function l(){Ee=[];const t=document.querySelector(xe);if(!t)return;const e=t.getBoundingClientRect(),n=Et.getBoundingClientRect(),o=function(t){const e=document.createElement("span");e.style.cssText=window.getComputedStyle(t).cssText,e.style.position="absolute",e.style.visibility="hidden",e.style.whiteSpace="nowrap",e.textContent="ABCDEFGHIJKLMNOPQRSTUVWXYZ",document.body.appendChild(e);const n=e.getBoundingClientRect().height;return document.body.removeChild(e),n}(t),a=.5*(e.height-o),i={x:(e.left-n.left)*Bt,y:(e.top-n.top+a)*Bt,width:e.width*Bt,height:o*Bt};i.width>0&&i.height>0&&i.x<Et.width&&i.y<Et.height&&i.x+i.width>0&&i.y+i.height>0&&Ee.push(i)}function r(t){ae=t,ie=function(t){const e=oe[t];return e?Lt?e.dark:e.light:oe.industrialTeal.light}(t),le=ie[se]||le,C(),d(),L()}function d(t=ie){try{const e=document.documentElement,n=(t&&t.length?t:ie).slice(0,8);for(let t=0;t<8;t++){const o=n[t]||"#ffffff";e.style.setProperty(`--ball-${t+1}`,o)}}catch(t){}}function h(){try{if(!ie||0===ie.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let e=0;for(let n=0;n<Math.min(ie.length,re.length);n++)if(e+=re[n],t<=e)return ie[n];return ie[Math.min(ie.length-1,7)]}catch(t){return console.error("Error picking random color:",t),"#ffffff"}}function u(){const t={currentMode:A,gravityMultiplierPit:G,repellerEnabledPit:z,attractionPower:O,orbitRadius:k,swarmSpeed:N,weightlessInitialSpeed:D,weightlessBounce:Y,weightlessCount:U,weightlessRepellerPower:X,weightlessRepellerRadius:H,restitution:Ot,friction:kt,sizeScale:Ht,sizeVariation:Wt,ballMassKg:_t,ballSoftness:q,repelPower:he,repelRadius:de,repelSoft:ue,cornerRadius:ve,motionBlur:trailFade,trailSubtlety:Se,currentTemplate:ae,cursorBallColor:le,gridColumns:W,gridBallCount:K,pulseInterval:$,pulseSpeed:j,pulseSynchronicity:_,pulseRandomness:Z,pulseMinSteps:J,pulseMaxSteps:Q,pulseEasingStyle:et,pulseOvershoot:nt,pulseBounceIntensity:tt,canvasShadowEnabled:ot,shadowOffsetX:at,shadowOffsetY:it,shadowBlur:st,shadowOpacity:lt,shadowColor:rt,shadow2Enabled:dt,shadow2Blur:ht,shadow2Opacity:ut,autoDarkModeEnabled:Ct};try{localStorage.setItem(ye,JSON.stringify(t)),console.log("✓ Settings saved")}catch(t){console.warn("Could not save settings:",t)}}function c(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(u,500)}function m(t,e,n){return Math.max(e,Math.min(n,t))}function g(t,e){return t+Math.random()*(e-t)}function p(t,e,n=h()){const o=(Qt+Kt)/2;let a;if(0===Wt)a=o;else{const t=.1*o;a=g(Math.max(1,o-t),o+t)}const i=new Ball(t,e,a,n),s=.5*Et.width,l=te?ne>=0?1:-1:t<s?1:-1,r=m(a/(.5*(Qt+Kt)),.6,1.4),d=140*r,u=180*r;return i.vx=l*(d+Math.random()*u),i.vy=120*-Math.random(),i.driftAx=l*(360+420*Math.random())*r,i.driftTime=.22+.28*Math.random(),Ve.push(i),i}function y(){const t=Et.clientWidth,e=Et.clientHeight,n=m(Rt/100*t,0,t);let o=m(Pt/100*t,0,t);if(te){const e=.2*t,n=o;o=m(o+Math.sin(ee)*e,0,t),ne=o>=n?1:-1}const a=Math.min(40,.1*n),i=m(o-n/2-a,-a,t),s=m(o+n/2+a,-a,t),l=Vt/100*e,r=l+At/100*e,d=Math.random();return{x:(i+(s-i)*(ne>0?Math.pow(d,.7):1-Math.pow(1-d,.7)))*Bt,y:g(l*Bt,r*Bt)-(Kt+ft+g(0,10*Bt))}}function f(e=6){const n=function(){const t=Ve.length;if(t<2)return[];const e=Math.max(1,2*Kt),n=Math.ceil(Et.width/e)+1;Ae.clear();for(let o=0;o<t;o++){const t=Ve[o],a=t.x/e|0,i=(t.y/e|0)*n+a;let s=Ae.get(i);s||(s=[],Ae.set(i,s)),s.push(o)}const o=[];for(const[t,e]of Ae){const a=t/n|0,i=t%n;for(let t=-1;t<=1;t++)for(let s=-1;s<=1;s++){const l=(a+t)*n+(i+s),r=Ae.get(l);if(r)for(let t=0;t<e.length;t++){const n=e[t];for(let t=0;t<r.length;t++){const e=r[t];if(e<=n)continue;const a=Ve[n],i=Ve[e],s=i.x-a.x,l=i.y-a.y,d=a.r+i.r,h=s*s+l*l;if(h<d*d){const t=d-Math.sqrt(Math.max(h,pt));o.push({i:n,j:e,overlap:t})}}}}}return o.sort((t,e)=>e.overlap-t.overlap),o}();for(let o=0;o<e;o++)for(let e=0;e<n.length;e++){const{i:o,j:a}=n[e],i=Ve[o],s=Ve[a],l=s.x-i.x,r=s.y-i.y,d=i.r+s.r,h=l*l+r*r;if(0===h||h>d*d)continue;const u=Math.sqrt(h),c=l/u,m=r/u,g=d-u,p=1/Math.max(i.m,.001),y=1/Math.max(s.m,.001),f=.8*Math.max(g-Dt,0)/(p+y),v=f*c,x=f*m;i.x-=v*p,i.y-=x*p,s.x+=v*y,s.y+=x*y;const E=s.vx-i.vx,I=s.vy-i.vy,S=E*c+I*m;if(S<0){const e=-(1+(Math.abs(S)<30?0:Ot))*S/(p+y),n=e*c,o=e*m;i.vx-=n*p,i.vy-=o*p,s.vx+=n*y,s.vy+=o*y;const a=E-S*c,l=I-S*m,r=Math.hypot(a,l);if(r>.001){const t=a*-m+l*c>=0?1:-1,e=vt;i.omega-=t*e*r/Math.max(i.r,1),s.omega+=t*e*r/Math.max(s.r,1)}const d=Math.min(1,Math.abs(S)/(50*(i.r+s.r))),h=Math.min(t(),.8*d);i.squashAmount=Math.max(i.squashAmount,.8*h),i.squashNormalAngle=Math.atan2(-m,-c),s.squashAmount=Math.max(s.squashAmount,.8*h),s.squashNormalAngle=Math.atan2(m,c)}}}function v(){const t=parseFloat(We.value);Ht=t,s();const e=(Qt+Kt)/2;for(let t=0;t<Ve.length;t++)if(0===Wt)Ve[t].r=e,Ve[t].rBase=e;else{const n=.1*e,o=Math.max(1,e-n),a=e+n;Ve[t].r=g(o,a),Ve[t].rBase=Ve[t].r}}function x(){return{gravityMultiplier:Gt,restitution:Ot,friction:kt,ballMass:_t,emitRate:Nt,maxBalls:Ut,ballScale:Ht,ballVariation:Wt,spawnX:Pt,spawnY:Vt,spawnWidth:Rt,spawnHeight:At,sweepEnabled:te,repelRadius:de,repelPower:he,repelSoftness:ue,trailFade:Ie,trailSubtlety:Se,colors:ie.slice(),colorWeights:re.slice(),currentTemplate:ae,cursorColorIndex:se,performanceMode:bt,targetFPS:wt,enableLOD:!0}}function E(t,e){t&&t.addEventListener("click",async()=>{const n="function"==typeof e?e():String(e||"").trim();try{await navigator.clipboard.writeText(n);const e=t.textContent;t.textContent="COPIED",t.style.color="#3ddc84",setTimeout(()=>{t.textContent=e,t.style.color="#888"},900)}catch(t){console.warn("Clipboard unavailable")}})}function I(){const t=(Qt+Kt)/2;for(let e=0;e<Ve.length;e++){const n=Ve[e];if(0===Wt)n.r=t;else{const e=.1*t,o=Math.max(1,t-e),a=t+e;n.r=g(o,a)}n.m=_t}}function S(){Ve.length=0;const t=U,e=Et.width,n=Et.height,o=40*Bt;for(let a=0;a<t;a++){const t=p(o+Math.random()*(e-2*o),o+Math.random()*(n-2*o)),a=Math.random()*Math.PI*2,i=D*(.7+.3*Math.random());t.vx=Math.cos(a)*i,t.vy=Math.sin(a)*i,t.driftAx=0,t.driftTime=0}}function M(){const t=Et.width,e=Et.height;zo=W,qo=t/zo,Go=Math.floor(e/qo),Oo=(t-zo*qo)/2,ko=(e-Go*qo)/2}function B(t,e){return{x:Oo+(t+.5)*qo,y:ko+(e+.5)*qo}}function b(){Ve.length=0,M();const t=zo*Go,e=Math.min(K,t),n=[];for(let t=0;t<Go;t++)for(let e=0;e<zo;e++)n.push({gridX:e,gridY:t});for(let t=n.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[n[t],n[e]]=[n[e],n[t]]}for(let t=0;t<e;t++){const e=n[t],o=B(e.gridX,e.gridY),a=p(o.x,o.y);a.gridX=e.gridX,a.gridY=e.gridY,a.targetX=o.x,a.targetY=o.y,a.jumpProgress=1,a.vx=0,a.vy=0,a.driftAx=0,a.driftTime=0;const i=$,s=_*Math.random()*i;a.nextJumpTime=i+s}}function w(t){A=t,function(t){const e=document.getElementById("announcer");e&&(e.textContent="",setTimeout(()=>e.textContent=t,100))}(`Switched to ${{[MODES.PIT]:"Ball Pit",[MODES.FLIES]:"Flies to Light",[MODES.WEIGHTLESS]:"Zero Gravity",[MODES.PULSE_GRID]:"Pulse Grid"}[t]} mode`),It.className="",A===MODES.PIT&&It.classList.add("mode-pit"),a(),A===MODES.PIT?(Gt=G,zt=qt*Gt,ge=z&&he>0&&de>0,te=!0,Ve.length=0,Re=0,v()):A===MODES.FLIES?(Gt=0,zt=qt*Gt,ge=!1,te=!1,function(){Ve.length=0;const t=.5*Et.width,e=.5*Et.height,n=150*Bt;for(let o=0;o<60;o++){const o=Math.random()*Math.PI*2,a=Math.random()*n,i=p(t+Math.cos(o)*a,e+Math.sin(o)*a),s=.5+.5*Math.random(),l=Math.random()*Math.PI*2,r=300*s;i.vx=Math.cos(l)*r,i.vy=Math.sin(l)*r,i.driftAx=0,i.driftTime=0}}(),v()):A===MODES.WEIGHTLESS?(Gt=0,zt=qt*Gt,ge=!1,te=!1,S(),v()):A===MODES.PULSE_GRID&&(Gt=0,zt=qt*Gt,ge=!1,te=!1,b(),v()),function(){const t=document.getElementById("pulseGridControls");mo&&mo.classList.toggle("active",A===MODES.PIT),go&&go.classList.toggle("active",A===MODES.FLIES),po&&po.classList.toggle("active",A===MODES.WEIGHTLESS),t&&t.classList.toggle("active",A===MODES.PULSE_GRID),co.forEach(t=>{const e=t.getAttribute("data-mode")===A;t.classList.toggle("active",e),t.setAttribute("aria-pressed",e?"true":"false")})}()}function C(){for(let t=0;t<Ve.length;t++)Ve[t].color=h()}function L(){const t=document.getElementById("color1"),e=document.getElementById("color2"),n=document.getElementById("color3"),o=document.getElementById("color4"),a=document.getElementById("color5"),i=document.getElementById("color6"),s=document.getElementById("color7"),l=document.getElementById("color8"),r=document.getElementById("color1Val"),d=document.getElementById("color2Val"),h=document.getElementById("color3Val"),u=document.getElementById("color4Val"),c=document.getElementById("color5Val"),m=document.getElementById("color6Val"),g=document.getElementById("color7Val"),p=document.getElementById("color8Val");t&&r&&(t.value=ie[0],r.textContent=ie[0].toUpperCase()),e&&d&&(e.value=ie[1],d.textContent=ie[1].toUpperCase()),n&&h&&(n.value=ie[2],h.textContent=ie[2].toUpperCase()),o&&u&&(o.value=ie[3],u.textContent=ie[3].toUpperCase()),a&&c&&(a.value=ie[4],c.textContent=ie[4].toUpperCase()),i&&m&&(i.value=ie[5],m.textContent=ie[5].toUpperCase()),s&&g&&(s.value=ie[6],g.textContent=ie[6].toUpperCase()),l&&p&&(l.value=ie[7],p.textContent=ie[7].toUpperCase())}function T(t,e,n){t.innerHTML="";for(const[o,a]of Object.entries(e)){const e=document.createElement("option");e.value=o,e.textContent=a.label||o,o===n&&(e.selected=!0),t.appendChild(e)}}function F(t,e,n,o=0){t&&(t.value=String(n)),e&&(e.textContent=o>0?n.toFixed(o):n.toString())}function P(t){const e=da[t];if(!e)return;Ot=e.REST,kt=e.FRICTION,Ut=e.maxBalls,Wt=e.sizeVariation;const n=e.sizeScale;Ht=n,s();for(let t=0;t<Ve.length;t++)Ve[t].m=_t;Ve.length>Ut&&(Ve.length=Ut),F(Ye,Pn,Ot,2),F(Xe,Vn,kt,4),F(We,_e,Ht,1),F(Qe,An,Ut,0),F($e,Ze,Wt,1),I()}function V(t){const e=ha[t];e&&(Nt=e.EMIT_INTERVAL,Pt=e.xCenter,Vt=e.y,Rt=e.w,At=e.h,F(He,Rn,Nt,3),F(en,zn,Pt,0),F(Ke,qn,Vt,0),F(tn,Gn,Rt,0),F(nn,On,At,0))}function R(t){const e=ua[t];if(!e)return;de=e.r,he=1*e.p,ge="off"!==t,F(on,kn,de,0);const n=function(t){const e=Math.max(1,Number(t))/24e3,n=.5+Math.log2(e)/12;return Math.round(Math.max(0,Math.min(1,n))*fe)}(he);an&&(an.value=String(n)),Nn&&(Nn.textContent=Math.round(he).toString()),F(sn,Un,ue,1)}const MODES={PIT:"pit",FLIES:"flies",WEIGHTLESS:"weightless",PULSE_GRID:"pulse-grid"};let A=MODES.PIT,q=40,G=1.15,z=!0,O=5e3,k=180,N=3.5,U=80,D=250,Y=.97,X=300,H=150,W=40,$=.8,j=.25,_=.3,Z=.4,J=1,Q=3,K=120,tt=.15,et="snap",nt=1.08,ot=!1,at=0,it=4,st=12,lt=.15,rt="#000000",dt=!1,ht=4,ut=.1;const ct=1.5,mt=1,gt=-1e9,pt=1e-6,yt=1e-4,ft=2,vt=.18,xt=.2,Et=document.getElementById("c"),It=document.getElementById("bravia-balls");let St;try{if(St=Et.getContext("2d",{alpha:!0}),!St)throw new Error("Canvas 2D context not available")}catch(pa){throw console.error("❌ Failed to initialize canvas:",pa),It.innerHTML='\n      <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #1a1a1a; color: white; font-family: system-ui, -apple-system, sans-serif;">\n        <div style="text-align: center; padding: 40px; background: rgba(255,50,50,0.1); border: 2px solid rgba(255,50,50,0.3); border-radius: 12px; max-width: 480px;">\n          <div style="font-size: 72px; margin-bottom: 20px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));">⚠️</div>\n          <h2 style="margin: 0 0 16px 0; font-size: 24px; font-weight: 600;">Canvas Not Supported</h2>\n          <p style="margin: 0 0 12px 0; opacity: 0.9; line-height: 1.6; font-size: 15px;">Your browser doesn\'t support the HTML5 Canvas 2D features required for this interactive simulation.</p>\n          <p style="margin: 0; opacity: 0.7; font-size: 13px;">Please try a modern browser like Chrome, Firefox, Safari, or Edge.</p>\n        </div>\n      </div>\n    ',pa}const Mt=document.getElementById("controlPanel"),Bt=Math.max(1,Math.min(2,window.devicePixelRatio||1));let bt=!1,wt=60,Ct=!0,Lt=!1;const Tt={normal:{maxBalls:350,collisionIters:2,adaptiveQualityMin:.5},performance:{maxBalls:200,collisionIters:1,adaptiveQualityMin:.3}};let Ft,Pt=50,Vt=-50,Rt=100,At=50;a(),window.addEventListener("resize",function(){clearTimeout(Ft),Ft=setTimeout(()=>{a(),s(),l()},150)});const qt=1960;let Gt=0,zt=qt*Gt,Ot=.88,kt=.003,Nt=.03,Ut=350;const Dt=.5*Bt,Yt=6,Xt=24;let Ht=.7,Wt=.15,$t=1,jt=null,_t=19.8;const Zt=.15;let Jt=1;i();let Qt=Yt*Ht,Kt=Xt*Ht,te=!1,ee=0,ne=1;const oe={industrialTeal:{label:"Industrial Teal",light:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#2a2a2a","#1a1a1a","#404040","#00a88f","#e0e0e0","#ff6b47","#3b7de0","#ffc04d"]},sunsetCoral:{label:"Sunset Coral",light:["#bdbbb8","#e8e6e3","#ffffff","#ff3b3b","#000000","#00f5d4","#1e40af","#fb923c"],dark:["#2b2a28","#1c1b1a","#3d3d3d","#ff5c5c","#dddddd","#00ffe7","#4169e1","#ffa866"]},violetPunch:{label:"Violet Punch",light:["#b8b7c2","#e6e5ed","#ffffff","#9333ea","#000000","#dc2626","#0ea5e9","#facc15"],dark:["#2a2832","#1a1921","#3e3d47","#b24dff","#e0e0e0","#ff4444","#00d4ff","#ffe34d"]},citrusBlast:{label:"Citrus Blast",light:["#bfbdb5","#eae8df","#ffffff","#ea580c","#000000","#e11d48","#2563eb","#059669"],dark:["#2c2b27","#1d1c19","#3f3e3a","#ff7733","#dddddd","#ff4466","#4d8aff","#00bf7f"]},cobaltSpark:{label:"Cobalt Spark",light:["#b5b8be","#e3e6eb","#ffffff","#1d4ed8","#000000","#ea580c","#db2777","#d97706"],dark:["#282b30","#191c20","#3d4147","#4d7aff","#dedede","#ff7f3d","#ff4d9e","#ffad33"]}};let ae="industrialTeal",ie=oe.industrialTeal.light.slice(),se=4,le=ie[se]||"#000000";const re=[.5,.25,.12,.06,.03,.02,.01,.01];let de=135,he=1536e3,ue=3.4,ce=gt,me=gt,ge=!1,pe=!1;("ontouchstart"in window||navigator.maxTouchPoints>0)&&(pe=!0);const ye="bouncyBallsSettings",fe=1e4;let ve=0;const xe="#hero-text";let Ee=[],Ie=.025,Se=1.8,Me=0,Be=0,be=0,we=0,Ce=0;const Le=document.getElementById("render-fps"),Te=document.getElementById("physics-fps");let Fe=2,Pe=0;class Ball{constructor(t,e,n,o){this.x=t,this.y=e,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=n,this.rBase=n,this.m=_t,this.color=o,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1}step(t){this.t+=t,this.age+=t,A!==MODES.WEIGHTLESS&&(this.vy+=zt*Jt*t);const e=Math.max(.25,this.m/1),n=A===MODES.WEIGHTLESS?1e-4:kt,o=Math.max(0,1-n/e);this.vx*=o,this.vy*=o,0!==this.driftAx&&this.age<this.driftTime?this.vx+=this.driftAx*t/e:0!==this.driftAx&&(this.driftAx=0),function(t,e){A!==MODES.PIT?A!==MODES.FLIES?A!==MODES.WEIGHTLESS||function(t,e){if(ce===gt||me===gt)return;if(X<=0||H<=0)return;const n=H*Bt,o=t.x-ce,a=t.y-me,i=o*o+a*a;if(i>n*n)return;const s=Math.max(Math.sqrt(i),yt),l=o/s,r=a/s,d=Math.max(0,1-s/n),h=X*d;t.vx+=l*h*e,t.vy+=r*h*e}(t,e):function(t,e){const n=ce===gt?.5*Et.width:ce,o=me===gt?.5*Et.height:me,a=n-t.x,i=o-t.y,s=a*a+i*i,l=Math.sqrt(s+1),r=a/l,d=i/l,h=O*N*2;t.vx+=r*h*e,t.vy+=d*h*e;const u=120*Bt;let c=0,m=0,g=0;for(let e=0;e<Ve.length;e++){const n=Ve[e];if(n===t)continue;const o=t.x-n.x,a=t.y-n.y,i=o*o+a*a;if(i<u*u&&i>0){const t=Math.sqrt(i),e=1-t/u;c+=o/t*e,m+=a/t*e,g++}}if(g>0){const n=15e3;t.vx+=c/g*n*e,t.vy+=m/g*n*e}const p=2500*N;if(Math.random()<.08){const e=Math.random()*Math.PI*2,n=1500*N;t.vx+=Math.cos(e)*n,t.vy+=Math.sin(e)*n}t.vx+=(Math.random()-.5)*p*e,t.vy+=(Math.random()-.5)*p*e;const y=.3+2*Math.random(),f=2e3*N*y*e;t.vx+=-d*f,t.vy+=r*f;const v=2200*N,x=Math.sqrt(t.vx*t.vx+t.vy*t.vy);x>v&&(t.vx=t.vx/x*v,t.vy=t.vy/x*v),t.vx*=.995,t.vy*=.995}(t,e):function(t,e){if(!ge)return;if(he<=0||de<=0)return;const n=de*Bt,o=t.x-ce,a=t.y-me,i=o*o+a*a;if(i>n*n)return;const s=Math.max(Math.sqrt(i),yt),l=o/s,r=a/s,d=Math.max(0,1-s/n),h=20*he*Math.pow(d,ue),u=Math.max(.25,t.m/1);t.vx+=l*h*e/u,t.vy+=r*h*e/u,t.vx+=10*(Math.random()-.5)*e,t.vy+=10*(Math.random()-.5)*e}(t,e)}(this,t),this.x+=this.vx*t,this.y+=this.vy*t;const a=Math.max(0,1-2*t);this.omega*=a,this.theta+=this.omega*t,this.theta>Math.PI?this.theta-=2*Math.PI:this.theta<-Math.PI&&(this.theta+=2*Math.PI);const i=Math.min(1,18*t);this.squashAmount+=(0-this.squashAmount)*i,this.squash=1-this.squashAmount}walls(e,n,o,a=Ot){const i=a;if(0===ve){if(this.y+this.r>n){this.y=n-this.r;const e=this.vy,a=this.vx-this.omega*this.r,s=Math.max(.25,this.m/1);this.omega+=a/this.r*.25/s;const l=Math.max(0,1-1.5*o/s);this.vx*=l;const r=Math.abs(e)<70?0:i;this.vy=-this.vy*(r*Math.pow(1/this.m,Zt));const d=Math.min(1,Math.abs(e)/(90*this.r));this.squashAmount=Math.min(t(),.8*d),this.squash=1-this.squashAmount,this.squashNormalAngle=-Math.PI/2;const h=this.vx/this.r;this.omega+=(h-this.omega)*Math.min(1,8*o)}const a=A===MODES.PIT?n/3:0;if(this.y-this.r<a){this.y=a+this.r;const e=this.vy;this.vy=-this.vy*i;const n=Math.min(1,Math.abs(e)/(90*this.r));this.squashAmount=Math.min(t(),.8*n),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI/2}if(this.x+this.r>e){this.x=e-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*i;const n=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(t(),.8*n),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*i;const e=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(t(),.8*e),this.squash=1-this.squashAmount,this.squashNormalAngle=0}}else this.handleRoundedWallCollision(e,n);this.checkTextCollisions(o)}checkTextCollisions(e){for(let e=0;e<Ee.length;e++){const n=Ee[e],o=Math.max(n.x,Math.min(this.x,n.x+n.width)),a=Math.max(n.y,Math.min(this.y,n.y+n.height)),i=this.x-o,s=this.y-a,l=Math.sqrt(i*i+s*s);if(l<this.r)if(0===l){const t=this.x-n.x,e=n.x+n.width-this.x,o=this.y-n.y,a=n.y+n.height-this.y,i=Math.min(t,e,o,a);i===t?(this.x=n.x-this.r,this.vx=-Math.abs(this.vx)*Ot):i===e?(this.x=n.x+n.width+this.r,this.vx=Math.abs(this.vx)*Ot):i===o?(this.y=n.y-this.r,this.vy=-Math.abs(this.vy)*Ot):(this.y=n.y+n.height+this.r,this.vy=Math.abs(this.vy)*Ot)}else{const e=this.r-l,n=i/l,o=s/l;this.x+=n*e,this.y+=o*e;const a=this.vx*n+this.vy*o;if(a<0){this.vx-=2*a*n*Ot,this.vy-=2*a*o*Ot;const e=Math.min(1,Math.abs(a)/(70*this.r));this.squash=1-t()*e,this.squashDirX=Math.abs(n)>Math.abs(o)?1:0,this.squashDirY=Math.abs(o)>Math.abs(n)?1:0}}}}handleRoundedWallCollision(e,n){const o=ve,a=[{x:o,y:o},{x:e-o,y:o},{x:e-o,y:n-o},{x:o,y:n-o}];for(let i=0;i<a.length;i++){const s=a[i],l=this.x-s.x,r=this.y-s.y,d=Math.sqrt(l*l+r*r);if(this.isInCornerRegion(s,e,n,o)&&d+this.r>o){const e=o-(d-this.r);if(e>0&&d>0){const n=l/d,o=r/d;this.x+=n*e,this.y+=o*e;const a=this.vx*n+this.vy*o;this.vx-=2*a*n*Ot,this.vy-=2*a*o*Ot;const i=Math.min(1,Math.abs(a)/(90*this.r));this.squashAmount=Math.min(t(),.8*i),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.atan2(o,n)}}}if(this.y+this.r>n&&(this.x<o||this.x>e-o)&&(this.y=n-this.r,this.vy=-this.vy*(Ot*Math.pow(1/this.m,Zt))),this.y-this.r<0&&(this.x<o||this.x>e-o)&&(this.y=this.r,this.vy=-this.vy*Ot),this.x+this.r>e&&(this.y<o||this.y>n-o)){this.x=e-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(Ot*Math.pow(1/this.m,Zt));const n=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(t(),n),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0&&(this.y<o||this.y>n-o)){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(Ot*Math.pow(1/this.m,Zt));const e=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(t(),e),this.squash=1-this.squashAmount,this.squashNormalAngle=0}this.y+this.r>n&&this.x>=o&&this.x<=e-o&&(this.y=n-this.r,this.vy=-this.vy*(Ot*Math.pow(1/this.m,Zt))),this.y-this.r<0&&this.x>=o&&this.x<=e-o&&(this.y=this.r,this.vy=-this.vy*(Ot*Math.pow(1/this.m,Zt))),this.x+this.r>e&&this.y>=o&&this.y<=n-o&&(this.x=e-this.r,this.vx=-this.vx*(Ot*Math.pow(1/this.m,Zt))),this.x-this.r<0&&this.y>=o&&this.y<=n-o&&(this.x=this.r,this.vx=-this.vx*(Ot*Math.pow(1/this.m,Zt)))}isInCornerRegion(t,e,n,o){return t.x===o&&t.y===o?this.x<=o&&this.y<=o:t.x===e-o&&t.y===o?this.x>=e-o&&this.y<=o:t.x===e-o&&t.y===n-o?this.x>=e-o&&this.y>=n-o:t.x===o&&t.y===n-o&&this.x<=o&&this.y>=n-o}draw(e){e.save(),e.translate(this.x,this.y);const n=Math.min(t(),Math.max(0,this.squashAmount));if(this.r>15&&n>.001){const t=1+n,o=1/t;e.rotate(this.squashNormalAngle),e.scale(t,o),e.rotate(-this.squashNormalAngle)}e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI),e.fillStyle=this.color,e.fill(),e.restore()}}const Ve=[];let Re=0;const Ae=new Map;let qe=performance.now()/1e3,Ge=0;const ze=1/120;console.log("High refresh mode enabled - using requestAnimationFrame"),requestAnimationFrame(function frame(t){const e=t/1e3;let n=Math.min(.008,e-qe);qe=e,Ge+=n,Me++,(Le||Te)&&e-be>=1&&(Le&&Me!==we&&(we=Me,Le.textContent=we.toString()),Te&&Be!==Ce&&(Ce=Be,Te.textContent=Ce.toString()),Me=0,Be=0,be=e,function(t){t-Pe<2||(Pe=t,we<50?(Fe=1,console.log("⚡ Adaptive Quality: LOW (1 collision iter) - FPS:",we)):we<70?(Fe=2,console.log("⚡ Adaptive Quality: MEDIUM (2 collision iters) - FPS:",we)):(Fe=3,console.log("⚡ Adaptive Quality: HIGH (3 collision iters) - FPS:",we)))}(e)),function(t){if(A!==MODES.WEIGHTLESS&&A!==MODES.PULSE_GRID)for(Re+=t;Re>=Nt;){const t=(Math.random()-.5)*Nt*.5;Re-=Nt+t,ee+=2*Math.PI*.12*(Nt+t);const e=y(),n=Math.random()<.35?3:1;for(let t=0;t<n;t++)if(Ve.length<Ut){const n=8*t*(Math.random()<.5?1:-1);p(e.x+n,e.y-12*t)}}}(n),A===MODES.PULSE_GRID&&function(t){for(let e=0;e<Ve.length;e++){const n=Ve[e];if(n.nextJumpTime-=t,n.nextJumpTime<=0&&n.jumpProgress>=1){const t=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}],e=t[Math.floor(Math.random()*t.length)],o=Q-J+1,a=J+Math.floor(Math.random()*o),i=Math.max(1,Math.round(a*(1-.5*Z+Z*Math.random())));let s=n.gridX+e.dx*i,l=n.gridY+e.dy*i;s=Math.max(0,Math.min(zo-1,s)),l=Math.max(0,Math.min(Go-1,l)),n.gridX=s,n.gridY=l;const r=B(s,l);n.targetX=r.x,n.targetY=r.y,n.jumpProgress=0,n.jumpStartX=n.x,n.jumpStartY=n.y;const d=Z*$*(Math.random()-.5),h=_*$*Math.random();n.nextJumpTime=$+d+h}if(n.jumpProgress<1)if(n.jumpProgress+=t/j,n.jumpProgress>=1)n.jumpProgress=1,n.x=n.targetX,n.y=n.targetY,n.vx=0,n.vy=0;else{const t=n.jumpProgress;let e=t;if("linear"===et)e=t;else if("snap"===et)if(t<.6){const n=t/.6;e=n*n*nt}else{const n=(t-.6)/.4;e=1+(nt-1)*(1-n)-tt*Math.sin(n*Math.PI)}else if("bounce"===et)if(t<.7)e=t/.7*(t/.7);else{const n=(t-.7)/.3;e=1-.5*tt*Math.sin(n*Math.PI*2)}else"smooth"===et&&(e=t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2);n.x=n.jumpStartX+(n.targetX-n.jumpStartX)*e,n.y=n.jumpStartY+(n.targetY-n.jumpStartY)*e,n.vx=0,n.vy=0}}}(n),Me%60==0&&l();let o=0;for(;Ge>=ze&&o<2;){if(A!==MODES.PULSE_GRID)for(let t=0;t<Ve.length;t++)Ve[t].step(ze);if(A!==MODES.FLIES&&A!==MODES.PULSE_GRID&&f(Fe),A!==MODES.PULSE_GRID){const t=A===MODES.WEIGHTLESS?Y:Ot;for(let e=0;e<Ve.length;e++)Ve[e].walls(Et.width,Et.height,ze,t)}Ge-=ze,o++,Be++}Ge>3*ze&&(Ge=0),St.clearRect(0,0,Et.width,Et.height),ve>0&&function(t,e,n){const o=ve;t.strokeStyle="rgba(255, 255, 255, 0.1)",t.lineWidth=2,t.beginPath(),t.moveTo(o,0),t.lineTo(e-o,0),t.arcTo(e,0,e,o,o),t.lineTo(e,n-o),t.arcTo(e,n,e-o,n,o),t.lineTo(o,n),t.arcTo(0,n,0,n-o,o),t.lineTo(0,o),t.arcTo(0,0,o,0,o),t.closePath(),t.stroke()}(St,Et.width,Et.height);for(let t=0;t<Ve.length;t++)Ve[t].draw(St);if(function(t){if(pe)return;if(ce===gt||me===gt)return;const e=ce,n=me,o=(Qt+Kt)/2;t.beginPath(),t.arc(e,n,o,0,2*Math.PI),t.fillStyle="rgba(255, 255, 255, 0.9)",t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.6)",t.lineWidth=2,t.stroke()}(St),!pe){St.save(),St.font="14px system-ui, -apple-system, sans-serif",St.fillStyle="rgba(255, 255, 255, 0.3)",St.textAlign="left",St.textBaseline="bottom";const t=A.charAt(0).toUpperCase()+A.slice(1);St.fillText(t+" Mode",10,Et.height-10),St.restore()}requestAnimationFrame(frame)});const Oe=document.getElementById("panelHeader"),ke=document.getElementById("minimizePanel");if(Mt&&Mt.classList.add("hidden"),ke&&Mt&&ke.addEventListener("click",t=>{t.stopPropagation(),Mt.classList.toggle("hidden")}),Oe&&Mt){let ya,fa,va,xa,Ea=!1,Ia=0,Sa=0;function Ne(t){"touchstart"===t.type?(va=t.touches[0].clientX-Ia,xa=t.touches[0].clientY-Sa):(va=t.clientX-Ia,xa=t.clientY-Sa),(t.target===Oe||Oe.contains(t.target))&&(Ea=!0,Mt.style.cursor="grabbing")}function Ue(t){if(Ea){t.preventDefault(),"touchmove"===t.type?(ya=t.touches[0].clientX-va,fa=t.touches[0].clientY-xa):(ya=t.clientX-va,fa=t.clientY-xa),Ia=ya,Sa=fa,Mt.getBoundingClientRect();const e=window.getComputedStyle(Mt),n=parseFloat(e.top)||0,o=parseFloat(e.right)||0;Mt.style.top=`${n+Sa}px`,Mt.style.right=o-Ia+"px",Mt.style.left="auto",Mt.style.bottom="auto",Ia=0,Sa=0,va="touchmove"===t.type?t.touches[0].clientX:t.clientX,xa="touchmove"===t.type?t.touches[0].clientY:t.clientY}}function De(t){Ea&&(Ea=!1,Mt.style.cursor="move",va=ya,xa=fa)}Oe.addEventListener("mousedown",Ne),document.addEventListener("mousemove",Ue),document.addEventListener("mouseup",De),Oe.addEventListener("touchstart",Ne),document.addEventListener("touchmove",Ue),document.addEventListener("touchend",De)}window.addEventListener("keydown",t=>{const e=t.key.toLowerCase();"r"===e&&(function(){if(A===MODES.WEIGHTLESS)S();else for(let t=0;t<Ve.length;t++){const e=Ve[t],n=y();e.x=n.x,e.y=n.y;const o=.5*Et.width,a=te?ne>=0?1:-1:e.x<o?1:-1,i=m(e.r/(.5*(Qt+Kt)),.6,1.4),s=140*i,l=180*i,r=120;e.vx=a*(s+Math.random()*l),e.vy=-Math.random()*r,e.age=0,e.driftAx=a*(360+420*Math.random())*i,e.driftTime=.22+.28*Math.random()}}(),t.preventDefault()),"/"===e&&Mt&&(t.preventDefault(),Mt.classList.toggle("hidden")),"1"===e&&w(MODES.PIT),"2"===e&&w(MODES.FLIES),"3"===e&&w(MODES.WEIGHTLESS),"4"===e&&w(MODES.PULSE_GRID)}),function(t=160){for(let e=0;e<t&&Ve.length<Ut;e++){const t=y();p(t.x,t.y)}}(200),Et.addEventListener("mousemove",t=>{const e=Et.getBoundingClientRect();ce=(t.clientX-e.left)*Bt,me=(t.clientY-e.top)*Bt,A===MODES.PIT&&he>0&&de>0&&(ge=!0)}),Et.addEventListener("mouseleave",()=>{ce=gt,me=gt});const Ye=document.getElementById("restitutionSlider"),Xe=document.getElementById("frictionSlider"),He=document.getElementById("emitterSlider"),We=document.getElementById("sizeSliderGlobal"),$e=document.getElementById("sizeVariationSliderGlobal"),je=(document.getElementById("weightSliderGlobal"),document.getElementById("ballSoftnessSliderGlobal")),_e=document.getElementById("sizeValGlobal"),Ze=document.getElementById("sizeVariationValGlobal"),Je=(document.getElementById("weightValGlobal"),document.getElementById("ballSoftnessValGlobal")),Qe=(document.getElementById("sizeSliderPit"),document.getElementById("sizeVariationSliderPit"),document.getElementById("weightSliderPit"),document.getElementById("ballSoftnessSliderPit"),document.getElementById("sizeValPit"),document.getElementById("sizeVariationValPit"),document.getElementById("weightValPit"),document.getElementById("ballSoftnessValPit"),document.getElementById("sizeSliderFlies"),document.getElementById("sizeVariationSliderFlies"),document.getElementById("weightSliderFlies"),document.getElementById("ballSoftnessSliderFlies"),document.getElementById("sizeValFlies"),document.getElementById("sizeVariationValFlies"),document.getElementById("weightValFlies"),document.getElementById("ballSoftnessValFlies"),document.getElementById("sizeSliderZeroG"),document.getElementById("sizeVariationSliderZeroG"),document.getElementById("weightSliderZeroG"),document.getElementById("ballSoftnessSliderZeroG"),document.getElementById("sizeValZeroG"),document.getElementById("sizeVariationValZeroG"),document.getElementById("weightValZeroG"),document.getElementById("ballSoftnessValZeroG"),document.getElementById("maxBallsSlider")),Ke=document.getElementById("spawnYSlider"),tn=document.getElementById("spawnWidthSlider"),en=document.getElementById("spawnCenterSlider"),nn=document.getElementById("spawnHeightSlider"),on=document.getElementById("repelSizeSlider"),an=document.getElementById("repelPowerSlider"),sn=document.getElementById("repelSoftSlider"),ln=document.getElementById("colorSelect"),rn=document.getElementById("color1"),dn=document.getElementById("color2"),hn=document.getElementById("color3"),un=document.getElementById("color4"),cn=document.getElementById("color5"),mn=document.getElementById("color6"),gn=document.getElementById("color7"),pn=document.getElementById("color8"),yn=document.getElementById("cursorColorSelect"),fn=document.getElementById("color1Val"),vn=document.getElementById("color2Val"),xn=document.getElementById("color3Val"),En=document.getElementById("color4Val"),In=document.getElementById("color5Val"),Sn=document.getElementById("color6Val"),Mn=document.getElementById("color7Val"),Bn=document.getElementById("color8Val");[fn,vn,xn,En,In,Sn,Mn,Bn].forEach(t=>{t&&t.setAttribute("title","Click to copy")});const bn=document.getElementById("cornerRadiusSlider"),wn=document.getElementById("cornerRadiusVal"),Cn=document.getElementById("trailFadeSlider"),Ln=document.getElementById("trailFadeVal"),Tn=document.getElementById("trailSubtletySlider"),Fn=document.getElementById("trailSubtletyVal"),Pn=document.getElementById("restitutionVal"),Vn=document.getElementById("frictionVal"),Rn=document.getElementById("emitterVal"),An=document.getElementById("maxBallsVal"),qn=document.getElementById("spawnYVal"),Gn=document.getElementById("spawnWidthVal"),zn=document.getElementById("spawnCenterVal"),On=document.getElementById("spawnHeightVal"),kn=document.getElementById("repelSizeVal"),Nn=document.getElementById("repelPowerVal"),Un=document.getElementById("repelSoftVal"),Dn=document.getElementById("saveConfigBtn"),Yn=document.getElementById("buildBtn"),Xn=document.getElementById("configOutput");Dn&&Yn&&Xn&&(Dn.addEventListener("click",()=>{const t=(e=x(),`// Generated configuration from frontend\nconst CONFIG = ${JSON.stringify(e,null,2)};`);var e;Xn.style.display="block",Xn.textContent=t,navigator.clipboard.writeText(t).then(()=>{const t=Dn.textContent;Dn.textContent="✅ Copied!",setTimeout(()=>{Dn.textContent=t},1200)}).catch(()=>{console.warn("Clipboard copy failed");const t=Dn.textContent;Dn.textContent="⚠️ Copy failed",setTimeout(()=>{Dn.textContent=t},1200)})}),Yn.addEventListener("click",()=>{const t=x();Xn.style.display="block",Xn.innerHTML="\n<strong>🚀 Build Instructions:</strong><br>\n1. Run: <code>npm run build</code><br>\n2. Your current config will be baked into <code>public/js/bouncy-balls-embed.js</code>";const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download="current-config.json",o.click(),URL.revokeObjectURL(n)})),Ye&&Ye.addEventListener("input",()=>{Ot=parseFloat(Ye.value),Pn&&(Pn.textContent=Ot.toFixed(2)),c()}),Xe&&Xe.addEventListener("input",()=>{kt=parseFloat(Xe.value),Vn&&(Vn.textContent=kt.toFixed(4)),c()}),He&&He.addEventListener("input",()=>{Nt=parseFloat(He.value),Rn&&(Rn.textContent=Nt.toFixed(3)),c()}),function(t){if(!t)return;const{size:e,sizeVal:n,sizeVar:o,sizeVarVal:a,soft:i,softVal:l}=t;e&&e.addEventListener("input",()=>{const t=parseFloat(e.value);n&&(n.textContent=t.toFixed(1)),Ht=t,s();for(let t=0;t<Ve.length;t++)Ve[t].m=_t;c()}),o&&o.addEventListener("input",()=>{const t=parseFloat(o.value);a&&(a.textContent=t.toFixed(1)),Wt=t,c()}),i&&i.addEventListener("input",()=>{const t=parseInt(i.value,10);l&&(l.textContent=String(t)),q=t,c()})}({size:We,sizeVal:_e,sizeVar:$e,sizeVarVal:Ze,soft:je,softVal:Je}),Qe&&Qe.addEventListener("input",()=>{Ut=parseInt(Qe.value,10),An&&(An.textContent=Ut.toString()),Ve.length>Ut&&(Ve.length=Ut)}),$e&&$e.addEventListener("input",()=>{Wt=parseFloat($e.value),Ze&&(Ze.textContent=Wt.toFixed(1)),I()});const Hn=document.getElementById("weightPitSlider"),Wn=document.getElementById("weightPitVal");document.getElementById("weightWeightlessSlider"),document.getElementById("weightWeightlessVal"),Ke&&Ke.addEventListener("input",()=>{Vt=parseFloat(Ke.value),qn&&(qn.textContent=Vt.toFixed(0)),a()}),tn&&tn.addEventListener("input",()=>{Rt=parseFloat(tn.value),Gn&&(Gn.textContent=Rt.toFixed(0))}),en&&en.addEventListener("input",()=>{Pt=parseFloat(en.value),zn&&(zn.textContent=Pt.toFixed(0))}),nn&&nn.addEventListener("input",()=>{At=parseFloat(nn.value),On&&(On.textContent=At.toFixed(0))}),on&&on.addEventListener("input",()=>{de=parseFloat(on.value),kn&&(kn.textContent=de.toFixed(0)),ge=ge||he>0&&de>0}),an&&an.addEventListener("input",()=>{he=function(t){const e=Math.max(0,Math.min(fe,Number(t)))/fe;return 2*Math.pow(2,12*(e-.5))*12e3}(an.value),Nn&&(Nn.textContent=Math.round(he).toString()),ga&&"off"!==ga.value&&(ge=he>0&&de>0)}),sn&&sn.addEventListener("input",()=>{ue=parseFloat(sn.value),Un&&(Un.textContent=ue.toFixed(1))});const $n=document.getElementById("performanceModeToggle");document.getElementById("performanceModeStatus"),$n&&$n.addEventListener("change",()=>{!function(){bt=!bt,wt=bt?120:60;const t=bt?Tt.performance:Tt.normal;bt?(console.log("⚡ PERFORMANCE MODE: Optimizing for 120 FPS..."),Ve.length>t.maxBalls&&(Ve.length=t.maxBalls,console.log(`⚡ Reduced balls to ${t.maxBalls} for 120 FPS`)),Ut=t.maxBalls,Fe=t.collisionIters):(console.log("🎨 NORMAL MODE: Restoring visual quality..."),Ut=t.maxBalls,Fe=t.collisionIters),function(){const t=document.getElementById("performanceModeToggle"),e=document.getElementById("performanceModeStatus"),n=document.getElementById("maxBallsSlider"),o=document.getElementById("maxBallsVal");t&&(t.checked=bt),e&&(bt?(e.textContent=`⚡ 120 FPS Mode Active (${Ve.length} balls)`,e.style.background="rgba(255,165,0,0.3)"):(e.textContent=`🎨 Normal Mode (${Ve.length} balls)`,e.style.background="rgba(0,0,0,0.2)")),n&&o&&(n.value=Ut,o.textContent=Ut.toString())}(),console.log(`🎯 Target FPS: ${wt}, Mode: ${bt?"PERFORMANCE":"NORMAL"}`)}()});const jn=document.getElementById("darkModeToggle");document.getElementById("darkModeStatus"),jn&&jn.addEventListener("change",()=>{Ct=!Ct,Ct?(o(),console.log("🌙 Auto Dark Mode: ENABLED")):(n(!1),console.log("☀️ Auto Dark Mode: DISABLED")),c()});const _n=document.getElementById("canvasShadowEnabled"),Zn=document.getElementById("shadowOffsetX"),Jn=document.getElementById("shadowOffsetXVal"),Qn=document.getElementById("shadowOffsetY"),Kn=document.getElementById("shadowOffsetYVal"),to=document.getElementById("shadowBlur"),eo=document.getElementById("shadowBlurVal"),no=document.getElementById("shadowOpacity"),oo=document.getElementById("shadowOpacityVal"),ao=document.getElementById("shadowColor"),io=document.getElementById("shadowColorVal"),so=document.getElementById("shadow2Enabled"),lo=document.getElementById("shadow2Blur"),ro=document.getElementById("shadow2BlurVal"),ho=document.getElementById("shadow2Opacity"),uo=document.getElementById("shadow2OpacityVal");_n&&_n.addEventListener("change",()=>{ot=_n.checked,e(),c()}),Zn&&Zn.addEventListener("input",()=>{at=parseInt(Zn.value,10),Jn&&(Jn.textContent=at.toString()),e(),c()}),Qn&&Qn.addEventListener("input",()=>{it=parseInt(Qn.value,10),Kn&&(Kn.textContent=it.toString()),e(),c()}),to&&to.addEventListener("input",()=>{st=parseInt(to.value,10),eo&&(eo.textContent=st.toString()),e(),c()}),no&&no.addEventListener("input",()=>{lt=parseFloat(no.value),oo&&(oo.textContent=lt.toFixed(2)),e(),c()}),ao&&ao.addEventListener("input",()=>{rt=ao.value,io&&(io.textContent=rt.toUpperCase()),e(),c()}),so&&so.addEventListener("change",()=>{dt=so.checked,e(),c()}),lo&&lo.addEventListener("input",()=>{ht=parseInt(lo.value,10),ro&&(ro.textContent=ht.toString()),e(),c()}),ho&&ho.addEventListener("input",()=>{ut=parseFloat(ho.value),uo&&(uo.textContent=ut.toFixed(2)),e(),c()}),Et.addEventListener("mousemove",t=>{const e=Et.getBoundingClientRect();ce=(t.clientX-e.left)*Bt,me=(t.clientY-e.top)*Bt}),Et.addEventListener("mouseleave",()=>{ce=gt,me=gt}),ln&&ln.addEventListener("change",()=>{r(ln.value)});const co=Array.from(document.querySelectorAll(".mode-button")),mo=document.getElementById("pitControls"),go=document.getElementById("fliesControls"),po=document.getElementById("weightlessControls"),yo=document.getElementById("gravityPitSlider"),fo=document.getElementById("gravityPitVal"),vo=document.getElementById("repellerEnabledPit"),xo=document.getElementById("attractPowerSlider"),Eo=document.getElementById("attractPowerVal"),Io=document.getElementById("orbitRadiusSlider"),So=document.getElementById("orbitRadiusVal"),Mo=document.getElementById("swarmSpeedSlider"),Bo=document.getElementById("swarmSpeedVal"),bo=document.getElementById("weightlessCountSlider"),wo=document.getElementById("weightlessCountVal"),Co=document.getElementById("weightlessSpeedSlider"),Lo=document.getElementById("weightlessSpeedVal"),To=document.getElementById("weightlessBounceSlider"),Fo=document.getElementById("weightlessBounceVal"),Po=document.getElementById("weightlessRepelSlider"),Vo=document.getElementById("weightlessRepelVal"),Ro=document.getElementById("weightlessRepelRadiusSlider"),Ao=document.getElementById("weightlessRepelRadiusVal");let qo=0,Go=0,zo=0,Oo=0,ko=0;co.forEach(t=>t.addEventListener("click",()=>{w(t.getAttribute("data-mode")),c()})),yo&&yo.addEventListener("input",()=>{G=parseFloat(yo.value),fo&&(fo.textContent=G.toFixed(1)),c(),A===MODES.PIT&&(Gt=G,zt=qt*Gt)}),Hn&&Hn.addEventListener("input",()=>{_t=parseFloat(Hn.value),Wn&&(Wn.textContent=_t.toFixed(2));for(let t=0;t<Ve.length;t++)Ve[t].m=_t;i(),c()}),vo&&vo.addEventListener("change",()=>{z=!!vo.checked,A===MODES.PIT&&(ge=z&&he>0&&de>0)}),xo&&xo.addEventListener("input",()=>{O=parseFloat(xo.value),Eo&&(Eo.textContent=Math.round(O).toString())}),Io&&Io.addEventListener("input",()=>{k=parseFloat(Io.value),So&&(So.textContent=Math.round(k).toString())}),Mo&&Mo.addEventListener("input",()=>{N=parseFloat(Mo.value),Bo&&(Bo.textContent=N.toFixed(1))}),bo&&bo.addEventListener("input",()=>{U=parseInt(bo.value,10),wo&&(wo.textContent=U.toString()),A===MODES.WEIGHTLESS&&S()}),Co&&Co.addEventListener("input",()=>{D=parseFloat(Co.value),Lo&&(Lo.textContent=Math.round(D).toString())}),To&&To.addEventListener("input",()=>{Y=parseFloat(To.value),Fo&&(Fo.textContent=Y.toFixed(2))}),Po&&Po.addEventListener("input",()=>{X=parseFloat(Po.value),Vo&&(Vo.textContent=Math.round(X).toString()),c()}),Ro&&Ro.addEventListener("input",()=>{H=parseFloat(Ro.value),Ao&&(Ao.textContent=Math.round(H).toString()),c()});const No=document.getElementById("gridPresetSelect"),Uo=document.getElementById("gridBallCountSlider"),Do=document.getElementById("gridBallCountVal"),Yo=document.getElementById("gridColumnsSlider"),Xo=document.getElementById("gridColumnsVal"),Ho=document.getElementById("pulseIntervalSlider"),Wo=document.getElementById("pulseIntervalVal"),$o=document.getElementById("pulseSpeedSlider"),jo=document.getElementById("pulseSpeedVal"),_o=document.getElementById("pulseMinStepsSlider"),Zo=document.getElementById("pulseMinStepsVal"),Jo=document.getElementById("pulseMaxStepsSlider"),Qo=document.getElementById("pulseMaxStepsVal"),Ko=document.getElementById("pulseSynchronicitySlider"),ta=document.getElementById("pulseSynchronicityVal"),ea=document.getElementById("pulseRandomnessSlider"),na=document.getElementById("pulseRandomnessVal"),oa={synchronized:{interval:.6,speed:.2,minSteps:1,maxSteps:2,synchronicity:.1,randomness:.2,easingStyle:"snap",overshoot:1.12,bounce:.18},organic:{interval:.8,speed:.25,minSteps:1,maxSteps:3,synchronicity:.3,randomness:.4,easingStyle:"smooth",overshoot:1.05,bounce:.1},chaotic:{interval:.4,speed:.15,minSteps:2,maxSteps:4,synchronicity:.7,randomness:.8,easingStyle:"bounce",overshoot:1.15,bounce:.25}};No&&No.addEventListener("change",()=>{!function(t){const e=oa[t];if(!e)return;$=e.interval,j=e.speed,J=e.minSteps,Q=e.maxSteps,_=e.synchronicity,Z=e.randomness,et=e.easingStyle,nt=e.overshoot,tt=e.bounce,Ho&&(Ho.value=e.interval),Wo&&(Wo.textContent=e.interval.toFixed(1)),$o&&($o.value=e.speed),jo&&(jo.textContent=e.speed.toFixed(2)),_o&&(_o.value=e.minSteps),Zo&&(Zo.textContent=e.minSteps.toString()),Jo&&(Jo.value=e.maxSteps),Qo&&(Qo.textContent=e.maxSteps.toString()),Ko&&(Ko.value=e.synchronicity),ta&&(ta.textContent=e.synchronicity.toFixed(2)),ea&&(ea.value=e.randomness),na&&(na.textContent=e.randomness.toFixed(2));const n=document.getElementById("pulseEasingSelect"),o=document.getElementById("pulseOvershootSlider"),a=document.getElementById("pulseOvershootVal"),i=document.getElementById("pulseBounceSlider"),s=document.getElementById("pulseBounceVal");n&&(n.value=e.easingStyle),o&&(o.value=e.overshoot),a&&(a.textContent=e.overshoot.toFixed(2)),i&&(i.value=e.bounce),s&&(s.textContent=e.bounce.toFixed(2)),A===MODES.PULSE_GRID&&b()}(No.value),c()}),Uo&&Uo.addEventListener("input",()=>{K=parseInt(Uo.value,10),Do&&(Do.textContent=K.toString()),A===MODES.PULSE_GRID&&b(),c()}),Yo&&Yo.addEventListener("input",()=>{W=parseInt(Yo.value,10),Xo&&(Xo.textContent=W.toString()),A===MODES.PULSE_GRID&&(M(),b()),c()}),Ho&&Ho.addEventListener("input",()=>{$=parseFloat(Ho.value),Wo&&(Wo.textContent=$.toFixed(1)),c()}),$o&&$o.addEventListener("input",()=>{j=parseFloat($o.value),jo&&(jo.textContent=j.toFixed(2)),c()}),_o&&_o.addEventListener("input",()=>{J=parseInt(_o.value,10),Zo&&(Zo.textContent=J.toString()),J>Q&&(Q=J,Jo&&(Jo.value=J),Qo&&(Qo.textContent=J.toString())),c()}),Jo&&Jo.addEventListener("input",()=>{Q=parseInt(Jo.value,10),Qo&&(Qo.textContent=Q.toString()),Q<J&&(J=Q,_o&&(_o.value=Q),Zo&&(Zo.textContent=Q.toString())),c()}),Ko&&Ko.addEventListener("input",()=>{_=parseFloat(Ko.value),ta&&(ta.textContent=_.toFixed(2)),c()}),ea&&ea.addEventListener("input",()=>{Z=parseFloat(ea.value),na&&(na.textContent=Z.toFixed(2)),c()});const aa=document.getElementById("pulseEasingSelect"),ia=document.getElementById("pulseOvershootSlider"),sa=document.getElementById("pulseOvershootVal"),la=document.getElementById("pulseBounceSlider"),ra=document.getElementById("pulseBounceVal");aa&&aa.addEventListener("change",()=>{et=aa.value,c()}),ia&&ia.addEventListener("input",()=>{nt=parseFloat(ia.value),sa&&(sa.textContent=nt.toFixed(2)),c()}),la&&la.addEventListener("input",()=>{tt=parseFloat(la.value),ra&&(ra.textContent=tt.toFixed(2)),c()}),rn&&rn.addEventListener("input",()=>{ie[0]=rn.value,fn&&(fn.textContent=rn.value.toUpperCase()),C(),d()}),dn&&dn.addEventListener("input",()=>{ie[1]=dn.value,vn&&(vn.textContent=dn.value.toUpperCase()),C(),d()}),hn&&hn.addEventListener("input",()=>{ie[2]=hn.value,xn&&(xn.textContent=hn.value.toUpperCase()),C(),d()}),un&&un.addEventListener("input",()=>{ie[3]=un.value,En&&(En.textContent=un.value.toUpperCase()),C(),d()}),cn&&cn.addEventListener("input",()=>{ie[4]=cn.value,In&&(In.textContent=cn.value.toUpperCase()),C(),d()}),mn&&mn.addEventListener("input",()=>{ie[5]=mn.value,Sn&&(Sn.textContent=mn.value.toUpperCase()),C(),d()}),gn&&gn.addEventListener("input",()=>{ie[6]=gn.value,Mn&&(Mn.textContent=gn.value.toUpperCase()),C(),d()}),pn&&pn.addEventListener("input",()=>{ie[7]=pn.value,Bn&&(Bn.textContent=pn.value.toUpperCase()),C(),d()}),yn&&yn.addEventListener("change",()=>{const t=Math.max(1,Math.min(8,parseInt(yn.value,10)))-1;se=t,le=ie[se]||le,c()}),E(fn,()=>rn.value.toUpperCase()),E(vn,()=>dn.value.toUpperCase()),E(xn,()=>hn.value.toUpperCase()),E(En,()=>un.value.toUpperCase()),E(In,()=>cn.value.toUpperCase()),E(Sn,()=>mn.value.toUpperCase()),E(Mn,()=>gn.value.toUpperCase()),E(Bn,()=>pn.value.toUpperCase()),bn&&bn.addEventListener("input",()=>{ve=parseFloat(bn.value),wn&&(wn.textContent=ve.toFixed(0))}),Cn&&Cn.addEventListener("input",()=>{Ie=parseFloat(Cn.value),Ln&&(Ln.textContent=Ie.toFixed(3))}),Tn&&Tn.addEventListener("input",()=>{Se=parseFloat(Tn.value),Fn&&(Fn.textContent=Se.toFixed(2)+"×")});const da={rubberPlayground:{label:"Rubber – Playground",G:1960,REST:.9,FRICTION:.0025,sizeScale:1.8,maxBalls:450,sizeVariation:.2},rubberRacquet:{label:"Rubber – Racquetball",G:3320,REST:.97,FRICTION:.0035,sizeScale:.7,maxBalls:350,sizeVariation:.3},rubberSuperball:{label:"Rubber – Superball",G:1960,REST:.95,FRICTION:.0015,sizeScale:1.2,maxBalls:450,sizeVariation:.05},rubberSoft:{label:"Rubber – Soft",G:1960,REST:.86,FRICTION:.0035,sizeScale:2.2,maxBalls:350,sizeVariation:.25},rubberHeavy:{label:"Rubber – Heavy",G:1960,REST:.88,FRICTION:.003,sizeScale:2,maxBalls:400,sizeVariation:.15}},ha={fullRain:{label:"Full Rain (top-half)",EMIT_INTERVAL:.03,xCenter:50,y:-50,w:100,h:50},narrowStrip:{label:"Narrow Strip Top",EMIT_INTERVAL:.05,xCenter:50,y:-40,w:20,h:10},leftGutter:{label:"Left Gutter",EMIT_INTERVAL:.045,xCenter:10,y:-60,w:18,h:20},rightGutter:{label:"Right Gutter",EMIT_INTERVAL:.045,xCenter:90,y:-60,w:18,h:20},centerFountain:{label:"Center Fountain",EMIT_INTERVAL:.02,xCenter:50,y:-30,w:30,h:20},stormBurst:{label:"Storm Burst",EMIT_INTERVAL:.005,xCenter:50,y:-80,w:100,h:30},slowSnow:{label:"Slow Snow",EMIT_INTERVAL:.2,xCenter:50,y:-30,w:100,h:20},edgeDrizzle:{label:"Edge Drizzle",EMIT_INTERVAL:.08,xCenter:15,y:-40,w:30,h:15},twinColumns:{label:"Twin Columns",EMIT_INTERVAL:.03,xCenter:30,y:-50,w:10,h:40},focusedBeam:{label:"Focused Beam",EMIT_INTERVAL:.015,xCenter:50,y:-70,w:6,h:12}},ua={off:{label:"Off",r:710,p:274e3,s:4.4},gentle:{label:"Gentle Breeze",r:120,p:2500,s:2.5},pushField:{label:"Push Field",r:240,p:8e4,s:2},tractor:{label:"Tractor Push",r:320,p:14e4,s:1.6},magnet:{label:"Magnet Repel",r:200,p:18e4,s:3},pulse:{label:"Pulse Strong",r:280,p:22e4,s:1.2},wideSoft:{label:"Wide Soft",r:500,p:8e4,s:4.5},needle:{label:"Needle Point",r:80,p:26e4,s:.8},wall:{label:"Invisible Wall",r:700,p:16e4,s:5},singularity:{label:"Singularity",r:600,p:3e5,s:.5}},ca=document.getElementById("physicsSelect"),ma=document.getElementById("spawnSelect"),ga=document.getElementById("repellerSelect");ca&&T(ca,da,"rubberRacquet"),ma&&T(ma,ha,"fullRain"),ga&&T(ga,ua,"off"),ln&&T(ln,oe,"industrialTeal"),P("rubberRacquet"),V("fullRain"),R("off"),L(),d(),ca&&ca.addEventListener("change",()=>P(ca.value)),ma&&ma.addEventListener("change",()=>V(ma.value)),ga&&ga.addEventListener("change",()=>R(ga.value)),s(),l(),function(){try{const t=localStorage.getItem(ye);if(t){const e=JSON.parse(t);return e.currentMode&&(A=e.currentMode),void 0!==e.gravityMultiplierPit&&(G=e.gravityMultiplierPit),void 0!==e.repellerEnabledPit&&(z=e.repellerEnabledPit),e.attractionPower&&(O=e.attractionPower),e.orbitRadius&&(k=e.orbitRadius),e.swarmSpeed&&(N=e.swarmSpeed),e.weightlessInitialSpeed&&(D=e.weightlessInitialSpeed),e.weightlessBounce&&(Y=e.weightlessBounce),e.weightlessCount&&(U=e.weightlessCount),void 0!==e.weightlessRepellerPower&&(X=e.weightlessRepellerPower),void 0!==e.weightlessRepellerRadius&&(H=e.weightlessRepellerRadius),e.restitution&&(Ot=e.restitution),void 0!==e.friction&&(kt=e.friction),e.sizeScale&&(Ht=e.sizeScale),void 0!==e.sizeVariation&&(Wt=e.sizeVariation),e.ballMassKg&&(_t=e.ballMassKg),e.repelPower&&(he=e.repelPower),e.repelRadius&&(de=e.repelRadius),e.repelSoft&&(ue=e.repelSoft),void 0!==e.cornerRadius&&(ve=e.cornerRadius),void 0!==e.motionBlur&&(trailFade=e.motionBlur),e.trailSubtlety&&(Se=e.trailSubtlety),e.currentTemplate&&(ae=e.currentTemplate),e.cursorBallColor&&(le=e.cursorBallColor),void 0!==e.gridColumns&&(W=e.gridColumns),void 0!==e.gridBallCount&&(K=e.gridBallCount),void 0!==e.pulseInterval&&($=e.pulseInterval),void 0!==e.pulseSpeed&&(j=e.pulseSpeed),void 0!==e.pulseSynchronicity&&(_=e.pulseSynchronicity),void 0!==e.pulseRandomness&&(Z=e.pulseRandomness),void 0!==e.pulseMinSteps&&(J=e.pulseMinSteps),void 0!==e.pulseMaxSteps&&(Q=e.pulseMaxSteps),e.pulseEasingStyle&&(et=e.pulseEasingStyle),void 0!==e.pulseOvershoot&&(nt=e.pulseOvershoot),void 0!==e.pulseBounceIntensity&&(tt=e.pulseBounceIntensity),void 0!==e.canvasShadowEnabled&&(ot=e.canvasShadowEnabled),void 0!==e.shadowOffsetX&&(at=e.shadowOffsetX),void 0!==e.shadowOffsetY&&(it=e.shadowOffsetY),void 0!==e.shadowBlur&&(st=e.shadowBlur),void 0!==e.shadowOpacity&&(lt=e.shadowOpacity),e.shadowColor&&(rt=e.shadowColor),void 0!==e.shadow2Enabled&&(dt=e.shadow2Enabled),void 0!==e.shadow2Blur&&(ht=e.shadow2Blur),void 0!==e.shadow2Opacity&&(ut=e.shadow2Opacity),void 0!==e.autoDarkModeEnabled&&(Ct=e.autoDarkModeEnabled),console.log("✓ Settings loaded"),!0}}catch(t){console.warn("Could not load settings:",t)}}(),e(),o(),setInterval(o,6e4);{const Ma=Object.values(MODES),Ba=Ma[Math.floor(Math.random()*Ma.length)];A=Ba,console.log(`🎲 Random mode selected: ${Ba}`)}w(A),window.addEventListener("beforeunload",u)})();