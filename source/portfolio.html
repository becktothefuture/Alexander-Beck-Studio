<!DOCTYPE html>
<!-- Portfolio carousel page (shares chrome + walls with index) -->
<html lang="en" class="fonts-loading">
<head>
  <style id="fade-blocking">#app-frame{opacity:0;}</style>
  <!-- Critical first-paint wall background (no JS + no !important). -->
  <!-- Defaults to site wall color (#242529); JS may swap to browser-aligned fallback on locked-header browsers. -->
  <!-- Fallback color: #242529 -->
  <!-- iOS 26 Safari: Both html AND body must be opaque for correct chrome tinting. -->
  <style id="abs-critical-wall-bg">
    html, body { background: var(--wall-color, #242529); background-color: var(--wall-color, #242529); }
    html.dark-mode, body.dark-mode { background: var(--wall-color, #242529); background-color: var(--wall-color, #242529); }
  </style>
  <!-- Browser Chrome Color - Safari iOS, Chrome Android, Edge -->
  <!-- Safari requirements: Compact tab layout (macOS), Allow Website Tinting (iOS) -->
  <!-- Media-query tags MUST come before the fallback for Safari compatibility -->
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#242529">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#242529">
  <meta name="theme-color" content="#242529">
  <!-- CRITICAL: Safari detection for noise layer fixes (must run before CSS) -->
  <script>
    (function() {
      var ua = navigator.userAgent;
      var isSafari = /^((?!chrome|android).)*safari/i.test(ua);
      if (isSafari) document.documentElement.classList.add('is-safari');
    })();
  </script>
  <!-- CRITICAL: Dark mode detection BEFORE first paint to prevent white flash -->
  <script>
    (function() {
      'use strict';
      
      // Read wall color from CSS tokens (single source of truth)
      function getWallColorFromCSS(isDark) {
        try {
          const hadDarkMode = document.documentElement.classList.contains('dark-mode');
          if (isDark && !hadDarkMode) {
            document.documentElement.classList.add('dark-mode');
          } else if (!isDark && hadDarkMode) {
            document.documentElement.classList.remove('dark-mode');
          }
          const computedStyle = window.getComputedStyle(document.documentElement);
          let wallColor = computedStyle.getPropertyValue('--wall-color').trim();
          if (isDark && !hadDarkMode) {
            document.documentElement.classList.remove('dark-mode');
          } else if (!isDark && hadDarkMode) {
            document.documentElement.classList.add('dark-mode');
          }
          if (wallColor && (wallColor.startsWith('#') || wallColor.startsWith('rgb'))) {
            return wallColor;
          }
        } catch (e) {}
        // Fallback to token defaults (theme-aware)
        return '#242529';
      }
      
      function detectBrowserFamily() {
        const ua = navigator.userAgent || '';
        const vendor = navigator.vendor || '';
        const isFirefox = /Firefox\//.test(ua) || /FxiOS\//.test(ua);
        const isSafari = /Safari\//.test(ua)
          && /Apple/.test(vendor)
          && !/Chrome\//.test(ua)
          && !/Chromium\//.test(ua)
          && !/CriOS\//.test(ua)
          && !/FxiOS\//.test(ua)
          && !/Edg\//.test(ua)
          && !/EdgiOS\//.test(ua)
          && !/OPR\//.test(ua)
          && !/OPiOS\//.test(ua);
        const isSamsungInternet = /SamsungBrowser\//.test(ua);
        const isChromium = /Chrome\//.test(ua)
          || /Chromium\//.test(ua)
          || /CriOS\//.test(ua)
          || /Edg\//.test(ua)
          || /EdgiOS\//.test(ua)
          || /OPR\//.test(ua)
          || /OPiOS\//.test(ua)
          || /Brave\//.test(ua)
          || isSamsungInternet;
        return { isFirefox, isSafari, isChromium, isSamsungInternet };
      }

      function detectThemeColorLikelyApplied(family) {
        const ua = navigator.userAgent || '';
        const isAndroid = /Android/.test(ua);
        const isIOS = /iPhone|iPad|iPod/.test(ua) || (/Mac/.test(ua) && navigator.maxTouchPoints > 1);
        const isStandalone = (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches)
          || (window.matchMedia && window.matchMedia('(display-mode: minimal-ui)').matches)
          || (navigator.standalone === true);
        if (family.isFirefox) return false;
        if (isStandalone) return true;
        if (family.isSafari) return true;
        if (family.isChromium) return isAndroid || family.isSamsungInternet;
        return isAndroid || isIOS;
      }

      function getLockedHeaderWallColor(isDark) {
        const family = detectBrowserFamily();
        if (family.isSafari) return '';
        if (family.isFirefox) return isDark ? '#1c1b22' : '#f9f9fb';
        return isDark ? '#3c3c3c' : '#f1f3f4';
      }

      function applyInitialWallColorToCssVars(color) {
        if (!color) return;
        const root = document.documentElement;
        root.style.setProperty('--frame-color', color);
        root.style.setProperty('--frame-color-light', color);
        root.style.setProperty('--frame-color-dark', color);
        root.style.setProperty('--wall-color', color);
        root.style.setProperty('--wall-color-light', color);
        root.style.setProperty('--wall-color-dark', color);
        root.style.setProperty('--chrome-bg', color);
        root.style.setProperty('--chrome-bg-light', color);
        root.style.setProperty('--chrome-bg-dark', color);
      }

      const THEME_KEY = 'theme-preference-v2';
      const LEGACY_THEME_KEY = 'theme-preference';
      function readThemePreference() {
        try {
          const v2 = localStorage.getItem(THEME_KEY);
          if (v2 === 'auto' || v2 === 'light' || v2 === 'dark') return v2;
          const legacy = localStorage.getItem(LEGACY_THEME_KEY);
          if (legacy === 'auto' || legacy === 'light' || legacy === 'dark') {
            localStorage.removeItem(LEGACY_THEME_KEY);
            localStorage.setItem(THEME_KEY, 'auto');
          }
        } catch (e) {}
        return 'auto';
      }

      function setBrowserChromeColors(isDark) {
        const siteLight = getWallColorFromCSS(false) || '#242529';
        const siteDark = getWallColorFromCSS(true) || '#242529';
        const lockedLight = getLockedHeaderWallColor(false);
        const lockedDark = getLockedHeaderWallColor(true);
        const lightColor = lockedLight || siteLight;
        const darkColor = lockedDark || siteDark;
        const activeColor = isDark ? darkColor : lightColor;

        // First paint harmony: let locked-header browsers use browser-aligned wall color.
        applyInitialWallColorToCssVars(activeColor);
        
        // Update primary theme-color meta tag (no media query - used as fallback)
        let meta = document.querySelector('meta[name="theme-color"]:not([media])');
        if (!meta) {
          meta = document.createElement('meta');
          meta.name = 'theme-color';
          document.head.appendChild(meta);
        }
        meta.content = activeColor;
        
        // Keep media tags explicit for browsers that consume scheme-specific values.
        let metaLight = document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: light)"]');
        if (!metaLight) {
          metaLight = document.createElement('meta');
          metaLight.name = 'theme-color';
          metaLight.media = '(prefers-color-scheme: light)';
          document.head.appendChild(metaLight);
        }
        metaLight.content = lightColor;
        
        let metaDark = document.querySelector('meta[name="theme-color"][media="(prefers-color-scheme: dark)"]');
        if (!metaDark) {
          metaDark = document.createElement('meta');
          metaDark.name = 'theme-color';
          metaDark.media = '(prefers-color-scheme: dark)';
          document.head.appendChild(metaDark);
        }
        metaDark.content = darkColor;
        
        // Safari iOS PWA: Update apple-mobile-web-app-status-bar-style
        // black-translucent: transparent status bar (allows unified wall color to show)
        let appleStatusBar = document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]');
        if (!appleStatusBar) {
          appleStatusBar = document.createElement('meta');
          appleStatusBar.name = 'apple-mobile-web-app-status-bar-style';
          document.head.appendChild(appleStatusBar);
        }
        appleStatusBar.content = 'black-translucent';
      }
      
      let themePreference = readThemePreference();
      let shouldBeDark = false;
      
      if (themePreference === 'dark') {
        shouldBeDark = true;
      } else if (themePreference === 'light') {
        shouldBeDark = false;
      } else {
        const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const hour = new Date().getHours();
        const isNightTime = hour >= 18 || hour < 6;
        shouldBeDark = systemPrefersDark || isNightTime;
      }
      
      if (shouldBeDark) {
        document.documentElement.classList.add('dark-mode');
        document.documentElement.style.colorScheme = 'dark';
        if (document.body) {
          document.body.classList.add('dark-mode');
        } else {
          document.addEventListener('DOMContentLoaded', function() {
            document.body.classList.add('dark-mode');
          }, { once: true });
        }
      }
      setBrowserChromeColors(shouldBeDark);
      
      // Safari iOS: Update theme-color on page visibility changes (page suspend/resume)
      // This ensures browser chrome color stays in sync when Safari resumes the page
      document.addEventListener('visibilitychange', function() {
        if (!document.hidden) {
          // Page became visible: re-sync theme-color in case Safari needs refresh
          const isCurrentlyDark = document.documentElement.classList.contains('dark-mode');
          setBrowserChromeColors(isCurrentlyDark);
        }
      });
      
      // Safari iOS: Also update on pageshow event (back/forward navigation)
      window.addEventListener('pageshow', function(event) {
        if (event.persisted) {
          // Page was restored from back/forward cache
          const isCurrentlyDark = document.documentElement.classList.contains('dark-mode');
          setBrowserChromeColors(isCurrentlyDark);
        }
      });
    })();
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Portfolio - Alexander Beck</title>
  <!-- ABS_BUILD_MARKER:CSS_DEV_START -->
  <!-- Dev/source: mirror index chrome so typography + UI sizing match exactly. -->
  <link rel="stylesheet" href="css/tokens.css">
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">
  <!-- ABS_BUILD_MARKER:CSS_DEV_END -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;600;700&family=Geist+Mono:wght@400&family=Sarina&display=swap" rel="stylesheet">
  <!-- panel.css is DEV-only; injected dynamically by panel-dock.js when needed -->
  <!-- ABS_BUILD_MARKER:CSS_PROD -->
  <link rel="stylesheet" href="css/portfolio.css">
  <script>
    // Soft gate: if no token, bounce back and auto-open the gate.
    // PORTFOLIO_BASE stays blank for root hosting; change if served from a subfolder.
    (function() {
      const token = sessionStorage.getItem('abs_portfolio_ok');
      if (!token) {
        sessionStorage.setItem('abs_open_portfolio_gate', '1');
        window.location.replace('index.html');
        return;
      }
      window.PORTFOLIO_BASE = '';
    })();
  </script>

  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
  <link href="images/webclip.png" rel="apple-touch-icon">
  <link rel="mask-icon" href="images/safari-pinned-tab.svg" color="#ffa000">
  <link rel="manifest" href="images/site.webmanifest">

  <!-- PWA: Mobile web app capable (modern + legacy) -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body class="body portfolio-page">
  <!-- SCENE WRAPPER: All scene layers move together (matches index structure) -->
  <div id="abs-scene" class="abs-scene">
    <!-- LAYER 2: Brand Logo - NOT VISIBLE on portfolio page (removed to optimize entrance animation) -->
    <!-- Logo animation skipped - entrance goes directly from #app-frame to .portfolio-stage -->

    <!-- LAYER 2: Portfolio Container - Carousel renders here (z:5) -->
    <div id="bravia-balls" class="portfolio-simulation w-embed">
      <!-- Wall-only canvas: renders the same rubber wall ring as index (no balls). -->
      <canvas class="portfolio-wall-canvas" aria-hidden="true"></canvas>
      <!-- Portfolio Stage -->
      <!-- Inline style hides at first paint; cleared by entrance-animation.js -->
      <div class="portfolio-stage" style="opacity:0; visibility:hidden">
        <div class="portfolio-viewport" id="viewport">
          <div class="slider-track" id="track">
            <!-- Slides will be injected here by app.js -->
          </div>
        </div>
      </div>
      
      <!-- Meta text: positioned outside stage to avoid transform inheritance issues -->
      <!-- Inline style hides at first paint; cleared by entrance-animation.js -->
      <div class="portfolio-meta" id="portfolioMeta" aria-live="polite" style="opacity:0; visibility:hidden">
        <div class="portfolio-meta__inner">
          <span class="meta-client" data-meta="client"></span>
          <span class="meta-title" data-meta="title"></span>
          <span class="meta-summary" data-meta="summary"></span>
        </div>
      </div>
    </div>
  </div>

  </div>
  
  <!-- OVERLAY EFFECTS: Visual effects on top of everything (noise, etc.) -->
  <!-- SCENE EFFECTS: Positioned above wall (z:100), below modals (z:19998) -->
  <div id="scene-effects" class="scene-effects" aria-hidden="true">
    <div class="noise"></div>
  </div>

  <!-- UI LAYER: Flexbox Layout Implementation -->
  <div class="fade-content page-content">
    <div id="app-frame" class="ui-layer-wrapper">
      <!-- Header (index-parity chrome) -->
      <header class="ui-top" data-portfolio-ui>
        <div class="ui-top-main">
          <div class="ui-top-left">
            <a href="index.html" class="gate-back abs-icon-btn" data-nav-transition data-transition aria-label="Back to home">
              <i class="ti ti-arrow-left" aria-hidden="true"></i>
            </a>
            <a id="cv-modal-trigger" class="portfolio-cv-link" href="#" aria-label="Bio/CV">Bio/CV</a>
            <a id="contact-email" class="portfolio-cv-link" href="#" aria-label="Contact">Contact</a>
          </div>
          <div class="ui-top-right">
            <blockquote class="decorative-script portfolio-blurb-wrapper">
              <p id="portfolio-blurb">Selected collaborations across finance, luxury, digital identity, and frontier techâ€”things I've directed, mentored, executed, or co-built with global leaders. Currently building my own app; check the final project in the slider. <a id="contact-email-inline" href="#">Let's chat.</a></p>
            </blockquote>
            <div id="sound-toggle-slot" class="portfolio-sound-slot"></div>
          </div>
        </div>
        <div id="top-elements-soundRow" class="ui-top-soundRow"></div>
      </header>

      <!-- CENTER SPACER (Flex Grow) -->
      <main class="ui-center-spacer" aria-hidden="true"></main>

      <footer class="ui-bottom portfolio-footer" data-portfolio-ui>
          <div class="ui-meta-row">
            <div class="ui-meta-left">
              <div id="social-links" class="footer_icon-group" role="group" aria-label="Social media links">
                <button type="button" onclick="window.open('https://music.apple.com/profile/beckandeggs', '_blank', 'noopener,noreferrer')" class="footer_icon-link w-inline-block abs-icon-btn" aria-label="Apple Music">
                  <i class="ti ti-brand-apple" aria-hidden="true"></i>
                  <span class="screen-reader">Apple Music</span>
                </button>

                <button type="button" onclick="window.open('https://www.linkedin.com/in/thisisbeck/', '_blank', 'noopener,noreferrer')" class="footer_icon-link w-inline-block abs-icon-btn" aria-label="LinkedIn">
                  <i class="ti ti-brand-linkedin" aria-hidden="true"></i>
                  <span class="screen-reader">LinkedIn</span>
                </button>
              </div>
            </div>
          
          <div class="ui-meta-right">
             <button id="site-year" type="button" class="caption abs-meta-btn abs-hover-target abs-hover-target--index" aria-label="Toggle theme">
              <span><strong class="location-name">London</strong> &middot; <span id="time-display"></span></span>
            </button>
          </div>
        </div>
      </footer>
      <div id="edge-caption" class="edge-caption" role="status" aria-live="polite" aria-atomic="true">
        <span id="edge-caption-tagline" class="edge-caption__line edge-caption__line--tagline">BUILT WITH LOVE TO BE SATISFYING.</span>
      </div>
    </div>
  </div>

  <!-- Modal System: Two-layer architecture for clean compositing -->
  <!-- Layer 1: Blur Only - No children, isolated backdrop-filter (z:19998) -->
  <div id="modal-blur-layer" class="modal-blur-layer" aria-hidden="true"></div>
  
  <!-- Layer 2: Content Only - Holds modals, no blur (z:19999) -->
  <div id="modal-content-layer" class="modal-content-layer" aria-hidden="true">
    <div id="modal-modal-host" class="modal-modal-host"></div>
  </div>

  <!-- Contact Modal - Same transition as CV/Portfolio -->
  <div id="contact-modal" class="contact-modal hidden" aria-hidden="true">
    <div id="contact-modal-label" class="modal-label"></div>
    <div id="contact-modal-inputs" class="contact-modal-inputs"></div>
  </div>

  <!-- CV Modal - Same transition as Contact -->
  <div id="cv-modal" class="cv-modal hidden" aria-hidden="true">
    <div id="cv-modal-label" class="modal-label"></div>
    <div class="cv-modal-inputs">
      <input type="text" maxlength="1" class="cv-digit" inputmode="numeric" pattern="[0-9]" data-index="0" aria-label="Digit 1" autocomplete="off" />
      <input type="text" maxlength="1" class="cv-digit" inputmode="numeric" pattern="[0-9]" data-index="1" aria-label="Digit 2" autocomplete="off" />
      <input type="text" maxlength="1" class="cv-digit" inputmode="numeric" pattern="[0-9]" data-index="2" aria-label="Digit 3" autocomplete="off" />
      <input type="text" maxlength="1" class="cv-digit" inputmode="numeric" pattern="[0-9]" data-index="3" aria-label="Digit 4" autocomplete="off" />
    </div>
  </div>


  <!-- Panel dock is injected in dev only (mirrors index behavior). -->

  <!-- ABS_BUILD_MARKER:JS_DEV_START -->
  <script type="module" src="modules/portfolio/app.js"></script>
  <!-- ABS_BUILD_MARKER:JS_DEV_END -->

  <!-- ABS_BUILD_MARKER:JS_PROD -->

  <!-- DEV TOOLING: Local hot reload (no external calls). -->
  <!-- ABS_LIVE_RELOAD_START -->
  <script>
    (function() {
      'use strict';

      // LIVE RELOAD DISABLED BY DEFAULT
      // To re-enable: set localStorage.setItem('abs_live_reload', '1') in console
      return;

      const p = String(window.location.port || '');
      if (p !== '8001' && p !== '8000') return;
      try {
        const flag = localStorage.getItem('abs_live_reload');
        if (flag === '0') return;
      } catch (e) {}

      const ENDPOINT = 'http://localhost:8003/events';
      let retryMs = 500;
      let retryCount = 0;
      const MAX_RETRIES = 3;
      let es = null;

      function isUnsafeToReloadNow() {
        const el = document.activeElement;
        if (!el) return false;
        const tag = (el.tagName || '').toLowerCase();
        if (tag === 'input' || tag === 'textarea' || tag === 'select') return true;
        return !!el.isContentEditable;
      }

      function requestReload() {
        const start = Date.now();
        const MAX_WAIT_MS = 8000;
        (function tick() {
          if (!isUnsafeToReloadNow()) {
            window.location.reload();
            return;
          }
          if (Date.now() - start > MAX_WAIT_MS) {
            window.location.reload();
            return;
          }
          window.setTimeout(tick, 250);
        })();
      }

      function connect() {
        try {
          es = new EventSource(ENDPOINT);
        } catch (e) {
          scheduleReconnect();
          return;
        }
        es.onmessage = function(ev) {
          retryMs = 500;
          let msg = null;
          try {
            msg = JSON.parse(String(ev.data || ''));
          } catch (e) {
            return;
          }
          if (msg && msg.type === 'reload') requestReload();
        };
        es.onerror = function() {
          try { es.close(); } catch (e) {}
          scheduleReconnect();
        };
      }

      function scheduleReconnect() {
        retryCount++;
        if (retryCount > MAX_RETRIES) return;
        const wait = Math.min(6000, retryMs);
        retryMs = Math.min(6000, Math.round(retryMs * 1.5));
        window.setTimeout(connect, wait);
      }

      connect();
    })();
  </script>
  <!-- ABS_LIVE_RELOAD_END -->
</body>
</html>
