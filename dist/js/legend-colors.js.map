{"version":3,"file":"legend-colors.js","sources":["../../source/modules/ui/legend-colors.js"],"sourcesContent":["// ╔══════════════════════════════════════════════════════════════════════════════╗\n// ║                        EXPERTISE LEGEND COLORS                               ║\n// ║     Assign discipline dots based on ball palette distribution + story        ║\n// ╚══════════════════════════════════════════════════════════════════════════════╝\n\nimport { getGlobals } from '../core/state.js';\n\n/**\n * Legend colors are driven by `globals.colorDistribution`:\n * - Each label picks a palette index (0..7), rendered as `bg-ball-(index+1)`.\n * - The same source of truth is used by `pickRandomColor()` for ALL mode spawns.\n */\n\nfunction normalizeLabel(s) {\n  return String(s || '').trim().toLowerCase();\n}\n\nfunction clampInt(v, min, max, fallback = min) {\n  const n = Number(v);\n  if (!Number.isFinite(n)) return fallback;\n  const i = Math.floor(n);\n  return i < min ? min : i > max ? max : i;\n}\n\nfunction resolveClassForLegendLabel(labelText) {\n  const g = getGlobals();\n  const target = normalizeLabel(labelText);\n  const dist = Array.isArray(g.colorDistribution) ? g.colorDistribution : null;\n  if (!dist) return null;\n  for (let i = 0; i < dist.length; i++) {\n    const row = dist[i];\n    if (normalizeLabel(row?.label) !== target) continue;\n    const idx = clampInt(row?.colorIndex, 0, 7, 0);\n    return `bg-ball-${idx + 1}`;\n  }\n  return null;\n}\n\nexport function applyExpertiseLegendColors() {\n  const legend = document.getElementById('expertise-legend');\n  if (!legend) return;\n\n  const items = Array.from(legend.querySelectorAll('.legend__item'));\n  for (const item of items) {\n    const labelEl = item.querySelector('span');\n    const circle = item.querySelector('.circle');\n    if (!labelEl || !circle) continue;\n\n    const label = normalizeLabel(labelEl.textContent);\n    const cls = resolveClassForLegendLabel(label);\n    if (!cls) continue;\n\n    // Remove any previous bg-ball-* classes so we can reassign cleanly.\n    for (const c of Array.from(circle.classList)) {\n      if (c.startsWith('bg-ball-') || c.startsWith('bg-story-')) circle.classList.remove(c);\n    }\n    circle.classList.add(cls);\n  }\n}\n\n\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;AACA;;;AAIA;AACA;AACA;AACA;AACA;;AAEA,SAAS,cAAc,CAAC,CAAC,EAAE;AAC3B,EAAE,OAAO,MAAM,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC,WAAW,EAAE;AAC7C;;AAEA,SAAS,QAAQ,CAAC,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,QAAQ,GAAG,GAAG,EAAE;AAC/C,EAAE,MAAM,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC;AACrB,EAAE,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,OAAO,QAAQ;AAC1C,EAAE,MAAM,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;AACzB,EAAE,OAAO,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,CAAC;AAC1C;;AAEA,SAAS,0BAA0B,CAAC,SAAS,EAAE;AAC/C,EAAE,MAAM,CAAC,GAAG,UAAU,EAAE;AACxB,EAAE,MAAM,MAAM,GAAG,cAAc,CAAC,SAAS,CAAC;AAC1C,EAAE,MAAM,IAAI,GAAG,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC,iBAAiB,GAAG,IAAI;AAC9E,EAAE,IAAI,CAAC,IAAI,EAAE,OAAO,IAAI;AACxB,EAAE,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACxC,IAAI,MAAM,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC;AACvB,IAAI,IAAI,cAAc,CAAC,GAAG,EAAE,KAAK,CAAC,KAAK,MAAM,EAAE;AAC/C,IAAI,MAAM,GAAG,GAAG,QAAQ,CAAC,GAAG,EAAE,UAAU,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;AAClD,IAAI,OAAO,CAAC,QAAQ,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC;AAC/B,EAAE;AACF,EAAE,OAAO,IAAI;AACb;;AAEO,SAAS,0BAA0B,GAAG;AAC7C,EAAE,MAAM,MAAM,GAAG,QAAQ,CAAC,cAAc,CAAC,kBAAkB,CAAC;AAC5D,EAAE,IAAI,CAAC,MAAM,EAAE;;AAEf,EAAE,MAAM,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,eAAe,CAAC,CAAC;AACpE,EAAE,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;AAC5B,IAAI,MAAM,OAAO,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC;AAC9C,IAAI,MAAM,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC;AAChD,IAAI,IAAI,CAAC,OAAO,IAAI,CAAC,MAAM,EAAE;;AAE7B,IAAI,MAAM,KAAK,GAAG,cAAc,CAAC,OAAO,CAAC,WAAW,CAAC;AACrD,IAAI,MAAM,GAAG,GAAG,0BAA0B,CAAC,KAAK,CAAC;AACjD,IAAI,IAAI,CAAC,GAAG,EAAE;;AAEd;AACA,IAAI,KAAK,MAAM,CAAC,IAAI,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE;AAClD,MAAM,IAAI,CAAC,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,UAAU,CAAC,WAAW,CAAC,EAAE,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC;AAC3F,IAAI;AACJ,IAAI,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,GAAG,CAAC;AAC7B,EAAE;AACF;;;;"}