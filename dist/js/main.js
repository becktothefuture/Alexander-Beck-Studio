function e(){d(),l();const e=document.getElementById("colorSelect");e&&e.addEventListener("change",()=>{u(e.value),m()});const t=document.getElementById("themeAuto"),n=document.getElementById("themeLight"),o=document.getElementById("themeDark");[t,n,o].forEach(e=>{e&&e.addEventListener("click",()=>{[t,n,o].forEach(e=>e?.classList.remove("active")),e.classList.add("active")})})}function t(){e(),c()&&document.querySelectorAll(".mode-button").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const o=e.getAttribute("data-mode");console.log("Mode button clicked (dev override):",o),import("./shared.js").then(e=>e.aV).then(({setMode:e})=>{e(o),n(o)}).catch(()=>{})})})}function n(e){document.querySelectorAll(".mode-button").forEach(t=>{const n=t.getAttribute("data-mode")===e;t.classList.toggle("active",n)}),document.querySelectorAll(".mode-controls").forEach(e=>e.classList.remove("active"));const t=document.getElementById(e+"Controls");t&&t.classList.add("active");const n=document.getElementById("announcer");n&&(n.textContent=`Switched to ${{critters:"Critters",pit:"Ball Pit",flies:"Flies to Light",weightless:"Zero-G",water:"Water Swimming",magnetic:"Magnetic",bubbles:"Carbonated Bubbles","kaleidoscope-3":"Kaleidoscope","parallax-linear":"Parallax (Linear)","parallax-float":"Parallax (Float)","3d-sphere":"3D Sphere","3d-cube":"3D Cube","starfield-3d":"3D Starfield","elastic-center":"Elastic Center","particle-fountain":"Particle Fountain"}[e]||e} mode`)}function o(e,t=!0){if(!fe||!ye)return;const n=e||h().currentMode,o=g[n];if(o){if(fe.classList.remove("quote-display--hidden"),!t||ke)return we.textContent=o.quote,ve.textContent=o.author,void ye.classList.remove("quote-display__content--entering","quote-display__content--exiting");ke=!0,ye.classList.add("quote-display__content--exiting"),setTimeout(()=>{we.textContent=o.quote,ve.textContent=o.author,ye.classList.remove("quote-display__content--exiting"),ye.classList.add("quote-display__content--entering"),ye.classList.remove("quote-display__content--entering"),setTimeout(()=>{ke=!1},320)},320)}else fe.classList.add("quote-display--hidden")}function i(e){try{"undefined"!=typeof document&&(document.documentElement.dataset.absBootState=(e||"")+"")}catch(t){}}function a(){z()}function r(e){const t=document.documentElement;void 0!==e.topLogoWidthVw&&t.style.setProperty("--top-logo-width-vw",e.topLogoWidthVw+""),void 0!==e.noiseSize&&t.style.setProperty("--noise-size",e.noiseSize+"px"),void 0!==e.noiseOpacityLight&&t.style.setProperty("--noise-opacity-light",e.noiseOpacityLight+""),void 0!==e.noiseOpacityDark&&t.style.setProperty("--noise-opacity-dark",e.noiseOpacityDark+""),void 0!==e.noiseBlendMode&&t.style.setProperty("--noise-blend-mode",e.noiseBlendMode+""),void 0!==e.noiseColorLight&&t.style.setProperty("--noise-color-light",e.noiseColorLight+""),void 0!==e.noiseColorDark&&t.style.setProperty("--noise-color-dark",e.noiseColorDark+"")}function s(e={}){const t=document.getElementById("abs-scene");if(!t)return Promise.resolve();const n=b(),o=e.delay??n?.contentFadeInDelay??500,i=e.duration??n?.contentFadeInDuration??1e3,a=e.easing??"cubic-bezier(0.16, 1, 0.3, 1)";return new Promise(e=>{let n=!1;const r=()=>{if(!n){n=!0;try{t.style.opacity="1",t.style.visibility="visible",t.style.willChange="auto";const e=document.getElementById("fade-blocking");e&&e.remove()}catch(o){}e()}},s=()=>{const e=document.getElementById("fade-blocking");if(e&&e.remove(),t.style.visibility="visible",t.style.willChange="opacity",t.style.opacity="0","function"==typeof t.animate){const e=t.animate([{opacity:0},{opacity:1}],{duration:i,easing:a,fill:"forwards"});e.addEventListener("finish",r),e.addEventListener("cancel",r)}else t.style.transition=`opacity ${i}ms ${a}`,requestAnimationFrame(()=>{t.style.opacity="1"}),window.setTimeout(r,i+50)};o>0?setTimeout(s,o):s()})}import{i as c,b as d,p as l,a as u,c as m,r as p,g as b,d as h,N as g,e as f,l as y,f as w,h as v,m as k,j as _,k as x,n as M,o as z,q as N,s as q,t as C,u as T,v as E,w as P,x as A,y as S,z as F,A as j,B as $,C as B,D as I,E as L,F as D,G as O,H as V,I as W,J as U,K,L as Q,M as R,O as G,P as H,Q as X,R as Z,S as J,T as Y,U as ee,V as te,W as ne,X as oe,Y as ie,Z as ae,_ as re,$ as se,a0 as ce,a1 as de,a2 as le,a3 as ue,a4 as me,a5 as pe}from"./shared.js";import{applyExpertiseLegendColors as be}from"./legend-colors.js";var he=Object.freeze({__proto__:null,setupIndexControls:t,setupMasterControls:e,updateModeButtonsUI:n});let ge=!1,fe=null,ye=null,we=null,ve=null,ke=!1,_e=!1;window.addEventListener("error",e=>{e.message&&e.message.includes("Failed to fetch")&&e.preventDefault()}),window.addEventListener("unhandledrejection",e=>{e.reason?.message&&e.reason.message.includes("Failed to fetch")&&e.preventDefault()}),(async()=>{i("booting"),document.documentElement.classList.add("js-enabled");try{await y(),w()}catch(e){}try{v("BouncyBalls bootstrap"),k("bb:start"),_("üöÄ Initializing modular bouncy balls...");const d=await x();M(d),k("bb:config"),_("‚úì Config loaded");try{const e=b();"undefined"!=typeof window&&(window.REST=e.REST,window.FRICTION=e.FRICTION,window.MAX_BALLS=e.maxBalls,window.repelRadius=e.repelRadius,window.repelPower=e.repelPower)}catch(e){}z(),_("‚úì Layout applied"),r(d),_("‚úì Visual effects configured");try{const e=b(),t=document.documentElement,n=e=>{const t=+e;return Number.isFinite(t)?(100*Math.max(0,Math.min(1,t))).toFixed(1)+"%":"0%"};if(Number.isFinite(e?.topLogoWidthVw)&&t.style.setProperty("--top-logo-width-vw",e.topLogoWidthVw+""),Number.isFinite(e?.homeMainLinksBelowLogoPx)&&t.style.setProperty("--home-main-links-below-logo-px",e.homeMainLinksBelowLogoPx+""),Number.isFinite(e?.footerNavBarTopVh)&&(t.style.setProperty("--footer-nav-bar-top",e.footerNavBarTopVh+"vh"),t.style.setProperty("--footer-nav-bar-top-svh",e.footerNavBarTopVh+"svh"),t.style.setProperty("--footer-nav-bar-top-dvh",e.footerNavBarTopVh+"dvh")),Number.isFinite(e?.footerNavBarGapVw)){const n=Math.round(9.6*e.footerNavBarGapVw);t.style.setProperty("--footer-nav-bar-gap",`clamp(${n}px, ${e.footerNavBarGapVw}vw, ${Math.round(1.67*n)}px)`)}Number.isFinite(e?.uiHitAreaMul)&&t.style.setProperty("--ui-hit-area-mul",e.uiHitAreaMul+""),Number.isFinite(e?.uiIconCornerRadiusMul)&&t.style.setProperty("--ui-icon-corner-radius-mul",e.uiIconCornerRadiusMul+""),Number.isFinite(e?.uiIconFramePx)&&Math.round(e.uiIconFramePx)>0&&t.style.setProperty("--ui-icon-frame-size",Math.round(e.uiIconFramePx)+"px"),Number.isFinite(e?.uiIconGlyphPx)&&Math.round(e.uiIconGlyphPx)>0&&t.style.setProperty("--ui-icon-glyph-size",Math.round(e.uiIconGlyphPx)+"px"),Number.isFinite(e?.linkTextPadding)&&(t.style.setProperty("--link-text-padding",Math.round(e.linkTextPadding)+"px"),t.style.setProperty("--link-text-margin",-Math.round(e.linkTextPadding)+"px")),Number.isFinite(e?.linkIconPadding)&&(t.style.setProperty("--link-icon-padding",Math.round(e.linkIconPadding)+"px"),t.style.setProperty("--link-icon-margin",-Math.round(e.linkIconPadding)+"px")),Number.isFinite(e?.linkColorInfluence)&&t.style.setProperty("--link-color-influence",e.linkColorInfluence+""),Number.isFinite(e?.linkImpactScale)&&t.style.setProperty("--link-impact-scale",e.linkImpactScale+""),Number.isFinite(e?.linkImpactBlur)&&t.style.setProperty("--link-impact-blur",e.linkImpactBlur+"px"),Number.isFinite(e?.linkImpactDuration)&&t.style.setProperty("--link-impact-duration",Math.round(e.linkImpactDuration)+"ms"),Number.isFinite(e?.linkHoverNudge)&&t.style.setProperty("--link-nudge",e.linkHoverNudge+"px"),Number.isFinite(e?.linkHoverIntensityLight)&&t.style.setProperty("--abs-hover-intensity-light",n(e.linkHoverIntensityLight)),Number.isFinite(e?.linkHoverIntensityDark)&&t.style.setProperty("--abs-hover-intensity-dark",n(e.linkHoverIntensityDark)),Number.isFinite(e?.linkHoverIntensityActive)&&t.style.setProperty("--abs-hover-intensity-active",n(e.linkHoverIntensityActive)),void 0!==e?.hoverSnapEnabled&&t.style.setProperty("--abs-hover-snap-enabled",e.hoverSnapEnabled?"1":"0"),Number.isFinite(e?.hoverSnapDuration)&&t.style.setProperty("--abs-hover-snap-duration",Math.max(0,Math.round(e.hoverSnapDuration))+"ms"),Number.isFinite(e?.hoverSnapOvershoot)&&t.style.setProperty("--abs-hover-snap-overshoot",e.hoverSnapOvershoot+""),Number.isFinite(e?.hoverSnapUndershoot)&&t.style.setProperty("--abs-hover-snap-undershoot",e.hoverSnapUndershoot+"")}catch(e){}document.querySelector(".noise");try{N(b())}catch(e){}q();const l=C(),u=se(),m=document.getElementById("bravia-balls");if(!l||!u||!m)throw Error("Missing DOM elements");try{l.setAttribute("role","application"),l.getAttribute("aria-label")||l.setAttribute("aria-label","Interactive bouncy balls physics simulation")}catch(e){}T(l,u,m),E(),k("bb:renderer"),_("‚úì Canvas initialized (container-relative sizing)"),P(),_("‚úì Canvas logo initialized"),b().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),A(),_("‚úì Pointer tracking configured"),"undefined"!=typeof document&&document.addEventListener("touchmove",e=>{var t;(t=e.target)instanceof Element&&(t.closest(".panel-dock .panel .panel-content")||t.closest("#controlPanel"))||e.preventDefault()},{passive:!1,capture:!0}),_("‚úì Overscroll lock configured"),S(),k("bb:input"),_("‚úì Custom cursor initialized"),F(),_("‚úì Wall elements initialized (outer-wall, inner-wall)");try{j(d),_("‚úì Tactile layer initialized")}catch(e){console.warn("Tactile layer init failed:",e)}$(),B(),I(),L(),D();try{O(d)}catch(e){}_("‚úì Sound engine primed (awaiting user unlock)"),"undefined"!=typeof window&&(_e||(_e=!0,window.addEventListener("bb:modeChanged",e=>{const t=b();if(!1===t?.sceneChangeSoundEnabled)return;const n=e?.detail||{};n.prevMode&&n.mode&&n.prevMode!==n.mode&&f(+(t?.sceneChangeSoundRadius??18),+(t?.sceneChangeSoundIntensity??.35),.5,null)},{passive:!0}))),k("bb:ui"),_("‚úì UI initialized (panel disabled in production)"),V(),k("bb:theme"),be(),(()=>{try{"undefined"!=typeof window&&(window.legendFilter||(window.legendFilter={}),window.legendFilter.syncAllBalls=()=>{})}catch(e){}try{const e=document.getElementById("expertise-legend"),t=document.getElementById("legend-tooltip-output");if(!e)return;const n=Array.from(e.querySelectorAll(".legend__item"));for(const o of n)o&&(o.classList.add("legend__item--interactive"),t&&(o.addEventListener("mouseenter",()=>{const e=o.getAttribute("data-tooltip");e&&(t.textContent=e,t.style.opacity="1",t.style.visibility="visible")}),o.addEventListener("mouseleave",()=>{t.style.opacity="0",window.setTimeout(()=>{"0"===t.style.opacity&&(t.style.visibility="hidden")},50)})));t&&(t.style.visibility="hidden",t.style.opacity="0")}catch(e){}})(),_("‚úì Legend filter system configured"),ge||(ge=!0,window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName))return;const t=e.key.toLowerCase();if("/"!==t&&"Slash"!==e.code)if("r"!==t);else{e.preventDefault(),p();try{n(b().currentMode)}catch(e){}}else{if(e.preventDefault(),!c())return;import("./panel-dock.js").then(e=>{try{e.toggleDock?.()}catch(t){}}).catch(()=>{})}})),_("‚úì Keyboard shortcuts registered");try{W(d),_("‚úì Modal overlay system initialized")}catch(e){console.warn("Modal overlay initialization error:",e?.message)}try{U(),_("‚úì CV password gate initialized")}catch(e){console.warn("CV gate initialization error:",e?.message)}try{K(),_("‚úì Portfolio password gate initialized")}catch(e){console.warn("Portfolio gate initialization error:",e?.message)}try{Q(),_("‚úì Contact gate initialized")}catch(e){console.warn("Contact gate initialization error:",e?.message)}R(),G(),(()=>{try{const e=document.getElementById("cv-gate-trigger");if(e&&!e.querySelector(".footer-link-nowrap")){const t=((ce("footer.links.cv.text","")||"")+"").trim(),n=(e.textContent||"").trim().replace(/\s+/g," "),o=t||n;o&&o.includes("/")&&n===o&&(e.innerHTML=`<span class="footer-link-nowrap">${o}</span>`)}}catch(e){}})(),H(),_("‚úì Sound toggle button created"),_("‚úì Theme toggle button created"),X();const g=Z();J?.("startup"),await Y(g);try{const e=await Promise.resolve().then(()=>he);e.updateModeButtonsUI?.(g)}catch(e){}k("bb:mode"),_("‚úì Mode initialized"),(()=>{(()=>{if(document.getElementById("quote-display"))return document.getElementById("quote-display");fe=document.createElement("div"),fe.id="quote-display",fe.className="quote-display",fe.setAttribute("aria-live","polite"),fe.setAttribute("aria-atomic","true"),ye=document.createElement("div"),ye.className="quote-display__content quote-display__content--entering",we=document.createElement("p"),we.className="quote-display__text",ve=document.createElement("p"),ve.className="quote-display__author",ye.appendChild(we),ye.appendChild(ve),fe.appendChild(ye);const e=document.querySelector(".ui-meta-right");e?e.insertBefore(fe,e.firstChild):document.body.appendChild(fe)})();const e=h();e.currentMode&&(o(e.currentMode,!1),requestAnimationFrame(()=>{ye?.classList.remove("quote-display__content--entering")})),window.addEventListener("bb:modeChanged",e=>{const t=e.detail?.mode;t&&o(t,!0)})})(),_("‚úì Quote display initialized"),de(ue),ee(null,{getForcesFn:le}),k("bb:end"),_("‚úÖ Bouncy Balls running (modular)");const y=[{phase:"config",ms:te("bb:m:config","bb:start","bb:config")},{phase:"renderer",ms:te("bb:m:renderer","bb:config","bb:renderer")},{phase:"input",ms:te("bb:m:input","bb:renderer","bb:input")},{phase:"ui",ms:te("bb:m:ui","bb:input","bb:ui")},{phase:"theme",ms:te("bb:m:theme","bb:ui","bb:theme")},{phase:"mode+loop",ms:te("bb:m:mode","bb:theme","bb:mode")},{phase:"total",ms:te("bb:m:total","bb:start","bb:end")}].filter(e=>"number"==typeof e.ms);y.length&&ne(y.map(e=>({...e,ms:+e.ms.toFixed(2)}))),oe();try{c()?ie():ae()}catch(t){try{console.error("Banner print error:",t),console.log("%cCurious mind detected. Design meets engineering at 60fps.","color: #888; font-style: italic;")}catch(e){}}try{const{orchestrateEntrance:t,revealAllLateElements:n}=await import("./shared.js").then(e=>e.aX),{getModalToAutoOpen:o,shouldSkipWallAnimation:i,resetTransitionState:a,setupPrefetchOnHover:r,initSpeculativePrefetch:c,didViewTransitionRun:d}=await import("./shared.js").then(e=>e.aW),l=b(),u=!!window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,m=o(),p=i(),h=d();window.addEventListener("pageshow",e=>{if(e.persisted){a();const e=document.getElementById("abs-scene");e&&(e.style.opacity="1")}});const g=document.getElementById("cv-gate-trigger"),f=document.getElementById("portfolio-gate-trigger");if(g&&r(g,"cv.html"),f&&r(f,"portfolio.html"),!l.entranceEnabled||u){try{await re()}catch(e){}await s(),n(),me(),console.log("‚úì Entrance animation skipped (disabled or reduced motion)")}else setTimeout(()=>{pe()},(l.contentFadeInDelay??500)+.6*(l.contentFadeInDuration??1e3)),await t({async waitForFonts(){try{await re()}catch(e){}},skipWallAnimation:p,skipEntranceAnimation:h}),console.log(h?"‚úì Entrance skipped (View Transition handled it)":p?"‚úì Quick entrance (returning from internal page)":"‚úì Dramatic entrance animation orchestrated");"cv"===m?setTimeout(()=>{const e=document.getElementById("cv-gate-trigger");e&&e.click()},400):"contact"===m&&setTimeout(()=>{const e=document.getElementById("contact-trigger");e&&e.click()},400),c()}catch(e){console.warn("‚ö†Ô∏è Entrance animation failed, falling back to simple fade:",e);try{await re()}catch(e){}await s(),me();try{const{revealAllLateElements:e}=await import("./shared.js").then(e=>e.aX);e()}catch(a){["main-links","brand-logo"].forEach(e=>{const t=document.getElementById(e);t&&(t.style.removeProperty("opacity"),"brand-logo"===e&&t.style.removeProperty("filter"),t.style.visibility="visible")});const e=document.getElementById("fade-blocking");e&&e.remove()}}i("ready")}catch(d){i("failed"),console.error("‚ùå Initialization failed:",d),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${d.message}\n${d.stack}</pre>\n    </div>`}})();export{e as a,a as b,r as c,t as s};