function t(t){return Math.max(-1,Math.min(1,t))}function a(t,a,o){return t+(a-t)*o}function o(){const t=s(),o=t.canvas;if(!o)return;n();const e=h(Math.max(2,Math.round(t.cube3dEdgeDensity??8))),c=Math.max(0,Math.round(t.cube3dFaceGrid??0)),u=c>0?h(c):0,i=Math.max(10,(t.cube3dSizeVw??25)/100*o.width),l=.6*(t.R_MED||20)*(t.DPR||1),f=Math.max(.1,t.cube3dDotSizeMul??1.5),x=((t,o,e)=>{const n=[],s=.5*t,r=Math.max(2,0|o),h=Math.max(0,0|e),M=[[-s,-s,-s],[s,-s,-s],[-s,s,-s],[s,s,-s],[-s,-s,s],[s,-s,s],[-s,s,s],[s,s,s]],c=[[0,1],[2,3],[4,5],[6,7],[0,2],[1,3],[4,6],[5,7],[0,4],[1,5],[2,6],[3,7]];for(const[u,i]of c)for(let t=0;r>=t;t++){const o=t/r;n.push({x:a(M[u][0],M[i][0],o),y:a(M[u][1],M[i][1],o),z:a(M[u][2],M[i][2],o)})}if(h>0){const a=h+1,o=t/a,e=[];for(let t=0;a>=t;t++)e.push(t*o-s);const r=[{axis:"z",value:-s},{axis:"z",value:s},{axis:"x",value:-s},{axis:"x",value:s},{axis:"y",value:-s},{axis:"y",value:s}];for(const t of r)for(let a=0;e.length>a;a++)for(let o=0;e.length>o;o++){let s=0,r=0,h=0;"z"===t.axis?(s=e[a],r=e[o],h=t.value):"x"===t.axis?(s=t.value,r=e[a],h=e[o]):(s=e[a],r=t.value,h=e[o]),n.push({x:s,y:r,z:h})}}return n})(i,e,u);t.cube3dState={cx:.5*o.width,cy:.5*o.height,sizePx:i,rotX:0,rotY:0,rotZ:0,idleSpeed:t.cube3dIdleSpeed??.2,cursorInfluence:t.cube3dCursorInfluence??1.5,tumbleX:0,tumbleY:0,tumbleDamping:Math.max(0,Math.min(.999,t.cube3dTumbleDamping??.95)),tumbleSpeed:t.cube3dTumbleSpeed??3,dotSizeMul:f};for(let a=0;x.length>a;a++){const o=M(0,0);o&&(o.vx=0,o.vy=0,o.omega=0,o.r=r(t,l*f),o.t=l,o.o={x:x[a].x,y:x[a].y,z:x[a].z},o.h="cube",o.isSleeping=!1)}}function e(a,o){const e=s(),n=e.canvas,h=e.cube3dState;if(!(n&&h&&a&&a.o))return;const M=e.cube3dIdleSpeed??.2,c=e.cube3dCursorInfluence??1.5,u=e.cube3dTumbleSpeed??3,i=Math.max(0,Math.min(.999,e.cube3dTumbleDamping??.95)),l=Math.max(.1,e.cube3dDotSizeMul??1.5);if(a===e.balls[0]){const a=.5*n.height,s=e.mouseInCanvas?t((e.mouseX-.5*n.width)/(.5*n.width)):0,r=e.mouseInCanvas?t((e.mouseY-a)/(.5*n.height)):0,l=s-(h.prevNx??0),f=r-(h.prevNy??0);h.prevNx=s,h.prevNy=r,h.tumbleX+=-f*u,h.tumbleY+=l*u,h.tumbleX*=i,h.tumbleY*=i,h.rotY+=(M+s*c+h.tumbleY)*o,h.rotX+=(.6*M+r*c+h.tumbleX)*o,h.rotZ+=.2*M*o}const{x:f,y:x,z:m}=a.o,z=((t,a,o,e,n,s)=>{const r=Math.cos(n),h=Math.sin(n),M=t*r-o*h,c=t*h+o*r,u=Math.cos(e),i=Math.sin(e),l=a*u-c*i,f=a*i+c*u,x=Math.cos(s),m=Math.sin(s);return{x:M*x-l*m,y:M*m+l*x,z:f}})(f,x,m,h.rotX,h.rotY,h.rotZ),p=Math.max(80,e.cube3dFocalLength??500),y=.5*h.sizePx,v=p/(p+(y-z.z)),b=h.cx+z.x*v,d=h.cy+z.y*v,j=a.t*l*v,S=(z.z+y)/h.sizePx,g=Math.max(0,Math.min(1,e.cube3dFogStart??.5));let P=0;if(g>S){const t=(g-S)/g;P=t*t}a.alpha=1-P*(1-Math.max(0,Math.min(1,e.cube3dFogMin??.1))),a.r=r(e,j*(.6+.8*a.z)),a.x=b,a.y=d,a.vx=0,a.vy=0,a.omega=0,a.isSleeping=!1,a.z=S}import{am as n,g as s,an as r,aP as h}from"./shared.js";import{s as M}from"./spawn.js";import"./Ball.js";export{e as apply3DCubeForces,o as initialize3DCube};