function t(t,a,h,n,M,o){return{x:(2*Math.random()-1)*t*M*.5,y:(2*Math.random()-1)*a*o*.5,z:h+Math.random()*(n-h),color:e(),alpha:0,fadeState:"fadingIn"}}function a(){const a=f(),h=a.canvas;if(!h)return;o();const n=h.width,M=h.height,e=i(Math.max(50,Math.min(500,Math.round(a.starfieldCount??200)))),l=4*Math.max(.5,Math.min(4,a.starfieldSpanX??1.5)),g=4*Math.max(.5,Math.min(4,a.starfieldSpanY??1.2)),p=Math.max(20,a.starfieldZNear??100),m=Math.max(p+200,a.starfieldZFar??2e3);c=[];for(let o=0;e>o;o++){const a=t(n,M,p,m,l,g);a.fadeTimer=0,c.push(a)}s=performance.now(),r=0,u=0,d=!1}function h(t){const a=f(),h=a.canvas;if(!h||0===c.length)return;const n=performance.now(),M=Math.min(.1,(n-s)/1e3);s=n;const o=h.width,i=h.height,l=.5*o,g=.5*i,p=4*Math.max(.5,Math.min(4,a.starfieldSpanX??1.5)),m=4*Math.max(.5,Math.min(4,a.starfieldSpanY??1.2)),I=Math.max(20,a.starfieldZNear??100),v=Math.max(I+200,a.starfieldZFar??2e3),O=Math.max(100,a.starfieldFocalLength??500),b=Math.max(10,a.starfieldSpeed??400),x=(a.R_MED||20)*Math.max(.2,Math.min(4,a.starfieldDotSizeMul??1))*2,j=Math.max(0,a.starfieldParallaxStrength??320);let y=0,z=0;a.mouseInCanvas&&(y=Math.max(-1,Math.min(1,(a.mouseX-l)/(.5*o))),z=Math.max(-1,Math.min(1,(a.mouseY-g)/(.5*i))));const Q=1-Math.exp(-8*M);d?(r+=(y-r)*Q,u+=(z-u)*Q):(r=y,u=z,d=!0);const S=Math.max(0,a.starfieldFadeDuration??.5);for(let f=0;c.length>f;f++){const a=c[f];a.z-=b*M,I>a.z&&(a.z=v+Math.random()*(v-I)*.3,a.x=(2*Math.random()-1)*o*p*.5,a.y=(2*Math.random()-1)*i*m*.5,a.color=e(),a.alpha=0,a.fadeState="fadingIn",a.fadeTimer=0),S>0?(a.fadeState||(a.fadeState="fadingIn",a.fadeTimer=0),void 0===a.fadeTimer&&(a.fadeTimer=0),"fadingIn"===a.fadeState?(a.fadeTimer+=M,S>a.fadeTimer?a.alpha=a.fadeTimer/S:(a.alpha=1,a.fadeState="visible",a.fadeTimer=0)):"visible"===a.fadeState?I+.1*(v-I)>a.z?(a.fadeState="fadingOut",a.fadeTimer=0):a.alpha=1:"fadingOut"===a.fadeState&&(a.fadeTimer+=M,S>a.fadeTimer?a.alpha=1-a.fadeTimer/S:(a.alpha=0,a.fadeTimer=0))):a.alpha=1;const h=O/(O+a.z),n=l+(a.x+r*j*h)*h,s=g+(a.y+u*j*h)*h,d=x;a.alpha>0&&(t.globalAlpha=a.alpha,t.beginPath(),t.arc(n,s,d,0,2*Math.PI),t.fillStyle=a.color,t.fill(),t.globalAlpha=1)}}function n(){}function M(){}import{al as o,aQ as e,g as f,aO as i}from"./shared.js";let c=[],s=0,r=0,u=0,d=!1;export{n as applyStarfield3DForces,a as initializeStarfield3D,h as renderStarfield3D,M as updateStarfield3D};