function e(e){try{localStorage.setItem(X,e+"")}catch(t){}}function t(e,t,s){if(L=e,R=s,!V){V=document.createElement("div"),V.className="panel-dock",V.id="splatPanelDock",V.style.position="fixed",V.style.top="var(--gap-lg, 20px)",V.style.right="var(--gap-lg, 20px)",V.style.zIndex="10001",document.body.appendChild(V);const e=(()=>{try{return"true"===localStorage.getItem(X)}catch(e){return!1}})();V.classList.toggle("hidden",e),(()=>{try{if(!V)return;const e=JSON.parse(localStorage.getItem(Y)||"{}");e.custom&&(V.style.position="fixed",V.style.left=e.left,V.style.top=e.top,V.style.right="auto")}catch(e){}})(),V&&(V.addEventListener("mousedown",e=>{const t=V.getBoundingClientRect();e.clientY-t.top>12||e.target.closest("button")||e.target.closest("input")||e.target.closest("select")||a(e)}),V.addEventListener("touchstart",e=>{const t=V.getBoundingClientRect();e.touches[0].clientY-t.top>12||e.target.closest("button")||e.target.closest("input")||e.target.closest("select")||a(e)},{passive:!1}),document.addEventListener("mousemove",n),document.addEventListener("mouseup",l),document.addEventListener("touchmove",n,{passive:!1}),document.addEventListener("touchend",l))}F&&F.remove(),F=document.createElement("div"),F.id="splat-config-panel",F.className=(()=>{try{return"true"===localStorage.getItem(I)}catch(e){return!1}})()?"panel collapsed":"panel";const r=(()=>{try{const e=localStorage.getItem(H);if(!e)return null;const t=JSON.parse(e);if(!t||"object"!=typeof t)return null;const a=+t.width,n=+t.height;return Number.isFinite(a)&&Number.isFinite(n)?{width:Math.round(a),height:Math.round(n)}:null}catch(e){return null}})(),d=.85*window.innerHeight;if(r){if(Math.abs(r.width-320)>5||Math.abs(r.height-d)>5){F.style.width=r.width+"px";const e=.9*window.innerHeight;F.style.height=Math.min(r.height,e)+"px"}}else F.style.width="320px",F.style.height="85vh";if(F.style.maxHeight="90vh",!document.querySelector("#splat-panel-range-css")){const e=document.createElement("style");e.id="splat-panel-range-css",e.textContent='\n      #splat-config-panel input[type="range"]::-webkit-slider-thumb {\n        -webkit-appearance: none;\n        appearance: none;\n        width: 14px;\n        height: 14px;\n        background: var(--panel-brand, hsl(32 95% 44%));\n        border-radius: 50%;\n        cursor: pointer;\n        border: 2px solid var(--panel-background, #18181b);\n      }\n      #splat-config-panel input[type="range"]::-moz-range-thumb {\n        width: 14px;\n        height: 14px;\n        background: var(--panel-brand, hsl(32 95% 44%));\n        border-radius: 50%;\n        cursor: pointer;\n        border: 2px solid var(--panel-background, #18181b);\n      }\n      #splat-config-panel input[type="range"]:hover::-webkit-slider-thumb {\n        transform: scale(1.1);\n      }\n    ',document.head.appendChild(e)}if(!document.querySelector("#splat-panel-css")){const e=document.createElement("link");e.id="splat-panel-css",e.rel="stylesheet",e.href="css/panel.css",document.head.appendChild(e)}const p=(c=e.id+" "+(e.label||"")).includes("cube")?"cube":c.includes("ducky")?"ducky":c.includes("valley")||c.includes("Alpine")?"valley":"room";var c;const u=O[p];F.innerHTML=`\n    <div class="panel-header" style="display: none;"></div>\n    <div class="panel-content">\n      <div style="position: relative; margin-bottom: var(--panel-gap, 8px); padding-bottom: var(--panel-gap, 8px); border-bottom: 1px solid var(--panel-border, rgba(255,255,255,0.1));">\n        <div style="font-size: 13px; font-weight: 600; color: var(--panel-foreground, #fff);">\n          ${e.label}\n        </div>\n        <button class="collapse-btn" id="splat-panel-collapse" style="\n          position: absolute;\n          top: 0;\n          right: 0;\n          background: transparent;\n          border: none;\n          color: var(--panel-muted-foreground, #888);\n          padding: 4px 8px;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 12px;\n          width: 28px;\n          height: 28px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        " aria-label="Collapse panel" title="Collapse">▾</button>\n      </div>\n      \n      ${o("Main Parameters",u.main,t)}\n      ${o("Secondary Parameters",u.secondary,t)}\n      ${o("Extra Parameters",u.extra,t)}\n      \n      <div style="margin-top: var(--panel-gap, 8px); padding-top: var(--panel-gap, 8px); border-top: 1px solid var(--panel-border, rgba(255,255,255,0.1)); font-size: 11px; color: var(--panel-muted-foreground, #888);">\n        <kbd>/</kbd> toggle panel · Changes apply instantly\n      </div>\n    </div>\n  `,V.appendChild(F),((e,t,a)=>{[...t.main,...t.secondary,...t.extra].forEach(t=>{const n=e.querySelector("#splat-param-"+t.id);if(!n)return;const l=n.previousElementSibling?.querySelector("span");n.addEventListener("input",e=>{const n=parseFloat(e.target.value);l&&(l.textContent=i(n,t));const o={...a,[t.id]:n};R&&R(L,o)})})})(F,u,t);const m=F.querySelector("#splat-panel-collapse");return m&&m.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),F&&(F.classList.toggle("collapsed"),(t=>{try{localStorage.setItem(I,t+"")}catch(e){}})(F.classList.contains("collapsed")))}),window._splatResizeObserverSetup||(window._splatResizeObserverSetup=!0,(()=>{if("undefined"==typeof ResizeObserver)return;let e=0,t=null;const a=()=>{const a=document.getElementById("splat-config-panel");a&&a!==window._lastObservedPanel&&(window._lastObservedPanel=a,(a=>{if(t&&t.disconnect(),a){t=new ResizeObserver(()=>{a&&V&&(a.classList.contains("collapsed")||(window.clearTimeout(e),e=window.setTimeout(()=>{(e=>{if(e)try{const t=parseInt(e.style.width)||parseInt(window.getComputedStyle(e).width),a=parseInt(e.style.height)||parseInt(window.getComputedStyle(e).height);t&&a&&localStorage.setItem(H,JSON.stringify({width:Math.round(t),height:Math.round(a)}))}catch(t){}})(a)},150)))});try{t.observe(a)}catch(n){}}})(a))};a(),setTimeout(a,100);const n=new MutationObserver(a);V&&n.observe(V,{childList:!0,subtree:!0})})()),F}function a(e){if(e.target.closest("button")||e.target.closest("input")||e.target.closest("select"))return;if(!V)return;const t=e.touches?e.touches[0].clientX:e.clientX,a=e.touches?e.touches[0].clientY:e.clientY,n=V.getBoundingClientRect();T=t,$=a,A=n.left,N=n.top,_=!1}function n(e){if(0===T&&0===$)return;if(!V)return;const t=(e.touches?e.touches[0].clientX:e.clientX)-T,a=(e.touches?e.touches[0].clientY:e.clientY)-$;if(_||5>=Math.abs(t)&&5>=Math.abs(a)||(_=!0,V.classList.add("dragging"),V.style.position="fixed",V.style.top=N+"px",V.style.left=A+"px",V.style.right="auto"),_){let e=A+t,n=N+a;const l=V.getBoundingClientRect();e=Math.max(0,Math.min(window.innerWidth-l.width,e)),n=Math.max(0,Math.min(window.innerHeight-l.height,n)),V.style.left=e+"px",V.style.top=n+"px"}}function l(){_&&(_=!1,V&&V.classList.remove("dragging"),(()=>{try{if(!V)return;localStorage.setItem(Y,JSON.stringify({left:V.style.left,top:V.style.top,custom:!0}))}catch(e){}})()),T=0,$=0,setTimeout(()=>{},10)}function o(e,t,a){return t&&0!==t.length?`\n    <details open style="margin-bottom: var(--panel-gap, 8px);">\n      <summary style="\n        font-size: 12px;\n        font-weight: 600;\n        color: var(--panel-foreground, #fff);\n        cursor: pointer;\n        padding: var(--panel-pad-7, 7px);\n        background: var(--panel-muted, rgba(255,255,255,0.05));\n        border-radius: var(--panel-radius-sm, 6px);\n        user-select: none;\n        list-style: none;\n      ">\n        ${e}\n      </summary>\n      <div style="padding: var(--panel-pad-7, 7px); display: flex; flex-direction: column; gap: var(--panel-control-gap, 6px);">\n        ${t.map(e=>((e,t)=>{const a=void 0!==t[e.id]?t[e.id]:e.default;return`\n    <div style="display: flex; flex-direction: column; gap: 2px;">\n      <div style="display: flex; justify-content: space-between; align-items: center;">\n        <label style="font-size: 11px; color: var(--panel-foreground, #fff);">${e.label}</label>\n        <span style="font-size: 11px; font-variant-numeric: tabular-nums; color: var(--panel-muted-foreground, #888); min-width: 60px; text-align: right;">\n          ${i(a,e)}\n        </span>\n      </div>\n        <input \n        type="range" \n        id="splat-param-${e.id}"\n        min="${e.min}" \n        max="${e.max}" \n        step="${e.step}" \n        value="${a}"\n        style="\n          width: 100%;\n          height: 6px;\n          background: var(--panel-muted, rgba(255,255,255,0.1));\n          border-radius: 3px;\n          outline: none;\n          -webkit-appearance: none;\n          cursor: pointer;\n        "\n        oninput="this.style.setProperty('--thumb-pos', ((this.value - this.min) / (this.max - this.min) * 100) + '%')"\n      />\n    </div>\n  `})(e,a)).join("")}\n      </div>\n    </details>\n  `:""}function i(e,t){const a=parseFloat(e);return isNaN(a)?"0":1>t.step?a.toFixed(.01>t.step?3:.1>t.step?2:1):""+Math.round(a)}function s(a,n){R&&(t(a,n,R),V&&(V.classList.remove("hidden"),e(!1)))}function r(e){const t=document.getElementById("splat-variant-label");t&&(t.textContent="NEW SIMULATIONS · "+(e?.label||""))}function d(e,t,a,n=null){const l={x:e.x*t.modelScalePx,y:e.y*t.modelScalePx,z:e.z*t.modelScalePx};let o=t.rotX,i=t.rotY,s=t.rotZ,r=0,d=0,p=0;if(null!==n&&-1===n&&t.hasDualCubes){o=t.rotXOuter||0,i=t.rotYOuter||0,s=t.rotZOuter||0;const e=t.modelScalePx*(E?.config?.orbitRadius||.08),a=t.orbitTime||0;r=Math.sin(a)*e,d=Math.cos(.7*a)*e*.6,p=Math.sin(.9*a)*e*.3,l.x+=r,l.y+=d,l.z+=p}const c=((e,t,a,n)=>{let{x:l,y:o,z:i}=e;const s=Math.cos(a),r=Math.sin(a),d=l*s-i*r,p=l*r+i*s,c=Math.cos(t),u=Math.sin(t),m=o*c-p*u,f=o*u+p*c,h=Math.cos(n),b=Math.sin(n);return{x:d*h-m*b,y:d*b+m*h,z:f}})(l,o,i,s);c.y+=t.isDucky&&t.levitationHeight?t.levitationHeight*t.modelScalePx:0;const u=Math.max(120,t.focalLength),m=u/(u+(c.z+t.depth));return{x:t.centerX+c.x*m,y:t.centerY+c.y*m,scale:m}}function p(e){const t=M(),a=t.canvas;if(!a)return;z(),E=e;const n=e.pointSource(e.config.pointCount,e.config),l=D(t,(t.R_MED||18)*(e.config.baseRadiusScale||.22)*(t.DPR||1)),o=e.config.modelScale,i=e.config.cameraPanSpeed?.45:.32,s=Math.min(a.width,a.height)*i*o,r=n.some(e=>void 0!==e.t),d=n.some(e=>e.l);t.splatTestState={centerX:.5*a.width,centerY:a.height*(.5+(e.config.centerOffsetY||0)),depth:e.config.cameraPanSpeed?120*Math.max(.6,o):220*Math.max(.6,o),modelScaleFactor:o,modelScalePx:s,baseRadius:l,lastCanvasWidth:a.width,lastCanvasHeight:a.height,rotX:0,rotY:0,rotZ:0,rotXOuter:0,rotYOuter:0,rotZOuter:0,tumbleX:0,tumbleY:0,tumbleXOuter:0,tumbleYOuter:0,prevMouseX:null,prevMouseY:null,focalLength:e.config.focalLength,idleSpeed:e.config.idleSpeed,tumbleSpeed:e.config.tumbleSpeed||0,tumbleDamping:e.config.tumbleDamping||1,tumbleDampingOuter:e.config.tumbleDamping?.992*e.config.tumbleDamping:.979104,cameraPanSpeed:e.config.cameraPanSpeed||0,cameraPanX:0,cameraPanY:0,orbitTime:0,hasDualCubes:r,floatTime:0,floatAmplitude:e.config.floatAmplitude||18,floatSpeed:e.config.floatSpeed||.8,levitationHeight:e.config.levitationHeight||-.15,isDucky:d,points:n};for(let p=0;n.length>p;p++){const e=k(0,0);e&&(e.vx=0,e.vy=0,e.omega=0,e.r=l,e.o=n[p],e.i=l,void 0!==n[p].t&&(e.t=n[p].t),e.isSleeping=!1)}t.currentMode=P.SPHERE_3D}function c(e,t){const a={x:e.x*t.modelScalePx,y:e.y*t.modelScalePx,z:e.z*t.modelScalePx},n=a.x-(t.cameraPanX||0),l=a.y-(t.cameraPanY||0),o=a.z,i=Math.max(120,t.focalLength),s=i/(i+(o+t.depth));return{x:t.centerX+n*s,y:t.centerY+l*s,scale:s}}function u(e,t){e.config={...e.config,...t};const a=M(),n=a.splatTestState;n&&(void 0!==t.floatAmplitude&&(n.floatAmplitude=t.floatAmplitude),void 0!==t.floatSpeed&&(n.floatSpeed=t.floatSpeed),void 0!==t.levitationHeight&&(n.levitationHeight=t.levitationHeight),void 0!==t.centerOffsetY&&(n.centerY=a.canvas.height*(.5+t.centerOffsetY)),void 0!==t.focalLength&&(n.focalLength=t.focalLength),void 0!==t.idleSpeed&&(n.idleSpeed=t.idleSpeed),void 0!==t.tumbleSpeed&&(n.tumbleSpeed=t.tumbleSpeed),void 0!==t.tumbleDamping&&(n.tumbleDamping=t.tumbleDamping,n.tumbleDampingOuter=.992*t.tumbleDamping),void 0!==t.cameraPanSpeed&&(n.cameraPanSpeed=t.cameraPanSpeed),void 0!==t.baseRadiusScale&&(n.baseRadius=D(a,(a.R_MED||18)*t.baseRadiusScale*(a.DPR||1)),a.balls.forEach(e=>{void 0!==e.i&&(e.i=n.baseRadius)}))),p(e),s(e,e.config)}import{d as m,e as f,f as h,j as b,n as x,S as g,k as v,o as y,g as M,q as S,ab as w,ac as z,ad as D,ae as k,M as P,V as C}from"./shared.js";const O={cube:{main:[{id:"pointCount",label:"Point Count",min:200,max:2e3,step:50,default:800},{id:"modelScale",label:"Model Scale",min:.5,max:2.5,step:.1,default:1.2},{id:"focalLength",label:"Focal Length",min:400,max:1500,step:50,default:850},{id:"cubeSize",label:"Cube Size",min:.3,max:1.5,step:.05,default:.8}],secondary:[{id:"idleSpeed",label:"Idle Speed",min:0,max:.1,step:.005,default:.025},{id:"tumbleSpeed",label:"Tumble Speed",min:0,max:10,step:.2,default:4.2},{id:"tumbleDamping",label:"Tumble Damping",min:.9,max:.999,step:.001,default:.987},{id:"baseRadiusScale",label:"Dot Size",min:.1,max:.5,step:.01,default:.22}],extra:[{id:"centerOffsetY",label:"Center Y Offset",min:-.1,max:.1,step:.01,default:0},{id:"orbitRadius",label:"Orbit Radius",min:0,max:.2,step:.01,default:.08},{id:"orbitSpeed",label:"Orbit Speed",min:0,max:2,step:.1,default:.5}]},ducky:{main:[{id:"pointCount",label:"Point Count",min:800,max:4e3,step:100,default:2400},{id:"modelScale",label:"Model Scale",min:1,max:4,step:.1,default:2.2},{id:"focalLength",label:"Focal Length",min:600,max:1500,step:50,default:920},{id:"baseRadiusScale",label:"Dot Size",min:.1,max:.5,step:.01,default:.22}],secondary:[{id:"idleSpeed",label:"Idle Speed",min:0,max:.1,step:.005,default:.02},{id:"tumbleSpeed",label:"Tumble Speed",min:0,max:12,step:.2,default:5.5},{id:"tumbleDamping",label:"Tumble Damping",min:.9,max:.999,step:.001,default:.975},{id:"levitationHeight",label:"Levitation Height",min:-.6,max:.2,step:.01,default:-.35}],extra:[{id:"floatAmplitude",label:"Float Amplitude",min:0,max:50,step:1,default:22},{id:"floatSpeed",label:"Float Speed",min:.1,max:3,step:.1,default:.8},{id:"bodyDensity",label:"Body Density",min:.3,max:.6,step:.05,default:.45}]},room:{main:[{id:"pointCount",label:"Point Count",min:1e3,max:5e3,step:200,default:2e3},{id:"modelScale",label:"Model Scale",min:1,max:4,step:.1,default:2.8},{id:"focalLength",label:"Focal Length",min:400,max:1200,step:50,default:600},{id:"cameraPanSpeed",label:"Pan Speed",min:0,max:1,step:.05,default:.3}],secondary:[{id:"boxWidth",label:"Room Width",min:1.5,max:4,step:.1,default:2.4},{id:"boxHeight",label:"Room Height",min:.8,max:2.5,step:.1,default:1.4},{id:"boxDepth",label:"Room Depth",min:2,max:6,step:.2,default:4.2},{id:"baseRadiusScale",label:"Dot Size",min:.1,max:.5,step:.01,default:.22}],extra:[{id:"idleSpeed",label:"Idle Speed",min:0,max:.05,step:.005,default:.015},{id:"furnitureDensity",label:"Furniture Density",min:.05,max:.3,step:.05,default:.17},{id:"wallDensity",label:"Wall Density",min:.1,max:.3,step:.05,default:.15}]},valley:{main:[{id:"pointCount",label:"Mesh Density",min:500,max:3e3,step:100,default:1500},{id:"modelScale",label:"Scene Scale",min:1,max:3.5,step:.1,default:2},{id:"focalLength",label:"Focal Length",min:300,max:800,step:25,default:450},{id:"cameraPanSpeed",label:"Pan Speed",min:0,max:.5,step:.025,default:.25}],secondary:[{id:"riverFlowSpeed",label:"River Flow",min:.1,max:2,step:.1,default:.4},{id:"baseRadiusScale",label:"Dot Size",min:.1,max:.5,step:.01,default:.22}],extra:[{id:"centerOffsetY",label:"View Offset Y",min:-.15,max:.15,step:.01,default:0}]}};let V=null,F=null,L=null,R=null,T=0,$=0,A=0,N=0,_=!1;const Y="splat_panel_position",I="splat_panel_collapsed",X="splat_panel_hidden",H="splat_panel_size",W={sizeVariationGlobalMul:0,sizeVariationPit:0,sizeVariationFlies:0,sizeVariationWeightless:0,sizeVariationWater:0,sizeVariationVortex:0,sizeVariationPingPong:0,sizeVariationMagnetic:0,sizeVariationBubbles:0,sizeVariationKaleidoscope:0,sizeVariationCritters:0,sizeVariationNeural:0,sizeVariationParallaxLinear:0,sphere3dDotSizeMul:1.2},j=[{id:"splat-variant-a",label:"Variant A · Perfect Cube",pointSource(e,t={}){const a=t.cubeSize||.8,n=1.6*a,l=[],o=Math.floor(.5*e),i=e-o,s=(e,t,a={x:0,y:0,z:0})=>{const n=.5*e,l=[],o=Math.max(4,Math.floor(t/12)),i=(t,n,l)=>{const o=.015/e,i=o+l*(1-2*o);return{x:t.x+(n.x-t.x)*i+a.x,y:t.y+(n.y-t.y)*i+a.y,z:t.z+(n.z-t.z)*i+a.z}},s=[{x:-n,y:-n,z:-n},{x:n,y:-n,z:-n},{x:-n,y:n,z:-n},{x:n,y:n,z:-n},{x:-n,y:-n,z:n},{x:n,y:-n,z:n},{x:-n,y:n,z:n},{x:n,y:n,z:n}],r=[[0,1],[2,3],[4,5],[6,7],[0,2],[1,3],[4,6],[5,7],[0,4],[1,5],[2,6],[3,7]];for(const[d,p]of r){const e=s[d],t=s[p];for(let a=0;o>a;a++)l.push(i(e,t,a/(o-1)))}return l},r=s(a,o);l.push(...r);const d=s(n,i);return l.push(...d),l.forEach((e,t)=>{e.t=r.length>t?1:-1}),l},config:{pointCount:400,modelScale:1.1,focalLength:850,idleSpeed:.025,tumbleSpeed:4.2,tumbleDamping:.987,cubeSize:.8}},{id:"splat-variant-b",label:"Variant B · Rubber Ducky",pointSource(e,t={}){const a=(e=>{let t=e;return()=>(t=(9301*t+49297)%233280,t/233280)})(t.seed||42),n=[],l=Math.floor(e*(t.bodyDensity||.45));for(let p=0;l>p;p++){const e=a()*B,t=Math.acos(2*a()-1),l=.35+.12*a();n.push({x:l*Math.sin(t)*Math.cos(e)*1.15,y:-(l*Math.cos(t)*.85-.08),z:l*Math.sin(t)*Math.sin(e)*.88})}const o=Math.floor(e*(t.headDensity||.25)),i=.24;for(let p=0;o>p;p++){const e=a()*B,t=Math.acos(2*a()-1);n.push({x:i*Math.sin(t)*Math.cos(e)+.35,y:i*Math.cos(t)-.18,z:i*Math.sin(t)*Math.sin(e)*.95})}const s=Math.floor(.12*e);for(let p=0;s>p;p++)n.push({x:.5+.14*a(),y:.1*a()-.05-.14,z:.18*a()-.09});const r=Math.floor(.06*e);for(let p=0;r>p;p++){const e=a()*B,t=.1*a();n.push({x:t*Math.cos(e)-.4,y:.04+t*Math.sin(e)*.6,z:.22*a()-.11})}const d=Math.floor(.12*e);for(let p=0;d>p;p++){const e=p%2==0?1:-1,t=a()*B*.6,l=a()*Math.PI*.5,o=.14+.08*a();n.push({x:(.35*a()-.1)*e,y:.03+o*Math.cos(l),z:.3*e+o*Math.sin(l)*Math.sin(t)})}return n.forEach(e=>{e.l=!0}),n},config:{pointCount:2400,modelScale:2.2,focalLength:920,idleSpeed:.02,tumbleSpeed:5.5,tumbleDamping:.975,floatAmplitude:22,floatSpeed:.8,levitationHeight:.05}},{id:"splat-variant-c",label:"Variant C · Alpine Valley",pointSource(e,t={}){const a=[],n=Math.max(.5,Math.min(2,(t.pointCount||1500)/1500)),l=-1.6,o=1.4*(t.modelScale||2),i=(e,t,n,l="terrain")=>{a.push({x:e,y:t,z:n,p:l})},s=e=>.35*Math.sin(e*Math.PI*1.6),r=Math.round(5*n),d=Math.round(20*n);for(let y=0;r>y;y++)for(let e=0;d>e;e++)i((e/(d-1)-.5)*o*1.1,-.2-y/(r-1)*.35,-1.75,"sky");const p=Math.round(12*n);for(let y=0;p>y;y++){const e=y/(p-1),t=.8*(1-.88*e),a=Math.max(1,Math.round(18*n*(1-.85*e)));for(let n=0;a>n;n++)i((a>1?n/(a-1)-.5:0)*t,.5*-e,l,"mountain")}const c=Math.round(14*n),u=Math.round(22*n);for(let y=0;c>y;y++){const e=y/(c-1),t=e*(.8-l-.4)-1.35,a=(.6+1*e)*o/2;for(let n=0;u>n;n++)i((n/(u-1)-.5)*a*2,.02+.26*e,t,"ground")}const m=Math.round(40*n),f=Math.round(5*n);for(let y=0;m>y;y++){const e=y/(m-1),t=(e-.5)*o*.85,a=.12+s(e);for(let n=0;f>n;n++)i(t,.28,a+.1*(n/(f-1)-.5),"river")}const h=Math.round(12*n);for(let y=0;h>y;y++){const e=y/h;a.push({x:(e-.5)*o*.85,y:.27,z:.12+s(e),p:"flowBall",u:e,m:o})}const b=Math.round(5*n),x=Math.round(10*n);for(let y=-1;1>=y;y+=2)for(let e=0;b>e;e++){const t=e/(b-1),a=.9*t-1.25,n=y*(.5+.3*t),l=.02+.16*t;for(let e=0;x>e;e++)i(n,l-e/(x-1)*.22,a,"tree")}const g=Math.round(5*n),v=Math.round(20*n);for(let y=0;g>y;y++)for(let e=0;v>e;e++)i((e/(v-1)-.5)*o*1.2,.36+y/(g-1)*.16,.8-y/(g-1)*.2,"grass");i(-.6,-.38,l-.1,"sun");for(let y=1;3>=y;y++){const e=6*y,t=.03*y;for(let a=0;e>a;a++){const n=a/e*B;i(t*Math.cos(n)-.6,t*Math.sin(n)-.38,l-.1,"sun")}}return a},config:{pointCount:1500,modelScale:1,focalLength:1250,idleSpeed:0,tumbleSpeed:0,tumbleDamping:1,cameraPanSpeed:.25,riverFlowSpeed:.4,baseRadiusScale:.12}}],B=2*Math.PI;let E=null;(async()=>{const a=await m();f({...a,...W}),h(),b();const n=v(),l=g(),o=document.getElementById("bravia-balls");if(!n||!l||!o)return void console.error("Splat test: missing canvas/container");x(n,l,o),y();const i=M();i.clickCycleEnabled=!1,i.mouseInCanvas=!1,S(),w("industrialTeal"),(a=>{const n=v();if(!n||0===a.length)return;let l=Math.floor(Math.random()*a.length);const o=a[l];p(o),r(o),t(o,o.config,u),n.addEventListener("click",e=>{const t=n.getBoundingClientRect(),o=e.clientX,i=e.clientY;!(t.left>o||o>t.right||t.top>i||i>t.bottom)&&(()=>{l=(l+1)%a.length;const e=a[l];p(e),r(e),s(e,e.config)})()}),window._splatPanelKeyBound||(window._splatPanelKeyBound=!0,document.addEventListener("keydown",t=>{const a=document.activeElement&&("INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||document.activeElement.isContentEditable);"/"!==t.key||t.shiftKey||t.ctrlKey||t.metaKey||a||(t.preventDefault(),(()=>{if(V){const t=V.classList.contains("hidden");V.classList.toggle("hidden"),e(!t)}})())}))})(j),(()=>{let e=performance.now();const t=a=>{const n=Math.min(.033,(a-e)/1e3);e=a,(e=>{const t=M(),a=t.splatTestState,n=t.canvas;if(!a||!n)return;n.width===a.lastCanvasWidth&&n.height===a.lastCanvasHeight||(a.lastCanvasWidth=n.width,a.lastCanvasHeight=n.height,((e,t,a)=>{const n=e.cameraPanSpeed?.45:.32,l=Math.min(a.width,a.height)*n*e.modelScaleFactor,o=D(t,(t.R_MED||18)*(E?.config?.baseRadiusScale||.22)*(t.DPR||1));if(.001>=Math.abs(l-e.modelScalePx)&&.001>=Math.abs(o-e.baseRadius))return;e.modelScalePx=l,e.baseRadius=o;const i=t.balls;for(let s=0;i.length>s;s++){const e=i[s];e&&e.o&&(e.i=o)}})(a,t,n)),a.centerX=.5*n.width,a.centerY=.52*n.height;const l=void 0!==a.cameraPanSpeed&&a.cameraPanSpeed>0;if(l){if(t.mouseInCanvas){const e=200*a.cameraPanSpeed,l=(t.mouseY-a.centerY)/(.5*n.height);a.cameraPanX=(t.mouseX-a.centerX)/(.5*n.width)*e,a.cameraPanY=l*e}else a.cameraPanX=.95*(a.cameraPanX||0),a.cameraPanY=.95*(a.cameraPanY||0);a.rotY+=a.idleSpeed*e*.1,a.rotX=0,a.rotZ=0}else{if(t.mouseInCanvas){const e=t.mouseX-(a.prevMouseX??t.mouseX),n=t.mouseY-(a.prevMouseY??t.mouseY);a.prevMouseX=t.mouseX,a.prevMouseY=t.mouseY;const l=.0028*a.tumbleSpeed;a.hasDualCubes?(a.tumbleY+=-e*l,a.tumbleX+=n*l,a.tumbleYOuter+=e*l*.85,a.tumbleXOuter+=-n*l*.85):(a.tumbleY+=e*l,a.tumbleX+=-n*l)}else a.prevMouseX=null,a.prevMouseY=null;if(a.hasDualCubes){a.tumbleX*=a.tumbleDamping,a.tumbleY*=a.tumbleDamping,a.rotY+=(a.idleSpeed+a.tumbleY)*e,a.rotX+=(.7*a.idleSpeed+a.tumbleX)*e,a.rotZ+=.2*a.idleSpeed*e;const t=a.tumbleDampingOuter||.992*a.tumbleDamping;a.tumbleXOuter*=t,a.tumbleYOuter*=t,a.rotYOuter+=(a.idleSpeed+a.tumbleYOuter)*e,a.rotXOuter+=(.7*a.idleSpeed+a.tumbleXOuter)*e,a.rotZOuter+=.2*a.idleSpeed*e}else a.tumbleX*=a.tumbleDamping,a.tumbleY*=a.tumbleDamping,a.rotY+=(a.idleSpeed+a.tumbleY)*e,a.rotX+=(.7*a.idleSpeed+a.tumbleX)*e,a.rotZ+=.2*a.idleSpeed*e}void 0!==a.orbitTime&&(a.orbitTime+=e*(E?.config?.orbitSpeed||.5)),a.isDucky&&void 0!==a.floatTime&&(a.floatTime+=e*a.floatSpeed),void 0===a.riverFlowTime&&E?.config?.riverFlowSpeed&&(a.riverFlowTime=0),void 0!==a.riverFlowTime&&(a.riverFlowTime+=e*(E?.config?.riverFlowSpeed||.4));const o=t.balls;for(let i=0;o.length>i;i++){const e=o[i],n=e.o;if(!n)continue;const s=void 0!==e.t?e.t:null;if("flowBall"===n.p&&void 0!==a.riverFlowTime){const l=(a.riverFlowTime*(E?.config?.riverFlowSpeed||.4)*.08+n.u)%1,o=c({x:(l-.5)*(n.m||2.8)*.85,y:.27,z:.12+.35*Math.sin(l*Math.PI*1.6)},a);e.x=o.x,e.y=o.y,e.r=D(t,e.i*o.scale*1.5),e.vx=0,e.vy=0,e.omega=0,e.isSleeping=!1;continue}let r=l?c(n,a):d(n,a,0,s);if(a.isDucky&&n.l){const e=Math.sin(a.floatTime)*a.floatAmplitude;r={...r,y:r.y+e}}e.x=r.x,e.y=r.y,e.r=D(t,e.i*r.scale),e.vx=0,e.vy=0,e.omega=0,e.isSleeping=!1}})(n),C(),requestAnimationFrame(t)};requestAnimationFrame(t)})()})();