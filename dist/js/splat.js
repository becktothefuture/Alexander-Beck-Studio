function e(e){try{localStorage.setItem(W,e+"")}catch(t){}}function t(e,t,s){if(T=e,$=s,!R){R=document.createElement("div"),R.className="panel-dock",R.id="splatPanelDock",R.style.position="fixed",R.style.top="var(--gap-lg, 20px)",R.style.right="var(--gap-lg, 20px)",R.style.zIndex="10001",document.body.appendChild(R);const e=(()=>{try{return"true"===localStorage.getItem(W)}catch(e){return!0}})();R.classList.toggle("hidden",e),(()=>{try{if(!R)return;const e=JSON.parse(localStorage.getItem(X)||"{}");e.custom&&(R.style.position="fixed",R.style.left=e.left,R.style.top=e.top,R.style.right="auto")}catch(e){}})(),R&&(R.addEventListener("mousedown",e=>{const t=R.getBoundingClientRect();e.clientY-t.top>12||e.target.closest("button")||e.target.closest("input")||e.target.closest("select")||n(e)}),R.addEventListener("touchstart",e=>{const t=R.getBoundingClientRect();e.touches[0].clientY-t.top>12||e.target.closest("button")||e.target.closest("input")||e.target.closest("select")||n(e)},{passive:!1}),document.addEventListener("mousemove",a),document.addEventListener("mouseup",o),document.addEventListener("touchmove",a,{passive:!1}),document.addEventListener("touchend",o))}L&&L.remove(),L=document.createElement("div"),L.id="splat-config-panel",L.className=(()=>{try{return"true"===localStorage.getItem(_)}catch(e){return!1}})()?"panel collapsed":"panel";const r=(()=>{try{const e=localStorage.getItem(j);if(!e)return null;const t=JSON.parse(e);if(!t||"object"!=typeof t)return null;const n=+t.width,a=+t.height;return Number.isFinite(n)&&Number.isFinite(a)?{width:Math.round(n),height:Math.round(a)}:null}catch(e){return null}})(),d=.85*window.innerHeight;if(r){if(Math.abs(r.width-320)>5||Math.abs(r.height-d)>5){L.style.width=r.width+"px";const e=.9*window.innerHeight;L.style.height=Math.min(r.height,e)+"px"}}else L.style.width="320px",L.style.height="85vh";if(L.style.maxHeight="90vh",!document.querySelector("#splat-panel-range-css")){const e=document.createElement("style");e.id="splat-panel-range-css",e.textContent='\n      #splat-config-panel input[type="range"]::-webkit-slider-thumb {\n        -webkit-appearance: none;\n        appearance: none;\n        width: 14px;\n        height: 14px;\n        background: var(--panel-brand, hsl(32 95% 44%));\n        border-radius: 50%;\n        cursor: pointer;\n        border: 2px solid var(--panel-background, #18181b);\n      }\n      #splat-config-panel input[type="range"]::-moz-range-thumb {\n        width: 14px;\n        height: 14px;\n        background: var(--panel-brand, hsl(32 95% 44%));\n        border-radius: 50%;\n        cursor: pointer;\n        border: 2px solid var(--panel-background, #18181b);\n      }\n      #splat-config-panel input[type="range"]:hover::-webkit-slider-thumb {\n        transform: scale(1.1);\n      }\n    ',document.head.appendChild(e)}if(!document.querySelector("#splat-panel-css")){const e=document.createElement("link");e.id="splat-panel-css",e.rel="stylesheet",e.href="css/panel.css",document.head.appendChild(e)}const c=e.id.includes("cube")?"cube":e.id.includes("ducky")?"ducky":"room",p=V[c];L.innerHTML=`\n    <div class="panel-header" style="display: none;"></div>\n    <div class="panel-content">\n      <div style="position: relative; margin-bottom: var(--panel-gap, 8px); padding-bottom: var(--panel-gap, 8px); border-bottom: 1px solid var(--panel-border, rgba(255,255,255,0.1));">\n        <div style="font-size: 13px; font-weight: 600; color: var(--panel-foreground, #fff);">\n          ${e.label}\n        </div>\n        <button class="collapse-btn" id="splat-panel-collapse" style="\n          position: absolute;\n          top: 0;\n          right: 0;\n          background: transparent;\n          border: none;\n          color: var(--panel-muted-foreground, #888);\n          padding: 4px 8px;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 12px;\n          width: 28px;\n          height: 28px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        " aria-label="Collapse panel" title="Collapse">▾</button>\n      </div>\n      \n      ${l("Main Parameters",p.main,t)}\n      ${l("Secondary Parameters",p.secondary,t)}\n      ${l("Extra Parameters",p.extra,t)}\n      \n      <div style="margin-top: var(--panel-gap, 8px); padding-top: var(--panel-gap, 8px); border-top: 1px solid var(--panel-border, rgba(255,255,255,0.1)); font-size: 11px; color: var(--panel-muted-foreground, #888);">\n        <kbd>/</kbd> toggle panel · Changes apply instantly\n      </div>\n    </div>\n  `,R.appendChild(L),((e,t,n)=>{[...t.main,...t.secondary,...t.extra].forEach(t=>{const a=e.querySelector("#splat-param-"+t.id);if(!a)return;const o=a.previousElementSibling?.querySelector("span");a.addEventListener("input",e=>{const a=parseFloat(e.target.value);o&&(o.textContent=i(a,t));const l={...n,[t.id]:a};$&&$(T,l)})})})(L,p,t);const u=L.querySelector("#splat-panel-collapse");return u&&u.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),L&&(L.classList.toggle("collapsed"),(t=>{try{localStorage.setItem(_,t+"")}catch(e){}})(L.classList.contains("collapsed")))}),window._splatResizeObserverSetup||(window._splatResizeObserverSetup=!0,(()=>{if("undefined"==typeof ResizeObserver)return;let e=0,t=null;const n=()=>{const n=document.getElementById("splat-config-panel");n&&n!==window._lastObservedPanel&&(window._lastObservedPanel=n,(n=>{if(t&&t.disconnect(),n){t=new ResizeObserver(()=>{n&&R&&(n.classList.contains("collapsed")||(window.clearTimeout(e),e=window.setTimeout(()=>{(e=>{if(e)try{const t=parseInt(e.style.width)||parseInt(window.getComputedStyle(e).width),n=parseInt(e.style.height)||parseInt(window.getComputedStyle(e).height);t&&n&&localStorage.setItem(j,JSON.stringify({width:Math.round(t),height:Math.round(n)}))}catch(t){}})(n)},150)))});try{t.observe(n)}catch(a){}}})(n))};n(),setTimeout(n,100);const a=new MutationObserver(n);R&&a.observe(R,{childList:!0,subtree:!0})})()),L}function n(e){if(e.target.closest("button")||e.target.closest("input")||e.target.closest("select"))return;if(!R)return;const t=e.touches?e.touches[0].clientX:e.clientX,n=e.touches?e.touches[0].clientY:e.clientY,a=R.getBoundingClientRect();F=t,N=n,I=a.left,A=a.top,Y=!1}function a(e){if(0===F&&0===N)return;if(!R)return;const t=(e.touches?e.touches[0].clientX:e.clientX)-F,n=(e.touches?e.touches[0].clientY:e.clientY)-N;if(Y||5>=Math.abs(t)&&5>=Math.abs(n)||(Y=!0,R.classList.add("dragging"),R.style.position="fixed",R.style.top=A+"px",R.style.left=I+"px",R.style.right="auto"),Y){let e=I+t,a=A+n;const o=R.getBoundingClientRect();e=Math.max(0,Math.min(window.innerWidth-o.width,e)),a=Math.max(0,Math.min(window.innerHeight-o.height,a)),R.style.left=e+"px",R.style.top=a+"px"}}function o(){Y&&(Y=!1,R&&R.classList.remove("dragging"),(()=>{try{if(!R)return;localStorage.setItem(X,JSON.stringify({left:R.style.left,top:R.style.top,custom:!0}))}catch(e){}})()),F=0,N=0,setTimeout(()=>{},10)}function l(e,t,n){return t&&0!==t.length?`\n    <details open style="margin-bottom: var(--panel-gap, 8px);">\n      <summary style="\n        font-size: 12px;\n        font-weight: 600;\n        color: var(--panel-foreground, #fff);\n        cursor: pointer;\n        padding: var(--panel-pad-7, 7px);\n        background: var(--panel-muted, rgba(255,255,255,0.05));\n        border-radius: var(--panel-radius-sm, 6px);\n        user-select: none;\n        list-style: none;\n      ">\n        ${e}\n      </summary>\n      <div style="padding: var(--panel-pad-7, 7px); display: flex; flex-direction: column; gap: var(--panel-control-gap, 6px);">\n        ${t.map(e=>((e,t)=>{const n=void 0!==t[e.id]?t[e.id]:e.default;return`\n    <div style="display: flex; flex-direction: column; gap: 2px;">\n      <div style="display: flex; justify-content: space-between; align-items: center;">\n        <label style="font-size: 11px; color: var(--panel-foreground, #fff);">${e.label}</label>\n        <span style="font-size: 11px; font-variant-numeric: tabular-nums; color: var(--panel-muted-foreground, #888); min-width: 60px; text-align: right;">\n          ${i(n,e)}\n        </span>\n      </div>\n        <input \n        type="range" \n        id="splat-param-${e.id}"\n        min="${e.min}" \n        max="${e.max}" \n        step="${e.step}" \n        value="${n}"\n        style="\n          width: 100%;\n          height: 6px;\n          background: var(--panel-muted, rgba(255,255,255,0.1));\n          border-radius: 3px;\n          outline: none;\n          -webkit-appearance: none;\n          cursor: pointer;\n        "\n        oninput="this.style.setProperty('--thumb-pos', ((this.value - this.min) / (this.max - this.min) * 100) + '%')"\n      />\n    </div>\n  `})(e,n)).join("")}\n      </div>\n    </details>\n  `:""}function i(e,t){const n=parseFloat(e);return isNaN(n)?"0":1>t.step?n.toFixed(.01>t.step?3:.1>t.step?2:1):""+Math.round(n)}function s(n,a){$&&(t(n,a,$),R&&(R.classList.remove("hidden"),e(!1)))}function r(e){const t=document.getElementById("splat-variant-label");t&&(t.textContent="NEW SIMULATIONS · "+(e?.label||""))}function d(e){let t=e;return()=>(t=(9301*t+49297)%233280,t/233280)}function c(e,t,n,a=null){const o={x:e.x*t.modelScalePx,y:e.y*t.modelScalePx,z:e.z*t.modelScalePx};let l=t.rotX,i=t.rotY,s=t.rotZ,r=0,d=0,c=0;if(null!==a&&-1===a&&t.hasDualCubes){l=t.rotXOuter||0,i=t.rotYOuter||0,s=t.rotZOuter||0;const e=t.modelScalePx*(q?.config?.orbitRadius||.08),n=t.orbitTime||0;r=Math.sin(n)*e,d=Math.cos(.7*n)*e*.6,c=Math.sin(.9*n)*e*.3,o.x+=r,o.y+=d,o.z+=c}const p=((e,t,n,a)=>{let{x:o,y:l,z:i}=e;const s=Math.cos(n),r=Math.sin(n),d=o*s-i*r,c=o*r+i*s,p=Math.cos(t),u=Math.sin(t),m=l*p-c*u,f=l*u+c*p,h=Math.cos(a),b=Math.sin(a);return{x:d*h-m*b,y:d*b+m*h,z:f}})(o,l,i,s),u=Math.max(120,t.focalLength),m=u/(u+(p.z+t.depth));return{x:t.centerX+p.x*m,y:t.centerY+p.y*m,scale:m}}function p(e){const t=S(),n=t.canvas;if(!n)return;D(),q=e;const a=e.pointSource(e.config.pointCount,e.config),o=k(t,(t.R_MED||18)*(e.config.baseRadiusScale||.22)*(t.DPR||1)),l=e.config.modelScale,i=e.config.cameraPanSpeed?.45:.32,s=Math.min(n.width,n.height)*i*l,r=a.some(e=>void 0!==e.t),d=a.some(e=>e.o);t.splatTestState={centerX:.5*n.width,centerY:n.height*(.5+(e.config.centerOffsetY||0)),depth:e.config.cameraPanSpeed?120*Math.max(.6,l):220*Math.max(.6,l),modelScaleFactor:l,modelScalePx:s,baseRadius:o,lastCanvasWidth:n.width,lastCanvasHeight:n.height,rotX:0,rotY:0,rotZ:0,rotXOuter:0,rotYOuter:0,rotZOuter:0,tumbleX:0,tumbleY:0,tumbleXOuter:0,tumbleYOuter:0,prevMouseX:null,prevMouseY:null,focalLength:e.config.focalLength,idleSpeed:e.config.idleSpeed,tumbleSpeed:e.config.tumbleSpeed||0,tumbleDamping:e.config.tumbleDamping||1,tumbleDampingOuter:e.config.tumbleDamping?.992*e.config.tumbleDamping:.979104,cameraPanSpeed:e.config.cameraPanSpeed||0,cameraPanX:0,cameraPanY:0,orbitTime:0,hasDualCubes:r,floatTime:0,floatAmplitude:e.config.floatAmplitude||12,floatSpeed:e.config.floatSpeed||.8,isDucky:d,points:a};for(let c=0;a.length>c;c++){const e=P(0,0);e&&(e.vx=0,e.vy=0,e.omega=0,e.r=o,e.l=a[c],e.i=o,void 0!==a[c].t&&(e.t=a[c].t),e.isSleeping=!1)}t.currentMode=C.SPHERE_3D}function u(e,t){const n={x:e.x*t.modelScalePx,y:e.y*t.modelScalePx,z:e.z*t.modelScalePx},a=n.x-(t.cameraPanX||0),o=n.y-(t.cameraPanY||0),l=n.z,i=Math.max(120,t.focalLength),s=i/(i+(l+t.depth));return{x:t.centerX+a*s,y:t.centerY+o*s,scale:s}}function m(e,t){e.config={...e.config,...t};const n=S(),a=n.splatTestState;a&&(void 0!==t.floatAmplitude&&(a.floatAmplitude=t.floatAmplitude),void 0!==t.floatSpeed&&(a.floatSpeed=t.floatSpeed),void 0!==t.centerOffsetY&&(a.centerY=n.canvas.height*(.5+t.centerOffsetY)),void 0!==t.focalLength&&(a.focalLength=t.focalLength),void 0!==t.idleSpeed&&(a.idleSpeed=t.idleSpeed),void 0!==t.tumbleSpeed&&(a.tumbleSpeed=t.tumbleSpeed),void 0!==t.tumbleDamping&&(a.tumbleDamping=t.tumbleDamping,a.tumbleDampingOuter=.992*t.tumbleDamping),void 0!==t.cameraPanSpeed&&(a.cameraPanSpeed=t.cameraPanSpeed),void 0!==t.baseRadiusScale&&(a.baseRadius=k(n,(n.R_MED||18)*t.baseRadiusScale*(n.DPR||1)),n.balls.forEach(e=>{void 0!==e.i&&(e.i=a.baseRadius)}))),p(e),s(e,e.config)}import{d as f,e as h,f as b,j as x,n as g,S as y,k as v,o as M,g as S,q as z,ab as w,ac as D,ad as k,ae as P,M as C,V as O}from"./shared.js";const V={cube:{main:[{id:"pointCount",label:"Point Count",min:200,max:2e3,step:50,default:800},{id:"modelScale",label:"Model Scale",min:.5,max:2.5,step:.1,default:1.2},{id:"focalLength",label:"Focal Length",min:400,max:1500,step:50,default:850},{id:"cubeSize",label:"Cube Size",min:.3,max:1.5,step:.05,default:.8}],secondary:[{id:"idleSpeed",label:"Idle Speed",min:0,max:.1,step:.005,default:.025},{id:"tumbleSpeed",label:"Tumble Speed",min:0,max:10,step:.2,default:4.2},{id:"tumbleDamping",label:"Tumble Damping",min:.9,max:.999,step:.001,default:.987},{id:"baseRadiusScale",label:"Dot Size",min:.1,max:.5,step:.01,default:.22}],extra:[{id:"centerOffsetY",label:"Center Y Offset",min:-.1,max:.1,step:.01,default:0},{id:"orbitRadius",label:"Orbit Radius",min:0,max:.2,step:.01,default:.08},{id:"orbitSpeed",label:"Orbit Speed",min:0,max:2,step:.1,default:.5}]},ducky:{main:[{id:"pointCount",label:"Point Count",min:500,max:3e3,step:100,default:1400},{id:"modelScale",label:"Model Scale",min:.5,max:2,step:.1,default:1},{id:"focalLength",label:"Focal Length",min:600,max:1500,step:50,default:920},{id:"baseRadiusScale",label:"Dot Size",min:.1,max:.5,step:.01,default:.22}],secondary:[{id:"idleSpeed",label:"Idle Speed",min:0,max:.1,step:.005,default:.02},{id:"tumbleSpeed",label:"Tumble Speed",min:0,max:10,step:.2,default:2},{id:"tumbleDamping",label:"Tumble Damping",min:.9,max:.999,step:.001,default:.95},{id:"floatAmplitude",label:"Float Amplitude",min:0,max:30,step:1,default:12}],extra:[{id:"floatSpeed",label:"Float Speed",min:.1,max:3,step:.1,default:.8},{id:"bodyDensity",label:"Body Density",min:.3,max:.6,step:.05,default:.45},{id:"headDensity",label:"Head Density",min:.15,max:.35,step:.05,default:.25}]},room:{main:[{id:"pointCount",label:"Point Count",min:1e3,max:5e3,step:200,default:2e3},{id:"modelScale",label:"Model Scale",min:1,max:4,step:.1,default:2.8},{id:"focalLength",label:"Focal Length",min:400,max:1200,step:50,default:600},{id:"cameraPanSpeed",label:"Pan Speed",min:0,max:1,step:.05,default:.3}],secondary:[{id:"boxWidth",label:"Room Width",min:1.5,max:4,step:.1,default:2.4},{id:"boxHeight",label:"Room Height",min:.8,max:2.5,step:.1,default:1.4},{id:"boxDepth",label:"Room Depth",min:2,max:6,step:.2,default:4.2},{id:"baseRadiusScale",label:"Dot Size",min:.1,max:.5,step:.01,default:.22}],extra:[{id:"idleSpeed",label:"Idle Speed",min:0,max:.05,step:.005,default:.015},{id:"furnitureDensity",label:"Furniture Density",min:.05,max:.3,step:.05,default:.17},{id:"wallDensity",label:"Wall Density",min:.1,max:.3,step:.05,default:.15}]}};let R=null,L=null,T=null,$=null,F=0,N=0,I=0,A=0,Y=!1;const X="splat_panel_position",_="splat_panel_collapsed",W="splat_panel_hidden",j="splat_panel_size",E={sizeVariationGlobalMul:0,sizeVariationPit:0,sizeVariationFlies:0,sizeVariationWeightless:0,sizeVariationWater:0,sizeVariationVortex:0,sizeVariationPingPong:0,sizeVariationMagnetic:0,sizeVariationBubbles:0,sizeVariationKaleidoscope:0,sizeVariationCritters:0,sizeVariationNeural:0,sizeVariationParallaxLinear:0,sphere3dDotSizeMul:1.2},H=[{id:"splat-variant-a",label:"Variant A · Perfect Cube",pointSource(e,t={}){const n=t.cubeSize||.8,a=1.6*n,o=[],l=Math.floor(.5*e),i=e-l,s=(e,t,n={x:0,y:0,z:0})=>{const a=.5*e,o=[],l=Math.max(4,Math.floor(t/12)),i=(t,a,o)=>{const l=.015/e,i=l+o*(1-2*l);return{x:t.x+(a.x-t.x)*i+n.x,y:t.y+(a.y-t.y)*i+n.y,z:t.z+(a.z-t.z)*i+n.z}},s=[{x:-a,y:-a,z:-a},{x:a,y:-a,z:-a},{x:-a,y:a,z:-a},{x:a,y:a,z:-a},{x:-a,y:-a,z:a},{x:a,y:-a,z:a},{x:-a,y:a,z:a},{x:a,y:a,z:a}],r=[[0,1],[2,3],[4,5],[6,7],[0,2],[1,3],[4,6],[5,7],[0,4],[1,5],[2,6],[3,7]];for(const[d,c]of r){const e=s[d],t=s[c];for(let n=0;l>n;n++)o.push(i(e,t,n/(l-1)))}return o},r=s(n,l);o.push(...r);const d=s(a,i);return o.push(...d),o.forEach((e,t)=>{e.t=r.length>t?1:-1}),o},config:{pointCount:800,modelScale:1.2,focalLength:850,idleSpeed:.025,tumbleSpeed:4.2,tumbleDamping:.987,cubeSize:.8}},{id:"splat-variant-b",label:"Variant B · Rubber Ducky",pointSource(e,t={}){const n=d(t.seed||42),a=[],o=Math.floor(e*(t.bodyDensity||.45));for(let d=0;o>d;d++){const e=n()*J,t=Math.acos(2*n()-1),o=.35+.12*n();a.push({x:o*Math.sin(t)*Math.cos(e)*1.15,y:-(o*Math.cos(t)*.85-.08),z:o*Math.sin(t)*Math.sin(e)*.88})}const l=Math.floor(e*(t.headDensity||.25)),i=.24;for(let d=0;l>d;d++){const e=n()*J,t=Math.acos(2*n()-1);a.push({x:i*Math.sin(t)*Math.cos(e)+.35,y:i*Math.cos(t)-.18,z:i*Math.sin(t)*Math.sin(e)*.95})}const s=Math.floor(.12*e);for(let d=0;s>d;d++)a.push({x:.5+.14*n(),y:.1*n()-.05-.14,z:.18*n()-.09});const r=Math.floor(.06*e);for(let d=0;r>d;d++){const e=n()*J,t=.1*n();a.push({x:t*Math.cos(e)-.4,y:.04+t*Math.sin(e)*.6,z:.22*n()-.11})}const c=Math.floor(.12*e);for(let d=0;c>d;d++){const e=d%2==0?1:-1,t=n()*J*.6,o=n()*Math.PI*.5,l=.14+.08*n();a.push({x:(.35*n()-.1)*e,y:.03+l*Math.cos(o),z:.3*e+l*Math.sin(o)*Math.sin(t)})}return a.forEach(e=>{e.o=!0}),a},config:{pointCount:1400,modelScale:1,focalLength:920,idleSpeed:.02,tumbleSpeed:2,tumbleDamping:.95}},{id:"splat-variant-c",label:"Variant C · Shoebox Room",pointSource(e,t={}){const n=d(t.seed||13),a=[],o=t.boxWidth||2.4,l=t.boxHeight||1.4,i=t.boxDepth||4.2,s=t.wallDensity||.15,r=t.furnitureDensity||.17,c=Math.floor(e*s);for(let d=0;c>d;d++)a.push({x:n()*o-.5*o,y:.5*-l,z:n()*i-.5*i});const p=Math.floor(.8*e*s);for(let d=0;p>d;d++)a.push({x:n()*o-.5*o,y:.5*l,z:n()*i-.5*i});const u=Math.floor(.93*e*s);for(let d=0;u>d;d++)a.push({x:n()*o-.5*o,y:n()*l-.5*l,z:.5*-i});const m=Math.floor(.8*e*s);for(let d=0;m>d;d++)a.push({x:.5*-o,y:n()*l-.5*l,z:n()*i-.5*i});const f=Math.floor(.8*e*s);for(let d=0;f>d;d++)a.push({x:.5*o,y:n()*l-.5*l,z:n()*i-.5*i});const h=Math.floor(.08*e),b=.35*-i,x=.25*-o,g=.15;for(let d=0;h>d;d++).7>n()?a.push({x:x+(.6*n()-.3),y:.5*-l+g,z:b+(.18*n()-.09)}):a.push({x:x+(.6*n()-.3),y:.5*-l+g+n()*g*1.2,z:b-.09});const y=Math.floor(.05*e),v=.45*-i,M=.25*o;for(let d=0;y>d;d++)a.push({x:M+(.5*n()-.25),y:.5*-l+.25+.35*n(),z:v});const S=Math.floor(.04*e),z=.15*-o,w=.25*-i;for(let d=0;S>d;d++)if(.6>n())a.push({x:z+(.06*n()-.03),y:.5*-l+.5*n()*l,z:w+(.06*n()-.03)});else{const e=.1*l,t=n()*J,o=.08+.05*n();a.push({x:z+o*Math.cos(t),y:e+.08*n(),z:w+o*Math.sin(t)})}const D=Math.floor(e*r);for(let d=0;D>d;d++){const e=n();if(.3>e)a.push({x:1.4*n()-.7,y:.5*-l+.08+.12*n(),z:n()*i*.8-.4*i});else if(.5>e){const e=Math.floor(3*n());a.push(0===e?{x:1.6*n()-.8,y:.8*n()-.4,z:.48*-i}:1===e?{x:.48*-o,y:.8*n()-.4,z:n()*i*.9-.45*i}:{x:.48*o,y:.8*n()-.4,z:n()*i*.9-.45*i})}else a.push({x:1.6*n()-.8,y:.6*n()-.3,z:n()*i*.7-.35*i})}return a},config:{pointCount:2e3,modelScale:2.8,focalLength:600,idleSpeed:.015,tumbleSpeed:0,tumbleDamping:1,cameraPanSpeed:.3}}],J=2*Math.PI;let q=null;(async()=>{const n=await f();h({...n,...E}),b(),x();const a=v(),o=y(),l=document.getElementById("bravia-balls");if(!a||!o||!l)return void console.error("Splat test: missing canvas/container");g(a,o,l),M();const i=S();i.clickCycleEnabled=!1,i.mouseInCanvas=!1,z(),w("industrialTeal"),(n=>{const a=v();if(!a||0===n.length)return;let o=0;const l=n[o];p(l),r(l),t(l,l.config,m),a.addEventListener("click",e=>{const t=a.getBoundingClientRect(),l=e.clientX,i=e.clientY;!(t.left>l||l>t.right||t.top>i||i>t.bottom)&&(()=>{o=(o+1)%n.length;const e=n[o];p(e),r(e),s(e,e.config)})()}),window._splatPanelKeyBound||(window._splatPanelKeyBound=!0,document.addEventListener("keydown",t=>{const n=document.activeElement&&("INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||document.activeElement.isContentEditable);"/"!==t.key||t.shiftKey||t.ctrlKey||t.metaKey||n||(t.preventDefault(),(()=>{if(R){const t=R.classList.contains("hidden");R.classList.toggle("hidden",!t),e(!t)}})())}))})(H),(()=>{let e=performance.now();const t=n=>{const a=Math.min(.033,(n-e)/1e3);e=n,(e=>{const t=S(),n=t.splatTestState,a=t.canvas;if(!n||!a)return;a.width===n.lastCanvasWidth&&a.height===n.lastCanvasHeight||(n.lastCanvasWidth=a.width,n.lastCanvasHeight=a.height,((e,t,n)=>{const a=e.cameraPanSpeed?.45:.32,o=Math.min(n.width,n.height)*a*e.modelScaleFactor,l=k(t,(t.R_MED||18)*(q?.config?.baseRadiusScale||.22)*(t.DPR||1));if(.001>=Math.abs(o-e.modelScalePx)&&.001>=Math.abs(l-e.baseRadius))return;e.modelScalePx=o,e.baseRadius=l;const i=t.balls;for(let s=0;i.length>s;s++){const e=i[s];e&&e.l&&(e.i=l)}})(n,t,a)),n.centerX=.5*a.width,n.centerY=.52*a.height;const o=void 0!==n.cameraPanSpeed&&n.cameraPanSpeed>0;if(o){if(t.mouseInCanvas){const e=200*n.cameraPanSpeed,o=(t.mouseY-n.centerY)/(.5*a.height);n.cameraPanX=(t.mouseX-n.centerX)/(.5*a.width)*e,n.cameraPanY=o*e}else n.cameraPanX=.95*(n.cameraPanX||0),n.cameraPanY=.95*(n.cameraPanY||0);n.rotY+=n.idleSpeed*e*.1,n.rotX=0,n.rotZ=0}else{if(t.mouseInCanvas){const e=t.mouseX-(n.prevMouseX??t.mouseX),a=t.mouseY-(n.prevMouseY??t.mouseY);n.prevMouseX=t.mouseX,n.prevMouseY=t.mouseY;const o=.0028*n.tumbleSpeed;n.hasDualCubes?(n.tumbleY+=-e*o,n.tumbleX+=a*o,n.tumbleYOuter+=e*o*.85,n.tumbleXOuter+=-a*o*.85):(n.tumbleY+=e*o,n.tumbleX+=-a*o)}else n.prevMouseX=null,n.prevMouseY=null;if(n.hasDualCubes){n.tumbleX*=n.tumbleDamping,n.tumbleY*=n.tumbleDamping,n.rotY+=(n.idleSpeed+n.tumbleY)*e,n.rotX+=(.7*n.idleSpeed+n.tumbleX)*e,n.rotZ+=.2*n.idleSpeed*e;const t=n.tumbleDampingOuter||.992*n.tumbleDamping;n.tumbleXOuter*=t,n.tumbleYOuter*=t,n.rotYOuter+=(n.idleSpeed+n.tumbleYOuter)*e,n.rotXOuter+=(.7*n.idleSpeed+n.tumbleXOuter)*e,n.rotZOuter+=.2*n.idleSpeed*e}else n.tumbleX*=n.tumbleDamping,n.tumbleY*=n.tumbleDamping,n.rotY+=(n.idleSpeed+n.tumbleY)*e,n.rotX+=(.7*n.idleSpeed+n.tumbleX)*e,n.rotZ+=.2*n.idleSpeed*e}void 0!==n.orbitTime&&(n.orbitTime+=e*(q?.config?.orbitSpeed||.5)),n.isDucky&&void 0!==n.floatTime&&(n.floatTime+=e*n.floatSpeed);const l=t.balls;for(let i=0;l.length>i;i++){const e=l[i],a=e.l;if(!a)continue;const s=void 0!==e.t?e.t:null;let r=o?u(a,n):c(a,n,0,s);if(n.isDucky&&a.o){const e=Math.sin(n.floatTime)*n.floatAmplitude;r={...r,y:r.y+e}}e.x=r.x,e.y=r.y,e.r=k(t,e.i*r.scale),e.vx=0,e.vy=0,e.omega=0,e.isSleeping=!1}})(a),O(),requestAnimationFrame(t)};requestAnimationFrame(t)})()})();