function t(t){const e=c(),o=r;if(!o||!o.length)return;const n=o.indexOf(e?.currentMode||d.PIT),i=o[((0>n?0:n)+t+o.length)%o.length];s(i),Z(i)}function e(){w()}function o(t){const e=document.documentElement;void 0!==t.topLogoWidthVw&&e.style.setProperty("--top-logo-width-vw",t.topLogoWidthVw+""),void 0!==t.noiseSize&&e.style.setProperty("--noise-size",t.noiseSize+"px"),void 0!==t.noiseOpacityLight&&e.style.setProperty("--noise-opacity-light",t.noiseOpacityLight+""),void 0!==t.noiseOpacityDark&&e.style.setProperty("--noise-opacity-dark",t.noiseOpacityDark+""),void 0!==t.noiseBlendMode&&e.style.setProperty("--noise-blend-mode",t.noiseBlendMode+""),void 0!==t.noiseColorLight&&e.style.setProperty("--noise-color-light",t.noiseColorLight+""),void 0!==t.noiseColorDark&&e.style.setProperty("--noise-color-dark",t.noiseColorDark+"")}function n(t={}){const e=document.getElementById("abs-scene");if(!e)return Promise.resolve();const o=c(),n=t.delay??o?.contentFadeInDelay??500,i=t.duration??o?.contentFadeInDuration??1e3,a=t.easing??"cubic-bezier(0.16, 1, 0.3, 1)";return new Promise(t=>{let o=!1;const r=()=>{if(!o){o=!0;try{e.style.opacity="1",e.style.visibility="visible",e.style.willChange="auto";const t=document.getElementById("fade-blocking");t&&t.remove()}catch(n){}t()}},s=()=>{const t=document.getElementById("fade-blocking");if(t&&t.remove(),e.style.visibility="visible",e.style.willChange="opacity",e.style.opacity="0","function"==typeof e.animate){const t=e.animate([{opacity:0},{opacity:1}],{duration:i,easing:a,fill:"forwards"});t.addEventListener("finish",r),t.addEventListener("cancel",r)}else e.style.transition=`opacity ${i}ms ${a}`,requestAnimationFrame(()=>{e.style.opacity="1"}),window.setTimeout(r,i+50)};n>0?setTimeout(s,n):s()})}import{i,r as a,N as r,s,g as c,M as d,p as l,l as u,a as m,b,m as p,c as h,d as f,e as g,f as w,h as y,j as v,k,n as M,o as z,q as N,t as x,u as T,v as E,w as A,x as j,y as C,z as P,A as F,B as S,C as $,D as B,E as I,F as L,G as O,H as V,I as D,J as R,K as U,L as _,O as W,P as q,Q as H,R as K,S as Q,T as G,U as J,V as X,W as Y}from"./shared.js";import{u as Z}from"./controls.js";import{applyExpertiseLegendColors as tt}from"./legend-colors.js";let et=!1,ot=!1;window.addEventListener("error",t=>{t.message&&t.message.includes("Failed to fetch")&&t.preventDefault()}),window.addEventListener("unhandledrejection",t=>{t.reason?.message&&t.reason.message.includes("Failed to fetch")&&t.preventDefault()}),(async()=>{document.documentElement.classList.add("js-enabled");try{await u(),m()}catch(e){}try{b("BouncyBalls bootstrap"),p("bb:start"),h("üöÄ Initializing modular bouncy balls...");const u=await f();g(u),p("bb:config"),h("‚úì Config loaded");try{const t=c();"undefined"!=typeof window&&(window.REST=t.REST,window.FRICTION=t.FRICTION,window.MAX_BALLS=t.maxBalls,window.repelRadius=t.repelRadius,window.repelPower=t.repelPower)}catch(e){}w(),h("‚úì Layout applied"),o(u),h("‚úì Visual effects configured");try{const t=c(),e=document.documentElement;if(Number.isFinite(t?.topLogoWidthVw)&&e.style.setProperty("--top-logo-width-vw",t.topLogoWidthVw+""),Number.isFinite(t?.homeMainLinksBelowLogoPx)&&e.style.setProperty("--home-main-links-below-logo-px",t.homeMainLinksBelowLogoPx+""),Number.isFinite(t?.footerNavBarTopVh)&&(e.style.setProperty("--footer-nav-bar-top",t.footerNavBarTopVh+"vh"),e.style.setProperty("--footer-nav-bar-top-svh",t.footerNavBarTopVh+"svh"),e.style.setProperty("--footer-nav-bar-top-dvh",t.footerNavBarTopVh+"dvh")),Number.isFinite(t?.footerNavBarGapVw)){const o=Math.round(9.6*t.footerNavBarGapVw);e.style.setProperty("--footer-nav-bar-gap",`clamp(${o}px, ${t.footerNavBarGapVw}vw, ${Math.round(1.67*o)}px)`)}Number.isFinite(t?.uiHitAreaMul)&&e.style.setProperty("--ui-hit-area-mul",t.uiHitAreaMul+""),Number.isFinite(t?.uiIconCornerRadiusMul)&&e.style.setProperty("--ui-icon-corner-radius-mul",t.uiIconCornerRadiusMul+""),Number.isFinite(t?.uiIconFramePx)&&Math.round(t.uiIconFramePx)>0&&e.style.setProperty("--ui-icon-frame-size",Math.round(t.uiIconFramePx)+"px"),Number.isFinite(t?.uiIconGlyphPx)&&Math.round(t.uiIconGlyphPx)>0&&e.style.setProperty("--ui-icon-glyph-size",Math.round(t.uiIconGlyphPx)+"px"),Number.isFinite(t?.linkTextPadding)&&(e.style.setProperty("--link-text-padding",Math.round(t.linkTextPadding)+"px"),e.style.setProperty("--link-text-margin",-Math.round(t.linkTextPadding)+"px")),Number.isFinite(t?.linkIconPadding)&&(e.style.setProperty("--link-icon-padding",Math.round(t.linkIconPadding)+"px"),e.style.setProperty("--link-icon-margin",-Math.round(t.linkIconPadding)+"px")),Number.isFinite(t?.linkColorInfluence)&&e.style.setProperty("--link-color-influence",t.linkColorInfluence+""),Number.isFinite(t?.linkImpactScale)&&e.style.setProperty("--link-impact-scale",t.linkImpactScale+""),Number.isFinite(t?.linkImpactBlur)&&e.style.setProperty("--link-impact-blur",t.linkImpactBlur+"px"),Number.isFinite(t?.linkImpactDuration)&&e.style.setProperty("--link-impact-duration",Math.round(t.linkImpactDuration)+"ms"),void 0!==t?.hoverSnapEnabled&&e.style.setProperty("--abs-hover-snap-enabled",t.hoverSnapEnabled?"1":"0"),Number.isFinite(t?.hoverSnapDuration)&&e.style.setProperty("--abs-hover-snap-duration",Math.max(0,Math.round(t.hoverSnapDuration))+"ms"),Number.isFinite(t?.hoverSnapOvershoot)&&e.style.setProperty("--abs-hover-snap-overshoot",t.hoverSnapOvershoot+""),Number.isFinite(t?.hoverSnapUndershoot)&&e.style.setProperty("--abs-hover-snap-undershoot",t.hoverSnapUndershoot+"")}catch(e){}document.querySelector(".noise");try{y(c())}catch(e){}v();const m=k(),it=Q(),at=document.getElementById("bravia-balls");if(!m||!it||!at)throw Error("Missing DOM elements");try{const t=document.getElementById("brand-logo");t&&t.parentElement!==at&&at.prepend(t)}catch(e){}try{m.setAttribute("role","application"),m.getAttribute("aria-label")||m.setAttribute("aria-label","Interactive bouncy balls physics simulation")}catch(e){}M(m,it,at),z(),p("bb:renderer"),h("‚úì Canvas initialized (container-relative sizing)"),c().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),N(),h("‚úì Pointer tracking configured"),"undefined"!=typeof document&&document.addEventListener("touchmove",t=>{var e;(e=t.target)instanceof Element&&(e.closest(".panel-dock .panel .panel-content")||e.closest("#controlPanel"))||t.preventDefault()},{passive:!1,capture:!0}),h("‚úì Overscroll lock configured"),x(),p("bb:input"),h("‚úì Custom cursor initialized"),T(),E(),A(),j(),C();try{P(u)}catch(e){}h("‚úì Sound engine primed (awaiting user unlock)"),"undefined"!=typeof window&&(ot||(ot=!0,window.addEventListener("bb:modeChanged",t=>{const e=c();if(!1===e?.sceneChangeSoundEnabled)return;const o=t?.detail||{};o.prevMode&&o.mode&&o.prevMode!==o.mode&&l(+(e?.sceneChangeSoundRadius??18),+(e?.sceneChangeSoundIntensity??.35),.5,null)},{passive:!0}))),p("bb:ui"),h("‚úì UI initialized (panel disabled in production)"),F(),p("bb:theme"),tt(),(()=>{try{"undefined"!=typeof window&&(window.legendFilter||(window.legendFilter={}),window.legendFilter.syncAllBalls=()=>{})}catch(e){}try{const t=document.getElementById("expertise-legend"),e=document.getElementById("legend-tooltip-output");if(!t)return;const o=Array.from(t.querySelectorAll(".legend__item"));for(const n of o)n&&(n.classList.add("legend__item--interactive"),e&&(n.addEventListener("mouseenter",()=>{const t=n.getAttribute("data-tooltip");t&&(e.textContent=t,e.style.opacity="1",e.style.visibility="visible")}),n.addEventListener("mouseleave",()=>{e.style.opacity="0",window.setTimeout(()=>{"0"===e.style.opacity&&(e.style.visibility="hidden")},50)})));e&&(e.style.visibility="hidden",e.style.opacity="0")}catch(e){}})(),h("‚úì Legend filter system configured"),et||(et=!0,window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName))return;const o=e.key.toLowerCase();if("/"!==o&&"Slash"!==e.code){if("r"!==o)return"ArrowRight"===e.key?(e.preventDefault(),void t(1)):"ArrowLeft"===e.key?(e.preventDefault(),void t(-1)):void 0;e.preventDefault(),a();try{const t=c();Z(t.currentMode)}catch(e){}}else{if(e.preventDefault(),!i())return;import("./panel-dock.js").then(t=>{try{t.toggleDock?.()}catch(e){}}).catch(()=>{})}}),window.addEventListener("contextmenu",e=>{const o=e.target;"A"===o.tagName||"BUTTON"===o.tagName||o.closest("a")||o.closest("button")||o.closest(".panel")||"panelDock"===o.id||"masterPanel"===o.id||"dockToggle"===o.id||(e.preventDefault(),t(-1))})),h("‚úì Keyboard shortcuts registered");try{S(u),h("‚úì Modal overlay system initialized")}catch(e){console.warn("Modal overlay initialization error:",e?.message)}try{$(),h("‚úì CV password gate initialized")}catch(e){console.warn("CV gate initialization error:",e?.message)}try{B(),h("‚úì Portfolio password gate initialized")}catch(e){console.warn("Portfolio gate initialization error:",e?.message)}try{I(),h("‚úì Contact gate initialized")}catch(e){console.warn("Contact gate initialization error:",e?.message)}L(),O(),(()=>{try{const t=document.getElementById("cv-gate-trigger");if(t&&!t.querySelector(".footer-link-nowrap")){const e=((G("footer.links.cv.text","")||"")+"").trim(),o=(t.textContent||"").trim().replace(/\s+/g," "),n=e||o;n&&n.includes("/")&&o===n&&(t.innerHTML=`<span class="footer-link-nowrap">${n}</span>`)}}catch(e){}})(),V(),h("‚úì Sound toggle button created"),h("‚úì Theme toggle button created");const rt=r[Math.floor(Math.random()*r.length)];D?.("startup"),s(rt);try{const t=await import("./controls.js").then(t=>t.h);t.updateModeButtonsUI?.(rt)}catch(e){}p("bb:mode"),h("‚úì Mode initialized"),J(Y),R(null,{getForcesFn:X}),p("bb:end"),h("‚úÖ Bouncy Balls running (modular)");const st=[{phase:"config",ms:U("bb:m:config","bb:start","bb:config")},{phase:"renderer",ms:U("bb:m:renderer","bb:config","bb:renderer")},{phase:"input",ms:U("bb:m:input","bb:renderer","bb:input")},{phase:"ui",ms:U("bb:m:ui","bb:input","bb:ui")},{phase:"theme",ms:U("bb:m:theme","bb:ui","bb:theme")},{phase:"mode+loop",ms:U("bb:m:mode","bb:theme","bb:mode")},{phase:"total",ms:U("bb:m:total","bb:start","bb:end")}].filter(t=>"number"==typeof t.ms);st.length&&_(st.map(t=>({...t,ms:+t.ms.toFixed(2)}))),W();try{i()?q():H()}catch(d){try{console.error("Banner print error:",d),console.log("%cCurious mind detected. Design meets engineering at 60fps.","color: #888; font-style: italic;")}catch(e){}}try{const{orchestrateEntrance:t,revealAllLateElements:o}=await import("./shared.js").then(t=>t.aP),{getModalToAutoOpen:i,shouldSkipWallAnimation:a,resetTransitionState:r,setupPrefetchOnHover:s,initSpeculativePrefetch:d,didViewTransitionRun:l}=await import("./shared.js").then(t=>t.aO),u=c(),m=!!window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,b=i(),p=a(),h=l();window.addEventListener("pageshow",t=>{if(t.persisted){r();const t=document.getElementById("abs-scene");t&&(t.style.opacity="1")}});const f=document.getElementById("cv-gate-trigger"),g=document.getElementById("portfolio-gate-trigger");if(f&&s(f,"cv.html"),g&&s(g,"portfolio.html"),!u.entranceEnabled||m){try{await K()}catch(e){}await n(),o(),console.log("‚úì Entrance animation skipped (disabled or reduced motion)")}else await t({async waitForFonts(){try{await K()}catch(e){}},skipWallAnimation:p,skipEntranceAnimation:h}),console.log(h?"‚úì Entrance skipped (View Transition handled it)":p?"‚úì Quick entrance (returning from internal page)":"‚úì Dramatic entrance animation orchestrated");"cv"===b?setTimeout(()=>{const t=document.getElementById("cv-gate-trigger");t&&t.click()},400):"contact"===b&&setTimeout(()=>{const t=document.getElementById("contact-trigger");t&&t.click()},400),d()}catch(e){console.warn("‚ö†Ô∏è Entrance animation failed, falling back to simple fade:",e);try{await K()}catch(e){}await n();try{const{revealAllLateElements:t}=await import("./shared.js").then(t=>t.aP);t()}catch(nt){["main-links","brand-logo"].forEach(t=>{const e=document.getElementById(t);e&&(e.style.removeProperty("opacity"),"brand-logo"===t&&e.style.removeProperty("filter"),e.style.visibility="visible")});const t=document.getElementById("fade-blocking");t&&t.remove()}}}catch(it){console.error("‚ùå Initialization failed:",it),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${it.message}\n${it.stack}</pre>\n    </div>`}})();export{e as applyFramePaddingCSSVars,o as applyVisualCSSVars};