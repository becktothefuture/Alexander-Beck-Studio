function t(t){const e=d(),o=s;if(!o||!o.length)return;const n=o.indexOf(e?.currentMode||l.PIT),i=o[((0>n?0:n)+t+o.length)%o.length];c(i),nt(i)}function e(t,e=!0){if(!rt||!st)return;const o=t||u().currentMode,n=m[o];if(n){if(rt.classList.remove("quote-display--hidden"),!e||lt)return ct.textContent=n.quote,dt.textContent=n.author,void st.classList.remove("quote-display__content--entering","quote-display__content--exiting");lt=!0,st.classList.add("quote-display__content--exiting"),setTimeout(()=>{ct.textContent=n.quote,dt.textContent=n.author,st.classList.remove("quote-display__content--exiting"),st.classList.add("quote-display__content--entering"),st.classList.remove("quote-display__content--entering"),setTimeout(()=>{lt=!1},320)},320)}else rt.classList.add("quote-display--hidden")}function o(){k()}function n(t){const e=document.documentElement;void 0!==t.topLogoWidthVw&&e.style.setProperty("--top-logo-width-vw",t.topLogoWidthVw+""),void 0!==t.noiseSize&&e.style.setProperty("--noise-size",t.noiseSize+"px"),void 0!==t.noiseOpacityLight&&e.style.setProperty("--noise-opacity-light",t.noiseOpacityLight+""),void 0!==t.noiseOpacityDark&&e.style.setProperty("--noise-opacity-dark",t.noiseOpacityDark+""),void 0!==t.noiseBlendMode&&e.style.setProperty("--noise-blend-mode",t.noiseBlendMode+""),void 0!==t.noiseColorLight&&e.style.setProperty("--noise-color-light",t.noiseColorLight+""),void 0!==t.noiseColorDark&&e.style.setProperty("--noise-color-dark",t.noiseColorDark+"")}function i(t={}){const e=document.getElementById("abs-scene");if(!e)return Promise.resolve();const o=d(),n=t.delay??o?.contentFadeInDelay??500,i=t.duration??o?.contentFadeInDuration??1e3,a=t.easing??"cubic-bezier(0.16, 1, 0.3, 1)";return new Promise(t=>{let o=!1;const r=()=>{if(!o){o=!0;try{e.style.opacity="1",e.style.visibility="visible",e.style.willChange="auto";const t=document.getElementById("fade-blocking");t&&t.remove()}catch(n){}t()}},s=()=>{const t=document.getElementById("fade-blocking");if(t&&t.remove(),e.style.visibility="visible",e.style.willChange="opacity",e.style.opacity="0","function"==typeof e.animate){const t=e.animate([{opacity:0},{opacity:1}],{duration:i,easing:a,fill:"forwards"});t.addEventListener("finish",r),t.addEventListener("cancel",r)}else e.style.transition=`opacity ${i}ms ${a}`,requestAnimationFrame(()=>{e.style.opacity="1"}),window.setTimeout(r,i+50)};n>0?setTimeout(s,n):s()})}import{i as a,r,N as s,s as c,g as d,M as l,a as u,b as m,p,l as b,c as h,d as g,m as f,e as w,f as y,h as v,j as k,k as _,n as x,o as z,q as M,t as q,u as N,v as T,w as A,x as E,y as C,z as j,A as P,B as F,C as S,D as $,E as B,F as I,G as L,H as O,I as V,J as D,K as R,L as U,O as Q,P as W,Q as H,R as K,S as X,T as G,U as J,V as Y,W as Z,X as tt,Y as et,Z as ot}from"./shared.js";import{updateModeButtonsUI as nt}from"./controls.js";import{applyExpertiseLegendColors as it}from"./legend-colors.js";let at=!1,rt=null,st=null,ct=null,dt=null,lt=!1,ut=!1;window.addEventListener("error",t=>{t.message&&t.message.includes("Failed to fetch")&&t.preventDefault()}),window.addEventListener("unhandledrejection",t=>{t.reason?.message&&t.reason.message.includes("Failed to fetch")&&t.preventDefault()}),(async()=>{document.documentElement.classList.add("js-enabled");try{await b(),h()}catch(o){}try{g("BouncyBalls bootstrap"),f("bb:start"),w("üöÄ Initializing modular bouncy balls...");const m=await y();v(m),f("bb:config"),w("‚úì Config loaded");try{const t=d();"undefined"!=typeof window&&(window.REST=t.REST,window.FRICTION=t.FRICTION,window.MAX_BALLS=t.maxBalls,window.repelRadius=t.repelRadius,window.repelPower=t.repelPower)}catch(o){}k(),w("‚úì Layout applied"),n(m),w("‚úì Visual effects configured");try{const t=d(),e=document.documentElement;if(Number.isFinite(t?.topLogoWidthVw)&&e.style.setProperty("--top-logo-width-vw",t.topLogoWidthVw+""),Number.isFinite(t?.homeMainLinksBelowLogoPx)&&e.style.setProperty("--home-main-links-below-logo-px",t.homeMainLinksBelowLogoPx+""),Number.isFinite(t?.footerNavBarTopVh)&&(e.style.setProperty("--footer-nav-bar-top",t.footerNavBarTopVh+"vh"),e.style.setProperty("--footer-nav-bar-top-svh",t.footerNavBarTopVh+"svh"),e.style.setProperty("--footer-nav-bar-top-dvh",t.footerNavBarTopVh+"dvh")),Number.isFinite(t?.footerNavBarGapVw)){const o=Math.round(9.6*t.footerNavBarGapVw);e.style.setProperty("--footer-nav-bar-gap",`clamp(${o}px, ${t.footerNavBarGapVw}vw, ${Math.round(1.67*o)}px)`)}Number.isFinite(t?.uiHitAreaMul)&&e.style.setProperty("--ui-hit-area-mul",t.uiHitAreaMul+""),Number.isFinite(t?.uiIconCornerRadiusMul)&&e.style.setProperty("--ui-icon-corner-radius-mul",t.uiIconCornerRadiusMul+""),Number.isFinite(t?.uiIconFramePx)&&Math.round(t.uiIconFramePx)>0&&e.style.setProperty("--ui-icon-frame-size",Math.round(t.uiIconFramePx)+"px"),Number.isFinite(t?.uiIconGlyphPx)&&Math.round(t.uiIconGlyphPx)>0&&e.style.setProperty("--ui-icon-glyph-size",Math.round(t.uiIconGlyphPx)+"px"),Number.isFinite(t?.linkTextPadding)&&(e.style.setProperty("--link-text-padding",Math.round(t.linkTextPadding)+"px"),e.style.setProperty("--link-text-margin",-Math.round(t.linkTextPadding)+"px")),Number.isFinite(t?.linkIconPadding)&&(e.style.setProperty("--link-icon-padding",Math.round(t.linkIconPadding)+"px"),e.style.setProperty("--link-icon-margin",-Math.round(t.linkIconPadding)+"px")),Number.isFinite(t?.linkColorInfluence)&&e.style.setProperty("--link-color-influence",t.linkColorInfluence+""),Number.isFinite(t?.linkImpactScale)&&e.style.setProperty("--link-impact-scale",t.linkImpactScale+""),Number.isFinite(t?.linkImpactBlur)&&e.style.setProperty("--link-impact-blur",t.linkImpactBlur+"px"),Number.isFinite(t?.linkImpactDuration)&&e.style.setProperty("--link-impact-duration",Math.round(t.linkImpactDuration)+"ms"),void 0!==t?.hoverSnapEnabled&&e.style.setProperty("--abs-hover-snap-enabled",t.hoverSnapEnabled?"1":"0"),Number.isFinite(t?.hoverSnapDuration)&&e.style.setProperty("--abs-hover-snap-duration",Math.max(0,Math.round(t.hoverSnapDuration))+"ms"),Number.isFinite(t?.hoverSnapOvershoot)&&e.style.setProperty("--abs-hover-snap-overshoot",t.hoverSnapOvershoot+""),Number.isFinite(t?.hoverSnapUndershoot)&&e.style.setProperty("--abs-hover-snap-undershoot",t.hoverSnapUndershoot+"")}catch(o){}document.querySelector(".noise");try{_(d())}catch(o){}x();const b=z(),h=J(),lt=document.getElementById("bravia-balls");if(!b||!h||!lt)throw Error("Missing DOM elements");try{const t=document.getElementById("brand-logo");t&&t.parentElement!==lt&&lt.prepend(t)}catch(o){}try{b.setAttribute("role","application"),b.getAttribute("aria-label")||b.setAttribute("aria-label","Interactive bouncy balls physics simulation")}catch(o){}M(b,h,lt),q(),f("bb:renderer"),w("‚úì Canvas initialized (container-relative sizing)"),d().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),N(),w("‚úì Pointer tracking configured"),"undefined"!=typeof document&&document.addEventListener("touchmove",t=>{var e;(e=t.target)instanceof Element&&(e.closest(".panel-dock .panel .panel-content")||e.closest("#controlPanel"))||t.preventDefault()},{passive:!1,capture:!0}),w("‚úì Overscroll lock configured"),T(),f("bb:input"),w("‚úì Custom cursor initialized"),A(),E(),C(),j(),P();try{F(m)}catch(o){}w("‚úì Sound engine primed (awaiting user unlock)"),"undefined"!=typeof window&&(ut||(ut=!0,window.addEventListener("bb:modeChanged",t=>{const e=d();if(!1===e?.sceneChangeSoundEnabled)return;const o=t?.detail||{};o.prevMode&&o.mode&&o.prevMode!==o.mode&&p(+(e?.sceneChangeSoundRadius??18),+(e?.sceneChangeSoundIntensity??.35),.5,null)},{passive:!0}))),f("bb:ui"),w("‚úì UI initialized (panel disabled in production)"),S(),f("bb:theme"),it(),(()=>{try{"undefined"!=typeof window&&(window.legendFilter||(window.legendFilter={}),window.legendFilter.syncAllBalls=()=>{})}catch(o){}try{const t=document.getElementById("expertise-legend"),e=document.getElementById("legend-tooltip-output");if(!t)return;const o=Array.from(t.querySelectorAll(".legend__item"));for(const n of o)n&&(n.classList.add("legend__item--interactive"),e&&(n.addEventListener("mouseenter",()=>{const t=n.getAttribute("data-tooltip");t&&(e.textContent=t,e.style.opacity="1",e.style.visibility="visible")}),n.addEventListener("mouseleave",()=>{e.style.opacity="0",window.setTimeout(()=>{"0"===e.style.opacity&&(e.style.visibility="hidden")},50)})));e&&(e.style.visibility="hidden",e.style.opacity="0")}catch(o){}})(),w("‚úì Legend filter system configured"),at||(at=!0,window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName))return;const o=e.key.toLowerCase();if("/"!==o&&"Slash"!==e.code){if("r"!==o)return"ArrowRight"===e.key?(e.preventDefault(),void t(1)):"ArrowLeft"===e.key?(e.preventDefault(),void t(-1)):void 0;e.preventDefault(),r();try{const t=d();nt(t.currentMode)}catch(e){}}else{if(e.preventDefault(),!a())return;import("./panel-dock.js").then(t=>{try{t.toggleDock?.()}catch(e){}}).catch(()=>{})}}),window.addEventListener("contextmenu",e=>{const o=e.target;"A"===o.tagName||"BUTTON"===o.tagName||o.closest("a")||o.closest("button")||o.closest(".panel")||"panelDock"===o.id||"masterPanel"===o.id||"dockToggle"===o.id||(e.preventDefault(),t(-1))})),w("‚úì Keyboard shortcuts registered");try{$(m),w("‚úì Modal overlay system initialized")}catch(o){console.warn("Modal overlay initialization error:",o?.message)}try{B(),w("‚úì CV password gate initialized")}catch(o){console.warn("CV gate initialization error:",o?.message)}try{I(),w("‚úì Portfolio password gate initialized")}catch(o){console.warn("Portfolio gate initialization error:",o?.message)}try{L(),w("‚úì Contact gate initialized")}catch(o){console.warn("Contact gate initialization error:",o?.message)}O(),V(),(()=>{try{const t=document.getElementById("cv-gate-trigger");if(t&&!t.querySelector(".footer-link-nowrap")){const e=((Y("footer.links.cv.text","")||"")+"").trim(),o=(t.textContent||"").trim().replace(/\s+/g," "),n=e||o;n&&n.includes("/")&&o===n&&(t.innerHTML=`<span class="footer-link-nowrap">${n}</span>`)}}catch(o){}})(),D(),w("‚úì Sound toggle button created"),w("‚úì Theme toggle button created");const mt=Z[Math.floor(Math.random()*Z.length)];R?.("startup"),c(mt);try{const t=await import("./controls.js");t.updateModeButtonsUI?.(mt)}catch(o){}f("bb:mode"),w("‚úì Mode initialized"),(()=>{(()=>{if(document.getElementById("quote-display"))return document.getElementById("quote-display");rt=document.createElement("div"),rt.id="quote-display",rt.className="quote-display",rt.setAttribute("aria-live","polite"),rt.setAttribute("aria-atomic","true"),st=document.createElement("div"),st.className="quote-display__content quote-display__content--entering",ct=document.createElement("p"),ct.className="quote-display__text",dt=document.createElement("p"),dt.className="quote-display__author",st.appendChild(ct),st.appendChild(dt),rt.appendChild(st);const t=document.querySelector(".ui-meta-right");t?t.insertBefore(rt,t.firstChild):document.body.appendChild(rt)})();const t=u();t.currentMode&&(e(t.currentMode,!1),requestAnimationFrame(()=>{st?.classList.remove("quote-display__content--entering")})),window.addEventListener("bb:modeChanged",t=>{const o=t.detail?.mode;o&&e(o,!0)})})(),w("‚úì Quote display initialized"),tt(ot),U(null,{getForcesFn:et}),f("bb:end"),w("‚úÖ Bouncy Balls running (modular)");const pt=[{phase:"config",ms:Q("bb:m:config","bb:start","bb:config")},{phase:"renderer",ms:Q("bb:m:renderer","bb:config","bb:renderer")},{phase:"input",ms:Q("bb:m:input","bb:renderer","bb:input")},{phase:"ui",ms:Q("bb:m:ui","bb:input","bb:ui")},{phase:"theme",ms:Q("bb:m:theme","bb:ui","bb:theme")},{phase:"mode+loop",ms:Q("bb:m:mode","bb:theme","bb:mode")},{phase:"total",ms:Q("bb:m:total","bb:start","bb:end")}].filter(t=>"number"==typeof t.ms);pt.length&&W(pt.map(t=>({...t,ms:+t.ms.toFixed(2)}))),H();try{a()?K():X()}catch(s){try{console.error("Banner print error:",s),console.log("%cCurious mind detected. Design meets engineering at 60fps.","color: #888; font-style: italic;")}catch(o){}}try{const{orchestrateEntrance:t,revealAllLateElements:e}=await import("./shared.js").then(t=>t.aM),{getModalToAutoOpen:n,shouldSkipWallAnimation:a,resetTransitionState:r,setupPrefetchOnHover:s,initSpeculativePrefetch:c,didViewTransitionRun:l}=await import("./shared.js").then(t=>t.aL),u=d(),m=!!window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,p=n(),b=a(),h=l();window.addEventListener("pageshow",t=>{if(t.persisted){r();const t=document.getElementById("abs-scene");t&&(t.style.opacity="1")}});const g=document.getElementById("cv-gate-trigger"),f=document.getElementById("portfolio-gate-trigger");if(g&&s(g,"cv.html"),f&&s(f,"portfolio.html"),!u.entranceEnabled||m){try{await G()}catch(o){}await i(),e(),console.log("‚úì Entrance animation skipped (disabled or reduced motion)")}else await t({async waitForFonts(){try{await G()}catch(o){}},skipWallAnimation:b,skipEntranceAnimation:h}),console.log(h?"‚úì Entrance skipped (View Transition handled it)":b?"‚úì Quick entrance (returning from internal page)":"‚úì Dramatic entrance animation orchestrated");"cv"===p?setTimeout(()=>{const t=document.getElementById("cv-gate-trigger");t&&t.click()},400):"contact"===p&&setTimeout(()=>{const t=document.getElementById("contact-trigger");t&&t.click()},400),c()}catch(o){console.warn("‚ö†Ô∏è Entrance animation failed, falling back to simple fade:",o);try{await G()}catch(o){}await i();try{const{revealAllLateElements:t}=await import("./shared.js").then(t=>t.aM);t()}catch(l){["main-links","brand-logo"].forEach(t=>{const e=document.getElementById(t);e&&(e.style.removeProperty("opacity"),"brand-logo"===t&&e.style.removeProperty("filter"),e.style.visibility="visible")});const t=document.getElementById("fade-blocking");t&&t.remove()}}}catch(m){console.error("‚ùå Initialization failed:",m),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${m.message}\n${m.stack}</pre>\n    </div>`}})();export{o as applyFramePaddingCSSVars,n as applyVisualCSSVars};