function t(t){const e=m(),n=d;if(!n||!n.length)return;const o=n.indexOf(e?.currentMode||u.PIT),a=n[((0>o?0:o)+t+n.length)%n.length];l(a),tt(a)}function e(t){const e=+t?.sceneImpactMul,n=Number.isFinite(e)?e:0,o=+t?.sceneImpactMobileMulFactor,a=Number.isFinite(o)&&o>0?o:1;return n*((t=>{if(t?.isMobile||t?.isMobileViewport)return!0;try{return!(!window.matchMedia||!window.matchMedia("(max-width: 600px)").matches)}catch(e){return!1}})(t)?a:1)}function n(){if(!st)return;let t=null;try{t=m()}catch(a){}if(!t)return;const n=e(t);st.style.setProperty("--abs-scene-impact-mul",n+"");const o=+t.sceneImpactLogoCompMul;Number.isFinite(o)&&o>0&&st.style.setProperty("--abs-scene-impact-logo-comp-mul",o+"")}function o(){lt&&(window.clearTimeout(lt),lt=0),mt&&(window.clearTimeout(mt),mt=0)}function a(){M()}function i(t){const e=document.documentElement;void 0!==t.topLogoWidthVw&&e.style.setProperty("--top-logo-width-vw",t.topLogoWidthVw+""),void 0!==t.noiseSize&&e.style.setProperty("--noise-size",t.noiseSize+"px"),void 0!==t.noiseOpacityLight&&e.style.setProperty("--noise-opacity-light",t.noiseOpacityLight+""),void 0!==t.noiseOpacityDark&&e.style.setProperty("--noise-opacity-dark",t.noiseOpacityDark+""),void 0!==t.noiseBlendMode&&e.style.setProperty("--noise-blend-mode",t.noiseBlendMode+""),void 0!==t.noiseColorLight&&e.style.setProperty("--noise-color-light",t.noiseColorLight+""),void 0!==t.noiseColorDark&&e.style.setProperty("--noise-color-dark",t.noiseColorDark+"")}function r(t={}){const e=document.getElementById("abs-scene");if(!e)return Promise.resolve();const n=m(),o=t.delay??n?.contentFadeInDelay??500,a=t.duration??n?.contentFadeInDuration??1e3,i=t.easing??"cubic-bezier(0.16, 1, 0.3, 1)";return new Promise(t=>{let n=!1;const r=()=>{if(!n){n=!0;try{e.style.opacity="1",e.style.visibility="visible",e.style.willChange="auto";const t=document.getElementById("fade-blocking");t&&t.remove()}catch(o){}t()}},s=()=>{const t=document.getElementById("fade-blocking");if(t&&t.remove(),e.style.visibility="visible",e.style.willChange="opacity",e.style.opacity="0","function"==typeof e.animate){const t=e.animate([{opacity:0},{opacity:1}],{duration:a,easing:i,fill:"forwards"});t.addEventListener("finish",r),t.addEventListener("cancel",r)}else e.style.transition=`opacity ${a}ms ${i}`,requestAnimationFrame(()=>{e.style.opacity="1"}),window.setTimeout(r,a+50)};o>0?setTimeout(s,o):s()})}import{i as s,r as c,N as d,s as l,g as m,M as u,p as b,l as p,a as h,b as w,m as f,c as g,d as y,e as v,f as M,h as k,j as N,k as x,n as z,o as _,q as E,t as T,u as A,v as j,w as C,x as P,y as S,z as $,A as B,B as I,C as L,D as F,E as O,F as D,G as U,H as R,I as V,J as q,K as H,L as K,O as Q,P as W,Q as G,R as J,S as X,T as Y,U as Z}from"./shared.js";import{u as tt}from"./controls.js";import{s as et}from"./pointer.js";import{applyExpertiseLegendColors as nt}from"./legend-colors.js";let ot=!1;const at="--abs-scene-impact",it="--abs-scene-impact-dur",rt="--abs-scene-impact-logo-scale";let st=null,ct=!1,dt=0,lt=0,mt=0,ut=!1,bt=!1;window.addEventListener("error",t=>{t.message&&t.message.includes("Failed to fetch")&&t.preventDefault()}),window.addEventListener("unhandledrejection",t=>{t.reason?.message&&t.reason.message.includes("Failed to fetch")&&t.preventDefault()}),(async()=>{document.documentElement.classList.add("js-enabled");try{await p(),h()}catch(a){}try{w("BouncyBalls bootstrap"),f("bb:start"),g("üöÄ Initializing modular bouncy balls...");const p=await y();v(p),f("bb:config"),g("‚úì Config loaded");try{const t=m();"undefined"!=typeof window&&(window.REST=t.REST,window.FRICTION=t.FRICTION,window.MAX_BALLS=t.maxBalls,window.repelRadius=t.repelRadius,window.repelPower=t.repelPower)}catch(a){}M(),g("‚úì Layout applied"),i(p),g("‚úì Visual effects configured");try{const t=m(),e=document.documentElement;if(Number.isFinite(t?.topLogoWidthVw)&&e.style.setProperty("--top-logo-width-vw",t.topLogoWidthVw+""),Number.isFinite(t?.homeMainLinksBelowLogoPx)&&e.style.setProperty("--home-main-links-below-logo-px",t.homeMainLinksBelowLogoPx+""),Number.isFinite(t?.footerNavBarTopVh)&&(e.style.setProperty("--footer-nav-bar-top",t.footerNavBarTopVh+"vh"),e.style.setProperty("--footer-nav-bar-top-svh",t.footerNavBarTopVh+"svh"),e.style.setProperty("--footer-nav-bar-top-dvh",t.footerNavBarTopVh+"dvh")),Number.isFinite(t?.footerNavBarGapVw)){const n=Math.round(9.6*t.footerNavBarGapVw);e.style.setProperty("--footer-nav-bar-gap",`clamp(${n}px, ${t.footerNavBarGapVw}vw, ${Math.round(1.67*n)}px)`)}Number.isFinite(t?.uiHitAreaMul)&&e.style.setProperty("--ui-hit-area-mul",t.uiHitAreaMul+""),Number.isFinite(t?.uiIconCornerRadiusMul)&&e.style.setProperty("--ui-icon-corner-radius-mul",t.uiIconCornerRadiusMul+""),Number.isFinite(t?.uiIconFramePx)&&Math.round(t.uiIconFramePx)>0&&e.style.setProperty("--ui-icon-frame-size",Math.round(t.uiIconFramePx)+"px"),Number.isFinite(t?.uiIconGlyphPx)&&Math.round(t.uiIconGlyphPx)>0&&e.style.setProperty("--ui-icon-glyph-size",Math.round(t.uiIconGlyphPx)+"px"),Number.isFinite(t?.linkTextPadding)&&(e.style.setProperty("--link-text-padding",Math.round(t.linkTextPadding)+"px"),e.style.setProperty("--link-text-margin",-Math.round(t.linkTextPadding)+"px")),Number.isFinite(t?.linkIconPadding)&&(e.style.setProperty("--link-icon-padding",Math.round(t.linkIconPadding)+"px"),e.style.setProperty("--link-icon-margin",-Math.round(t.linkIconPadding)+"px")),Number.isFinite(t?.linkColorInfluence)&&e.style.setProperty("--link-color-influence",t.linkColorInfluence+""),Number.isFinite(t?.linkImpactScale)&&e.style.setProperty("--link-impact-scale",t.linkImpactScale+""),Number.isFinite(t?.linkImpactBlur)&&e.style.setProperty("--link-impact-blur",t.linkImpactBlur+"px"),Number.isFinite(t?.linkImpactDuration)&&e.style.setProperty("--link-impact-duration",Math.round(t.linkImpactDuration)+"ms"),void 0!==t?.hoverSnapEnabled&&e.style.setProperty("--abs-hover-snap-enabled",t.hoverSnapEnabled?"1":"0"),Number.isFinite(t?.hoverSnapDuration)&&e.style.setProperty("--abs-hover-snap-duration",Math.max(0,Math.round(t.hoverSnapDuration))+"ms"),Number.isFinite(t?.hoverSnapOvershoot)&&e.style.setProperty("--abs-hover-snap-overshoot",t.hoverSnapOvershoot+""),Number.isFinite(t?.hoverSnapUndershoot)&&e.style.setProperty("--abs-hover-snap-undershoot",t.hoverSnapUndershoot+"")}catch(a){}document.querySelector(".noise");try{k(m())}catch(a){}N();const h=x(),ht=G(),wt=document.getElementById("bravia-balls");if(!h||!ht||!wt)throw Error("Missing DOM elements");try{const t=document.getElementById("brand-logo");t&&t.parentElement!==wt&&wt.prepend(t)}catch(a){}try{h.setAttribute("role","application"),h.getAttribute("aria-label")||h.setAttribute("aria-label","Interactive bouncy balls physics simulation")}catch(a){}z(h,ht,wt),_(),f("bb:renderer"),g("‚úì Canvas initialized (container-relative sizing)"),m().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),et(),g("‚úì Pointer tracking configured"),"undefined"!=typeof document&&document.addEventListener("touchmove",t=>{var e;(e=t.target)instanceof Element&&(e.closest(".panel-dock .panel .panel-content")||e.closest("#controlPanel"))||t.preventDefault()},{passive:!1,capture:!0}),g("‚úì Overscroll lock configured"),E(),f("bb:input"),g("‚úì Custom cursor initialized"),T(),(()=>{if("undefined"!=typeof window&&"undefined"!=typeof document&&(st=document.querySelector("#abs-scene")||null,st&&(st.style.setProperty(at,"0"),st.style.setProperty(it,"100ms"),st.style.setProperty(rt,"1"),n(),!(()=>{try{return!(!window.matchMedia||!window.matchMedia("(prefers-reduced-motion: reduce)").matches)}catch(a){return!1}})()))){ct=!0,st.classList.add("abs-scene--impact");try{window.addEventListener("resize",n,{passive:!0})}catch(a){}window.addEventListener("bb:modeChanged",t=>{const n=m();if(!1===n?.sceneImpactEnabled)return;if(ut)return void(ut=!1);const a=t?.detail||{};((t=1,n={})=>{if(!ct||!st)return;const a=m();if(!1===a?.sceneImpactEnabled)return;const i=Math.max(0,Math.min(1,+t||0)),r=++dt;o(),st.classList.add("abs-scene--animating"),n?.armManual&&(ut=!0);const s=a?.sceneImpactPressMs??75,c=a?.sceneImpactReleaseMs??220,d=Math.max(1,Math.round(.8*(+s||0))),l=Math.max(1,Math.round(1.2*(+c||0))),u=Math.round(Math.min(80,Math.max(0,.4*(+d||0))));st.style.setProperty(it,Math.round(d)+"ms"),window.requestAnimationFrame(()=>{ct&&st&&r===dt&&(st.style.setProperty(at,i+""),st.style.setProperty(rt,((t,n)=>{const o=e(n),a=Math.max(0,+t||0)*o,i=1/Math.max(.001,1-a),r=+n?.sceneImpactLogoCompMul;return Math.max(.5,Math.min(4,i*(1+((Number.isFinite(r)&&r>0?r:1)-1)*a)))})(i,a)+""))}),lt=window.setTimeout(()=>{(({token:t,releaseMs:e})=>{o(),ct&&st&&t===dt&&(st.style.setProperty(it,Math.round(e)+"ms"),window.requestAnimationFrame(()=>{ct&&st&&t===dt&&(st.style.setProperty(at,"0"),st.style.setProperty(rt,"1"))}),mt=window.setTimeout(()=>{mt=0,st&&st.classList.remove("abs-scene--animating")},Math.max(0,Math.round(e)+80)))})({token:r,releaseMs:l})},Math.max(0,Math.round(d)+u)),mt=window.setTimeout(()=>{mt=0,st&&st.classList.remove("abs-scene--animating")},Math.max(0,Math.round(d)+u+Math.round(l)+80))})(a.prevMode&&a.mode&&a.prevMode!==a.mode?1:.75,{armManual:!1})},{passive:!0})}})(),A(),j(),C();try{P(p)}catch(a){}g("‚úì Sound engine primed (awaiting user unlock)"),"undefined"!=typeof window&&(bt||(bt=!0,window.addEventListener("bb:modeChanged",t=>{const e=m();if(!1===e?.sceneChangeSoundEnabled)return;const n=t?.detail||{};n.prevMode&&n.mode&&n.prevMode!==n.mode&&b(+(e?.sceneChangeSoundRadius??18),+(e?.sceneChangeSoundIntensity??.35),.5,null)},{passive:!0}))),f("bb:ui"),g("‚úì UI initialized (panel disabled in production)"),S(),f("bb:theme"),nt(),(()=>{const t=new Set;let e=[],n=[];const o=()=>{const e=m();e?.balls&&(n=[...e.balls],t.size>0&&i())},i=()=>{const e=m();e&&(n&&0!==n.length?e.balls=0===t.size?[...n]:n.filter(e=>{if(!e)return!1;const n=e.distributionIndex??-1;return n>=0&&t.has(n)}):n=[...e.balls||[]])},r=n=>{Number.isFinite(n)&&n>=0&&(0===t.size?t.add(n):t.has(n)?t.delete(n):t.add(n),(()=>{const n=0===t.size;for(let o=0;e.length>o;o++){const a=e[o];a&&(n?(a.classList.remove("legend__item--active","legend__item--dimmed"),a.style.opacity=""):t.has(o)?(a.classList.add("legend__item--active"),a.classList.remove("legend__item--dimmed"),a.style.opacity=""):(a.classList.remove("legend__item--active"),a.classList.add("legend__item--dimmed"),a.style.opacity="0.35"))}})(),i())};try{"undefined"!=typeof window&&(window.legendFilter||(window.legendFilter={}),window.legendFilter.syncAllBalls=o)}catch(a){}try{const t=document.getElementById("expertise-legend"),n=document.getElementById("legend-tooltip-output");if(!t)return;e=Array.from(t.querySelectorAll(".legend__item"));for(let o=0;e.length>o;o++){const t=e[o];t&&(t.setAttribute("role","button"),t.setAttribute("tabindex","0"),t.classList.add("legend__item--interactive"),t.addEventListener("click",t=>{t.stopPropagation(),t.preventDefault(),r(o)}),t.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),t.stopPropagation(),r(o))}),n&&(t.addEventListener("mouseenter",()=>{const e=t.getAttribute("data-tooltip");e&&(n.textContent=e,n.style.opacity="1",n.style.visibility="visible")}),t.addEventListener("mouseleave",()=>{n.style.opacity="0",window.setTimeout(()=>{"0"===n.style.opacity&&(n.style.visibility="hidden")},50)})))}n&&(n.style.visibility="hidden",n.style.opacity="0")}catch(a){}})(),g("‚úì Legend filter system configured"),ot||(ot=!0,window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName))return;const n=e.key.toLowerCase();if("/"!==n&&"Slash"!==e.code){if("r"!==n)return"ArrowRight"===e.key?(e.preventDefault(),void t(1)):"ArrowLeft"===e.key?(e.preventDefault(),void t(-1)):void 0;e.preventDefault(),c();try{const t=m();tt(t.currentMode)}catch(e){}}else{if(e.preventDefault(),!s())return;import("./panel-dock.js").then(t=>{try{t.toggleDock?.()}catch(e){}}).catch(()=>{})}}),window.addEventListener("contextmenu",e=>{const n=e.target;"A"===n.tagName||"BUTTON"===n.tagName||n.closest("a")||n.closest("button")||n.closest(".panel")||"panelDock"===n.id||"masterPanel"===n.id||"dockToggle"===n.id||(e.preventDefault(),t(-1))})),g("‚úì Keyboard shortcuts registered");try{$(p),g("‚úì Modal overlay system initialized")}catch(a){console.warn("Modal overlay initialization error:",a?.message)}try{B(),g("‚úì CV password gate initialized")}catch(a){console.warn("CV gate initialization error:",a?.message)}try{I(),g("‚úì Portfolio password gate initialized")}catch(a){console.warn("Portfolio gate initialization error:",a?.message)}try{L(),g("‚úì Contact gate initialized")}catch(a){console.warn("Contact gate initialization error:",a?.message)}F(),O(),(()=>{try{const t=document.getElementById("cv-gate-trigger");if(t&&!t.querySelector(".footer-link-nowrap")){const e=((J("footer.links.cv.text","")||"")+"").trim(),n=(t.textContent||"").trim().replace(/\s+/g," "),o=e||n;o&&o.includes("/")&&n===o&&(t.innerHTML=`<span class="footer-link-nowrap">${o}</span>`)}}catch(a){}})(),D(),g("‚úì Sound toggle button created"),g("‚úì Theme toggle button created");const ft=u.PIT;U?.("startup"),l(ft);try{const t=await import("./controls.js").then(t=>t.h);t.updateModeButtonsUI?.(ft)}catch(a){}f("bb:mode"),g("‚úì Mode initialized"),X(Y);const gt=()=>Z();R((t,e)=>{const n=gt();n&&n(t,e)}),f("bb:end"),g("‚úÖ Bouncy Balls running (modular)");const yt=[{phase:"config",ms:V("bb:m:config","bb:start","bb:config")},{phase:"renderer",ms:V("bb:m:renderer","bb:config","bb:renderer")},{phase:"input",ms:V("bb:m:input","bb:renderer","bb:input")},{phase:"ui",ms:V("bb:m:ui","bb:input","bb:ui")},{phase:"theme",ms:V("bb:m:theme","bb:ui","bb:theme")},{phase:"mode+loop",ms:V("bb:m:mode","bb:theme","bb:mode")},{phase:"total",ms:V("bb:m:total","bb:start","bb:end")}].filter(t=>"number"==typeof t.ms);yt.length&&q(yt.map(t=>({...t,ms:+t.ms.toFixed(2)}))),H();try{s()?K():Q()}catch(d){try{console.error("Banner print error:",d),console.log("%cCurious mind detected. Design meets engineering at 60fps.","color: #888; font-style: italic;")}catch(a){}}try{const{orchestrateEntrance:t,revealAllLateElements:e}=await import("./shared.js").then(t=>t.aU),{getModalToAutoOpen:n,shouldSkipWallAnimation:o,resetTransitionState:i,setupPrefetchOnHover:s}=await import("./shared.js").then(t=>t.aT),c=m(),d=!!window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,l=n(),u=o();window.addEventListener("pageshow",t=>{if(t.persisted){i();const t=document.getElementById("abs-scene");t&&(t.style.opacity="1")}});const b=document.getElementById("cv-gate-trigger"),p=document.getElementById("portfolio-gate-trigger");if(b&&s(b,"cv.html"),p&&s(p,"portfolio.html"),!c.entranceEnabled||d){try{await W()}catch(a){}await r(),e(),console.log("‚úì Entrance animation skipped (disabled or reduced motion)")}else await t({async waitForFonts(){try{await W()}catch(a){}},skipWallAnimation:u}),console.log(u?"‚úì Quick entrance (returning from internal page)":"‚úì Dramatic entrance animation orchestrated");"cv"===l?setTimeout(()=>{const t=document.getElementById("cv-gate-trigger");t&&t.click()},400):"contact"===l&&setTimeout(()=>{const t=document.getElementById("contact-trigger");t&&t.click()},400)}catch(a){console.warn("‚ö†Ô∏è Entrance animation failed, falling back to simple fade:",a);try{await W()}catch(a){}await r();try{const{revealAllLateElements:t}=await import("./shared.js").then(t=>t.aU);t()}catch(pt){["main-links","brand-logo"].forEach(t=>{const e=document.getElementById(t);e&&(e.style.removeProperty("opacity"),"brand-logo"===t&&e.style.removeProperty("filter"),e.style.visibility="visible")});const t=document.getElementById("fade-blocking");t&&t.remove()}}}catch(ht){console.error("‚ùå Initialization failed:",ht),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${ht.message}\n${ht.stack}</pre>\n    </div>`}})();export{a as applyFramePaddingCSSVars,i as applyVisualCSSVars};