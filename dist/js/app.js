function e(e){const t=c(),o=r;if(!o||!o.length)return;const n=o.indexOf(t?.currentMode||d.PIT),i=o[((0>n?0:n)+e+o.length)%o.length];s(i),Z(i)}function t(){w()}function o(e){const t=document.documentElement;void 0!==e.topLogoWidthVw&&t.style.setProperty("--top-logo-width-vw",e.topLogoWidthVw+""),void 0!==e.noiseSize&&t.style.setProperty("--noise-size",e.noiseSize+"px"),void 0!==e.noiseOpacityLight&&t.style.setProperty("--noise-opacity-light",e.noiseOpacityLight+""),void 0!==e.noiseOpacityDark&&t.style.setProperty("--noise-opacity-dark",e.noiseOpacityDark+""),void 0!==e.noiseBlendMode&&t.style.setProperty("--noise-blend-mode",e.noiseBlendMode+""),void 0!==e.noiseColorLight&&t.style.setProperty("--noise-color-light",e.noiseColorLight+""),void 0!==e.noiseColorDark&&t.style.setProperty("--noise-color-dark",e.noiseColorDark+"")}function n(e={}){const t=document.getElementById("abs-scene");if(!t)return Promise.resolve();const o=c(),n=e.delay??o?.contentFadeInDelay??500,i=e.duration??o?.contentFadeInDuration??1e3,a=e.easing??"cubic-bezier(0.16, 1, 0.3, 1)";return new Promise(e=>{let o=!1;const r=()=>{if(!o){o=!0;try{t.style.opacity="1",t.style.visibility="visible",t.style.willChange="auto";const e=document.getElementById("fade-blocking");e&&e.remove()}catch(n){}e()}},s=()=>{const e=document.getElementById("fade-blocking");if(e&&e.remove(),t.style.visibility="visible",t.style.willChange="opacity",t.style.opacity="0","function"==typeof t.animate){const e=t.animate([{opacity:0},{opacity:1}],{duration:i,easing:a,fill:"forwards"});e.addEventListener("finish",r),e.addEventListener("cancel",r)}else t.style.transition=`opacity ${i}ms ${a}`,requestAnimationFrame(()=>{t.style.opacity="1"}),window.setTimeout(r,i+50)};n>0?setTimeout(s,n):s()})}import{i,r as a,N as r,s,g as c,M as d,p as l,l as m,a as u,b,m as p,c as h,d as g,e as f,f as w,h as v,j as y,k,n as z,o as N,q as x,t as M,u as _,v as E,w as T,x as A,y as j,z as C,A as P,B as S,C as $,D as B,E as I,F as L,G as F,H as O,I as D,J as U,K as V,L as R,O as W,P as q,Q as H,R as K,S as Q,T as G,U as J,V as X,W as Y}from"./shared.js";import{u as Z}from"./controls.js";import{applyExpertiseLegendColors as ee}from"./legend-colors.js";let te=!1,oe=!1;window.addEventListener("error",e=>{e.message&&e.message.includes("Failed to fetch")&&e.preventDefault()}),window.addEventListener("unhandledrejection",e=>{e.reason?.message&&e.reason.message.includes("Failed to fetch")&&e.preventDefault()}),(async()=>{document.documentElement.classList.add("js-enabled");try{await m(),u()}catch(t){}try{b("BouncyBalls bootstrap"),p("bb:start"),h("üöÄ Initializing modular bouncy balls...");const m=await g();f(m),p("bb:config"),h("‚úì Config loaded");try{const e=c();"undefined"!=typeof window&&(window.REST=e.REST,window.FRICTION=e.FRICTION,window.MAX_BALLS=e.maxBalls,window.repelRadius=e.repelRadius,window.repelPower=e.repelPower)}catch(t){}w(),h("‚úì Layout applied"),o(m),h("‚úì Visual effects configured");try{const e=c(),t=document.documentElement;if(Number.isFinite(e?.topLogoWidthVw)&&t.style.setProperty("--top-logo-width-vw",e.topLogoWidthVw+""),Number.isFinite(e?.homeMainLinksBelowLogoPx)&&t.style.setProperty("--home-main-links-below-logo-px",e.homeMainLinksBelowLogoPx+""),Number.isFinite(e?.footerNavBarTopVh)&&(t.style.setProperty("--footer-nav-bar-top",e.footerNavBarTopVh+"vh"),t.style.setProperty("--footer-nav-bar-top-svh",e.footerNavBarTopVh+"svh"),t.style.setProperty("--footer-nav-bar-top-dvh",e.footerNavBarTopVh+"dvh")),Number.isFinite(e?.footerNavBarGapVw)){const o=Math.round(9.6*e.footerNavBarGapVw);t.style.setProperty("--footer-nav-bar-gap",`clamp(${o}px, ${e.footerNavBarGapVw}vw, ${Math.round(1.67*o)}px)`)}Number.isFinite(e?.uiHitAreaMul)&&t.style.setProperty("--ui-hit-area-mul",e.uiHitAreaMul+""),Number.isFinite(e?.uiIconCornerRadiusMul)&&t.style.setProperty("--ui-icon-corner-radius-mul",e.uiIconCornerRadiusMul+""),Number.isFinite(e?.uiIconFramePx)&&Math.round(e.uiIconFramePx)>0&&t.style.setProperty("--ui-icon-frame-size",Math.round(e.uiIconFramePx)+"px"),Number.isFinite(e?.uiIconGlyphPx)&&Math.round(e.uiIconGlyphPx)>0&&t.style.setProperty("--ui-icon-glyph-size",Math.round(e.uiIconGlyphPx)+"px"),Number.isFinite(e?.linkTextPadding)&&(t.style.setProperty("--link-text-padding",Math.round(e.linkTextPadding)+"px"),t.style.setProperty("--link-text-margin",-Math.round(e.linkTextPadding)+"px")),Number.isFinite(e?.linkIconPadding)&&(t.style.setProperty("--link-icon-padding",Math.round(e.linkIconPadding)+"px"),t.style.setProperty("--link-icon-margin",-Math.round(e.linkIconPadding)+"px")),Number.isFinite(e?.linkColorInfluence)&&t.style.setProperty("--link-color-influence",e.linkColorInfluence+""),Number.isFinite(e?.linkImpactScale)&&t.style.setProperty("--link-impact-scale",e.linkImpactScale+""),Number.isFinite(e?.linkImpactBlur)&&t.style.setProperty("--link-impact-blur",e.linkImpactBlur+"px"),Number.isFinite(e?.linkImpactDuration)&&t.style.setProperty("--link-impact-duration",Math.round(e.linkImpactDuration)+"ms"),void 0!==e?.hoverSnapEnabled&&t.style.setProperty("--abs-hover-snap-enabled",e.hoverSnapEnabled?"1":"0"),Number.isFinite(e?.hoverSnapDuration)&&t.style.setProperty("--abs-hover-snap-duration",Math.max(0,Math.round(e.hoverSnapDuration))+"ms"),Number.isFinite(e?.hoverSnapOvershoot)&&t.style.setProperty("--abs-hover-snap-overshoot",e.hoverSnapOvershoot+""),Number.isFinite(e?.hoverSnapUndershoot)&&t.style.setProperty("--abs-hover-snap-undershoot",e.hoverSnapUndershoot+"")}catch(t){}document.querySelector(".noise");try{v(c())}catch(t){}y();const u=k(),ie=Q(),ae=document.getElementById("bravia-balls");if(!u||!ie||!ae)throw Error("Missing DOM elements");try{const e=document.getElementById("brand-logo");e&&e.parentElement!==ae&&ae.prepend(e)}catch(t){}try{u.setAttribute("role","application"),u.getAttribute("aria-label")||u.setAttribute("aria-label","Interactive bouncy balls physics simulation")}catch(t){}z(u,ie,ae),N(),p("bb:renderer"),h("‚úì Canvas initialized (container-relative sizing)"),c().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),x(),h("‚úì Pointer tracking configured"),"undefined"!=typeof document&&document.addEventListener("touchmove",e=>{var t;(t=e.target)instanceof Element&&(t.closest(".panel-dock .panel .panel-content")||t.closest("#controlPanel"))||e.preventDefault()},{passive:!1,capture:!0}),h("‚úì Overscroll lock configured"),M(),p("bb:input"),h("‚úì Custom cursor initialized"),_(),E(),T(),A(),j();try{C(m)}catch(t){}h("‚úì Sound engine primed (awaiting user unlock)"),"undefined"!=typeof window&&(oe||(oe=!0,window.addEventListener("bb:modeChanged",e=>{const t=c();if(!1===t?.sceneChangeSoundEnabled)return;const o=e?.detail||{};o.prevMode&&o.mode&&o.prevMode!==o.mode&&l(+(t?.sceneChangeSoundRadius??18),+(t?.sceneChangeSoundIntensity??.35),.5,null)},{passive:!0}))),p("bb:ui"),h("‚úì UI initialized (panel disabled in production)"),P(),p("bb:theme"),ee(),(()=>{const e=new Set;let o=[],n=[];const i=()=>{const t=c();t?.balls&&(n=[...t.balls],e.size>0&&a())},a=()=>{const t=c();t&&(n&&0!==n.length?t.balls=0===e.size?[...n]:n.filter(t=>{if(!t)return!1;const o=t.distributionIndex??-1;return o>=0&&e.has(o)}):n=[...t.balls||[]])},r=t=>{Number.isFinite(t)&&t>=0&&(0===e.size?e.add(t):e.has(t)?e.delete(t):e.add(t),(()=>{const t=0===e.size;for(let n=0;o.length>n;n++){const i=o[n];i&&(t?(i.classList.remove("legend__item--active","legend__item--dimmed"),i.style.opacity=""):e.has(n)?(i.classList.add("legend__item--active"),i.classList.remove("legend__item--dimmed"),i.style.opacity=""):(i.classList.remove("legend__item--active"),i.classList.add("legend__item--dimmed"),i.style.opacity="0.35"))}})(),a())};try{"undefined"!=typeof window&&(window.legendFilter||(window.legendFilter={}),window.legendFilter.syncAllBalls=i)}catch(t){}try{const e=document.getElementById("expertise-legend"),t=document.getElementById("legend-tooltip-output");if(!e)return;o=Array.from(e.querySelectorAll(".legend__item"));for(let n=0;o.length>n;n++){const e=o[n];e&&(e.setAttribute("role","button"),e.setAttribute("tabindex","0"),e.classList.add("legend__item--interactive"),e.addEventListener("click",e=>{e.stopPropagation(),e.preventDefault(),r(n)}),e.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),r(n))}),t&&(e.addEventListener("mouseenter",()=>{const o=e.getAttribute("data-tooltip");o&&(t.textContent=o,t.style.opacity="1",t.style.visibility="visible")}),e.addEventListener("mouseleave",()=>{t.style.opacity="0",window.setTimeout(()=>{"0"===t.style.opacity&&(t.style.visibility="hidden")},50)})))}t&&(t.style.visibility="hidden",t.style.opacity="0")}catch(t){}})(),h("‚úì Legend filter system configured"),te||(te=!0,window.addEventListener("keydown",t=>{if(["INPUT","TEXTAREA","SELECT"].includes(t.target.tagName))return;const o=t.key.toLowerCase();if("/"!==o&&"Slash"!==t.code){if("r"!==o)return"ArrowRight"===t.key?(t.preventDefault(),void e(1)):"ArrowLeft"===t.key?(t.preventDefault(),void e(-1)):void 0;t.preventDefault(),a();try{const e=c();Z(e.currentMode)}catch(t){}}else{if(t.preventDefault(),!i())return;import("./panel-dock.js").then(e=>{try{e.toggleDock?.()}catch(t){}}).catch(()=>{})}}),window.addEventListener("contextmenu",t=>{const o=t.target;"A"===o.tagName||"BUTTON"===o.tagName||o.closest("a")||o.closest("button")||o.closest(".panel")||"panelDock"===o.id||"masterPanel"===o.id||"dockToggle"===o.id||(t.preventDefault(),e(-1))})),h("‚úì Keyboard shortcuts registered");try{S(m),h("‚úì Modal overlay system initialized")}catch(t){console.warn("Modal overlay initialization error:",t?.message)}try{$(),h("‚úì CV password gate initialized")}catch(t){console.warn("CV gate initialization error:",t?.message)}try{B(),h("‚úì Portfolio password gate initialized")}catch(t){console.warn("Portfolio gate initialization error:",t?.message)}try{I(),h("‚úì Contact gate initialized")}catch(t){console.warn("Contact gate initialization error:",t?.message)}L(),F(),(()=>{try{const e=document.getElementById("cv-gate-trigger");if(e&&!e.querySelector(".footer-link-nowrap")){const t=((G("footer.links.cv.text","")||"")+"").trim(),o=(e.textContent||"").trim().replace(/\s+/g," "),n=t||o;n&&n.includes("/")&&o===n&&(e.innerHTML=`<span class="footer-link-nowrap">${n}</span>`)}}catch(t){}})(),O(),h("‚úì Sound toggle button created"),h("‚úì Theme toggle button created");const re=d.PIT;D?.("startup"),s(re);try{const e=await import("./controls.js").then(e=>e.h);e.updateModeButtonsUI?.(re)}catch(t){}p("bb:mode"),h("‚úì Mode initialized"),J(X);const se=()=>Y();U((e,t)=>{const o=se();o&&o(e,t)}),p("bb:end"),h("‚úÖ Bouncy Balls running (modular)");const ce=[{phase:"config",ms:V("bb:m:config","bb:start","bb:config")},{phase:"renderer",ms:V("bb:m:renderer","bb:config","bb:renderer")},{phase:"input",ms:V("bb:m:input","bb:renderer","bb:input")},{phase:"ui",ms:V("bb:m:ui","bb:input","bb:ui")},{phase:"theme",ms:V("bb:m:theme","bb:ui","bb:theme")},{phase:"mode+loop",ms:V("bb:m:mode","bb:theme","bb:mode")},{phase:"total",ms:V("bb:m:total","bb:start","bb:end")}].filter(e=>"number"==typeof e.ms);ce.length&&R(ce.map(e=>({...e,ms:+e.ms.toFixed(2)}))),W();try{i()?q():H()}catch(r){try{console.error("Banner print error:",r),console.log("%cCurious mind detected. Design meets engineering at 60fps.","color: #888; font-style: italic;")}catch(t){}}try{const{orchestrateEntrance:e,revealAllLateElements:o}=await import("./shared.js").then(e=>e.aP),{getModalToAutoOpen:i,shouldSkipWallAnimation:a,resetTransitionState:r,setupPrefetchOnHover:s}=await import("./shared.js").then(e=>e.aO),d=c(),l=!!window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,m=i(),u=a();window.addEventListener("pageshow",e=>{if(e.persisted){r();const e=document.getElementById("abs-scene");e&&(e.style.opacity="1")}});const b=document.getElementById("cv-gate-trigger"),p=document.getElementById("portfolio-gate-trigger");if(b&&s(b,"cv.html"),p&&s(p,"portfolio.html"),!d.entranceEnabled||l){try{await K()}catch(t){}await n(),o(),console.log("‚úì Entrance animation skipped (disabled or reduced motion)")}else await e({async waitForFonts(){try{await K()}catch(t){}},skipWallAnimation:u}),console.log(u?"‚úì Quick entrance (returning from internal page)":"‚úì Dramatic entrance animation orchestrated");"cv"===m?setTimeout(()=>{const e=document.getElementById("cv-gate-trigger");e&&e.click()},400):"contact"===m&&setTimeout(()=>{const e=document.getElementById("contact-trigger");e&&e.click()},400)}catch(t){console.warn("‚ö†Ô∏è Entrance animation failed, falling back to simple fade:",t);try{await K()}catch(t){}await n();try{const{revealAllLateElements:e}=await import("./shared.js").then(e=>e.aP);e()}catch(ne){["main-links","brand-logo"].forEach(e=>{const t=document.getElementById(e);t&&(t.style.removeProperty("opacity"),"brand-logo"===e&&t.style.removeProperty("filter"),t.style.visibility="visible")});const e=document.getElementById("fade-blocking");e&&e.remove()}}}catch(ie){console.error("‚ùå Initialization failed:",ie),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${ie.message}\n${ie.stack}</pre>\n    </div>`}})();export{t as applyFramePaddingCSSVars,o as applyVisualCSSVars};