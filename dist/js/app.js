function e(e){const t=d(),o=s;if(!o||!o.length)return;const n=o.indexOf(t?.currentMode||l.PIT),i=o[((0>n?0:n)+e+o.length)%o.length];c(i),ie(i)}function t(e,t=!0){if(!se||!ce)return;const o=e||u().currentMode,n=m[o];if(n){if(se.classList.remove("quote-display--hidden"),!t||ue)return de.textContent=n.quote,le.textContent=n.author,void ce.classList.remove("quote-display__content--entering","quote-display__content--exiting");ue=!0,ce.classList.add("quote-display__content--exiting"),setTimeout(()=>{de.textContent=n.quote,le.textContent=n.author,ce.classList.remove("quote-display__content--exiting"),ce.classList.add("quote-display__content--entering"),ce.classList.remove("quote-display__content--entering"),setTimeout(()=>{ue=!1},320)},320)}else se.classList.add("quote-display--hidden")}function o(){k()}function n(e){const t=document.documentElement;void 0!==e.topLogoWidthVw&&t.style.setProperty("--top-logo-width-vw",e.topLogoWidthVw+""),void 0!==e.noiseSize&&t.style.setProperty("--noise-size",e.noiseSize+"px"),void 0!==e.noiseOpacityLight&&t.style.setProperty("--noise-opacity-light",e.noiseOpacityLight+""),void 0!==e.noiseOpacityDark&&t.style.setProperty("--noise-opacity-dark",e.noiseOpacityDark+""),void 0!==e.noiseBlendMode&&t.style.setProperty("--noise-blend-mode",e.noiseBlendMode+""),void 0!==e.noiseColorLight&&t.style.setProperty("--noise-color-light",e.noiseColorLight+""),void 0!==e.noiseColorDark&&t.style.setProperty("--noise-color-dark",e.noiseColorDark+""),void 0!==e.grungeVideoEnabled&&document.querySelectorAll(".grunge-video-overlay").forEach(t=>{t.style.display=e.grungeVideoEnabled?"":"none"}),void 0!==e.grungeVideoOpacityLight&&t.style.setProperty("--grunge-video-opacity-light",e.grungeVideoOpacityLight+""),void 0!==e.grungeVideoOpacityDark&&t.style.setProperty("--grunge-video-opacity-dark",e.grungeVideoOpacityDark+""),void 0!==e.grungeVideoBlendModeLight&&t.style.setProperty("--grunge-video-blend-mode-light",e.grungeVideoBlendModeLight+""),void 0!==e.grungeVideoBlendModeDark&&t.style.setProperty("--grunge-video-blend-mode-dark",e.grungeVideoBlendModeDark+""),void 0!==e.grungeVideoContrast&&t.style.setProperty("--grunge-video-contrast",e.grungeVideoContrast+""),void 0!==e.grungeVideoBrightness&&t.style.setProperty("--grunge-video-brightness",e.grungeVideoBrightness+""),void 0!==e.grungeVideoSaturate&&t.style.setProperty("--grunge-video-saturate",e.grungeVideoSaturate+""),void 0!==e.grungeVideoHueRotate&&t.style.setProperty("--grunge-video-hue-rotate",e.grungeVideoHueRotate+"deg"),void 0!==e.grungeVideoInvert&&t.style.setProperty("--grunge-video-invert",e.grungeVideoInvert+""),void 0!==e.grungeVideoSepia&&t.style.setProperty("--grunge-video-sepia",e.grungeVideoSepia+""),void 0!==e.grungeVideoGrayscale&&t.style.setProperty("--grunge-video-grayscale",e.grungeVideoGrayscale+""),void 0!==e.grungeVideoBlur&&t.style.setProperty("--grunge-video-blur",e.grungeVideoBlur+"px")}function i(e={}){const t=document.getElementById("abs-scene");if(!t)return Promise.resolve();const o=d(),n=e.delay??o?.contentFadeInDelay??500,i=e.duration??o?.contentFadeInDuration??1e3,a=e.easing??"cubic-bezier(0.16, 1, 0.3, 1)";return new Promise(e=>{let o=!1;const r=()=>{if(!o){o=!0;try{t.style.opacity="1",t.style.visibility="visible",t.style.willChange="auto";const e=document.getElementById("fade-blocking");e&&e.remove()}catch(n){}e()}},s=()=>{const e=document.getElementById("fade-blocking");if(e&&e.remove(),t.style.visibility="visible",t.style.willChange="opacity",t.style.opacity="0","function"==typeof t.animate){const e=t.animate([{opacity:0},{opacity:1}],{duration:i,easing:a,fill:"forwards"});e.addEventListener("finish",r),e.addEventListener("cancel",r)}else t.style.transition=`opacity ${i}ms ${a}`,requestAnimationFrame(()=>{t.style.opacity="1"}),window.setTimeout(r,i+50)};n>0?setTimeout(s,n):s()})}import{i as a,r,N as s,s as c,g as d,M as l,a as u,b as m,p,l as b,c as g,d as h,m as v,e as f,f as y,h as w,j as k,k as _,n as M,o as x,q as N,t as z,u as q,v as T,w as A,x as E,y as C,z as j,A as F,B as P,C as B,D as O,E as S,F as $,G as I,H as L,I as V,J as D,K as R,L as U,O as W,P as Q,Q as H,R as K,S as X,T as G,U as J,V as Y,W as Z,X as ee,Y as te,Z as oe,_ as ne}from"./shared.js";import{updateModeButtonsUI as ie}from"./controls.js";import{applyExpertiseLegendColors as ae}from"./legend-colors.js";let re=!1,se=null,ce=null,de=null,le=null,ue=!1,me=!1;window.addEventListener("error",e=>{e.message&&e.message.includes("Failed to fetch")&&e.preventDefault()}),window.addEventListener("unhandledrejection",e=>{e.reason?.message&&e.reason.message.includes("Failed to fetch")&&e.preventDefault()}),(async()=>{document.documentElement.classList.add("js-enabled");try{await b(),g()}catch(o){}try{h("BouncyBalls bootstrap"),v("bb:start"),f("üöÄ Initializing modular bouncy balls...");const m=await y();w(m),v("bb:config"),f("‚úì Config loaded");try{const e=d();"undefined"!=typeof window&&(window.REST=e.REST,window.FRICTION=e.FRICTION,window.MAX_BALLS=e.maxBalls,window.repelRadius=e.repelRadius,window.repelPower=e.repelPower)}catch(o){}k(),f("‚úì Layout applied"),n(m),f("‚úì Visual effects configured");try{const e=d(),t=document.documentElement,o=e=>{const t=+e;return Number.isFinite(t)?(100*Math.max(0,Math.min(1,t))).toFixed(1)+"%":"0%"};if(Number.isFinite(e?.topLogoWidthVw)&&t.style.setProperty("--top-logo-width-vw",e.topLogoWidthVw+""),Number.isFinite(e?.homeMainLinksBelowLogoPx)&&t.style.setProperty("--home-main-links-below-logo-px",e.homeMainLinksBelowLogoPx+""),Number.isFinite(e?.footerNavBarTopVh)&&(t.style.setProperty("--footer-nav-bar-top",e.footerNavBarTopVh+"vh"),t.style.setProperty("--footer-nav-bar-top-svh",e.footerNavBarTopVh+"svh"),t.style.setProperty("--footer-nav-bar-top-dvh",e.footerNavBarTopVh+"dvh")),Number.isFinite(e?.footerNavBarGapVw)){const o=Math.round(9.6*e.footerNavBarGapVw);t.style.setProperty("--footer-nav-bar-gap",`clamp(${o}px, ${e.footerNavBarGapVw}vw, ${Math.round(1.67*o)}px)`)}Number.isFinite(e?.uiHitAreaMul)&&t.style.setProperty("--ui-hit-area-mul",e.uiHitAreaMul+""),Number.isFinite(e?.uiIconCornerRadiusMul)&&t.style.setProperty("--ui-icon-corner-radius-mul",e.uiIconCornerRadiusMul+""),Number.isFinite(e?.uiIconFramePx)&&Math.round(e.uiIconFramePx)>0&&t.style.setProperty("--ui-icon-frame-size",Math.round(e.uiIconFramePx)+"px"),Number.isFinite(e?.uiIconGlyphPx)&&Math.round(e.uiIconGlyphPx)>0&&t.style.setProperty("--ui-icon-glyph-size",Math.round(e.uiIconGlyphPx)+"px"),Number.isFinite(e?.linkTextPadding)&&(t.style.setProperty("--link-text-padding",Math.round(e.linkTextPadding)+"px"),t.style.setProperty("--link-text-margin",-Math.round(e.linkTextPadding)+"px")),Number.isFinite(e?.linkIconPadding)&&(t.style.setProperty("--link-icon-padding",Math.round(e.linkIconPadding)+"px"),t.style.setProperty("--link-icon-margin",-Math.round(e.linkIconPadding)+"px")),Number.isFinite(e?.linkColorInfluence)&&t.style.setProperty("--link-color-influence",e.linkColorInfluence+""),Number.isFinite(e?.linkImpactScale)&&t.style.setProperty("--link-impact-scale",e.linkImpactScale+""),Number.isFinite(e?.linkImpactBlur)&&t.style.setProperty("--link-impact-blur",e.linkImpactBlur+"px"),Number.isFinite(e?.linkImpactDuration)&&t.style.setProperty("--link-impact-duration",Math.round(e.linkImpactDuration)+"ms"),Number.isFinite(e?.linkHoverNudge)&&t.style.setProperty("--link-nudge",e.linkHoverNudge+"px"),Number.isFinite(e?.linkHoverIntensityLight)&&t.style.setProperty("--abs-hover-intensity-light",o(e.linkHoverIntensityLight)),Number.isFinite(e?.linkHoverIntensityDark)&&t.style.setProperty("--abs-hover-intensity-dark",o(e.linkHoverIntensityDark)),Number.isFinite(e?.linkHoverIntensityActive)&&t.style.setProperty("--abs-hover-intensity-active",o(e.linkHoverIntensityActive)),void 0!==e?.hoverSnapEnabled&&t.style.setProperty("--abs-hover-snap-enabled",e.hoverSnapEnabled?"1":"0"),Number.isFinite(e?.hoverSnapDuration)&&t.style.setProperty("--abs-hover-snap-duration",Math.max(0,Math.round(e.hoverSnapDuration))+"ms"),Number.isFinite(e?.hoverSnapOvershoot)&&t.style.setProperty("--abs-hover-snap-overshoot",e.hoverSnapOvershoot+""),Number.isFinite(e?.hoverSnapUndershoot)&&t.style.setProperty("--abs-hover-snap-undershoot",e.hoverSnapUndershoot+"")}catch(o){}document.querySelector(".noise");try{_(d())}catch(o){}try{const e=[document.getElementById("grunge-video-light"),document.getElementById("grunge-video-dark")].filter(Boolean);if(e.length>0){let t=!1,o=!1;const n=()=>{if(t)return;const e=document.documentElement.classList.contains("entrance-complete"),n=document.body.classList.contains("noise-ready");o&&e&&n&&(t=!0,document.body.classList.add("video-fade-ready"))};new MutationObserver(()=>{document.documentElement.classList.contains("entrance-complete")&&n()}).observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),new MutationObserver(()=>{document.body.classList.contains("noise-ready")&&n()}).observe(document.body,{attributes:!0,attributeFilter:["class"]});const i=()=>{o||(o=!0,n())};e.forEach(e=>{if(e.addEventListener("loadstart",()=>{},{once:!0}),e.addEventListener("loadedmetadata",()=>{},{once:!0}),e.addEventListener("canplaythrough",()=>{i();const t=e.play();void 0!==t&&t.then(()=>{}).catch(()=>{})},{once:!0}),e.addEventListener("error",()=>{},{once:!0}),e.readyState>=4){i();const t=e.play();void 0!==t&&t.catch(()=>{})}})}}catch(o){}M();const b=x(),g=Y(),ue=document.getElementById("bravia-balls");if(!b||!g||!ue)throw Error("Missing DOM elements");try{b.setAttribute("role","application"),b.getAttribute("aria-label")||b.setAttribute("aria-label","Interactive bouncy balls physics simulation")}catch(o){}N(b,g,ue),z(),v("bb:renderer"),f("‚úì Canvas initialized (container-relative sizing)"),d().mouseInCanvas=!1,"undefined"!=typeof window&&(window.mouseInCanvas=!1),q(),f("‚úì Pointer tracking configured"),"undefined"!=typeof document&&document.addEventListener("touchmove",e=>{var t;(t=e.target)instanceof Element&&(t.closest(".panel-dock .panel .panel-content")||t.closest("#controlPanel"))||e.preventDefault()},{passive:!1,capture:!0}),f("‚úì Overscroll lock configured"),T(),v("bb:input"),f("‚úì Custom cursor initialized"),A(),f("‚úì Wall elements initialized (outer-wall, inner-wall)"),E(),C(),j(),F(),P();try{B(m)}catch(o){}f("‚úì Sound engine primed (awaiting user unlock)"),"undefined"!=typeof window&&(me||(me=!0,window.addEventListener("bb:modeChanged",e=>{const t=d();if(!1===t?.sceneChangeSoundEnabled)return;const o=e?.detail||{};o.prevMode&&o.mode&&o.prevMode!==o.mode&&p(+(t?.sceneChangeSoundRadius??18),+(t?.sceneChangeSoundIntensity??.35),.5,null)},{passive:!0}))),v("bb:ui"),f("‚úì UI initialized (panel disabled in production)"),O(),v("bb:theme"),ae(),(()=>{try{"undefined"!=typeof window&&(window.legendFilter||(window.legendFilter={}),window.legendFilter.syncAllBalls=()=>{})}catch(o){}try{const e=document.getElementById("expertise-legend"),t=document.getElementById("legend-tooltip-output");if(!e)return;const o=Array.from(e.querySelectorAll(".legend__item"));for(const n of o)n&&(n.classList.add("legend__item--interactive"),t&&(n.addEventListener("mouseenter",()=>{const e=n.getAttribute("data-tooltip");e&&(t.textContent=e,t.style.opacity="1",t.style.visibility="visible")}),n.addEventListener("mouseleave",()=>{t.style.opacity="0",window.setTimeout(()=>{"0"===t.style.opacity&&(t.style.visibility="hidden")},50)})));t&&(t.style.visibility="hidden",t.style.opacity="0")}catch(o){}})(),f("‚úì Legend filter system configured"),re||(re=!0,window.addEventListener("keydown",t=>{if(["INPUT","TEXTAREA","SELECT"].includes(t.target.tagName))return;const o=t.key.toLowerCase();if("/"!==o&&"Slash"!==t.code){if("r"!==o)return"ArrowRight"===t.key?(t.preventDefault(),void e(1)):"ArrowLeft"===t.key?(t.preventDefault(),void e(-1)):void 0;t.preventDefault(),r();try{const e=d();ie(e.currentMode)}catch(t){}}else{if(t.preventDefault(),!a())return;import("./panel-dock.js").then(e=>{try{e.toggleDock?.()}catch(t){}}).catch(()=>{})}}),window.addEventListener("contextmenu",t=>{const o=t.target;"A"===o.tagName||"BUTTON"===o.tagName||o.closest("a")||o.closest("button")||o.closest(".panel")||"panelDock"===o.id||"masterPanel"===o.id||"dockToggle"===o.id||(t.preventDefault(),e(-1))})),f("‚úì Keyboard shortcuts registered");try{S(m),f("‚úì Modal overlay system initialized")}catch(o){console.warn("Modal overlay initialization error:",o?.message)}try{$(),f("‚úì CV password gate initialized")}catch(o){console.warn("CV gate initialization error:",o?.message)}try{I(),f("‚úì Portfolio password gate initialized")}catch(o){console.warn("Portfolio gate initialization error:",o?.message)}try{L(),f("‚úì Contact gate initialized")}catch(o){console.warn("Contact gate initialization error:",o?.message)}V(),D(),(()=>{try{const e=document.getElementById("cv-gate-trigger");if(e&&!e.querySelector(".footer-link-nowrap")){const t=((Z("footer.links.cv.text","")||"")+"").trim(),o=(e.textContent||"").trim().replace(/\s+/g," "),n=t||o;n&&n.includes("/")&&o===n&&(e.innerHTML=`<span class="footer-link-nowrap">${n}</span>`)}}catch(o){}})(),R(),f("‚úì Sound toggle button created"),f("‚úì Theme toggle button created");const pe=ee[Math.floor(Math.random()*ee.length)];U?.("startup"),c(pe);try{const e=await import("./controls.js");e.updateModeButtonsUI?.(pe)}catch(o){}v("bb:mode"),f("‚úì Mode initialized"),(()=>{(()=>{if(document.getElementById("quote-display"))return document.getElementById("quote-display");se=document.createElement("div"),se.id="quote-display",se.className="quote-display",se.setAttribute("aria-live","polite"),se.setAttribute("aria-atomic","true"),ce=document.createElement("div"),ce.className="quote-display__content quote-display__content--entering",de=document.createElement("p"),de.className="quote-display__text",le=document.createElement("p"),le.className="quote-display__author",ce.appendChild(de),ce.appendChild(le),se.appendChild(ce);const e=document.querySelector(".ui-meta-right");e?e.insertBefore(se,e.firstChild):document.body.appendChild(se)})();const e=u();e.currentMode&&(t(e.currentMode,!1),requestAnimationFrame(()=>{ce?.classList.remove("quote-display__content--entering")})),window.addEventListener("bb:modeChanged",e=>{const o=e.detail?.mode;o&&t(o,!0)})})(),f("‚úì Quote display initialized"),te(ne),W(null,{getForcesFn:oe}),v("bb:end"),f("‚úÖ Bouncy Balls running (modular)");const be=[{phase:"config",ms:Q("bb:m:config","bb:start","bb:config")},{phase:"renderer",ms:Q("bb:m:renderer","bb:config","bb:renderer")},{phase:"input",ms:Q("bb:m:input","bb:renderer","bb:input")},{phase:"ui",ms:Q("bb:m:ui","bb:input","bb:ui")},{phase:"theme",ms:Q("bb:m:theme","bb:ui","bb:theme")},{phase:"mode+loop",ms:Q("bb:m:mode","bb:theme","bb:mode")},{phase:"total",ms:Q("bb:m:total","bb:start","bb:end")}].filter(e=>"number"==typeof e.ms);be.length&&H(be.map(e=>({...e,ms:+e.ms.toFixed(2)}))),K();try{a()?X():G()}catch(s){try{console.error("Banner print error:",s),console.log("%cCurious mind detected. Design meets engineering at 60fps.","color: #888; font-style: italic;")}catch(o){}}try{const{orchestrateEntrance:e,revealAllLateElements:t}=await import("./shared.js").then(e=>e.aL),{getModalToAutoOpen:n,shouldSkipWallAnimation:a,resetTransitionState:r,setupPrefetchOnHover:s,initSpeculativePrefetch:c,didViewTransitionRun:l}=await import("./shared.js").then(e=>e.aK),u=d(),m=!!window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,p=n(),b=a(),g=l();window.addEventListener("pageshow",e=>{if(e.persisted){r();const e=document.getElementById("abs-scene");e&&(e.style.opacity="1")}});const h=document.getElementById("cv-gate-trigger"),v=document.getElementById("portfolio-gate-trigger");if(h&&s(h,"cv.html"),v&&s(v,"portfolio.html"),!u.entranceEnabled||m){try{await J()}catch(o){}await i(),t(),console.log("‚úì Entrance animation skipped (disabled or reduced motion)")}else await e({async waitForFonts(){try{await J()}catch(o){}},skipWallAnimation:b,skipEntranceAnimation:g}),console.log(g?"‚úì Entrance skipped (View Transition handled it)":b?"‚úì Quick entrance (returning from internal page)":"‚úì Dramatic entrance animation orchestrated");"cv"===p?setTimeout(()=>{const e=document.getElementById("cv-gate-trigger");e&&e.click()},400):"contact"===p&&setTimeout(()=>{const e=document.getElementById("contact-trigger");e&&e.click()},400),c()}catch(o){console.warn("‚ö†Ô∏è Entrance animation failed, falling back to simple fade:",o);try{await J()}catch(o){}await i();try{const{revealAllLateElements:e}=await import("./shared.js").then(e=>e.aL);e()}catch(l){["main-links","brand-logo"].forEach(e=>{const t=document.getElementById(e);t&&(t.style.removeProperty("opacity"),"brand-logo"===e&&t.style.removeProperty("filter"),t.style.visibility="visible")});const e=document.getElementById("fade-blocking");e&&e.remove()}}}catch(m){console.error("‚ùå Initialization failed:",m),document.body.innerHTML=`<div style="padding: 20px; color: red; background: white;">\n      <h2>Initialization Error</h2>\n      <pre>${m.message}\n${m.stack}</pre>\n    </div>`}})();export{o as applyFramePaddingCSSVars,n as applyVisualCSSVars};