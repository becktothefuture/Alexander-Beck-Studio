function t(){const t=c(),o=t.canvas;if(t.balls.length=0,!o)return void(u=-.1);const a=i(t.particleFountainMaxParticles||100),s=Math.min(5,a);for(let r=0;s>r;r++)n();u=0}function n(){const t=c(),n=t.canvas;if(!n)return null;const o=t.DPR||1,s=n.width,r=n.height,i=f(t,h.PARTICLE_FOUNTAIN),u=s/2,l=r-(Math.max(0,(t.wallThickness??0)*o)+Math.max(0,(t.wallInset??3)*o))-.5*i,{color:d,distributionIndex:m}=M(),p=new e(u,l,i,d);p.distributionIndex=m,p.isParticleFountain=!0,p.alpha=1,p.age=0,p.fading=!1,p.fadeProgress=0,p.originalRadius=i;const x=a(t,n,l)*(.9+.2*Math.random()),b=(t.particleFountainSpreadAngle??50)*Math.PI/180,j=(Math.random()-.5)*b;return p.vy=-x*Math.cos(j),p.vx=x*Math.sin(j),t.balls.push(p),p}function o(t){const n=c(),o=n.canvas;if(!o)return;const s=n.DPR||1,r=o.width,i=o.height,e=f(n,h.PARTICLE_FOUNTAIN),u=i-(Math.max(0,(n.wallThickness??0)*s)+Math.max(0,(n.wallInset??3)*s))-.5*e;t.x=r/2,t.y=u,t.alpha=1,t.r=e,t.rBase=e,t.age=0,t.fading=!1,t.fadeProgress=0,t.originalRadius=e;const l=a(n,o,u)*(.9+.2*Math.random()),d=(n.particleFountainSpreadAngle??50)*Math.PI/180,m=(Math.random()-.5)*d;if(t.vy=-l*Math.cos(m),t.vx=l*Math.sin(m),.3>Math.random()){const{color:n,distributionIndex:o}=M();t.color=n,t.distributionIndex=o}}function a(t,n,o){const a=(t.particleFountainInitialVelocity||600)*(t.DPR||1);if(!t.isMobile&&!t.isMobileViewport)return a;const s=Math.max(0,o-.6*n.height);return Math.min(a,Math.sqrt(2*Math.max(.01,Math.abs(t.G||t.GE*(t.gravityMultiplier||1)))*s))}function s(t,n){const o=c();if(o.currentMode!==h.PARTICLE_FOUNTAIN)return;if(!t.isParticleFountain)return;const a=o.particleFountainLifetime??8;if(t.fading||(t.age+=n,a>t.age||(t.fading=!0,t.fadeProgress=0,t.originalRadius||(t.originalRadius=t.rBase||t.r))),t.fading){t.fadeProgress+=n;const o=Math.min(1,t.fadeProgress/2);return t.alpha=Math.max(0,1-(1-Math.sqrt(1-o*o))),void(1>o||(t.alpha=0))}if(o.mouseInCanvas){const a=(o.particleFountainMouseRepelStrength??15e3)*o.DPR,s=(o.particleFountainMouseRepelRadius??0)*o.DPR,r=t.x-o.mouseX,c=t.y-o.mouseY,h=Math.sqrt(r*r+c*c);if(s>h&&h>.1){const o=a*(1-h/s)*n,i=c/h;t.vx+=r/h*o,t.vy+=i*o}}const s=o.particleFountainWaterDrag??.02;t.vx*=1-s,t.vy*=1-s,t.omega*=1-.5*s;const r=o.particleFountainUpwardForce||0;r>0&&(t.vy-=r*o.DPR*n)}function r(t){const a=c();if(a.currentMode!==h.PARTICLE_FOUNTAIN)return;const s=a.canvas;if(!s)return;const r=a.DPR||1,M=s.height-Math.max(0,(a.wallThickness??0)*r)-Math.max(0,(a.wallInset??3)*r),f=20*r;for(let n=a.balls.length-1;n>=0;n--){const t=a.balls[n];t.isParticleFountain&&(!t.fading||t.alpha>0?t.fading||M>t.y||-f>t.vy||o(t):a.balls.splice(n,1))}const e=a.particleFountainEmissionRate||30,l=Math.max(1,Math.round(e*((a.particleFountainLifetime??8)+2))),d=i(a.isMobile||a.isMobileViewport?l:a.particleFountainMaxParticles||l);u+=t;const m=1/e;let p=0,x=null,b=null,j=-1/0;for(let n=0;a.balls.length>n;n++){const t=a.balls[n];if(t.isParticleFountain){p+=1,x||(t.fading||t.y>=M&&t.vy>=-f)&&(x=t);const n=t.age??0;n>j&&(j=n,b=t)}}for(;u>=m;){if(d>p)n(),p+=1;else{const t=x||b;t&&o(t)}u-=m}u>2*m&&(u=0)}import{g as c,ao as h,aP as i,aO as M,aQ as f}from"./shared.js";import{B as e}from"./Ball.js";let u=0;export{s as applyParticleFountainForces,t as initializeParticleFountain,r as updateParticleFountain};