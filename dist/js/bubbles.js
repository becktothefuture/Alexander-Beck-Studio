function t(t,a){const n=a.height,o=n*Math.max(.15,Math.min(1,t.bubblesVerticalExtent??.7))/2,h=n/2;return{bandTop:Math.max(0,h-o),bandBottom:Math.min(n,h+o)}}function a(t){const a=Math.max(.1,Math.min(1,t.bubblesDepthSpan??.8));return Math.max(0,Math.min(1,.5+(Math.random()-.5)*a))}function n(t){return.7+.6*Math.max(0,Math.min(1,t))}function o(){const a=c();a.balls.length=0;const n=a.canvas;if(!n)return;const o=n.width,M=u(a.bubblesMaxCount||200);if(0>=M)return;const{bandTop:r,bandBottom:s}=t(a,n);for(let t=0;8>t&&M>t;t++){const t=Math.random()*o,a=r+Math.random()*(s-r),{color:n,distributionIndex:M}=i();h(t,a,n,M,!1,Math.random())}for(let t=8;M>t;t++){const t=Math.random()*o,a=r+Math.random()*(s-r),{color:n,distributionIndex:M}=i();h(t,a,n,M,!1,Math.random())}}function h(t,o,h,M,r=!1,s){const i=c(),u=i.DPR||1,e=.9+.2*Math.random(),m=d(i,f.BUBBLES)*e,l=a(i),p=n(l),B=Number.isFinite(s)?Math.max(0,Math.min(1,s)):r?1:0,x=new b(t,o,m*p*(1-Math.pow(1-B,3)),h);return x.distributionIndex=M,x.isBubble=!0,x.z=l,x.depthScale=p,x.baseRadius=m,x.targetRadius=m,x.wobblePhase=Math.random()*Math.PI*2,x.wobbleFreq=2+3*Math.random(),x.vx=28*(Math.random()-.5)*u,x.vy=(-160-140*Math.random())*u,x.spawning=1>B&&!r,x.spawnProgress=B,x.dissipating=!1,x.dissipateProgress=0,x.alpha=1,x.microBurst=!1,x.microTime=0,x.microLife=0,x.microStartRadius=0,x.wobbleMul=.6+.8*Math.random(),i.balls.push(x),x}function M(o){const h=c(),M=h.canvas;if(!M)return;const r=h.DPR||1,s=M.width,{bandBottom:i}=t(h,M);o.x=Math.random()*s,o.y=i+(60+30*Math.random())*r,o.vx=20*(Math.random()-.5)*r,o.vy=(-50-50*Math.random())*r,o.wobblePhase=Math.random()*Math.PI*2,o.wobbleFreq=2+3*Math.random(),o.color=e();const u=.9+.2*Math.random();o.targetRadius=d(h,f.BUBBLES)*u,o.baseRadius=o.targetRadius,o.r=0,o.rBase=0,o.spawning=!0,o.spawnProgress=0,o.dissipating=!1,o.dissipateProgress=0,o.alpha=1,o.microBurst=!1,o.microTime=0,o.microLife=0,o.microStartRadius=0,o.wobbleMul=.6+.8*Math.random(),o.z=a(h),o.depthScale=n(o.z)}function r(a,n){const o=c();if(o.currentMode!==f.BUBBLES)return;if(!a.isBubble)return;const h=o.canvas;if(!h)return;const{bandTop:r}=t(o,h);if(a.microBurst){a.microTime+=n;const t=a.microLife||.18,o=Math.min(1,t>0?a.microTime/t:1),h=Math.max(0,1-o);return a.vx*=.94,a.vy*=.9,a.r=a.microStartRadius*h,a.rBase=a.r,a.alpha=Math.max(0,1-o),void(1>o||(a.microBurst=!1,M(a)))}a.spawning&&(a.spawnProgress+=3*n,a.r=a.targetRadius*(a.depthScale??1)*(1-Math.pow(1-Math.min(1,a.spawnProgress),3)),a.rBase=a.r,1>a.spawnProgress||(a.spawning=!1,a.r=a.targetRadius*(a.depthScale??1),a.rBase=a.r));const s=.01*(o.bubblesWobble||40)*(a.wobbleMul||1);if(a.vy-=(o.bubblesRiseSpeed||150)*o.DPR*n,a.wobblePhase+=a.wobbleFreq*n,a.vx+=Math.sin(a.wobblePhase)*s*100*n,a.vx*=.92,a.vy*=.96,o.mouseInCanvas){const t=a.x-o.mouseX,h=a.y-o.mouseY,M=Math.sqrt(t*t+h*h),r=Math.max(0,o.bubblesDeflectRadius||0)*o.DPR;if(r>M&&M>1){const o=3e3*Math.pow(1-M/r,3),s=t/M,c=h/M;if(a.vx+=s*o*n,a.vy+=c*o*n,.3*r>M){const t=500*(1-M/(.3*r));a.vx+=s*t*n,a.vy+=c*t*n}}}const i=a.depthScale??1;if(r+Math.max(2,a.targetRadius*i*.5)>a.y&&!a.spawning&&!a.microBurst)return a.microBurst=!0,a.microTime=0,a.microLife=.18,a.microStartRadius=Math.max(.2,a.targetRadius*i*.5),a.r=a.microStartRadius,a.rBase=a.r,a.alpha=1,a.vx=40*(Math.random()-.5)*o.DPR,void(a.vy=-(260+140*Math.random())*o.DPR);(4*-a.r>a.x||a.x>h.width+4*a.r)&&M(a)}function s(){}import{g as c,aN as i,an as f,aO as u,aQ as e,aP as d}from"./shared.js";import{B as b}from"./Ball.js";export{r as applyBubblesForces,o as initializeBubbles,s as updateBubbles};