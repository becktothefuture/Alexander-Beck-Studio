function t(t={}){const i=t&&t.wheel&&"object"==typeof t.wheel?t.wheel:{},s=t&&t.sound&&"object"==typeof t.sound?t.sound:{},e=t&&t.mouseTilt&&"object"==typeof t.mouseTilt?t.mouseTilt:{},o=t&&t.cylinder&&"object"==typeof t.cylinder?t.cylinder:{},n=(t,i)=>{const s=+t;return Number.isFinite(s)?s:i},h=(t,i)=>{if("boolean"==typeof t)return t;if("number"==typeof t&&Number.isFinite(t))return 0!==t;if("string"==typeof t){const i=t.toLowerCase();if("true"===i||"1"===i)return!0;if("false"===i||"0"===i)return!1}return i};return{wheel:{sensitivity:n(i.sensitivity,N),ease:n(i.ease,D),lineHeightFallback:n(i.lineHeightFallback,z),pageScale:n(i.pageScale,T)},sound:{centerClickEnabled:h(s.centerClickEnabled,E),centerClickGain:n(s.centerClickGain,G),centerClickFilterHz:n(s.centerClickFilterHz,H),centerClickMinSpeed:n(s.centerClickMinSpeed,L),centerClickDebounceMs:n(s.centerClickDebounceMs,I),continuousWheelEnabled:h(s.continuousWheelEnabled,O),continuousTickGainMul:n(s.continuousTickGainMul,R),continuousSwishGainMul:n(s.continuousSwishGainMul,W),snapEnabled:h(s.snapEnabled,V),snapGain:n(s.snapGain,q),openGain:n(s.openGain,Z),openFilterHz:n(s.openFilterHz,B),closeGain:n(s.closeGain,Y),closeFilterHz:n(s.closeFilterHz,X),snapDebounceMs:n(s.snapDebounceMs,U)},mouseTilt:{enabled:h(e.enabled,J),sensitivity:n(e.sensitivity,K),ease:n(e.ease,Q),invertX:h(e.invertX,tt),invertY:h(e.invertY,it)},cylinder:{enabled:h(o.enabled,st),ringCount:n(o.ringCount,et),dotsPerRing:n(o.dotsPerRing,ot),depthRange:n(o.depthRange,nt),radiusMin:n(o.radiusMin,ht),radiusMax:n(o.radiusMax,at),radiusStep:n(o.radiusStep,rt),radiusRings:n(o.radiusRings,lt),verticalSpacing:n(o.verticalSpacing,ct),randomness:n(o.randomness,dt),dotSize:n(o.dotSize,ut),opacityMin:n(o.opacityMin,pt),opacityMax:n(o.opacityMax,ft),rotationSync:n(o.rotationSync,mt),gridPattern:(o.gridPattern||wt)+""}}}function i(i){const s=i&&"object"==typeof i?i:{};return{cssVars:s.cssVars&&"object"==typeof s.cssVars?{...s.cssVars}:{},runtime:t(s.runtime)}}function s(){return null!==_t||(_t="undefined"!=typeof window&&void 0!==window.__BUILD_TIMESTAMP__?window.__BUILD_TIMESTAMP__+"":Date.now()+""),_t}import{l as e,f as o,_ as n,g as h,k as a,a6 as r,a7 as l,F as c,G as d,q as u,a8 as p,E as f,H as m,a9 as w,S as v,O as g,M as b,aa as y,ab as _,ac as j,ad as M,ae as k,P as $,af as C,ag as x,ah as F,ai as P,aj as S}from"./shared.js";import{i as A}from"./wall-only-canvas.js";const N=1.8,D=.22,z=16,T=.9,E=!0,G=8,H=1600,L=120,I=70,O=!1,R=100,W=100,V=!1,q=12,Z=12,B=1800,Y=10,X=1600,U=300,J=!0,K=.8,Q=.15,tt=!1,it=!1,st=!0,et=12,ot=24,nt=1e3,ht=100,at=500,rt=80,lt=5,ct=60,dt=.2,ut=3,pt=.15,ft=.9,mt=1,wt="even",vt=new Set(["--bg-light","--bg-dark","--chrome-bg-light","--chrome-bg-dark","--frame-color-light","--frame-color-dark","--wall-color","--container-border-vw","--container-border-x-vw","--wall-thickness-vw","--wall-radius-vw","--layout-min-wall-radius","--layout-min-content-padding","--container-border","--container-border-x","--container-border-y","--wall-radius","--wall-thickness","--container-radius","--bg-color"]),gt=new Set(["--text-client-size","--text-title-size","--text-tags-size","--close-button-font-size"]);t();const bt=(()=>{try{const t=window.PORTFOLIO_BASE||"";return t&&!t.endsWith("/")?t+"/":t}catch(t){return""}})(),yt={basePath:bt,assetBasePath:bt+"images/portfolio/pages/",dataPath:bt+"config/contents-portfolio.json",coverFallback:bt+"images/portfolio/folio-cover/cover-default.webp"};let _t=null;class jt{constructor({runtimeConfig:t}={}){this.track=document.getElementById("track")||document.querySelector(".slider-track"),this.viewport=document.getElementById("viewport")||document.querySelector(".portfolio-viewport"),this.rig=null,this.projects=[],this.slides=[],this.wheelRotation=0,this.wheelVelocity=0,this.wheelFrame=null,this.wheelLastTime=0,this.wheelSlotCount=0,this.wheelStep=0,this.wheelBaseStep=0,this.wheelRadiusX=0,this.wheelRadiusY=0,this.wheelSpacing=0,this.wheelTilt=0,this.wheelDepth=1,this.wheelCenterX=0,this.wheelCenterY=0,this.wheelRotateFactor=0,this.wheelScaleMin=.8,this.wheelScaleMax=1,this.wheelBlurMax=0,this.wheelOpacityMin=.2,this.wheelOpacityMax=1,this.wheelOpacityCurve=1,this.wheelActiveLift=0,this.wheelScrollSpeed=0,this.wheelDragSpeed=0,this.wheelFriction=0,this.wheelSnapSpeed=0,this.wheelSnapStrength=0,this.wheelBounceStrength=0,this.wheelBounceDamping=0,this.wheelBounceImpulse=0,this.pendingBounceImpulse=0,this.cardBob=[],this.cardBobVel=[],this.prevWheelVelocity=0,this.lastSnapSlot=-1,this.lastSnapSoundTime=0,this.snapSoundDebounceMs=300,this.snapSoundEnabled=!1,this.continuousWheelEnabled=!1,this.lastWheelSpeed=0,this.centerClickEnabled=!0,this.centerClickMinSpeed=120,this.centerClickDebounceMs=70,this.lastCenterClickTime=0,this.lastAudioUpdate=0,this.inputSurface=null,this.mouseTiltLeft=0,this.mouseTiltRight=0,this.mouseTiltUp=0,this.mouseTiltDown=0,this.mouseTiltEnabled=!0,this.mouseTiltSensitivity=1,this.mouseTiltEase=.15,this.mouseTiltCurrentX=0,this.mouseTiltCurrentY=0,this.mouseTiltTargetX=0,this.mouseTiltTargetY=0,this.cardHoverScale=1.025,this.cardHoverLift=8,this.activeSlot=-1,this.lastWheelTime=0,this.activeIndex=-1,this.detailOpen=!1,this.isTransitioning=!1,this.detailOverlay=null,this.detailContent=null,this.detailScroller=null,this.detailClose=null,this.activeSlide=null,this.lastFocusedElement=null,this.preloadedProjects=new Set,this.preloadedAssets=new Set,this.detailVideoObserver=null,this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.transitionHost=null,this.dragPointerId=null,this.dragPointerCaptured=!1,this.dragThreshold=6,this.dragStartX=0,this.dragStartY=0,this.dragLastX=0,this.dragLastY=0,this.dragLastTime=0,this.dragMoved=!1,this.dragSuppressClickUntil=0,this.customCursor=null,this.metaContainer=null,this.metaClient=null,this.metaTitle=null,this.metaSummary=null,this.metaSwapTimer=null,this.applyRuntimeConfig(t)}applyRuntimeConfig(i){this.runtimeConfig=t(i),this.wheelConfig=this.runtimeConfig.wheel,this.wheelSensitivity=this.wheelConfig.sensitivity,this.wheelEase=this.prefersReducedMotion?1:this.wheelConfig.ease,this.wheelLineHeight=this.getWheelLineHeight();const s=this.runtimeConfig.sound;s&&(this.snapSoundDebounceMs=s.snapDebounceMs,this.snapSoundEnabled=!!s.snapEnabled,this.continuousWheelEnabled=!!s.continuousWheelEnabled,this.centerClickEnabled=!!s.centerClickEnabled,this.centerClickMinSpeed=+s.centerClickMinSpeed||0,this.centerClickDebounceMs=+s.centerClickDebounceMs||0,k({continuousEnabled:!!s.continuousWheelEnabled,tickGainMul:(+s.continuousTickGainMul||100)/100,swishGainMul:(+s.continuousSwishGainMul||100)/100,centerGain:(+s.centerClickGain||0)/100,centerFilterHz:+s.centerClickFilterHz||1600,snapGain:s.snapGain/100,openGain:s.openGain/100,openFilterHz:s.openFilterHz,closeGain:s.closeGain/100,closeFilterHz:s.closeFilterHz,snapDebounceMs:s.snapDebounceMs}));const e=this.runtimeConfig.mouseTilt;e&&(this.mouseTiltEnabled=!this.prefersReducedMotion&&e.enabled,this.mouseTiltSensitivity=e.sensitivity||1,this.mouseTiltEase=e.ease||.15,this.mouseTiltInvertX=!!e.invertX,this.mouseTiltInvertY=!!e.invertY)}async init(){await this.loadData(),this.renderSlides(),0===this.slides.length?console.error("⚠️ No slides rendered - check portfolio data"):console.log(`✓ Rendered ${this.slides.length} slides`),this.setupMeta(),this.setupDetailOverlay(),this.inputSurface=document.body,this.bindEvents(),this.setupCustomCursor(),this.setupSoundToggle(),this.setupCardHover(),this.updateWheelConfig(),this.startWheel(),this.checkUrlHash(),window.addEventListener("hashchange",()=>this.checkUrlHash()),window.addEventListener("resize",()=>{this.updateWheelConfig()})}async loadData(){try{const t=await(async()=>{const t=[yt.dataPath,yt.basePath+"js/contents-portfolio.json","../dist/js/contents-portfolio.json"];for(const s of t)try{const t=await fetch(s,{cache:"no-cache"});if(!t.ok)continue;return await t.json()}catch(i){}throw Error("No portfolio data found")})();this.projects=Array.isArray(t?.projects)?t.projects:[]}catch(t){console.error("Failed to load portfolio data",t),this.projects=[,,,,,,,].fill(0).map((t,i)=>({id:"p"+i,client:"Client Name",title:"Project Title",tags:["#tag1","#tag2"],image:""}))}}renderSlides(){this.track.innerHTML="",this.slides=[],this.rig=document.createElement("div"),this.rig.className="slider-rig",this.track.appendChild(this.rig);const t=this.projects.length||0,i=t?2*t:0;this.wheelSlotCount=i,this.wheelBaseStep=i?2*Math.PI/i:0,this.wheelStep=this.wheelBaseStep,this.cardBob=Array(i).fill(0),this.cardBobVel=Array(i).fill(0),this.lastSnapSlot=-1;const e=h(),o=e?.currentColors||["#b7bcb7","#d0d0d0","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],n=[o[3]||"#00695c",o[5]||"#ff4013",o[6]||"#0d5cb6",o[7]||"#ffa000"].filter(Boolean);for(let h=0;i>h;h+=1){const i=h%t,e=this.projects[i],o=document.createElement("div");o.className="slide",o.dataset.slotIndex=h+"",o.dataset.projectIndex=i+"",o.dataset.projectId=e?.id||"p"+i,o.setAttribute("role","button"),o.tabIndex=0,o.setAttribute("aria-label","Open project: "+(e?.title||"Project"));const a=[],r=n.length;for(let t=0;r>t;t++){const i=(t+1)/r*100;a.push(`${n[t]} ${t/r*100}%`),a.push(`${n[t]} ${i}%`)}const l=`linear-gradient(90deg, ${a.join(", ")})`;o.style.setProperty("--slide-gradient",l);const c=document.createElement("div");c.className="slide-image-container";const d=document.createElement("img");d.className="slide-image",d.alt=e?.title?e.title+" preview":"Project preview";let u=e?.image?`${yt.assetBasePath}${e.image}`:yt.coverFallback;const p=u.includes("?")?"&":"?";u=`${u}${p}v=${s()}`,d.src=u,d.loading="lazy",d.draggable=!1,c.appendChild(d),o.appendChild(c),this.rig.appendChild(o),this.slides.push(o)}}setupMeta(){this.metaContainer=document.getElementById("portfolioMeta"),this.metaContainer&&(this.metaClient=this.metaContainer.querySelector('[data-meta="client"]'),this.metaTitle=this.metaContainer.querySelector('[data-meta="title"]'),this.metaSummary=this.metaContainer.querySelector('[data-meta="summary"]'))}parseValue(t){const i=(t+"").trim();if(i.endsWith("vw"))return parseFloat(i)/100*window.innerWidth;if(i.endsWith("vh"))return parseFloat(i)/100*window.innerHeight;if(i.endsWith("vmin")){const t=Math.min(window.innerWidth,window.innerHeight);return parseFloat(i)/100*t}if(i.endsWith("vmax")){const t=Math.max(window.innerWidth,window.innerHeight);return parseFloat(i)/100*t}if(i.endsWith("rem")){const t=parseFloat(getComputedStyle(document.documentElement).fontSize)||16;return parseFloat(i)*t}return parseFloat(i)}getWheelLineHeight(){const t=getComputedStyle(document.body),i=parseFloat(t.lineHeight);if(Number.isFinite(i))return i;const s=parseFloat(t.fontSize);return Number.isFinite(s)?1.4*s:this.wheelConfig?.lineHeightFallback??16}getWheelDelta(t){const i=Math.abs(t.deltaX),s=Math.abs(t.deltaY);let e=0;return e=t.shiftKey&&s>i||s>i?t.deltaY:t.deltaX,0===e?0:(1===t.deltaMode?e*=this.wheelLineHeight:2===t.deltaMode&&(e*=(this.viewport?this.viewport.clientWidth:window.innerWidth)*(this.wheelConfig?.pageScale??1)),e)}isInteractiveTarget(t){return!(!t||"function"!=typeof t.closest||!t.closest("a, button, input, select, textarea, .panel-dock, .portfolio-header, .portfolio-footer, .project-detail, .sound-toggle"))}bindEvents(){const t=this.inputSurface||document.body,i=t;t.addEventListener("wheel",t=>{if(this.detailOpen||t.target.closest(".project-detail"))return;if(this.isInteractiveTarget(t.target))return;if(t.ctrlKey||t.metaKey)return;if(null!==this.dragPointerId)return;const i=this.getWheelDelta(t);i&&(t.preventDefault(),this.applyWheelImpulse(i))},{passive:!1}),t.addEventListener("pointerdown",t=>{this.detailOpen||0===t.button&&(this.isInteractiveTarget(t.target)||(this.dragPointerId=t.pointerId,this.dragPointerCaptured=!1,this.dragStartX=t.clientX,this.dragStartY=t.clientY,this.dragLastX=t.clientX,this.dragLastY=t.clientY,this.dragLastTime=performance.now(),this.dragMoved=!1))}),t.addEventListener("pointermove",t=>{if(null===this.dragPointerId||t.pointerId!==this.dragPointerId)return;const s=t.clientY-this.dragStartY;if(!this.dragMoved){if(this.dragThreshold>Math.abs(t.clientX-this.dragStartX)&&this.dragThreshold>Math.abs(s))return;this.dragMoved=!0,i.setPointerCapture&&(i.setPointerCapture(t.pointerId),this.dragPointerCaptured=!0),this.viewport.classList.add("is-dragging")}const e=performance.now(),o=Math.max(.016,(e-this.dragLastTime)/1e3),n=t.clientX-this.dragLastX,h=t.clientY-this.dragLastY,a=Math.abs(n)>=Math.abs(h),r=a?n:h,l=this.viewport?.clientWidth||window.innerWidth,c=this.viewport?.clientHeight||window.innerHeight,d=a?l:c,u=(d?r/d:0)*this.wheelDragSpeed*Math.PI*2;this.wheelRotation+=u;const p=u/o,f=Number.isFinite(this.wheelEase)?this.wheelEase:.2;this.wheelVelocity=this.wheelVelocity*(1-f)+p*f,this.dragLastX=t.clientX,this.dragLastY=t.clientY,this.dragLastTime=e,t.preventDefault()});const s=t=>{if(null!==this.dragPointerId&&(!t||t.pointerId===this.dragPointerId)){if(this.dragPointerCaptured&&i.releasePointerCapture)try{i.releasePointerCapture(this.dragPointerId)}catch(s){}this.dragPointerCaptured=!1,this.dragPointerId=null,this.viewport.classList.remove("is-dragging"),this.dragMoved&&(this.dragSuppressClickUntil=performance.now()+200),this.dragMoved=!1}};t.addEventListener("pointerup",s),t.addEventListener("pointercancel",s),t.addEventListener("pointerleave",s);const e=()=>{this.detailOpen||document.body.classList.contains("detail-open")&&(document.body.classList.remove("detail-open"),this.detailOverlay&&(this.detailOverlay.classList.remove("is-open"),this.detailOverlay.style.removeProperty("opacity"),this.detailOverlay.style.removeProperty("transform"),this.detailOverlay.setAttribute("aria-hidden","true")))};if(document.addEventListener("click",t=>{if(!this.viewport)return;if(this.dragSuppressClickUntil&&performance.now()<this.dragSuppressClickUntil)return;if(this.detailOpen)return;if(this.isInteractiveTarget(t.target))return;e();const i=this.viewport.getBoundingClientRect();if(i.left>t.clientX||t.clientX>i.right||i.top>t.clientY||t.clientY>i.bottom)return;const s=t.target.closest?.(".project-detail");if(s&&"false"===s.getAttribute("aria-hidden"))return;const o=t.target.closest?.(".slide")||((t,i)=>{if(!Number.isFinite(t)||!Number.isFinite(i))return null;const s=document.elementsFromPoint(t,i);for(const e of s){const t=e?.closest?.(".slide");if(t)return t}return null})(t.clientX,t.clientY);if(!o)return;const n=+(o.dataset.projectIndex??o.dataset.index);Number.isNaN(n)||this.openProjectDetail(n,o)},{capture:!0}),document.addEventListener("keydown",t=>{if(this.detailOpen)return;if("Enter"!==t.key&&" "!==t.key)return;const i=t.target.closest?.(".slide");if(!i)return;t.preventDefault();const s=+(i.dataset.projectIndex??i.dataset.index);Number.isNaN(s)||this.openProjectDetail(s,i)}),document.addEventListener("keydown",t=>{this.detailOpen&&"Escape"===t.key&&this.closeProjectDetail()}),this.mouseTiltEnabled&&this.track){document.addEventListener("pointermove",t=>{if(t&&t.pointerType&&"mouse"!==t.pointerType)return;if(this.detailOpen||null!==this.dragPointerId)return this.mouseTiltTargetX=0,void(this.mouseTiltTargetY=0);if(this.isInteractiveTarget(t.target))return this.mouseTiltTargetX=0,void(this.mouseTiltTargetY=0);if(!this.track)return;const i=(this.viewport?.clientWidth||window.innerWidth)/2,s=(this.viewport?.clientHeight||window.innerHeight)/2,e=(t.clientY-s)/s,o=Math.max(-1,Math.min(1,(t.clientX-i)/i)),n=Math.max(-1,Math.min(1,e));let h=0;h=0>o?this.mouseTiltRight*Math.abs(o)*this.mouseTiltSensitivity:-this.mouseTiltLeft*o*this.mouseTiltSensitivity;let a=0;a=0>n?this.mouseTiltDown*Math.abs(n)*this.mouseTiltSensitivity:-this.mouseTiltUp*n*this.mouseTiltSensitivity,this.mouseTiltInvertX&&(h=-h),this.mouseTiltInvertY&&(a=-a),this.mouseTiltTargetX=h,this.mouseTiltTargetY=a},{passive:!0});const i=()=>{this.mouseTiltTargetX=0,this.mouseTiltTargetY=0};window.addEventListener("blur",i,{passive:!0}),window.addEventListener("mouseout",t=>{t.relatedTarget||t.toElement||i()},{passive:!0}),t.addEventListener("pointerdown",t=>{"mouse"===t.pointerType&&0===t.button&&(this.mouseTiltTargetX=0,this.mouseTiltTargetY=0)})}}setupCustomCursor(){if(this.customCursor)return;if(window.matchMedia&&window.matchMedia("(pointer: coarse)").matches)return;const t=document.createElement("div");t.id="custom-cursor",t.classList.add("gate-active"),t.setAttribute("aria-hidden","true"),t.style.display="none",document.body.appendChild(t),this.customCursor=t;const i=i=>{"touch"!==i.pointerType&&((t=>{if(!t||!t.closest)return!1;const i=t.closest('a, button, [role="button"]');return!!i&&!i.classList?.contains?.("slide")&&!i.closest?.(".slide")})(i.target)?t.style.display="none":(t.style.display="block",t.style.left=i.clientX+"px",t.style.top=i.clientY+"px"))},s=()=>{t.style.display="none"};document.addEventListener("pointermove",i),document.addEventListener("pointerdown",i),window.addEventListener("blur",s),window.addEventListener("mouseout",t=>{t.relatedTarget||t.toElement||s()})}setupCardHover(){const t=t=>{"touch"!==t.pointerType&&document.body.classList.add("portfolio-card-hovering")},i=t=>{if("touch"===t.pointerType)return;const i=t.relatedTarget?.closest(".slide");i||document.body.classList.remove("portfolio-card-hovering")};this.rig&&(this.rig.addEventListener("mouseenter",i=>{i.target.closest(".slide")&&t(i)},!0),this.rig.addEventListener("mouseleave",i,!0)),this.slides&&this.slides.length>0&&this.slides.forEach(s=>{s.addEventListener("mouseenter",t),s.addEventListener("mouseleave",i)})}setupSoundToggle(){try{$()}catch(t){}}getCssLength(t,i){const s=getComputedStyle(document.documentElement).getPropertyValue(t).trim();if(!s)return i;const e=this.parseValue(s);return Number.isFinite(e)?e:i}updateWheelConfig(){this.wheelRadiusX=this.getCssLength("--wheel-radius-x",.35*window.innerWidth),this.wheelRadiusY=this.getCssLength("--wheel-radius-y",.18*window.innerHeight),this.wheelSpacing=this.getCssLength("--wheel-spacing",0);const t=this.wheelSpacing,i=this.slides?.[0],s=i?.getBoundingClientRect?.()?.width||0,e=this.wheelStep||this.wheelBaseStep||0;s>0&&e>0&&(this.wheelSpacing=Math.max(t,Math.max(0,1.1*s/(2*Math.max(Math.sin(e/2),.001))-this.wheelRadiusX))),this.wheelCenterX=this.getCssLength("--wheel-center-x",0),this.wheelCenterY=this.getCssLength("--wheel-center-y",0);const o=this.getCssNumber("--wheel-tilt",60);this.wheelTilt=o*Math.PI/180,this.wheelDepth=this.getCssNumber("--wheel-depth",1),this.wheelRotateFactor=this.getCssNumber("--wheel-rotate",12),this.wheelScaleMin=this.getCssNumber("--wheel-scale-min",.8),this.wheelScaleMax=this.getCssNumber("--wheel-scale-max",1),this.wheelBlurMax=this.getCssLength("--wheel-blur-max",0),this.wheelOpacityMin=this.getCssNumber("--wheel-opacity-min",.2),this.wheelOpacityMax=this.getCssNumber("--wheel-opacity-max",1),this.wheelOpacityCurve=this.getCssNumber("--wheel-opacity-curve",1),this.wheelActiveLift=this.getCssLength("--wheel-active-lift",0),this.wheelScrollSpeed=this.getCssNumber("--wheel-scroll-speed",.7),this.wheelDragSpeed=this.getCssNumber("--wheel-drag-speed",1),this.wheelFriction=this.getCssNumber("--wheel-friction",4),this.cardHoverScale=this.getCssNumber("--card-hover-scale",1.025),this.cardHoverLift=this.getCssLength("--card-hover-lift",.6),this.wheelSnapSpeed=this.getCssNumber("--wheel-snap-speed",.2),this.wheelSnapStrength=this.getCssNumber("--wheel-snap-strength",6),this.wheelBounceStrength=this.getCssNumber("--wheel-bounce-strength",14),this.wheelBounceDamping=this.getCssNumber("--wheel-bounce-damping",8),this.wheelBounceImpulse=this.getCssLength("--wheel-bounce-impulse",0),this.mouseTiltLeft=this.getCssNumber("--mouse-tilt-left",3),this.mouseTiltRight=this.getCssNumber("--mouse-tilt-right",3),this.mouseTiltUp=this.getCssNumber("--mouse-tilt-up",3),this.mouseTiltDown=this.getCssNumber("--mouse-tilt-down",3),this.updateWheelPositions(0,!0)}startWheel(){if(this.wheelFrame)return;this.wheelLastTime=performance.now();const t=i=>{const s=Math.min(.05,Math.max(.001,(i-this.wheelLastTime)/1e3));this.wheelLastTime=i,this.updateWheelPhysics(s),this.updateWheelPositions(s),this.wheelFrame=window.requestAnimationFrame(t)};this.wheelFrame=window.requestAnimationFrame(t)}updateWheelPhysics(t){if(this.detailOpen)return this.wheelVelocity=0,this.pendingBounceImpulse=0,void this.updateWheelAudio(0);if(this.prefersReducedMotion)return this.wheelVelocity=0,this.wheelRotation=this.getNearestSnapRotation(this.wheelRotation),void this.updateWheelAudio(0);const i=this.prevWheelVelocity;if(null===this.dragPointerId){this.wheelRotation+=this.wheelVelocity*t,this.wheelVelocity*=Math.exp(-Math.max(0,this.wheelFriction)*t);const s=this.wheelSnapSpeed*Math.PI*2;if(s>Math.abs(this.wheelVelocity)&&this.wheelStep){const i=this.getNearestSnapRotation(this.wheelRotation);this.wheelVelocity+=(i-this.wheelRotation)*this.wheelSnapStrength*t}Math.abs(i)>=s&&s>Math.abs(this.wheelVelocity)&&this.wheelBounceImpulse>0&&(this.pendingBounceImpulse=this.wheelBounceImpulse*Math.min(1,Math.abs(i)/(6*s))*(0>i?1:-1))}if(this.prevWheelVelocity=this.wheelVelocity,this.updateWheelAudio(),Math.abs(this.wheelRotation)>8*Math.PI&&(this.wheelRotation=this.wrapAngle(this.wheelRotation)),this.mouseTiltEnabled&&this.rig)if(this.detailOpen||this.prefersReducedMotion||null!==this.dragPointerId)this.mouseTiltCurrentX=0,this.mouseTiltCurrentY=0,this.mouseTiltTargetX=0,this.mouseTiltTargetY=0,this.rig.style.transform="";else{const t=this.mouseTiltEase;this.mouseTiltCurrentX=this.mouseTiltCurrentX+(this.mouseTiltTargetX-this.mouseTiltCurrentX)*t,this.mouseTiltCurrentY=this.mouseTiltCurrentY+(this.mouseTiltTargetY-this.mouseTiltCurrentY)*t,this.rig.style.transform=Math.abs(this.mouseTiltCurrentX)>.01||Math.abs(this.mouseTiltCurrentY)>.01?["translateZ(var(--mouse-tilt-pivot-z))",`rotateY(${this.mouseTiltCurrentX.toFixed(2)}deg)`,`rotateX(${this.mouseTiltCurrentY.toFixed(2)}deg)`,"translateZ(calc(var(--mouse-tilt-pivot-z) * -1))"].join(" "):""}}getNearestSnapRotation(t){return this.wheelStep?Math.round(t/this.wheelStep)*this.wheelStep:t}updateWheelPositions(t=0,i=!1){if(!this.slides.length||!this.viewport||!this.wheelStep)return;const s=this.viewport.clientWidth||window.innerWidth,e=this.viewport.clientHeight||window.innerHeight,o=Math.min(s,e),n=this.getActiveSlotIndex(),h=Math.sin(this.wheelTilt),a=this.wheelRadiusX+this.wheelSpacing,r=this.wheelRadiusY+this.wheelSpacing,l=Math.max(.001,t||.001),c=this.pendingBounceImpulse;c&&(this.pendingBounceImpulse=0),this.slides.forEach((t,d)=>{const u=d*this.wheelStep+this.wheelRotation,p=Math.sin(u),f=.5*(1-Math.cos(u))*this.wheelDepth,m=Math.min(1,Math.max(0,f)),w=p*a+this.wheelCenterX;let v=f*r*h-(1-m)*this.wheelActiveLift+this.wheelCenterY;const g=this.wheelScaleMin+(1-m)*(this.wheelScaleMax-this.wheelScaleMin),b=o>0?this.wheelBlurMax*m/o*100:0,y=Math.pow(m,Math.max(.2,this.wheelOpacityCurve)),_=Math.max(0,Math.min(1,this.wheelOpacityMin)),j=_+(Math.max(_,Math.min(1,this.wheelOpacityMax))-_)*(1-y),M=p*this.wheelRotateFactor;if(void 0===this.cardBob[d]&&(this.cardBob[d]=0,this.cardBobVel[d]=0),this.wheelBounceStrength>0){c&&(this.cardBobVel[d]+=c*(1-m));const t=this.cardBob[d];let i=this.cardBobVel[d];i+=-t*this.wheelBounceStrength*l,i*=Math.exp(-this.wheelBounceDamping*l);const s=t+i*l;this.cardBob[d]=s,this.cardBobVel[d]=i,v+=s}if(t.classList.contains("is-expanding"))t.dataset.frozenX&&t.style.setProperty("--slide-x",t.dataset.frozenX),t.dataset.frozenY&&t.style.setProperty("--slide-y",t.dataset.frozenY);else{const i=e?v/e*100:0;t.style.setProperty("--slide-x",(s?w/s*100:0)+"vw"),t.style.setProperty("--slide-y",i+"vh")}const k=10*this.wheelDepth*(.5-m);if(!t.classList.contains("is-expanding")){const i=t.matches(":hover"),s=i?g*this.cardHoverScale:g;t.style.setProperty("--slide-z",(i?k+this.cardHoverLift:k).toFixed(2)+"vmin"),t.style.setProperty("--slide-scale",s.toFixed(4))}const $=t.matches(":hover");t.style.setProperty("--slide-blur",($?0:b)+"vmin"),t.style.setProperty("--slide-opacity",Math.max(0,Math.min(1,j)).toFixed(3)),t.style.setProperty("--slide-rotate",M.toFixed(2)+"deg"),t.style.zIndex=Math.round(1e3*(1-m))+"",i&&t.classList.toggle("active",d===n)}),this.updateActiveFromRotation(n,i)}getActiveSlotIndex(){return this.wheelStep&&this.wheelSlotCount?(Math.round(-this.wheelRotation/this.wheelStep)%this.wheelSlotCount+this.wheelSlotCount)%this.wheelSlotCount:0}updateActiveFromRotation(t,i=!1){if(!this.slides.length)return;const s=Number.isFinite(t)?t:this.getActiveSlotIndex();if(s!==this.activeSlot||i){this.activeSlot=s,this.slides.forEach((t,i)=>{t.classList.toggle("active",i===s)});const t=this.slides[s],i=+(t?.dataset.projectIndex??s);if(Number.isFinite(i)&&i!==this.activeIndex&&(this.activeIndex=i,this.prefetchProjectAssets(this.projects[i]),this.updateFixedMeta(this.projects[i]),this.maybePlayCenterClick(),[-2,-1,1,2].forEach(t=>{const s=this.projects[(i+t+this.projects.length)%this.projects.length];if(s&&!this.preloadedProjects.has(s.id)){const t=s.image?`${yt.assetBasePath}${s.image}`:null;t&&!this.preloadedAssets.has(t)&&(this.preloadedAssets.add(t),this.preloadImage(t))}})),this.snapSoundEnabled&&!this.detailOpen&&s!==this.lastSnapSlot&&this.wheelSnapSpeed*Math.PI*2>Math.abs(this.wheelVelocity)){const t=performance.now();t-this.lastSnapSoundTime>(this.snapSoundDebounceMs||300)&&(C(),this.lastSnapSoundTime=t,this.lastSnapSlot=s)}}}maybePlayCenterClick(){if(!this.centerClickEnabled)return;if(this.detailOpen)return;if(this.prefersReducedMotion)return;if(!Number.isFinite(this.lastWheelSpeed)||this.centerClickMinSpeed>this.lastWheelSpeed)return;const t=performance.now(),i=Math.max(0,this.centerClickDebounceMs||0);i&&i>t-this.lastCenterClickTime||(x(),this.lastCenterClickTime=t)}wrapAngle(t){const i=2*Math.PI;let s=t%i;return s>Math.PI&&(s-=i),-Math.PI>s&&(s+=i),s}applyWheelImpulse(t){if(!this.viewport)return;const i=this.viewport.clientWidth||window.innerWidth,s=this.viewport.clientHeight||window.innerHeight,e=t/(Math.min(i,s)||i||1)*this.wheelScrollSpeed*(Number.isFinite(this.wheelSensitivity)?this.wheelSensitivity:1)*Math.PI*2,o=performance.now(),n=this.lastWheelTime?Math.max(.016,(o-this.lastWheelTime)/1e3):.016;this.lastWheelTime=o;const h=e/n,a=Number.isFinite(this.wheelEase)?this.wheelEase:.2;this.wheelVelocity=this.wheelVelocity*(1-a)+h*a}updateWheelAudio(t){const i=performance.now();if(40>i-this.lastAudioUpdate)return;this.lastAudioUpdate=i;const s=(this.wheelRadiusX||.3*window.innerWidth)+(this.wheelSpacing||0),e=Number.isFinite(t)?t:Math.abs(this.wheelVelocity)*s;this.lastWheelSpeed=Number.isFinite(e)?e:0,S(this.continuousWheelEnabled?e:0)}updateFixedMeta(t){if(!this.metaContainer||!t)return;const i=t.id||t.title||"";if(this.metaContainer.dataset.projectId===i)return;const s=(t,i)=>{if(!t)return;const s=i?i+"":"";t.textContent=s,t.style.display=s?"block":"none"},e=t.summary||(Array.isArray(t.tags)?t.tags.join(" "):""),o=this.prefersReducedMotion?0:Math.round(.45*this.getCssNumber("--meta-transition-speed",360));this.metaSwapTimer&&(window.clearTimeout(this.metaSwapTimer),this.metaSwapTimer=null),this.metaContainer.classList.add("is-switching");const n=()=>{this.metaContainer.dataset.projectId=i,s(this.metaClient,t.client),s(this.metaTitle,t.title),s(this.metaSummary,e),requestAnimationFrame(()=>this.metaContainer.classList.remove("is-switching"))};0!==o?this.metaSwapTimer=window.setTimeout(()=>{this.metaSwapTimer=null,n()},o):n()}setupDetailOverlay(){this.detailOverlay=document.getElementById("projectDetail"),this.detailOverlay||(this.detailOverlay=this.createDetailOverlay()),this.transitionHost=document.querySelector(".wall-frame")||document.body,this.detailContent=this.detailOverlay.querySelector("#projectDetailContent"),this.detailScroller=this.detailOverlay.querySelector(".project-detail__scroller"),this.detailClose=this.detailOverlay.querySelector("[data-detail-close]"),this.detailClose&&this.detailClose.addEventListener("click",()=>this.closeProjectDetail()),this.detailOverlay.addEventListener("click",t=>{t.target.closest("[data-detail-close-inline]")&&this.closeProjectDetail()}),this.setupCloseButtonScrollAnimation()}setupCloseButtonScrollAnimation(){}createDetailOverlay(){const t=document.createElement("div");t.id="projectDetail",t.className="project-detail",t.setAttribute("aria-hidden","true"),t.innerHTML='\n      <div class="project-detail__progress" aria-hidden="true"></div>\n      <div class="project-detail__noise project-detail__noise--back" aria-hidden="true"></div>\n      <div class="project-detail__card" role="dialog" aria-modal="true" aria-label="Project detail">\n        <button class="project-detail__close gate-back abs-icon-btn" type="button" aria-label="Close project detail" data-detail-close>\n          <i class="ti ti-x" aria-hidden="true"></i>\n        </button>\n        <div class="project-detail__scroller">\n          <div class="project-detail__inner" id="projectDetailContent"></div>\n        </div>\n      </div>\n    ';const i=document.querySelector(".wall-frame")||document.body;return this.transitionHost=i,i.appendChild(t),t}resolveDetailAsset(t){if(!t)return"";if(/^https?:\/\//.test(t))return t;const i=t.replace(/^\/+/,""),e=`${yt.basePath}${i}`,o=e.includes("?")?"&":"?";return`${e}${o}v=${s()}`}getContentBlocks(t){return Array.isArray(t.contentBlocks)&&t.contentBlocks.length?t.contentBlocks:Array.isArray(t.gallery)&&t.gallery.length?t.gallery.map(t=>({type:"image",src:t})):[]}getVideoMimeType(t){return t?t.endsWith(".webm")?"video/webm":t.endsWith(".mp4")?"video/mp4":"":""}renderDetailContent(t){if(!this.detailContent||!t)return;let i=t.image?`${yt.assetBasePath}${t.image}`:yt.coverFallback;const e=i.includes("?")?"&":"?";i=`${i}${e}v=${s()}`;const o=this.getContentBlocks(t),n=Array.isArray(t.links)?t.links:[],h=Array.isArray(t.takeaways)&&t.takeaways.length?t.takeaways:["More takeaways coming soon."],a=[{label:"Focus",value:t.client},{label:"Role",value:t.role},{label:"Year",value:t.year}].filter(t=>t.value),r=a.map(t=>`\n      <div class="project-detail__meta-item">\n        <dt>${t.label}</dt>\n        <dd>${t.value}</dd>\n      </div>\n    `).join(""),l=o.map(i=>{if("text"===i.type)return`\n              <div class="project-detail__block project-detail__text-block">\n                <p>${i.text||""}</p>\n              </div>\n            `;if("video"===i.type){const t=this.resolveDetailAsset(i.src),s=this.getVideoMimeType(t),e=!this.prefersReducedMotion;return`\n              <figure class="project-detail__block project-detail__video-wrapper">\n                <video class="project-detail__video" ${e?"autoplay":""} muted loop playsinline preload="metadata" data-src="${t}">\n                  <source src="${t}"${s?` type="${s}"`:""}>\n                </video>\n                <button class="project-detail__video-toggle" type="button" aria-label="Play/Pause video">\n                  <i class="ti ti-player-${e?"pause":"play"}" aria-hidden="true"></i>\n                </button>\n                ${i.caption?`<figcaption class="project-detail__caption">${i.caption}</figcaption>`:""}\n              </figure>\n            `}return`\n          <figure class="project-detail__block">\n            <div class="project-detail__media-skeleton" style="aspect-ratio: 16/9;">\n              <img class="project-detail__media-block" src="${this.resolveDetailAsset(i.src)}" alt="${i.alt||t.title||"Project image"}" loading="lazy" onload="this.classList.add('loaded');this.parentElement.classList.remove('project-detail__media-skeleton')" onerror="this.classList.add('error');this.parentElement.classList.add('project-detail__media-error')">\n            </div>\n            ${i.caption?`<figcaption class="project-detail__caption">${i.caption}</figcaption>`:""}\n          </figure>\n        `}).join(""),c=n.length?`\n      <div class="project-detail__links">\n        ${n.map(t=>`\n          <a href="${t.url}" target="_blank" rel="noopener noreferrer">\n            ${t.label}\n            <i class="ti ti-external-link project-detail__external-icon" aria-hidden="true"></i>\n          </a>\n        `).join("")}\n      </div>\n    `:"";this.detailContent.innerHTML=`\n      <section class="project-detail__hero">\n        <div class="project-detail__media project-detail__media-skeleton">\n          <img class="project-detail__image" src="${i}" alt="${t.title||"Project"}" loading="eager" onload="this.classList.add('loaded');this.parentElement.classList.remove('project-detail__media-skeleton')" onerror="this.classList.add('error');this.parentElement.classList.add('project-detail__media-error')">\n        </div>\n        <div class="project-detail__content project-detail__content--hero">\n          <div class="project-detail__intro">\n            ${t.client?`<div class="project-detail__eyebrow">${t.client}</div>`:""}\n            <h1 class="project-detail__title">${t.title||""}</h1>\n            ${a.length?`<dl class="project-detail__meta">${r}</dl>`:""}\n          </div>\n        </div>\n      </section>\n      <section class="project-detail__body">\n        <div class="project-detail__content project-detail__content--body">\n          ${t.overview?`\n            <section class="project-detail__overview">\n              <h2>Overview</h2>\n              <p>${t.overview}</p>\n            </section>\n          `:""}\n          ${c}\n          ${l?`<section class="project-detail__stack">${l}</section>`:""}\n          <section class="project-detail__takeaways">\n            <h2>Personal takeaways</h2>\n            <ul>\n              ${h.map(t=>`<li>${t}</li>`).join("")}\n            </ul>\n          </section>\n          <div class="project-detail__close-footer">\n            <button class="project-detail__close-inline gate-back abs-icon-btn" type="button" aria-label="Close project detail" data-detail-close-inline>\n              <i class="ti ti-x" aria-hidden="true"></i>\n              <span>Close</span>\n            </button>\n          </div>\n        </div>\n      </section>\n    `,this.syncDetailVideos(),this.detailScroller&&(this.detailScroller.scrollTop=0)}getCssNumber(t,i){const s=getComputedStyle(document.documentElement).getPropertyValue(t).trim(),e=parseFloat(s);return Number.isFinite(e)?e:i}hasDetailTransition(){return!(!this.detailOverlay||this.prefersReducedMotion)&&(getComputedStyle(this.detailOverlay).transitionDuration||"").split(",").map(t=>parseFloat(t)).some(t=>Number.isFinite(t)&&t>0)}waitForDetailTransition(t){if(!this.detailOverlay)return this.isTransitioning=!1,void(this.detailOpen=!1);const i=this.detailOverlay,s=e=>{e.target===i&&"opacity"===e.propertyName&&(i.removeEventListener("transitionend",s),t?.())};i.addEventListener("transitionend",s)}openProjectDetail(t,i){if(this.detailOpen||this.isTransitioning||!i)return;const s=this.projects[t];if(!s)return;this.isTransitioning=!0,this.detailOpen=!0,this.activeSlide=i,this.lastFocusedElement=document.activeElement;const e=getComputedStyle(i).getPropertyValue("--slide-x").trim(),o=getComputedStyle(i).getPropertyValue("--slide-y").trim();i.dataset.frozenX=e,i.dataset.frozenY=o;const n=getComputedStyle(i).getPropertyValue("--slide-z").trim(),h=parseFloat(n.replace("vmin",""))||0,a=parseFloat(getComputedStyle(i).getPropertyValue("--slide-scale").trim())||1;if(i.classList.add("is-expanding"),requestAnimationFrame(()=>{i.style.setProperty("--slide-z",h+3+"vmin"),i.style.setProperty("--slide-scale",(1.015*a).toFixed(3))}),this.prefetchProjectAssets(s),this.renderDetailContent(s),this.detailOverlay){this.closeLetters=Array.from(this.detailOverlay.querySelectorAll(".close-letter"));const t=this.detailOverlay.querySelector(".close-icon");t&&(t.style.transform="",t.style.opacity="")}if(this.setupCloseButtonScrollAnimation(),!this.detailOverlay)return this.isTransitioning=!1,void(this.detailOpen=!1);this.detailOverlay.setAttribute("aria-hidden","false"),this.detailOverlay.classList.add("is-open"),document.body.classList.add("detail-open"),F();const r=()=>{this.detailOpen&&(this.isTransitioning=!1)};if(this.hasDetailTransition()?this.waitForDetailTransition(r):r(),this.detailClose&&this.detailClose.focus(),this.setupFocusTrap(),this.detailKeyHandler=t=>{this.detailOpen&&("ArrowLeft"===t.key?(t.preventDefault(),this.navigateToProject(-1)):"ArrowRight"===t.key&&(t.preventDefault(),this.navigateToProject(1)))},document.addEventListener("keydown",this.detailKeyHandler),this.progressBar=this.detailOverlay.querySelector(".project-detail__progress"),this.scrollProgressHandler=()=>{if(!this.detailScroller||!this.progressBar)return;const{scrollTop:t,scrollHeight:i,clientHeight:s}=this.detailScroller;this.progressBar.style.width=Math.min(100,Math.max(0,t/(i-s)*100))+"%"},this.detailScroller.addEventListener("scroll",this.scrollProgressHandler,{passive:!0}),this.setupSwipeGestures(),s.id){const i=s.id.toLowerCase().replace(/\s+/g,"-");history.replaceState({projectIndex:t},"","#project-"+i)}}setupFocusTrap(){this.detailOverlay&&(this.focusTrapHandler=t=>{if("Tab"!==t.key||!this.detailOpen)return;const i=Array.from(this.detailOverlay.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(t=>!t.hasAttribute("disabled")&&null!==t.offsetParent);if(0===i.length)return;const s=i[0],e=i[i.length-1];t.shiftKey&&document.activeElement===s?(t.preventDefault(),e.focus()):t.shiftKey||document.activeElement!==e||(t.preventDefault(),s.focus())},document.addEventListener("keydown",this.focusTrapHandler))}removeFocusTrap(){this.focusTrapHandler&&(document.removeEventListener("keydown",this.focusTrapHandler),this.focusTrapHandler=null)}setupSwipeGestures(){if(!this.detailScroller)return;let t=0,i=0,s=0,e=0,o=0;this.swipeTouchStart=n=>{if(!this.detailOpen)return;const h=n.touches[0];t=h.clientX,i=h.clientY,e=t,o=i,s=Date.now()},this.swipeTouchMove=t=>{if(!this.detailOpen)return;const i=t.touches[0];e=i.clientX,o=i.clientY},this.swipeTouchEnd=()=>{if(!this.detailOpen)return;const n=e-t,h=o-i;Date.now()-s>500||(h>100&&10>this.detailScroller.scrollTop&&50>Math.abs(n)?this.closeProjectDetail():Math.abs(n)>50&&.5*Math.abs(n)>Math.abs(h)&&this.navigateToProject(n>0?-1:1))},this.detailScroller.addEventListener("touchstart",this.swipeTouchStart,{passive:!0}),this.detailScroller.addEventListener("touchmove",this.swipeTouchMove,{passive:!0}),this.detailScroller.addEventListener("touchend",this.swipeTouchEnd,{passive:!0})}removeSwipeGestures(){this.detailScroller&&this.swipeTouchStart&&(this.detailScroller.removeEventListener("touchstart",this.swipeTouchStart),this.detailScroller.removeEventListener("touchmove",this.swipeTouchMove),this.detailScroller.removeEventListener("touchend",this.swipeTouchEnd),this.swipeTouchStart=null,this.swipeTouchMove=null,this.swipeTouchEnd=null)}checkUrlHash(){const t=location.hash;if(!t.startsWith("#project-"))return;const i=t.replace("#project-",""),s=this.projects.findIndex(t=>(t.id||"").toLowerCase().replace(/\s+/g,"-")===i);-1!==s&&requestAnimationFrame(()=>{this.currentRotation=s*this.angleStep,this.updateWheelPositions(0,!0),setTimeout(()=>{const t=this.slides[s];t&&this.openProjectDetail(s,t)},100)})}navigateToProject(t){if(!this.detailOpen||this.isTransitioning)return;const i=(this.activeIndex+t+this.projects.length)%this.projects.length,s=this.projects[i];if(!s)return;this.isTransitioning=!0;const e=this.detailOverlay.querySelector(".project-detail__inner");e&&(e.style.opacity="0",e.style.transform="scale(0.98)"),setTimeout(()=>{this.activeIndex=i,this.renderDetailContent(s);const t=document.createElement("div");t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.className="sr-only",t.textContent=`Project ${i+1} of ${this.projects.length}: ${s.title}`,this.detailOverlay.appendChild(t),setTimeout(()=>t.remove(),1e3),e&&(e.style.opacity="",e.style.transform=""),this.isTransitioning=!1},200)}closeProjectDetail(){if(!this.detailOpen||this.isTransitioning)return;location.hash.startsWith("#project-")&&history.replaceState(null,"",location.pathname+location.search),P(),this.removeFocusTrap(),this.detailKeyHandler&&(document.removeEventListener("keydown",this.detailKeyHandler),this.detailKeyHandler=null),this.scrollProgressHandler&&this.detailScroller&&(this.detailScroller.removeEventListener("scroll",this.scrollProgressHandler),this.scrollProgressHandler=null),this.removeSwipeGestures(),this.isTransitioning=!0,this.detailOpen=!1,this.activeSlide&&(this.activeSlide.classList.remove("is-expanding"),this.activeSlide.classList.add("is-collapsing"),setTimeout(()=>{this.activeSlide&&(this.activeSlide.classList.remove("is-collapsing"),delete this.activeSlide.dataset.frozenX,delete this.activeSlide.dataset.frozenY,this.updateWheelPositions(0,!0))},400)),this.closeButtonScrollCleanup&&(this.closeButtonScrollCleanup(),this.closeButtonScrollCleanup=null),this.stopDetailVideos();const t=()=>{document.body.classList.remove("detail-open"),this.detailOverlay.setAttribute("aria-hidden","true"),this.wheelVelocity=0,this.wheelRotation=this.getNearestSnapRotation(this.wheelRotation),this.updateWheelPositions(0,!0),this.lastFocusedElement&&this.lastFocusedElement.focus&&this.lastFocusedElement.focus(),this.isTransitioning=!1};document.body.classList.remove("detail-open");const i=this.hasDetailTransition();i&&this.waitForDetailTransition(t),this.detailOverlay.classList.remove("is-open"),i||t()}syncDetailVideos(){if(this.detailVideoObserver&&(this.detailVideoObserver.disconnect(),this.detailVideoObserver=null),!this.detailOverlay||!this.detailScroller)return;const t=Array.from(this.detailOverlay.querySelectorAll(".project-detail__video"));t.length&&(this.detailOverlay.querySelectorAll(".project-detail__video-toggle").forEach((i,s)=>{i.addEventListener("click",()=>{const e=t[s];e&&(e.paused?(e.play().catch(()=>{}),i.querySelector("i").className="ti ti-player-pause"):(e.pause(),i.querySelector("i").className="ti ti-player-play"))})}),"IntersectionObserver"in window?(this.detailVideoObserver=new IntersectionObserver(t=>{t.forEach(t=>{const i=t.target;if(t.isIntersecting){if("metadata"===i.preload&&(i.preload="auto"),!this.prefersReducedMotion){i.play().catch(()=>{});const t=i.closest(".project-detail__video-wrapper"),s=t?.querySelector(".project-detail__video-toggle i");s&&(s.className="ti ti-player-pause")}}else{i.pause();const t=i.closest(".project-detail__video-wrapper"),s=t?.querySelector(".project-detail__video-toggle i");s&&(s.className="ti ti-player-play")}})},{root:this.detailScroller,threshold:.3,rootMargin:"200px"}),t.forEach(t=>this.detailVideoObserver.observe(t))):this.prefersReducedMotion||t.forEach(t=>t.play().catch(()=>{})))}stopDetailVideos(){this.detailVideoObserver&&(this.detailVideoObserver.disconnect(),this.detailVideoObserver=null),this.detailOverlay&&this.detailOverlay.querySelectorAll(".project-detail__video").forEach(t=>{t.pause()})}collectProjectAssets(t){const i=[];return t.image&&i.push({type:"image",src:`${yt.assetBasePath}${t.image}`}),this.getContentBlocks(t).forEach(t=>{if("image"!==t.type&&"video"!==t.type)return;const s=this.resolveDetailAsset(t.src);s&&i.push({type:t.type,src:s})}),Array.isArray(t.gallery)&&t.gallery.forEach(t=>{const s=this.resolveDetailAsset(t);s&&i.push({type:"image",src:s})}),i}preloadImage(t){const i=new Image;i.decoding="async",i.src=t}preloadVideo(t){const i=document.createElement("video");i.preload="auto",i.muted=!0,i.src=t,i.load()}prefetchProjectAssets(t){if(!t||!t.id)return;if(this.preloadedProjects.has(t.id))return;const i=navigator.connection,s=i?.saveData,e=i?.effectiveType,o=!s&&"2g"!==e&&"slow-2g"!==e,n=this.collectProjectAssets(t);if(!n.length)return;this.preloadedProjects.add(t.id);const h=()=>{n.forEach(t=>{t.src&&!this.preloadedAssets.has(t.src)&&("video"!==t.type||o)&&(this.preloadedAssets.add(t.src),"image"===t.type&&this.preloadImage(t.src),"video"===t.type&&this.preloadVideo(t.src))})};"requestIdleCallback"in window?requestIdleCallback(h,{timeout:1200}):setTimeout(h,32)}}document.addEventListener("DOMContentLoaded",()=>{(async()=>{try{const t=document.querySelector(".wall-frame"),i=document.getElementById("brand-logo");t&&i&&i.parentElement!==t&&t.prepend(i)}catch(D){}try{await e(),o()}catch(D){}try{await n()}catch(D){}try{const t=h(),i=document.getElementById("app-frame"),s=!!window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches,e=()=>{try{const t=document.getElementById("fade-blocking");t&&t.remove()}catch(D){}},o=t=>{i&&(i.style.opacity="1",i.style.transform="translateZ(0)",e(),console.warn(`⚠️ Portfolio entrance fallback (${t})`))},{didViewTransitionRun:a}=await import("./shared.js").then(t=>t.aX);if(a()){i&&(i.style.opacity="1",i.style.visibility="visible",i.style.transform="translateZ(0)");const t=document.querySelector(".portfolio-meta"),s=document.querySelector(".portfolio-stage");t&&(t.style.opacity="1",t.style.visibility="visible"),s&&(s.style.opacity="1",s.style.visibility="visible"),e(),console.log("✓ Portfolio entrance skipped (View Transition handled it)")}else if(!t.entranceEnabled||s){i&&(i.style.opacity="1",i.style.transform="translateZ(0)");const t=document.querySelector(".portfolio-meta"),s=document.querySelector(".portfolio-stage");t&&(t.style.opacity="1",t.style.visibility="visible"),s&&(s.style.opacity="1",s.style.visibility="visible"),e(),console.log("✓ Entrance animation skipped (disabled or reduced motion)")}else{const{orchestrateEntrance:t}=await import("./shared.js").then(t=>t.aY);await t({async waitForFonts(){try{await n()}catch(D){}},skipWallAnimation:!0,centralContent:[".portfolio-stage",".portfolio-meta"]}),e(),console.log("✓ Dramatic entrance animation orchestrated (portfolio)")}window.setTimeout(()=>{i&&"0"===window.getComputedStyle(i).opacity&&o("watchdog")},2500)}catch(D){const t=document.getElementById("app-frame");t&&(t.style.opacity="1",t.style.transform="translateZ(0)"),console.warn("⚠️ Portfolio entrance animation failed, forcing content visible",D)}let t=null;try{t=await a(),r(t),requestAnimationFrame(()=>{l()});try{A()}catch(D){}c(),d(t);try{u(h())}catch(D){}window.addEventListener("resize",l),window.visualViewport&&window.visualViewport.addEventListener("resize",l,{passive:!0})}catch(D){try{u()}catch(z){}}p({contactModal:!0,cvModal:!0,portfolioModal:!1,cursorHiding:!0,modalOverlayConfig:t||{}}),f(),m();const s=h(),k=document.documentElement;if(t)w(t);else{const t=s?.frameColorLight||s?.frameColor,i=s?.frameColorDark||s?.frameColor;t&&k.style.setProperty("--frame-color-light",t),i&&k.style.setProperty("--frame-color-dark",i)}const $=s?.frameColorLight||s?.frameColor,C=s?.frameColorDark||s?.frameColor;$&&k.style.setProperty("--frame-color-light",$),C&&k.style.setProperty("--frame-color-dark",C);const x=s.isDarkMode?C:$;if(x){const t=document.querySelector('meta[name="theme-color"]');t&&(t.content=x),k.style.setProperty("--chrome-bg",x)}v?.("startup"),g(),b();let F=null;try{F=await(async()=>{try{try{if("undefined"!=typeof window&&window.__PORTFOLIO_CONFIG__&&"object"==typeof window.__PORTFOLIO_CONFIG__)return i(window.__PORTFOLIO_CONFIG__)}catch(D){}const t=["config/portfolio-config.json","js/portfolio-config.json","../dist/js/portfolio-config.json"];for(const s of t)try{const t=await fetch(s,{cache:"no-cache"});if(t.ok)return i(await t.json())}catch(D){}throw Error("No portfolio config found")}catch(D){return console.warn("Portfolio config load failed, using defaults"),i(null)}})()}catch(D){}const P=(t=>{const s=i(t),e=document.documentElement,o=s.cssVars||{};for(const[i,n]of Object.entries(o))!i||vt.has(i)||gt.has(i)||null!=n&&""!==n&&e.style.setProperty(i,n+"");return s})(F),S=new jt({runtimeConfig:P.runtime});await S.init(),document.querySelectorAll("[data-nav-transition]").forEach(t=>{t.addEventListener("click",i=>{i.preventDefault(),y(t.href,_.INTERNAL)})}),window.addEventListener("pageshow",t=>{if(t.persisted){j();const t=document.getElementById("app-frame");t&&(t.style.opacity="1")}});const N=document.querySelector('[data-nav-transition][href*="index"]');N&&M(N,"index.html")})()});