function n(n){try{localStorage.setItem(U.dockHidden,n+"")}catch(t){}}function t(t={}){if(!document.querySelector('link[href*="panel.css"]')){const n=document.createElement("link");n.rel="stylesheet",n.href="css/panel.css",document.head.appendChild(n)}const s=t.page||"home",i=t.pageLabel||("portfolio"===s?"Portfolio":"Home"),l=t.pageHTML||z,c=!!t.includePageSaveButton,d=t.pageSaveButtonId||"savePortfolioConfigBtn",u=t.footerHint||("portfolio"===s?"<kbd>/</kbd> panel":"<kbd>R</kbd> reset Â· <kbd>/</kbd> panel Â· <kbd>9</kbd> kalei Â· Critters have no key (yet)"),p=t.panelTitle||"Settings",f=t.modeLabel||(B()?"DEV MODE":"BUILD MODE"),v=!!t.bindShortcut,q="function"==typeof t.setupPageControls?t.setupPageControls:null;try{const n=document.getElementById("controlPanel");n&&n.remove();const t=document.getElementById("soundPanel");t&&t.remove()}catch(G){}A=document.createElement("div"),A.className="panel-dock",A.id="panelDock";let F=(({defaultHidden:n=!0}={})=>{try{const t=localStorage.getItem(U.dockHidden);return null===t?!!n:"true"===t}catch(G){return!!n}})({defaultHidden:!0});try{F=!0}catch(G){}return A.classList.toggle("hidden",!!F),n(!!F),J=(({page:n,panelTitle:t,pageLabel:e,pageHTML:o,includePageSaveButton:a,pageSaveButtonId:s,footerHint:i,setupPageControls:l}={})=>{const c=document.createElement("div");c.id="masterPanel",c.className=(()=>{try{const n=localStorage.getItem(U.panelCollapsed);return null===n||"true"===n}catch(G){return!0}})()?"panel collapsed":"panel",c.setAttribute("role","region"),c.setAttribute("aria-label","Settings");const r=document.createElement("div");r.className="panel-header",r.innerHTML=`\n    <div class="mac-titlebar">\n      <div class="mac-traffic" aria-hidden="true">\n        <span class="mac-dot mac-dot--red"></span>\n        <span class="mac-dot mac-dot--yellow"></span>\n        <span class="mac-dot mac-dot--green"></span>\n      </div>\n      <div class="panel-title mac-title">${t}</div>\n      <div class="mac-right">\n        ${B()?'<button id="saveConfigBtn" class="panel-save-btn" aria-label="Save config" title="Save config to file">Save</button>':""}\n        <button class="collapse-btn mac-collapse" aria-label="Collapse panel" title="Collapse">â–¾</button>\n      </div>\n    </div>\n  `;const d=document.createElement("div");d.className="panel-content",d.innerHTML=(({pageLabel:n="Home",pageHTML:t=z,includePageSaveButton:e=!1,pageSaveButtonId:o="savePortfolioConfigBtn",footerHint:a="<kbd>R</kbd> reset Â· <kbd>/</kbd> panel Â· <kbd>9</kbd> kalei Â· Critters have no key (yet)"}={})=>{const s=S(),i=O(),l=s.layoutViewportWidthPx>0?Math.round(s.layoutViewportWidthPx)+"px":`Auto (${Math.round(i)}px)`,c=Math.max(0,Math.round(s.wallInset??3)),r=`\n    <details class="panel-section-accordion" id="layoutSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">ğŸ“</span>\n        <span class="section-label">Layout</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Viewport Width</span>\n            <span class="control-value" id="viewportWidthValue">${l}</span>\n          </div>\n          <input type="range" id="layoutViewportWidth" min="0" max="2400" step="10" value="${Math.round(s.layoutViewportWidthPx||0)}" />\n          <div class="control-hint">0 = Auto (uses current window width)</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Wall Inset</span>\n            <span class="control-value" id="wallInsetValue">${c}px</span>\n          </div>\n          <input type="range" id="layoutWallInset" min="0" max="20" value="${c}" />\n        </label>\n      </div>\n    </details>\n  `,d=`\n    <details class="panel-section-accordion" id="soundSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">ğŸ”Š</span>\n        <span class="section-label">Sound</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="sound-enable-row">\n          <button id="soundEnableBtn" class="sound-enable-btn" aria-label="Enable sound" title="Enable sound">ğŸ”‡</button>\n        </div>\n        <div id="soundControlsWrapper" class="sound-controls" style="display: none;">\n          <div class="sound-perf" aria-label="Sound performance controls">\n            <button type="button" id="soundTapBtn" class="sound-perf__btn" aria-label="Play test hit">â–¶ï¸</button>\n            <button type="button" id="soundResetBtn" class="sound-perf__btn" aria-label="Reset to preset">â†º</button>\n            <button type="button" id="soundShuffleBtn" class="sound-perf__btn" aria-label="Shuffle (subtle) sound">ğŸ²</button>\n            <span class="sound-perf__hint">wheel adjusts Â· shift/alt = fine</span>\n          </div>\n          <label class="control-row">\n            <span class="control-label">Preset</span>\n            <select id="soundPresetSelect" class="control-select"></select>\n          </label>\n          <p id="presetDescription" class="control-hint"></p>\n          ${x()}\n        </div>\n      </div>\n    </details>\n  `,u=`\n    <details class="panel-section-accordion" id="pageSection" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">âš™ï¸</span>\n        <span class="section-label">${n}</span>\n      </summary>\n      <div class="panel-section-content">\n        ${t}\n      </div>\n    </details>\n  `,p=`\n    <div class="panel-section panel-section--action">\n      <button id="saveRuntimeConfigBtn" class="primary">ğŸ’¾ Save Config</button>\n      ${e?`<button id="${o}" class="primary">ğŸ’¾ Save ${n} Config</button>`:""}\n    </div>\n    <div class="panel-footer">${a}</div>\n  `;return`\n    ${g({open:!0})}\n    ${y()}\n    ${r}\n    ${d}\n    ${w({open:!1})}\n    ${u}\n    ${p}\n  `})({pageLabel:e,pageHTML:o,includePageSaveButton:a,pageSaveButtonId:s,footerHint:i}),c.appendChild(r),c.appendChild(d);const u=(()=>{try{const n=localStorage.getItem(U.panelSize);if(!n)return null;const t=JSON.parse(n);if(!t||"object"!=typeof t)return null;const e=+t.width,o=+t.height;return Number.isFinite(e)&&Number.isFinite(o)?{width:Math.round(e),height:Math.round(o)}:null}catch(G){return null}})();if(u){const n=.9*window.innerHeight;if(Math.abs(u.width-368)>5||Math.abs(u.height-n)>5){c.style.width=u.width+"px";const n=.9*window.innerHeight;c.style.height=Math.min(u.height,n)+"px",c.style.maxHeight="90vh"}}const p=r.querySelector("#saveConfigBtn");p&&B()&&p.addEventListener("click",async n=>{n.preventDefault(),n.stopPropagation(),await(async()=>{if(!B())return;const t=S(),e=document.getElementById("saveConfigBtn"),o=e?.textContent||"Save";e&&(e.textContent="Saving...",e.disabled=!0);try{const a={};try{const n=h();for(const e of n){if(!e||!e.stateKey)continue;const n=t[e.stateKey];void 0!==n&&(a[e.stateKey]=n)}}catch(n){console.warn("[save-config] Error collecting controls:",n)}a.chromeHarmonyMode=t.chromeHarmonyMode,a.autoDarkModeEnabled=t.autoDarkModeEnabled,a.autoDarkNightStartHour=t.autoDarkNightStartHour,a.autoDarkNightEndHour=t.autoDarkNightEndHour,a.ballMassKg=t.ballMassKg,a.REST=t.REST,a.FRICTION=t.FRICTION,a.physicsCollisionIterations=t.physicsCollisionIterations,a.physicsSkipSleepingCollisions=t.physicsSkipSleepingCollisions,a.physicsSpatialGridOptimization=t.physicsSpatialGridOptimization,a.physicsSleepThreshold=t.physicsSleepThreshold,a.physicsSleepTime=t.physicsSleepTime,a.physicsSkipSleepingSteps=t.physicsSkipSleepingSteps,a.sizeScale=t.sizeScale,a.responsiveScaleMobile=t.responsiveScaleMobile,a.mobileObjectReductionFactor=t.mobileObjectReductionFactor,a.liteModeEnabled=t.liteModeEnabled,a.liteModeObjectReductionFactor=t.liteModeObjectReductionFactor,a.ballSoftness=t.ballSoftness,a.ballSpacing=t.ballSpacing,a.sizeVariationGlobalMul=t.sizeVariationGlobalMul,a.sizeVariationCap=t.sizeVariationCap,a.cursorInfluenceRadiusVw=t.cursorInfluenceRadiusVw,a.cursorSize=t.cursorSize,a.mouseTrailEnabled=t.mouseTrailEnabled,a.mouseTrailLength=t.mouseTrailLength,a.mouseTrailSize=t.mouseTrailSize,a.mouseTrailFadeMs=t.mouseTrailFadeMs,a.mouseTrailOpacity=t.mouseTrailOpacity,a.contentPaddingRatio=t.contentPaddingRatio,a.contentPaddingHorizontalRatio=t.contentPaddingHorizontalRatio,void 0!==t.uiHitAreaMul&&(a.uiHitAreaMul=t.uiHitAreaMul),void 0!==t.uiIconCornerRadiusMul&&(a.uiIconCornerRadiusMul=t.uiIconCornerRadiusMul),t.uiIconFramePx&&(a.uiIconFramePx=t.uiIconFramePx),t.uiIconGlyphPx&&(a.uiIconGlyphPx=t.uiIconGlyphPx),void 0!==t.uiIconGroupMarginPx&&(a.uiIconGroupMarginPx=t.uiIconGroupMarginPx),a.linkTextPadding=t.linkTextPadding,a.linkIconPadding=t.linkIconPadding,void 0!==t.footerNavBarTopVh&&(a.footerNavBarTopVh=t.footerNavBarTopVh),void 0!==t.footerNavBarGapVw&&(a.footerNavBarGapVw=t.footerNavBarGapVw),void 0!==t.homeMainLinksBelowLogoPx&&(a.homeMainLinksBelowLogoPx=t.homeMainLinksBelowLogoPx),void 0!==t.edgeLabelInsetAdjustPx&&(a.edgeLabelInsetAdjustPx=t.edgeLabelInsetAdjustPx),a.linkColorInfluence=t.linkColorInfluence,a.linkImpactScale=t.linkImpactScale,a.linkImpactBlur=t.linkImpactBlur,a.linkImpactDuration=t.linkImpactDuration,a.hoverSnapEnabled=t.hoverSnapEnabled,a.hoverSnapDuration=t.hoverSnapDuration,a.hoverSnapOvershoot=t.hoverSnapOvershoot,a.hoverSnapUndershoot=t.hoverSnapUndershoot,a.sceneImpactEnabled=t.sceneImpactEnabled,a.sceneImpactMul=t.sceneImpactMul,a.sceneImpactLogoCompMul=t.sceneImpactLogoCompMul,a.sceneImpactMobileMulFactor=t.sceneImpactMobileMulFactor,a.sceneImpactPressMs=t.sceneImpactPressMs,a.sceneImpactReleaseMs=t.sceneImpactReleaseMs,a.sceneImpactAnticipation=t.sceneImpactAnticipation,a.sceneChangeSoundEnabled=t.sceneChangeSoundEnabled,a.sceneChangeSoundIntensity=t.sceneChangeSoundIntensity,a.sceneChangeSoundRadius=t.sceneChangeSoundRadius,a.gateOverlayEnabled=t.gateOverlayEnabled,a.gateOverlayOpacity=t.gateOverlayOpacity,a.gateOverlayTransitionMs=t.gateOverlayTransitionMs,a.gateOverlayTransitionOutMs=t.gateOverlayTransitionOutMs,a.gateOverlayContentDelayMs=t.gateOverlayContentDelayMs,a.gateDepthScale=t.gateDepthScale,a.gateDepthTranslateY=t.gateDepthTranslateY,a.bgLight=t.bgLight,a.bgDark=t.bgDark,a.textColorLight=t.textColorLight,a.textColorLightMuted=t.textColorLightMuted,a.textColorDark=t.textColorDark,a.textColorDarkMuted=t.textColorDarkMuted,a.linkHoverColor=t.linkHoverColor,a.topLogoWidthVw=t.topLogoWidthVw,a.colorDistribution=t.colorDistribution,a.frameColorLight=t.frameColorLight,a.frameColorDark=t.frameColorDark,a.wallPreset=t.wallPreset,a.wallThicknessVw=t.wallThicknessVw,a.wallThicknessAreaMultiplier=t.wallThicknessAreaMultiplier,a.wallRadiusVw=t.wallRadiusVw,a.wallInset=t.wallInset,a.mobileWallThicknessXFactor=t.mobileWallThicknessXFactor,a.mobileEdgeLabelsVisible=t.mobileEdgeLabelsVisible,a.wallWobbleMaxDeform=t.wallWobbleMaxDeform,a.wallWobbleStiffness=t.wallWobbleStiffness,a.wallWobbleDamping=t.wallWobbleDamping,a.wallWobbleSigma=t.wallWobbleSigma,a.wallWobbleSettlingSpeed=t.wallWobbleSettlingSpeed,a.wallWobbleCornerClamp=t.wallWobbleCornerClamp,a.wallWobbleImpactThreshold=t.wallWobbleImpactThreshold,a.wallWobbleMaxVel=t.wallWobbleMaxVel,a.wallWobbleMaxImpulse=t.wallWobbleMaxImpulse,a.wallWobbleMaxEnergyPerStep=t.wallWobbleMaxEnergyPerStep,a.wallPhysicsSamples=t.wallPhysicsSamples,a.wallPhysicsSkipInactive=t.wallPhysicsSkipInactive,a.wallRenderDecimation=t.wallRenderDecimation,a.noiseEnabled=t.noiseEnabled,a.noiseSeed=t.noiseSeed,a.noiseTextureSize=t.noiseTextureSize,a.noiseDistribution=t.noiseDistribution,a.noiseMonochrome=t.noiseMonochrome,a.noiseChroma=t.noiseChroma,a.noiseSize=t.noiseSize,a.noiseOpacity=t.noiseOpacity,a.noiseOpacityLight=t.noiseOpacityLight,a.noiseOpacityDark=t.noiseOpacityDark,a.noiseBlendMode=t.noiseBlendMode,a.noiseColorLight=t.noiseColorLight,a.noiseColorDark=t.noiseColorDark,a.noiseMotion=t.noiseMotion,a.noiseMotionAmount=t.noiseMotionAmount,a.noiseSpeedMs=t.noiseSpeedMs,a.noiseSpeedVariance=t.noiseSpeedVariance,a.noiseFlicker=t.noiseFlicker,a.noiseFlickerSpeedMs=t.noiseFlickerSpeedMs,a.noiseBlurPx=t.noiseBlurPx,a.noiseContrast=t.noiseContrast,a.noiseBrightness=t.noiseBrightness,a.noiseSaturation=t.noiseSaturation,a.noiseHue=t.noiseHue,void 0!==t.entranceEnabled&&(a.entranceEnabled=t.entranceEnabled),void 0!==t.entranceWallTransitionDelay&&(a.entranceWallTransitionDelay=t.entranceWallTransitionDelay),void 0!==t.entranceWallTransitionDuration&&(a.entranceWallTransitionDuration=t.entranceWallTransitionDuration),void 0!==t.entranceWallInitialScale&&(a.entranceWallInitialScale=t.entranceWallInitialScale),void 0!==t.entranceWallEasing&&(a.entranceWallEasing=t.entranceWallEasing),void 0!==t.entranceElementDuration&&(a.entranceElementDuration=t.entranceElementDuration),void 0!==t.entranceElementScaleStart&&(a.entranceElementScaleStart=t.entranceElementScaleStart),void 0!==t.entranceElementTranslateZStart&&(a.entranceElementTranslateZStart=t.entranceElementTranslateZStart),void 0!==t.entrancePerspectiveLandscape&&(a.entrancePerspectiveLandscape=t.entrancePerspectiveLandscape),void 0!==t.entrancePerspectiveSquare&&(a.entrancePerspectiveSquare=t.entrancePerspectiveSquare),void 0!==t.entrancePerspectivePortrait&&(a.entrancePerspectivePortrait=t.entrancePerspectivePortrait),a.gravityMultiplier=t.gravityMultiplierPit,a.restitution=t.REST,a.friction=t.FRICTION,a.ballMass=t.ballMassKg,a.ballScale=t.sizeScale,a.sizeVariation=t.sizeVariation,a.repelSoft=t.repelSoft,a.repelSoftness=t.repelSoft,a.layoutViewportWidthPx=t.layoutViewportWidthPx||0,a.containerBorderVw=t.containerBorderVw,a.simulationPaddingVw=t.simulationPaddingVw,a.layoutMinWallRadiusPx=Math.max(0,Math.round(t.layoutMinWallRadiusPx??0));try{a.soundPreset=M(),a.soundConfig=k()}catch(n){}a.enableLOD=!1;const s=await _("default",a);e&&(s?(e.textContent="Saved!",setTimeout(()=>{e.textContent=o,e.disabled=!1},1500)):(e.textContent="Error",setTimeout(()=>{e.textContent=o,e.disabled=!1},2e3),console.warn("[save-config] Failed to save config")))}catch(n){console.error("[save-config] Error saving config:",n),e&&(e.textContent="Error",setTimeout(()=>{e.textContent=o,e.disabled=!1},2e3))}})()});const f=r.querySelector(".collapse-btn");return f&&f.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),(t=>{t.classList.toggle("collapsed"),(t=>{try{localStorage.setItem(U.panelCollapsed,t+"")}catch(n){}})(t.classList.contains("collapsed"))})(c)}),setTimeout(()=>{"home"===n?b():m(),(()=>{const n=document.getElementById("saveRuntimeConfigBtn");n&&n.addEventListener("click",()=>{const n=S(),t={};try{const e=h();for(const o of e){if(!o||!o.stateKey)continue;const e=n[o.stateKey];void 0!==e&&(t[o.stateKey]=e)}}catch(G){}t.gravityMultiplier=n.gravityMultiplierPit,t.restitution=n.REST,t.friction=n.FRICTION,t.ballMass=n.ballMassKg,t.ballScale=n.sizeScale,t.sizeScale=n.sizeScale,t.sizeVariation=n.sizeVariation,t.repelSoft=n.repelSoft,t.repelSoftness=n.repelSoft,t.layoutViewportWidthPx=n.layoutViewportWidthPx||0,t.containerBorderVw=n.containerBorderVw,t.simulationPaddingVw=n.simulationPaddingVw,t.contentPaddingVw=n.contentPaddingVw,t.contentPaddingHorizontalRatio=n.contentPaddingHorizontalRatio,t.wallRadiusVw=n.wallRadiusVw,t.wallThicknessVw=n.wallThicknessVw,t.layoutMinContentPaddingPx=Math.max(0,Math.round(n.layoutMinContentPaddingPx??0)),t.layoutMinWallRadiusPx=Math.max(0,Math.round(n.layoutMinWallRadiusPx??0)),t.wallInset=n.wallInset;try{t.soundPreset=M(),t.soundConfig=k()}catch(G){}t.chromeHarmonyMode=n.chromeHarmonyMode,t.autoDarkModeEnabled=n.autoDarkModeEnabled,t.autoDarkNightStartHour=n.autoDarkNightStartHour,t.autoDarkNightEndHour=n.autoDarkNightEndHour,t.enableLOD=!1;const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(e),o.download="default-config.json",document.body.appendChild(o),o.click(),document.body.removeChild(o)})})(),(n=>{const t=n.querySelector("#soundEnableBtn"),e=n.querySelector("#soundControlsWrapper"),o=n.querySelector("#soundPresetSelect"),a=n.querySelector("#presetDescription"),s=n.querySelector("#soundSection"),i=n.querySelector("#soundTapBtn"),l=n.querySelector("#soundResetBtn"),c=n.querySelector("#soundShuffleBtn"),r=(n,t,e)=>t>n?t:n>e?e:n,d=(n,t)=>n+2*(Math.random()-.5)*t,u=(n,{openIfEnabled:o=!1}={})=>{if(!t)return;const a=n||I(),i=!(!a.isUnlocked||!a.isEnabled),l=!!a.isUnlocked;t.innerHTML=l&&i?'<i class="ti ti-volume-2" aria-hidden="true"></i>':'<i class="ti ti-volume-off" aria-hidden="true"></i>',t.setAttribute("aria-label",l?i?"Sound on":"Sound off":"Enable sound"),t.title=l?i?"Sound on":"Sound off":"Enable sound",t.classList.toggle("enabled",i),e&&(e.style.display=i?"":"none"),o&&i&&s&&!s.open&&(s.open=!0)};if(i&&i.addEventListener("click",()=>{$({intensity:.86,radius:18,xPosition:.72})}),l&&l.addEventListener("click",()=>{const t=M();C(t),a&&E[t]&&(a.textContent=E[t].description),P(n,k)}),c&&c.addEventListener("click",()=>{const t=k(),e={filterBaseFreq:r(d(t.filterBaseFreq,120),300,8e3),filterQ:r(d(t.filterQ,.04),.05,.9),pitchCurve:r(d(t.pitchCurve,.06),.6,1.8),sparkleGain:r(d(t.sparkleGain,.03),0,.35),sparkleDecayMul:r(d(t.sparkleDecayMul,.05),.25,.95),noiseTransientQ:r(d(t.noiseTransientQ,.25),.6,6),reverbWetMix:r(d(t.reverbWetMix,.02),0,.35),reverbDecay:r(d(t.reverbDecay,.03),.05,.4),collisionMinImpact:r(d(t.collisionMinImpact,.03),.45,.9),variancePitch:r(d(t.variancePitch,.01),0,.2),varianceGain:r(d(t.varianceGain,.02),0,.35)};T(e),P(n,k),$({intensity:.86,radius:18,xPosition:.72})}),t&&t.addEventListener("click",async()=>{const n=I();if(n.isUnlocked){const t=L();u({...n,isEnabled:t})}else await H()&&u(null,{openIfEnabled:!0})}),o){for(const[n,t]of Object.entries(E)){const e=document.createElement("option");e.value=n,e.textContent=t.label,o.appendChild(e)}o.value=M(),a&&E[M()]&&(a.textContent=E[M()].description),o.addEventListener("change",()=>{C(o.value),a&&E[o.value]&&(a.textContent=E[o.value].description),P(n,k)})}R(n,k,T),P(n,k),u(),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(W,n=>{u(n&&n.detail?n.detail:null)})})(c),(n=>{const t=n.querySelector("#layoutViewportWidth"),e=n.querySelector("#viewportWidthValue"),o=n.querySelector("#layoutWallInset"),a=n.querySelector("#wallInsetValue"),s=S();t&&e&&t.addEventListener("input",n=>{const t=parseInt(n.target.value,10);s.layoutViewportWidthPx=Number.isFinite(t)?Math.max(0,t):0,(({triggerResize:t=!1}={})=>{if(D(),N(),e){const n=O();e.textContent=s.layoutViewportWidthPx>0?Math.round(s.layoutViewportWidthPx)+"px":`Auto (${Math.round(n)}px)`}if(t)try{j()}catch(n){}document.dispatchEvent(new CustomEvent("layout-updated"))})({triggerResize:!0})}),o&&a&&o.addEventListener("input",n=>{const t=parseInt(n.target.value,10);a.textContent=t+"px",s.wallInset=t})})(c);try{l?.(c)}catch(G){}},0),c})({page:s,panelTitle:p,modeLabel:f,pageLabel:i,pageHTML:l,includePageSaveButton:c,pageSaveButtonId:d,footerHint:u,setupPageControls:q}),A.appendChild(J),document.body.insertBefore(A,document.body.firstChild),B()&&(()=>{if(document.querySelector(".panel-toggle-btn"))return;const n=document.createElement("button");n.className="panel-toggle-btn",n.setAttribute("aria-label","Toggle config panel"),n.innerHTML="âš™",n.style.display="flex",n.addEventListener("click",()=>{r()}),document.body.appendChild(n)})(),J&&(J.addEventListener("mousedown",n=>{const t=J.getBoundingClientRect();n.clientY-t.top>12||n.target.closest("button")||n.target.closest("input")||n.target.closest("select")||e(n)}),J.addEventListener("touchstart",n=>{const t=J.getBoundingClientRect();n.touches[0].clientY-t.top>12||n.target.closest("button")||n.target.closest("input")||n.target.closest("select")||e(n)},{passive:!1}),document.addEventListener("mousemove",o),document.addEventListener("mouseup",a),document.addEventListener("touchmove",o,{passive:!1}),document.addEventListener("touchend",a),(()=>{try{if(!A)return;const n=JSON.parse(localStorage.getItem(U.position)||"{}");n.custom&&(A.style.position="fixed",A.style.left=n.left,A.style.top=n.top,A.style.right="auto")}catch(G){}})()),(()=>{if(!J)return;if("undefined"==typeof ResizeObserver)return;let n=0;const t=new ResizeObserver(()=>{J&&(J.classList.contains("collapsed")||(window.clearTimeout(n),n=window.setTimeout(()=>{(n=>{try{if(!n)return;if(n.classList.contains("collapsed"))return;const t=n.getBoundingClientRect();localStorage.setItem(U.panelSize,JSON.stringify({width:Math.round(t.width),height:Math.round(t.height)}))}catch(G){}})(J)},150)))});try{t.observe(J)}catch(G){}})(),A&&A.addEventListener("pointerenter",n=>{const t=n.target;if(!t||!t.closest)return;const e=t.matches('button, [role="button"], .mode-btn, .mac-dot'),o=t.matches('input[type="range"]'),a=t.matches("select");(e||o||a)&&V()},!0),v&&(K||(K=!0,window.addEventListener("keydown",n=>{try{const t=n.target?.tagName,e=["INPUT","TEXTAREA","SELECT"].includes(t),o=!!n.target?.closest?.(".panel-dock");if(e&&!o)return}catch(G){}"/"!==(n.key?.toLowerCase?.()||"")&&"Slash"!==n.code||(n.preventDefault(),r())}))),A}function e(n){if(n.target.closest("button")||n.target.closest("input")||n.target.closest("select"))return;if(!A)return;const t=n.touches?n.touches[0].clientX:n.clientX,e=n.touches?n.touches[0].clientY:n.clientY,o=A.getBoundingClientRect();F=t,G=e,Q=o.left,X=o.top,q=!1}function o(n){if(0===F&&0===G)return;if(!A)return;const t=(n.touches?n.touches[0].clientX:n.clientX)-F,e=(n.touches?n.touches[0].clientY:n.clientY)-G;if(q||5>=Math.abs(t)&&5>=Math.abs(e)||(q=!0,A.classList.add("dragging"),A.style.position="fixed",A.style.top=X+"px",A.style.left=Q+"px",A.style.right="auto"),q){let o=Q+t,a=X+e;const s=A.getBoundingClientRect();o=Math.max(0,Math.min(window.innerWidth-s.width,o)),a=Math.max(0,Math.min(window.innerHeight-s.height,a)),A.style.left=o+"px",A.style.top=a+"px",n.preventDefault()}}function a(){q&&(q=!1,A&&A.classList.remove("dragging"),s()),F=0,G=0,setTimeout(()=>{},10)}function s(){try{if(!A)return;localStorage.setItem(U.position,JSON.stringify({left:A.style.left,top:A.style.top,custom:!0}))}catch(n){}}function i(){if(A){A.style.position="",A.style.left="",A.style.top="",A.style.right="";try{localStorage.removeItem(U.position)}catch(n){}}}function l(){J&&J.classList.remove("collapsed")}function c(){J&&J.classList.add("collapsed")}function r(){if(!A)try{t()}catch(o){return}const e=A.classList.toggle("hidden");if(n(e),!e)try{(()=>{if(!A)return;if(!A.style.left&&!A.style.top)return;const n=A.getBoundingClientRect(),t=window.innerWidth||0,e=window.innerHeight||0;if(!t||!e)return;const o=10;if(o>n.right||n.left>t-o||o>n.bottom||n.top>e-o)return void i();const a=(n,t,e)=>t>n?t:n>e?e:n,l=a(n.left,o,Math.max(o,t-n.width-o)),c=a(n.top,o,Math.max(o,e-n.height-o));A.style.position="fixed",A.style.left=Math.round(l)+"px",A.style.top=Math.round(c)+"px",A.style.right="auto",s()})()}catch(o){}}function d(){return A}function u(){return J}function p(){return J}import{g as f,a as v,b as h,s as b,c as m,d as g,e as y,f as w}from"./controls.js";import{g as S,af as M,ag as k,i as B,ah as x,ai as _,aj as $,ak as C,al as E,am as P,an as T,ao as I,ap as H,aq as L,ar as R,as as W,at as O,au as D,f as N,o as j,av as V}from"./shared.js";v();const z=f();let A=null,J=null;const U={position:"panel_dock_position_v2",dockHidden:"panel_dock_hidden",panelCollapsed:"master_panel_collapsed",panelSize:B()?"panel_dock_size_dev_v3":"panel_dock_size_prod_v3"};let q=!1,F=0,G=0,Q=0,X=0,K=!1;const Y=i;export{c as collapsePanel,t as createPanelDock,l as expandPanel,u as getControlPanel,d as getDock,p as getSoundPanel,Y as resetDockPosition,i as resetPanelPositions,r as toggleDock};