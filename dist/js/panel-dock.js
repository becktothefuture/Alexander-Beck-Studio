function t(t){try{localStorage.setItem(G.dockHidden,t+"")}catch(n){}}function n(n={}){if(!document.querySelector('link[href*="panel.css"]')){const t=document.createElement("link");t.rel="stylesheet",t.href="css/panel.css",document.head.appendChild(t)}const l=n.page||"home",i=n.pageLabel||("portfolio"===l?"Portfolio":"Home"),c=!1!==n.includePageSaveButton,r=n.pageSaveButtonId||"saveRuntimeConfigBtn",d=n.footerHint||("portfolio"===l?"<kbd>/</kbd> panel":"<kbd>R</kbd> reset Â· <kbd>/</kbd> panel Â· <kbd>9</kbd> kalei"),p=n.panelTitle||"Settings",h=n.modeLabel||(y()?"DEV MODE":"BUILD MODE"),U=!!n.bindShortcut,Q="function"==typeof n.setupPageControls?n.setupPageControls:null;try{const t=document.getElementById("controlPanel");t&&t.remove();const n=document.getElementById("soundPanel");n&&n.remove()}catch(X){}F=document.createElement("div"),F.className="panel-dock",F.id="panelDock";let K=(({defaultHidden:t=!0}={})=>{try{const n=localStorage.getItem(G.dockHidden);return null===n?!!t:"true"===n}catch(X){return!!t}})({defaultHidden:!y()});try{K=!0}catch(X){}return F.classList.toggle("hidden",!!K),t(!!K),q=(({page:t,panelTitle:n,pageLabel:a,includePageSaveButton:o,pageSaveButtonId:s,footerHint:l,setupPageControls:i}={})=>{const c=document.createElement("div");c.id="masterPanel",c.className=(()=>{try{const t=localStorage.getItem(G.panelCollapsed);return null===t?!y():"true"===t}catch(X){return!y()}})()?"panel collapsed":"panel",c.setAttribute("role","region"),c.setAttribute("aria-label","Settings");const r=document.createElement("div");r.className="panel-header",r.innerHTML=`\n    <span class="panel-title">${n}</span>\n    <button class="collapse-btn" aria-label="Collapse panel" title="Collapse">\n      <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor"><path d="M2 4l4 4 4-4"/></svg>\n    </button>\n  `;const u=document.createElement("div");u.className="panel-content",u.innerHTML=(({pageLabel:t="Home",includePageSaveButton:n=!0,pageSaveButtonId:e="saveRuntimeConfigBtn",footerHint:a="<kbd>R</kbd> reset Â· <kbd>/</kbd> panel Â· <kbd>â†</kbd><kbd>â†’</kbd> modes"}={})=>{const o=w(),s=j(),l=o.layoutViewportWidthPx>0?Math.round(o.layoutViewportWidthPx)+"px":`Auto (${Math.round(s)}px)`,i=Math.max(0,Math.round(o.wallInset??3)),c=`\n    <details class="panel-section-accordion" id="layoutSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">ğŸ“</span>\n        <span class="section-label">Layout</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Viewport Width</span>\n            <span class="control-value" id="viewportWidthValue">${l}</span>\n          </div>\n          <input type="range" id="layoutViewportWidth" min="0" max="2400" step="10" value="${Math.round(o.layoutViewportWidthPx||0)}" />\n          <div class="control-hint">0 = Auto (uses current window width)</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Wall Inset</span>\n            <span class="control-value" id="wallInsetValue">${i}px</span>\n          </div>\n          <input type="range" id="layoutWallInset" min="0" max="20" value="${i}" />\n        </label>\n      </div>\n    </details>\n  `,r=`\n    <details class="panel-section-accordion" id="soundSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">ğŸ”Š</span>\n        <span class="section-label">Sound</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="sound-enable-row">\n          <button id="soundEnableBtn" class="sound-enable-btn" aria-label="Enable sound">ğŸ”‡</button>\n        </div>\n        <div id="soundControlsWrapper" class="sound-controls" style="display: none;">\n          <div class="sound-perf" aria-label="Sound performance controls">\n            <button type="button" id="soundTapBtn" class="sound-perf__btn" aria-label="Play test hit">â–¶ï¸</button>\n            <button type="button" id="soundResetBtn" class="sound-perf__btn" aria-label="Reset to preset">â†º</button>\n            <button type="button" id="soundShuffleBtn" class="sound-perf__btn" aria-label="Shuffle (subtle) sound">ğŸ²</button>\n            <span class="sound-perf__hint">wheel adjusts Â· shift/alt = fine</span>\n          </div>\n          <label class="control-row">\n            <span class="control-label">Preset</span>\n            <select id="soundPresetSelect" class="control-select"></select>\n          </label>\n          <p id="presetDescription" class="control-hint"></p>\n          ${M()}\n        </div>\n      </div>\n    </details>\n  `,u=`\n    ${n?`<div class="panel-section panel-section--action"><button id="${e}" class="primary">ğŸ’¾ Save ${t} Config</button></div>`:""}\n    <div class="panel-footer">${a}</div>\n  `;return`\n    ${_({prepend:{appearance:J({open:!1}),simulation:x()+B(),effects:V()},append:{appearance:H({open:!1}),frame:c,interaction:r}})}\n    ${u}\n  `})({pageLabel:a,includePageSaveButton:o,pageSaveButtonId:s,footerHint:l}),c.appendChild(r),c.appendChild(u);const d=(()=>{try{const t=localStorage.getItem(G.panelSize);if(!t)return null;const n=JSON.parse(t);if(!n||"object"!=typeof n)return null;const e=+n.width,a=+n.height;return Number.isFinite(e)&&Number.isFinite(a)?{width:Math.round(e),height:Math.round(a)}:null}catch(X){return null}})();if(d){const t=.9*window.innerHeight;if(Math.abs(d.width-368)>5||Math.abs(d.height-t)>5){c.style.width=d.width+"px";const t=.9*window.innerHeight;c.style.height=Math.min(d.height,t)+"px",c.style.maxHeight="90vh"}}const p=r.querySelector(".collapse-btn");return p&&p.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),(n=>{n.classList.toggle("collapsed"),(n=>{try{localStorage.setItem(G.panelCollapsed,n+"")}catch(t){}})(n.classList.contains("collapsed"))})(c)}),setTimeout(()=>{"home"===t?f():b(),(()=>{const t=document.getElementById("saveRuntimeConfigBtn");t&&t.addEventListener("click",()=>{const t=w(),n={};try{const e=m();for(const a of e){if(!a||!a.stateKey)continue;const e=t[a.stateKey];void 0!==e&&(n[a.stateKey]=e)}}catch(X){}n.gravityMultiplier=t.gravityMultiplierPit,n.restitution=t.REST,n.friction=t.FRICTION,n.ballMass=t.ballMassKg,n.ballScale=t.sizeScale,n.sizeScale=t.sizeScale,n.sizeVariation=t.sizeVariation,n.repelSoft=t.repelSoft,n.repelSoftness=t.repelSoft,n.layoutViewportWidthPx=t.layoutViewportWidthPx||0,n.containerBorderVw=t.containerBorderVw,n.simulationPaddingVw=t.simulationPaddingVw,n.contentPaddingVw=t.contentPaddingVw,n.contentPaddingHorizontalRatio=t.contentPaddingHorizontalRatio,n.wallRadiusVw=t.wallRadiusVw,n.wallThicknessVw=t.wallThicknessVw,n.wallThicknessMinPx=t.wallThicknessMinPx,n.wallThicknessMaxPx=t.wallThicknessMaxPx,n.layoutMinContentPaddingPx=Math.max(0,Math.round(t.layoutMinContentPaddingPx??0)),n.layoutMinWallRadiusPx=Math.max(0,Math.round(t.layoutMinWallRadiusPx??0)),n.wallInset=t.wallInset;try{n.soundPreset=g(),n.soundConfig=v()}catch(X){}n.chromeHarmonyMode=t.chromeHarmonyMode,n.autoDarkModeEnabled=t.autoDarkModeEnabled,n.autoDarkNightStartHour=t.autoDarkNightStartHour,n.autoDarkNightEndHour=t.autoDarkNightEndHour,n.enableLOD=!1;const e=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(e),a.download="default-config.json",document.body.appendChild(a),a.click(),document.body.removeChild(a)})})(),(t=>{const n=t.querySelector("#soundEnableBtn"),e=t.querySelector("#soundControlsWrapper"),a=t.querySelector("#soundPresetSelect"),o=t.querySelector("#presetDescription"),s=t.querySelector("#soundSection"),l=t.querySelector("#soundTapBtn"),i=t.querySelector("#soundResetBtn"),c=t.querySelector("#soundShuffleBtn"),r=(t,n,e)=>n>t?n:t>e?e:t,u=(t,n)=>t+2*(Math.random()-.5)*n,d=(t,{openIfEnabled:a=!1}={})=>{if(!n)return;const o=t||R(),l=!(!o.isUnlocked||!o.isEnabled),i=!!o.isUnlocked;n.innerHTML=i&&l?'<i class="ti ti-volume-2" aria-hidden="true"></i>':'<i class="ti ti-volume-off" aria-hidden="true"></i>',n.setAttribute("aria-label",i?l?"Sound on":"Sound off":"Enable sound"),n.classList.toggle("enabled",l),e&&(e.style.display=l?"":"none"),a&&l&&s&&!s.open&&(s.open=!0)};if(l&&l.addEventListener("click",()=>{C({intensity:.86,radius:18,xPosition:.72})}),i&&i.addEventListener("click",()=>{const n=g();P(n),o&&I[n]&&(o.textContent=I[n].description),$(t,v)}),c&&c.addEventListener("click",()=>{const n=v(),e={filterBaseFreq:r(u(n.filterBaseFreq,120),300,8e3),filterQ:r(u(n.filterQ,.04),.05,.9),pitchCurve:r(u(n.pitchCurve,.06),.6,1.8),sparkleGain:r(u(n.sparkleGain,.03),0,.35),sparkleDecayMul:r(u(n.sparkleDecayMul,.05),.25,.95),noiseTransientQ:r(u(n.noiseTransientQ,.25),.6,6),reverbWetMix:r(u(n.reverbWetMix,.02),0,.35),reverbDecay:r(u(n.reverbDecay,.03),.05,.4),collisionMinImpact:r(u(n.collisionMinImpact,.03),.45,.9),variancePitch:r(u(n.variancePitch,.01),0,.2),varianceGain:r(u(n.varianceGain,.02),0,.35)};E(e),$(t,v),C({intensity:.86,radius:18,xPosition:.72})}),n&&n.addEventListener("click",async()=>{const t=R();if(t.isUnlocked){const n=T();d({...t,isEnabled:n})}else await N()&&d(null,{openIfEnabled:!0})}),a){for(const[t,n]of Object.entries(I)){const e=document.createElement("option");e.value=t,e.textContent=n.label,a.appendChild(e)}a.value=g(),o&&I[g()]&&(o.textContent=I[g()].description),a.addEventListener("change",()=>{P(a.value),o&&I[a.value]&&(o.textContent=I[a.value].description),$(t,v)})}W(t,v,E),$(t,v),d(),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(D,t=>{d(t&&t.detail?t.detail:null)})})(c),(t=>{const n=t.querySelector("#layoutViewportWidth"),e=t.querySelector("#viewportWidthValue"),a=t.querySelector("#layoutWallInset"),o=t.querySelector("#wallInsetValue"),s=w();n&&e&&n.addEventListener("input",t=>{const n=parseInt(t.target.value,10);s.layoutViewportWidthPx=Number.isFinite(n)?Math.max(0,n):0,(({triggerResize:n=!1}={})=>{if(L(),O(),e){const t=j();e.textContent=s.layoutViewportWidthPx>0?Math.round(s.layoutViewportWidthPx)+"px":`Auto (${Math.round(t)}px)`}if(n)try{z()}catch(t){}document.dispatchEvent(new CustomEvent("layout-updated"))})({triggerResize:!0})}),a&&o&&a.addEventListener("input",t=>{const n=parseInt(t.target.value,10);o.textContent=n+"px",s.wallInset=n})})(c),k(),(t=>{const n=t.querySelector(".wall-stack-iso");if(!n)return;let a=0;const o=()=>{a&&cancelAnimationFrame(a),a=requestAnimationFrame(()=>(t=>{const n=document.querySelector(".outer-wall"),a=document.querySelector(".inner-wall"),o=document.getElementById("bravia-balls");if(!n||!a)return;const s=getComputedStyle(n),l=getComputedStyle(a),i=e(s,"--outer-wall-border-bright-opacity",.5),c=Math.max(e(s,"--outer-wall-cast-shadow-opacity",.15),e(s,"--wall-ao-opacity",.15)),r=e(s,"--wall-specular-opacity",.4),u=e(l,"--inner-wall-inner-glow-opacity",.1),d=e(l,"--inner-wall-border-bright-opacity",.5),p=o?e(getComputedStyle(o),"--inner-wall-inner-shadow-opacity",.15):.15;t.style.setProperty("--iso-outer-shadow",c+""),t.style.setProperty("--iso-outer-shine",i+""),t.style.setProperty("--iso-outer-micro",r+""),t.style.setProperty("--iso-inner-glow",u+""),t.style.setProperty("--iso-inner-shine",d+""),t.style.setProperty("--iso-inner-shadow",p+"")})(n))};n.addEventListener("click",e=>{const a=e.target.closest(".wall-stack-iso__row, .wall-stack-iso__layer, .wall-stack-iso__label");a&&n.contains(a)&&(e=>{if(!e)return;const a=e.closest(".wall-stack-iso__row"),o=a||e,s=o.dataset.section,l=o.dataset.group;if(!s||!l)return;n.querySelectorAll(".wall-stack-iso__row.is-active, .wall-stack-iso__layer.is-active, .wall-stack-iso__label.is-active").forEach(t=>{t.classList.remove("is-active")}),t.querySelectorAll(".wall-chunk.is-highlighted").forEach(t=>t.classList.remove("is-highlighted")),a&&a.classList.add("is-active"),o.dataset.layer&&n.querySelectorAll(`[data-layer="${o.dataset.layer}"]`).forEach(t=>t.classList.add("is-active"));const i=t.querySelector('.panel-master-group[data-group-id="effects"]');i&&(i.open=!0);const c=t.querySelector(`.panel-section-accordion[data-section-key="${s}"]`);c&&(c.open=!0);const r=c?.querySelector(`.wall-chunk[data-wall-group="${l}"]`);r&&(r.classList.add("is-highlighted"),r.scrollIntoView({block:"nearest"}))})(a)}),t.addEventListener("input",o),t.addEventListener("change",o),o()})(c);try{const t=w();S(t)}catch(X){}try{i?.(c)}catch(X){}},0),c})({page:l,panelTitle:p,modeLabel:h,pageLabel:i,includePageSaveButton:c,pageSaveButtonId:r,footerHint:d,setupPageControls:Q}),F.appendChild(q),document.body.insertBefore(F,document.body.firstChild),y()&&(()=>{if(document.querySelector(".panel-toggle-btn"))return;const t=document.createElement("button");t.className="panel-toggle-btn",t.setAttribute("aria-label","Toggle config panel"),t.innerHTML="âš™",t.style.display="flex",t.addEventListener("click",()=>{u()}),document.body.appendChild(t)})(),q&&(q.addEventListener("mousedown",t=>{const n=q.getBoundingClientRect();t.clientY-n.top>12||t.target.closest("button")||t.target.closest("input")||t.target.closest("select")||a(t)}),q.addEventListener("touchstart",t=>{const n=q.getBoundingClientRect();t.touches[0].clientY-n.top>12||t.target.closest("button")||t.target.closest("input")||t.target.closest("select")||a(t)},{passive:!1}),document.addEventListener("mousemove",o),document.addEventListener("mouseup",s),document.addEventListener("touchmove",o,{passive:!1}),document.addEventListener("touchend",s),(()=>{try{if(!F)return;const t=JSON.parse(localStorage.getItem(G.position)||"{}");t.custom&&(F.style.position="fixed",F.style.left=t.left,F.style.top=t.top,F.style.right="auto")}catch(X){}})()),(()=>{if(!q)return;if("undefined"==typeof ResizeObserver)return;let t=0;const n=new ResizeObserver(()=>{q&&(q.classList.contains("collapsed")||(window.clearTimeout(t),t=window.setTimeout(()=>{(t=>{try{if(!t)return;if(t.classList.contains("collapsed"))return;const n=t.getBoundingClientRect();localStorage.setItem(G.panelSize,JSON.stringify({width:Math.round(n.width),height:Math.round(n.height)}))}catch(X){}})(q)},150)))});try{n.observe(q)}catch(X){}})(),F&&F.addEventListener("pointerenter",t=>{const n=t.target;if(!n||!n.closest)return;const e=n.matches('button, [role="button"], .mode-btn, .mac-dot'),a=n.matches('input[type="range"]'),o=n.matches("select");(e||a||o)&&A()},!0),U&&(Z||(Z=!0,window.addEventListener("keydown",t=>{try{const n=t.target?.tagName,e=["INPUT","TEXTAREA","SELECT"].includes(n),a=!!t.target?.closest?.(".panel-dock");if(e&&!a)return}catch(X){}"/"!==(t.key?.toLowerCase?.()||"")&&"Slash"!==t.code||(t.preventDefault(),u())}))),F}function e(t,n,e=0){const a=t.getPropertyValue(n).trim(),o=Number.parseFloat(a);return Number.isFinite(o)?o:e}function a(t){if(t.target.closest("button")||t.target.closest("input")||t.target.closest("select"))return;if(!F)return;const n=t.touches?t.touches[0].clientX:t.clientX,e=t.touches?t.touches[0].clientY:t.clientY,a=F.getBoundingClientRect();Q=n,K=e,X=a.left,Y=a.top,U=!1}function o(t){if(0===Q&&0===K)return;if(!F)return;const n=(t.touches?t.touches[0].clientX:t.clientX)-Q,e=(t.touches?t.touches[0].clientY:t.clientY)-K;if(U||5>=Math.abs(n)&&5>=Math.abs(e)||(U=!0,F.classList.add("dragging"),F.style.position="fixed",F.style.top=Y+"px",F.style.left=X+"px",F.style.right="auto"),U){let a=X+n,o=Y+e;const s=F.getBoundingClientRect();a=Math.max(0,Math.min(window.innerWidth-s.width,a)),o=Math.max(0,Math.min(window.innerHeight-s.height,o)),F.style.left=a+"px",F.style.top=o+"px",t.preventDefault()}}function s(){U&&(U=!1,F&&F.classList.remove("dragging"),l()),Q=0,K=0,setTimeout(()=>{},10)}function l(){try{if(!F)return;localStorage.setItem(G.position,JSON.stringify({left:F.style.left,top:F.style.top,custom:!0}))}catch(t){}}function i(){if(F){F.style.position="",F.style.left="",F.style.top="",F.style.right="";try{localStorage.removeItem(G.position)}catch(t){}}}function c(){q&&q.classList.remove("collapsed")}function r(){q&&q.classList.add("collapsed")}function u(){if(!F)try{n()}catch(a){return}const e=F.classList.toggle("hidden");if(t(e),!e)try{(()=>{if(!F)return;if(!F.style.left&&!F.style.top)return;const t=F.getBoundingClientRect(),n=window.innerWidth||0,e=window.innerHeight||0;if(!n||!e)return;const a=10;if(a>t.right||t.left>n-a||a>t.bottom||t.top>e-a)return void i();const o=(t,n,e)=>n>t?n:t>e?e:t,s=o(t.left,a,Math.max(a,n-t.width-a)),c=o(t.top,a,Math.max(a,e-t.height-a));F.style.position="fixed",F.style.left=Math.round(s)+"px",F.style.top=Math.round(c)+"px",F.style.right="auto",l()})()}catch(a){}}function d(){return F}function p(){return q}function h(){return q}import{s as f,a as b}from"./main.js";import{ap as m,g as w,aq as g,ar as v,i as y,as as k,at as S,au as M,av as _,aw as x,ax as B,ay as C,az as P,aA as I,aB as $,aC as E,aD as R,aE as N,aF as T,aG as W,aH as D,aI as H,aJ as L,o as O,aK as j,v as z,aL as A,aM as V,aN as J}from"./shared.js";import"./legend-colors.js";let F=null,q=null;const G={position:"panel_dock_position_v2",dockHidden:"panel_dock_hidden",panelCollapsed:"master_panel_collapsed",panelSize:y()?"panel_dock_size_dev_v3":"panel_dock_size_prod_v3"};let U=!1,Q=0,K=0,X=0,Y=0,Z=!1;const tt=i;export{r as collapsePanel,n as createPanelDock,c as expandPanel,p as getControlPanel,d as getDock,h as getSoundPanel,tt as resetDockPosition,i as resetPanelPositions,u as toggleDock};