function n(n){try{localStorage.setItem(q.dockHidden,n+"")}catch(t){}}function t(t={}){if(!document.querySelector('link[href*="panel.css"]')){const n=document.createElement("link");n.rel="stylesheet",n.href="css/panel.css",document.head.appendChild(n)}const s=t.page||"home",l=t.pageLabel||("portfolio"===s?"Portfolio":"Home"),c=t.pageHTML||G,i=!1!==t.includePageSaveButton,u=t.pageSaveButtonId||"saveRuntimeConfigBtn",d=t.footerHint||("portfolio"===s?"<kbd>/</kbd> panel":"<kbd>R</kbd> reset Â· <kbd>/</kbd> panel Â· <kbd>9</kbd> kalei"),p=t.panelTitle||"Settings",f=t.modeLabel||(y()?"DEV MODE":"BUILD MODE"),m=!!t.bindShortcut,F="function"==typeof t.setupPageControls?t.setupPageControls:null;try{const n=document.getElementById("controlPanel");n&&n.remove();const t=document.getElementById("soundPanel");t&&t.remove()}catch(X){}J=document.createElement("div"),J.className="panel-dock",J.id="panelDock";let Q=(({defaultHidden:n=!0}={})=>{try{const t=localStorage.getItem(q.dockHidden);return null===t?!!n:"true"===t}catch(X){return!!n}})({defaultHidden:!y()});try{Q=!0}catch(X){}return J.classList.toggle("hidden",!!Q),n(!!Q),U=(({page:n,panelTitle:t,pageLabel:e,pageHTML:a,includePageSaveButton:o,pageSaveButtonId:s,footerHint:l,setupPageControls:c}={})=>{const i=document.createElement("div");i.id="masterPanel",i.className=(()=>{try{const n=localStorage.getItem(q.panelCollapsed);return null===n?!y():"true"===n}catch(X){return!y()}})()?"panel collapsed":"panel",i.setAttribute("role","region"),i.setAttribute("aria-label","Settings");const r=document.createElement("div");r.className="panel-header",r.innerHTML=`\n    <span class="panel-title">${t}</span>\n    <button class="collapse-btn" aria-label="Collapse panel" title="Collapse">\n      <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor"><path d="M2 4l4 4 4-4"/></svg>\n    </button>\n  `;const u=document.createElement("div");u.className="panel-content",u.innerHTML=(({pageLabel:n="Home",pageHTML:t=G,includePageSaveButton:e=!0,pageSaveButtonId:a="saveRuntimeConfigBtn",footerHint:o="<kbd>R</kbd> reset Â· <kbd>/</kbd> panel Â· <kbd>â†</kbd><kbd>â†’</kbd> modes"}={})=>{const s=b(),l=W(),c=s.layoutViewportWidthPx>0?Math.round(s.layoutViewportWidthPx)+"px":`Auto (${Math.round(l)}px)`,i=Math.max(0,Math.round(s.wallInset??3)),r=`\n    <details class="panel-section-accordion" id="layoutSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">ğŸ“</span>\n        <span class="section-label">Layout</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Viewport Width</span>\n            <span class="control-value" id="viewportWidthValue">${c}</span>\n          </div>\n          <input type="range" id="layoutViewportWidth" min="0" max="2400" step="10" value="${Math.round(s.layoutViewportWidthPx||0)}" />\n          <div class="control-hint">0 = Auto (uses current window width)</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Wall Inset</span>\n            <span class="control-value" id="wallInsetValue">${i}px</span>\n          </div>\n          <input type="range" id="layoutWallInset" min="0" max="20" value="${i}" />\n        </label>\n      </div>\n    </details>\n  `,u=`\n    <details class="panel-section-accordion" id="soundSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">ğŸ”Š</span>\n        <span class="section-label">Sound</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="sound-enable-row">\n          <button id="soundEnableBtn" class="sound-enable-btn" aria-label="Enable sound">ğŸ”‡</button>\n        </div>\n        <div id="soundControlsWrapper" class="sound-controls" style="display: none;">\n          <div class="sound-perf" aria-label="Sound performance controls">\n            <button type="button" id="soundTapBtn" class="sound-perf__btn" aria-label="Play test hit">â–¶ï¸</button>\n            <button type="button" id="soundResetBtn" class="sound-perf__btn" aria-label="Reset to preset">â†º</button>\n            <button type="button" id="soundShuffleBtn" class="sound-perf__btn" aria-label="Shuffle (subtle) sound">ğŸ²</button>\n            <span class="sound-perf__hint">wheel adjusts Â· shift/alt = fine</span>\n          </div>\n          <label class="control-row">\n            <span class="control-label">Preset</span>\n            <select id="soundPresetSelect" class="control-select"></select>\n          </label>\n          <p id="presetDescription" class="control-hint"></p>\n          ${S()}\n        </div>\n      </div>\n    </details>\n  `,d=`\n    <details class="panel-section-accordion" id="pageSection" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">ğŸ›ï¸</span>\n        <span class="section-label">Mode</span>\n      </summary>\n      <div class="panel-section-content">\n        ${t}\n      </div>\n    </details>\n  `,p=`\n    ${e?`<div class="panel-section panel-section--action"><button id="${a}" class="primary">ğŸ’¾ Save ${n} Config</button></div>`:""}\n    <div class="panel-footer">${o}</div>\n  `;return`\n    \x3c!-- GLOBAL: Theme, Colors, Sound, Layout --\x3e\n    <details class="panel-master-group" open>\n      <summary class="panel-master-group-header">\n        <span class="panel-master-group-icon">ğŸŒ</span>\n        <span class="panel-master-group-title">Global</span>\n      </summary>\n      <div class="panel-master-group-content">\n        ${M({open:!1})}\n        ${k()}\n        ${r}\n        ${u}\n        ${x({open:!1})}\n      </div>\n    </details>\n\n    \x3c!-- SIMULATIONS: Mode, Physics, Balls, Wall, Mode-specific --\x3e\n    <details class="panel-master-group" open>\n      <summary class="panel-master-group-header">\n        <span class="panel-master-group-icon">ğŸ§ª</span>\n        <span class="panel-master-group-title">Simulations</span>\n      </summary>\n      <div class="panel-master-group-content">\n        ${d}\n        ${B()}\n      </div>\n    </details>\n\n    \x3c!-- BROWSER & TRANSITION: Environment, Entrance, Overlay --\x3e\n    <details class="panel-master-group" open>\n      <summary class="panel-master-group-header">\n        <span class="panel-master-group-icon">ğŸ§­</span>\n        <span class="panel-master-group-title">Browser & Transition</span>\n      </summary>\n      <div class="panel-master-group-content">\n        ${_()}\n      </div>\n    </details>\n\n    ${p}\n  `})({pageLabel:e,pageHTML:a,includePageSaveButton:o,pageSaveButtonId:s,footerHint:l}),i.appendChild(r),i.appendChild(u);const d=(()=>{try{const n=localStorage.getItem(q.panelSize);if(!n)return null;const t=JSON.parse(n);if(!t||"object"!=typeof t)return null;const e=+t.width,a=+t.height;return Number.isFinite(e)&&Number.isFinite(a)?{width:Math.round(e),height:Math.round(a)}:null}catch(X){return null}})();if(d){const n=.9*window.innerHeight;if(Math.abs(d.width-368)>5||Math.abs(d.height-n)>5){i.style.width=d.width+"px";const n=.9*window.innerHeight;i.style.height=Math.min(d.height,n)+"px",i.style.maxHeight="90vh"}}const p=r.querySelector(".collapse-btn");return p&&p.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),(t=>{t.classList.toggle("collapsed"),(t=>{try{localStorage.setItem(q.panelCollapsed,t+"")}catch(n){}})(t.classList.contains("collapsed"))})(i)}),setTimeout(()=>{"home"===n?z():V(),(()=>{const n=document.getElementById("saveRuntimeConfigBtn");n&&n.addEventListener("click",()=>{const n=b(),t={};try{const e=h();for(const a of e){if(!a||!a.stateKey)continue;const e=n[a.stateKey];void 0!==e&&(t[a.stateKey]=e)}}catch(X){}t.gravityMultiplier=n.gravityMultiplierPit,t.restitution=n.REST,t.friction=n.FRICTION,t.ballMass=n.ballMassKg,t.ballScale=n.sizeScale,t.sizeScale=n.sizeScale,t.sizeVariation=n.sizeVariation,t.repelSoft=n.repelSoft,t.repelSoftness=n.repelSoft,t.layoutViewportWidthPx=n.layoutViewportWidthPx||0,t.containerBorderVw=n.containerBorderVw,t.simulationPaddingVw=n.simulationPaddingVw,t.contentPaddingVw=n.contentPaddingVw,t.contentPaddingHorizontalRatio=n.contentPaddingHorizontalRatio,t.wallRadiusVw=n.wallRadiusVw,t.wallThicknessVw=n.wallThicknessVw,t.layoutMinContentPaddingPx=Math.max(0,Math.round(n.layoutMinContentPaddingPx??0)),t.layoutMinWallRadiusPx=Math.max(0,Math.round(n.layoutMinWallRadiusPx??0)),t.wallInset=n.wallInset;try{t.soundPreset=g(),t.soundConfig=v()}catch(X){}t.chromeHarmonyMode=n.chromeHarmonyMode,t.autoDarkModeEnabled=n.autoDarkModeEnabled,t.autoDarkNightStartHour=n.autoDarkNightStartHour,t.autoDarkNightEndHour=n.autoDarkNightEndHour,t.enableLOD=!1;const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(e),a.download="default-config.json",document.body.appendChild(a),a.click(),document.body.removeChild(a)})})(),(n=>{const t=n.querySelector("#soundEnableBtn"),e=n.querySelector("#soundControlsWrapper"),a=n.querySelector("#soundPresetSelect"),o=n.querySelector("#presetDescription"),s=n.querySelector("#soundSection"),l=n.querySelector("#soundTapBtn"),c=n.querySelector("#soundResetBtn"),i=n.querySelector("#soundShuffleBtn"),r=(n,t,e)=>t>n?t:n>e?e:n,u=(n,t)=>n+2*(Math.random()-.5)*t,d=(n,{openIfEnabled:a=!1}={})=>{if(!t)return;const o=n||C(),l=!(!o.isUnlocked||!o.isEnabled),c=!!o.isUnlocked;t.innerHTML=c&&l?'<i class="ti ti-volume-2" aria-hidden="true"></i>':'<i class="ti ti-volume-off" aria-hidden="true"></i>',t.setAttribute("aria-label",c?l?"Sound on":"Sound off":"Enable sound"),t.classList.toggle("enabled",l),e&&(e.style.display=l?"":"none"),a&&l&&s&&!s.open&&(s.open=!0)};if(l&&l.addEventListener("click",()=>{$({intensity:.86,radius:18,xPosition:.72})}),c&&c.addEventListener("click",()=>{const t=g();T(t),o&&I[t]&&(o.textContent=I[t].description),E(n,v)}),i&&i.addEventListener("click",()=>{const t=v(),e={filterBaseFreq:r(u(t.filterBaseFreq,120),300,8e3),filterQ:r(u(t.filterQ,.04),.05,.9),pitchCurve:r(u(t.pitchCurve,.06),.6,1.8),sparkleGain:r(u(t.sparkleGain,.03),0,.35),sparkleDecayMul:r(u(t.sparkleDecayMul,.05),.25,.95),noiseTransientQ:r(u(t.noiseTransientQ,.25),.6,6),reverbWetMix:r(u(t.reverbWetMix,.02),0,.35),reverbDecay:r(u(t.reverbDecay,.03),.05,.4),collisionMinImpact:r(u(t.collisionMinImpact,.03),.45,.9),variancePitch:r(u(t.variancePitch,.01),0,.2),varianceGain:r(u(t.varianceGain,.02),0,.35)};P(e),E(n,v),$({intensity:.86,radius:18,xPosition:.72})}),t&&t.addEventListener("click",async()=>{const n=C();if(n.isUnlocked){const t=R();d({...n,isEnabled:t})}else await L()&&d(null,{openIfEnabled:!0})}),a){for(const[n,t]of Object.entries(I)){const e=document.createElement("option");e.value=n,e.textContent=t.label,a.appendChild(e)}a.value=g(),o&&I[g()]&&(o.textContent=I[g()].description),a.addEventListener("change",()=>{T(a.value),o&&I[a.value]&&(o.textContent=I[a.value].description),E(n,v)})}O(n,v,P),E(n,v),d(),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(H,n=>{d(n&&n.detail?n.detail:null)})})(i),(n=>{const t=n.querySelector("#layoutViewportWidth"),e=n.querySelector("#viewportWidthValue"),a=n.querySelector("#layoutWallInset"),o=n.querySelector("#wallInsetValue"),s=b();t&&e&&t.addEventListener("input",n=>{const t=parseInt(n.target.value,10);s.layoutViewportWidthPx=Number.isFinite(t)?Math.max(0,t):0,(({triggerResize:t=!1}={})=>{if(N(),D(),e){const n=W();e.textContent=s.layoutViewportWidthPx>0?Math.round(s.layoutViewportWidthPx)+"px":`Auto (${Math.round(n)}px)`}if(t)try{j()}catch(n){}document.dispatchEvent(new CustomEvent("layout-updated"))})({triggerResize:!0})}),a&&o&&a.addEventListener("input",n=>{const t=parseInt(n.target.value,10);o.textContent=t+"px",s.wallInset=t})})(i);try{const n=b();w(n)}catch(X){}try{c?.(i)}catch(X){}},0),i})({page:s,panelTitle:p,modeLabel:f,pageLabel:l,pageHTML:c,includePageSaveButton:i,pageSaveButtonId:u,footerHint:d,setupPageControls:F}),J.appendChild(U),document.body.insertBefore(J,document.body.firstChild),y()&&(()=>{if(document.querySelector(".panel-toggle-btn"))return;const n=document.createElement("button");n.className="panel-toggle-btn",n.setAttribute("aria-label","Toggle config panel"),n.innerHTML="âš™",n.style.display="flex",n.addEventListener("click",()=>{r()}),document.body.appendChild(n)})(),U&&(U.addEventListener("mousedown",n=>{const t=U.getBoundingClientRect();n.clientY-t.top>12||n.target.closest("button")||n.target.closest("input")||n.target.closest("select")||e(n)}),U.addEventListener("touchstart",n=>{const t=U.getBoundingClientRect();n.touches[0].clientY-t.top>12||n.target.closest("button")||n.target.closest("input")||n.target.closest("select")||e(n)},{passive:!1}),document.addEventListener("mousemove",a),document.addEventListener("mouseup",o),document.addEventListener("touchmove",a,{passive:!1}),document.addEventListener("touchend",o),(()=>{try{if(!J)return;const n=JSON.parse(localStorage.getItem(q.position)||"{}");n.custom&&(J.style.position="fixed",J.style.left=n.left,J.style.top=n.top,J.style.right="auto")}catch(X){}})()),(()=>{if(!U)return;if("undefined"==typeof ResizeObserver)return;let n=0;const t=new ResizeObserver(()=>{U&&(U.classList.contains("collapsed")||(window.clearTimeout(n),n=window.setTimeout(()=>{(n=>{try{if(!n)return;if(n.classList.contains("collapsed"))return;const t=n.getBoundingClientRect();localStorage.setItem(q.panelSize,JSON.stringify({width:Math.round(t.width),height:Math.round(t.height)}))}catch(X){}})(U)},150)))});try{t.observe(U)}catch(X){}})(),J&&J.addEventListener("pointerenter",n=>{const t=n.target;if(!t||!t.closest)return;const e=t.matches('button, [role="button"], .mode-btn, .mac-dot'),a=t.matches('input[type="range"]'),o=t.matches("select");(e||a||o)&&A()},!0),m&&(Z||(Z=!0,window.addEventListener("keydown",n=>{try{const t=n.target?.tagName,e=["INPUT","TEXTAREA","SELECT"].includes(t),a=!!n.target?.closest?.(".panel-dock");if(e&&!a)return}catch(X){}"/"!==(n.key?.toLowerCase?.()||"")&&"Slash"!==n.code||(n.preventDefault(),r())}))),J}function e(n){if(n.target.closest("button")||n.target.closest("input")||n.target.closest("select"))return;if(!J)return;const t=n.touches?n.touches[0].clientX:n.clientX,e=n.touches?n.touches[0].clientY:n.clientY,a=J.getBoundingClientRect();Q=t,X=e,K=a.left,Y=a.top,F=!1}function a(n){if(0===Q&&0===X)return;if(!J)return;const t=(n.touches?n.touches[0].clientX:n.clientX)-Q,e=(n.touches?n.touches[0].clientY:n.clientY)-X;if(F||5>=Math.abs(t)&&5>=Math.abs(e)||(F=!0,J.classList.add("dragging"),J.style.position="fixed",J.style.top=Y+"px",J.style.left=K+"px",J.style.right="auto"),F){let a=K+t,o=Y+e;const s=J.getBoundingClientRect();a=Math.max(0,Math.min(window.innerWidth-s.width,a)),o=Math.max(0,Math.min(window.innerHeight-s.height,o)),J.style.left=a+"px",J.style.top=o+"px",n.preventDefault()}}function o(){F&&(F=!1,J&&J.classList.remove("dragging"),s()),Q=0,X=0,setTimeout(()=>{},10)}function s(){try{if(!J)return;localStorage.setItem(q.position,JSON.stringify({left:J.style.left,top:J.style.top,custom:!0}))}catch(n){}}function l(){if(J){J.style.position="",J.style.left="",J.style.top="",J.style.right="";try{localStorage.removeItem(q.position)}catch(n){}}}function c(){U&&U.classList.remove("collapsed")}function i(){U&&U.classList.add("collapsed")}function r(){if(!J)try{t()}catch(a){return}const e=J.classList.toggle("hidden");if(n(e),!e)try{(()=>{if(!J)return;if(!J.style.left&&!J.style.top)return;const n=J.getBoundingClientRect(),t=window.innerWidth||0,e=window.innerHeight||0;if(!t||!e)return;const a=10;if(a>n.right||n.left>t-a||a>n.bottom||n.top>e-a)return void l();const o=(n,t,e)=>t>n?t:n>e?e:n,c=o(n.left,a,Math.max(a,t-n.width-a)),i=o(n.top,a,Math.max(a,e-n.height-a));J.style.position="fixed",J.style.left=Math.round(c)+"px",J.style.top=Math.round(i)+"px",J.style.right="auto",s()})()}catch(a){}}function u(){return J}function d(){return U}function p(){return U}import{ai as f,aj as m,ak as h,g as b,al as g,am as v,i as y,an as w,ao as S,ap as M,aq as k,ar as x,as as B,at as _,au as $,av as T,aw as I,ax as E,ay as P,az as C,aA as L,aB as R,aC as O,aD as H,aE as W,aF as N,j as D,t as j,aG as A}from"./shared.js";import{setupIndexControls as z,setupMasterControls as V}from"./controls.js";m();const G=f();let J=null,U=null;const q={position:"panel_dock_position_v2",dockHidden:"panel_dock_hidden",panelCollapsed:"master_panel_collapsed",panelSize:y()?"panel_dock_size_dev_v3":"panel_dock_size_prod_v3"};let F=!1,Q=0,X=0,K=0,Y=0,Z=!1;const nn=l;export{i as collapsePanel,t as createPanelDock,c as expandPanel,d as getControlPanel,u as getDock,p as getSoundPanel,nn as resetDockPosition,l as resetPanelPositions,r as toggleDock};