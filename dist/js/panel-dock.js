function n(n){try{localStorage.setItem(J.dockHidden,n+"")}catch(t){}}function t(t={}){if(!document.querySelector('link[href*="panel.css"]')){const n=document.createElement("link");n.rel="stylesheet",n.href="css/panel.css",document.head.appendChild(n)}const s=t.page||"home",i=t.pageLabel||("portfolio"===s?"Portfolio":"Home"),l=t.pageHTML||V,c=!!t.includePageSaveButton,d=t.pageSaveButtonId||"savePortfolioConfigBtn",u=t.footerHint||("portfolio"===s?"<kbd>/</kbd> panel":"<kbd>R</kbd> reset Â· <kbd>/</kbd> panel Â· <kbd>9</kbd> kalei Â· Critters have no key (yet)"),p=t.panelTitle||"Settings",f=t.modeLabel||(B()?"DEV MODE":"BUILD MODE"),v=!!t.bindShortcut,U="function"==typeof t.setupPageControls?t.setupPageControls:null;try{const n=document.getElementById("controlPanel");n&&n.remove();const t=document.getElementById("soundPanel");t&&t.remove()}catch(F){}j=document.createElement("div"),j.className="panel-dock",j.id="panelDock";let q=(({defaultHidden:n=!0}={})=>{try{const t=localStorage.getItem(J.dockHidden);return null===t?!!n:"true"===t}catch(F){return!!n}})({defaultHidden:!0});try{q=!0}catch(F){}return j.classList.toggle("hidden",!!q),n(!!q),A=(({page:n,panelTitle:t,pageLabel:e,pageHTML:a,includePageSaveButton:o,pageSaveButtonId:s,footerHint:i,setupPageControls:l}={})=>{const c=document.createElement("div");c.id="masterPanel",c.className=(()=>{try{const n=localStorage.getItem(J.panelCollapsed);return null===n||"true"===n}catch(F){return!0}})()?"panel collapsed":"panel",c.setAttribute("role","region"),c.setAttribute("aria-label","Settings");const r=document.createElement("div");r.className="panel-header",r.innerHTML=`\n    <div class="mac-titlebar">\n      <div class="mac-traffic" aria-hidden="true">\n        <span class="mac-dot mac-dot--red"></span>\n        <span class="mac-dot mac-dot--yellow"></span>\n        <span class="mac-dot mac-dot--green"></span>\n      </div>\n      <div class="panel-title mac-title">${t}</div>\n      <div class="mac-right">\n        ${B()?'<button id="saveConfigBtn" class="panel-save-btn" aria-label="Save config" title="Save config to file">Save</button>':""}\n        <button class="collapse-btn mac-collapse" aria-label="Collapse panel" title="Collapse">â–¾</button>\n      </div>\n    </div>\n  `;const d=document.createElement("div");d.className="panel-content",d.innerHTML=(({pageLabel:n="Home",pageHTML:t=V,includePageSaveButton:e=!1,pageSaveButtonId:a="savePortfolioConfigBtn",footerHint:o="<kbd>R</kbd> reset Â· <kbd>/</kbd> panel Â· <kbd>9</kbd> kalei Â· Critters have no key (yet)"}={})=>{const s=S(),i=O(),l=s.layoutViewportWidthPx>0?Math.round(s.layoutViewportWidthPx)+"px":`Auto (${Math.round(i)}px)`,c=Math.max(0,Math.round(s.wallInset??3)),r=`\n    <details class="panel-section-accordion" id="layoutSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">ğŸ“</span>\n        <span class="section-label">Layout</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Viewport Width</span>\n            <span class="control-value" id="viewportWidthValue">${l}</span>\n          </div>\n          <input type="range" id="layoutViewportWidth" min="0" max="2400" step="10" value="${Math.round(s.layoutViewportWidthPx||0)}" />\n          <div class="control-hint">0 = Auto (uses current window width)</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Wall Inset</span>\n            <span class="control-value" id="wallInsetValue">${c}px</span>\n          </div>\n          <input type="range" id="layoutWallInset" min="0" max="20" value="${c}" />\n        </label>\n      </div>\n    </details>\n  `,d=`\n    <details class="panel-section-accordion" id="soundSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">ğŸ”Š</span>\n        <span class="section-label">Sound</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="sound-enable-row">\n          <button id="soundEnableBtn" class="sound-enable-btn" aria-label="Enable sound" title="Enable sound">ğŸ”‡</button>\n        </div>\n        <div id="soundControlsWrapper" class="sound-controls" style="display: none;">\n          <div class="sound-perf" aria-label="Sound performance controls">\n            <button type="button" id="soundTapBtn" class="sound-perf__btn" aria-label="Play test hit">â–¶ï¸</button>\n            <button type="button" id="soundResetBtn" class="sound-perf__btn" aria-label="Reset to preset">â†º</button>\n            <button type="button" id="soundShuffleBtn" class="sound-perf__btn" aria-label="Shuffle (subtle) sound">ğŸ²</button>\n            <span class="sound-perf__hint">wheel adjusts Â· shift/alt = fine</span>\n          </div>\n          <label class="control-row">\n            <span class="control-label">Preset</span>\n            <select id="soundPresetSelect" class="control-select"></select>\n          </label>\n          <p id="presetDescription" class="control-hint"></p>\n          ${x()}\n        </div>\n      </div>\n    </details>\n  `,u=`\n    <details class="panel-section-accordion" id="pageSection" open>\n      <summary class="panel-section-header">\n        <span class="section-icon">âš™ï¸</span>\n        <span class="section-label">${n}</span>\n      </summary>\n      <div class="panel-section-content">\n        ${t}\n      </div>\n    </details>\n  `,p=`\n    <div class="panel-section panel-section--action">\n      <button id="saveRuntimeConfigBtn" class="primary">ğŸ’¾ Save Config</button>\n      ${e?`<button id="${a}" class="primary">ğŸ’¾ Save ${n} Config</button>`:""}\n    </div>\n    <div class="panel-footer">${o}</div>\n  `;return`\n    ${g({open:!0})}\n    ${y()}\n    ${r}\n    ${d}\n    ${w({open:!1})}\n    ${u}\n    ${p}\n  `})({pageLabel:e,pageHTML:a,includePageSaveButton:o,pageSaveButtonId:s,footerHint:i}),c.appendChild(r),c.appendChild(d);const u=(()=>{try{const n=localStorage.getItem(J.panelSize);if(!n)return null;const t=JSON.parse(n);if(!t||"object"!=typeof t)return null;const e=+t.width,a=+t.height;return Number.isFinite(e)&&Number.isFinite(a)?{width:Math.round(e),height:Math.round(a)}:null}catch(F){return null}})();if(u){const n=.9*window.innerHeight;if(Math.abs(u.width-368)>5||Math.abs(u.height-n)>5){c.style.width=u.width+"px";const n=.9*window.innerHeight;c.style.height=Math.min(u.height,n)+"px",c.style.maxHeight="90vh"}}const p=r.querySelector("#saveConfigBtn");p&&B()&&p.addEventListener("click",async n=>{n.preventDefault(),n.stopPropagation(),await(async()=>{if(!B())return;const t=S(),e=document.getElementById("saveConfigBtn"),a=e?.textContent||"Save";e&&(e.textContent="Saving...",e.disabled=!0);try{const o={};try{const n=h();for(const e of n){if(!e||!e.stateKey)continue;const n=t[e.stateKey];void 0!==n&&(o[e.stateKey]=n)}}catch(n){console.warn("[save-config] Error collecting controls:",n)}o.chromeHarmonyMode=t.chromeHarmonyMode,o.autoDarkModeEnabled=t.autoDarkModeEnabled,o.autoDarkNightStartHour=t.autoDarkNightStartHour,o.autoDarkNightEndHour=t.autoDarkNightEndHour,o.ballMassKg=t.ballMassKg,o.REST=t.REST,o.FRICTION=t.FRICTION,o.physicsCollisionIterations=t.physicsCollisionIterations,o.physicsSkipSleepingCollisions=t.physicsSkipSleepingCollisions,o.physicsSpatialGridOptimization=t.physicsSpatialGridOptimization,o.physicsSleepThreshold=t.physicsSleepThreshold,o.physicsSleepTime=t.physicsSleepTime,o.physicsSkipSleepingSteps=t.physicsSkipSleepingSteps,o.sizeScale=t.sizeScale,o.responsiveScaleMobile=t.responsiveScaleMobile,o.mobileObjectReductionFactor=t.mobileObjectReductionFactor,o.liteModeEnabled=t.liteModeEnabled,o.liteModeObjectReductionFactor=t.liteModeObjectReductionFactor,o.ballSoftness=t.ballSoftness,o.ballSpacing=t.ballSpacing,o.sizeVariationGlobalMul=t.sizeVariationGlobalMul,o.sizeVariationCap=t.sizeVariationCap,o.cursorInfluenceRadiusVw=t.cursorInfluenceRadiusVw,o.cursorSize=t.cursorSize,o.mouseTrailEnabled=t.mouseTrailEnabled,o.mouseTrailLength=t.mouseTrailLength,o.mouseTrailSize=t.mouseTrailSize,o.mouseTrailFadeMs=t.mouseTrailFadeMs,o.mouseTrailOpacity=t.mouseTrailOpacity,o.contentPaddingRatio=t.contentPaddingRatio,o.contentPaddingHorizontalRatio=t.contentPaddingHorizontalRatio,void 0!==t.uiHitAreaMul&&(o.uiHitAreaMul=t.uiHitAreaMul),void 0!==t.uiIconCornerRadiusMul&&(o.uiIconCornerRadiusMul=t.uiIconCornerRadiusMul),t.uiIconFramePx&&(o.uiIconFramePx=t.uiIconFramePx),t.uiIconGlyphPx&&(o.uiIconGlyphPx=t.uiIconGlyphPx),void 0!==t.uiIconGroupMarginPx&&(o.uiIconGroupMarginPx=t.uiIconGroupMarginPx),o.linkTextPadding=t.linkTextPadding,o.linkIconPadding=t.linkIconPadding,void 0!==t.footerNavBarTopVh&&(o.footerNavBarTopVh=t.footerNavBarTopVh),void 0!==t.footerNavBarGapVw&&(o.footerNavBarGapVw=t.footerNavBarGapVw),void 0!==t.homeMainLinksBelowLogoPx&&(o.homeMainLinksBelowLogoPx=t.homeMainLinksBelowLogoPx),void 0!==t.edgeLabelInsetAdjustPx&&(o.edgeLabelInsetAdjustPx=t.edgeLabelInsetAdjustPx),o.linkColorInfluence=t.linkColorInfluence,o.linkImpactScale=t.linkImpactScale,o.linkImpactBlur=t.linkImpactBlur,o.linkImpactDuration=t.linkImpactDuration,o.hoverSnapEnabled=t.hoverSnapEnabled,o.hoverSnapDuration=t.hoverSnapDuration,o.hoverSnapOvershoot=t.hoverSnapOvershoot,o.hoverSnapUndershoot=t.hoverSnapUndershoot,o.sceneImpactEnabled=t.sceneImpactEnabled,o.sceneImpactMul=t.sceneImpactMul,o.sceneImpactLogoCompMul=t.sceneImpactLogoCompMul,o.sceneImpactMobileMulFactor=t.sceneImpactMobileMulFactor,o.sceneImpactPressMs=t.sceneImpactPressMs,o.sceneImpactReleaseMs=t.sceneImpactReleaseMs,o.sceneImpactAnticipation=t.sceneImpactAnticipation,o.sceneChangeSoundEnabled=t.sceneChangeSoundEnabled,o.sceneChangeSoundIntensity=t.sceneChangeSoundIntensity,o.sceneChangeSoundRadius=t.sceneChangeSoundRadius,o.gateOverlayEnabled=t.gateOverlayEnabled,o.gateOverlayOpacity=t.gateOverlayOpacity,o.gateOverlayTransitionMs=t.gateOverlayTransitionMs,o.gateOverlayTransitionOutMs=t.gateOverlayTransitionOutMs,o.gateOverlayContentDelayMs=t.gateOverlayContentDelayMs,o.gateDepthScale=t.gateDepthScale,o.gateDepthTranslateY=t.gateDepthTranslateY,o.bgLight=t.bgLight,o.bgDark=t.bgDark,o.textColorLight=t.textColorLight,o.textColorLightMuted=t.textColorLightMuted,o.textColorDark=t.textColorDark,o.textColorDarkMuted=t.textColorDarkMuted,o.linkHoverColor=t.linkHoverColor,o.topLogoWidthVw=t.topLogoWidthVw,o.colorDistribution=t.colorDistribution,o.frameColorLight=t.frameColorLight,o.frameColorDark=t.frameColorDark,o.wallPreset=t.wallPreset,o.wallThicknessVw=t.wallThicknessVw,o.wallThicknessAreaMultiplier=t.wallThicknessAreaMultiplier,o.wallRadiusVw=t.wallRadiusVw,o.wallInset=t.wallInset,o.mobileWallThicknessXFactor=t.mobileWallThicknessXFactor,o.mobileEdgeLabelsVisible=t.mobileEdgeLabelsVisible,o.wallWobbleMaxDeform=t.wallWobbleMaxDeform,o.wallWobbleStiffness=t.wallWobbleStiffness,o.wallWobbleDamping=t.wallWobbleDamping,o.wallWobbleSigma=t.wallWobbleSigma,o.wallWobbleSettlingSpeed=t.wallWobbleSettlingSpeed,o.wallWobbleCornerClamp=t.wallWobbleCornerClamp,o.wallWobbleImpactThreshold=t.wallWobbleImpactThreshold,o.wallWobbleMaxVel=t.wallWobbleMaxVel,o.wallWobbleMaxImpulse=t.wallWobbleMaxImpulse,o.wallWobbleMaxEnergyPerStep=t.wallWobbleMaxEnergyPerStep,o.wallPhysicsSamples=t.wallPhysicsSamples,o.wallPhysicsSkipInactive=t.wallPhysicsSkipInactive,o.wallRenderDecimation=t.wallRenderDecimation,o.noiseEnabled=t.noiseEnabled,o.noiseSeed=t.noiseSeed,o.noiseTextureSize=t.noiseTextureSize,o.noiseDistribution=t.noiseDistribution,o.noiseMonochrome=t.noiseMonochrome,o.noiseChroma=t.noiseChroma,o.noiseSize=t.noiseSize,o.noiseOpacity=t.noiseOpacity,o.noiseOpacityLight=t.noiseOpacityLight,o.noiseOpacityDark=t.noiseOpacityDark,o.noiseBlendMode=t.noiseBlendMode,o.noiseColorLight=t.noiseColorLight,o.noiseColorDark=t.noiseColorDark,o.noiseMotion=t.noiseMotion,o.noiseMotionAmount=t.noiseMotionAmount,o.noiseSpeedMs=t.noiseSpeedMs,o.noiseSpeedVariance=t.noiseSpeedVariance,o.noiseFlicker=t.noiseFlicker,o.noiseFlickerSpeedMs=t.noiseFlickerSpeedMs,o.noiseBlurPx=t.noiseBlurPx,o.noiseContrast=t.noiseContrast,o.noiseBrightness=t.noiseBrightness,o.noiseSaturation=t.noiseSaturation,o.noiseHue=t.noiseHue,void 0!==t.entranceEnabled&&(o.entranceEnabled=t.entranceEnabled),void 0!==t.entranceWallTransitionDelay&&(o.entranceWallTransitionDelay=t.entranceWallTransitionDelay),void 0!==t.entranceWallTransitionDuration&&(o.entranceWallTransitionDuration=t.entranceWallTransitionDuration),void 0!==t.entranceWallInitialScale&&(o.entranceWallInitialScale=t.entranceWallInitialScale),void 0!==t.entranceWallEasing&&(o.entranceWallEasing=t.entranceWallEasing),void 0!==t.entranceElementDuration&&(o.entranceElementDuration=t.entranceElementDuration),void 0!==t.entranceElementScaleStart&&(o.entranceElementScaleStart=t.entranceElementScaleStart),void 0!==t.entranceElementTranslateZStart&&(o.entranceElementTranslateZStart=t.entranceElementTranslateZStart),void 0!==t.entrancePerspectiveLandscape&&(o.entrancePerspectiveLandscape=t.entrancePerspectiveLandscape),void 0!==t.entrancePerspectiveSquare&&(o.entrancePerspectiveSquare=t.entrancePerspectiveSquare),void 0!==t.entrancePerspectivePortrait&&(o.entrancePerspectivePortrait=t.entrancePerspectivePortrait),o.gravityMultiplier=t.gravityMultiplierPit,o.restitution=t.REST,o.friction=t.FRICTION,o.ballMass=t.ballMassKg,o.ballScale=t.sizeScale,o.sizeVariation=t.sizeVariation,o.repelSoft=t.repelSoft,o.repelSoftness=t.repelSoft,o.layoutViewportWidthPx=t.layoutViewportWidthPx||0,o.containerBorderVw=t.containerBorderVw,o.simulationPaddingVw=t.simulationPaddingVw,o.layoutMinWallRadiusPx=Math.max(0,Math.round(t.layoutMinWallRadiusPx??0));try{o.soundPreset=M(),o.soundConfig=k()}catch(n){}o.enableLOD=!1;const s=await _("default",o);e&&(s?(e.textContent="Saved!",setTimeout(()=>{e.textContent=a,e.disabled=!1},1500)):(e.textContent="Error",setTimeout(()=>{e.textContent=a,e.disabled=!1},2e3),console.warn("[save-config] Failed to save config")))}catch(n){console.error("[save-config] Error saving config:",n),e&&(e.textContent="Error",setTimeout(()=>{e.textContent=a,e.disabled=!1},2e3))}})()});const f=r.querySelector(".collapse-btn");return f&&f.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),(t=>{t.classList.toggle("collapsed"),(t=>{try{localStorage.setItem(J.panelCollapsed,t+"")}catch(n){}})(t.classList.contains("collapsed"))})(c)}),setTimeout(()=>{"home"===n?b():m(),(()=>{const n=document.getElementById("saveRuntimeConfigBtn");n&&n.addEventListener("click",()=>{const n=S(),t={};try{const e=h();for(const a of e){if(!a||!a.stateKey)continue;const e=n[a.stateKey];void 0!==e&&(t[a.stateKey]=e)}}catch(F){}t.gravityMultiplier=n.gravityMultiplierPit,t.restitution=n.REST,t.friction=n.FRICTION,t.ballMass=n.ballMassKg,t.ballScale=n.sizeScale,t.sizeScale=n.sizeScale,t.sizeVariation=n.sizeVariation,t.repelSoft=n.repelSoft,t.repelSoftness=n.repelSoft,t.layoutViewportWidthPx=n.layoutViewportWidthPx||0,t.containerBorderVw=n.containerBorderVw,t.simulationPaddingVw=n.simulationPaddingVw,t.contentPaddingVw=n.contentPaddingVw,t.contentPaddingHorizontalRatio=n.contentPaddingHorizontalRatio,t.wallRadiusVw=n.wallRadiusVw,t.wallThicknessVw=n.wallThicknessVw,t.layoutMinContentPaddingPx=Math.max(0,Math.round(n.layoutMinContentPaddingPx??0)),t.layoutMinWallRadiusPx=Math.max(0,Math.round(n.layoutMinWallRadiusPx??0)),t.wallInset=n.wallInset;try{t.soundPreset=M(),t.soundConfig=k()}catch(F){}t.chromeHarmonyMode=n.chromeHarmonyMode,t.autoDarkModeEnabled=n.autoDarkModeEnabled,t.autoDarkNightStartHour=n.autoDarkNightStartHour,t.autoDarkNightEndHour=n.autoDarkNightEndHour,t.enableLOD=!1;const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(e),a.download="default-config.json",document.body.appendChild(a),a.click(),document.body.removeChild(a)})})(),(n=>{const t=n.querySelector("#soundEnableBtn"),e=n.querySelector("#soundControlsWrapper"),a=n.querySelector("#soundPresetSelect"),o=n.querySelector("#presetDescription"),s=n.querySelector("#soundSection"),i=n.querySelector("#soundTapBtn"),l=n.querySelector("#soundResetBtn"),c=n.querySelector("#soundShuffleBtn"),r=(n,t,e)=>t>n?t:n>e?e:n,d=(n,t)=>n+2*(Math.random()-.5)*t,u=(n,{openIfEnabled:a=!1}={})=>{if(!t)return;const o=n||I(),i=!(!o.isUnlocked||!o.isEnabled),l=!!o.isUnlocked;t.innerHTML=l&&i?'<i class="ti ti-volume-2" aria-hidden="true"></i>':'<i class="ti ti-volume-off" aria-hidden="true"></i>',t.setAttribute("aria-label",l?i?"Sound on":"Sound off":"Enable sound"),t.title=l?i?"Sound on":"Sound off":"Enable sound",t.classList.toggle("enabled",i),e&&(e.style.display=i?"":"none"),a&&i&&s&&!s.open&&(s.open=!0)};if(i&&i.addEventListener("click",()=>{$({intensity:.86,radius:18,xPosition:.72})}),l&&l.addEventListener("click",()=>{const t=M();C(t),o&&E[t]&&(o.textContent=E[t].description),P(n,k)}),c&&c.addEventListener("click",()=>{const t=k(),e={filterBaseFreq:r(d(t.filterBaseFreq,120),300,8e3),filterQ:r(d(t.filterQ,.04),.05,.9),pitchCurve:r(d(t.pitchCurve,.06),.6,1.8),sparkleGain:r(d(t.sparkleGain,.03),0,.35),sparkleDecayMul:r(d(t.sparkleDecayMul,.05),.25,.95),noiseTransientQ:r(d(t.noiseTransientQ,.25),.6,6),reverbWetMix:r(d(t.reverbWetMix,.02),0,.35),reverbDecay:r(d(t.reverbDecay,.03),.05,.4),collisionMinImpact:r(d(t.collisionMinImpact,.03),.45,.9),variancePitch:r(d(t.variancePitch,.01),0,.2),varianceGain:r(d(t.varianceGain,.02),0,.35)};T(e),P(n,k),$({intensity:.86,radius:18,xPosition:.72})}),t&&t.addEventListener("click",async()=>{const n=I();if(n.isUnlocked){const t=L();u({...n,isEnabled:t})}else await H()&&u(null,{openIfEnabled:!0})}),a){for(const[n,t]of Object.entries(E)){const e=document.createElement("option");e.value=n,e.textContent=t.label,a.appendChild(e)}a.value=M(),o&&E[M()]&&(o.textContent=E[M()].description),a.addEventListener("change",()=>{C(a.value),o&&E[a.value]&&(o.textContent=E[a.value].description),P(n,k)})}R(n,k,T),P(n,k),u(),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(W,n=>{u(n&&n.detail?n.detail:null)})})(c),(n=>{const t=n.querySelector("#layoutViewportWidth"),e=n.querySelector("#viewportWidthValue"),a=n.querySelector("#layoutWallInset"),o=n.querySelector("#wallInsetValue"),s=S();t&&e&&t.addEventListener("input",n=>{const t=parseInt(n.target.value,10);s.layoutViewportWidthPx=Number.isFinite(t)?Math.max(0,t):0,(({triggerResize:t=!1}={})=>{if(D(),N(),e){const n=O();e.textContent=s.layoutViewportWidthPx>0?Math.round(s.layoutViewportWidthPx)+"px":`Auto (${Math.round(n)}px)`}if(t)try{z()}catch(n){}document.dispatchEvent(new CustomEvent("layout-updated"))})({triggerResize:!0})}),a&&o&&a.addEventListener("input",n=>{const t=parseInt(n.target.value,10);o.textContent=t+"px",s.wallInset=t})})(c);try{l?.(c)}catch(F){}},0),c})({page:s,panelTitle:p,modeLabel:f,pageLabel:i,pageHTML:l,includePageSaveButton:c,pageSaveButtonId:d,footerHint:u,setupPageControls:U}),j.appendChild(A),document.body.insertBefore(j,document.body.firstChild),B()&&(()=>{if(document.querySelector(".panel-toggle-btn"))return;const n=document.createElement("button");n.className="panel-toggle-btn",n.setAttribute("aria-label","Toggle config panel"),n.innerHTML="âš™",n.style.display="flex",n.addEventListener("click",()=>{r()}),document.body.appendChild(n)})(),A&&(A.addEventListener("mousedown",n=>{const t=A.getBoundingClientRect();n.clientY-t.top>12||n.target.closest("button")||n.target.closest("input")||n.target.closest("select")||e(n)}),A.addEventListener("touchstart",n=>{const t=A.getBoundingClientRect();n.touches[0].clientY-t.top>12||n.target.closest("button")||n.target.closest("input")||n.target.closest("select")||e(n)},{passive:!1}),document.addEventListener("mousemove",a),document.addEventListener("mouseup",o),document.addEventListener("touchmove",a,{passive:!1}),document.addEventListener("touchend",o),(()=>{try{if(!j)return;const n=JSON.parse(localStorage.getItem(J.position)||"{}");n.custom&&(j.style.position="fixed",j.style.left=n.left,j.style.top=n.top,j.style.right="auto")}catch(F){}})()),(()=>{if(!A)return;if("undefined"==typeof ResizeObserver)return;let n=0;const t=new ResizeObserver(()=>{A&&(A.classList.contains("collapsed")||(window.clearTimeout(n),n=window.setTimeout(()=>{(n=>{try{if(!n)return;if(n.classList.contains("collapsed"))return;const t=n.getBoundingClientRect();localStorage.setItem(J.panelSize,JSON.stringify({width:Math.round(t.width),height:Math.round(t.height)}))}catch(F){}})(A)},150)))});try{t.observe(A)}catch(F){}})(),v&&(X||(X=!0,window.addEventListener("keydown",n=>{try{const t=n.target?.tagName,e=["INPUT","TEXTAREA","SELECT"].includes(t),a=!!n.target?.closest?.(".panel-dock");if(e&&!a)return}catch(F){}"/"!==(n.key?.toLowerCase?.()||"")&&"Slash"!==n.code||(n.preventDefault(),r())}))),j}function e(n){if(n.target.closest("button")||n.target.closest("input")||n.target.closest("select"))return;if(!j)return;const t=n.touches?n.touches[0].clientX:n.clientX,e=n.touches?n.touches[0].clientY:n.clientY,a=j.getBoundingClientRect();q=t,F=e,G=a.left,Q=a.top,U=!1}function a(n){if(0===q&&0===F)return;if(!j)return;const t=(n.touches?n.touches[0].clientX:n.clientX)-q,e=(n.touches?n.touches[0].clientY:n.clientY)-F;if(U||5>=Math.abs(t)&&5>=Math.abs(e)||(U=!0,j.classList.add("dragging"),j.style.position="fixed",j.style.top=Q+"px",j.style.left=G+"px",j.style.right="auto"),U){let a=G+t,o=Q+e;const s=j.getBoundingClientRect();a=Math.max(0,Math.min(window.innerWidth-s.width,a)),o=Math.max(0,Math.min(window.innerHeight-s.height,o)),j.style.left=a+"px",j.style.top=o+"px",n.preventDefault()}}function o(){U&&(U=!1,j&&j.classList.remove("dragging"),s()),q=0,F=0,setTimeout(()=>{},10)}function s(){try{if(!j)return;localStorage.setItem(J.position,JSON.stringify({left:j.style.left,top:j.style.top,custom:!0}))}catch(n){}}function i(){if(j){j.style.position="",j.style.left="",j.style.top="",j.style.right="";try{localStorage.removeItem(J.position)}catch(n){}}}function l(){A&&A.classList.remove("collapsed")}function c(){A&&A.classList.add("collapsed")}function r(){if(!j)try{t()}catch(a){return}const e=j.classList.toggle("hidden");if(n(e),!e)try{(()=>{if(!j)return;if(!j.style.left&&!j.style.top)return;const n=j.getBoundingClientRect(),t=window.innerWidth||0,e=window.innerHeight||0;if(!t||!e)return;const a=10;if(a>n.right||n.left>t-a||a>n.bottom||n.top>e-a)return void i();const o=(n,t,e)=>t>n?t:n>e?e:n,l=o(n.left,a,Math.max(a,t-n.width-a)),c=o(n.top,a,Math.max(a,e-n.height-a));j.style.position="fixed",j.style.left=Math.round(l)+"px",j.style.top=Math.round(c)+"px",j.style.right="auto",s()})()}catch(a){}}function d(){return j}function u(){return A}function p(){return A}import{g as f,a as v,b as h,s as b,c as m,d as g,e as y,f as w}from"./controls.js";import{g as S,ak as M,al as k,i as B,am as x,an as _,ao as $,ap as C,aq as E,ar as P,as as T,at as I,au as H,av as L,aw as R,ax as W,ay as O,az as D,f as N,o as z}from"./shared.js";v();const V=f();let j=null,A=null;const J={position:"panel_dock_position_v2",dockHidden:"panel_dock_hidden",panelCollapsed:"master_panel_collapsed",panelSize:B()?"panel_dock_size_dev_v3":"panel_dock_size_prod_v3"};let U=!1,q=0,F=0,G=0,Q=0,X=!1;const K=i;export{c as collapsePanel,t as createPanelDock,l as expandPanel,u as getControlPanel,d as getDock,p as getSoundPanel,K as resetDockPosition,i as resetPanelPositions,r as toggleDock};