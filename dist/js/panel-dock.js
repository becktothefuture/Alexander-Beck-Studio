function n(n){try{localStorage.setItem(G.dockHidden,n+"")}catch(t){}}function t(t={}){if(!document.querySelector('link[href*="panel.css"]')){const n=document.createElement("link");n.rel="stylesheet",n.href="css/panel.css",document.head.appendChild(n)}const s=t.page||"home",l=t.pageLabel||("portfolio"===s?"Portfolio":"Home"),c=!1!==t.includePageSaveButton,i=t.pageSaveButtonId||"saveRuntimeConfigBtn",u=t.footerHint||("portfolio"===s?"<kbd>/</kbd> panel":"<kbd>R</kbd> reset Â· <kbd>/</kbd> panel Â· <kbd>9</kbd> kalei"),d=t.panelTitle||"Settings",p=t.modeLabel||(y()?"DEV MODE":"BUILD MODE"),U=!!t.bindShortcut,q="function"==typeof t.setupPageControls?t.setupPageControls:null;try{const n=document.getElementById("controlPanel");n&&n.remove();const t=document.getElementById("soundPanel");t&&t.remove()}catch(Q){}A=document.createElement("div"),A.className="panel-dock",A.id="panelDock";let F=(({defaultHidden:n=!0}={})=>{try{const t=localStorage.getItem(G.dockHidden);return null===t?!!n:"true"===t}catch(Q){return!!n}})({defaultHidden:!y()});try{F=!0}catch(Q){}return A.classList.toggle("hidden",!!F),n(!!F),J=(({page:n,panelTitle:t,pageLabel:e,includePageSaveButton:a,pageSaveButtonId:o,footerHint:s,setupPageControls:l}={})=>{const c=document.createElement("div");c.id="masterPanel",c.className=(()=>{try{const n=localStorage.getItem(G.panelCollapsed);return null===n?!y():"true"===n}catch(Q){return!y()}})()?"panel collapsed":"panel",c.setAttribute("role","region"),c.setAttribute("aria-label","Settings");const i=document.createElement("div");i.className="panel-header",i.innerHTML=`\n    <span class="panel-title">${t}</span>\n    <button class="collapse-btn" aria-label="Collapse panel" title="Collapse">\n      <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor"><path d="M2 4l4 4 4-4"/></svg>\n    </button>\n  `;const r=document.createElement("div");r.className="panel-content",r.innerHTML=(({pageLabel:n="Home",includePageSaveButton:t=!0,pageSaveButtonId:e="saveRuntimeConfigBtn",footerHint:a="<kbd>R</kbd> reset Â· <kbd>/</kbd> panel Â· <kbd>â†</kbd><kbd>â†’</kbd> modes"}={})=>{const o=m(),s=N(),l=o.layoutViewportWidthPx>0?Math.round(o.layoutViewportWidthPx)+"px":`Auto (${Math.round(s)}px)`,c=Math.max(0,Math.round(o.wallInset??3)),i=`\n    <details class="panel-section-accordion" id="layoutSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">ğŸ“</span>\n        <span class="section-label">Layout</span>\n      </summary>\n      <div class="panel-section-content">\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Viewport Width</span>\n            <span class="control-value" id="viewportWidthValue">${l}</span>\n          </div>\n          <input type="range" id="layoutViewportWidth" min="0" max="2400" step="10" value="${Math.round(o.layoutViewportWidthPx||0)}" />\n          <div class="control-hint">0 = Auto (uses current window width)</div>\n        </label>\n        <label class="control-row">\n          <div class="control-row-header">\n            <span class="control-label">Wall Inset</span>\n            <span class="control-value" id="wallInsetValue">${c}px</span>\n          </div>\n          <input type="range" id="layoutWallInset" min="0" max="20" value="${c}" />\n        </label>\n      </div>\n    </details>\n  `,r=`\n    <details class="panel-section-accordion" id="soundSection">\n      <summary class="panel-section-header">\n        <span class="section-icon">ğŸ”Š</span>\n        <span class="section-label">Sound</span>\n      </summary>\n      <div class="panel-section-content">\n        <div class="sound-enable-row">\n          <button id="soundEnableBtn" class="sound-enable-btn" aria-label="Enable sound">ğŸ”‡</button>\n        </div>\n        <div id="soundControlsWrapper" class="sound-controls" style="display: none;">\n          <div class="sound-perf" aria-label="Sound performance controls">\n            <button type="button" id="soundTapBtn" class="sound-perf__btn" aria-label="Play test hit">â–¶ï¸</button>\n            <button type="button" id="soundResetBtn" class="sound-perf__btn" aria-label="Reset to preset">â†º</button>\n            <button type="button" id="soundShuffleBtn" class="sound-perf__btn" aria-label="Shuffle (subtle) sound">ğŸ²</button>\n            <span class="sound-perf__hint">wheel adjusts Â· shift/alt = fine</span>\n          </div>\n          <label class="control-row">\n            <span class="control-label">Preset</span>\n            <select id="soundPresetSelect" class="control-select"></select>\n          </label>\n          <p id="presetDescription" class="control-hint"></p>\n          ${k()}\n        </div>\n      </div>\n    </details>\n  `,u=`\n    ${t?`<div class="panel-section panel-section--action"><button id="${e}" class="primary">ğŸ’¾ Save ${n} Config</button></div>`:""}\n    <div class="panel-footer">${a}</div>\n  `;return`\n    ${M({prepend:{appearance:V({open:!1}),simulation:x()+B()},append:{appearance:H({open:!1}),frame:i,interaction:r}})}\n    ${u}\n  `})({pageLabel:e,includePageSaveButton:a,pageSaveButtonId:o,footerHint:s}),c.appendChild(i),c.appendChild(r);const u=(()=>{try{const n=localStorage.getItem(G.panelSize);if(!n)return null;const t=JSON.parse(n);if(!t||"object"!=typeof t)return null;const e=+t.width,a=+t.height;return Number.isFinite(e)&&Number.isFinite(a)?{width:Math.round(e),height:Math.round(a)}:null}catch(Q){return null}})();if(u){const n=.9*window.innerHeight;if(Math.abs(u.width-368)>5||Math.abs(u.height-n)>5){c.style.width=u.width+"px";const n=.9*window.innerHeight;c.style.height=Math.min(u.height,n)+"px",c.style.maxHeight="90vh"}}const d=i.querySelector(".collapse-btn");return d&&d.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),(t=>{t.classList.toggle("collapsed"),(t=>{try{localStorage.setItem(G.panelCollapsed,t+"")}catch(n){}})(t.classList.contains("collapsed"))})(c)}),setTimeout(()=>{"home"===n?f():h(),(()=>{const n=document.getElementById("saveRuntimeConfigBtn");n&&n.addEventListener("click",()=>{const n=m(),t={};try{const e=b();for(const a of e){if(!a||!a.stateKey)continue;const e=n[a.stateKey];void 0!==e&&(t[a.stateKey]=e)}}catch(Q){}t.gravityMultiplier=n.gravityMultiplierPit,t.restitution=n.REST,t.friction=n.FRICTION,t.ballMass=n.ballMassKg,t.ballScale=n.sizeScale,t.sizeScale=n.sizeScale,t.sizeVariation=n.sizeVariation,t.repelSoft=n.repelSoft,t.repelSoftness=n.repelSoft,t.layoutViewportWidthPx=n.layoutViewportWidthPx||0,t.containerBorderVw=n.containerBorderVw,t.simulationPaddingVw=n.simulationPaddingVw,t.contentPaddingVw=n.contentPaddingVw,t.contentPaddingHorizontalRatio=n.contentPaddingHorizontalRatio,t.wallRadiusVw=n.wallRadiusVw,t.wallThicknessVw=n.wallThicknessVw,t.wallThicknessMinPx=n.wallThicknessMinPx,t.wallThicknessMaxPx=n.wallThicknessMaxPx,t.layoutMinContentPaddingPx=Math.max(0,Math.round(n.layoutMinContentPaddingPx??0)),t.layoutMinWallRadiusPx=Math.max(0,Math.round(n.layoutMinWallRadiusPx??0)),t.wallInset=n.wallInset;try{t.soundPreset=v(),t.soundConfig=g()}catch(Q){}t.chromeHarmonyMode=n.chromeHarmonyMode,t.autoDarkModeEnabled=n.autoDarkModeEnabled,t.autoDarkNightStartHour=n.autoDarkNightStartHour,t.autoDarkNightEndHour=n.autoDarkNightEndHour,t.enableLOD=!1;const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(e),a.download="default-config.json",document.body.appendChild(a),a.click(),document.body.removeChild(a)})})(),(n=>{const t=n.querySelector("#soundEnableBtn"),e=n.querySelector("#soundControlsWrapper"),a=n.querySelector("#soundPresetSelect"),o=n.querySelector("#presetDescription"),s=n.querySelector("#soundSection"),l=n.querySelector("#soundTapBtn"),c=n.querySelector("#soundResetBtn"),i=n.querySelector("#soundShuffleBtn"),r=(n,t,e)=>t>n?t:n>e?e:n,u=(n,t)=>n+2*(Math.random()-.5)*t,d=(n,{openIfEnabled:a=!1}={})=>{if(!t)return;const o=n||R(),l=!(!o.isUnlocked||!o.isEnabled),c=!!o.isUnlocked;t.innerHTML=c&&l?'<i class="ti ti-volume-2" aria-hidden="true"></i>':'<i class="ti ti-volume-off" aria-hidden="true"></i>',t.setAttribute("aria-label",c?l?"Sound on":"Sound off":"Enable sound"),t.classList.toggle("enabled",l),e&&(e.style.display=l?"":"none"),a&&l&&s&&!s.open&&(s.open=!0)};if(l&&l.addEventListener("click",()=>{_({intensity:.86,radius:18,xPosition:.72})}),c&&c.addEventListener("click",()=>{const t=v();P(t),o&&I[t]&&(o.textContent=I[t].description),C(n,g)}),i&&i.addEventListener("click",()=>{const t=g(),e={filterBaseFreq:r(u(t.filterBaseFreq,120),300,8e3),filterQ:r(u(t.filterQ,.04),.05,.9),pitchCurve:r(u(t.pitchCurve,.06),.6,1.8),sparkleGain:r(u(t.sparkleGain,.03),0,.35),sparkleDecayMul:r(u(t.sparkleDecayMul,.05),.25,.95),noiseTransientQ:r(u(t.noiseTransientQ,.25),.6,6),reverbWetMix:r(u(t.reverbWetMix,.02),0,.35),reverbDecay:r(u(t.reverbDecay,.03),.05,.4),collisionMinImpact:r(u(t.collisionMinImpact,.03),.45,.9),variancePitch:r(u(t.variancePitch,.01),0,.2),varianceGain:r(u(t.varianceGain,.02),0,.35)};E(e),C(n,g),_({intensity:.86,radius:18,xPosition:.72})}),t&&t.addEventListener("click",async()=>{const n=R();if(n.isUnlocked){const t=T();d({...n,isEnabled:t})}else await $()&&d(null,{openIfEnabled:!0})}),a){for(const[n,t]of Object.entries(I)){const e=document.createElement("option");e.value=n,e.textContent=t.label,a.appendChild(e)}a.value=v(),o&&I[v()]&&(o.textContent=I[v()].description),a.addEventListener("change",()=>{P(a.value),o&&I[a.value]&&(o.textContent=I[a.value].description),C(n,g)})}W(n,g,E),C(n,g),d(),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(D,n=>{d(n&&n.detail?n.detail:null)})})(c),(n=>{const t=n.querySelector("#layoutViewportWidth"),e=n.querySelector("#viewportWidthValue"),a=n.querySelector("#layoutWallInset"),o=n.querySelector("#wallInsetValue"),s=m();t&&e&&t.addEventListener("input",n=>{const t=parseInt(n.target.value,10);s.layoutViewportWidthPx=Number.isFinite(t)?Math.max(0,t):0,(({triggerResize:t=!1}={})=>{if(L(),O(),e){const n=N();e.textContent=s.layoutViewportWidthPx>0?Math.round(s.layoutViewportWidthPx)+"px":`Auto (${Math.round(n)}px)`}if(t)try{j()}catch(n){}document.dispatchEvent(new CustomEvent("layout-updated"))})({triggerResize:!0})}),a&&o&&a.addEventListener("input",n=>{const t=parseInt(n.target.value,10);o.textContent=t+"px",s.wallInset=t})})(c),w();try{const n=m();S(n)}catch(Q){}try{l?.(c)}catch(Q){}},0),c})({page:s,panelTitle:d,modeLabel:p,pageLabel:l,includePageSaveButton:c,pageSaveButtonId:i,footerHint:u,setupPageControls:q}),A.appendChild(J),document.body.insertBefore(A,document.body.firstChild),y()&&(()=>{if(document.querySelector(".panel-toggle-btn"))return;const n=document.createElement("button");n.className="panel-toggle-btn",n.setAttribute("aria-label","Toggle config panel"),n.innerHTML="âš™",n.style.display="flex",n.addEventListener("click",()=>{r()}),document.body.appendChild(n)})(),J&&(J.addEventListener("mousedown",n=>{const t=J.getBoundingClientRect();n.clientY-t.top>12||n.target.closest("button")||n.target.closest("input")||n.target.closest("select")||e(n)}),J.addEventListener("touchstart",n=>{const t=J.getBoundingClientRect();n.touches[0].clientY-t.top>12||n.target.closest("button")||n.target.closest("input")||n.target.closest("select")||e(n)},{passive:!1}),document.addEventListener("mousemove",a),document.addEventListener("mouseup",o),document.addEventListener("touchmove",a,{passive:!1}),document.addEventListener("touchend",o),(()=>{try{if(!A)return;const n=JSON.parse(localStorage.getItem(G.position)||"{}");n.custom&&(A.style.position="fixed",A.style.left=n.left,A.style.top=n.top,A.style.right="auto")}catch(Q){}})()),(()=>{if(!J)return;if("undefined"==typeof ResizeObserver)return;let n=0;const t=new ResizeObserver(()=>{J&&(J.classList.contains("collapsed")||(window.clearTimeout(n),n=window.setTimeout(()=>{(n=>{try{if(!n)return;if(n.classList.contains("collapsed"))return;const t=n.getBoundingClientRect();localStorage.setItem(G.panelSize,JSON.stringify({width:Math.round(t.width),height:Math.round(t.height)}))}catch(Q){}})(J)},150)))});try{t.observe(J)}catch(Q){}})(),A&&A.addEventListener("pointerenter",n=>{const t=n.target;if(!t||!t.closest)return;const e=t.matches('button, [role="button"], .mode-btn, .mac-dot'),a=t.matches('input[type="range"]'),o=t.matches("select");(e||a||o)&&z()},!0),U&&(X||(X=!0,window.addEventListener("keydown",n=>{try{const t=n.target?.tagName,e=["INPUT","TEXTAREA","SELECT"].includes(t),a=!!n.target?.closest?.(".panel-dock");if(e&&!a)return}catch(Q){}"/"!==(n.key?.toLowerCase?.()||"")&&"Slash"!==n.code||(n.preventDefault(),r())}))),A}function e(n){if(n.target.closest("button")||n.target.closest("input")||n.target.closest("select"))return;if(!A)return;const t=n.touches?n.touches[0].clientX:n.clientX,e=n.touches?n.touches[0].clientY:n.clientY,a=A.getBoundingClientRect();q=t,F=e,Q=a.left,K=a.top,U=!1}function a(n){if(0===q&&0===F)return;if(!A)return;const t=(n.touches?n.touches[0].clientX:n.clientX)-q,e=(n.touches?n.touches[0].clientY:n.clientY)-F;if(U||5>=Math.abs(t)&&5>=Math.abs(e)||(U=!0,A.classList.add("dragging"),A.style.position="fixed",A.style.top=K+"px",A.style.left=Q+"px",A.style.right="auto"),U){let a=Q+t,o=K+e;const s=A.getBoundingClientRect();a=Math.max(0,Math.min(window.innerWidth-s.width,a)),o=Math.max(0,Math.min(window.innerHeight-s.height,o)),A.style.left=a+"px",A.style.top=o+"px",n.preventDefault()}}function o(){U&&(U=!1,A&&A.classList.remove("dragging"),s()),q=0,F=0,setTimeout(()=>{},10)}function s(){try{if(!A)return;localStorage.setItem(G.position,JSON.stringify({left:A.style.left,top:A.style.top,custom:!0}))}catch(n){}}function l(){if(A){A.style.position="",A.style.left="",A.style.top="",A.style.right="";try{localStorage.removeItem(G.position)}catch(n){}}}function c(){J&&J.classList.remove("collapsed")}function i(){J&&J.classList.add("collapsed")}function r(){if(!A)try{t()}catch(a){return}const e=A.classList.toggle("hidden");if(n(e),!e)try{(()=>{if(!A)return;if(!A.style.left&&!A.style.top)return;const n=A.getBoundingClientRect(),t=window.innerWidth||0,e=window.innerHeight||0;if(!t||!e)return;const a=10;if(a>n.right||n.left>t-a||a>n.bottom||n.top>e-a)return void l();const o=(n,t,e)=>t>n?t:n>e?e:n,c=o(n.left,a,Math.max(a,t-n.width-a)),i=o(n.top,a,Math.max(a,e-n.height-a));A.style.position="fixed",A.style.left=Math.round(c)+"px",A.style.top=Math.round(i)+"px",A.style.right="auto",s()})()}catch(a){}}function u(){return A}function d(){return J}function p(){return J}import{s as f,a as h}from"./main.js";import{ap as b,g as m,aq as v,ar as g,i as y,as as w,at as S,au as k,av as M,aw as x,ax as B,ay as _,az as P,aA as I,aB as C,aC as E,aD as R,aE as $,aF as T,aG as W,aH as D,aI as H,aJ as L,o as O,aK as N,v as j,aL as z,aM as V}from"./shared.js";import"./legend-colors.js";let A=null,J=null;const G={position:"panel_dock_position_v2",dockHidden:"panel_dock_hidden",panelCollapsed:"master_panel_collapsed",panelSize:y()?"panel_dock_size_dev_v3":"panel_dock_size_prod_v3"};let U=!1,q=0,F=0,Q=0,K=0,X=!1;const Y=l;export{i as collapsePanel,t as createPanelDock,c as expandPanel,d as getControlPanel,u as getDock,p as getSoundPanel,Y as resetDockPosition,l as resetPanelPositions,r as toggleDock};