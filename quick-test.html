<!DOCTYPE html>
<html>
<head>
  <title>Quick Test</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    .pass { color: green; }
    .fail { color: red; }
  </style>
</head>
<body>
  <h1>Testing source/balls-source.html</h1>
  <div id="results"></div>
  
  <iframe id="testFrame" src="/source/balls-source.html" style="width: 100%; height: 600px; border: 2px solid #333; margin-top: 20px;"></iframe>
  
  <script>
    const results = document.getElementById('results');
    const iframe = document.getElementById('testFrame');
    
    function log(msg, isPass = true) {
      const div = document.createElement('div');
      div.className = isPass ? 'pass' : 'fail';
      div.textContent = (isPass ? '✅ ' : '❌ ') + msg;
      results.appendChild(div);
    }
    
    iframe.onload = () => {
      setTimeout(() => {
        const doc = iframe.contentDocument;
        
        log('Iframe loaded');
        
        const controlPanel = doc.getElementById('controlPanel');
        log('Control panel exists: ' + !!controlPanel, !!controlPanel);
        
        if (controlPanel) {
          const style = iframe.contentWindow.getComputedStyle(controlPanel);
          log('Display: ' + style.display, style.display !== 'none');
          log('Visibility: ' + style.visibility, style.visibility !== 'hidden');
          log('Opacity: ' + style.opacity, parseFloat(style.opacity) > 0);
          log('Width: ' + controlPanel.offsetWidth + 'px', controlPanel.offsetWidth > 0);
          log('Height: ' + controlPanel.offsetHeight + 'px', controlPanel.offsetHeight > 0);
          log('Has hidden class: ' + controlPanel.classList.contains('hidden'), !controlPanel.classList.contains('hidden'));
        }
        
        const canvas = doc.getElementById('c');
        log('Canvas exists: ' + !!canvas, !!canvas);
        
        const braviaBalls = doc.getElementById('bravia-balls');
        log('bravia-balls container exists: ' + !!braviaBalls, !!braviaBalls);
        
        // Check for console errors
        const errors = [];
        iframe.contentWindow.addEventListener('error', (e) => {
          errors.push(e.message);
        });
        
        setTimeout(() => {
          if (errors.length > 0) {
            log('Console errors found: ' + errors.length, false);
            errors.forEach(err => log('  ' + err, false));
          } else {
            log('No console errors');
          }
        }, 2000);
        
      }, 1000);
    };
    
    iframe.onerror = (e) => {
      log('Failed to load iframe: ' + e, false);
    };
  </script>
</body>
</html>
