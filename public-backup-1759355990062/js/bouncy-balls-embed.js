(()=>{const t={PIT:"pit",FLIES:"flies",WEIGHTLESS:"weightless",PULSE_GRID:"pulse-grid"};let e=t.PIT,n=40,o=1.15,a=!0,s=5e3,i=180,l=3.5,r=80,d=250,h=.97,u=300,c=150,m=40,g=.8,p=.25,y=.3,f=.4,v=1,x=3,E=120,I=.15,S="snap",M=1.08,B=!1,b=0,w=4,C=12,L=.15,F="#000000",P=!1,T=4,V=.1;const R=-1e9,A=1e-4,q=.25;function G(){return 0===n?0:n/40*.2}const z=document.getElementById("c"),O=document.getElementById("bravia-balls");let k;try{if(k=z.getContext("2d",{alpha:!0}),!k)throw new Error("Canvas 2D context not available")}catch(ca){throw console.error("‚ùå Failed to initialize canvas:",ca),O.innerHTML='\n      <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #1a1a1a; color: white; font-family: system-ui, -apple-system, sans-serif;">\n        <div style="text-align: center; padding: 40px; background: rgba(255,50,50,0.1); border: 2px solid rgba(255,50,50,0.3); border-radius: 12px; max-width: 480px;">\n          <div style="font-size: 72px; margin-bottom: 20px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));">‚ö†Ô∏è</div>\n          <h2 style="margin: 0 0 16px 0; font-size: 24px; font-weight: 600;">Canvas Not Supported</h2>\n          <p style="margin: 0 0 12px 0; opacity: 0.9; line-height: 1.6; font-size: 15px;">Your browser doesn\'t support the HTML5 Canvas 2D features required for this interactive simulation.</p>\n          <p style="margin: 0; opacity: 0.7; font-size: 13px;">Please try a modern browser like Chrome, Firefox, Safari, or Edge.</p>\n        </div>\n      </div>\n    ',ca}const N=document.getElementById("controlPanel"),U=Math.max(1,Math.min(2,window.devicePixelRatio||1));function D(){if(!B)return void(z.style.filter="none");const t=(t,e)=>`rgba(${parseInt(t.slice(1,3),16)}, ${parseInt(t.slice(3,5),16)}, ${parseInt(t.slice(5,7),16)}, ${e})`,e=`drop-shadow(${b}px ${w}px ${C}px ${t(F,L)})`,n=P?` drop-shadow(${b}px ${Math.round(.5*w)}px ${T}px ${t(F,V)})`:"";z.style.filter=e+n}let Y=!1,X=60,H=!0,W=!1;function $(t){W=t,t?O.classList.add("dark-mode"):O.classList.remove("dark-mode"),Vt(Lt),function(){const t=document.getElementById("darkModeToggle"),e=document.getElementById("darkModeStatus");if(t&&(t.checked=H),e){const t=new Date,n=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`;W?(e.textContent=`üåô Night Mode (${n})`,e.style.background="rgba(100,100,255,0.3)"):(e.textContent=`‚òÄÔ∏è Day Mode (${n})`,e.style.background="rgba(255,200,0,0.3)")}}()}function j(){H&&$(function(){const t=(new Date).getHours();return t>=18||t<6}())}const _={normal:{maxBalls:350,collisionIters:2,adaptiveQualityMin:.5},performance:{maxBalls:200,collisionIters:1,adaptiveQualityMin:.3}};let Z,J=50,Q=-50,K=100,tt=50;function et(){const n=e===t.PIT?1.5:1,o=window.innerHeight*n;if(z.width=Math.floor(window.innerWidth*U),z.height=Math.floor(o*U),e===t.PULSE_GRID){wo();for(let t=0;t<re.length;t++){const e=re[t];e.gridX=Math.max(0,Math.min(Mo-1,e.gridX)),e.gridY=Math.max(0,Math.min(So-1,e.gridY));const n=Co(e.gridX,e.gridY);e.x=n.x,e.y=n.y,e.targetX=n.x,e.targetY=n.y}}}et(),window.addEventListener("resize",function(){clearTimeout(Z),Z=setTimeout(()=>{et(),St(),Mt()},150)});const nt=1960;let ot=1.1,at=nt*ot,st=.88,it=.003,lt=.03,rt=400;const dt=.5*U,ht=6,ut=24;let ct=1,mt=.15,gt=1,pt=null,yt=11.2;const ft=.15;let vt=1;function xt(){vt=Math.max(.5,Math.min(3,Math.pow(yt/1,.35)))}xt();let Et=ht*ct,It=ut*ct;function St(){gt=(z.clientWidth||window.innerWidth)<=768?.4:1;const t=ct*gt;if(null===pt)return pt=t,Et=ht*t,void(It=ut*t);const e=t/pt;if(1!==e){for(let t=0;t<re.length;t++)re[t].r*=e;pt=t}Et=ht*t,It=ut*t}function Mt(){_t=[];const t=document.querySelector(jt);if(!t)return;const e=t.getBoundingClientRect(),n=z.getBoundingClientRect(),o=function(t){const e=document.createElement("span");e.style.cssText=window.getComputedStyle(t).cssText,e.style.position="absolute",e.style.visibility="hidden",e.style.whiteSpace="nowrap",e.textContent="ABCDEFGHIJKLMNOPQRSTUVWXYZ",document.body.appendChild(e);const n=e.getBoundingClientRect().height;return document.body.removeChild(e),n}(t),a=.5*(e.height-o),s={x:(e.left-n.left)*U,y:(e.top-n.top+a)*U,width:e.width*U,height:o*U};s.width>0&&s.height>0&&s.x<z.width&&s.y<z.height&&s.x+s.width>0&&s.y+s.height>0&&_t.push(s)}let Bt=!0,bt=0,wt=1;const Ct={industrialTeal:{label:"Industrial Teal",light:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#2a2a2a","#1a1a1a","#404040","#00a88f","#e0e0e0","#ff6b47","#3b7de0","#ffc04d"]},sunsetCoral:{label:"Sunset Coral",light:["#bdbbb8","#e8e6e3","#ffffff","#ff3b3b","#000000","#00f5d4","#1e40af","#fb923c"],dark:["#2b2a28","#1c1b1a","#3d3d3d","#ff5c5c","#dddddd","#00ffe7","#4169e1","#ffa866"]},violetPunch:{label:"Violet Punch",light:["#b8b7c2","#e6e5ed","#ffffff","#9333ea","#000000","#dc2626","#0ea5e9","#facc15"],dark:["#2a2832","#1a1921","#3e3d47","#b24dff","#e0e0e0","#ff4444","#00d4ff","#ffe34d"]},citrusBlast:{label:"Citrus Blast",light:["#bfbdb5","#eae8df","#ffffff","#ea580c","#000000","#e11d48","#2563eb","#059669"],dark:["#2c2b27","#1d1c19","#3f3e3a","#ff7733","#dddddd","#ff4466","#4d8aff","#00bf7f"]},cobaltSpark:{label:"Cobalt Spark",light:["#b5b8be","#e3e6eb","#ffffff","#1d4ed8","#000000","#ea580c","#db2777","#d97706"],dark:["#282b30","#191c20","#3d4147","#4d7aff","#dedede","#ff7f3d","#ff4d9e","#ffad33"]}};let Lt="industrialTeal",Ft=["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],Pt=5,Tt=Ft[Pt]||"#000000";function Vt(t){Lt=t,Ft=function(t){const e=Ct[t];return e?W?e.dark:e.light:Ct.industrialTeal.light}(t),Tt=Ft[Pt]||Tt,Ko(),Rt(),ta()}function Rt(t=Ft){try{const e=document.documentElement,n=(t&&t.length?t:Ft).slice(0,8);for(let t=0;t<8;t++){const o=n[t]||"#ffffff";e.style.setProperty(`--ball-${t+1}`,o)}}catch(t){}}const At=[.5,.25,.12,.06,.03,.02,.01,.01];function qt(){try{if(!Ft||0===Ft.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let e=0;for(let n=0;n<Math.min(Ft.length,At.length);n++)if(e+=At[n],t<=e)return Ft[n];return Ft[Math.min(Ft.length-1,7)]}catch(t){return console.error("Error picking random color:",t),"#ffffff"}}let Gt=255,zt=274e3,Ot=4.4,kt=R,Nt=R,Ut=!1,Dt=!1;("ontouchstart"in window||navigator.maxTouchPoints>0)&&(Dt=!0);const Yt="bouncyBallsSettings";function Xt(){const t={currentMode:e,gravityMultiplierPit:o,repellerEnabledPit:a,attractionPower:s,orbitRadius:i,swarmSpeed:l,weightlessInitialSpeed:d,weightlessBounce:h,weightlessCount:r,weightlessRepellerPower:u,weightlessRepellerRadius:c,restitution:st,friction:it,sizeScale:ct,sizeVariation:mt,ballMassKg:yt,ballSoftness:n,repelPower:zt,repelRadius:Gt,repelSoft:Ot,cornerRadius:$t,motionBlur:trailFade,trailSubtlety:Jt,currentTemplate:Lt,cursorBallColor:Tt,gridColumns:m,gridBallCount:E,pulseInterval:g,pulseSpeed:p,pulseSynchronicity:y,pulseRandomness:f,pulseMinSteps:v,pulseMaxSteps:x,pulseEasingStyle:S,pulseOvershoot:M,pulseBounceIntensity:I,canvasShadowEnabled:B,shadowOffsetX:b,shadowOffsetY:w,shadowBlur:C,shadowOpacity:L,shadowColor:F,shadow2Enabled:P,shadow2Blur:T,shadow2Opacity:V,autoDarkModeEnabled:H};try{localStorage.setItem(Yt,JSON.stringify(t)),console.log("‚úì Settings saved")}catch(t){console.warn("Could not save settings:",t)}}function Ht(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(Xt,500)}const Wt=1e4;let $t=0;const jt="#hero-text";let _t=[],Zt=.025,Jt=1.8,Qt=0,Kt=0,te=0,ee=0,ne=0;const oe=document.getElementById("render-fps"),ae=document.getElementById("physics-fps");let se=2,ie=0;class le{constructor(t,e,n,o){this.x=t,this.y=e,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=n,this.rBase=n,this.m=yt,this.color=o,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1}step(n){this.t+=n,this.age+=n,e!==t.WEIGHTLESS&&(this.vy+=at*vt*n);const o=Math.max(.25,this.m/1),a=e===t.WEIGHTLESS?1e-4:it,i=Math.max(0,1-a/o);this.vx*=i,this.vy*=i,0!==this.driftAx&&this.age<this.driftTime?this.vx+=this.driftAx*n/o:0!==this.driftAx&&(this.driftAx=0),function(n,o){e!==t.PIT?e!==t.FLIES?e!==t.WEIGHTLESS||function(t,e){if(kt===R||Nt===R)return;if(u<=0||c<=0)return;const n=c*U,o=t.x-kt,a=t.y-Nt,s=o*o+a*a;if(s>n*n)return;const i=Math.max(Math.sqrt(s),A),l=o/i,r=a/i,d=Math.max(0,1-i/n),h=u*d;t.vx+=l*h*e,t.vy+=r*h*e}(n,o):function(t,e){const n=kt===R?.5*z.width:kt,o=Nt===R?.5*z.height:Nt,a=n-t.x,i=o-t.y,r=a*a+i*i,d=Math.sqrt(r+1),h=a/d,u=i/d,c=s*l*2;t.vx+=h*c*e,t.vy+=u*c*e;const m=120*U;let g=0,p=0,y=0;for(let e=0;e<re.length;e++){const n=re[e];if(n===t)continue;const o=t.x-n.x,a=t.y-n.y,s=o*o+a*a;if(s<m*m&&s>0){const t=Math.sqrt(s),e=1-t/m;g+=o/t*e,p+=a/t*e,y++}}if(y>0){const n=15e3;t.vx+=g/y*n*e,t.vy+=p/y*n*e}const f=2500*l;if(Math.random()<.08){const e=Math.random()*Math.PI*2,n=1500*l;t.vx+=Math.cos(e)*n,t.vy+=Math.sin(e)*n}t.vx+=(Math.random()-.5)*f*e,t.vy+=(Math.random()-.5)*f*e;const v=.3+2*Math.random(),x=2e3*l*v*e;t.vx+=-u*x,t.vy+=h*x;const E=2200*l,I=Math.sqrt(t.vx*t.vx+t.vy*t.vy);I>E&&(t.vx=t.vx/I*E,t.vy=t.vy/I*E),t.vx*=.995,t.vy*=.995}(n,o):function(t,e){if(!Ut)return;if(zt<=0||Gt<=0)return;const n=Gt*U,o=t.x-kt,a=t.y-Nt,s=o*o+a*a;if(s>n*n)return;const i=Math.max(Math.sqrt(s),A),l=o/i,r=a/i,d=Math.max(0,1-i/n),h=20*zt*Math.pow(d,Ot),u=Math.max(.25,t.m/1);t.vx+=l*h*e/u,t.vy+=r*h*e/u;t.vx+=10*(Math.random()-.5)*e,t.vy+=10*(Math.random()-.5)*e}(n,o)}(this,n),this.x+=this.vx*n,this.y+=this.vy*n;const r=Math.max(0,1-2*n);this.omega*=r,this.theta+=this.omega*n,this.theta>Math.PI?this.theta-=2*Math.PI:this.theta<-Math.PI&&(this.theta+=2*Math.PI);const d=Math.min(1,18*n);this.squashAmount+=(0-this.squashAmount)*d,this.squash=1-this.squashAmount}walls(n,o,a,s=st){const i=s;if(0===$t){if(this.y+this.r>o){this.y=o-this.r;const t=this.vy,e=this.vx-this.omega*this.r,n=Math.max(.25,this.m/1);this.omega+=e/this.r*q/n;const s=Math.max(0,1-1.5*a/n);this.vx*=s;const l=Math.abs(t)<70?0:i;this.vy=-this.vy*(l*Math.pow(1/this.m,ft));const r=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(G(),.8*r),this.squash=1-this.squashAmount,this.squashNormalAngle=-Math.PI/2;const d=this.vx/this.r;this.omega+=(d-this.omega)*Math.min(1,8*a)}const s=e===t.PIT?o/3:0;if(this.y-this.r<s){this.y=s+this.r;const t=this.vy;this.vy=-this.vy*i;const e=Math.min(1,Math.abs(t)/(90*this.r));this.squashAmount=Math.min(G(),.8*e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI/2}if(this.x+this.r>n){this.x=n-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*i;const t=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(G(),.8*t),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*i;const t=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(G(),.8*t),this.squash=1-this.squashAmount,this.squashNormalAngle=0}}else this.handleRoundedWallCollision(n,o);this.checkTextCollisions(a)}checkTextCollisions(t){for(let t=0;t<_t.length;t++){const e=_t[t],n=Math.max(e.x,Math.min(this.x,e.x+e.width)),o=Math.max(e.y,Math.min(this.y,e.y+e.height)),a=this.x-n,s=this.y-o,i=Math.sqrt(a*a+s*s);if(i<this.r)if(0===i){const t=this.x-e.x,n=e.x+e.width-this.x,o=this.y-e.y,a=e.y+e.height-this.y,s=Math.min(t,n,o,a);s===t?(this.x=e.x-this.r,this.vx=-Math.abs(this.vx)*st):s===n?(this.x=e.x+e.width+this.r,this.vx=Math.abs(this.vx)*st):s===o?(this.y=e.y-this.r,this.vy=-Math.abs(this.vy)*st):(this.y=e.y+e.height+this.r,this.vy=Math.abs(this.vy)*st)}else{const t=this.r-i,e=a/i,n=s/i;this.x+=e*t,this.y+=n*t;const o=this.vx*e+this.vy*n;if(o<0){this.vx-=2*o*e*st,this.vy-=2*o*n*st;const t=Math.min(1,Math.abs(o)/(70*this.r));this.squash=1-G()*t,this.squashDirX=Math.abs(e)>Math.abs(n)?1:0,this.squashDirY=Math.abs(n)>Math.abs(e)?1:0}}}}handleRoundedWallCollision(t,e){const n=$t,o=[{x:n,y:n},{x:t-n,y:n},{x:t-n,y:e-n},{x:n,y:e-n}];for(let a=0;a<o.length;a++){const s=o[a],i=this.x-s.x,l=this.y-s.y,r=Math.sqrt(i*i+l*l);if(this.isInCornerRegion(s,t,e,n)&&r+this.r>n){const t=n-(r-this.r);if(t>0&&r>0){const e=i/r,n=l/r;this.x+=e*t,this.y+=n*t;const o=this.vx*e+this.vy*n;this.vx-=2*o*e*st,this.vy-=2*o*n*st;const a=Math.min(1,Math.abs(o)/(90*this.r));this.squashAmount=Math.min(G(),.8*a),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.atan2(n,e)}}}if(this.y+this.r>e&&(this.x<n||this.x>t-n)&&(this.y=e-this.r,this.vy=-this.vy*(st*Math.pow(1/this.m,ft))),this.y-this.r<0&&(this.x<n||this.x>t-n)&&(this.y=this.r,this.vy=-this.vy*st),this.x+this.r>t&&(this.y<n||this.y>e-n)){this.x=t-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(st*Math.pow(1/this.m,ft));const e=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(G(),e),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0&&(this.y<n||this.y>e-n)){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(st*Math.pow(1/this.m,ft));const t=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(G(),t),this.squash=1-this.squashAmount,this.squashNormalAngle=0}this.y+this.r>e&&this.x>=n&&this.x<=t-n&&(this.y=e-this.r,this.vy=-this.vy*(st*Math.pow(1/this.m,ft))),this.y-this.r<0&&this.x>=n&&this.x<=t-n&&(this.y=this.r,this.vy=-this.vy*(st*Math.pow(1/this.m,ft))),this.x+this.r>t&&this.y>=n&&this.y<=e-n&&(this.x=t-this.r,this.vx=-this.vx*(st*Math.pow(1/this.m,ft))),this.x-this.r<0&&this.y>=n&&this.y<=e-n&&(this.x=this.r,this.vx=-this.vx*(st*Math.pow(1/this.m,ft)))}isInCornerRegion(t,e,n,o){return t.x===o&&t.y===o?this.x<=o&&this.y<=o:t.x===e-o&&t.y===o?this.x>=e-o&&this.y<=o:t.x===e-o&&t.y===n-o?this.x>=e-o&&this.y>=n-o:t.x===o&&t.y===n-o&&this.x<=o&&this.y>=n-o}draw(t){t.save(),t.translate(this.x,this.y);const e=Math.min(G(),Math.max(0,this.squashAmount));if(this.r>15&&e>.001){const n=1+e,o=1/n;t.rotate(this.squashNormalAngle),t.scale(n,o),t.rotate(-this.squashNormalAngle)}t.beginPath(),t.arc(0,0,this.r,0,2*Math.PI),t.fillStyle=this.color,t.fill(),t.restore()}}const re=[];function de(t,e,n){return Math.max(e,Math.min(n,t))}function he(t,e){return t+Math.random()*(e-t)}function ue(t,e,n=qt()){const o=(Et+It)/2;let a;if(0===mt)a=o;else{const t=.1*o;a=he(Math.max(1,o-t),o+t)}const s=new le(t,e,a,n),i=.5*z.width,l=Bt?wt>=0?1:-1:t<i?1:-1,r=de(a/(.5*(Et+It)),.6,1.4),d=140*r,h=180*r;return s.vx=l*(d+Math.random()*h),s.vy=120*-Math.random(),s.driftAx=l*(360+420*Math.random())*r,s.driftTime=.22+.28*Math.random(),re.push(s),s}let ce=0;function me(){const t=z.clientWidth,e=z.clientHeight,n=de(K/100*t,0,t);let o=de(J/100*t,0,t);if(Bt){const e=.2*t,n=o;o=de(o+Math.sin(bt)*e,0,t),wt=o>=n?1:-1}const a=Math.min(40,.1*n),s=de(o-n/2-a,-a,t),i=de(o+n/2+a,-a,t),l=Q/100*e,r=l+tt/100*e,d=Math.random();return{x:(s+(i-s)*(wt>0?Math.pow(d,.7):1-Math.pow(1-d,.7)))*U,y:he(l*U,r*U)-(It+2+he(0,10*U))}}const ge=new Map;function pe(t=6){const e=function(){const t=re.length;if(t<2)return[];const e=Math.max(1,2*It),n=Math.ceil(z.width/e)+1;ge.clear();for(let o=0;o<t;o++){const t=re[o],a=t.x/e|0,s=(t.y/e|0)*n+a;let i=ge.get(s);i||(i=[],ge.set(s,i)),i.push(o)}const o=[];for(const[t,e]of ge){const a=t/n|0,s=t%n;for(let t=-1;t<=1;t++)for(let i=-1;i<=1;i++){const l=(a+t)*n+(s+i),r=ge.get(l);if(r)for(let t=0;t<e.length;t++){const n=e[t];for(let t=0;t<r.length;t++){const e=r[t];if(e<=n)continue;const a=re[n],s=re[e],i=s.x-a.x,l=s.y-a.y,d=a.r+s.r,h=i*i+l*l;if(h<d*d){const t=d-Math.sqrt(Math.max(h,1e-6));o.push({i:n,j:e,overlap:t})}}}}}return o.sort((t,e)=>e.overlap-t.overlap),o}();for(let n=0;n<t;n++)for(let t=0;t<e.length;t++){const{i:n,j:o}=e[t],a=re[n],s=re[o],i=s.x-a.x,l=s.y-a.y,r=a.r+s.r,d=i*i+l*l;if(0===d||d>r*r)continue;const h=Math.sqrt(d),u=i/h,c=l/h,m=r-h,g=1/Math.max(a.m,.001),p=1/Math.max(s.m,.001),y=.8*Math.max(m-dt,0)/(g+p),f=y*u,v=y*c;a.x-=f*g,a.y-=v*g,s.x+=f*p,s.y+=v*p;const x=s.vx-a.vx,E=s.vy-a.vy,I=x*u+E*c;if(I<0){const t=-(1+(Math.abs(I)<30?0:st))*I/(g+p),e=t*u,n=t*c;a.vx-=e*g,a.vy-=n*g,s.vx+=e*p,s.vy+=n*p;const o=x-I*u,i=E-I*c,l=Math.hypot(o,i);if(l>.001){const t=o*-c+i*u>=0?1:-1,e=.18;a.omega-=t*e*l/Math.max(a.r,1),s.omega+=t*e*l/Math.max(s.r,1)}const r=Math.min(1,Math.abs(I)/(50*(a.r+s.r))),d=Math.min(G(),.8*r);a.squashAmount=Math.max(a.squashAmount,.8*d),a.squashNormalAngle=Math.atan2(-c,-u),s.squashAmount=Math.max(s.squashAmount,.8*d),s.squashNormalAngle=Math.atan2(c,u)}}}let ye=performance.now()/1e3,fe=0;const ve=1/120;function xe(){const t=parseFloat(Le.value);ct=t,St();const e=(Et+It)/2;for(let t=0;t<re.length;t++)if(0===mt)re[t].r=e,re[t].rBase=e;else{const n=.1*e,o=Math.max(1,e-n),a=e+n;re[t].r=he(o,a),re[t].rBase=re[t].r}}console.log("High refresh mode enabled - using requestAnimationFrame"),requestAnimationFrame(function n(o){const a=o/1e3;let s=Math.min(.008,a-ye);ye=a,fe+=s,Qt++,(oe||ae)&&a-te>=1&&(oe&&Qt!==ee&&(ee=Qt,oe.textContent=ee.toString()),ae&&Kt!==ne&&(ne=Kt,ae.textContent=ne.toString()),Qt=0,Kt=0,te=a,function(t){t-ie<2||(ie=t,ee<50?(se=1,console.log("‚ö° Adaptive Quality: LOW (1 collision iter) - FPS:",ee)):ee<70?(se=2,console.log("‚ö° Adaptive Quality: MEDIUM (2 collision iters) - FPS:",ee)):(se=3,console.log("‚ö° Adaptive Quality: HIGH (3 collision iters) - FPS:",ee)))}(a)),function(n){if(e!==t.WEIGHTLESS&&e!==t.PULSE_GRID)for(ce+=n;ce>=lt;){const t=(Math.random()-.5)*lt*.5;ce-=lt+t,bt+=2*Math.PI*.12*(lt+t);const e=me(),n=Math.random()<.35?3:1;for(let t=0;t<n;t++)if(re.length<rt){const n=8*t*(Math.random()<.5?1:-1);ue(e.x+n,e.y-12*t)}}}(s),e===t.PULSE_GRID&&function(t){for(let e=0;e<re.length;e++){const n=re[e];if(n.nextJumpTime-=t,n.nextJumpTime<=0&&n.jumpProgress>=1){const t=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}],e=t[Math.floor(Math.random()*t.length)],o=x-v+1,a=v+Math.floor(Math.random()*o),s=Math.max(1,Math.round(a*(1-.5*f+f*Math.random())));let i=n.gridX+e.dx*s,l=n.gridY+e.dy*s;i=Math.max(0,Math.min(Mo-1,i)),l=Math.max(0,Math.min(So-1,l)),n.gridX=i,n.gridY=l;const r=Co(i,l);n.targetX=r.x,n.targetY=r.y,n.jumpProgress=0,n.jumpStartX=n.x,n.jumpStartY=n.y;const d=f*g*(Math.random()-.5),h=y*g*Math.random();n.nextJumpTime=g+d+h}if(n.jumpProgress<1)if(n.jumpProgress+=t/p,n.jumpProgress>=1)n.jumpProgress=1,n.x=n.targetX,n.y=n.targetY,n.vx=0,n.vy=0;else{const t=n.jumpProgress;let e=t;if("linear"===S)e=t;else if("snap"===S)if(t<.6){const n=t/.6;e=n*n*M}else{const n=(t-.6)/.4;e=1+(M-1)*(1-n)-I*Math.sin(n*Math.PI)}else if("bounce"===S)if(t<.7)e=t/.7*(t/.7);else{const n=(t-.7)/.3;e=1-.5*I*Math.sin(n*Math.PI*2)}else"smooth"===S&&(e=t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2);n.x=n.jumpStartX+(n.targetX-n.jumpStartX)*e,n.y=n.jumpStartY+(n.targetY-n.jumpStartY)*e,n.vx=0,n.vy=0}}}(s),Qt%60==0&&Mt();let i=0;for(;fe>=ve&&i<2;){if(e!==t.PULSE_GRID)for(let t=0;t<re.length;t++)re[t].step(ve);if(e!==t.FLIES&&e!==t.PULSE_GRID&&pe(se),e!==t.PULSE_GRID){const n=e===t.WEIGHTLESS?h:st;for(let t=0;t<re.length;t++)re[t].walls(z.width,z.height,ve,n)}fe-=ve,i++,Kt++}fe>3*ve&&(fe=0),k.clearRect(0,0,z.width,z.height),$t>0&&function(t,e,n){const o=$t;t.strokeStyle="rgba(255, 255, 255, 0.1)",t.lineWidth=2,t.beginPath(),t.moveTo(o,0),t.lineTo(e-o,0),t.arcTo(e,0,e,o,o),t.lineTo(e,n-o),t.arcTo(e,n,e-o,n,o),t.lineTo(o,n),t.arcTo(0,n,0,n-o,o),t.lineTo(0,o),t.arcTo(0,0,o,0,o),t.closePath(),t.stroke()}(k,z.width,z.height);for(let t=0;t<re.length;t++)re[t].draw(k);if(function(t){if(Dt)return;if(kt===R||Nt===R)return;const e=kt,n=Nt,o=(Et+It)/2;t.beginPath(),t.arc(e,n,o,0,2*Math.PI),t.fillStyle="rgba(255, 255, 255, 0.9)",t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.6)",t.lineWidth=2,t.stroke()}(k),!Dt){k.save(),k.font="14px system-ui, -apple-system, sans-serif",k.fillStyle="rgba(255, 255, 255, 0.3)",k.textAlign="left",k.textBaseline="bottom";const t=e.charAt(0).toUpperCase()+e.slice(1);k.fillText(t+" Mode",10,z.height-10),k.restore()}requestAnimationFrame(n)});const Ee=document.getElementById("panelHeader"),Ie=document.getElementById("minimizePanel");if(N&&N.classList.add("hidden"),Ie&&N&&Ie.addEventListener("click",t=>{t.stopPropagation(),N.classList.toggle("hidden")}),Ee&&N){let ma,ga,pa,ya,fa=!1,va=0,xa=0;function Se(t){"touchstart"===t.type?(pa=t.touches[0].clientX-va,ya=t.touches[0].clientY-xa):(pa=t.clientX-va,ya=t.clientY-xa),(t.target===Ee||Ee.contains(t.target))&&(fa=!0,N.style.cursor="grabbing")}function Me(t){if(fa){t.preventDefault(),"touchmove"===t.type?(ma=t.touches[0].clientX-pa,ga=t.touches[0].clientY-ya):(ma=t.clientX-pa,ga=t.clientY-ya),va=ma,xa=ga,N.getBoundingClientRect();const e=window.getComputedStyle(N),n=parseFloat(e.top)||0,o=parseFloat(e.right)||0;N.style.top=`${n+xa}px`,N.style.right=o-va+"px",N.style.left="auto",N.style.bottom="auto",va=0,xa=0,pa="touchmove"===t.type?t.touches[0].clientX:t.clientX,ya="touchmove"===t.type?t.touches[0].clientY:t.clientY}}function Be(t){fa&&(fa=!1,N.style.cursor="move",pa=ma,ya=ga)}Ee.addEventListener("mousedown",Se),document.addEventListener("mousemove",Me),document.addEventListener("mouseup",Be),Ee.addEventListener("touchstart",Se),document.addEventListener("touchmove",Me),document.addEventListener("touchend",Be)}window.addEventListener("keydown",n=>{const o=n.key.toLowerCase();"r"===o&&(function(){if(e===t.WEIGHTLESS)Eo();else for(let t=0;t<re.length;t++){const e=re[t],n=me();e.x=n.x,e.y=n.y;const o=.5*z.width,a=Bt?wt>=0?1:-1:e.x<o?1:-1,s=de(e.r/(.5*(Et+It)),.6,1.4),i=140*s,l=180*s,r=120;e.vx=a*(i+Math.random()*l),e.vy=-Math.random()*r,e.age=0,e.driftAx=a*(360+420*Math.random())*s,e.driftTime=.22+.28*Math.random()}}(),n.preventDefault()),"/"===o&&N&&(n.preventDefault(),N.classList.toggle("hidden")),"1"===o&&Fo(t.PIT),"2"===o&&Fo(t.FLIES),"3"===o&&Fo(t.WEIGHTLESS),"4"===o&&Fo(t.PULSE_GRID)}),function(t=160){for(let e=0;e<t&&re.length<rt;e++){const t=me();ue(t.x,t.y)}}(200),z.addEventListener("mousemove",n=>{const o=z.getBoundingClientRect();kt=(n.clientX-o.left)*U,Nt=(n.clientY-o.top)*U,e===t.PIT&&zt>0&&Gt>0&&(Ut=!0)}),z.addEventListener("mouseleave",()=>{kt=R,Nt=R});const be=document.getElementById("restitutionSlider"),we=document.getElementById("frictionSlider"),Ce=document.getElementById("emitterSlider"),Le=document.getElementById("sizeSliderGlobal"),Fe=document.getElementById("sizeVariationSliderGlobal"),Pe=(document.getElementById("weightSliderGlobal"),document.getElementById("ballSoftnessSliderGlobal")),Te=document.getElementById("sizeValGlobal"),Ve=document.getElementById("sizeVariationValGlobal"),Re=(document.getElementById("weightValGlobal"),document.getElementById("ballSoftnessValGlobal")),Ae=(document.getElementById("sizeSliderPit"),document.getElementById("sizeVariationSliderPit"),document.getElementById("weightSliderPit"),document.getElementById("ballSoftnessSliderPit"),document.getElementById("sizeValPit"),document.getElementById("sizeVariationValPit"),document.getElementById("weightValPit"),document.getElementById("ballSoftnessValPit"),document.getElementById("sizeSliderFlies"),document.getElementById("sizeVariationSliderFlies"),document.getElementById("weightSliderFlies"),document.getElementById("ballSoftnessSliderFlies"),document.getElementById("sizeValFlies"),document.getElementById("sizeVariationValFlies"),document.getElementById("weightValFlies"),document.getElementById("ballSoftnessValFlies"),document.getElementById("sizeSliderZeroG"),document.getElementById("sizeVariationSliderZeroG"),document.getElementById("weightSliderZeroG"),document.getElementById("ballSoftnessSliderZeroG"),document.getElementById("sizeValZeroG"),document.getElementById("sizeVariationValZeroG"),document.getElementById("weightValZeroG"),document.getElementById("ballSoftnessValZeroG"),document.getElementById("maxBallsSlider")),qe=document.getElementById("spawnYSlider"),Ge=document.getElementById("spawnWidthSlider"),ze=document.getElementById("spawnCenterSlider"),Oe=document.getElementById("spawnHeightSlider"),ke=document.getElementById("repelSizeSlider"),Ne=document.getElementById("repelPowerSlider"),Ue=document.getElementById("repelSoftSlider"),De=document.getElementById("colorSelect"),Ye=document.getElementById("color1"),Xe=document.getElementById("color2"),He=document.getElementById("color3"),We=document.getElementById("color4"),$e=document.getElementById("color5"),je=document.getElementById("color6"),_e=document.getElementById("color7"),Ze=document.getElementById("color8"),Je=document.getElementById("cursorColorSelect"),Qe=document.getElementById("color1Val"),Ke=document.getElementById("color2Val"),tn=document.getElementById("color3Val"),en=document.getElementById("color4Val"),nn=document.getElementById("color5Val"),on=document.getElementById("color6Val"),an=document.getElementById("color7Val"),sn=document.getElementById("color8Val");[Qe,Ke,tn,en,nn,on,an,sn].forEach(t=>{t&&t.setAttribute("title","Click to copy")});const ln=document.getElementById("cornerRadiusSlider"),rn=document.getElementById("cornerRadiusVal"),dn=document.getElementById("trailFadeSlider"),hn=document.getElementById("trailFadeVal"),un=document.getElementById("trailSubtletySlider"),cn=document.getElementById("trailSubtletyVal"),mn=document.getElementById("restitutionVal"),gn=document.getElementById("frictionVal"),pn=document.getElementById("emitterVal"),yn=document.getElementById("maxBallsVal"),fn=document.getElementById("spawnYVal"),vn=document.getElementById("spawnWidthVal"),xn=document.getElementById("spawnCenterVal"),En=document.getElementById("spawnHeightVal"),In=document.getElementById("repelSizeVal"),Sn=document.getElementById("repelPowerVal"),Mn=document.getElementById("repelSoftVal");function Bn(){return{gravityMultiplier:ot,restitution:st,friction:it,ballMass:yt,emitRate:lt,maxBalls:rt,ballScale:ct,ballVariation:mt,spawnX:J,spawnY:Q,spawnWidth:K,spawnHeight:tt,sweepEnabled:Bt,repelRadius:Gt,repelPower:zt,repelSoftness:Ot,trailFade:Zt,trailSubtlety:Jt,colors:Ft.slice(),colorWeights:At.slice(),currentTemplate:Lt,cursorColorIndex:Pt,performanceMode:Y,targetFPS:X,enableLOD:!0}}const bn=document.getElementById("saveConfigBtn"),wn=document.getElementById("buildBtn"),Cn=document.getElementById("configOutput");function Ln(t,e){t&&t.addEventListener("click",async()=>{const n="function"==typeof e?e():String(e||"").trim();try{await navigator.clipboard.writeText(n);const e=t.textContent;t.textContent="COPIED",t.style.color="#3ddc84",setTimeout(()=>{t.textContent=e,t.style.color="#888"},900)}catch(t){console.warn("Clipboard unavailable")}})}bn&&wn&&Cn&&(bn.addEventListener("click",()=>{const t=(e=Bn(),`// Generated configuration from frontend\nconst CONFIG = ${JSON.stringify(e,null,2)};`);var e;Cn.style.display="block",Cn.textContent=t,navigator.clipboard.writeText(t).then(()=>{const t=bn.textContent;bn.textContent="‚úÖ Copied!",setTimeout(()=>{bn.textContent=t},1200)}).catch(()=>{console.warn("Clipboard copy failed");const t=bn.textContent;bn.textContent="‚ö†Ô∏è Copy failed",setTimeout(()=>{bn.textContent=t},1200)})}),wn.addEventListener("click",()=>{const t=Bn();Cn.style.display="block",Cn.innerHTML="\n<strong>üöÄ Build Instructions:</strong><br>\n1. Run: <code>npm run build</code><br>\n2. Your current config will be baked into <code>public/js/bouncy-balls-embed.js</code>";const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download="current-config.json",o.click(),URL.revokeObjectURL(n)})),be&&be.addEventListener("input",()=>{st=parseFloat(be.value),mn&&(mn.textContent=st.toFixed(2)),Ht()}),we&&we.addEventListener("input",()=>{it=parseFloat(we.value),gn&&(gn.textContent=it.toFixed(4)),Ht()}),Ce&&Ce.addEventListener("input",()=>{lt=parseFloat(Ce.value),pn&&(pn.textContent=lt.toFixed(3)),Ht()}),function(t){if(!t)return;const{size:e,sizeVal:o,sizeVar:a,sizeVarVal:s,soft:i,softVal:l}=t;e&&e.addEventListener("input",()=>{const t=parseFloat(e.value);o&&(o.textContent=t.toFixed(1)),ct=t,St();for(let t=0;t<re.length;t++)re[t].m=yt;Ht()}),a&&a.addEventListener("input",()=>{const t=parseFloat(a.value);s&&(s.textContent=t.toFixed(1)),mt=t,Ht()}),i&&i.addEventListener("input",()=>{const t=parseInt(i.value,10);l&&(l.textContent=String(t)),n=t,Ht()})}({size:Le,sizeVal:Te,sizeVar:Fe,sizeVarVal:Ve,soft:Pe,softVal:Re}),Ae&&Ae.addEventListener("input",()=>{rt=parseInt(Ae.value,10),yn&&(yn.textContent=rt.toString()),re.length>rt&&(re.length=rt)}),Fe&&Fe.addEventListener("input",()=>{mt=parseFloat(Fe.value),Ve&&(Ve.textContent=mt.toFixed(1)),Tn()});const Fn=document.getElementById("weightPitSlider"),Pn=document.getElementById("weightPitVal");function Tn(){const t=(Et+It)/2;for(let e=0;e<re.length;e++){const n=re[e];if(0===mt)n.r=t;else{const e=.1*t,o=Math.max(1,t-e),a=t+e;n.r=he(o,a)}n.m=yt}}document.getElementById("weightWeightlessSlider"),document.getElementById("weightWeightlessVal"),qe&&qe.addEventListener("input",()=>{Q=parseFloat(qe.value),fn&&(fn.textContent=Q.toFixed(0)),et()}),Ge&&Ge.addEventListener("input",()=>{K=parseFloat(Ge.value),vn&&(vn.textContent=K.toFixed(0))}),ze&&ze.addEventListener("input",()=>{J=parseFloat(ze.value),xn&&(xn.textContent=J.toFixed(0))}),Oe&&Oe.addEventListener("input",()=>{tt=parseFloat(Oe.value),En&&(En.textContent=tt.toFixed(0))}),ke&&ke.addEventListener("input",()=>{Gt=parseFloat(ke.value),In&&(In.textContent=Gt.toFixed(0)),Ut=Ut||zt>0&&Gt>0}),Ne&&Ne.addEventListener("input",()=>{zt=function(t){const e=Math.max(0,Math.min(Wt,Number(t)))/Wt;return 2*Math.pow(2,12*(e-.5))*12e3}(Ne.value),Sn&&(Sn.textContent=Math.round(zt).toString()),la&&"off"!==la.value&&(Ut=zt>0&&Gt>0)}),Ue&&Ue.addEventListener("input",()=>{Ot=parseFloat(Ue.value),Mn&&(Mn.textContent=Ot.toFixed(1))});const Vn=document.getElementById("performanceModeToggle");document.getElementById("performanceModeStatus"),Vn&&Vn.addEventListener("change",()=>{!function(){Y=!Y,X=Y?120:60;const t=Y?_.performance:_.normal;Y?(console.log("‚ö° PERFORMANCE MODE: Optimizing for 120 FPS..."),re.length>t.maxBalls&&(re.length=t.maxBalls,console.log(`‚ö° Reduced balls to ${t.maxBalls} for 120 FPS`)),rt=t.maxBalls,se=t.collisionIters):(console.log("üé® NORMAL MODE: Restoring visual quality..."),rt=t.maxBalls,se=t.collisionIters),function(){const t=document.getElementById("performanceModeToggle"),e=document.getElementById("performanceModeStatus"),n=document.getElementById("maxBallsSlider"),o=document.getElementById("maxBallsVal");t&&(t.checked=Y),e&&(Y?(e.textContent=`‚ö° 120 FPS Mode Active (${re.length} balls)`,e.style.background="rgba(255,165,0,0.3)"):(e.textContent=`üé® Normal Mode (${re.length} balls)`,e.style.background="rgba(0,0,0,0.2)")),n&&o&&(n.value=rt,o.textContent=rt.toString())}(),console.log(`üéØ Target FPS: ${X}, Mode: ${Y?"PERFORMANCE":"NORMAL"}`)}()});const Rn=document.getElementById("darkModeToggle");document.getElementById("darkModeStatus"),Rn&&Rn.addEventListener("change",()=>{H=!H,H?(j(),console.log("üåô Auto Dark Mode: ENABLED")):($(!1),console.log("‚òÄÔ∏è Auto Dark Mode: DISABLED")),Ht()});const An=document.getElementById("canvasShadowEnabled"),qn=document.getElementById("shadowOffsetX"),Gn=document.getElementById("shadowOffsetXVal"),zn=document.getElementById("shadowOffsetY"),On=document.getElementById("shadowOffsetYVal"),kn=document.getElementById("shadowBlur"),Nn=document.getElementById("shadowBlurVal"),Un=document.getElementById("shadowOpacity"),Dn=document.getElementById("shadowOpacityVal"),Yn=document.getElementById("shadowColor"),Xn=document.getElementById("shadowColorVal"),Hn=document.getElementById("shadow2Enabled"),Wn=document.getElementById("shadow2Blur"),$n=document.getElementById("shadow2BlurVal"),jn=document.getElementById("shadow2Opacity"),_n=document.getElementById("shadow2OpacityVal");An&&An.addEventListener("change",()=>{B=An.checked,D(),Ht()}),qn&&qn.addEventListener("input",()=>{b=parseInt(qn.value,10),Gn&&(Gn.textContent=b.toString()),D(),Ht()}),zn&&zn.addEventListener("input",()=>{w=parseInt(zn.value,10),On&&(On.textContent=w.toString()),D(),Ht()}),kn&&kn.addEventListener("input",()=>{C=parseInt(kn.value,10),Nn&&(Nn.textContent=C.toString()),D(),Ht()}),Un&&Un.addEventListener("input",()=>{L=parseFloat(Un.value),Dn&&(Dn.textContent=L.toFixed(2)),D(),Ht()}),Yn&&Yn.addEventListener("input",()=>{F=Yn.value,Xn&&(Xn.textContent=F.toUpperCase()),D(),Ht()}),Hn&&Hn.addEventListener("change",()=>{P=Hn.checked,D(),Ht()}),Wn&&Wn.addEventListener("input",()=>{T=parseInt(Wn.value,10),$n&&($n.textContent=T.toString()),D(),Ht()}),jn&&jn.addEventListener("input",()=>{V=parseFloat(jn.value),_n&&(_n.textContent=V.toFixed(2)),D(),Ht()}),z.addEventListener("mousemove",t=>{const e=z.getBoundingClientRect();kt=(t.clientX-e.left)*U,Nt=(t.clientY-e.top)*U}),z.addEventListener("mouseleave",()=>{kt=R,Nt=R}),De&&De.addEventListener("change",()=>{Vt(De.value)});const Zn=Array.from(document.querySelectorAll(".mode-button")),Jn=document.getElementById("pitControls"),Qn=document.getElementById("fliesControls"),Kn=document.getElementById("weightlessControls"),to=document.getElementById("gravityPitSlider"),eo=document.getElementById("gravityPitVal"),no=document.getElementById("repellerEnabledPit"),oo=document.getElementById("attractPowerSlider"),ao=document.getElementById("attractPowerVal"),so=document.getElementById("orbitRadiusSlider"),io=document.getElementById("orbitRadiusVal"),lo=document.getElementById("swarmSpeedSlider"),ro=document.getElementById("swarmSpeedVal"),ho=document.getElementById("weightlessCountSlider"),uo=document.getElementById("weightlessCountVal"),co=document.getElementById("weightlessSpeedSlider"),mo=document.getElementById("weightlessSpeedVal"),go=document.getElementById("weightlessBounceSlider"),po=document.getElementById("weightlessBounceVal"),yo=document.getElementById("weightlessRepelSlider"),fo=document.getElementById("weightlessRepelVal"),vo=document.getElementById("weightlessRepelRadiusSlider"),xo=document.getElementById("weightlessRepelRadiusVal");function Eo(){re.length=0;const t=r,e=z.width,n=z.height,o=40*U;for(let a=0;a<t;a++){const t=ue(o+Math.random()*(e-2*o),o+Math.random()*(n-2*o)),a=Math.random()*Math.PI*2,s=d*(.7+.3*Math.random());t.vx=Math.cos(a)*s,t.vy=Math.sin(a)*s,t.driftAx=0,t.driftTime=0}}let Io=0,So=0,Mo=0,Bo=0,bo=0;function wo(){const t=z.width,e=z.height;Mo=m,Io=t/Mo,So=Math.floor(e/Io),Bo=(t-Mo*Io)/2,bo=(e-So*Io)/2}function Co(t,e){return{x:Bo+(t+.5)*Io,y:bo+(e+.5)*Io}}function Lo(){re.length=0,wo();const t=Mo*So,e=Math.min(E,t),n=[];for(let t=0;t<So;t++)for(let e=0;e<Mo;e++)n.push({gridX:e,gridY:t});for(let t=n.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[n[t],n[e]]=[n[e],n[t]]}for(let t=0;t<e;t++){const e=n[t],o=Co(e.gridX,e.gridY),a=ue(o.x,o.y);a.gridX=e.gridX,a.gridY=e.gridY,a.targetX=o.x,a.targetY=o.y,a.jumpProgress=1,a.vx=0,a.vy=0,a.driftAx=0,a.driftTime=0;const s=g,i=y*Math.random()*s;a.nextJumpTime=s+i}}function Fo(n){e=n,function(t){const e=document.getElementById("announcer");e&&(e.textContent="",setTimeout(()=>e.textContent=t,100))}(`Switched to ${{[t.PIT]:"Ball Pit",[t.FLIES]:"Flies to Light",[t.WEIGHTLESS]:"Zero Gravity",[t.PULSE_GRID]:"Pulse Grid"}[n]} mode`),O.className="",e===t.PIT&&O.classList.add("mode-pit"),et(),e===t.PIT?(ot=o,at=nt*ot,Ut=a&&zt>0&&Gt>0,Bt=!0,re.length=0,ce=0,xe()):e===t.FLIES?(ot=0,at=nt*ot,Ut=!1,Bt=!1,function(){re.length=0;const t=.5*z.width,e=.5*z.height,n=150*U;for(let o=0;o<60;o++){const o=Math.random()*Math.PI*2,a=Math.random()*n,s=ue(t+Math.cos(o)*a,e+Math.sin(o)*a),i=.5+.5*Math.random(),l=Math.random()*Math.PI*2,r=300*i;s.vx=Math.cos(l)*r,s.vy=Math.sin(l)*r,s.driftAx=0,s.driftTime=0}}(),xe()):e===t.WEIGHTLESS?(ot=0,at=nt*ot,Ut=!1,Bt=!1,Eo(),xe()):e===t.PULSE_GRID&&(ot=0,at=nt*ot,Ut=!1,Bt=!1,Lo(),xe()),function(){const n=document.getElementById("pulseGridControls");Jn&&Jn.classList.toggle("active",e===t.PIT),Qn&&Qn.classList.toggle("active",e===t.FLIES),Kn&&Kn.classList.toggle("active",e===t.WEIGHTLESS),n&&n.classList.toggle("active",e===t.PULSE_GRID),Zn.forEach(t=>{const n=t.getAttribute("data-mode")===e;t.classList.toggle("active",n),t.setAttribute("aria-pressed",n?"true":"false")})}()}Zn.forEach(t=>t.addEventListener("click",()=>{Fo(t.getAttribute("data-mode")),Ht()})),to&&to.addEventListener("input",()=>{o=parseFloat(to.value),eo&&(eo.textContent=o.toFixed(1)),Ht(),e===t.PIT&&(ot=o,at=nt*ot)}),Fn&&Fn.addEventListener("input",()=>{yt=parseFloat(Fn.value),Pn&&(Pn.textContent=yt.toFixed(2));for(let t=0;t<re.length;t++)re[t].m=yt;xt(),Ht()}),no&&no.addEventListener("change",()=>{a=!!no.checked,e===t.PIT&&(Ut=a&&zt>0&&Gt>0)}),oo&&oo.addEventListener("input",()=>{s=parseFloat(oo.value),ao&&(ao.textContent=Math.round(s).toString())}),so&&so.addEventListener("input",()=>{i=parseFloat(so.value),io&&(io.textContent=Math.round(i).toString())}),lo&&lo.addEventListener("input",()=>{l=parseFloat(lo.value),ro&&(ro.textContent=l.toFixed(1))}),ho&&ho.addEventListener("input",()=>{r=parseInt(ho.value,10),uo&&(uo.textContent=r.toString()),e===t.WEIGHTLESS&&Eo()}),co&&co.addEventListener("input",()=>{d=parseFloat(co.value),mo&&(mo.textContent=Math.round(d).toString())}),go&&go.addEventListener("input",()=>{h=parseFloat(go.value),po&&(po.textContent=h.toFixed(2))}),yo&&yo.addEventListener("input",()=>{u=parseFloat(yo.value),fo&&(fo.textContent=Math.round(u).toString()),Ht()}),vo&&vo.addEventListener("input",()=>{c=parseFloat(vo.value),xo&&(xo.textContent=Math.round(c).toString()),Ht()});const Po=document.getElementById("gridPresetSelect"),To=document.getElementById("gridBallCountSlider"),Vo=document.getElementById("gridBallCountVal"),Ro=document.getElementById("gridColumnsSlider"),Ao=document.getElementById("gridColumnsVal"),qo=document.getElementById("pulseIntervalSlider"),Go=document.getElementById("pulseIntervalVal"),zo=document.getElementById("pulseSpeedSlider"),Oo=document.getElementById("pulseSpeedVal"),ko=document.getElementById("pulseMinStepsSlider"),No=document.getElementById("pulseMinStepsVal"),Uo=document.getElementById("pulseMaxStepsSlider"),Do=document.getElementById("pulseMaxStepsVal"),Yo=document.getElementById("pulseSynchronicitySlider"),Xo=document.getElementById("pulseSynchronicityVal"),Ho=document.getElementById("pulseRandomnessSlider"),Wo=document.getElementById("pulseRandomnessVal"),$o={synchronized:{interval:.6,speed:.2,minSteps:1,maxSteps:2,synchronicity:.1,randomness:.2,easingStyle:"snap",overshoot:1.12,bounce:.18},organic:{interval:.8,speed:.25,minSteps:1,maxSteps:3,synchronicity:.3,randomness:.4,easingStyle:"smooth",overshoot:1.05,bounce:.1},chaotic:{interval:.4,speed:.15,minSteps:2,maxSteps:4,synchronicity:.7,randomness:.8,easingStyle:"bounce",overshoot:1.15,bounce:.25}};Po&&Po.addEventListener("change",()=>{!function(n){const o=$o[n];if(!o)return;g=o.interval,p=o.speed,v=o.minSteps,x=o.maxSteps,y=o.synchronicity,f=o.randomness,S=o.easingStyle,M=o.overshoot,I=o.bounce,qo&&(qo.value=o.interval),Go&&(Go.textContent=o.interval.toFixed(1)),zo&&(zo.value=o.speed),Oo&&(Oo.textContent=o.speed.toFixed(2)),ko&&(ko.value=o.minSteps),No&&(No.textContent=o.minSteps.toString()),Uo&&(Uo.value=o.maxSteps),Do&&(Do.textContent=o.maxSteps.toString()),Yo&&(Yo.value=o.synchronicity),Xo&&(Xo.textContent=o.synchronicity.toFixed(2)),Ho&&(Ho.value=o.randomness),Wo&&(Wo.textContent=o.randomness.toFixed(2));const a=document.getElementById("pulseEasingSelect"),s=document.getElementById("pulseOvershootSlider"),i=document.getElementById("pulseOvershootVal"),l=document.getElementById("pulseBounceSlider"),r=document.getElementById("pulseBounceVal");a&&(a.value=o.easingStyle),s&&(s.value=o.overshoot),i&&(i.textContent=o.overshoot.toFixed(2)),l&&(l.value=o.bounce),r&&(r.textContent=o.bounce.toFixed(2)),e===t.PULSE_GRID&&Lo()}(Po.value),Ht()}),To&&To.addEventListener("input",()=>{E=parseInt(To.value,10),Vo&&(Vo.textContent=E.toString()),e===t.PULSE_GRID&&Lo(),Ht()}),Ro&&Ro.addEventListener("input",()=>{m=parseInt(Ro.value,10),Ao&&(Ao.textContent=m.toString()),e===t.PULSE_GRID&&(wo(),Lo()),Ht()}),qo&&qo.addEventListener("input",()=>{g=parseFloat(qo.value),Go&&(Go.textContent=g.toFixed(1)),Ht()}),zo&&zo.addEventListener("input",()=>{p=parseFloat(zo.value),Oo&&(Oo.textContent=p.toFixed(2)),Ht()}),ko&&ko.addEventListener("input",()=>{v=parseInt(ko.value,10),No&&(No.textContent=v.toString()),v>x&&(x=v,Uo&&(Uo.value=v),Do&&(Do.textContent=v.toString())),Ht()}),Uo&&Uo.addEventListener("input",()=>{x=parseInt(Uo.value,10),Do&&(Do.textContent=x.toString()),x<v&&(v=x,ko&&(ko.value=x),No&&(No.textContent=x.toString())),Ht()}),Yo&&Yo.addEventListener("input",()=>{y=parseFloat(Yo.value),Xo&&(Xo.textContent=y.toFixed(2)),Ht()}),Ho&&Ho.addEventListener("input",()=>{f=parseFloat(Ho.value),Wo&&(Wo.textContent=f.toFixed(2)),Ht()});const jo=document.getElementById("pulseEasingSelect"),_o=document.getElementById("pulseOvershootSlider"),Zo=document.getElementById("pulseOvershootVal"),Jo=document.getElementById("pulseBounceSlider"),Qo=document.getElementById("pulseBounceVal");function Ko(){for(let t=0;t<re.length;t++)re[t].color=qt()}function ta(){const t=document.getElementById("color1"),e=document.getElementById("color2"),n=document.getElementById("color3"),o=document.getElementById("color4"),a=document.getElementById("color5"),s=document.getElementById("color6"),i=document.getElementById("color7"),l=document.getElementById("color8"),r=document.getElementById("color1Val"),d=document.getElementById("color2Val"),h=document.getElementById("color3Val"),u=document.getElementById("color4Val"),c=document.getElementById("color5Val"),m=document.getElementById("color6Val"),g=document.getElementById("color7Val"),p=document.getElementById("color8Val");t&&r&&(t.value=Ft[0],r.textContent=Ft[0].toUpperCase()),e&&d&&(e.value=Ft[1],d.textContent=Ft[1].toUpperCase()),n&&h&&(n.value=Ft[2],h.textContent=Ft[2].toUpperCase()),o&&u&&(o.value=Ft[3],u.textContent=Ft[3].toUpperCase()),a&&c&&(a.value=Ft[4],c.textContent=Ft[4].toUpperCase()),s&&m&&(s.value=Ft[5],m.textContent=Ft[5].toUpperCase()),i&&g&&(i.value=Ft[6],g.textContent=Ft[6].toUpperCase()),l&&p&&(l.value=Ft[7],p.textContent=Ft[7].toUpperCase())}jo&&jo.addEventListener("change",()=>{S=jo.value,Ht()}),_o&&_o.addEventListener("input",()=>{M=parseFloat(_o.value),Zo&&(Zo.textContent=M.toFixed(2)),Ht()}),Jo&&Jo.addEventListener("input",()=>{I=parseFloat(Jo.value),Qo&&(Qo.textContent=I.toFixed(2)),Ht()}),Ye&&Ye.addEventListener("input",()=>{Ft[0]=Ye.value,Qe&&(Qe.textContent=Ye.value.toUpperCase()),Ko(),Rt()}),Xe&&Xe.addEventListener("input",()=>{Ft[1]=Xe.value,Ke&&(Ke.textContent=Xe.value.toUpperCase()),Ko(),Rt()}),He&&He.addEventListener("input",()=>{Ft[2]=He.value,tn&&(tn.textContent=He.value.toUpperCase()),Ko(),Rt()}),We&&We.addEventListener("input",()=>{Ft[3]=We.value,en&&(en.textContent=We.value.toUpperCase()),Ko(),Rt()}),$e&&$e.addEventListener("input",()=>{Ft[4]=$e.value,nn&&(nn.textContent=$e.value.toUpperCase()),Ko(),Rt()}),je&&je.addEventListener("input",()=>{Ft[5]=je.value,on&&(on.textContent=je.value.toUpperCase()),Ko(),Rt()}),_e&&_e.addEventListener("input",()=>{Ft[6]=_e.value,an&&(an.textContent=_e.value.toUpperCase()),Ko(),Rt()}),Ze&&Ze.addEventListener("input",()=>{Ft[7]=Ze.value,sn&&(sn.textContent=Ze.value.toUpperCase()),Ko(),Rt()}),Je&&Je.addEventListener("change",()=>{const t=Math.max(1,Math.min(8,parseInt(Je.value,10)))-1;Pt=t,Tt=Ft[Pt]||Tt,Ht()}),Ln(Qe,()=>Ye.value.toUpperCase()),Ln(Ke,()=>Xe.value.toUpperCase()),Ln(tn,()=>He.value.toUpperCase()),Ln(en,()=>We.value.toUpperCase()),Ln(nn,()=>$e.value.toUpperCase()),Ln(on,()=>je.value.toUpperCase()),Ln(an,()=>_e.value.toUpperCase()),Ln(sn,()=>Ze.value.toUpperCase()),ln&&ln.addEventListener("input",()=>{$t=parseFloat(ln.value),rn&&(rn.textContent=$t.toFixed(0))}),dn&&dn.addEventListener("input",()=>{Zt=parseFloat(dn.value),hn&&(hn.textContent=Zt.toFixed(3))}),un&&un.addEventListener("input",()=>{Jt=parseFloat(un.value),cn&&(cn.textContent=Jt.toFixed(2)+"√ó")});const ea={rubberPlayground:{label:"Rubber ‚Äì Playground",G:1960,REST:.9,FRICTION:.0025,sizeScale:1.8,maxBalls:450,sizeVariation:.2},rubberRacquet:{label:"Rubber ‚Äì Racquetball",G:3320,REST:.97,FRICTION:.0035,sizeScale:.7,maxBalls:350,sizeVariation:.3},rubberSuperball:{label:"Rubber ‚Äì Superball",G:1960,REST:.95,FRICTION:.0015,sizeScale:1.2,maxBalls:450,sizeVariation:.05},rubberSoft:{label:"Rubber ‚Äì Soft",G:1960,REST:.86,FRICTION:.0035,sizeScale:2.2,maxBalls:350,sizeVariation:.25},rubberHeavy:{label:"Rubber ‚Äì Heavy",G:1960,REST:.88,FRICTION:.003,sizeScale:2,maxBalls:400,sizeVariation:.15}},na={fullRain:{label:"Full Rain (top-half)",EMIT_INTERVAL:.03,xCenter:50,y:-50,w:100,h:50},narrowStrip:{label:"Narrow Strip Top",EMIT_INTERVAL:.05,xCenter:50,y:-40,w:20,h:10},leftGutter:{label:"Left Gutter",EMIT_INTERVAL:.045,xCenter:10,y:-60,w:18,h:20},rightGutter:{label:"Right Gutter",EMIT_INTERVAL:.045,xCenter:90,y:-60,w:18,h:20},centerFountain:{label:"Center Fountain",EMIT_INTERVAL:.02,xCenter:50,y:-30,w:30,h:20},stormBurst:{label:"Storm Burst",EMIT_INTERVAL:.005,xCenter:50,y:-80,w:100,h:30},slowSnow:{label:"Slow Snow",EMIT_INTERVAL:.2,xCenter:50,y:-30,w:100,h:20},edgeDrizzle:{label:"Edge Drizzle",EMIT_INTERVAL:.08,xCenter:15,y:-40,w:30,h:15},twinColumns:{label:"Twin Columns",EMIT_INTERVAL:.03,xCenter:30,y:-50,w:10,h:40},focusedBeam:{label:"Focused Beam",EMIT_INTERVAL:.015,xCenter:50,y:-70,w:6,h:12}},oa={off:{label:"Off",r:710,p:274e3,s:4.4},gentle:{label:"Gentle Breeze",r:120,p:2500,s:2.5},pushField:{label:"Push Field",r:240,p:8e4,s:2},tractor:{label:"Tractor Push",r:320,p:14e4,s:1.6},magnet:{label:"Magnet Repel",r:200,p:18e4,s:3},pulse:{label:"Pulse Strong",r:280,p:22e4,s:1.2},wideSoft:{label:"Wide Soft",r:500,p:8e4,s:4.5},needle:{label:"Needle Point",r:80,p:26e4,s:.8},wall:{label:"Invisible Wall",r:700,p:16e4,s:5},singularity:{label:"Singularity",r:600,p:3e5,s:.5}};function aa(t,e,n){t.innerHTML="";for(const[o,a]of Object.entries(e)){const e=document.createElement("option");e.value=o,e.textContent=a.label||o,o===n&&(e.selected=!0),t.appendChild(e)}}const sa=document.getElementById("physicsSelect"),ia=document.getElementById("spawnSelect"),la=document.getElementById("repellerSelect");function ra(t,e,n,o=0){t&&(t.value=String(n)),e&&(e.textContent=o>0?n.toFixed(o):n.toString())}function da(t){const e=ea[t];if(!e)return;st=e.REST,it=e.FRICTION,rt=e.maxBalls,mt=e.sizeVariation;const n=e.sizeScale;ct=n,St();for(let t=0;t<re.length;t++)re[t].m=yt;re.length>rt&&(re.length=rt),ra(be,mn,st,2),ra(we,gn,it,4),ra(Le,Te,ct,1),ra(Ae,yn,rt,0),ra(Fe,Ve,mt,1),Tn()}function ha(t){const e=na[t];e&&(lt=e.EMIT_INTERVAL,J=e.xCenter,Q=e.y,K=e.w,tt=e.h,ra(Ce,pn,lt,3),ra(ze,xn,J,0),ra(qe,fn,Q,0),ra(Ge,vn,K,0),ra(Oe,En,tt,0))}function ua(t){const e=oa[t];if(!e)return;Gt=e.r,zt=1*e.p,Ut="off"!==t,ra(ke,In,Gt,0);const n=function(t){const e=Math.max(1,Number(t))/24e3,n=.5+Math.log2(e)/12;return Math.round(Math.max(0,Math.min(1,n))*Wt)}(zt);Ne&&(Ne.value=String(n)),Sn&&(Sn.textContent=Math.round(zt).toString()),ra(Ue,Mn,Ot,1)}sa&&aa(sa,ea,"rubberRacquet"),ia&&aa(ia,na,"fullRain"),la&&aa(la,oa,"off"),De&&aa(De,Ct,"industrialTeal"),da("rubberRacquet"),ha("fullRain"),ua("off"),ta(),Rt(),sa&&sa.addEventListener("change",()=>da(sa.value)),ia&&ia.addEventListener("change",()=>ha(ia.value)),la&&la.addEventListener("change",()=>ua(la.value)),St(),Mt(),function(){try{const t=localStorage.getItem(Yt);if(t){const n=JSON.parse(t);return n.currentMode&&(e=n.currentMode),void 0!==n.gravityMultiplierPit&&(o=n.gravityMultiplierPit),void 0!==n.repellerEnabledPit&&(a=n.repellerEnabledPit),n.attractionPower&&(s=n.attractionPower),n.orbitRadius&&(i=n.orbitRadius),n.swarmSpeed&&(l=n.swarmSpeed),n.weightlessInitialSpeed&&(d=n.weightlessInitialSpeed),n.weightlessBounce&&(h=n.weightlessBounce),n.weightlessCount&&(r=n.weightlessCount),void 0!==n.weightlessRepellerPower&&(u=n.weightlessRepellerPower),void 0!==n.weightlessRepellerRadius&&(c=n.weightlessRepellerRadius),n.restitution&&(st=n.restitution),void 0!==n.friction&&(it=n.friction),n.sizeScale&&(ct=n.sizeScale),void 0!==n.sizeVariation&&(mt=n.sizeVariation),n.ballMassKg&&(yt=n.ballMassKg),n.repelPower&&(zt=n.repelPower),n.repelRadius&&(Gt=n.repelRadius),n.repelSoft&&(Ot=n.repelSoft),void 0!==n.cornerRadius&&($t=n.cornerRadius),void 0!==n.motionBlur&&(trailFade=n.motionBlur),n.trailSubtlety&&(Jt=n.trailSubtlety),n.currentTemplate&&(Lt=n.currentTemplate),n.cursorBallColor&&(Tt=n.cursorBallColor),void 0!==n.gridColumns&&(m=n.gridColumns),void 0!==n.gridBallCount&&(E=n.gridBallCount),void 0!==n.pulseInterval&&(g=n.pulseInterval),void 0!==n.pulseSpeed&&(p=n.pulseSpeed),void 0!==n.pulseSynchronicity&&(y=n.pulseSynchronicity),void 0!==n.pulseRandomness&&(f=n.pulseRandomness),void 0!==n.pulseMinSteps&&(v=n.pulseMinSteps),void 0!==n.pulseMaxSteps&&(x=n.pulseMaxSteps),n.pulseEasingStyle&&(S=n.pulseEasingStyle),void 0!==n.pulseOvershoot&&(M=n.pulseOvershoot),void 0!==n.pulseBounceIntensity&&(I=n.pulseBounceIntensity),void 0!==n.canvasShadowEnabled&&(B=n.canvasShadowEnabled),void 0!==n.shadowOffsetX&&(b=n.shadowOffsetX),void 0!==n.shadowOffsetY&&(w=n.shadowOffsetY),void 0!==n.shadowBlur&&(C=n.shadowBlur),void 0!==n.shadowOpacity&&(L=n.shadowOpacity),n.shadowColor&&(F=n.shadowColor),void 0!==n.shadow2Enabled&&(P=n.shadow2Enabled),void 0!==n.shadow2Blur&&(T=n.shadow2Blur),void 0!==n.shadow2Opacity&&(V=n.shadow2Opacity),void 0!==n.autoDarkModeEnabled&&(H=n.autoDarkModeEnabled),console.log("‚úì Settings loaded"),!0}}catch(t){console.warn("Could not load settings:",t)}}(),D(),j(),setInterval(j,6e4);{const Ea=Object.values(t),Ia=Ea[Math.floor(Math.random()*Ea.length)];e=Ia,console.log(`üé≤ Random mode selected: ${Ia}`)}Fo(e),window.addEventListener("beforeunload",Xt)})();
//# sourceMappingURL=bouncy-balls-embed.js.map