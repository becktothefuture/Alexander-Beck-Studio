// Bouncy Balls Simulation - Minified with Terser
(()=>{function t(){return 0===V?0:ft*(V/40)}function e(t){wt=t,t?xt.classList.add("dark-mode"):xt.classList.remove("dark-mode"),l(ne),function(){const t=document.getElementById("darkModeToggle"),e=document.getElementById("darkModeStatus");if(t&&(t.checked=Bt),e){const t=new Date,n=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`;wt?(e.textContent=`🌙 Night Mode (${n})`,e.style.background="rgba(100,100,255,0.3)"):(e.textContent=`☀️ Day Mode (${n})`,e.style.background="rgba(255,200,0,0.3)")}}()}function n(){Bt&&e(function(){const t=new Date,e=t.getHours(),n=e>=18||e<6;return console.log(`🌍 Time check: ${e}:${t.getMinutes().toString().padStart(2,"0")} → ${n?"Night":"Day"} (sunset: 18, sunrise: 6)`),n}())}function o(){const t=F===MODES.PIT?ht:ct,e=window.innerHeight*t;if(vt.width=Math.floor(window.innerWidth*St),vt.height=Math.floor(e*St),F===MODES.PULSE_GRID){I();for(let t=0;t<Pe.length;t++){const e=Pe[t];e.gridX=Math.max(0,Math.min(xo-1,e.gridX)),e.gridY=Math.max(0,Math.min(vo-1,e.gridY));const n=S(e.gridX,e.gridY);e.x=n.x,e.y=n.y,e.targetX=n.x,e.targetY=n.y}}}function i(){_t=Math.max(.5,Math.min(3,Math.pow(Wt/1,.35)))}function s(){Ht=(vt.clientWidth||window.innerWidth)<=768?.4:1;const t=Yt*Ht;if(null===$t)return $t=t,Zt=Dt*t,void(Jt=Ut*t);const e=t/$t;if(1!==e){for(let t=0;t<Pe.length;t++)Pe[t].r*=e;$t=t}Zt=Dt*t,Jt=Ut*t}function a(){ve=[];const t=document.querySelector(fe);if(!t)return;const e=t.getBoundingClientRect(),n=vt.getBoundingClientRect(),o=function(t){const e=document.createElement("span");e.style.cssText=window.getComputedStyle(t).cssText,e.style.position="absolute",e.style.visibility="hidden",e.style.whiteSpace="nowrap",e.textContent="ABCDEFGHIJKLMNOPQRSTUVWXYZ",document.body.appendChild(e);const n=e.getBoundingClientRect().height;return document.body.removeChild(e),n}(t),i=.5*(e.height-o),s={x:(e.left-n.left)*St,y:(e.top-n.top+i)*St,width:e.width*St,height:o*St};s.width>0&&s.height>0&&s.x<vt.width&&s.y<vt.height&&s.x+s.width>0&&s.y+s.height>0&&ve.push(s)}function l(t){ne=t,oe=function(t){const e=ee[t];return e?wt?e.dark:e.light:ee.industrialTeal.light}(t),se=oe[ie]||se,B(),r(),w()}function r(t=oe){try{const e=document.documentElement,n=(t&&t.length?t:oe).slice(0,8);for(let t=0;t<8;t++){const o=n[t]||"#ffffff";e.style.setProperty(`--ball-${t+1}`,o)}}catch(t){}}function d(){try{if(!oe||0===oe.length)return console.warn("No colors available, using fallback"),"#ffffff";const t=Math.random();let e=0;for(let n=0;n<Math.min(oe.length,ae.length);n++)if(e+=ae[n],t<=e)return oe[n];return oe[Math.min(oe.length-1,7)]}catch(t){return console.error("Error picking random color:",t),"#ffffff"}}function h(){const t={currentMode:F,gravityMultiplierPit:A,repellerEnabledPit:q,attractionPower:z,orbitRadius:G,swarmSpeed:k,weightlessInitialSpeed:O,weightlessBounce:D,weightlessCount:N,weightlessRepellerPower:U,weightlessRepellerRadius:Y,restitution:zt,friction:Gt,sizeScale:Yt,sizeVariation:Xt,ballMassKg:Wt,ballSoftness:V,repelPower:re,repelRadius:le,repelSoft:de,cornerRadius:ye,motionBlur:trailFade,trailSubtlety:Ee,currentTemplate:ne,cursorBallColor:se,gridColumns:X,gridBallCount:J,pulseInterval:H,pulseSpeed:$,pulseSynchronicity:W,pulseRandomness:j,pulseMinSteps:_,pulseMaxSteps:Z,pulseEasingStyle:K,pulseOvershoot:tt,pulseBounceIntensity:Q,canvasShadowEnabled:et,shadowOffsetX:nt,shadowOffsetY:ot,shadowBlur:it,shadowOpacity:st,shadowColor:at,shadow2Enabled:lt,shadow2Blur:rt,shadow2Opacity:dt,autoDarkModeEnabled:Bt};try{localStorage.setItem(ge,JSON.stringify(t)),console.log("✓ Settings saved")}catch(t){console.warn("Could not save settings:",t)}}function c(){clearTimeout(window.settingsSaveTimeout),window.settingsSaveTimeout=setTimeout(h,500)}function u(t,e,n){return Math.max(e,Math.min(n,t))}function m(t,e){return t+Math.random()*(e-t)}function g(t,e,n=d()){const o=(Zt+Jt)/2;let i;if(0===Xt)i=o;else{const t=.1*o;i=m(Math.max(1,o-t),o+t)}const s=new Ball(t,e,i,n),a=.5*vt.width,l=Qt?te>=0?1:-1:t<a?1:-1,r=u(i/(.5*(Zt+Jt)),.6,1.4),h=140*r,c=180*r;return s.vx=l*(h+Math.random()*c),s.vy=120*-Math.random(),s.driftAx=l*(360+420*Math.random())*r,s.driftTime=.22+.28*Math.random(),Pe.push(s),s}function p(){const t=vt.clientWidth,e=vt.clientHeight,n=u(Rt/100*t,0,t);let o=u(Tt/100*t,0,t);if(Qt){const e=.2*t,n=o;o=u(o+Math.sin(Kt)*e,0,t),te=o>=n?1:-1}const i=Math.min(40,.1*n),s=u(o-n/2-i,-i,t),a=u(o+n/2+i,-i,t),l=Pt/100*e,r=l+Ft/100*e,d=Math.random();return{x:(s+(a-s)*(te>0?Math.pow(d,.7):1-Math.pow(1-d,.7)))*St,y:m(l*St,r*St)-(Jt+pt+m(0,10*St))}}function y(e=6){const n=function(){const t=Pe.length;if(t<2)return[];const e=Math.max(1,2*Jt),n=Math.ceil(vt.width/e)+1;Fe.clear();for(let o=0;o<t;o++){const t=Pe[o],i=t.x/e|0,s=(t.y/e|0)*n+i;let a=Fe.get(s);a||(a=[],Fe.set(s,a)),a.push(o)}const o=[];for(const[t,e]of Fe){const i=t/n|0,s=t%n;for(let t=-1;t<=1;t++)for(let a=-1;a<=1;a++){const l=(i+t)*n+(s+a),r=Fe.get(l);if(r)for(let t=0;t<e.length;t++){const n=e[t];for(let t=0;t<r.length;t++){const e=r[t];if(e<=n)continue;const i=Pe[n],s=Pe[e],a=s.x-i.x,l=s.y-i.y,d=i.r+s.r,h=a*a+l*l;if(h<d*d){const t=d-Math.sqrt(Math.max(h,mt));o.push({i:n,j:e,overlap:t})}}}}}return o.sort((t,e)=>e.overlap-t.overlap),o}();for(let o=0;o<e;o++)for(let e=0;e<n.length;e++){const{i:o,j:i}=n[e],s=Pe[o],a=Pe[i],l=a.x-s.x,r=a.y-s.y,d=s.r+a.r,h=l*l+r*r;if(0===h||h>d*d)continue;const c=Math.sqrt(h),u=l/c,m=r/c,g=d-c,p=1/Math.max(s.m,.001),y=1/Math.max(a.m,.001),f=.8*Math.max(g-Ot,0)/(p+y),v=f*u,x=f*m;s.x-=v*p,s.y-=x*p,a.x+=v*y,a.y+=x*y;const E=a.vx-s.vx,I=a.vy-s.vy,S=E*u+I*m;if(S<0){const e=-(1+(Math.abs(S)<30?0:zt))*S/(p+y),n=e*u,o=e*m;s.vx-=n*p,s.vy-=o*p,a.vx+=n*y,a.vy+=o*y;const i=E-S*u,l=I-S*m,r=Math.hypot(i,l);if(r>.001){const t=i*-m+l*u>=0?1:-1,e=yt;s.omega-=t*e*r/Math.max(s.r,1),a.omega+=t*e*r/Math.max(a.r,1)}const d=Math.min(1,Math.abs(S)/(50*(s.r+a.r))),h=Math.min(t(),.8*d);s.squashAmount=Math.max(s.squashAmount,.8*h),s.squashNormalAngle=Math.atan2(-m,-u),a.squashAmount=Math.max(a.squashAmount,.8*h),a.squashNormalAngle=Math.atan2(m,u)}}}function f(){const t=parseFloat(Xe.value);Yt=t,s();const e=(Zt+Jt)/2;for(let t=0;t<Pe.length;t++)if(0===Xt)Pe[t].r=e,Pe[t].rBase=e;else{const n=.1*e,o=Math.max(1,e-n),i=e+n;Pe[t].r=m(o,i),Pe[t].rBase=Pe[t].r}}function v(){return{gravityMultiplier:At,restitution:zt,friction:Gt,ballMass:Wt,emitRate:kt,maxBalls:Nt,ballScale:Yt,ballVariation:Xt,spawnX:Tt,spawnY:Pt,spawnWidth:Rt,spawnHeight:Ft,sweepEnabled:Qt,repelRadius:le,repelPower:re,repelSoftness:de,trailFade:xe,trailSubtlety:Ee,colors:oe.slice(),colorWeights:ae.slice(),currentTemplate:ne,cursorColorIndex:ie,performanceMode:Mt,targetFPS:bt,enableLOD:!0}}function x(t,e){t&&t.addEventListener("click",async()=>{const n="function"==typeof e?e():String(e||"").trim();try{await navigator.clipboard.writeText(n);const e=t.textContent;t.textContent="COPIED",t.style.color="#3ddc84",setTimeout(()=>{t.textContent=e,t.style.color="#888"},900)}catch(t){console.warn("Clipboard unavailable")}})}function E(){Pe.length=0;const t=N,e=vt.width,n=vt.height,o=40*St;for(let i=0;i<t;i++){const t=g(o+Math.random()*(e-2*o),o+Math.random()*(n-2*o)),i=Math.random()*Math.PI*2,s=O*(.7+.3*Math.random());t.vx=Math.cos(i)*s,t.vy=Math.sin(i)*s,t.driftAx=0,t.driftTime=0}}function I(){const t=vt.width,e=vt.height;xo=X,fo=t/xo,vo=Math.floor(e/fo),Eo=(t-xo*fo)/2,Io=(e-vo*fo)/2}function S(t,e){return{x:Eo+(t+.5)*fo,y:Io+(e+.5)*fo}}function M(){Pe.length=0,I();const t=xo*vo,e=Math.min(J,t),n=[];for(let t=0;t<vo;t++)for(let e=0;e<xo;e++)n.push({gridX:e,gridY:t});for(let t=n.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[n[t],n[e]]=[n[e],n[t]]}for(let t=0;t<e;t++){const e=n[t],o=S(e.gridX,e.gridY),i=g(o.x,o.y);i.gridX=e.gridX,i.gridY=e.gridY,i.targetX=o.x,i.targetY=o.y,i.jumpProgress=1,i.vx=0,i.vy=0,i.driftAx=0,i.driftTime=0;const s=H,a=W*Math.random()*s;i.nextJumpTime=s+a}}function b(t){F=t,function(t){const e=document.getElementById("announcer");e&&(e.textContent="",setTimeout(()=>e.textContent=t,100))}(`Switched to ${{[MODES.PIT]:"Ball Pit",[MODES.FLIES]:"Flies to Light",[MODES.WEIGHTLESS]:"Zero Gravity",[MODES.PULSE_GRID]:"Pulse Grid"}[t]} mode`),xt.className="",F===MODES.PIT&&xt.classList.add("mode-pit"),o(),F===MODES.PIT?(At=A,qt=Vt*At,ue=q&&re>0&&le>0,Qt=!0,Pe.length=0,Re=0,f()):F===MODES.FLIES?(At=0,qt=Vt*At,ue=!1,Qt=!1,function(){Pe.length=0;const t=.5*vt.width,e=.5*vt.height,n=150*St;for(let o=0;o<60;o++){const o=Math.random()*Math.PI*2,i=Math.random()*n,s=g(t+Math.cos(o)*i,e+Math.sin(o)*i),a=.5+.5*Math.random(),l=Math.random()*Math.PI*2,r=300*a;s.vx=Math.cos(l)*r,s.vy=Math.sin(l)*r,s.driftAx=0,s.driftTime=0}}(),f()):F===MODES.WEIGHTLESS?(At=0,qt=Vt*At,ue=!1,Qt=!1,E(),f()):F===MODES.PULSE_GRID&&(At=0,qt=Vt*At,ue=!1,Qt=!1,M(),f()),function(){const t=document.getElementById("pulseGridControls");jn&&jn.classList.toggle("active",F===MODES.PIT),_n&&_n.classList.toggle("active",F===MODES.FLIES),Zn&&Zn.classList.toggle("active",F===MODES.WEIGHTLESS),t&&t.classList.toggle("active",F===MODES.PULSE_GRID),Wn.forEach(t=>{const e=t.getAttribute("data-mode")===F;t.classList.toggle("active",e),t.setAttribute("aria-pressed",e?"true":"false")})}()}function B(){for(let t=0;t<Pe.length;t++)Pe[t].color=d()}function w(){const t=document.getElementById("color1"),e=document.getElementById("color2"),n=document.getElementById("color3"),o=document.getElementById("color4"),i=document.getElementById("color5"),s=document.getElementById("color6"),a=document.getElementById("color7"),l=document.getElementById("color8"),r=document.getElementById("color1Val"),d=document.getElementById("color2Val"),h=document.getElementById("color3Val"),c=document.getElementById("color4Val"),u=document.getElementById("color5Val"),m=document.getElementById("color6Val"),g=document.getElementById("color7Val"),p=document.getElementById("color8Val");t&&r&&(t.value=oe[0],r.textContent=oe[0].toUpperCase()),e&&d&&(e.value=oe[1],d.textContent=oe[1].toUpperCase()),n&&h&&(n.value=oe[2],h.textContent=oe[2].toUpperCase()),o&&c&&(o.value=oe[3],c.textContent=oe[3].toUpperCase()),i&&u&&(i.value=oe[4],u.textContent=oe[4].toUpperCase()),s&&m&&(s.value=oe[5],m.textContent=oe[5].toUpperCase()),a&&g&&(a.value=oe[6],g.textContent=oe[6].toUpperCase()),l&&p&&(l.value=oe[7],p.textContent=oe[7].toUpperCase())}function C(t,e,n){t.innerHTML="";for(const[o,i]of Object.entries(e)){const e=document.createElement("option");e.value=o,e.textContent=i.label||o,o===n&&(e.selected=!0),t.appendChild(e)}}function L(t,e,n,o=0){t&&(t.value=String(n)),e&&(e.textContent=o>0?n.toFixed(o):n.toString())}function T(t){const e=Ho[t];if(!e)return;zt=e.REST,Gt=e.FRICTION,Nt=e.maxBalls,Xt=e.sizeVariation;const n=e.sizeScale;Yt=n,s();for(let t=0;t<Pe.length;t++)Pe[t].m=Wt;Pe.length>Nt&&(Pe.length=Nt),L(De,Tn,zt,2),L(Ue,Pn,Gt,4),L(Xe,We,Yt,1),L(Ze,Fn,Nt,0),L(He,je,Xt,1),function(){const t=(Zt+Jt)/2;for(let e=0;e<Pe.length;e++){const n=Pe[e];if(0===Xt)n.r=t;else{const e=.1*t,o=Math.max(1,t-e),i=t+e;n.r=m(o,i)}n.m=Wt}}()}function P(t){const e=$o[t];e&&(kt=e.EMIT_INTERVAL,Tt=e.xCenter,Pt=e.y,Rt=e.w,Ft=e.h,L(Ye,Rn,kt,3),L(Ke,qn,Tt,0),L(Je,Vn,Pt,0),L(Qe,An,Rt,0),L(tn,zn,Ft,0))}function R(t){const e=Wo[t];if(!e)return;le=e.r,re=1*e.p,ue="off"!==t,L(en,Gn,le,0);const n=function(t){const e=Math.max(1,Number(t))/24e3,n=.5+Math.log2(e)/12;return Math.round(Math.max(0,Math.min(1,n))*pe)}(re);nn&&(nn.value=String(n)),kn&&(kn.textContent=Math.round(re).toString()),L(on,Nn,de,1)}const MODES={PIT:"pit",FLIES:"flies",WEIGHTLESS:"weightless",PULSE_GRID:"pulse-grid"};let F=MODES.PIT,V=20,A=1.15,q=!0,z=5e3,G=180,k=3.5,N=80,O=250,D=.97,U=300,Y=150,X=40,H=.8,$=.25,W=.3,j=.4,_=1,Z=3,J=120,Q=.15,K="snap",tt=1.08,et=!1,nt=0,ot=4,it=12,st=.15,at="#000000",lt=!1,rt=4,dt=.1;const ht=1.5,ct=1,ut=-1e9,mt=1e-6,gt=1e-4,pt=2,yt=.18,ft=.2,vt=document.getElementById("c"),xt=document.getElementById("bravia-balls");let Et;try{if(Et=vt.getContext("2d",{alpha:!0}),!Et)throw new Error("Canvas 2D context not available");console.log("✅ Canvas initialized with alpha transparency")}catch(Jo){throw console.error("❌ Failed to initialize canvas:",Jo),xt.innerHTML='\n      <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #1a1a1a; color: white; font-family: system-ui, -apple-system, sans-serif;">\n        <div style="text-align: center; padding: 40px; background: rgba(255,50,50,0.1); border: 2px solid rgba(255,50,50,0.3); border-radius: 12px; max-width: 480px;">\n          <div style="font-size: 72px; margin-bottom: 20px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));">⚠️</div>\n          <h2 style="margin: 0 0 16px 0; font-size: 24px; font-weight: 600;">Canvas Not Supported</h2>\n          <p style="margin: 0 0 12px 0; opacity: 0.9; line-height: 1.6; font-size: 15px;">Your browser doesn\'t support the HTML5 Canvas 2D features required for this interactive simulation.</p>\n          <p style="margin: 0; opacity: 0.7; font-size: 13px;">Please try a modern browser like Chrome, Firefox, Safari, or Edge.</p>\n        </div>\n      </div>\n    ',Jo}const It=document.getElementById("controlPanel"),St=Math.max(1,Math.min(2,window.devicePixelRatio||1));let Mt=!1,bt=60,Bt=!0,wt=!1;const Ct={normal:{maxBalls:350,collisionIters:2,adaptiveQualityMin:.5},performance:{maxBalls:200,collisionIters:1,adaptiveQualityMin:.3}};let Lt,Tt=50,Pt=-50,Rt=100,Ft=50;o(),window.addEventListener("resize",function(){clearTimeout(Lt),Lt=setTimeout(()=>{o(),s(),a()},150)});const Vt=1960;let At=1.1,qt=Vt*At,zt=.88,Gt=.003,kt=.03,Nt=400;const Ot=.5*St,Dt=6,Ut=24;let Yt=1,Xt=.15,Ht=1,$t=null,Wt=11.2;const jt=.15;let _t=1;i();let Zt=Dt*Yt,Jt=Ut*Yt,Qt=!0,Kt=0,te=1;const ee={industrialTeal:{label:"Industrial Teal",light:["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],dark:["#2a2a2a","#1a1a1a","#404040","#00a88f","#e0e0e0","#ff6b47","#3b7de0","#ffc04d"]},sunsetCoral:{label:"Sunset Coral",light:["#bdbbb8","#e8e6e3","#ffffff","#ff3b3b","#000000","#00f5d4","#1e40af","#fb923c"],dark:["#2b2a28","#1c1b1a","#3d3d3d","#ff5c5c","#dddddd","#00ffe7","#4169e1","#ffa866"]},violetPunch:{label:"Violet Punch",light:["#b8b7c2","#e6e5ed","#ffffff","#9333ea","#000000","#dc2626","#0ea5e9","#facc15"],dark:["#2a2832","#1a1921","#3e3d47","#b24dff","#e0e0e0","#ff4444","#00d4ff","#ffe34d"]},citrusBlast:{label:"Citrus Blast",light:["#bfbdb5","#eae8df","#ffffff","#ea580c","#000000","#e11d48","#2563eb","#059669"],dark:["#2c2b27","#1d1c19","#3f3e3a","#ff7733","#dddddd","#ff4466","#4d8aff","#00bf7f"]},cobaltSpark:{label:"Cobalt Spark",light:["#b5b8be","#e3e6eb","#ffffff","#1d4ed8","#000000","#ea580c","#db2777","#d97706"],dark:["#282b30","#191c20","#3d4147","#4d7aff","#dedede","#ff7f3d","#ff4d9e","#ffad33"]}};let ne="industrialTeal",oe=["#b7bcb7","#e4e9e4","#ffffff","#00695c","#000000","#ff4013","#0d5cb6","#ffa000"],ie=5,se=oe[ie]||"#000000";const ae=[.5,.25,.12,.06,.03,.02,.01,.01];let le=255,re=274e3,de=4.4,he=ut,ce=ut,ue=!1,me=!1;("ontouchstart"in window||navigator.maxTouchPoints>0)&&(me=!0);const ge="bouncyBallsSettings",pe=1e4;let ye=0;const fe="#hero-text";let ve=[],xe=.025,Ee=1.8,Ie=0,Se=0,Me=0,be=0,Be=0;const we=document.getElementById("render-fps"),Ce=document.getElementById("physics-fps");let Le=2,Te=0;class Ball{constructor(t,e,n,o){this.x=t,this.y=e,this.vx=200*(2*Math.random()-1),this.vy=200*-Math.random(),this.r=n,this.rBase=n,this.m=Wt,this.color=o,this.t=0,this.age=0,this.driftAx=0,this.driftTime=0,this.omega=0,this.squash=1,this.squashDirX=1,this.squashDirY=0,this.theta=0,this.squashAmount=0,this.squashNormalAngle=0,this.alpha=1}step(t){this.t+=t,this.age+=t,F!==MODES.WEIGHTLESS&&(this.vy+=qt*_t*t);const e=Math.max(.25,this.m/1),n=F===MODES.WEIGHTLESS?1e-4:Gt,o=Math.max(0,1-n/e);this.vx*=o,this.vy*=o,0!==this.driftAx&&this.age<this.driftTime?this.vx+=this.driftAx*t/e:0!==this.driftAx&&(this.driftAx=0),function(t,e){F!==MODES.PIT?F!==MODES.FLIES?F!==MODES.WEIGHTLESS||function(t,e){if(he===ut||ce===ut)return;if(U<=0||Y<=0)return;const n=Y*St,o=t.x-he,i=t.y-ce,s=o*o+i*i;if(s>n*n)return;const a=Math.max(Math.sqrt(s),gt),l=o/a,r=i/a,d=Math.max(0,1-a/n),h=U*d;t.vx+=l*h*e,t.vy+=r*h*e}(t,e):function(t,e){const n=he===ut?.5*vt.width:he,o=ce===ut?.5*vt.height:ce,i=n-t.x,s=o-t.y,a=i*i+s*s,l=Math.sqrt(a+1),r=i/l,d=s/l,h=z*k*2;t.vx+=r*h*e,t.vy+=d*h*e;const c=120*St;let u=0,m=0,g=0;for(let e=0;e<Pe.length;e++){const n=Pe[e];if(n===t)continue;const o=t.x-n.x,i=t.y-n.y,s=o*o+i*i;if(s<c*c&&s>0){const t=Math.sqrt(s),e=1-t/c;u+=o/t*e,m+=i/t*e,g++}}if(g>0){const n=15e3;t.vx+=u/g*n*e,t.vy+=m/g*n*e}const p=2500*k;if(Math.random()<.08){const e=Math.random()*Math.PI*2,n=1500*k;t.vx+=Math.cos(e)*n,t.vy+=Math.sin(e)*n}t.vx+=(Math.random()-.5)*p*e,t.vy+=(Math.random()-.5)*p*e;const y=.3+2*Math.random(),f=2e3*k*y*e;t.vx+=-d*f,t.vy+=r*f;const v=2200*k,x=Math.sqrt(t.vx*t.vx+t.vy*t.vy);x>v&&(t.vx=t.vx/x*v,t.vy=t.vy/x*v),t.vx*=.995,t.vy*=.995}(t,e):function(t,e){if(!ue)return;if(re<=0||le<=0)return;const n=le*St,o=t.x-he,i=t.y-ce,s=o*o+i*i;if(s>n*n)return;const a=Math.max(Math.sqrt(s),gt),l=o/a,r=i/a,d=Math.max(0,1-a/n),h=20*re*Math.pow(d,de),c=Math.max(.25,t.m/1);t.vx+=l*h*e/c,t.vy+=r*h*e/c,t.vx+=10*(Math.random()-.5)*e,t.vy+=10*(Math.random()-.5)*e}(t,e)}(this,t),this.x+=this.vx*t,this.y+=this.vy*t;const i=Math.max(0,1-2*t);this.omega*=i,this.theta+=this.omega*t,this.theta>Math.PI?this.theta-=2*Math.PI:this.theta<-Math.PI&&(this.theta+=2*Math.PI);const s=Math.min(1,18*t);this.squashAmount+=(0-this.squashAmount)*s,this.squash=1-this.squashAmount}walls(e,n,o,i=zt){const s=i;if(0===ye){if(this.y+this.r>n){this.y=n-this.r;const e=this.vy,i=this.vx-this.omega*this.r,a=Math.max(.25,this.m/1);this.omega+=i/this.r*.25/a;const l=Math.max(0,1-1.5*o/a);this.vx*=l;const r=Math.abs(e)<70?0:s;this.vy=-this.vy*(r*Math.pow(1/this.m,jt));const d=Math.min(1,Math.abs(e)/(90*this.r));this.squashAmount=Math.min(t(),.8*d),this.squash=1-this.squashAmount,this.squashNormalAngle=-Math.PI/2;const h=this.vx/this.r;this.omega+=(h-this.omega)*Math.min(1,8*o)}const i=F===MODES.PIT?n/3:0;if(this.y-this.r<i){this.y=i+this.r;const e=this.vy;this.vy=-this.vy*s;const n=Math.min(1,Math.abs(e)/(90*this.r));this.squashAmount=Math.min(t(),.8*n),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI/2}if(this.x+this.r>e){this.x=e-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*s;const n=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(t(),.8*n),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*s;const e=Math.min(1,Math.abs(this.vx)/(90*this.r));this.squashAmount=Math.min(t(),.8*e),this.squash=1-this.squashAmount,this.squashNormalAngle=0}}else this.handleRoundedWallCollision(e,n);this.checkTextCollisions(o)}checkTextCollisions(e){for(let e=0;e<ve.length;e++){const n=ve[e],o=Math.max(n.x,Math.min(this.x,n.x+n.width)),i=Math.max(n.y,Math.min(this.y,n.y+n.height)),s=this.x-o,a=this.y-i,l=Math.sqrt(s*s+a*a);if(l<this.r)if(0===l){const t=this.x-n.x,e=n.x+n.width-this.x,o=this.y-n.y,i=n.y+n.height-this.y,s=Math.min(t,e,o,i);s===t?(this.x=n.x-this.r,this.vx=-Math.abs(this.vx)*zt):s===e?(this.x=n.x+n.width+this.r,this.vx=Math.abs(this.vx)*zt):s===o?(this.y=n.y-this.r,this.vy=-Math.abs(this.vy)*zt):(this.y=n.y+n.height+this.r,this.vy=Math.abs(this.vy)*zt)}else{const e=this.r-l,n=s/l,o=a/l;this.x+=n*e,this.y+=o*e;const i=this.vx*n+this.vy*o;if(i<0){this.vx-=2*i*n*zt,this.vy-=2*i*o*zt;const e=Math.min(1,Math.abs(i)/(70*this.r));this.squash=1-t()*e,this.squashDirX=Math.abs(n)>Math.abs(o)?1:0,this.squashDirY=Math.abs(o)>Math.abs(n)?1:0}}}}handleRoundedWallCollision(e,n){const o=ye,i=[{x:o,y:o},{x:e-o,y:o},{x:e-o,y:n-o},{x:o,y:n-o}];for(let s=0;s<i.length;s++){const a=i[s],l=this.x-a.x,r=this.y-a.y,d=Math.sqrt(l*l+r*r);if(this.isInCornerRegion(a,e,n,o)&&d+this.r>o){const e=o-(d-this.r);if(e>0&&d>0){const n=l/d,o=r/d;this.x+=n*e,this.y+=o*e;const i=this.vx*n+this.vy*o;this.vx-=2*i*n*zt,this.vy-=2*i*o*zt;const s=Math.min(1,Math.abs(i)/(90*this.r));this.squashAmount=Math.min(t(),.8*s),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.atan2(o,n)}}}if(this.y+this.r>n&&(this.x<o||this.x>e-o)&&(this.y=n-this.r,this.vy=-this.vy*(zt*Math.pow(1/this.m,jt))),this.y-this.r<0&&(this.x<o||this.x>e-o)&&(this.y=this.r,this.vy=-this.vy*zt),this.x+this.r>e&&(this.y<o||this.y>n-o)){this.x=e-this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(zt*Math.pow(1/this.m,jt));const n=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(t(),n),this.squash=1-this.squashAmount,this.squashNormalAngle=Math.PI}if(this.x-this.r<0&&(this.y<o||this.y>n-o)){this.x=this.r;{const t=this.vy-this.omega*this.r,e=Math.max(.25,this.m/1);this.omega+=t/this.r*.125/e}this.vx=-this.vx*(zt*Math.pow(1/this.m,jt));const e=Math.min(1,Math.abs(this.vx)/(70*this.r));this.squashAmount=Math.min(t(),e),this.squash=1-this.squashAmount,this.squashNormalAngle=0}this.y+this.r>n&&this.x>=o&&this.x<=e-o&&(this.y=n-this.r,this.vy=-this.vy*(zt*Math.pow(1/this.m,jt))),this.y-this.r<0&&this.x>=o&&this.x<=e-o&&(this.y=this.r,this.vy=-this.vy*(zt*Math.pow(1/this.m,jt))),this.x+this.r>e&&this.y>=o&&this.y<=n-o&&(this.x=e-this.r,this.vx=-this.vx*(zt*Math.pow(1/this.m,jt))),this.x-this.r<0&&this.y>=o&&this.y<=n-o&&(this.x=this.r,this.vx=-this.vx*(zt*Math.pow(1/this.m,jt)))}isInCornerRegion(t,e,n,o){return t.x===o&&t.y===o?this.x<=o&&this.y<=o:t.x===e-o&&t.y===o?this.x>=e-o&&this.y<=o:t.x===e-o&&t.y===n-o?this.x>=e-o&&this.y>=n-o:t.x===o&&t.y===n-o&&this.x<=o&&this.y>=n-o}draw(e){e.save(),e.translate(this.x,this.y);const n=Math.min(t(),Math.max(0,this.squashAmount));if(this.r>15&&n>.001){const t=1+n,o=1/t;e.rotate(this.squashNormalAngle),e.scale(t,o),e.rotate(-this.squashNormalAngle)}e.beginPath(),e.arc(0,0,this.r,0,2*Math.PI),e.fillStyle=this.color,e.fill(),e.restore()}}const Pe=[];let Re=0;const Fe=new Map;let Ve=performance.now()/1e3,Ae=0;const qe=1/120;console.log("High refresh mode enabled - using requestAnimationFrame"),requestAnimationFrame(function frame(t){const e=t/1e3;let n=Math.min(.008,e-Ve);Ve=e,Ae+=n,Ie++,(we||Ce)&&e-Me>=1&&(we&&Ie!==be&&(be=Ie,we.textContent=be.toString()),Ce&&Se!==Be&&(Be=Se,Ce.textContent=Be.toString()),Ie=0,Se=0,Me=e,function(t){t-Te<2||(Te=t,be<50?(Le=1,console.log("⚡ Adaptive Quality: LOW (1 collision iter) - FPS:",be)):be<70?(Le=2,console.log("⚡ Adaptive Quality: MEDIUM (2 collision iters) - FPS:",be)):(Le=3,console.log("⚡ Adaptive Quality: HIGH (3 collision iters) - FPS:",be)))}(e)),function(t){if(F!==MODES.WEIGHTLESS&&F!==MODES.PULSE_GRID)for(Re+=t;Re>=kt;){const t=(Math.random()-.5)*kt*.5;Re-=kt+t,Kt+=2*Math.PI*.12*(kt+t);const e=p(),n=Math.random()<.35?3:1;for(let t=0;t<n;t++)if(Pe.length<Nt){const n=8*t*(Math.random()<.5?1:-1);g(e.x+n,e.y-12*t)}}}(n),F===MODES.PULSE_GRID&&function(t){for(let e=0;e<Pe.length;e++){const n=Pe[e];if(n.nextJumpTime-=t,n.nextJumpTime<=0&&n.jumpProgress>=1){const t=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}],e=t[Math.floor(Math.random()*t.length)],o=Z-_+1,i=_+Math.floor(Math.random()*o),s=Math.max(1,Math.round(i*(1-.5*j+j*Math.random())));let a=n.gridX+e.dx*s,l=n.gridY+e.dy*s;a=Math.max(0,Math.min(xo-1,a)),l=Math.max(0,Math.min(vo-1,l)),n.gridX=a,n.gridY=l;const r=S(a,l);n.targetX=r.x,n.targetY=r.y,n.jumpProgress=0,n.jumpStartX=n.x,n.jumpStartY=n.y;const d=j*H*(Math.random()-.5),h=W*H*Math.random();n.nextJumpTime=H+d+h}if(n.jumpProgress<1)if(n.jumpProgress+=t/$,n.jumpProgress>=1)n.jumpProgress=1,n.x=n.targetX,n.y=n.targetY,n.vx=0,n.vy=0;else{const t=n.jumpProgress;let e=t;if("linear"===K)e=t;else if("snap"===K)if(t<.6){const n=t/.6;e=n*n*tt}else{const n=(t-.6)/.4;e=1+(tt-1)*(1-n)-Q*Math.sin(n*Math.PI)}else if("bounce"===K)if(t<.7)e=t/.7*(t/.7);else{const n=(t-.7)/.3;e=1-.5*Q*Math.sin(n*Math.PI*2)}else"smooth"===K&&(e=t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2);n.x=n.jumpStartX+(n.targetX-n.jumpStartX)*e,n.y=n.jumpStartY+(n.targetY-n.jumpStartY)*e,n.vx=0,n.vy=0}}}(n),Ie%60==0&&a();let o=0;for(;Ae>=qe&&o<2;){if(F!==MODES.PULSE_GRID)for(let t=0;t<Pe.length;t++)Pe[t].step(qe);if(F!==MODES.FLIES&&F!==MODES.PULSE_GRID&&y(Le),F!==MODES.PULSE_GRID){const t=F===MODES.WEIGHTLESS?D:zt;for(let e=0;e<Pe.length;e++)Pe[e].walls(vt.width,vt.height,qe,t)}Ae-=qe,o++,Se++}Ae>3*qe&&(Ae=0),Et.clearRect(0,0,vt.width,vt.height),ye>0&&function(t,e,n){const o=ye;t.strokeStyle="rgba(255, 255, 255, 0.1)",t.lineWidth=2,t.beginPath(),t.moveTo(o,0),t.lineTo(e-o,0),t.arcTo(e,0,e,o,o),t.lineTo(e,n-o),t.arcTo(e,n,e-o,n,o),t.lineTo(o,n),t.arcTo(0,n,0,n-o,o),t.lineTo(0,o),t.arcTo(0,0,o,0,o),t.closePath(),t.stroke()}(Et,vt.width,vt.height);for(let t=0;t<Pe.length;t++)Pe[t].draw(Et);if(function(t){if(me)return;if(he===ut||ce===ut)return;const e=he,n=ce,o=(Zt+Jt)/2;t.beginPath(),t.arc(e,n,o,0,2*Math.PI),t.fillStyle="rgba(255, 255, 255, 0.9)",t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.6)",t.lineWidth=2,t.stroke()}(Et),!me){Et.save(),Et.font="14px system-ui, -apple-system, sans-serif",Et.fillStyle="rgba(255, 255, 255, 0.3)",Et.textAlign="left",Et.textBaseline="bottom";const t=F.charAt(0).toUpperCase()+F.slice(1);Et.fillText(t+" Mode",10,vt.height-10),Et.restore()}requestAnimationFrame(frame)});const ze=document.getElementById("panelHeader"),Ge=document.getElementById("minimizePanel");if(It&&It.classList.add("hidden"),Ge&&It&&Ge.addEventListener("click",t=>{t.stopPropagation(),It.classList.toggle("hidden")}),ze&&It){let Qo,Ko,ti,ei,ni=!1,oi=0,ii=0;function ke(t){"touchstart"===t.type?(ti=t.touches[0].clientX-oi,ei=t.touches[0].clientY-ii):(ti=t.clientX-oi,ei=t.clientY-ii),(t.target===ze||ze.contains(t.target))&&(ni=!0,It.style.cursor="grabbing")}function Ne(t){if(ni){t.preventDefault(),"touchmove"===t.type?(Qo=t.touches[0].clientX-ti,Ko=t.touches[0].clientY-ei):(Qo=t.clientX-ti,Ko=t.clientY-ei),oi=Qo,ii=Ko,It.getBoundingClientRect();const e=window.getComputedStyle(It),n=parseFloat(e.top)||0,o=parseFloat(e.right)||0;It.style.top=`${n+ii}px`,It.style.right=o-oi+"px",It.style.left="auto",It.style.bottom="auto",oi=0,ii=0,ti="touchmove"===t.type?t.touches[0].clientX:t.clientX,ei="touchmove"===t.type?t.touches[0].clientY:t.clientY}}function Oe(t){ni&&(ni=!1,It.style.cursor="move",ti=Qo,ei=Ko)}ze.addEventListener("mousedown",ke),document.addEventListener("mousemove",Ne),document.addEventListener("mouseup",Oe),ze.addEventListener("touchstart",ke),document.addEventListener("touchmove",Ne),document.addEventListener("touchend",Oe)}window.addEventListener("keydown",t=>{const e=t.key.toLowerCase();"r"===e&&(function(){if(F===MODES.WEIGHTLESS)E();else for(let t=0;t<Pe.length;t++){const e=Pe[t],n=p();e.x=n.x,e.y=n.y;const o=.5*vt.width,i=Qt?te>=0?1:-1:e.x<o?1:-1,s=u(e.r/(.5*(Zt+Jt)),.6,1.4),a=140*s,l=180*s,r=120;e.vx=i*(a+Math.random()*l),e.vy=-Math.random()*r,e.age=0,e.driftAx=i*(360+420*Math.random())*s,e.driftTime=.22+.28*Math.random()}}(),t.preventDefault()),"/"===e&&It&&(t.preventDefault(),It.classList.toggle("hidden")),"1"===e&&b(MODES.PIT),"2"===e&&b(MODES.FLIES),"3"===e&&b(MODES.WEIGHTLESS),"4"===e&&b(MODES.PULSE_GRID)}),function(t=160){for(let e=0;e<t&&Pe.length<Nt;e++){const t=p();g(t.x,t.y)}}(200),vt.addEventListener("mousemove",t=>{const e=vt.getBoundingClientRect();he=(t.clientX-e.left)*St,ce=(t.clientY-e.top)*St,F===MODES.PIT&&re>0&&le>0&&(ue=!0)}),vt.addEventListener("mouseleave",()=>{he=ut,ce=ut});const De=document.getElementById("restitutionSlider"),Ue=document.getElementById("frictionSlider"),Ye=document.getElementById("emitterSlider"),Xe=document.getElementById("sizeSliderGlobal"),He=document.getElementById("sizeVariationSliderGlobal"),$e=(document.getElementById("weightSliderGlobal"),document.getElementById("ballSoftnessSliderGlobal")),We=document.getElementById("sizeValGlobal"),je=document.getElementById("sizeVariationValGlobal"),_e=(document.getElementById("weightValGlobal"),document.getElementById("ballSoftnessValGlobal")),Ze=(document.getElementById("sizeSliderPit"),document.getElementById("sizeVariationSliderPit"),document.getElementById("weightSliderPit"),document.getElementById("ballSoftnessSliderPit"),document.getElementById("sizeValPit"),document.getElementById("sizeVariationValPit"),document.getElementById("weightValPit"),document.getElementById("ballSoftnessValPit"),document.getElementById("sizeSliderFlies"),document.getElementById("sizeVariationSliderFlies"),document.getElementById("weightSliderFlies"),document.getElementById("ballSoftnessSliderFlies"),document.getElementById("sizeValFlies"),document.getElementById("sizeVariationValFlies"),document.getElementById("weightValFlies"),document.getElementById("ballSoftnessValFlies"),document.getElementById("sizeSliderZeroG"),document.getElementById("sizeVariationSliderZeroG"),document.getElementById("weightSliderZeroG"),document.getElementById("ballSoftnessSliderZeroG"),document.getElementById("sizeValZeroG"),document.getElementById("sizeVariationValZeroG"),document.getElementById("weightValZeroG"),document.getElementById("ballSoftnessValZeroG"),document.getElementById("maxBallsSlider")),Je=document.getElementById("spawnYSlider"),Qe=document.getElementById("spawnWidthSlider"),Ke=document.getElementById("spawnCenterSlider"),tn=document.getElementById("spawnHeightSlider"),en=document.getElementById("repelSizeSlider"),nn=document.getElementById("repelPowerSlider"),on=document.getElementById("repelSoftSlider"),sn=document.getElementById("colorSelect"),an=document.getElementById("color1"),ln=document.getElementById("color2"),rn=document.getElementById("color3"),dn=document.getElementById("color4"),hn=document.getElementById("color5"),cn=document.getElementById("color6"),un=document.getElementById("color7"),mn=document.getElementById("color8"),gn=document.getElementById("cursorColorSelect"),pn=document.getElementById("color1Val"),yn=document.getElementById("color2Val"),fn=document.getElementById("color3Val"),vn=document.getElementById("color4Val"),xn=document.getElementById("color5Val"),En=document.getElementById("color6Val"),In=document.getElementById("color7Val"),Sn=document.getElementById("color8Val");[pn,yn,fn,vn,xn,En,In,Sn].forEach(t=>{t&&t.setAttribute("title","Click to copy")});const Mn=document.getElementById("cornerRadiusSlider"),bn=document.getElementById("cornerRadiusVal"),Bn=document.getElementById("trailFadeSlider"),wn=document.getElementById("trailFadeVal"),Cn=document.getElementById("trailSubtletySlider"),Ln=document.getElementById("trailSubtletyVal"),Tn=document.getElementById("restitutionVal"),Pn=document.getElementById("frictionVal"),Rn=document.getElementById("emitterVal"),Fn=document.getElementById("maxBallsVal"),Vn=document.getElementById("spawnYVal"),An=document.getElementById("spawnWidthVal"),qn=document.getElementById("spawnCenterVal"),zn=document.getElementById("spawnHeightVal"),Gn=document.getElementById("repelSizeVal"),kn=document.getElementById("repelPowerVal"),Nn=document.getElementById("repelSoftVal"),On=document.getElementById("saveConfigBtn"),Dn=document.getElementById("buildBtn"),Un=document.getElementById("configOutput");On&&Dn&&Un&&(On.addEventListener("click",()=>{const t=(e=v(),`// Generated configuration from frontend\nconst CONFIG = ${JSON.stringify(e,null,2)};`);var e;Un.style.display="block",Un.textContent=t,navigator.clipboard.writeText(t).then(()=>{const t=On.textContent;On.textContent="✅ Copied!",setTimeout(()=>{On.textContent=t},1200)}).catch(()=>{console.warn("Clipboard copy failed");const t=On.textContent;On.textContent="⚠️ Copy failed",setTimeout(()=>{On.textContent=t},1200)})}),Dn.addEventListener("click",()=>{const t=v();Un.style.display="block",Un.innerHTML="\n<strong>🚀 Build Instructions:</strong><br>\n1. Run: <code>npm run build</code><br>\n2. Your current config will be baked into <code>public/js/bouncy-balls-embed.js</code>";const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download="current-config.json",o.click(),URL.revokeObjectURL(n)})),De&&De.addEventListener("input",()=>{zt=parseFloat(De.value),Tn&&(Tn.textContent=zt.toFixed(2)),c()}),Ue&&Ue.addEventListener("input",()=>{Gt=parseFloat(Ue.value),Pn&&(Pn.textContent=Gt.toFixed(4)),c()}),Ye&&Ye.addEventListener("input",()=>{kt=parseFloat(Ye.value),Rn&&(Rn.textContent=kt.toFixed(3)),c()}),function(t){if(!t)return;const{size:e,sizeVal:n,sizeVar:o,sizeVarVal:i,soft:a,softVal:l}=t;e&&e.addEventListener("input",()=>{const t=parseFloat(e.value);n&&(n.textContent=t.toFixed(1)),Yt=t,s();for(let t=0;t<Pe.length;t++)Pe[t].m=Wt;c()}),o&&o.addEventListener("input",()=>{const t=parseFloat(o.value);i&&(i.textContent=t.toFixed(1)),Xt=t,c()}),a&&a.addEventListener("input",()=>{const t=parseInt(a.value,10);l&&(l.textContent=String(t)),V=t,c()})}({size:Xe,sizeVal:We,sizeVar:He,sizeVarVal:je,soft:$e,softVal:_e}),Ze&&Ze.addEventListener("input",()=>{Nt=parseInt(Ze.value,10),Fn&&(Fn.textContent=Nt.toString()),Pe.length>Nt&&(Pe.length=Nt)});const Yn=document.getElementById("weightPitSlider"),Xn=document.getElementById("weightPitVal");document.getElementById("weightWeightlessSlider"),document.getElementById("weightWeightlessVal"),Je&&Je.addEventListener("input",()=>{Pt=parseFloat(Je.value),Vn&&(Vn.textContent=Pt.toFixed(0)),o()}),Qe&&Qe.addEventListener("input",()=>{Rt=parseFloat(Qe.value),An&&(An.textContent=Rt.toFixed(0))}),Ke&&Ke.addEventListener("input",()=>{Tt=parseFloat(Ke.value),qn&&(qn.textContent=Tt.toFixed(0))}),tn&&tn.addEventListener("input",()=>{Ft=parseFloat(tn.value),zn&&(zn.textContent=Ft.toFixed(0))}),en&&en.addEventListener("input",()=>{le=parseFloat(en.value),Gn&&(Gn.textContent=le.toFixed(0)),ue=ue||re>0&&le>0}),nn&&nn.addEventListener("input",()=>{re=function(t){const e=Math.max(0,Math.min(pe,Number(t)))/pe;return 2*Math.pow(2,12*(e-.5))*12e3}(nn.value),kn&&(kn.textContent=Math.round(re).toString()),Zo&&"off"!==Zo.value&&(ue=re>0&&le>0)}),on&&on.addEventListener("input",()=>{de=parseFloat(on.value),Nn&&(Nn.textContent=de.toFixed(1))});const Hn=document.getElementById("performanceModeToggle");document.getElementById("performanceModeStatus"),Hn&&Hn.addEventListener("change",()=>{!function(){Mt=!Mt,bt=Mt?120:60;const t=Mt?Ct.performance:Ct.normal;Mt?(console.log("⚡ PERFORMANCE MODE: Optimizing for 120 FPS..."),Pe.length>t.maxBalls&&(Pe.length=t.maxBalls,console.log(`⚡ Reduced balls to ${t.maxBalls} for 120 FPS`)),Nt=t.maxBalls,Le=t.collisionIters):(console.log("🎨 NORMAL MODE: Restoring visual quality..."),Nt=t.maxBalls,Le=t.collisionIters),function(){const t=document.getElementById("performanceModeToggle"),e=document.getElementById("performanceModeStatus"),n=document.getElementById("maxBallsSlider"),o=document.getElementById("maxBallsVal");t&&(t.checked=Mt),e&&(Mt?(e.textContent=`⚡ 120 FPS Mode Active (${Pe.length} balls)`,e.style.background="rgba(255,165,0,0.3)"):(e.textContent=`🎨 Normal Mode (${Pe.length} balls)`,e.style.background="rgba(0,0,0,0.2)")),n&&o&&(n.value=Nt,o.textContent=Nt.toString())}(),console.log(`🎯 Target FPS: ${bt}, Mode: ${Mt?"PERFORMANCE":"NORMAL"}`)}()});const $n=document.getElementById("darkModeToggle");document.getElementById("darkModeStatus"),$n&&$n.addEventListener("change",()=>{Bt=!Bt,Bt?(n(),console.log("🌙 Auto Dark Mode: ENABLED")):(e(!1),console.log("☀️ Auto Dark Mode: DISABLED")),c()}),vt.addEventListener("mousemove",t=>{const e=vt.getBoundingClientRect();he=(t.clientX-e.left)*St,ce=(t.clientY-e.top)*St}),vt.addEventListener("mouseleave",()=>{he=ut,ce=ut}),sn&&sn.addEventListener("change",()=>{l(sn.value)});const Wn=Array.from(document.querySelectorAll(".mode-button")),jn=document.getElementById("pitControls"),_n=document.getElementById("fliesControls"),Zn=document.getElementById("weightlessControls"),Jn=document.getElementById("gravityPitSlider"),Qn=document.getElementById("gravityPitVal"),Kn=document.getElementById("repellerEnabledPit"),to=document.getElementById("attractPowerSlider"),eo=document.getElementById("attractPowerVal"),no=document.getElementById("orbitRadiusSlider"),oo=document.getElementById("orbitRadiusVal"),io=document.getElementById("swarmSpeedSlider"),so=document.getElementById("swarmSpeedVal"),ao=document.getElementById("weightlessCountSlider"),lo=document.getElementById("weightlessCountVal"),ro=document.getElementById("weightlessSpeedSlider"),ho=document.getElementById("weightlessSpeedVal"),co=document.getElementById("weightlessBounceSlider"),uo=document.getElementById("weightlessBounceVal"),mo=document.getElementById("weightlessRepelSlider"),go=document.getElementById("weightlessRepelVal"),po=document.getElementById("weightlessRepelRadiusSlider"),yo=document.getElementById("weightlessRepelRadiusVal");let fo=0,vo=0,xo=0,Eo=0,Io=0;Wn.forEach(t=>t.addEventListener("click",()=>{b(t.getAttribute("data-mode")),c()})),Jn&&Jn.addEventListener("input",()=>{A=parseFloat(Jn.value),Qn&&(Qn.textContent=A.toFixed(1)),c(),F===MODES.PIT&&(At=A,qt=Vt*At)}),Yn&&Yn.addEventListener("input",()=>{Wt=parseFloat(Yn.value),Xn&&(Xn.textContent=Wt.toFixed(2));for(let t=0;t<Pe.length;t++)Pe[t].m=Wt;i(),c()}),Kn&&Kn.addEventListener("change",()=>{q=!!Kn.checked,F===MODES.PIT&&(ue=q&&re>0&&le>0)}),to&&to.addEventListener("input",()=>{z=parseFloat(to.value),eo&&(eo.textContent=Math.round(z).toString())}),no&&no.addEventListener("input",()=>{G=parseFloat(no.value),oo&&(oo.textContent=Math.round(G).toString())}),io&&io.addEventListener("input",()=>{k=parseFloat(io.value),so&&(so.textContent=k.toFixed(1))}),ao&&ao.addEventListener("input",()=>{N=parseInt(ao.value,10),lo&&(lo.textContent=N.toString()),F===MODES.WEIGHTLESS&&E()}),ro&&ro.addEventListener("input",()=>{O=parseFloat(ro.value),ho&&(ho.textContent=Math.round(O).toString())}),co&&co.addEventListener("input",()=>{D=parseFloat(co.value),uo&&(uo.textContent=D.toFixed(2))}),mo&&mo.addEventListener("input",()=>{U=parseFloat(mo.value),go&&(go.textContent=Math.round(U).toString()),c()}),po&&po.addEventListener("input",()=>{Y=parseFloat(po.value),yo&&(yo.textContent=Math.round(Y).toString()),c()});const So=document.getElementById("gridPresetSelect"),Mo=document.getElementById("gridBallCountSlider"),bo=document.getElementById("gridBallCountVal"),Bo=document.getElementById("gridColumnsSlider"),wo=document.getElementById("gridColumnsVal"),Co=document.getElementById("pulseIntervalSlider"),Lo=document.getElementById("pulseIntervalVal"),To=document.getElementById("pulseSpeedSlider"),Po=document.getElementById("pulseSpeedVal"),Ro=document.getElementById("pulseMinStepsSlider"),Fo=document.getElementById("pulseMinStepsVal"),Vo=document.getElementById("pulseMaxStepsSlider"),Ao=document.getElementById("pulseMaxStepsVal"),qo=document.getElementById("pulseSynchronicitySlider"),zo=document.getElementById("pulseSynchronicityVal"),Go=document.getElementById("pulseRandomnessSlider"),ko=document.getElementById("pulseRandomnessVal"),No={synchronized:{interval:.6,speed:.2,minSteps:1,maxSteps:2,synchronicity:.1,randomness:.2,easingStyle:"snap",overshoot:1.12,bounce:.18},organic:{interval:.8,speed:.25,minSteps:1,maxSteps:3,synchronicity:.3,randomness:.4,easingStyle:"smooth",overshoot:1.05,bounce:.1},chaotic:{interval:.4,speed:.15,minSteps:2,maxSteps:4,synchronicity:.7,randomness:.8,easingStyle:"bounce",overshoot:1.15,bounce:.25}};So&&So.addEventListener("change",()=>{!function(t){const e=No[t];if(!e)return;H=e.interval,$=e.speed,_=e.minSteps,Z=e.maxSteps,W=e.synchronicity,j=e.randomness,K=e.easingStyle,tt=e.overshoot,Q=e.bounce,Co&&(Co.value=e.interval),Lo&&(Lo.textContent=e.interval.toFixed(1)),To&&(To.value=e.speed),Po&&(Po.textContent=e.speed.toFixed(2)),Ro&&(Ro.value=e.minSteps),Fo&&(Fo.textContent=e.minSteps.toString()),Vo&&(Vo.value=e.maxSteps),Ao&&(Ao.textContent=e.maxSteps.toString()),qo&&(qo.value=e.synchronicity),zo&&(zo.textContent=e.synchronicity.toFixed(2)),Go&&(Go.value=e.randomness),ko&&(ko.textContent=e.randomness.toFixed(2));const n=document.getElementById("pulseEasingSelect"),o=document.getElementById("pulseOvershootSlider"),i=document.getElementById("pulseOvershootVal"),s=document.getElementById("pulseBounceSlider"),a=document.getElementById("pulseBounceVal");n&&(n.value=e.easingStyle),o&&(o.value=e.overshoot),i&&(i.textContent=e.overshoot.toFixed(2)),s&&(s.value=e.bounce),a&&(a.textContent=e.bounce.toFixed(2)),F===MODES.PULSE_GRID&&M()}(So.value),c()}),Mo&&Mo.addEventListener("input",()=>{J=parseInt(Mo.value,10),bo&&(bo.textContent=J.toString()),F===MODES.PULSE_GRID&&M(),c()}),Bo&&Bo.addEventListener("input",()=>{X=parseInt(Bo.value,10),wo&&(wo.textContent=X.toString()),F===MODES.PULSE_GRID&&(I(),M()),c()}),Co&&Co.addEventListener("input",()=>{H=parseFloat(Co.value),Lo&&(Lo.textContent=H.toFixed(1)),c()}),To&&To.addEventListener("input",()=>{$=parseFloat(To.value),Po&&(Po.textContent=$.toFixed(2)),c()}),Ro&&Ro.addEventListener("input",()=>{_=parseInt(Ro.value,10),Fo&&(Fo.textContent=_.toString()),_>Z&&(Z=_,Vo&&(Vo.value=_),Ao&&(Ao.textContent=_.toString())),c()}),Vo&&Vo.addEventListener("input",()=>{Z=parseInt(Vo.value,10),Ao&&(Ao.textContent=Z.toString()),Z<_&&(_=Z,Ro&&(Ro.value=Z),Fo&&(Fo.textContent=Z.toString())),c()}),qo&&qo.addEventListener("input",()=>{W=parseFloat(qo.value),zo&&(zo.textContent=W.toFixed(2)),c()}),Go&&Go.addEventListener("input",()=>{j=parseFloat(Go.value),ko&&(ko.textContent=j.toFixed(2)),c()});const Oo=document.getElementById("pulseEasingSelect"),Do=document.getElementById("pulseOvershootSlider"),Uo=document.getElementById("pulseOvershootVal"),Yo=document.getElementById("pulseBounceSlider"),Xo=document.getElementById("pulseBounceVal");Oo&&Oo.addEventListener("change",()=>{K=Oo.value,c()}),Do&&Do.addEventListener("input",()=>{tt=parseFloat(Do.value),Uo&&(Uo.textContent=tt.toFixed(2)),c()}),Yo&&Yo.addEventListener("input",()=>{Q=parseFloat(Yo.value),Xo&&(Xo.textContent=Q.toFixed(2)),c()}),an&&an.addEventListener("input",()=>{oe[0]=an.value,pn&&(pn.textContent=an.value.toUpperCase()),B(),r()}),ln&&ln.addEventListener("input",()=>{oe[1]=ln.value,yn&&(yn.textContent=ln.value.toUpperCase()),B(),r()}),rn&&rn.addEventListener("input",()=>{oe[2]=rn.value,fn&&(fn.textContent=rn.value.toUpperCase()),B(),r()}),dn&&dn.addEventListener("input",()=>{oe[3]=dn.value,vn&&(vn.textContent=dn.value.toUpperCase()),B(),r()}),hn&&hn.addEventListener("input",()=>{oe[4]=hn.value,xn&&(xn.textContent=hn.value.toUpperCase()),B(),r()}),cn&&cn.addEventListener("input",()=>{oe[5]=cn.value,En&&(En.textContent=cn.value.toUpperCase()),B(),r()}),un&&un.addEventListener("input",()=>{oe[6]=un.value,In&&(In.textContent=un.value.toUpperCase()),B(),r()}),mn&&mn.addEventListener("input",()=>{oe[7]=mn.value,Sn&&(Sn.textContent=mn.value.toUpperCase()),B(),r()}),gn&&gn.addEventListener("change",()=>{const t=Math.max(1,Math.min(8,parseInt(gn.value,10)))-1;ie=t,se=oe[ie]||se,c()}),x(pn,()=>an.value.toUpperCase()),x(yn,()=>ln.value.toUpperCase()),x(fn,()=>rn.value.toUpperCase()),x(vn,()=>dn.value.toUpperCase()),x(xn,()=>hn.value.toUpperCase()),x(En,()=>cn.value.toUpperCase()),x(In,()=>un.value.toUpperCase()),x(Sn,()=>mn.value.toUpperCase()),Mn&&Mn.addEventListener("input",()=>{ye=parseFloat(Mn.value),bn&&(bn.textContent=ye.toFixed(0))}),Bn&&Bn.addEventListener("input",()=>{xe=parseFloat(Bn.value),wn&&(wn.textContent=xe.toFixed(3))}),Cn&&Cn.addEventListener("input",()=>{Ee=parseFloat(Cn.value),Ln&&(Ln.textContent=Ee.toFixed(2)+"×")});const Ho={rubberPlayground:{label:"Rubber – Playground",G:1960,REST:.9,FRICTION:.0025,sizeScale:1.8,maxBalls:450,sizeVariation:.2},rubberRacquet:{label:"Rubber – Racquetball",G:3320,REST:.97,FRICTION:.0035,sizeScale:.7,maxBalls:350,sizeVariation:.3},rubberSuperball:{label:"Rubber – Superball",G:1960,REST:.95,FRICTION:.0015,sizeScale:1.2,maxBalls:450,sizeVariation:.05},rubberSoft:{label:"Rubber – Soft",G:1960,REST:.86,FRICTION:.0035,sizeScale:2.2,maxBalls:350,sizeVariation:.25},rubberHeavy:{label:"Rubber – Heavy",G:1960,REST:.88,FRICTION:.003,sizeScale:2,maxBalls:400,sizeVariation:.15}},$o={fullRain:{label:"Full Rain (top-half)",EMIT_INTERVAL:.03,xCenter:50,y:-50,w:100,h:50},narrowStrip:{label:"Narrow Strip Top",EMIT_INTERVAL:.05,xCenter:50,y:-40,w:20,h:10},leftGutter:{label:"Left Gutter",EMIT_INTERVAL:.045,xCenter:10,y:-60,w:18,h:20},rightGutter:{label:"Right Gutter",EMIT_INTERVAL:.045,xCenter:90,y:-60,w:18,h:20},centerFountain:{label:"Center Fountain",EMIT_INTERVAL:.02,xCenter:50,y:-30,w:30,h:20},stormBurst:{label:"Storm Burst",EMIT_INTERVAL:.005,xCenter:50,y:-80,w:100,h:30},slowSnow:{label:"Slow Snow",EMIT_INTERVAL:.2,xCenter:50,y:-30,w:100,h:20},edgeDrizzle:{label:"Edge Drizzle",EMIT_INTERVAL:.08,xCenter:15,y:-40,w:30,h:15},twinColumns:{label:"Twin Columns",EMIT_INTERVAL:.03,xCenter:30,y:-50,w:10,h:40},focusedBeam:{label:"Focused Beam",EMIT_INTERVAL:.015,xCenter:50,y:-70,w:6,h:12}},Wo={off:{label:"Off",r:710,p:274e3,s:4.4},gentle:{label:"Gentle Breeze",r:120,p:2500,s:2.5},pushField:{label:"Push Field",r:240,p:8e4,s:2},tractor:{label:"Tractor Push",r:320,p:14e4,s:1.6},magnet:{label:"Magnet Repel",r:200,p:18e4,s:3},pulse:{label:"Pulse Strong",r:280,p:22e4,s:1.2},wideSoft:{label:"Wide Soft",r:500,p:8e4,s:4.5},needle:{label:"Needle Point",r:80,p:26e4,s:.8},wall:{label:"Invisible Wall",r:700,p:16e4,s:5},singularity:{label:"Singularity",r:600,p:3e5,s:.5}},jo=document.getElementById("physicsSelect"),_o=document.getElementById("spawnSelect"),Zo=document.getElementById("repellerSelect");jo&&C(jo,Ho,"rubberRacquet"),_o&&C(_o,$o,"fullRain"),Zo&&C(Zo,Wo,"off"),sn&&C(sn,ee,"industrialTeal"),T("rubberRacquet"),P("fullRain"),R("off"),w(),r(),jo&&jo.addEventListener("change",()=>T(jo.value)),_o&&_o.addEventListener("change",()=>P(_o.value)),Zo&&Zo.addEventListener("change",()=>R(Zo.value)),s(),a(),function(){try{const t=localStorage.getItem(ge);if(t){const e=JSON.parse(t);return e.currentMode&&(F=e.currentMode),void 0!==e.gravityMultiplierPit&&(A=e.gravityMultiplierPit),void 0!==e.repellerEnabledPit&&(q=e.repellerEnabledPit),e.attractionPower&&(z=e.attractionPower),e.orbitRadius&&(G=e.orbitRadius),e.swarmSpeed&&(k=e.swarmSpeed),e.weightlessInitialSpeed&&(O=e.weightlessInitialSpeed),e.weightlessBounce&&(D=e.weightlessBounce),e.weightlessCount&&(N=e.weightlessCount),void 0!==e.weightlessRepellerPower&&(U=e.weightlessRepellerPower),void 0!==e.weightlessRepellerRadius&&(Y=e.weightlessRepellerRadius),e.restitution&&(zt=e.restitution),void 0!==e.friction&&(Gt=e.friction),e.sizeScale&&(Yt=e.sizeScale),void 0!==e.sizeVariation&&(Xt=e.sizeVariation),e.ballMassKg&&(Wt=e.ballMassKg),e.repelPower&&(re=e.repelPower),e.repelRadius&&(le=e.repelRadius),e.repelSoft&&(de=e.repelSoft),void 0!==e.cornerRadius&&(ye=e.cornerRadius),void 0!==e.motionBlur&&(trailFade=e.motionBlur),e.trailSubtlety&&(Ee=e.trailSubtlety),e.currentTemplate&&(ne=e.currentTemplate),e.cursorBallColor&&(se=e.cursorBallColor),void 0!==e.gridColumns&&(X=e.gridColumns),void 0!==e.gridBallCount&&(J=e.gridBallCount),void 0!==e.pulseInterval&&(H=e.pulseInterval),void 0!==e.pulseSpeed&&($=e.pulseSpeed),void 0!==e.pulseSynchronicity&&(W=e.pulseSynchronicity),void 0!==e.pulseRandomness&&(j=e.pulseRandomness),void 0!==e.pulseMinSteps&&(_=e.pulseMinSteps),void 0!==e.pulseMaxSteps&&(Z=e.pulseMaxSteps),e.pulseEasingStyle&&(K=e.pulseEasingStyle),void 0!==e.pulseOvershoot&&(tt=e.pulseOvershoot),void 0!==e.pulseBounceIntensity&&(Q=e.pulseBounceIntensity),void 0!==e.canvasShadowEnabled&&(et=e.canvasShadowEnabled),void 0!==e.shadowOffsetX&&(nt=e.shadowOffsetX),void 0!==e.shadowOffsetY&&(ot=e.shadowOffsetY),void 0!==e.shadowBlur&&(it=e.shadowBlur),void 0!==e.shadowOpacity&&(st=e.shadowOpacity),e.shadowColor&&(at=e.shadowColor),void 0!==e.shadow2Enabled&&(lt=e.shadow2Enabled),void 0!==e.shadow2Blur&&(rt=e.shadow2Blur),void 0!==e.shadow2Opacity&&(dt=e.shadow2Opacity),void 0!==e.autoDarkModeEnabled&&(Bt=e.autoDarkModeEnabled),console.log("✓ Settings loaded"),!0}}catch(t){console.warn("Could not load settings:",t)}}(),function(){if(!et)return void(vt.style.filter="none");const t=(t,e)=>`rgba(${parseInt(t.slice(1,3),16)}, ${parseInt(t.slice(3,5),16)}, ${parseInt(t.slice(5,7),16)}, ${e})`,e=`drop-shadow(${nt}px ${ot}px ${it}px ${t(at,st)})`,n=lt?` drop-shadow(${nt}px ${Math.round(.5*ot)}px ${rt}px ${t(at,dt)})`:"";vt.style.filter=e+n}(),console.log("🔍 Initializing dark mode system..."),n(),console.log(`✅ Dark mode initialized: ${wt?"DARK":"LIGHT"} mode active`),console.log(`   Container classes: ${xt.classList.toString()}`),console.log("   Background should be: "+(wt?"#0a0a0a (dark)":"#cecece (light)")),setInterval(n,6e4);{const si=Object.values(MODES),ai=si[Math.floor(Math.random()*si.length)];F=ai,console.log(`🎲 Random mode selected: ${ai}`)}b(F),window.addEventListener("beforeunload",h)})();
//# sourceMappingURL=bouncy-balls-embed.js.map